var Fp=i=>{throw TypeError(i)};var Hd=(i,e,t)=>e.has(i)||Fp("Cannot "+t);var Sr=(i,e,t)=>(Hd(i,e,"read from private field"),t?t.call(i):e.get(i)),Ka=(i,e,t)=>e.has(i)?Fp("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),Vs=(i,e,t,n)=>(Hd(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),Xa=(i,e,t)=>(Hd(i,e,"access private method"),t);var Vp=(i,e,t,n)=>({set _(r){Vs(i,e,r,t)},get _(){return Sr(i,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var commonjsGlobal$2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function getAugmentedNamespace(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var e=i.default;if(typeof e=="function"){var t=function n(){var r=!1;try{r=this instanceof n}catch{}return r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var r=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return i[n]}})}),t}var jsxRuntime={exports:{}},reactJsxRuntime_production={};var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,r,s){var a=null;if(s!==void 0&&(a=""+s),r.key!==void 0&&(a=""+r.key),"key"in r){s={};for(var l in r)l!=="key"&&(s[l]=r[l])}else s=r;return r=s.ref,{$$typeof:i,type:n,key:a,ref:r!==void 0?r:null,props:s}}return reactJsxRuntime_production.Fragment=e,reactJsxRuntime_production.jsx=t,reactJsxRuntime_production.jsxs=t,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),react={exports:{}},react_production={};var hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),a=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),m=Symbol.iterator;function g(re){return re===null||typeof re!="object"?null:(re=m&&re[m]||re["@@iterator"],typeof re=="function"?re:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,b={};function E(re,fe,pe){this.props=re,this.context=fe,this.refs=b,this.updater=pe||v}E.prototype.isReactComponent={},E.prototype.setState=function(re,fe){if(typeof re!="object"&&typeof re!="function"&&re!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,re,fe,"setState")},E.prototype.forceUpdate=function(re){this.updater.enqueueForceUpdate(this,re,"forceUpdate")};function A(){}A.prototype=E.prototype;function z(re,fe,pe){this.props=re,this.context=fe,this.refs=b,this.updater=pe||v}var D=z.prototype=new A;D.constructor=z,_(D,E.prototype),D.isPureReactComponent=!0;var P=Array.isArray;function G(){}var R={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function w(re,fe,pe){var Z=pe.ref;return{$$typeof:i,type:re,key:fe,ref:Z!==void 0?Z:null,props:pe}}function H(re,fe){return w(re.type,fe,re.props)}function V(re){return typeof re=="object"&&re!==null&&re.$$typeof===i}function te(re){var fe={"=":"=0",":":"=2"};return"$"+re.replace(/[=:]/g,function(pe){return fe[pe]})}var ae=/\/+/g;function be(re,fe){return typeof re=="object"&&re!==null&&re.key!=null?te(""+re.key):fe.toString(36)}function _e(re){switch(re.status){case"fulfilled":return re.value;case"rejected":throw re.reason;default:switch(typeof re.status=="string"?re.then(G,G):(re.status="pending",re.then(function(fe){re.status==="pending"&&(re.status="fulfilled",re.value=fe)},function(fe){re.status==="pending"&&(re.status="rejected",re.reason=fe)})),re.status){case"fulfilled":return re.value;case"rejected":throw re.reason}}throw re}function le(re,fe,pe,Z,ce){var Ee=typeof re;(Ee==="undefined"||Ee==="boolean")&&(re=null);var Te=!1;if(re===null)Te=!0;else switch(Ee){case"bigint":case"string":case"number":Te=!0;break;case"object":switch(re.$$typeof){case i:case e:Te=!0;break;case h:return Te=re._init,le(Te(re._payload),fe,pe,Z,ce)}}if(Te)return ce=ce(re),Te=Z===""?"."+be(re,0):Z,P(ce)?(pe="",Te!=null&&(pe=Te.replace(ae,"$&/")+"/"),le(ce,fe,pe,"",function(Me){return Me})):ce!=null&&(V(ce)&&(ce=H(ce,pe+(ce.key==null||re&&re.key===ce.key?"":(""+ce.key).replace(ae,"$&/")+"/")+Te)),fe.push(ce)),1;Te=0;var Ae=Z===""?".":Z+":";if(P(re))for(var Pe=0;Pe<re.length;Pe++)Z=re[Pe],Ee=Ae+be(Z,Pe),Te+=le(Z,fe,pe,Ee,ce);else if(Pe=g(re),typeof Pe=="function")for(re=Pe.call(re),Pe=0;!(Z=re.next()).done;)Z=Z.value,Ee=Ae+be(Z,Pe++),Te+=le(Z,fe,pe,Ee,ce);else if(Ee==="object"){if(typeof re.then=="function")return le(_e(re),fe,pe,Z,ce);throw fe=String(re),Error("Objects are not valid as a React child (found: "+(fe==="[object Object]"?"object with keys {"+Object.keys(re).join(", ")+"}":fe)+"). If you meant to render a collection of children, use an array instead.")}return Te}function ue(re,fe,pe){if(re==null)return re;var Z=[],ce=0;return le(re,Z,"","",function(Ee){return fe.call(pe,Ee,ce++)}),Z}function oe(re){if(re._status===-1){var fe=re._result;fe=fe(),fe.then(function(pe){(re._status===0||re._status===-1)&&(re._status=1,re._result=pe)},function(pe){(re._status===0||re._status===-1)&&(re._status=2,re._result=pe)}),re._status===-1&&(re._status=0,re._result=fe)}if(re._status===1)return re._result.default;throw re._result}var ee=typeof reportError=="function"?reportError:function(re){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var fe=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof re=="object"&&re!==null&&typeof re.message=="string"?String(re.message):String(re),error:re});if(!window.dispatchEvent(fe))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",re);return}console.error(re)},se={map:ue,forEach:function(re,fe,pe){ue(re,function(){fe.apply(this,arguments)},pe)},count:function(re){var fe=0;return ue(re,function(){fe++}),fe},toArray:function(re){return ue(re,function(fe){return fe})||[]},only:function(re){if(!V(re))throw Error("React.Children.only expected to receive a single React element child.");return re}};return react_production.Activity=p,react_production.Children=se,react_production.Component=E,react_production.Fragment=t,react_production.Profiler=r,react_production.PureComponent=z,react_production.StrictMode=n,react_production.Suspense=u,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=R,react_production.__COMPILER_RUNTIME={__proto__:null,c:function(re){return R.H.useMemoCache(re)}},react_production.cache=function(re){return function(){return re.apply(null,arguments)}},react_production.cacheSignal=function(){return null},react_production.cloneElement=function(re,fe,pe){if(re==null)throw Error("The argument must be a React element, but you passed "+re+".");var Z=_({},re.props),ce=re.key;if(fe!=null)for(Ee in fe.key!==void 0&&(ce=""+fe.key),fe)!I.call(fe,Ee)||Ee==="key"||Ee==="__self"||Ee==="__source"||Ee==="ref"&&fe.ref===void 0||(Z[Ee]=fe[Ee]);var Ee=arguments.length-2;if(Ee===1)Z.children=pe;else if(1<Ee){for(var Te=Array(Ee),Ae=0;Ae<Ee;Ae++)Te[Ae]=arguments[Ae+2];Z.children=Te}return w(re.type,ce,Z)},react_production.createContext=function(re){return re={$$typeof:a,_currentValue:re,_currentValue2:re,_threadCount:0,Provider:null,Consumer:null},re.Provider=re,re.Consumer={$$typeof:s,_context:re},re},react_production.createElement=function(re,fe,pe){var Z,ce={},Ee=null;if(fe!=null)for(Z in fe.key!==void 0&&(Ee=""+fe.key),fe)I.call(fe,Z)&&Z!=="key"&&Z!=="__self"&&Z!=="__source"&&(ce[Z]=fe[Z]);var Te=arguments.length-2;if(Te===1)ce.children=pe;else if(1<Te){for(var Ae=Array(Te),Pe=0;Pe<Te;Pe++)Ae[Pe]=arguments[Pe+2];ce.children=Ae}if(re&&re.defaultProps)for(Z in Te=re.defaultProps,Te)ce[Z]===void 0&&(ce[Z]=Te[Z]);return w(re,Ee,ce)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(re){return{$$typeof:l,render:re}},react_production.isValidElement=V,react_production.lazy=function(re){return{$$typeof:h,_payload:{_status:-1,_result:re},_init:oe}},react_production.memo=function(re,fe){return{$$typeof:d,type:re,compare:fe===void 0?null:fe}},react_production.startTransition=function(re){var fe=R.T,pe={};R.T=pe;try{var Z=re(),ce=R.S;ce!==null&&ce(pe,Z),typeof Z=="object"&&Z!==null&&typeof Z.then=="function"&&Z.then(G,ee)}catch(Ee){ee(Ee)}finally{fe!==null&&pe.types!==null&&(fe.types=pe.types),R.T=fe}},react_production.unstable_useCacheRefresh=function(){return R.H.useCacheRefresh()},react_production.use=function(re){return R.H.use(re)},react_production.useActionState=function(re,fe,pe){return R.H.useActionState(re,fe,pe)},react_production.useCallback=function(re,fe){return R.H.useCallback(re,fe)},react_production.useContext=function(re){return R.H.useContext(re)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(re,fe){return R.H.useDeferredValue(re,fe)},react_production.useEffect=function(re,fe){return R.H.useEffect(re,fe)},react_production.useEffectEvent=function(re){return R.H.useEffectEvent(re)},react_production.useId=function(){return R.H.useId()},react_production.useImperativeHandle=function(re,fe,pe){return R.H.useImperativeHandle(re,fe,pe)},react_production.useInsertionEffect=function(re,fe){return R.H.useInsertionEffect(re,fe)},react_production.useLayoutEffect=function(re,fe){return R.H.useLayoutEffect(re,fe)},react_production.useMemo=function(re,fe){return R.H.useMemo(re,fe)},react_production.useOptimistic=function(re,fe){return R.H.useOptimistic(re,fe)},react_production.useReducer=function(re,fe,pe){return R.H.useReducer(re,fe,pe)},react_production.useRef=function(re){return R.H.useRef(re)},react_production.useState=function(re){return R.H.useState(re)},react_production.useSyncExternalStore=function(re,fe,pe){return R.H.useSyncExternalStore(re,fe,pe)},react_production.useTransition=function(){return R.H.useTransition()},react_production.version="19.2.3",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactExports=requireReact();const React=getDefaultExportFromCjs(reactExports);var client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,(function(i){function e(le,ue){var oe=le.length;le.push(ue);e:for(;0<oe;){var ee=oe-1>>>1,se=le[ee];if(0<r(se,ue))le[ee]=ue,le[oe]=se,oe=ee;else break e}}function t(le){return le.length===0?null:le[0]}function n(le){if(le.length===0)return null;var ue=le[0],oe=le.pop();if(oe!==ue){le[0]=oe;e:for(var ee=0,se=le.length,re=se>>>1;ee<re;){var fe=2*(ee+1)-1,pe=le[fe],Z=fe+1,ce=le[Z];if(0>r(pe,oe))Z<se&&0>r(ce,pe)?(le[ee]=ce,le[Z]=oe,ee=Z):(le[ee]=pe,le[fe]=oe,ee=fe);else if(Z<se&&0>r(ce,oe))le[ee]=ce,le[Z]=oe,ee=Z;else break e}}return ue}function r(le,ue){var oe=le.sortIndex-ue.sortIndex;return oe!==0?oe:le.id-ue.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();i.unstable_now=function(){return a.now()-l}}var u=[],d=[],h=1,p=null,m=3,g=!1,v=!1,_=!1,b=!1,E=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,z=typeof setImmediate<"u"?setImmediate:null;function D(le){for(var ue=t(d);ue!==null;){if(ue.callback===null)n(d);else if(ue.startTime<=le)n(d),ue.sortIndex=ue.expirationTime,e(u,ue);else break;ue=t(d)}}function P(le){if(_=!1,D(le),!v)if(t(u)!==null)v=!0,G||(G=!0,te());else{var ue=t(d);ue!==null&&_e(P,ue.startTime-le)}}var G=!1,R=-1,I=5,w=-1;function H(){return b?!0:!(i.unstable_now()-w<I)}function V(){if(b=!1,G){var le=i.unstable_now();w=le;var ue=!0;try{e:{v=!1,_&&(_=!1,A(R),R=-1),g=!0;var oe=m;try{t:{for(D(le),p=t(u);p!==null&&!(p.expirationTime>le&&H());){var ee=p.callback;if(typeof ee=="function"){p.callback=null,m=p.priorityLevel;var se=ee(p.expirationTime<=le);if(le=i.unstable_now(),typeof se=="function"){p.callback=se,D(le),ue=!0;break t}p===t(u)&&n(u),D(le)}else n(u);p=t(u)}if(p!==null)ue=!0;else{var re=t(d);re!==null&&_e(P,re.startTime-le),ue=!1}}break e}finally{p=null,m=oe,g=!1}ue=void 0}}finally{ue?te():G=!1}}}var te;if(typeof z=="function")te=function(){z(V)};else if(typeof MessageChannel<"u"){var ae=new MessageChannel,be=ae.port2;ae.port1.onmessage=V,te=function(){be.postMessage(null)}}else te=function(){E(V,0)};function _e(le,ue){R=E(function(){le(i.unstable_now())},ue)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(le){le.callback=null},i.unstable_forceFrameRate=function(le){0>le||125<le?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<le?Math.floor(1e3/le):5},i.unstable_getCurrentPriorityLevel=function(){return m},i.unstable_next=function(le){switch(m){case 1:case 2:case 3:var ue=3;break;default:ue=m}var oe=m;m=ue;try{return le()}finally{m=oe}},i.unstable_requestPaint=function(){b=!0},i.unstable_runWithPriority=function(le,ue){switch(le){case 1:case 2:case 3:case 4:case 5:break;default:le=3}var oe=m;m=le;try{return ue()}finally{m=oe}},i.unstable_scheduleCallback=function(le,ue,oe){var ee=i.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?ee+oe:ee):oe=ee,le){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=oe+se,le={id:h++,callback:ue,priorityLevel:le,startTime:oe,expirationTime:se,sortIndex:-1},oe>ee?(le.sortIndex=oe,e(d,le),t(u)===null&&le===t(d)&&(_?(A(R),R=-1):_=!0,_e(P,oe-ee))):(le.sortIndex=se,e(u,le),v||g||(v=!0,G||(G=!0,te()))),le},i.unstable_shouldYield=H,i.unstable_wrapCallback=function(le){var ue=m;return function(){var oe=m;m=ue;try{return le.apply(this,arguments)}finally{m=oe}}}})(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var reactDom={exports:{}},reactDom_production={};var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var i=requireReact();function e(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)d+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function s(u,d,h){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:p==null?null:""+p,children:u,containerInfo:d,implementation:h}}var a=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(u,d){if(u==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,reactDom_production.createPortal=function(u,d){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return s(u,d,null,h)},reactDom_production.flushSync=function(u){var d=a.T,h=n.p;try{if(a.T=null,n.p=2,u)return u()}finally{a.T=d,n.p=h,n.d.f()}},reactDom_production.preconnect=function(u,d){typeof u=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,n.d.C(u,d))},reactDom_production.prefetchDNS=function(u){typeof u=="string"&&n.d.D(u)},reactDom_production.preinit=function(u,d){if(typeof u=="string"&&d&&typeof d.as=="string"){var h=d.as,p=l(h,d.crossOrigin),m=typeof d.integrity=="string"?d.integrity:void 0,g=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;h==="style"?n.d.S(u,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:p,integrity:m,fetchPriority:g}):h==="script"&&n.d.X(u,{crossOrigin:p,integrity:m,fetchPriority:g,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},reactDom_production.preinitModule=function(u,d){if(typeof u=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var h=l(d.as,d.crossOrigin);n.d.M(u,{crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&n.d.M(u)},reactDom_production.preload=function(u,d){if(typeof u=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var h=d.as,p=l(h,d.crossOrigin);n.d.L(u,h,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},reactDom_production.preloadModule=function(u,d){if(typeof u=="string")if(d){var h=l(d.as,d.crossOrigin);n.d.m(u,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:h,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else n.d.m(u)},reactDom_production.requestFormReset=function(u){n.d.r(u)},reactDom_production.unstable_batchedUpdates=function(u,d){return u(d)},reactDom_production.useFormState=function(u,d,h){return a.H.useFormState(u,d,h)},reactDom_production.useFormStatus=function(){return a.H.useHostTransitionStatus()},reactDom_production.version="19.2.3",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),reactDom.exports=requireReactDom_production(),reactDom.exports}var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var i=requireScheduler(),e=requireReact(),t=requireReactDom();function n(o){var c="https://react.dev/errors/"+o;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+o+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function s(o){var c=o,f=o;if(o.alternate)for(;c.return;)c=c.return;else{o=c;do c=o,(c.flags&4098)!==0&&(f=c.return),o=c.return;while(o)}return c.tag===3?f:null}function a(o){if(o.tag===13){var c=o.memoizedState;if(c===null&&(o=o.alternate,o!==null&&(c=o.memoizedState)),c!==null)return c.dehydrated}return null}function l(o){if(o.tag===31){var c=o.memoizedState;if(c===null&&(o=o.alternate,o!==null&&(c=o.memoizedState)),c!==null)return c.dehydrated}return null}function u(o){if(s(o)!==o)throw Error(n(188))}function d(o){var c=o.alternate;if(!c){if(c=s(o),c===null)throw Error(n(188));return c!==o?null:o}for(var f=o,y=c;;){var C=f.return;if(C===null)break;var W=C.alternate;if(W===null){if(y=C.return,y!==null){f=y;continue}break}if(C.child===W.child){for(W=C.child;W;){if(W===f)return u(C),o;if(W===y)return u(C),c;W=W.sibling}throw Error(n(188))}if(f.return!==y.return)f=C,y=W;else{for(var ye=!1,Re=C.child;Re;){if(Re===f){ye=!0,f=C,y=W;break}if(Re===y){ye=!0,y=C,f=W;break}Re=Re.sibling}if(!ye){for(Re=W.child;Re;){if(Re===f){ye=!0,f=W,y=C;break}if(Re===y){ye=!0,y=W,f=C;break}Re=Re.sibling}if(!ye)throw Error(n(189))}}if(f.alternate!==y)throw Error(n(190))}if(f.tag!==3)throw Error(n(188));return f.stateNode.current===f?o:c}function h(o){var c=o.tag;if(c===5||c===26||c===27||c===6)return o;for(o=o.child;o!==null;){if(c=h(o),c!==null)return c;o=o.sibling}return null}var p=Object.assign,m=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),A=Symbol.for("react.consumer"),z=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),w=Symbol.for("react.activity"),H=Symbol.for("react.memo_cache_sentinel"),V=Symbol.iterator;function te(o){return o===null||typeof o!="object"?null:(o=V&&o[V]||o["@@iterator"],typeof o=="function"?o:null)}var ae=Symbol.for("react.client.reference");function be(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===ae?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case _:return"Fragment";case E:return"Profiler";case b:return"StrictMode";case P:return"Suspense";case G:return"SuspenseList";case w:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case v:return"Portal";case z:return o.displayName||"Context";case A:return(o._context.displayName||"Context")+".Consumer";case D:var c=o.render;return o=o.displayName,o||(o=c.displayName||c.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case R:return c=o.displayName||null,c!==null?c:be(o.type)||"Memo";case I:c=o._payload,o=o._init;try{return be(o(c))}catch{}}return null}var _e=Array.isArray,le=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ue=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe={pending:!1,data:null,method:null,action:null},ee=[],se=-1;function re(o){return{current:o}}function fe(o){0>se||(o.current=ee[se],ee[se]=null,se--)}function pe(o,c){se++,ee[se]=o.current,o.current=c}var Z=re(null),ce=re(null),Ee=re(null),Te=re(null);function Ae(o,c){switch(pe(Ee,c),pe(ce,o),pe(Z,null),c.nodeType){case 9:case 11:o=(o=c.documentElement)&&(o=o.namespaceURI)?ap(o):0;break;default:if(o=c.tagName,c=c.namespaceURI)c=ap(c),o=op(c,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}fe(Z),pe(Z,o)}function Pe(){fe(Z),fe(ce),fe(Ee)}function Me(o){o.memoizedState!==null&&pe(Te,o);var c=Z.current,f=op(c,o.type);c!==f&&(pe(ce,o),pe(Z,f))}function We(o){ce.current===o&&(fe(Z),fe(ce)),Te.current===o&&(fe(Te),uc._currentValue=oe)}var qe,Je;function wt(o){if(qe===void 0)try{throw Error()}catch(f){var c=f.stack.trim().match(/\n( *(at )?)/);qe=c&&c[1]||"",Je=-1<f.stack.indexOf(`
    at`)?" (<anonymous>)":-1<f.stack.indexOf("@")?"@unknown:0:0":""}return`
`+qe+o+Je}var rt=!1;function Lt(o,c){if(!o||rt)return"";rt=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var y={DetermineComponentFrameRoot:function(){try{if(c){var gn=function(){throw Error()};if(Object.defineProperty(gn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(gn,[])}catch($t){var kt=$t}Reflect.construct(o,[],gn)}else{try{gn.call()}catch($t){kt=$t}o.call(gn.prototype)}}else{try{throw Error()}catch($t){kt=$t}(gn=o())&&typeof gn.catch=="function"&&gn.catch(function(){})}}catch($t){if($t&&kt&&typeof $t.stack=="string")return[$t.stack,kt.stack]}return[null,null]}};y.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var C=Object.getOwnPropertyDescriptor(y.DetermineComponentFrameRoot,"name");C&&C.configurable&&Object.defineProperty(y.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var W=y.DetermineComponentFrameRoot(),ye=W[0],Re=W[1];if(ye&&Re){var He=ye.split(`
`),At=Re.split(`
`);for(C=y=0;y<He.length&&!He[y].includes("DetermineComponentFrameRoot");)y++;for(;C<At.length&&!At[C].includes("DetermineComponentFrameRoot");)C++;if(y===He.length||C===At.length)for(y=He.length-1,C=At.length-1;1<=y&&0<=C&&He[y]!==At[C];)C--;for(;1<=y&&0<=C;y--,C--)if(He[y]!==At[C]){if(y!==1||C!==1)do if(y--,C--,0>C||He[y]!==At[C]){var Qt=`
`+He[y].replace(" at new "," at ");return o.displayName&&Qt.includes("<anonymous>")&&(Qt=Qt.replace("<anonymous>",o.displayName)),Qt}while(1<=y&&0<=C);break}}}finally{rt=!1,Error.prepareStackTrace=f}return(f=o?o.displayName||o.name:"")?wt(f):""}function ln(o,c){switch(o.tag){case 26:case 27:case 5:return wt(o.type);case 16:return wt("Lazy");case 13:return o.child!==c&&c!==null?wt("Suspense Fallback"):wt("Suspense");case 19:return wt("SuspenseList");case 0:case 15:return Lt(o.type,!1);case 11:return Lt(o.type.render,!1);case 1:return Lt(o.type,!0);case 31:return wt("Activity");default:return""}}function dt(o){try{var c="",f=null;do c+=ln(o,f),f=o,o=o.return;while(o);return c}catch(y){return`
Error generating stack: `+y.message+`
`+y.stack}}var st=Object.prototype.hasOwnProperty,nt=i.unstable_scheduleCallback,dn=i.unstable_cancelCallback,pn=i.unstable_shouldYield,An=i.unstable_requestPaint,In=i.unstable_now,Jn=i.unstable_getCurrentPriorityLevel,ri=i.unstable_ImmediatePriority,Wn=i.unstable_UserBlockingPriority,hi=i.unstable_NormalPriority,ai=i.unstable_LowPriority,Zn=i.unstable_IdlePriority,Ft=i.log,Xe=i.unstable_setDisableYieldValue,Ye=null,xn=null;function Vn(o){if(typeof Ft=="function"&&Xe(o),xn&&typeof xn.setStrictMode=="function")try{xn.setStrictMode(Ye,o)}catch{}}var Bn=Math.clz32?Math.clz32:ei,si=Math.log,Yi=Math.LN2;function ei(o){return o>>>=0,o===0?32:31-(si(o)/Yi|0)|0}var oi=256,Li=262144,xe=4194304;function Ce(o){var c=o&42;if(c!==0)return c;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return o&261888;case 262144:case 524288:case 1048576:case 2097152:return o&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function Fe(o,c,f){var y=o.pendingLanes;if(y===0)return 0;var C=0,W=o.suspendedLanes,ye=o.pingedLanes;o=o.warmLanes;var Re=y&134217727;return Re!==0?(y=Re&~W,y!==0?C=Ce(y):(ye&=Re,ye!==0?C=Ce(ye):f||(f=Re&~o,f!==0&&(C=Ce(f))))):(Re=y&~W,Re!==0?C=Ce(Re):ye!==0?C=Ce(ye):f||(f=y&~o,f!==0&&(C=Ce(f)))),C===0?0:c!==0&&c!==C&&(c&W)===0&&(W=C&-C,f=c&-c,W>=f||W===32&&(f&4194048)!==0)?c:C}function tt(o,c){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&c)===0}function Tn(o,c){switch(o){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function jn(){var o=xe;return xe<<=1,(xe&62914560)===0&&(xe=4194304),o}function li(o){for(var c=[],f=0;31>f;f++)c.push(o);return c}function Fi(o,c){o.pendingLanes|=c,c!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function Qi(o,c,f,y,C,W){var ye=o.pendingLanes;o.pendingLanes=f,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=f,o.entangledLanes&=f,o.errorRecoveryDisabledLanes&=f,o.shellSuspendCounter=0;var Re=o.entanglements,He=o.expirationTimes,At=o.hiddenUpdates;for(f=ye&~f;0<f;){var Qt=31-Bn(f),gn=1<<Qt;Re[Qt]=0,He[Qt]=-1;var kt=At[Qt];if(kt!==null)for(At[Qt]=null,Qt=0;Qt<kt.length;Qt++){var $t=kt[Qt];$t!==null&&($t.lane&=-536870913)}f&=~gn}y!==0&&Di(o,y,0),W!==0&&C===0&&o.tag!==0&&(o.suspendedLanes|=W&~(ye&~c))}function Di(o,c,f){o.pendingLanes|=c,o.suspendedLanes&=~c;var y=31-Bn(c);o.entangledLanes|=c,o.entanglements[y]=o.entanglements[y]|1073741824|f&261930}function nr(o,c){var f=o.entangledLanes|=c;for(o=o.entanglements;f;){var y=31-Bn(f),C=1<<y;C&c|o[y]&c&&(o[y]|=c),f&=~C}}function gr(o,c){var f=c&-c;return f=(f&42)!==0?1:br(f),(f&(o.suspendedLanes|c))!==0?0:f}function br(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function Vi(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function $r(){var o=ue.p;return o!==0?o:(o=window.event,o===void 0?32:Ip(o.type))}function wr(o,c){var f=ue.p;try{return ue.p=o,c()}finally{ue.p=f}}var Er=Math.random().toString(36).slice(2),ci="__reactFiber$"+Er,ir="__reactProps$"+Er,fi="__reactContainer$"+Er,Bs="__reactEvents$"+Er,Ra="__reactListeners$"+Er,ua="__reactHandles$"+Er,yo="__reactResources$"+Er,Vr="__reactMarker$"+Er;function Ui(o){delete o[ci],delete o[ir],delete o[Bs],delete o[Ra],delete o[ua]}function fs(o){var c=o[ci];if(c)return c;for(var f=o.parentNode;f;){if(c=f[fi]||f[ci]){if(f=c.alternate,c.child!==null||f!==null&&f.child!==null)for(o=pp(o);o!==null;){if(f=o[ci])return f;o=pp(o)}return c}o=f,f=o.parentNode}return null}function Gr(o){if(o=o[ci]||o[fi]){var c=o.tag;if(c===5||c===6||c===13||c===31||c===26||c===27||c===3)return o}return null}function ts(o){var c=o.tag;if(c===5||c===26||c===27||c===6)return o.stateNode;throw Error(n(33))}function Ts(o){var c=o[yo];return c||(c=o[yo]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function lr(o){o[Vr]=!0}var Pa=new Set,da={};function os(o,c){ps(o,c),ps(o+"Capture",c)}function ps(o,c){for(da[o]=c,o=0;o<c.length;o++)Pa.add(c[o])}var Ya=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qa={},ms={};function ea(o){return st.call(ms,o)?!0:st.call(Qa,o)?!1:Ya.test(o)?ms[o]=!0:(Qa[o]=!0,!1)}function ta(o,c,f){if(ea(c))if(f===null)o.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":o.removeAttribute(c);return;case"boolean":var y=c.toLowerCase().slice(0,5);if(y!=="data-"&&y!=="aria-"){o.removeAttribute(c);return}}o.setAttribute(c,""+f)}}function Nr(o,c,f){if(f===null)o.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(c);return}o.setAttribute(c,""+f)}}function qi(o,c,f,y){if(y===null)o.removeAttribute(f);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(f);return}o.setAttributeNS(c,f,""+y)}}function fr(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function ls(o){var c=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Ja(o,c,f){var y=Object.getOwnPropertyDescriptor(o.constructor.prototype,c);if(!o.hasOwnProperty(c)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var C=y.get,W=y.set;return Object.defineProperty(o,c,{configurable:!0,get:function(){return C.call(this)},set:function(ye){f=""+ye,W.call(this,ye)}}),Object.defineProperty(o,c,{enumerable:y.enumerable}),{getValue:function(){return f},setValue:function(ye){f=""+ye},stopTracking:function(){o._valueTracker=null,delete o[c]}}}}function ki(o){if(!o._valueTracker){var c=ls(o)?"checked":"value";o._valueTracker=Ja(o,c,""+o[c])}}function ha(o){if(!o)return!1;var c=o._valueTracker;if(!c)return!0;var f=c.getValue(),y="";return o&&(y=ls(o)?o.checked?"true":"false":o.value),o=y,o!==f?(c.setValue(o),!0):!1}function xs(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var Wr=/[\n"\\]/g;function Cr(o){return o.replace(Wr,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function Ia(o,c,f,y,C,W,ye,Re){o.name="",ye!=null&&typeof ye!="function"&&typeof ye!="symbol"&&typeof ye!="boolean"?o.type=ye:o.removeAttribute("type"),c!=null?ye==="number"?(c===0&&o.value===""||o.value!=c)&&(o.value=""+fr(c)):o.value!==""+fr(c)&&(o.value=""+fr(c)):ye!=="submit"&&ye!=="reset"||o.removeAttribute("value"),c!=null?js(o,ye,fr(c)):f!=null?js(o,ye,fr(f)):y!=null&&o.removeAttribute("value"),C==null&&W!=null&&(o.defaultChecked=!!W),C!=null&&(o.checked=C&&typeof C!="function"&&typeof C!="symbol"),Re!=null&&typeof Re!="function"&&typeof Re!="symbol"&&typeof Re!="boolean"?o.name=""+fr(Re):o.removeAttribute("name")}function Da(o,c,f,y,C,W,ye,Re){if(W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"&&(o.type=W),c!=null||f!=null){if(!(W!=="submit"&&W!=="reset"||c!=null)){ki(o);return}f=f!=null?""+fr(f):"",c=c!=null?""+fr(c):f,Re||c===o.value||(o.value=c),o.defaultValue=c}y=y??C,y=typeof y!="function"&&typeof y!="symbol"&&!!y,o.checked=Re?o.checked:!!y,o.defaultChecked=!!y,ye!=null&&typeof ye!="function"&&typeof ye!="symbol"&&typeof ye!="boolean"&&(o.name=ye),ki(o)}function js(o,c,f){c==="number"&&xs(o.ownerDocument)===o||o.defaultValue===""+f||(o.defaultValue=""+f)}function Rr(o,c,f,y){if(o=o.options,c){c={};for(var C=0;C<f.length;C++)c["$"+f[C]]=!0;for(f=0;f<o.length;f++)C=c.hasOwnProperty("$"+o[f].value),o[f].selected!==C&&(o[f].selected=C),C&&y&&(o[f].defaultSelected=!0)}else{for(f=""+fr(f),c=null,C=0;C<o.length;C++){if(o[C].value===f){o[C].selected=!0,y&&(o[C].defaultSelected=!0);return}c!==null||o[C].disabled||(c=o[C])}c!==null&&(c.selected=!0)}}function Za(o,c,f){if(c!=null&&(c=""+fr(c),c!==o.value&&(o.value=c),f==null)){o.defaultValue!==c&&(o.defaultValue=c);return}o.defaultValue=f!=null?""+fr(f):""}function cs(o,c,f,y){if(c==null){if(y!=null){if(f!=null)throw Error(n(92));if(_e(y)){if(1<y.length)throw Error(n(93));y=y[0]}f=y}f==null&&(f=""),c=f}f=fr(c),o.defaultValue=f,y=o.textContent,y===f&&y!==""&&y!==null&&(o.value=y),ki(o)}function Pr(o,c){if(c){var f=o.firstChild;if(f&&f===o.lastChild&&f.nodeType===3){f.nodeValue=c;return}}o.textContent=c}var Us=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ss(o,c,f){var y=c.indexOf("--")===0;f==null||typeof f=="boolean"||f===""?y?o.setProperty(c,""):c==="float"?o.cssFloat="":o[c]="":y?o.setProperty(c,f):typeof f!="number"||f===0||Us.has(c)?c==="float"?o.cssFloat=f:o[c]=(""+f).trim():o[c]=f+"px"}function fa(o,c,f){if(c!=null&&typeof c!="object")throw Error(n(62));if(o=o.style,f!=null){for(var y in f)!f.hasOwnProperty(y)||c!=null&&c.hasOwnProperty(y)||(y.indexOf("--")===0?o.setProperty(y,""):y==="float"?o.cssFloat="":o[y]="");for(var C in c)y=c[C],c.hasOwnProperty(C)&&f[C]!==y&&Ss(o,C,y)}else for(var W in c)c.hasOwnProperty(W)&&Ss(o,W,c[W])}function us(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ka=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Hs=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ma(o){return Hs.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}function Qr(){}var As=null;function ns(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var qs=null,ds=null;function zs(o){var c=Gr(o);if(c&&(o=c.stateNode)){var f=o[ir]||null;e:switch(o=c.stateNode,c.type){case"input":if(Ia(o,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name),c=f.name,f.type==="radio"&&c!=null){for(f=o;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll('input[name="'+Cr(""+c)+'"][type="radio"]'),c=0;c<f.length;c++){var y=f[c];if(y!==o&&y.form===o.form){var C=y[ir]||null;if(!C)throw Error(n(90));Ia(y,C.value,C.defaultValue,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name)}}for(c=0;c<f.length;c++)y=f[c],y.form===o.form&&ha(y)}break e;case"textarea":Za(o,f.value,f.defaultValue);break e;case"select":c=f.value,c!=null&&Rr(o,!!f.multiple,c,!1)}}}var pa=!1;function na(o,c,f){if(pa)return o(c,f);pa=!0;try{var y=o(c);return y}finally{if(pa=!1,(qs!==null||ds!==null)&&(zc(),qs&&(c=qs,o=ds,ds=qs=null,zs(c),o)))for(c=0;c<o.length;c++)zs(o[c])}}function Jr(o,c){var f=o.stateNode;if(f===null)return null;var y=f[ir]||null;if(y===null)return null;f=y[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(o=o.type,y=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!y;break e;default:o=!1}if(o)return null;if(f&&typeof f!="function")throw Error(n(231,c,typeof f));return f}var me=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Se=!1;if(me)try{var De={};Object.defineProperty(De,"passive",{get:function(){Se=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch{Se=!1}var Le=null,Be=null,je=null;function Ze(){if(je)return je;var o,c=Be,f=c.length,y,C="value"in Le?Le.value:Le.textContent,W=C.length;for(o=0;o<f&&c[o]===C[o];o++);var ye=f-o;for(y=1;y<=ye&&c[f-y]===C[W-y];y++);return je=C.slice(o,1<y?1-y:void 0)}function Ge(o){var c=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&c===13&&(o=13)):o=c,o===10&&(o=13),32<=o||o===13?o:0}function Oe(){return!0}function Ke(){return!1}function $e(o){function c(f,y,C,W,ye){this._reactName=f,this._targetInst=C,this.type=y,this.nativeEvent=W,this.target=ye,this.currentTarget=null;for(var Re in o)o.hasOwnProperty(Re)&&(f=o[Re],this[Re]=f?f(W):W[Re]);return this.isDefaultPrevented=(W.defaultPrevented!=null?W.defaultPrevented:W.returnValue===!1)?Oe:Ke,this.isPropagationStopped=Ke,this}return p(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=Oe)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=Oe)},persist:function(){},isPersistent:Oe}),c}var Gt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zt=$e(Gt),qt=p({},Gt,{view:0,detail:0}),En=$e(qt),vn,mn,qn,Nn=p({},qt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bi,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==qn&&(qn&&o.type==="mousemove"?(vn=o.screenX-qn.screenX,mn=o.screenY-qn.screenY):mn=vn=0,qn=o),vn)},movementY:function(o){return"movementY"in o?o.movementY:mn}}),On=$e(Nn),Un=p({},Nn,{dataTransfer:0}),Dn=$e(Un),Gn=p({},qt,{relatedTarget:0}),Ln=$e(Gn),pi=p({},Gt,{animationName:0,elapsedTime:0,pseudoElement:0}),ui=$e(pi),mi=p({},Gt,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),ni=$e(mi),di=p({},Gt,{data:0}),Ci=$e(di),Oi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Wi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xi(o){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(o):(o=Wi[o])?!!c[o]:!1}function Bi(){return Xi}var vi=p({},qt,{key:function(o){if(o.key){var c=Oi[o.key]||o.key;if(c!=="Unidentified")return c}return o.type==="keypress"?(o=Ge(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?rr[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bi,charCode:function(o){return o.type==="keypress"?Ge(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?Ge(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),_r=$e(vi),Br=p({},Nn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cr=$e(Br),T=p({},qt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bi}),de=$e(T),ve=p({},Gt,{propertyName:0,elapsedTime:0,pseudoElement:0}),we=$e(ve),Ue=p({},Nn,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),ze=$e(Ue),Mt=p({},Gt,{newState:0,oldState:0}),yn=$e(Mt),kn=[9,13,27,32],Cn=me&&"CompositionEvent"in window,wn=null;me&&"documentMode"in document&&(wn=document.documentMode);var Sn=me&&"TextEvent"in window&&!wn,zn=me&&(!Cn||wn&&8<wn&&11>=wn),Kn=" ",bi=!1;function Ti(o,c){switch(o){case"keyup":return kn.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ur(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Ir=!1;function ti(o,c){switch(o){case"compositionend":return ur(c);case"keypress":return c.which!==32?null:(bi=!0,Kn);case"textInput":return o=c.data,o===Kn&&bi?null:o;default:return null}}function Tr(o,c){if(Ir)return o==="compositionend"||!Cn&&Ti(o,c)?(o=Ze(),je=Be=Le=null,Ir=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return zn&&c.locale!=="ko"?null:c.data;default:return null}}var zi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hi(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c==="input"?!!zi[o.type]:c==="textarea"}function yr(o,c,f,y){qs?ds?ds.push(y):ds=[y]:qs=y,c=Qc(c,"onChange"),0<c.length&&(f=new zt("onChange","change",null,f,y),o.push({event:f,listeners:c}))}var Ai=null,is=null;function Na(o){ep(o,0)}function ia(o){var c=ts(o);if(ha(c))return o}function $s(o,c){if(o==="change")return c}var ma=!1;if(me){var Ho;if(me){var Kr="oninput"in document;if(!Kr){var La=document.createElement("div");La.setAttribute("oninput","return;"),Kr=typeof La.oninput=="function"}Ho=Kr}else Ho=!1;ma=Ho&&(!document.documentMode||9<document.documentMode)}function ol(){Ai&&(Ai.detachEvent("onpropertychange",ji),is=Ai=null)}function ji(o){if(o.propertyName==="value"&&ia(is)){var c=[];yr(c,is,o,ns(o)),na(Na,c)}}function Ml(o,c,f){o==="focusin"?(ol(),Ai=c,is=f,Ai.attachEvent("onpropertychange",ji)):o==="focusout"&&ol()}function ra(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return ia(is)}function ll(o,c){if(o==="click")return ia(c)}function Nl(o,c){if(o==="input"||o==="change")return ia(c)}function eo(o,c){return o===c&&(o!==0||1/o===1/c)||o!==o&&c!==c}var jr=typeof Object.is=="function"?Object.is:eo;function Gs(o,c){if(jr(o,c))return!0;if(typeof o!="object"||o===null||typeof c!="object"||c===null)return!1;var f=Object.keys(o),y=Object.keys(c);if(f.length!==y.length)return!1;for(y=0;y<f.length;y++){var C=f[y];if(!st.call(c,C)||!jr(o[C],c[C]))return!1}return!0}function Oa(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function pr(o,c){var f=Oa(o);o=0;for(var y;f;){if(f.nodeType===3){if(y=o+f.textContent.length,o<=c&&y>=c)return{node:f,offset:c-o};o=y}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=Oa(f)}}function ga(o,c){return o&&c?o===c?!0:o&&o.nodeType===3?!1:c&&c.nodeType===3?ga(o,c.parentNode):"contains"in o?o.contains(c):o.compareDocumentPosition?!!(o.compareDocumentPosition(c)&16):!1:!1}function gs(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var c=xs(o.document);c instanceof o.HTMLIFrameElement;){try{var f=typeof c.contentWindow.location.href=="string"}catch{f=!1}if(f)o=c.contentWindow;else break;c=xs(o.document)}return c}function qo(o){var c=o&&o.nodeName&&o.nodeName.toLowerCase();return c&&(c==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||c==="textarea"||o.contentEditable==="true")}var cl=me&&"documentMode"in document&&11>=document.documentMode,_a=null,to=null,ya=null,no=!1;function Ws(o,c,f){var y=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;no||_a==null||_a!==xs(y)||(y=_a,"selectionStart"in y&&qo(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),ya&&Gs(ya,y)||(ya=y,y=Qc(to,"onSelect"),0<y.length&&(c=new zt("onSelect","select",null,c,f),o.push({event:c,listeners:y}),c.target=_a)))}function sa(o,c){var f={};return f[o.toLowerCase()]=c.toLowerCase(),f["Webkit"+o]="webkit"+c,f["Moz"+o]="moz"+c,f}var va={animationend:sa("Animation","AnimationEnd"),animationiteration:sa("Animation","AnimationIteration"),animationstart:sa("Animation","AnimationStart"),transitionrun:sa("Transition","TransitionRun"),transitionstart:sa("Transition","TransitionStart"),transitioncancel:sa("Transition","TransitionCancel"),transitionend:sa("Transition","TransitionEnd")},ba={},io={};me&&(io=document.createElement("div").style,"AnimationEvent"in window||(delete va.animationend.animation,delete va.animationiteration.animation,delete va.animationstart.animation),"TransitionEvent"in window||delete va.transitionend.transition);function _s(o){if(ba[o])return ba[o];if(!va[o])return o;var c=va[o],f;for(f in c)if(c.hasOwnProperty(f)&&f in io)return ba[o]=c[f];return o}var zo=_s("animationend"),Fa=_s("animationiteration"),vo=_s("animationstart"),ul=_s("transitionrun"),dl=_s("transitionstart"),hl=_s("transitioncancel"),bn=_s("transitionend"),Xn=new Map,_i="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");_i.push("scrollEnd");function gi(o,c){Xn.set(o,c),os(c,[o])}var Ei=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)},Yn=[],Ji=0,ws=0;function Va(){for(var o=Ji,c=ws=Ji=0;c<o;){var f=Yn[c];Yn[c++]=null;var y=Yn[c];Yn[c++]=null;var C=Yn[c];Yn[c++]=null;var W=Yn[c];if(Yn[c++]=null,y!==null&&C!==null){var ye=y.pending;ye===null?C.next=C:(C.next=ye.next,ye.next=C),y.pending=C}W!==0&&$o(f,C,W)}}function Ea(o,c,f,y){Yn[Ji++]=o,Yn[Ji++]=c,Yn[Ji++]=f,Yn[Ji++]=y,ws|=y,o.lanes|=y,o=o.alternate,o!==null&&(o.lanes|=y)}function Cs(o,c,f,y){return Ea(o,c,f,y),Ta(o)}function Rs(o,c){return Ea(o,null,null,c),Ta(o)}function $o(o,c,f){o.lanes|=f;var y=o.alternate;y!==null&&(y.lanes|=f);for(var C=!1,W=o.return;W!==null;)W.childLanes|=f,y=W.alternate,y!==null&&(y.childLanes|=f),W.tag===22&&(o=W.stateNode,o===null||o._visibility&1||(C=!0)),o=W,W=W.return;return o.tag===3?(W=o.stateNode,C&&c!==null&&(C=31-Bn(f),o=W.hiddenUpdates,y=o[C],y===null?o[C]=[c]:y.push(c),c.lane=f|536870912),W):null}function Ta(o){if(50<ic)throw ic=0,hd=null,Error(n(185));for(var c=o.return;c!==null;)o=c,c=o.return;return o.tag===3?o.stateNode:null}var ys={};function mu(o,c,f,y){this.tag=o,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dr(o,c,f,y){return new mu(o,c,f,y)}function Ll(o){return o=o.prototype,!(!o||!o.isReactComponent)}function xa(o,c){var f=o.alternate;return f===null?(f=Dr(o.tag,c,o.key,o.mode),f.elementType=o.elementType,f.type=o.type,f.stateNode=o.stateNode,f.alternate=o,o.alternate=f):(f.pendingProps=c,f.type=o.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=o.flags&65011712,f.childLanes=o.childLanes,f.lanes=o.lanes,f.child=o.child,f.memoizedProps=o.memoizedProps,f.memoizedState=o.memoizedState,f.updateQueue=o.updateQueue,c=o.dependencies,f.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},f.sibling=o.sibling,f.index=o.index,f.ref=o.ref,f.refCleanup=o.refCleanup,f}function mc(o,c){o.flags&=65011714;var f=o.alternate;return f===null?(o.childLanes=0,o.lanes=c,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=f.childLanes,o.lanes=f.lanes,o.child=f.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=f.memoizedProps,o.memoizedState=f.memoizedState,o.updateQueue=f.updateQueue,o.type=f.type,c=f.dependencies,o.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),o}function Ol(o,c,f,y,C,W){var ye=0;if(y=o,typeof o=="function")Ll(o)&&(ye=1);else if(typeof o=="string")ye=Hm(o,f,Z.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case w:return o=Dr(31,f,c,C),o.elementType=w,o.lanes=W,o;case _:return Ba(f.children,C,W,c);case b:ye=8,C|=24;break;case E:return o=Dr(12,f,c,C|2),o.elementType=E,o.lanes=W,o;case P:return o=Dr(13,f,c,C),o.elementType=P,o.lanes=W,o;case G:return o=Dr(19,f,c,C),o.elementType=G,o.lanes=W,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case z:ye=10;break e;case A:ye=9;break e;case D:ye=11;break e;case R:ye=14;break e;case I:ye=16,y=null;break e}ye=29,f=Error(n(130,o===null?"null":typeof o,"")),y=null}return c=Dr(ye,f,c,C),c.elementType=o,c.type=y,c.lanes=W,c}function Ba(o,c,f,y){return o=Dr(7,o,y,c),o.lanes=f,o}function Go(o,c,f){return o=Dr(6,o,null,c),o.lanes=f,o}function Fl(o){var c=Dr(18,null,null,0);return c.stateNode=o,c}function bo(o,c,f){return c=Dr(4,o.children!==null?o.children:[],o.key,c),c.lanes=f,c.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},c}var Wo=new WeakMap;function Ps(o,c){if(typeof o=="object"&&o!==null){var f=Wo.get(o);return f!==void 0?f:(c={value:o,source:c,stack:dt(c)},Wo.set(o,c),c)}return{value:o,source:c,stack:dt(c)}}var Eo=[],To=0,fl=null,Ko=0,hs=[],Is=0,ja=null,Ks=1,rs="";function wi(o,c){Eo[To++]=Ko,Eo[To++]=fl,fl=o,Ko=c}function Ua(o,c,f){hs[Is++]=Ks,hs[Is++]=rs,hs[Is++]=ja,ja=o;var y=Ks;o=rs;var C=32-Bn(y)-1;y&=~(1<<C),f+=1;var W=32-Bn(c)+C;if(30<W){var ye=C-C%5;W=(y&(1<<ye)-1).toString(32),y>>=ye,C-=ye,Ks=1<<32-Bn(c)+C|f<<C|y,rs=W+o}else Ks=1<<W|f<<C|y,rs=o}function Xr(o){o.return!==null&&(wi(o,1),Ua(o,1,0))}function Ds(o){for(;o===fl;)fl=Eo[--To],Eo[To]=null,Ko=Eo[--To],Eo[To]=null;for(;o===ja;)ja=hs[--Is],hs[Is]=null,rs=hs[--Is],hs[Is]=null,Ks=hs[--Is],hs[Is]=null}function gc(o,c){hs[Is++]=Ks,hs[Is++]=rs,hs[Is++]=ja,Ks=c.id,rs=c.overflow,ja=o}var Ur=null,dr=null,Ri=!1,Ha=null,ks=!1,Vl=Error(n(519));function qa(o){var c=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ne(Ps(c,o)),Vl}function _c(o){var c=o.stateNode,f=o.type,y=o.memoizedProps;switch(c[ci]=o,c[ir]=y,f){case"dialog":Ii("cancel",c),Ii("close",c);break;case"iframe":case"object":case"embed":Ii("load",c);break;case"video":case"audio":for(f=0;f<sc.length;f++)Ii(sc[f],c);break;case"source":Ii("error",c);break;case"img":case"image":case"link":Ii("error",c),Ii("load",c);break;case"details":Ii("toggle",c);break;case"input":Ii("invalid",c),Da(c,y.value,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name,!0);break;case"select":Ii("invalid",c);break;case"textarea":Ii("invalid",c),cs(c,y.value,y.defaultValue,y.children)}f=y.children,typeof f!="string"&&typeof f!="number"&&typeof f!="bigint"||c.textContent===""+f||y.suppressHydrationWarning===!0||rp(c.textContent,f)?(y.popover!=null&&(Ii("beforetoggle",c),Ii("toggle",c)),y.onScroll!=null&&Ii("scroll",c),y.onScrollEnd!=null&&Ii("scrollend",c),y.onClick!=null&&(c.onclick=Qr),c=!0):c=!1,c||qa(o,!0)}function Bl(o){for(Ur=o.return;Ur;)switch(Ur.tag){case 5:case 31:case 13:ks=!1;return;case 27:case 3:ks=!0;return;default:Ur=Ur.return}}function S(o){if(o!==Ur)return!1;if(!Ri)return Bl(o),Ri=!0,!1;var c=o.tag,f;if((f=c!==3&&c!==27)&&((f=c===5)&&(f=o.type,f=!(f!=="form"&&f!=="button")||Cd(o.type,o.memoizedProps)),f=!f),f&&dr&&qa(o),Bl(o),c===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));dr=fp(o)}else if(c===31){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));dr=fp(o)}else c===27?(c=dr,Lo(o.type)?(o=kd,kd=null,dr=o):dr=c):dr=Ur?la(o.stateNode.nextSibling):null;return!0}function Y(){dr=Ur=null,Ri=!1}function ie(){var o=Ha;return o!==null&&(Os===null?Os=o:Os.push.apply(Os,o),Ha=null),o}function ne(o){Ha===null?Ha=[o]:Ha.push(o)}var he=re(null),ge=null,Ie=null;function ke(o,c,f){pe(he,c._currentValue),c._currentValue=f}function Ne(o){o._currentValue=he.current,fe(he)}function Ve(o,c,f){for(;o!==null;){var y=o.alternate;if((o.childLanes&c)!==c?(o.childLanes|=c,y!==null&&(y.childLanes|=c)):y!==null&&(y.childLanes&c)!==c&&(y.childLanes|=c),o===f)break;o=o.return}}function et(o,c,f,y){var C=o.child;for(C!==null&&(C.return=o);C!==null;){var W=C.dependencies;if(W!==null){var ye=C.child;W=W.firstContext;e:for(;W!==null;){var Re=W;W=C;for(var He=0;He<c.length;He++)if(Re.context===c[He]){W.lanes|=f,Re=W.alternate,Re!==null&&(Re.lanes|=f),Ve(W.return,f,o),y||(ye=null);break e}W=Re.next}}else if(C.tag===18){if(ye=C.return,ye===null)throw Error(n(341));ye.lanes|=f,W=ye.alternate,W!==null&&(W.lanes|=f),Ve(ye,f,o),ye=null}else ye=C.child;if(ye!==null)ye.return=C;else for(ye=C;ye!==null;){if(ye===o){ye=null;break}if(C=ye.sibling,C!==null){C.return=ye.return,ye=C;break}ye=ye.return}C=ye}}function jt(o,c,f,y){o=null;for(var C=c,W=!1;C!==null;){if(!W){if((C.flags&524288)!==0)W=!0;else if((C.flags&262144)!==0)break}if(C.tag===10){var ye=C.alternate;if(ye===null)throw Error(n(387));if(ye=ye.memoizedProps,ye!==null){var Re=C.type;jr(C.pendingProps.value,ye.value)||(o!==null?o.push(Re):o=[Re])}}else if(C===Te.current){if(ye=C.alternate,ye===null)throw Error(n(387));ye.memoizedState.memoizedState!==C.memoizedState.memoizedState&&(o!==null?o.push(uc):o=[uc])}C=C.return}o!==null&&et(c,o,f,y),c.flags|=262144}function Rn(o){for(o=o.firstContext;o!==null;){if(!jr(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Wt(o){ge=o,Ie=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function Mn(o){return Lr(ge,o)}function yi(o,c){return ge===null&&Wt(o),Lr(o,c)}function Lr(o,c){var f=c._currentValue;if(c={context:c,memoizedValue:f,next:null},Ie===null){if(o===null)throw Error(n(308));Ie=c,o.dependencies={lanes:0,firstContext:c},o.flags|=524288}else Ie=Ie.next=c;return f}var vs=typeof AbortController<"u"?AbortController:function(){var o=[],c=this.signal={aborted:!1,addEventListener:function(f,y){o.push(y)}};this.abort=function(){c.aborted=!0,o.forEach(function(f){return f()})}},za=i.unstable_scheduleCallback,Xo=i.unstable_NormalPriority,mr={$$typeof:z,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ro(){return{controller:new vs,data:new Map,refCount:0}}function Sa(o){o.refCount--,o.refCount===0&&za(Xo,function(){o.controller.abort()})}var $a=null,Zi=0,aa=0,Zr=null;function Up(o,c){if($a===null){var f=$a=[];Zi=0,aa=yd(),Zr={status:"pending",value:void 0,then:function(y){f.push(y)}}}return Zi++,c.then(qd,qd),c}function qd(){if(--Zi===0&&$a!==null){Zr!==null&&(Zr.status="fulfilled");var o=$a;$a=null,aa=0,Zr=null;for(var c=0;c<o.length;c++)(0,o[c])()}}function Hp(o,c){var f=[],y={status:"pending",value:null,reason:null,then:function(C){f.push(C)}};return o.then(function(){y.status="fulfilled",y.value=c;for(var C=0;C<f.length;C++)(0,f[C])(c)},function(C){for(y.status="rejected",y.reason=C,C=0;C<f.length;C++)(0,f[C])(void 0)}),y}var zd=le.S;le.S=function(o,c){Rf=In(),typeof c=="object"&&c!==null&&typeof c.then=="function"&&Up(o,c),zd!==null&&zd(o,c)};var Yo=re(null);function gu(){var o=Yo.current;return o!==null?o:hr.pooledCache}function yc(o,c){c===null?pe(Yo,Yo.current):pe(Yo,c.pool)}function $d(){var o=gu();return o===null?null:{parent:mr._currentValue,pool:o}}var pl=Error(n(460)),_u=Error(n(474)),vc=Error(n(542)),bc={then:function(){}};function Gd(o){return o=o.status,o==="fulfilled"||o==="rejected"}function Wd(o,c,f){switch(f=o[f],f===void 0?o.push(c):f!==c&&(c.then(Qr,Qr),c=f),c.status){case"fulfilled":return c.value;case"rejected":throw o=c.reason,Xd(o),o;default:if(typeof c.status=="string")c.then(Qr,Qr);else{if(o=hr,o!==null&&100<o.shellSuspendCounter)throw Error(n(482));o=c,o.status="pending",o.then(function(y){if(c.status==="pending"){var C=c;C.status="fulfilled",C.value=y}},function(y){if(c.status==="pending"){var C=c;C.status="rejected",C.reason=y}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw o=c.reason,Xd(o),o}throw Jo=c,pl}}function Qo(o){try{var c=o._init;return c(o._payload)}catch(f){throw f!==null&&typeof f=="object"&&typeof f.then=="function"?(Jo=f,pl):f}}var Jo=null;function Kd(){if(Jo===null)throw Error(n(459));var o=Jo;return Jo=null,o}function Xd(o){if(o===pl||o===vc)throw Error(n(483))}var ml=null,jl=0;function Ec(o){var c=jl;return jl+=1,ml===null&&(ml=[]),Wd(ml,o,c)}function Ul(o,c){c=c.props.ref,o.ref=c!==void 0?c:null}function Tc(o,c){throw c.$$typeof===m?Error(n(525)):(o=Object.prototype.toString.call(c),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":o)))}function Yd(o){function c(it,Qe){if(o){var vt=it.deletions;vt===null?(it.deletions=[Qe],it.flags|=16):vt.push(Qe)}}function f(it,Qe){if(!o)return null;for(;Qe!==null;)c(it,Qe),Qe=Qe.sibling;return null}function y(it){for(var Qe=new Map;it!==null;)it.key!==null?Qe.set(it.key,it):Qe.set(it.index,it),it=it.sibling;return Qe}function C(it,Qe){return it=xa(it,Qe),it.index=0,it.sibling=null,it}function W(it,Qe,vt){return it.index=vt,o?(vt=it.alternate,vt!==null?(vt=vt.index,vt<Qe?(it.flags|=67108866,Qe):vt):(it.flags|=67108866,Qe)):(it.flags|=1048576,Qe)}function ye(it){return o&&it.alternate===null&&(it.flags|=67108866),it}function Re(it,Qe,vt,fn){return Qe===null||Qe.tag!==6?(Qe=Go(vt,it.mode,fn),Qe.return=it,Qe):(Qe=C(Qe,vt),Qe.return=it,Qe)}function He(it,Qe,vt,fn){var Qn=vt.type;return Qn===_?Qt(it,Qe,vt.props.children,fn,vt.key):Qe!==null&&(Qe.elementType===Qn||typeof Qn=="object"&&Qn!==null&&Qn.$$typeof===I&&Qo(Qn)===Qe.type)?(Qe=C(Qe,vt.props),Ul(Qe,vt),Qe.return=it,Qe):(Qe=Ol(vt.type,vt.key,vt.props,null,it.mode,fn),Ul(Qe,vt),Qe.return=it,Qe)}function At(it,Qe,vt,fn){return Qe===null||Qe.tag!==4||Qe.stateNode.containerInfo!==vt.containerInfo||Qe.stateNode.implementation!==vt.implementation?(Qe=bo(vt,it.mode,fn),Qe.return=it,Qe):(Qe=C(Qe,vt.children||[]),Qe.return=it,Qe)}function Qt(it,Qe,vt,fn,Qn){return Qe===null||Qe.tag!==7?(Qe=Ba(vt,it.mode,fn,Qn),Qe.return=it,Qe):(Qe=C(Qe,vt),Qe.return=it,Qe)}function gn(it,Qe,vt){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number"||typeof Qe=="bigint")return Qe=Go(""+Qe,it.mode,vt),Qe.return=it,Qe;if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case g:return vt=Ol(Qe.type,Qe.key,Qe.props,null,it.mode,vt),Ul(vt,Qe),vt.return=it,vt;case v:return Qe=bo(Qe,it.mode,vt),Qe.return=it,Qe;case I:return Qe=Qo(Qe),gn(it,Qe,vt)}if(_e(Qe)||te(Qe))return Qe=Ba(Qe,it.mode,vt,null),Qe.return=it,Qe;if(typeof Qe.then=="function")return gn(it,Ec(Qe),vt);if(Qe.$$typeof===z)return gn(it,yi(it,Qe),vt);Tc(it,Qe)}return null}function kt(it,Qe,vt,fn){var Qn=Qe!==null?Qe.key:null;if(typeof vt=="string"&&vt!==""||typeof vt=="number"||typeof vt=="bigint")return Qn!==null?null:Re(it,Qe,""+vt,fn);if(typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case g:return vt.key===Qn?He(it,Qe,vt,fn):null;case v:return vt.key===Qn?At(it,Qe,vt,fn):null;case I:return vt=Qo(vt),kt(it,Qe,vt,fn)}if(_e(vt)||te(vt))return Qn!==null?null:Qt(it,Qe,vt,fn,null);if(typeof vt.then=="function")return kt(it,Qe,Ec(vt),fn);if(vt.$$typeof===z)return kt(it,Qe,yi(it,vt),fn);Tc(it,vt)}return null}function $t(it,Qe,vt,fn,Qn){if(typeof fn=="string"&&fn!==""||typeof fn=="number"||typeof fn=="bigint")return it=it.get(vt)||null,Re(Qe,it,""+fn,Qn);if(typeof fn=="object"&&fn!==null){switch(fn.$$typeof){case g:return it=it.get(fn.key===null?vt:fn.key)||null,He(Qe,it,fn,Qn);case v:return it=it.get(fn.key===null?vt:fn.key)||null,At(Qe,it,fn,Qn);case I:return fn=Qo(fn),$t(it,Qe,vt,fn,Qn)}if(_e(fn)||te(fn))return it=it.get(vt)||null,Qt(Qe,it,fn,Qn,null);if(typeof fn.then=="function")return $t(it,Qe,vt,Ec(fn),Qn);if(fn.$$typeof===z)return $t(it,Qe,vt,yi(Qe,fn),Qn);Tc(Qe,fn)}return null}function Hn(it,Qe,vt,fn){for(var Qn=null,$i=null,$n=Qe,Si=Qe=0,Ni=null;$n!==null&&Si<vt.length;Si++){$n.index>Si?(Ni=$n,$n=null):Ni=$n.sibling;var Gi=kt(it,$n,vt[Si],fn);if(Gi===null){$n===null&&($n=Ni);break}o&&$n&&Gi.alternate===null&&c(it,$n),Qe=W(Gi,Qe,Si),$i===null?Qn=Gi:$i.sibling=Gi,$i=Gi,$n=Ni}if(Si===vt.length)return f(it,$n),Ri&&wi(it,Si),Qn;if($n===null){for(;Si<vt.length;Si++)$n=gn(it,vt[Si],fn),$n!==null&&(Qe=W($n,Qe,Si),$i===null?Qn=$n:$i.sibling=$n,$i=$n);return Ri&&wi(it,Si),Qn}for($n=y($n);Si<vt.length;Si++)Ni=$t($n,it,Si,vt[Si],fn),Ni!==null&&(o&&Ni.alternate!==null&&$n.delete(Ni.key===null?Si:Ni.key),Qe=W(Ni,Qe,Si),$i===null?Qn=Ni:$i.sibling=Ni,$i=Ni);return o&&$n.forEach(function(jo){return c(it,jo)}),Ri&&wi(it,Si),Qn}function ii(it,Qe,vt,fn){if(vt==null)throw Error(n(151));for(var Qn=null,$i=null,$n=Qe,Si=Qe=0,Ni=null,Gi=vt.next();$n!==null&&!Gi.done;Si++,Gi=vt.next()){$n.index>Si?(Ni=$n,$n=null):Ni=$n.sibling;var jo=kt(it,$n,Gi.value,fn);if(jo===null){$n===null&&($n=Ni);break}o&&$n&&jo.alternate===null&&c(it,$n),Qe=W(jo,Qe,Si),$i===null?Qn=jo:$i.sibling=jo,$i=jo,$n=Ni}if(Gi.done)return f(it,$n),Ri&&wi(it,Si),Qn;if($n===null){for(;!Gi.done;Si++,Gi=vt.next())Gi=gn(it,Gi.value,fn),Gi!==null&&(Qe=W(Gi,Qe,Si),$i===null?Qn=Gi:$i.sibling=Gi,$i=Gi);return Ri&&wi(it,Si),Qn}for($n=y($n);!Gi.done;Si++,Gi=vt.next())Gi=$t($n,it,Si,Gi.value,fn),Gi!==null&&(o&&Gi.alternate!==null&&$n.delete(Gi.key===null?Si:Gi.key),Qe=W(Gi,Qe,Si),$i===null?Qn=Gi:$i.sibling=Gi,$i=Gi);return o&&$n.forEach(function(Zm){return c(it,Zm)}),Ri&&wi(it,Si),Qn}function or(it,Qe,vt,fn){if(typeof vt=="object"&&vt!==null&&vt.type===_&&vt.key===null&&(vt=vt.props.children),typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case g:e:{for(var Qn=vt.key;Qe!==null;){if(Qe.key===Qn){if(Qn=vt.type,Qn===_){if(Qe.tag===7){f(it,Qe.sibling),fn=C(Qe,vt.props.children),fn.return=it,it=fn;break e}}else if(Qe.elementType===Qn||typeof Qn=="object"&&Qn!==null&&Qn.$$typeof===I&&Qo(Qn)===Qe.type){f(it,Qe.sibling),fn=C(Qe,vt.props),Ul(fn,vt),fn.return=it,it=fn;break e}f(it,Qe);break}else c(it,Qe);Qe=Qe.sibling}vt.type===_?(fn=Ba(vt.props.children,it.mode,fn,vt.key),fn.return=it,it=fn):(fn=Ol(vt.type,vt.key,vt.props,null,it.mode,fn),Ul(fn,vt),fn.return=it,it=fn)}return ye(it);case v:e:{for(Qn=vt.key;Qe!==null;){if(Qe.key===Qn)if(Qe.tag===4&&Qe.stateNode.containerInfo===vt.containerInfo&&Qe.stateNode.implementation===vt.implementation){f(it,Qe.sibling),fn=C(Qe,vt.children||[]),fn.return=it,it=fn;break e}else{f(it,Qe);break}else c(it,Qe);Qe=Qe.sibling}fn=bo(vt,it.mode,fn),fn.return=it,it=fn}return ye(it);case I:return vt=Qo(vt),or(it,Qe,vt,fn)}if(_e(vt))return Hn(it,Qe,vt,fn);if(te(vt)){if(Qn=te(vt),typeof Qn!="function")throw Error(n(150));return vt=Qn.call(vt),ii(it,Qe,vt,fn)}if(typeof vt.then=="function")return or(it,Qe,Ec(vt),fn);if(vt.$$typeof===z)return or(it,Qe,yi(it,vt),fn);Tc(it,vt)}return typeof vt=="string"&&vt!==""||typeof vt=="number"||typeof vt=="bigint"?(vt=""+vt,Qe!==null&&Qe.tag===6?(f(it,Qe.sibling),fn=C(Qe,vt),fn.return=it,it=fn):(f(it,Qe),fn=Go(vt,it.mode,fn),fn.return=it,it=fn),ye(it)):f(it,Qe)}return function(it,Qe,vt,fn){try{jl=0;var Qn=or(it,Qe,vt,fn);return ml=null,Qn}catch($n){if($n===pl||$n===vc)throw $n;var $i=Dr(29,$n,null,it.mode);return $i.lanes=fn,$i.return=it,$i}}}var Zo=Yd(!0),Qd=Yd(!1),xo=!1;function yu(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function vu(o,c){o=o.updateQueue,c.updateQueue===o&&(c.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function So(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function Ao(o,c,f){var y=o.updateQueue;if(y===null)return null;if(y=y.shared,(Ki&2)!==0){var C=y.pending;return C===null?c.next=c:(c.next=C.next,C.next=c),y.pending=c,c=Ta(o),$o(o,null,f),c}return Ea(o,y,c,f),Ta(o)}function Hl(o,c,f){if(c=c.updateQueue,c!==null&&(c=c.shared,(f&4194048)!==0)){var y=c.lanes;y&=o.pendingLanes,f|=y,c.lanes=f,nr(o,f)}}function bu(o,c){var f=o.updateQueue,y=o.alternate;if(y!==null&&(y=y.updateQueue,f===y)){var C=null,W=null;if(f=f.firstBaseUpdate,f!==null){do{var ye={lane:f.lane,tag:f.tag,payload:f.payload,callback:null,next:null};W===null?C=W=ye:W=W.next=ye,f=f.next}while(f!==null);W===null?C=W=c:W=W.next=c}else C=W=c;f={baseState:y.baseState,firstBaseUpdate:C,lastBaseUpdate:W,shared:y.shared,callbacks:y.callbacks},o.updateQueue=f;return}o=f.lastBaseUpdate,o===null?f.firstBaseUpdate=c:o.next=c,f.lastBaseUpdate=c}var Eu=!1;function ql(){if(Eu){var o=Zr;if(o!==null)throw o}}function zl(o,c,f,y){Eu=!1;var C=o.updateQueue;xo=!1;var W=C.firstBaseUpdate,ye=C.lastBaseUpdate,Re=C.shared.pending;if(Re!==null){C.shared.pending=null;var He=Re,At=He.next;He.next=null,ye===null?W=At:ye.next=At,ye=He;var Qt=o.alternate;Qt!==null&&(Qt=Qt.updateQueue,Re=Qt.lastBaseUpdate,Re!==ye&&(Re===null?Qt.firstBaseUpdate=At:Re.next=At,Qt.lastBaseUpdate=He))}if(W!==null){var gn=C.baseState;ye=0,Qt=At=He=null,Re=W;do{var kt=Re.lane&-536870913,$t=kt!==Re.lane;if($t?(Mi&kt)===kt:(y&kt)===kt){kt!==0&&kt===aa&&(Eu=!0),Qt!==null&&(Qt=Qt.next={lane:0,tag:Re.tag,payload:Re.payload,callback:null,next:null});e:{var Hn=o,ii=Re;kt=c;var or=f;switch(ii.tag){case 1:if(Hn=ii.payload,typeof Hn=="function"){gn=Hn.call(or,gn,kt);break e}gn=Hn;break e;case 3:Hn.flags=Hn.flags&-65537|128;case 0:if(Hn=ii.payload,kt=typeof Hn=="function"?Hn.call(or,gn,kt):Hn,kt==null)break e;gn=p({},gn,kt);break e;case 2:xo=!0}}kt=Re.callback,kt!==null&&(o.flags|=64,$t&&(o.flags|=8192),$t=C.callbacks,$t===null?C.callbacks=[kt]:$t.push(kt))}else $t={lane:kt,tag:Re.tag,payload:Re.payload,callback:Re.callback,next:null},Qt===null?(At=Qt=$t,He=gn):Qt=Qt.next=$t,ye|=kt;if(Re=Re.next,Re===null){if(Re=C.shared.pending,Re===null)break;$t=Re,Re=$t.next,$t.next=null,C.lastBaseUpdate=$t,C.shared.pending=null}}while(!0);Qt===null&&(He=gn),C.baseState=He,C.firstBaseUpdate=At,C.lastBaseUpdate=Qt,W===null&&(C.shared.lanes=0),Io|=ye,o.lanes=ye,o.memoizedState=gn}}function Jd(o,c){if(typeof o!="function")throw Error(n(191,o));o.call(c)}function Zd(o,c){var f=o.callbacks;if(f!==null)for(o.callbacks=null,o=0;o<f.length;o++)Jd(f[o],c)}var gl=re(null),xc=re(0);function eh(o,c){o=po,pe(xc,o),pe(gl,c),po=o|c.baseLanes}function Tu(){pe(xc,po),pe(gl,gl.current)}function xu(){po=xc.current,fe(gl),fe(xc)}var Xs=re(null),oa=null;function wo(o){var c=o.alternate;pe(Or,Or.current&1),pe(Xs,o),oa===null&&(c===null||gl.current!==null||c.memoizedState!==null)&&(oa=o)}function Su(o){pe(Or,Or.current),pe(Xs,o),oa===null&&(oa=o)}function th(o){o.tag===22?(pe(Or,Or.current),pe(Xs,o),oa===null&&(oa=o)):Co()}function Co(){pe(Or,Or.current),pe(Xs,Xs.current)}function Ys(o){fe(Xs),oa===o&&(oa=null),fe(Or)}var Or=re(0);function Sc(o){for(var c=o;c!==null;){if(c.tag===13){var f=c.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||Id(f)||Dd(f)))return c}else if(c.tag===19&&(c.memoizedProps.revealOrder==="forwards"||c.memoizedProps.revealOrder==="backwards"||c.memoizedProps.revealOrder==="unstable_legacy-backwards"||c.memoizedProps.revealOrder==="together")){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}var so=0,xi=null,sr=null,Hr=null,Ac=!1,_l=!1,el=!1,wc=0,$l=0,yl=null,qp=0;function kr(){throw Error(n(321))}function Au(o,c){if(c===null)return!1;for(var f=0;f<c.length&&f<o.length;f++)if(!jr(o[f],c[f]))return!1;return!0}function wu(o,c,f,y,C,W){return so=W,xi=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,le.H=o===null||o.memoizedState===null?Vh:Uu,el=!1,W=f(y,C),el=!1,_l&&(W=ih(c,f,y,C)),nh(o),W}function nh(o){le.H=Kl;var c=sr!==null&&sr.next!==null;if(so=0,Hr=sr=xi=null,Ac=!1,$l=0,yl=null,c)throw Error(n(300));o===null||qr||(o=o.dependencies,o!==null&&Rn(o)&&(qr=!0))}function ih(o,c,f,y){xi=o;var C=0;do{if(_l&&(yl=null),$l=0,_l=!1,25<=C)throw Error(n(301));if(C+=1,Hr=sr=null,o.updateQueue!=null){var W=o.updateQueue;W.lastEffect=null,W.events=null,W.stores=null,W.memoCache!=null&&(W.memoCache.index=0)}le.H=Bh,W=c(f,y)}while(_l);return W}function zp(){var o=le.H,c=o.useState()[0];return c=typeof c.then=="function"?Gl(c):c,o=o.useState()[0],(sr!==null?sr.memoizedState:null)!==o&&(xi.flags|=1024),c}function Cu(){var o=wc!==0;return wc=0,o}function Ru(o,c,f){c.updateQueue=o.updateQueue,c.flags&=-2053,o.lanes&=~f}function Pu(o){if(Ac){for(o=o.memoizedState;o!==null;){var c=o.queue;c!==null&&(c.pending=null),o=o.next}Ac=!1}so=0,Hr=sr=xi=null,_l=!1,$l=wc=0,yl=null}function bs(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Hr===null?xi.memoizedState=Hr=o:Hr=Hr.next=o,Hr}function Fr(){if(sr===null){var o=xi.alternate;o=o!==null?o.memoizedState:null}else o=sr.next;var c=Hr===null?xi.memoizedState:Hr.next;if(c!==null)Hr=c,sr=o;else{if(o===null)throw xi.alternate===null?Error(n(467)):Error(n(310));sr=o,o={memoizedState:sr.memoizedState,baseState:sr.baseState,baseQueue:sr.baseQueue,queue:sr.queue,next:null},Hr===null?xi.memoizedState=Hr=o:Hr=Hr.next=o}return Hr}function Cc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Gl(o){var c=$l;return $l+=1,yl===null&&(yl=[]),o=Wd(yl,o,c),c=xi,(Hr===null?c.memoizedState:Hr.next)===null&&(c=c.alternate,le.H=c===null||c.memoizedState===null?Vh:Uu),o}function Rc(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return Gl(o);if(o.$$typeof===z)return Mn(o)}throw Error(n(438,String(o)))}function Iu(o){var c=null,f=xi.updateQueue;if(f!==null&&(c=f.memoCache),c==null){var y=xi.alternate;y!==null&&(y=y.updateQueue,y!==null&&(y=y.memoCache,y!=null&&(c={data:y.data.map(function(C){return C.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),f===null&&(f=Cc(),xi.updateQueue=f),f.memoCache=c,f=c.data[c.index],f===void 0)for(f=c.data[c.index]=Array(o),y=0;y<o;y++)f[y]=H;return c.index++,f}function ao(o,c){return typeof c=="function"?c(o):c}function Pc(o){var c=Fr();return Du(c,sr,o)}function Du(o,c,f){var y=o.queue;if(y===null)throw Error(n(311));y.lastRenderedReducer=f;var C=o.baseQueue,W=y.pending;if(W!==null){if(C!==null){var ye=C.next;C.next=W.next,W.next=ye}c.baseQueue=C=W,y.pending=null}if(W=o.baseState,C===null)o.memoizedState=W;else{c=C.next;var Re=ye=null,He=null,At=c,Qt=!1;do{var gn=At.lane&-536870913;if(gn!==At.lane?(Mi&gn)===gn:(so&gn)===gn){var kt=At.revertLane;if(kt===0)He!==null&&(He=He.next={lane:0,revertLane:0,gesture:null,action:At.action,hasEagerState:At.hasEagerState,eagerState:At.eagerState,next:null}),gn===aa&&(Qt=!0);else if((so&kt)===kt){At=At.next,kt===aa&&(Qt=!0);continue}else gn={lane:0,revertLane:At.revertLane,gesture:null,action:At.action,hasEagerState:At.hasEagerState,eagerState:At.eagerState,next:null},He===null?(Re=He=gn,ye=W):He=He.next=gn,xi.lanes|=kt,Io|=kt;gn=At.action,el&&f(W,gn),W=At.hasEagerState?At.eagerState:f(W,gn)}else kt={lane:gn,revertLane:At.revertLane,gesture:At.gesture,action:At.action,hasEagerState:At.hasEagerState,eagerState:At.eagerState,next:null},He===null?(Re=He=kt,ye=W):He=He.next=kt,xi.lanes|=gn,Io|=gn;At=At.next}while(At!==null&&At!==c);if(He===null?ye=W:He.next=Re,!jr(W,o.memoizedState)&&(qr=!0,Qt&&(f=Zr,f!==null)))throw f;o.memoizedState=W,o.baseState=ye,o.baseQueue=He,y.lastRenderedState=W}return C===null&&(y.lanes=0),[o.memoizedState,y.dispatch]}function ku(o){var c=Fr(),f=c.queue;if(f===null)throw Error(n(311));f.lastRenderedReducer=o;var y=f.dispatch,C=f.pending,W=c.memoizedState;if(C!==null){f.pending=null;var ye=C=C.next;do W=o(W,ye.action),ye=ye.next;while(ye!==C);jr(W,c.memoizedState)||(qr=!0),c.memoizedState=W,c.baseQueue===null&&(c.baseState=W),f.lastRenderedState=W}return[W,y]}function rh(o,c,f){var y=xi,C=Fr(),W=Ri;if(W){if(f===void 0)throw Error(n(407));f=f()}else f=c();var ye=!jr((sr||C).memoizedState,f);if(ye&&(C.memoizedState=f,qr=!0),C=C.queue,Lu(oh.bind(null,y,C,o),[o]),C.getSnapshot!==c||ye||Hr!==null&&Hr.memoizedState.tag&1){if(y.flags|=2048,vl(9,{destroy:void 0},ah.bind(null,y,C,f,c),null),hr===null)throw Error(n(349));W||(so&127)!==0||sh(y,c,f)}return f}function sh(o,c,f){o.flags|=16384,o={getSnapshot:c,value:f},c=xi.updateQueue,c===null?(c=Cc(),xi.updateQueue=c,c.stores=[o]):(f=c.stores,f===null?c.stores=[o]:f.push(o))}function ah(o,c,f,y){c.value=f,c.getSnapshot=y,lh(c)&&ch(o)}function oh(o,c,f){return f(function(){lh(c)&&ch(o)})}function lh(o){var c=o.getSnapshot;o=o.value;try{var f=c();return!jr(o,f)}catch{return!0}}function ch(o){var c=Rs(o,2);c!==null&&Fs(c,o,2)}function Mu(o){var c=bs();if(typeof o=="function"){var f=o;if(o=f(),el){Vn(!0);try{f()}finally{Vn(!1)}}}return c.memoizedState=c.baseState=o,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ao,lastRenderedState:o},c}function uh(o,c,f,y){return o.baseState=f,Du(o,sr,typeof y=="function"?y:ao)}function $p(o,c,f,y,C){if(kc(o))throw Error(n(485));if(o=c.action,o!==null){var W={payload:C,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ye){W.listeners.push(ye)}};le.T!==null?f(!0):W.isTransition=!1,y(W),f=c.pending,f===null?(W.next=c.pending=W,dh(c,W)):(W.next=f.next,c.pending=f.next=W)}}function dh(o,c){var f=c.action,y=c.payload,C=o.state;if(c.isTransition){var W=le.T,ye={};le.T=ye;try{var Re=f(C,y),He=le.S;He!==null&&He(ye,Re),hh(o,c,Re)}catch(At){Nu(o,c,At)}finally{W!==null&&ye.types!==null&&(W.types=ye.types),le.T=W}}else try{W=f(C,y),hh(o,c,W)}catch(At){Nu(o,c,At)}}function hh(o,c,f){f!==null&&typeof f=="object"&&typeof f.then=="function"?f.then(function(y){fh(o,c,y)},function(y){return Nu(o,c,y)}):fh(o,c,f)}function fh(o,c,f){c.status="fulfilled",c.value=f,ph(c),o.state=f,c=o.pending,c!==null&&(f=c.next,f===c?o.pending=null:(f=f.next,c.next=f,dh(o,f)))}function Nu(o,c,f){var y=o.pending;if(o.pending=null,y!==null){y=y.next;do c.status="rejected",c.reason=f,ph(c),c=c.next;while(c!==y)}o.action=null}function ph(o){o=o.listeners;for(var c=0;c<o.length;c++)(0,o[c])()}function mh(o,c){return c}function gh(o,c){if(Ri){var f=hr.formState;if(f!==null){e:{var y=xi;if(Ri){if(dr){t:{for(var C=dr,W=ks;C.nodeType!==8;){if(!W){C=null;break t}if(C=la(C.nextSibling),C===null){C=null;break t}}W=C.data,C=W==="F!"||W==="F"?C:null}if(C){dr=la(C.nextSibling),y=C.data==="F!";break e}}qa(y)}y=!1}y&&(c=f[0])}}return f=bs(),f.memoizedState=f.baseState=c,y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mh,lastRenderedState:c},f.queue=y,f=Lh.bind(null,xi,y),y.dispatch=f,y=Mu(!1),W=ju.bind(null,xi,!1,y.queue),y=bs(),C={state:c,dispatch:null,action:o,pending:null},y.queue=C,f=$p.bind(null,xi,C,W,f),C.dispatch=f,y.memoizedState=o,[c,f,!1]}function _h(o){var c=Fr();return yh(c,sr,o)}function yh(o,c,f){if(c=Du(o,c,mh)[0],o=Pc(ao)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var y=Gl(c)}catch(ye){throw ye===pl?vc:ye}else y=c;c=Fr();var C=c.queue,W=C.dispatch;return f!==c.memoizedState&&(xi.flags|=2048,vl(9,{destroy:void 0},Gp.bind(null,C,f),null)),[y,W,o]}function Gp(o,c){o.action=c}function vh(o){var c=Fr(),f=sr;if(f!==null)return yh(c,f,o);Fr(),c=c.memoizedState,f=Fr();var y=f.queue.dispatch;return f.memoizedState=o,[c,y,!1]}function vl(o,c,f,y){return o={tag:o,create:f,deps:y,inst:c,next:null},c=xi.updateQueue,c===null&&(c=Cc(),xi.updateQueue=c),f=c.lastEffect,f===null?c.lastEffect=o.next=o:(y=f.next,f.next=o,o.next=y,c.lastEffect=o),o}function bh(){return Fr().memoizedState}function Ic(o,c,f,y){var C=bs();xi.flags|=o,C.memoizedState=vl(1|c,{destroy:void 0},f,y===void 0?null:y)}function Dc(o,c,f,y){var C=Fr();y=y===void 0?null:y;var W=C.memoizedState.inst;sr!==null&&y!==null&&Au(y,sr.memoizedState.deps)?C.memoizedState=vl(c,W,f,y):(xi.flags|=o,C.memoizedState=vl(1|c,W,f,y))}function Eh(o,c){Ic(8390656,8,o,c)}function Lu(o,c){Dc(2048,8,o,c)}function Wp(o){xi.flags|=4;var c=xi.updateQueue;if(c===null)c=Cc(),xi.updateQueue=c,c.events=[o];else{var f=c.events;f===null?c.events=[o]:f.push(o)}}function Th(o){var c=Fr().memoizedState;return Wp({ref:c,nextImpl:o}),function(){if((Ki&2)!==0)throw Error(n(440));return c.impl.apply(void 0,arguments)}}function xh(o,c){return Dc(4,2,o,c)}function Sh(o,c){return Dc(4,4,o,c)}function Ah(o,c){if(typeof c=="function"){o=o();var f=c(o);return function(){typeof f=="function"?f():c(null)}}if(c!=null)return o=o(),c.current=o,function(){c.current=null}}function wh(o,c,f){f=f!=null?f.concat([o]):null,Dc(4,4,Ah.bind(null,c,o),f)}function Ou(){}function Ch(o,c){var f=Fr();c=c===void 0?null:c;var y=f.memoizedState;return c!==null&&Au(c,y[1])?y[0]:(f.memoizedState=[o,c],o)}function Rh(o,c){var f=Fr();c=c===void 0?null:c;var y=f.memoizedState;if(c!==null&&Au(c,y[1]))return y[0];if(y=o(),el){Vn(!0);try{o()}finally{Vn(!1)}}return f.memoizedState=[y,c],y}function Fu(o,c,f){return f===void 0||(so&1073741824)!==0&&(Mi&261930)===0?o.memoizedState=c:(o.memoizedState=f,o=If(),xi.lanes|=o,Io|=o,f)}function Ph(o,c,f,y){return jr(f,c)?f:gl.current!==null?(o=Fu(o,f,y),jr(o,c)||(qr=!0),o):(so&42)===0||(so&1073741824)!==0&&(Mi&261930)===0?(qr=!0,o.memoizedState=f):(o=If(),xi.lanes|=o,Io|=o,c)}function Ih(o,c,f,y,C){var W=ue.p;ue.p=W!==0&&8>W?W:8;var ye=le.T,Re={};le.T=Re,ju(o,!1,c,f);try{var He=C(),At=le.S;if(At!==null&&At(Re,He),He!==null&&typeof He=="object"&&typeof He.then=="function"){var Qt=Hp(He,y);Wl(o,c,Qt,Zs(o))}else Wl(o,c,y,Zs(o))}catch(gn){Wl(o,c,{then:function(){},status:"rejected",reason:gn},Zs())}finally{ue.p=W,ye!==null&&Re.types!==null&&(ye.types=Re.types),le.T=ye}}function Kp(){}function Vu(o,c,f,y){if(o.tag!==5)throw Error(n(476));var C=Dh(o).queue;Ih(o,C,c,oe,f===null?Kp:function(){return kh(o),f(y)})}function Dh(o){var c=o.memoizedState;if(c!==null)return c;c={memoizedState:oe,baseState:oe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ao,lastRenderedState:oe},next:null};var f={};return c.next={memoizedState:f,baseState:f,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ao,lastRenderedState:f},next:null},o.memoizedState=c,o=o.alternate,o!==null&&(o.memoizedState=c),c}function kh(o){var c=Dh(o);c.next===null&&(c=o.alternate.memoizedState),Wl(o,c.next.queue,{},Zs())}function Bu(){return Mn(uc)}function Mh(){return Fr().memoizedState}function Nh(){return Fr().memoizedState}function Xp(o){for(var c=o.return;c!==null;){switch(c.tag){case 24:case 3:var f=Zs();o=So(f);var y=Ao(c,o,f);y!==null&&(Fs(y,c,f),Hl(y,c,f)),c={cache:ro()},o.payload=c;return}c=c.return}}function Yp(o,c,f){var y=Zs();f={lane:y,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},kc(o)?Oh(c,f):(f=Cs(o,c,f,y),f!==null&&(Fs(f,o,y),Fh(f,c,y)))}function Lh(o,c,f){var y=Zs();Wl(o,c,f,y)}function Wl(o,c,f,y){var C={lane:y,revertLane:0,gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null};if(kc(o))Oh(c,C);else{var W=o.alternate;if(o.lanes===0&&(W===null||W.lanes===0)&&(W=c.lastRenderedReducer,W!==null))try{var ye=c.lastRenderedState,Re=W(ye,f);if(C.hasEagerState=!0,C.eagerState=Re,jr(Re,ye))return Ea(o,c,C,0),hr===null&&Va(),!1}catch{}if(f=Cs(o,c,C,y),f!==null)return Fs(f,o,y),Fh(f,c,y),!0}return!1}function ju(o,c,f,y){if(y={lane:2,revertLane:yd(),gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null},kc(o)){if(c)throw Error(n(479))}else c=Cs(o,f,y,2),c!==null&&Fs(c,o,2)}function kc(o){var c=o.alternate;return o===xi||c!==null&&c===xi}function Oh(o,c){_l=Ac=!0;var f=o.pending;f===null?c.next=c:(c.next=f.next,f.next=c),o.pending=c}function Fh(o,c,f){if((f&4194048)!==0){var y=c.lanes;y&=o.pendingLanes,f|=y,c.lanes=f,nr(o,f)}}var Kl={readContext:Mn,use:Rc,useCallback:kr,useContext:kr,useEffect:kr,useImperativeHandle:kr,useLayoutEffect:kr,useInsertionEffect:kr,useMemo:kr,useReducer:kr,useRef:kr,useState:kr,useDebugValue:kr,useDeferredValue:kr,useTransition:kr,useSyncExternalStore:kr,useId:kr,useHostTransitionStatus:kr,useFormState:kr,useActionState:kr,useOptimistic:kr,useMemoCache:kr,useCacheRefresh:kr};Kl.useEffectEvent=kr;var Vh={readContext:Mn,use:Rc,useCallback:function(o,c){return bs().memoizedState=[o,c===void 0?null:c],o},useContext:Mn,useEffect:Eh,useImperativeHandle:function(o,c,f){f=f!=null?f.concat([o]):null,Ic(4194308,4,Ah.bind(null,c,o),f)},useLayoutEffect:function(o,c){return Ic(4194308,4,o,c)},useInsertionEffect:function(o,c){Ic(4,2,o,c)},useMemo:function(o,c){var f=bs();c=c===void 0?null:c;var y=o();if(el){Vn(!0);try{o()}finally{Vn(!1)}}return f.memoizedState=[y,c],y},useReducer:function(o,c,f){var y=bs();if(f!==void 0){var C=f(c);if(el){Vn(!0);try{f(c)}finally{Vn(!1)}}}else C=c;return y.memoizedState=y.baseState=C,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:C},y.queue=o,o=o.dispatch=Yp.bind(null,xi,o),[y.memoizedState,o]},useRef:function(o){var c=bs();return o={current:o},c.memoizedState=o},useState:function(o){o=Mu(o);var c=o.queue,f=Lh.bind(null,xi,c);return c.dispatch=f,[o.memoizedState,f]},useDebugValue:Ou,useDeferredValue:function(o,c){var f=bs();return Fu(f,o,c)},useTransition:function(){var o=Mu(!1);return o=Ih.bind(null,xi,o.queue,!0,!1),bs().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,c,f){var y=xi,C=bs();if(Ri){if(f===void 0)throw Error(n(407));f=f()}else{if(f=c(),hr===null)throw Error(n(349));(Mi&127)!==0||sh(y,c,f)}C.memoizedState=f;var W={value:f,getSnapshot:c};return C.queue=W,Eh(oh.bind(null,y,W,o),[o]),y.flags|=2048,vl(9,{destroy:void 0},ah.bind(null,y,W,f,c),null),f},useId:function(){var o=bs(),c=hr.identifierPrefix;if(Ri){var f=rs,y=Ks;f=(y&~(1<<32-Bn(y)-1)).toString(32)+f,c="_"+c+"R_"+f,f=wc++,0<f&&(c+="H"+f.toString(32)),c+="_"}else f=qp++,c="_"+c+"r_"+f.toString(32)+"_";return o.memoizedState=c},useHostTransitionStatus:Bu,useFormState:gh,useActionState:gh,useOptimistic:function(o){var c=bs();c.memoizedState=c.baseState=o;var f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=f,c=ju.bind(null,xi,!0,f),f.dispatch=c,[o,c]},useMemoCache:Iu,useCacheRefresh:function(){return bs().memoizedState=Xp.bind(null,xi)},useEffectEvent:function(o){var c=bs(),f={impl:o};return c.memoizedState=f,function(){if((Ki&2)!==0)throw Error(n(440));return f.impl.apply(void 0,arguments)}}},Uu={readContext:Mn,use:Rc,useCallback:Ch,useContext:Mn,useEffect:Lu,useImperativeHandle:wh,useInsertionEffect:xh,useLayoutEffect:Sh,useMemo:Rh,useReducer:Pc,useRef:bh,useState:function(){return Pc(ao)},useDebugValue:Ou,useDeferredValue:function(o,c){var f=Fr();return Ph(f,sr.memoizedState,o,c)},useTransition:function(){var o=Pc(ao)[0],c=Fr().memoizedState;return[typeof o=="boolean"?o:Gl(o),c]},useSyncExternalStore:rh,useId:Mh,useHostTransitionStatus:Bu,useFormState:_h,useActionState:_h,useOptimistic:function(o,c){var f=Fr();return uh(f,sr,o,c)},useMemoCache:Iu,useCacheRefresh:Nh};Uu.useEffectEvent=Th;var Bh={readContext:Mn,use:Rc,useCallback:Ch,useContext:Mn,useEffect:Lu,useImperativeHandle:wh,useInsertionEffect:xh,useLayoutEffect:Sh,useMemo:Rh,useReducer:ku,useRef:bh,useState:function(){return ku(ao)},useDebugValue:Ou,useDeferredValue:function(o,c){var f=Fr();return sr===null?Fu(f,o,c):Ph(f,sr.memoizedState,o,c)},useTransition:function(){var o=ku(ao)[0],c=Fr().memoizedState;return[typeof o=="boolean"?o:Gl(o),c]},useSyncExternalStore:rh,useId:Mh,useHostTransitionStatus:Bu,useFormState:vh,useActionState:vh,useOptimistic:function(o,c){var f=Fr();return sr!==null?uh(f,sr,o,c):(f.baseState=o,[o,f.queue.dispatch])},useMemoCache:Iu,useCacheRefresh:Nh};Bh.useEffectEvent=Th;function Hu(o,c,f,y){c=o.memoizedState,f=f(y,c),f=f==null?c:p({},c,f),o.memoizedState=f,o.lanes===0&&(o.updateQueue.baseState=f)}var qu={enqueueSetState:function(o,c,f){o=o._reactInternals;var y=Zs(),C=So(y);C.payload=c,f!=null&&(C.callback=f),c=Ao(o,C,y),c!==null&&(Fs(c,o,y),Hl(c,o,y))},enqueueReplaceState:function(o,c,f){o=o._reactInternals;var y=Zs(),C=So(y);C.tag=1,C.payload=c,f!=null&&(C.callback=f),c=Ao(o,C,y),c!==null&&(Fs(c,o,y),Hl(c,o,y))},enqueueForceUpdate:function(o,c){o=o._reactInternals;var f=Zs(),y=So(f);y.tag=2,c!=null&&(y.callback=c),c=Ao(o,y,f),c!==null&&(Fs(c,o,f),Hl(c,o,f))}};function jh(o,c,f,y,C,W,ye){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(y,W,ye):c.prototype&&c.prototype.isPureReactComponent?!Gs(f,y)||!Gs(C,W):!0}function Uh(o,c,f,y){o=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(f,y),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(f,y),c.state!==o&&qu.enqueueReplaceState(c,c.state,null)}function tl(o,c){var f=c;if("ref"in c){f={};for(var y in c)y!=="ref"&&(f[y]=c[y])}if(o=o.defaultProps){f===c&&(f=p({},f));for(var C in o)f[C]===void 0&&(f[C]=o[C])}return f}function Hh(o){Ei(o)}function qh(o){console.error(o)}function zh(o){Ei(o)}function Mc(o,c){try{var f=o.onUncaughtError;f(c.value,{componentStack:c.stack})}catch(y){setTimeout(function(){throw y})}}function $h(o,c,f){try{var y=o.onCaughtError;y(f.value,{componentStack:f.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(C){setTimeout(function(){throw C})}}function zu(o,c,f){return f=So(f),f.tag=3,f.payload={element:null},f.callback=function(){Mc(o,c)},f}function Gh(o){return o=So(o),o.tag=3,o}function Wh(o,c,f,y){var C=f.type.getDerivedStateFromError;if(typeof C=="function"){var W=y.value;o.payload=function(){return C(W)},o.callback=function(){$h(c,f,y)}}var ye=f.stateNode;ye!==null&&typeof ye.componentDidCatch=="function"&&(o.callback=function(){$h(c,f,y),typeof C!="function"&&(Do===null?Do=new Set([this]):Do.add(this));var Re=y.stack;this.componentDidCatch(y.value,{componentStack:Re!==null?Re:""})})}function Qp(o,c,f,y,C){if(f.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){if(c=f.alternate,c!==null&&jt(c,f,C,!0),f=Xs.current,f!==null){switch(f.tag){case 31:case 13:return oa===null?$c():f.alternate===null&&Mr===0&&(Mr=3),f.flags&=-257,f.flags|=65536,f.lanes=C,y===bc?f.flags|=16384:(c=f.updateQueue,c===null?f.updateQueue=new Set([y]):c.add(y),md(o,y,C)),!1;case 22:return f.flags|=65536,y===bc?f.flags|=16384:(c=f.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([y])},f.updateQueue=c):(f=c.retryQueue,f===null?c.retryQueue=new Set([y]):f.add(y)),md(o,y,C)),!1}throw Error(n(435,f.tag))}return md(o,y,C),$c(),!1}if(Ri)return c=Xs.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=C,y!==Vl&&(o=Error(n(422),{cause:y}),ne(Ps(o,f)))):(y!==Vl&&(c=Error(n(423),{cause:y}),ne(Ps(c,f))),o=o.current.alternate,o.flags|=65536,C&=-C,o.lanes|=C,y=Ps(y,f),C=zu(o.stateNode,y,C),bu(o,C),Mr!==4&&(Mr=2)),!1;var W=Error(n(520),{cause:y});if(W=Ps(W,f),nc===null?nc=[W]:nc.push(W),Mr!==4&&(Mr=2),c===null)return!0;y=Ps(y,f),f=c;do{switch(f.tag){case 3:return f.flags|=65536,o=C&-C,f.lanes|=o,o=zu(f.stateNode,y,o),bu(f,o),!1;case 1:if(c=f.type,W=f.stateNode,(f.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||W!==null&&typeof W.componentDidCatch=="function"&&(Do===null||!Do.has(W))))return f.flags|=65536,C&=-C,f.lanes|=C,C=Gh(C),Wh(C,o,f,y),bu(f,C),!1}f=f.return}while(f!==null);return!1}var $u=Error(n(461)),qr=!1;function ss(o,c,f,y){c.child=o===null?Qd(c,null,f,y):Zo(c,o.child,f,y)}function Kh(o,c,f,y,C){f=f.render;var W=c.ref;if("ref"in y){var ye={};for(var Re in y)Re!=="ref"&&(ye[Re]=y[Re])}else ye=y;return Wt(c),y=wu(o,c,f,ye,W,C),Re=Cu(),o!==null&&!qr?(Ru(o,c,C),oo(o,c,C)):(Ri&&Re&&Xr(c),c.flags|=1,ss(o,c,y,C),c.child)}function Xh(o,c,f,y,C){if(o===null){var W=f.type;return typeof W=="function"&&!Ll(W)&&W.defaultProps===void 0&&f.compare===null?(c.tag=15,c.type=W,Yh(o,c,W,y,C)):(o=Ol(f.type,null,y,c,c.mode,C),o.ref=c.ref,o.return=c,c.child=o)}if(W=o.child,!Zu(o,C)){var ye=W.memoizedProps;if(f=f.compare,f=f!==null?f:Gs,f(ye,y)&&o.ref===c.ref)return oo(o,c,C)}return c.flags|=1,o=xa(W,y),o.ref=c.ref,o.return=c,c.child=o}function Yh(o,c,f,y,C){if(o!==null){var W=o.memoizedProps;if(Gs(W,y)&&o.ref===c.ref)if(qr=!1,c.pendingProps=y=W,Zu(o,C))(o.flags&131072)!==0&&(qr=!0);else return c.lanes=o.lanes,oo(o,c,C)}return Gu(o,c,f,y,C)}function Qh(o,c,f,y){var C=y.children,W=o!==null?o.memoizedState:null;if(o===null&&c.stateNode===null&&(c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),y.mode==="hidden"){if((c.flags&128)!==0){if(W=W!==null?W.baseLanes|f:f,o!==null){for(y=c.child=o.child,C=0;y!==null;)C=C|y.lanes|y.childLanes,y=y.sibling;y=C&~W}else y=0,c.child=null;return Jh(o,c,W,f,y)}if((f&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},o!==null&&yc(c,W!==null?W.cachePool:null),W!==null?eh(c,W):Tu(),th(c);else return y=c.lanes=536870912,Jh(o,c,W!==null?W.baseLanes|f:f,f,y)}else W!==null?(yc(c,W.cachePool),eh(c,W),Co(),c.memoizedState=null):(o!==null&&yc(c,null),Tu(),Co());return ss(o,c,C,f),c.child}function Xl(o,c){return o!==null&&o.tag===22||c.stateNode!==null||(c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.sibling}function Jh(o,c,f,y,C){var W=gu();return W=W===null?null:{parent:mr._currentValue,pool:W},c.memoizedState={baseLanes:f,cachePool:W},o!==null&&yc(c,null),Tu(),th(c),o!==null&&jt(o,c,y,!0),c.childLanes=C,null}function Nc(o,c){return c=Oc({mode:c.mode,children:c.children},o.mode),c.ref=o.ref,o.child=c,c.return=o,c}function Zh(o,c,f){return Zo(c,o.child,null,f),o=Nc(c,c.pendingProps),o.flags|=2,Ys(c),c.memoizedState=null,o}function Jp(o,c,f){var y=c.pendingProps,C=(c.flags&128)!==0;if(c.flags&=-129,o===null){if(Ri){if(y.mode==="hidden")return o=Nc(c,y),c.lanes=536870912,Xl(null,o);if(Su(c),(o=dr)?(o=hp(o,ks),o=o!==null&&o.data==="&"?o:null,o!==null&&(c.memoizedState={dehydrated:o,treeContext:ja!==null?{id:Ks,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},f=Fl(o),f.return=c,c.child=f,Ur=c,dr=null)):o=null,o===null)throw qa(c);return c.lanes=536870912,null}return Nc(c,y)}var W=o.memoizedState;if(W!==null){var ye=W.dehydrated;if(Su(c),C)if(c.flags&256)c.flags&=-257,c=Zh(o,c,f);else if(c.memoizedState!==null)c.child=o.child,c.flags|=128,c=null;else throw Error(n(558));else if(qr||jt(o,c,f,!1),C=(f&o.childLanes)!==0,qr||C){if(y=hr,y!==null&&(ye=gr(y,f),ye!==0&&ye!==W.retryLane))throw W.retryLane=ye,Rs(o,ye),Fs(y,o,ye),$u;$c(),c=Zh(o,c,f)}else o=W.treeContext,dr=la(ye.nextSibling),Ur=c,Ri=!0,Ha=null,ks=!1,o!==null&&gc(c,o),c=Nc(c,y),c.flags|=4096;return c}return o=xa(o.child,{mode:y.mode,children:y.children}),o.ref=c.ref,c.child=o,o.return=c,o}function Lc(o,c){var f=c.ref;if(f===null)o!==null&&o.ref!==null&&(c.flags|=4194816);else{if(typeof f!="function"&&typeof f!="object")throw Error(n(284));(o===null||o.ref!==f)&&(c.flags|=4194816)}}function Gu(o,c,f,y,C){return Wt(c),f=wu(o,c,f,y,void 0,C),y=Cu(),o!==null&&!qr?(Ru(o,c,C),oo(o,c,C)):(Ri&&y&&Xr(c),c.flags|=1,ss(o,c,f,C),c.child)}function ef(o,c,f,y,C,W){return Wt(c),c.updateQueue=null,f=ih(c,y,f,C),nh(o),y=Cu(),o!==null&&!qr?(Ru(o,c,W),oo(o,c,W)):(Ri&&y&&Xr(c),c.flags|=1,ss(o,c,f,W),c.child)}function tf(o,c,f,y,C){if(Wt(c),c.stateNode===null){var W=ys,ye=f.contextType;typeof ye=="object"&&ye!==null&&(W=Mn(ye)),W=new f(y,W),c.memoizedState=W.state!==null&&W.state!==void 0?W.state:null,W.updater=qu,c.stateNode=W,W._reactInternals=c,W=c.stateNode,W.props=y,W.state=c.memoizedState,W.refs={},yu(c),ye=f.contextType,W.context=typeof ye=="object"&&ye!==null?Mn(ye):ys,W.state=c.memoizedState,ye=f.getDerivedStateFromProps,typeof ye=="function"&&(Hu(c,f,ye,y),W.state=c.memoizedState),typeof f.getDerivedStateFromProps=="function"||typeof W.getSnapshotBeforeUpdate=="function"||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(ye=W.state,typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount(),ye!==W.state&&qu.enqueueReplaceState(W,W.state,null),zl(c,y,W,C),ql(),W.state=c.memoizedState),typeof W.componentDidMount=="function"&&(c.flags|=4194308),y=!0}else if(o===null){W=c.stateNode;var Re=c.memoizedProps,He=tl(f,Re);W.props=He;var At=W.context,Qt=f.contextType;ye=ys,typeof Qt=="object"&&Qt!==null&&(ye=Mn(Qt));var gn=f.getDerivedStateFromProps;Qt=typeof gn=="function"||typeof W.getSnapshotBeforeUpdate=="function",Re=c.pendingProps!==Re,Qt||typeof W.UNSAFE_componentWillReceiveProps!="function"&&typeof W.componentWillReceiveProps!="function"||(Re||At!==ye)&&Uh(c,W,y,ye),xo=!1;var kt=c.memoizedState;W.state=kt,zl(c,y,W,C),ql(),At=c.memoizedState,Re||kt!==At||xo?(typeof gn=="function"&&(Hu(c,f,gn,y),At=c.memoizedState),(He=xo||jh(c,f,He,y,kt,At,ye))?(Qt||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount()),typeof W.componentDidMount=="function"&&(c.flags|=4194308)):(typeof W.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=y,c.memoizedState=At),W.props=y,W.state=At,W.context=ye,y=He):(typeof W.componentDidMount=="function"&&(c.flags|=4194308),y=!1)}else{W=c.stateNode,vu(o,c),ye=c.memoizedProps,Qt=tl(f,ye),W.props=Qt,gn=c.pendingProps,kt=W.context,At=f.contextType,He=ys,typeof At=="object"&&At!==null&&(He=Mn(At)),Re=f.getDerivedStateFromProps,(At=typeof Re=="function"||typeof W.getSnapshotBeforeUpdate=="function")||typeof W.UNSAFE_componentWillReceiveProps!="function"&&typeof W.componentWillReceiveProps!="function"||(ye!==gn||kt!==He)&&Uh(c,W,y,He),xo=!1,kt=c.memoizedState,W.state=kt,zl(c,y,W,C),ql();var $t=c.memoizedState;ye!==gn||kt!==$t||xo||o!==null&&o.dependencies!==null&&Rn(o.dependencies)?(typeof Re=="function"&&(Hu(c,f,Re,y),$t=c.memoizedState),(Qt=xo||jh(c,f,Qt,y,kt,$t,He)||o!==null&&o.dependencies!==null&&Rn(o.dependencies))?(At||typeof W.UNSAFE_componentWillUpdate!="function"&&typeof W.componentWillUpdate!="function"||(typeof W.componentWillUpdate=="function"&&W.componentWillUpdate(y,$t,He),typeof W.UNSAFE_componentWillUpdate=="function"&&W.UNSAFE_componentWillUpdate(y,$t,He)),typeof W.componentDidUpdate=="function"&&(c.flags|=4),typeof W.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof W.componentDidUpdate!="function"||ye===o.memoizedProps&&kt===o.memoizedState||(c.flags|=4),typeof W.getSnapshotBeforeUpdate!="function"||ye===o.memoizedProps&&kt===o.memoizedState||(c.flags|=1024),c.memoizedProps=y,c.memoizedState=$t),W.props=y,W.state=$t,W.context=He,y=Qt):(typeof W.componentDidUpdate!="function"||ye===o.memoizedProps&&kt===o.memoizedState||(c.flags|=4),typeof W.getSnapshotBeforeUpdate!="function"||ye===o.memoizedProps&&kt===o.memoizedState||(c.flags|=1024),y=!1)}return W=y,Lc(o,c),y=(c.flags&128)!==0,W||y?(W=c.stateNode,f=y&&typeof f.getDerivedStateFromError!="function"?null:W.render(),c.flags|=1,o!==null&&y?(c.child=Zo(c,o.child,null,C),c.child=Zo(c,null,f,C)):ss(o,c,f,C),c.memoizedState=W.state,o=c.child):o=oo(o,c,C),o}function nf(o,c,f,y){return Y(),c.flags|=256,ss(o,c,f,y),c.child}var Wu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ku(o){return{baseLanes:o,cachePool:$d()}}function Xu(o,c,f){return o=o!==null?o.childLanes&~f:0,c&&(o|=Js),o}function rf(o,c,f){var y=c.pendingProps,C=!1,W=(c.flags&128)!==0,ye;if((ye=W)||(ye=o!==null&&o.memoizedState===null?!1:(Or.current&2)!==0),ye&&(C=!0,c.flags&=-129),ye=(c.flags&32)!==0,c.flags&=-33,o===null){if(Ri){if(C?wo(c):Co(),(o=dr)?(o=hp(o,ks),o=o!==null&&o.data!=="&"?o:null,o!==null&&(c.memoizedState={dehydrated:o,treeContext:ja!==null?{id:Ks,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},f=Fl(o),f.return=c,c.child=f,Ur=c,dr=null)):o=null,o===null)throw qa(c);return Dd(o)?c.lanes=32:c.lanes=536870912,null}var Re=y.children;return y=y.fallback,C?(Co(),C=c.mode,Re=Oc({mode:"hidden",children:Re},C),y=Ba(y,C,f,null),Re.return=c,y.return=c,Re.sibling=y,c.child=Re,y=c.child,y.memoizedState=Ku(f),y.childLanes=Xu(o,ye,f),c.memoizedState=Wu,Xl(null,y)):(wo(c),Yu(c,Re))}var He=o.memoizedState;if(He!==null&&(Re=He.dehydrated,Re!==null)){if(W)c.flags&256?(wo(c),c.flags&=-257,c=Qu(o,c,f)):c.memoizedState!==null?(Co(),c.child=o.child,c.flags|=128,c=null):(Co(),Re=y.fallback,C=c.mode,y=Oc({mode:"visible",children:y.children},C),Re=Ba(Re,C,f,null),Re.flags|=2,y.return=c,Re.return=c,y.sibling=Re,c.child=y,Zo(c,o.child,null,f),y=c.child,y.memoizedState=Ku(f),y.childLanes=Xu(o,ye,f),c.memoizedState=Wu,c=Xl(null,y));else if(wo(c),Dd(Re)){if(ye=Re.nextSibling&&Re.nextSibling.dataset,ye)var At=ye.dgst;ye=At,y=Error(n(419)),y.stack="",y.digest=ye,ne({value:y,source:null,stack:null}),c=Qu(o,c,f)}else if(qr||jt(o,c,f,!1),ye=(f&o.childLanes)!==0,qr||ye){if(ye=hr,ye!==null&&(y=gr(ye,f),y!==0&&y!==He.retryLane))throw He.retryLane=y,Rs(o,y),Fs(ye,o,y),$u;Id(Re)||$c(),c=Qu(o,c,f)}else Id(Re)?(c.flags|=192,c.child=o.child,c=null):(o=He.treeContext,dr=la(Re.nextSibling),Ur=c,Ri=!0,Ha=null,ks=!1,o!==null&&gc(c,o),c=Yu(c,y.children),c.flags|=4096);return c}return C?(Co(),Re=y.fallback,C=c.mode,He=o.child,At=He.sibling,y=xa(He,{mode:"hidden",children:y.children}),y.subtreeFlags=He.subtreeFlags&65011712,At!==null?Re=xa(At,Re):(Re=Ba(Re,C,f,null),Re.flags|=2),Re.return=c,y.return=c,y.sibling=Re,c.child=y,Xl(null,y),y=c.child,Re=o.child.memoizedState,Re===null?Re=Ku(f):(C=Re.cachePool,C!==null?(He=mr._currentValue,C=C.parent!==He?{parent:He,pool:He}:C):C=$d(),Re={baseLanes:Re.baseLanes|f,cachePool:C}),y.memoizedState=Re,y.childLanes=Xu(o,ye,f),c.memoizedState=Wu,Xl(o.child,y)):(wo(c),f=o.child,o=f.sibling,f=xa(f,{mode:"visible",children:y.children}),f.return=c,f.sibling=null,o!==null&&(ye=c.deletions,ye===null?(c.deletions=[o],c.flags|=16):ye.push(o)),c.child=f,c.memoizedState=null,f)}function Yu(o,c){return c=Oc({mode:"visible",children:c},o.mode),c.return=o,o.child=c}function Oc(o,c){return o=Dr(22,o,null,c),o.lanes=0,o}function Qu(o,c,f){return Zo(c,o.child,null,f),o=Yu(c,c.pendingProps.children),o.flags|=2,c.memoizedState=null,o}function sf(o,c,f){o.lanes|=c;var y=o.alternate;y!==null&&(y.lanes|=c),Ve(o.return,c,f)}function Ju(o,c,f,y,C,W){var ye=o.memoizedState;ye===null?o.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:y,tail:f,tailMode:C,treeForkCount:W}:(ye.isBackwards=c,ye.rendering=null,ye.renderingStartTime=0,ye.last=y,ye.tail=f,ye.tailMode=C,ye.treeForkCount=W)}function af(o,c,f){var y=c.pendingProps,C=y.revealOrder,W=y.tail;y=y.children;var ye=Or.current,Re=(ye&2)!==0;if(Re?(ye=ye&1|2,c.flags|=128):ye&=1,pe(Or,ye),ss(o,c,y,f),y=Ri?Ko:0,!Re&&o!==null&&(o.flags&128)!==0)e:for(o=c.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&sf(o,f,c);else if(o.tag===19)sf(o,f,c);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===c)break e;for(;o.sibling===null;){if(o.return===null||o.return===c)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}switch(C){case"forwards":for(f=c.child,C=null;f!==null;)o=f.alternate,o!==null&&Sc(o)===null&&(C=f),f=f.sibling;f=C,f===null?(C=c.child,c.child=null):(C=f.sibling,f.sibling=null),Ju(c,!1,C,f,W,y);break;case"backwards":case"unstable_legacy-backwards":for(f=null,C=c.child,c.child=null;C!==null;){if(o=C.alternate,o!==null&&Sc(o)===null){c.child=C;break}o=C.sibling,C.sibling=f,f=C,C=o}Ju(c,!0,f,null,W,y);break;case"together":Ju(c,!1,null,null,void 0,y);break;default:c.memoizedState=null}return c.child}function oo(o,c,f){if(o!==null&&(c.dependencies=o.dependencies),Io|=c.lanes,(f&c.childLanes)===0)if(o!==null){if(jt(o,c,f,!1),(f&c.childLanes)===0)return null}else return null;if(o!==null&&c.child!==o.child)throw Error(n(153));if(c.child!==null){for(o=c.child,f=xa(o,o.pendingProps),c.child=f,f.return=c;o.sibling!==null;)o=o.sibling,f=f.sibling=xa(o,o.pendingProps),f.return=c;f.sibling=null}return c.child}function Zu(o,c){return(o.lanes&c)!==0?!0:(o=o.dependencies,!!(o!==null&&Rn(o)))}function Zp(o,c,f){switch(c.tag){case 3:Ae(c,c.stateNode.containerInfo),ke(c,mr,o.memoizedState.cache),Y();break;case 27:case 5:Me(c);break;case 4:Ae(c,c.stateNode.containerInfo);break;case 10:ke(c,c.type,c.memoizedProps.value);break;case 31:if(c.memoizedState!==null)return c.flags|=128,Su(c),null;break;case 13:var y=c.memoizedState;if(y!==null)return y.dehydrated!==null?(wo(c),c.flags|=128,null):(f&c.child.childLanes)!==0?rf(o,c,f):(wo(c),o=oo(o,c,f),o!==null?o.sibling:null);wo(c);break;case 19:var C=(o.flags&128)!==0;if(y=(f&c.childLanes)!==0,y||(jt(o,c,f,!1),y=(f&c.childLanes)!==0),C){if(y)return af(o,c,f);c.flags|=128}if(C=c.memoizedState,C!==null&&(C.rendering=null,C.tail=null,C.lastEffect=null),pe(Or,Or.current),y)break;return null;case 22:return c.lanes=0,Qh(o,c,f,c.pendingProps);case 24:ke(c,mr,o.memoizedState.cache)}return oo(o,c,f)}function of(o,c,f){if(o!==null)if(o.memoizedProps!==c.pendingProps)qr=!0;else{if(!Zu(o,f)&&(c.flags&128)===0)return qr=!1,Zp(o,c,f);qr=(o.flags&131072)!==0}else qr=!1,Ri&&(c.flags&1048576)!==0&&Ua(c,Ko,c.index);switch(c.lanes=0,c.tag){case 16:e:{var y=c.pendingProps;if(o=Qo(c.elementType),c.type=o,typeof o=="function")Ll(o)?(y=tl(o,y),c.tag=1,c=tf(null,c,o,y,f)):(c.tag=0,c=Gu(null,c,o,y,f));else{if(o!=null){var C=o.$$typeof;if(C===D){c.tag=11,c=Kh(null,c,o,y,f);break e}else if(C===R){c.tag=14,c=Xh(null,c,o,y,f);break e}}throw c=be(o)||o,Error(n(306,c,""))}}return c;case 0:return Gu(o,c,c.type,c.pendingProps,f);case 1:return y=c.type,C=tl(y,c.pendingProps),tf(o,c,y,C,f);case 3:e:{if(Ae(c,c.stateNode.containerInfo),o===null)throw Error(n(387));y=c.pendingProps;var W=c.memoizedState;C=W.element,vu(o,c),zl(c,y,null,f);var ye=c.memoizedState;if(y=ye.cache,ke(c,mr,y),y!==W.cache&&et(c,[mr],f,!0),ql(),y=ye.element,W.isDehydrated)if(W={element:y,isDehydrated:!1,cache:ye.cache},c.updateQueue.baseState=W,c.memoizedState=W,c.flags&256){c=nf(o,c,y,f);break e}else if(y!==C){C=Ps(Error(n(424)),c),ne(C),c=nf(o,c,y,f);break e}else for(o=c.stateNode.containerInfo,o.nodeType===9?o=o.body:o=o.nodeName==="HTML"?o.ownerDocument.body:o,dr=la(o.firstChild),Ur=c,Ri=!0,Ha=null,ks=!0,f=Qd(c,null,y,f),c.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(Y(),y===C){c=oo(o,c,f);break e}ss(o,c,y,f)}c=c.child}return c;case 26:return Lc(o,c),o===null?(f=yp(c.type,null,c.pendingProps,null))?c.memoizedState=f:Ri||(f=c.type,o=c.pendingProps,y=Jc(Ee.current).createElement(f),y[ci]=c,y[ir]=o,as(y,f,o),lr(y),c.stateNode=y):c.memoizedState=yp(c.type,o.memoizedProps,c.pendingProps,o.memoizedState),null;case 27:return Me(c),o===null&&Ri&&(y=c.stateNode=mp(c.type,c.pendingProps,Ee.current),Ur=c,ks=!0,C=dr,Lo(c.type)?(kd=C,dr=la(y.firstChild)):dr=C),ss(o,c,c.pendingProps.children,f),Lc(o,c),o===null&&(c.flags|=4194304),c.child;case 5:return o===null&&Ri&&((C=y=dr)&&(y=Pm(y,c.type,c.pendingProps,ks),y!==null?(c.stateNode=y,Ur=c,dr=la(y.firstChild),ks=!1,C=!0):C=!1),C||qa(c)),Me(c),C=c.type,W=c.pendingProps,ye=o!==null?o.memoizedProps:null,y=W.children,Cd(C,W)?y=null:ye!==null&&Cd(C,ye)&&(c.flags|=32),c.memoizedState!==null&&(C=wu(o,c,zp,null,null,f),uc._currentValue=C),Lc(o,c),ss(o,c,y,f),c.child;case 6:return o===null&&Ri&&((o=f=dr)&&(f=Im(f,c.pendingProps,ks),f!==null?(c.stateNode=f,Ur=c,dr=null,o=!0):o=!1),o||qa(c)),null;case 13:return rf(o,c,f);case 4:return Ae(c,c.stateNode.containerInfo),y=c.pendingProps,o===null?c.child=Zo(c,null,y,f):ss(o,c,y,f),c.child;case 11:return Kh(o,c,c.type,c.pendingProps,f);case 7:return ss(o,c,c.pendingProps,f),c.child;case 8:return ss(o,c,c.pendingProps.children,f),c.child;case 12:return ss(o,c,c.pendingProps.children,f),c.child;case 10:return y=c.pendingProps,ke(c,c.type,y.value),ss(o,c,y.children,f),c.child;case 9:return C=c.type._context,y=c.pendingProps.children,Wt(c),C=Mn(C),y=y(C),c.flags|=1,ss(o,c,y,f),c.child;case 14:return Xh(o,c,c.type,c.pendingProps,f);case 15:return Yh(o,c,c.type,c.pendingProps,f);case 19:return af(o,c,f);case 31:return Jp(o,c,f);case 22:return Qh(o,c,f,c.pendingProps);case 24:return Wt(c),y=Mn(mr),o===null?(C=gu(),C===null&&(C=hr,W=ro(),C.pooledCache=W,W.refCount++,W!==null&&(C.pooledCacheLanes|=f),C=W),c.memoizedState={parent:y,cache:C},yu(c),ke(c,mr,C)):((o.lanes&f)!==0&&(vu(o,c),zl(c,null,null,f),ql()),C=o.memoizedState,W=c.memoizedState,C.parent!==y?(C={parent:y,cache:y},c.memoizedState=C,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=C),ke(c,mr,y)):(y=W.cache,ke(c,mr,y),y!==C.cache&&et(c,[mr],f,!0))),ss(o,c,c.pendingProps.children,f),c.child;case 29:throw c.pendingProps}throw Error(n(156,c.tag))}function lo(o){o.flags|=4}function ed(o,c,f,y,C){if((c=(o.mode&32)!==0)&&(c=!1),c){if(o.flags|=16777216,(C&335544128)===C)if(o.stateNode.complete)o.flags|=8192;else if(Nf())o.flags|=8192;else throw Jo=bc,_u}else o.flags&=-16777217}function lf(o,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!xp(c))if(Nf())o.flags|=8192;else throw Jo=bc,_u}function Fc(o,c){c!==null&&(o.flags|=4),o.flags&16384&&(c=o.tag!==22?jn():536870912,o.lanes|=c,xl|=c)}function Yl(o,c){if(!Ri)switch(o.tailMode){case"hidden":c=o.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?o.tail=null:f.sibling=null;break;case"collapsed":f=o.tail;for(var y=null;f!==null;)f.alternate!==null&&(y=f),f=f.sibling;y===null?c||o.tail===null?o.tail=null:o.tail.sibling=null:y.sibling=null}}function vr(o){var c=o.alternate!==null&&o.alternate.child===o.child,f=0,y=0;if(c)for(var C=o.child;C!==null;)f|=C.lanes|C.childLanes,y|=C.subtreeFlags&65011712,y|=C.flags&65011712,C.return=o,C=C.sibling;else for(C=o.child;C!==null;)f|=C.lanes|C.childLanes,y|=C.subtreeFlags,y|=C.flags,C.return=o,C=C.sibling;return o.subtreeFlags|=y,o.childLanes=f,c}function em(o,c,f){var y=c.pendingProps;switch(Ds(c),c.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vr(c),null;case 1:return vr(c),null;case 3:return f=c.stateNode,y=null,o!==null&&(y=o.memoizedState.cache),c.memoizedState.cache!==y&&(c.flags|=2048),Ne(mr),Pe(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(o===null||o.child===null)&&(S(c)?lo(c):o===null||o.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,ie())),vr(c),null;case 26:var C=c.type,W=c.memoizedState;return o===null?(lo(c),W!==null?(vr(c),lf(c,W)):(vr(c),ed(c,C,null,y,f))):W?W!==o.memoizedState?(lo(c),vr(c),lf(c,W)):(vr(c),c.flags&=-16777217):(o=o.memoizedProps,o!==y&&lo(c),vr(c),ed(c,C,o,y,f)),null;case 27:if(We(c),f=Ee.current,C=c.type,o!==null&&c.stateNode!=null)o.memoizedProps!==y&&lo(c);else{if(!y){if(c.stateNode===null)throw Error(n(166));return vr(c),null}o=Z.current,S(c)?_c(c):(o=mp(C,y,f),c.stateNode=o,lo(c))}return vr(c),null;case 5:if(We(c),C=c.type,o!==null&&c.stateNode!=null)o.memoizedProps!==y&&lo(c);else{if(!y){if(c.stateNode===null)throw Error(n(166));return vr(c),null}if(W=Z.current,S(c))_c(c);else{var ye=Jc(Ee.current);switch(W){case 1:W=ye.createElementNS("http://www.w3.org/2000/svg",C);break;case 2:W=ye.createElementNS("http://www.w3.org/1998/Math/MathML",C);break;default:switch(C){case"svg":W=ye.createElementNS("http://www.w3.org/2000/svg",C);break;case"math":W=ye.createElementNS("http://www.w3.org/1998/Math/MathML",C);break;case"script":W=ye.createElement("div"),W.innerHTML="<script><\/script>",W=W.removeChild(W.firstChild);break;case"select":W=typeof y.is=="string"?ye.createElement("select",{is:y.is}):ye.createElement("select"),y.multiple?W.multiple=!0:y.size&&(W.size=y.size);break;default:W=typeof y.is=="string"?ye.createElement(C,{is:y.is}):ye.createElement(C)}}W[ci]=c,W[ir]=y;e:for(ye=c.child;ye!==null;){if(ye.tag===5||ye.tag===6)W.appendChild(ye.stateNode);else if(ye.tag!==4&&ye.tag!==27&&ye.child!==null){ye.child.return=ye,ye=ye.child;continue}if(ye===c)break e;for(;ye.sibling===null;){if(ye.return===null||ye.return===c)break e;ye=ye.return}ye.sibling.return=ye.return,ye=ye.sibling}c.stateNode=W;e:switch(as(W,C,y),C){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}y&&lo(c)}}return vr(c),ed(c,c.type,o===null?null:o.memoizedProps,c.pendingProps,f),null;case 6:if(o&&c.stateNode!=null)o.memoizedProps!==y&&lo(c);else{if(typeof y!="string"&&c.stateNode===null)throw Error(n(166));if(o=Ee.current,S(c)){if(o=c.stateNode,f=c.memoizedProps,y=null,C=Ur,C!==null)switch(C.tag){case 27:case 5:y=C.memoizedProps}o[ci]=c,o=!!(o.nodeValue===f||y!==null&&y.suppressHydrationWarning===!0||rp(o.nodeValue,f)),o||qa(c,!0)}else o=Jc(o).createTextNode(y),o[ci]=c,c.stateNode=o}return vr(c),null;case 31:if(f=c.memoizedState,o===null||o.memoizedState!==null){if(y=S(c),f!==null){if(o===null){if(!y)throw Error(n(318));if(o=c.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(557));o[ci]=c}else Y(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;vr(c),o=!1}else f=ie(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=f),o=!0;if(!o)return c.flags&256?(Ys(c),c):(Ys(c),null);if((c.flags&128)!==0)throw Error(n(558))}return vr(c),null;case 13:if(y=c.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(C=S(c),y!==null&&y.dehydrated!==null){if(o===null){if(!C)throw Error(n(318));if(C=c.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(n(317));C[ci]=c}else Y(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;vr(c),C=!1}else C=ie(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=C),C=!0;if(!C)return c.flags&256?(Ys(c),c):(Ys(c),null)}return Ys(c),(c.flags&128)!==0?(c.lanes=f,c):(f=y!==null,o=o!==null&&o.memoizedState!==null,f&&(y=c.child,C=null,y.alternate!==null&&y.alternate.memoizedState!==null&&y.alternate.memoizedState.cachePool!==null&&(C=y.alternate.memoizedState.cachePool.pool),W=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(W=y.memoizedState.cachePool.pool),W!==C&&(y.flags|=2048)),f!==o&&f&&(c.child.flags|=8192),Fc(c,c.updateQueue),vr(c),null);case 4:return Pe(),o===null&&Td(c.stateNode.containerInfo),vr(c),null;case 10:return Ne(c.type),vr(c),null;case 19:if(fe(Or),y=c.memoizedState,y===null)return vr(c),null;if(C=(c.flags&128)!==0,W=y.rendering,W===null)if(C)Yl(y,!1);else{if(Mr!==0||o!==null&&(o.flags&128)!==0)for(o=c.child;o!==null;){if(W=Sc(o),W!==null){for(c.flags|=128,Yl(y,!1),o=W.updateQueue,c.updateQueue=o,Fc(c,o),c.subtreeFlags=0,o=f,f=c.child;f!==null;)mc(f,o),f=f.sibling;return pe(Or,Or.current&1|2),Ri&&wi(c,y.treeForkCount),c.child}o=o.sibling}y.tail!==null&&In()>Hc&&(c.flags|=128,C=!0,Yl(y,!1),c.lanes=4194304)}else{if(!C)if(o=Sc(W),o!==null){if(c.flags|=128,C=!0,o=o.updateQueue,c.updateQueue=o,Fc(c,o),Yl(y,!0),y.tail===null&&y.tailMode==="hidden"&&!W.alternate&&!Ri)return vr(c),null}else 2*In()-y.renderingStartTime>Hc&&f!==536870912&&(c.flags|=128,C=!0,Yl(y,!1),c.lanes=4194304);y.isBackwards?(W.sibling=c.child,c.child=W):(o=y.last,o!==null?o.sibling=W:c.child=W,y.last=W)}return y.tail!==null?(o=y.tail,y.rendering=o,y.tail=o.sibling,y.renderingStartTime=In(),o.sibling=null,f=Or.current,pe(Or,C?f&1|2:f&1),Ri&&wi(c,y.treeForkCount),o):(vr(c),null);case 22:case 23:return Ys(c),xu(),y=c.memoizedState!==null,o!==null?o.memoizedState!==null!==y&&(c.flags|=8192):y&&(c.flags|=8192),y?(f&536870912)!==0&&(c.flags&128)===0&&(vr(c),c.subtreeFlags&6&&(c.flags|=8192)):vr(c),f=c.updateQueue,f!==null&&Fc(c,f.retryQueue),f=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),y=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(y=c.memoizedState.cachePool.pool),y!==f&&(c.flags|=2048),o!==null&&fe(Yo),null;case 24:return f=null,o!==null&&(f=o.memoizedState.cache),c.memoizedState.cache!==f&&(c.flags|=2048),Ne(mr),vr(c),null;case 25:return null;case 30:return null}throw Error(n(156,c.tag))}function tm(o,c){switch(Ds(c),c.tag){case 1:return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 3:return Ne(mr),Pe(),o=c.flags,(o&65536)!==0&&(o&128)===0?(c.flags=o&-65537|128,c):null;case 26:case 27:case 5:return We(c),null;case 31:if(c.memoizedState!==null){if(Ys(c),c.alternate===null)throw Error(n(340));Y()}return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 13:if(Ys(c),o=c.memoizedState,o!==null&&o.dehydrated!==null){if(c.alternate===null)throw Error(n(340));Y()}return o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 19:return fe(Or),null;case 4:return Pe(),null;case 10:return Ne(c.type),null;case 22:case 23:return Ys(c),xu(),o!==null&&fe(Yo),o=c.flags,o&65536?(c.flags=o&-65537|128,c):null;case 24:return Ne(mr),null;case 25:return null;default:return null}}function cf(o,c){switch(Ds(c),c.tag){case 3:Ne(mr),Pe();break;case 26:case 27:case 5:We(c);break;case 4:Pe();break;case 31:c.memoizedState!==null&&Ys(c);break;case 13:Ys(c);break;case 19:fe(Or);break;case 10:Ne(c.type);break;case 22:case 23:Ys(c),xu(),o!==null&&fe(Yo);break;case 24:Ne(mr)}}function Ql(o,c){try{var f=c.updateQueue,y=f!==null?f.lastEffect:null;if(y!==null){var C=y.next;f=C;do{if((f.tag&o)===o){y=void 0;var W=f.create,ye=f.inst;y=W(),ye.destroy=y}f=f.next}while(f!==C)}}catch(Re){tr(c,c.return,Re)}}function Ro(o,c,f){try{var y=c.updateQueue,C=y!==null?y.lastEffect:null;if(C!==null){var W=C.next;y=W;do{if((y.tag&o)===o){var ye=y.inst,Re=ye.destroy;if(Re!==void 0){ye.destroy=void 0,C=c;var He=f,At=Re;try{At()}catch(Qt){tr(C,He,Qt)}}}y=y.next}while(y!==W)}}catch(Qt){tr(c,c.return,Qt)}}function uf(o){var c=o.updateQueue;if(c!==null){var f=o.stateNode;try{Zd(c,f)}catch(y){tr(o,o.return,y)}}}function df(o,c,f){f.props=tl(o.type,o.memoizedProps),f.state=o.memoizedState;try{f.componentWillUnmount()}catch(y){tr(o,c,y)}}function Jl(o,c){try{var f=o.ref;if(f!==null){switch(o.tag){case 26:case 27:case 5:var y=o.stateNode;break;case 30:y=o.stateNode;break;default:y=o.stateNode}typeof f=="function"?o.refCleanup=f(y):f.current=y}}catch(C){tr(o,c,C)}}function Ga(o,c){var f=o.ref,y=o.refCleanup;if(f!==null)if(typeof y=="function")try{y()}catch(C){tr(o,c,C)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof f=="function")try{f(null)}catch(C){tr(o,c,C)}else f.current=null}function hf(o){var c=o.type,f=o.memoizedProps,y=o.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":f.autoFocus&&y.focus();break e;case"img":f.src?y.src=f.src:f.srcSet&&(y.srcset=f.srcSet)}}catch(C){tr(o,o.return,C)}}function td(o,c,f){try{var y=o.stateNode;xm(y,o.type,f,c),y[ir]=c}catch(C){tr(o,o.return,C)}}function ff(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&Lo(o.type)||o.tag===4}function nd(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||ff(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&Lo(o.type)||o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function id(o,c,f){var y=o.tag;if(y===5||y===6)o=o.stateNode,c?(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f).insertBefore(o,c):(c=f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,c.appendChild(o),f=f._reactRootContainer,f!=null||c.onclick!==null||(c.onclick=Qr));else if(y!==4&&(y===27&&Lo(o.type)&&(f=o.stateNode,c=null),o=o.child,o!==null))for(id(o,c,f),o=o.sibling;o!==null;)id(o,c,f),o=o.sibling}function Vc(o,c,f){var y=o.tag;if(y===5||y===6)o=o.stateNode,c?f.insertBefore(o,c):f.appendChild(o);else if(y!==4&&(y===27&&Lo(o.type)&&(f=o.stateNode),o=o.child,o!==null))for(Vc(o,c,f),o=o.sibling;o!==null;)Vc(o,c,f),o=o.sibling}function pf(o){var c=o.stateNode,f=o.memoizedProps;try{for(var y=o.type,C=c.attributes;C.length;)c.removeAttributeNode(C[0]);as(c,y,f),c[ci]=o,c[ir]=f}catch(W){tr(o,o.return,W)}}var co=!1,zr=!1,rd=!1,mf=typeof WeakSet=="function"?WeakSet:Set,es=null;function nm(o,c){if(o=o.containerInfo,Ad=su,o=gs(o),qo(o)){if("selectionStart"in o)var f={start:o.selectionStart,end:o.selectionEnd};else e:{f=(f=o.ownerDocument)&&f.defaultView||window;var y=f.getSelection&&f.getSelection();if(y&&y.rangeCount!==0){f=y.anchorNode;var C=y.anchorOffset,W=y.focusNode;y=y.focusOffset;try{f.nodeType,W.nodeType}catch{f=null;break e}var ye=0,Re=-1,He=-1,At=0,Qt=0,gn=o,kt=null;t:for(;;){for(var $t;gn!==f||C!==0&&gn.nodeType!==3||(Re=ye+C),gn!==W||y!==0&&gn.nodeType!==3||(He=ye+y),gn.nodeType===3&&(ye+=gn.nodeValue.length),($t=gn.firstChild)!==null;)kt=gn,gn=$t;for(;;){if(gn===o)break t;if(kt===f&&++At===C&&(Re=ye),kt===W&&++Qt===y&&(He=ye),($t=gn.nextSibling)!==null)break;gn=kt,kt=gn.parentNode}gn=$t}f=Re===-1||He===-1?null:{start:Re,end:He}}else f=null}f=f||{start:0,end:0}}else f=null;for(wd={focusedElem:o,selectionRange:f},su=!1,es=c;es!==null;)if(c=es,o=c.child,(c.subtreeFlags&1028)!==0&&o!==null)o.return=c,es=o;else for(;es!==null;){switch(c=es,W=c.alternate,o=c.flags,c.tag){case 0:if((o&4)!==0&&(o=c.updateQueue,o=o!==null?o.events:null,o!==null))for(f=0;f<o.length;f++)C=o[f],C.ref.impl=C.nextImpl;break;case 11:case 15:break;case 1:if((o&1024)!==0&&W!==null){o=void 0,f=c,C=W.memoizedProps,W=W.memoizedState,y=f.stateNode;try{var Hn=tl(f.type,C);o=y.getSnapshotBeforeUpdate(Hn,W),y.__reactInternalSnapshotBeforeUpdate=o}catch(ii){tr(f,f.return,ii)}}break;case 3:if((o&1024)!==0){if(o=c.stateNode.containerInfo,f=o.nodeType,f===9)Pd(o);else if(f===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":Pd(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(n(163))}if(o=c.sibling,o!==null){o.return=c.return,es=o;break}es=c.return}}function gf(o,c,f){var y=f.flags;switch(f.tag){case 0:case 11:case 15:ho(o,f),y&4&&Ql(5,f);break;case 1:if(ho(o,f),y&4)if(o=f.stateNode,c===null)try{o.componentDidMount()}catch(ye){tr(f,f.return,ye)}else{var C=tl(f.type,c.memoizedProps);c=c.memoizedState;try{o.componentDidUpdate(C,c,o.__reactInternalSnapshotBeforeUpdate)}catch(ye){tr(f,f.return,ye)}}y&64&&uf(f),y&512&&Jl(f,f.return);break;case 3:if(ho(o,f),y&64&&(o=f.updateQueue,o!==null)){if(c=null,f.child!==null)switch(f.child.tag){case 27:case 5:c=f.child.stateNode;break;case 1:c=f.child.stateNode}try{Zd(o,c)}catch(ye){tr(f,f.return,ye)}}break;case 27:c===null&&y&4&&pf(f);case 26:case 5:ho(o,f),c===null&&y&4&&hf(f),y&512&&Jl(f,f.return);break;case 12:ho(o,f);break;case 31:ho(o,f),y&4&&vf(o,f);break;case 13:ho(o,f),y&4&&bf(o,f),y&64&&(o=f.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(f=dm.bind(null,f),Dm(o,f))));break;case 22:if(y=f.memoizedState!==null||co,!y){c=c!==null&&c.memoizedState!==null||zr,C=co;var W=zr;co=y,(zr=c)&&!W?fo(o,f,(f.subtreeFlags&8772)!==0):ho(o,f),co=C,zr=W}break;case 30:break;default:ho(o,f)}}function _f(o){var c=o.alternate;c!==null&&(o.alternate=null,_f(c)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(c=o.stateNode,c!==null&&Ui(c)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var xr=null,Ms=!1;function uo(o,c,f){for(f=f.child;f!==null;)yf(o,c,f),f=f.sibling}function yf(o,c,f){if(xn&&typeof xn.onCommitFiberUnmount=="function")try{xn.onCommitFiberUnmount(Ye,f)}catch{}switch(f.tag){case 26:zr||Ga(f,c),uo(o,c,f),f.memoizedState?f.memoizedState.count--:f.stateNode&&(f=f.stateNode,f.parentNode.removeChild(f));break;case 27:zr||Ga(f,c);var y=xr,C=Ms;Lo(f.type)&&(xr=f.stateNode,Ms=!1),uo(o,c,f),oc(f.stateNode),xr=y,Ms=C;break;case 5:zr||Ga(f,c);case 6:if(y=xr,C=Ms,xr=null,uo(o,c,f),xr=y,Ms=C,xr!==null)if(Ms)try{(xr.nodeType===9?xr.body:xr.nodeName==="HTML"?xr.ownerDocument.body:xr).removeChild(f.stateNode)}catch(W){tr(f,c,W)}else try{xr.removeChild(f.stateNode)}catch(W){tr(f,c,W)}break;case 18:xr!==null&&(Ms?(o=xr,up(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,f.stateNode),Dl(o)):up(xr,f.stateNode));break;case 4:y=xr,C=Ms,xr=f.stateNode.containerInfo,Ms=!0,uo(o,c,f),xr=y,Ms=C;break;case 0:case 11:case 14:case 15:Ro(2,f,c),zr||Ro(4,f,c),uo(o,c,f);break;case 1:zr||(Ga(f,c),y=f.stateNode,typeof y.componentWillUnmount=="function"&&df(f,c,y)),uo(o,c,f);break;case 21:uo(o,c,f);break;case 22:zr=(y=zr)||f.memoizedState!==null,uo(o,c,f),zr=y;break;default:uo(o,c,f)}}function vf(o,c){if(c.memoizedState===null&&(o=c.alternate,o!==null&&(o=o.memoizedState,o!==null))){o=o.dehydrated;try{Dl(o)}catch(f){tr(c,c.return,f)}}}function bf(o,c){if(c.memoizedState===null&&(o=c.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{Dl(o)}catch(f){tr(c,c.return,f)}}function im(o){switch(o.tag){case 31:case 13:case 19:var c=o.stateNode;return c===null&&(c=o.stateNode=new mf),c;case 22:return o=o.stateNode,c=o._retryCache,c===null&&(c=o._retryCache=new mf),c;default:throw Error(n(435,o.tag))}}function Bc(o,c){var f=im(o);c.forEach(function(y){if(!f.has(y)){f.add(y);var C=hm.bind(null,o,y);y.then(C,C)}})}function Ns(o,c){var f=c.deletions;if(f!==null)for(var y=0;y<f.length;y++){var C=f[y],W=o,ye=c,Re=ye;e:for(;Re!==null;){switch(Re.tag){case 27:if(Lo(Re.type)){xr=Re.stateNode,Ms=!1;break e}break;case 5:xr=Re.stateNode,Ms=!1;break e;case 3:case 4:xr=Re.stateNode.containerInfo,Ms=!0;break e}Re=Re.return}if(xr===null)throw Error(n(160));yf(W,ye,C),xr=null,Ms=!1,W=C.alternate,W!==null&&(W.return=null),C.return=null}if(c.subtreeFlags&13886)for(c=c.child;c!==null;)Ef(c,o),c=c.sibling}var Aa=null;function Ef(o,c){var f=o.alternate,y=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Ns(c,o),Ls(o),y&4&&(Ro(3,o,o.return),Ql(3,o),Ro(5,o,o.return));break;case 1:Ns(c,o),Ls(o),y&512&&(zr||f===null||Ga(f,f.return)),y&64&&co&&(o=o.updateQueue,o!==null&&(y=o.callbacks,y!==null&&(f=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=f===null?y:f.concat(y))));break;case 26:var C=Aa;if(Ns(c,o),Ls(o),y&512&&(zr||f===null||Ga(f,f.return)),y&4){var W=f!==null?f.memoizedState:null;if(y=o.memoizedState,f===null)if(y===null)if(o.stateNode===null){e:{y=o.type,f=o.memoizedProps,C=C.ownerDocument||C;t:switch(y){case"title":W=C.getElementsByTagName("title")[0],(!W||W[Vr]||W[ci]||W.namespaceURI==="http://www.w3.org/2000/svg"||W.hasAttribute("itemprop"))&&(W=C.createElement(y),C.head.insertBefore(W,C.querySelector("head > title"))),as(W,y,f),W[ci]=o,lr(W),y=W;break e;case"link":var ye=Ep("link","href",C).get(y+(f.href||""));if(ye){for(var Re=0;Re<ye.length;Re++)if(W=ye[Re],W.getAttribute("href")===(f.href==null||f.href===""?null:f.href)&&W.getAttribute("rel")===(f.rel==null?null:f.rel)&&W.getAttribute("title")===(f.title==null?null:f.title)&&W.getAttribute("crossorigin")===(f.crossOrigin==null?null:f.crossOrigin)){ye.splice(Re,1);break t}}W=C.createElement(y),as(W,y,f),C.head.appendChild(W);break;case"meta":if(ye=Ep("meta","content",C).get(y+(f.content||""))){for(Re=0;Re<ye.length;Re++)if(W=ye[Re],W.getAttribute("content")===(f.content==null?null:""+f.content)&&W.getAttribute("name")===(f.name==null?null:f.name)&&W.getAttribute("property")===(f.property==null?null:f.property)&&W.getAttribute("http-equiv")===(f.httpEquiv==null?null:f.httpEquiv)&&W.getAttribute("charset")===(f.charSet==null?null:f.charSet)){ye.splice(Re,1);break t}}W=C.createElement(y),as(W,y,f),C.head.appendChild(W);break;default:throw Error(n(468,y))}W[ci]=o,lr(W),y=W}o.stateNode=y}else Tp(C,o.type,o.stateNode);else o.stateNode=bp(C,y,o.memoizedProps);else W!==y?(W===null?f.stateNode!==null&&(f=f.stateNode,f.parentNode.removeChild(f)):W.count--,y===null?Tp(C,o.type,o.stateNode):bp(C,y,o.memoizedProps)):y===null&&o.stateNode!==null&&td(o,o.memoizedProps,f.memoizedProps)}break;case 27:Ns(c,o),Ls(o),y&512&&(zr||f===null||Ga(f,f.return)),f!==null&&y&4&&td(o,o.memoizedProps,f.memoizedProps);break;case 5:if(Ns(c,o),Ls(o),y&512&&(zr||f===null||Ga(f,f.return)),o.flags&32){C=o.stateNode;try{Pr(C,"")}catch(Hn){tr(o,o.return,Hn)}}y&4&&o.stateNode!=null&&(C=o.memoizedProps,td(o,C,f!==null?f.memoizedProps:C)),y&1024&&(rd=!0);break;case 6:if(Ns(c,o),Ls(o),y&4){if(o.stateNode===null)throw Error(n(162));y=o.memoizedProps,f=o.stateNode;try{f.nodeValue=y}catch(Hn){tr(o,o.return,Hn)}}break;case 3:if(tu=null,C=Aa,Aa=Zc(c.containerInfo),Ns(c,o),Aa=C,Ls(o),y&4&&f!==null&&f.memoizedState.isDehydrated)try{Dl(c.containerInfo)}catch(Hn){tr(o,o.return,Hn)}rd&&(rd=!1,Tf(o));break;case 4:y=Aa,Aa=Zc(o.stateNode.containerInfo),Ns(c,o),Ls(o),Aa=y;break;case 12:Ns(c,o),Ls(o);break;case 31:Ns(c,o),Ls(o),y&4&&(y=o.updateQueue,y!==null&&(o.updateQueue=null,Bc(o,y)));break;case 13:Ns(c,o),Ls(o),o.child.flags&8192&&o.memoizedState!==null!=(f!==null&&f.memoizedState!==null)&&(Uc=In()),y&4&&(y=o.updateQueue,y!==null&&(o.updateQueue=null,Bc(o,y)));break;case 22:C=o.memoizedState!==null;var He=f!==null&&f.memoizedState!==null,At=co,Qt=zr;if(co=At||C,zr=Qt||He,Ns(c,o),zr=Qt,co=At,Ls(o),y&8192)e:for(c=o.stateNode,c._visibility=C?c._visibility&-2:c._visibility|1,C&&(f===null||He||co||zr||nl(o)),f=null,c=o;;){if(c.tag===5||c.tag===26){if(f===null){He=f=c;try{if(W=He.stateNode,C)ye=W.style,typeof ye.setProperty=="function"?ye.setProperty("display","none","important"):ye.display="none";else{Re=He.stateNode;var gn=He.memoizedProps.style,kt=gn!=null&&gn.hasOwnProperty("display")?gn.display:null;Re.style.display=kt==null||typeof kt=="boolean"?"":(""+kt).trim()}}catch(Hn){tr(He,He.return,Hn)}}}else if(c.tag===6){if(f===null){He=c;try{He.stateNode.nodeValue=C?"":He.memoizedProps}catch(Hn){tr(He,He.return,Hn)}}}else if(c.tag===18){if(f===null){He=c;try{var $t=He.stateNode;C?dp($t,!0):dp(He.stateNode,!1)}catch(Hn){tr(He,He.return,Hn)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===o)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break e;for(;c.sibling===null;){if(c.return===null||c.return===o)break e;f===c&&(f=null),c=c.return}f===c&&(f=null),c.sibling.return=c.return,c=c.sibling}y&4&&(y=o.updateQueue,y!==null&&(f=y.retryQueue,f!==null&&(y.retryQueue=null,Bc(o,f))));break;case 19:Ns(c,o),Ls(o),y&4&&(y=o.updateQueue,y!==null&&(o.updateQueue=null,Bc(o,y)));break;case 30:break;case 21:break;default:Ns(c,o),Ls(o)}}function Ls(o){var c=o.flags;if(c&2){try{for(var f,y=o.return;y!==null;){if(ff(y)){f=y;break}y=y.return}if(f==null)throw Error(n(160));switch(f.tag){case 27:var C=f.stateNode,W=nd(o);Vc(o,W,C);break;case 5:var ye=f.stateNode;f.flags&32&&(Pr(ye,""),f.flags&=-33);var Re=nd(o);Vc(o,Re,ye);break;case 3:case 4:var He=f.stateNode.containerInfo,At=nd(o);id(o,At,He);break;default:throw Error(n(161))}}catch(Qt){tr(o,o.return,Qt)}o.flags&=-3}c&4096&&(o.flags&=-4097)}function Tf(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var c=o;Tf(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),o=o.sibling}}function ho(o,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)gf(o,c.alternate,c),c=c.sibling}function nl(o){for(o=o.child;o!==null;){var c=o;switch(c.tag){case 0:case 11:case 14:case 15:Ro(4,c,c.return),nl(c);break;case 1:Ga(c,c.return);var f=c.stateNode;typeof f.componentWillUnmount=="function"&&df(c,c.return,f),nl(c);break;case 27:oc(c.stateNode);case 26:case 5:Ga(c,c.return),nl(c);break;case 22:c.memoizedState===null&&nl(c);break;case 30:nl(c);break;default:nl(c)}o=o.sibling}}function fo(o,c,f){for(f=f&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var y=c.alternate,C=o,W=c,ye=W.flags;switch(W.tag){case 0:case 11:case 15:fo(C,W,f),Ql(4,W);break;case 1:if(fo(C,W,f),y=W,C=y.stateNode,typeof C.componentDidMount=="function")try{C.componentDidMount()}catch(At){tr(y,y.return,At)}if(y=W,C=y.updateQueue,C!==null){var Re=y.stateNode;try{var He=C.shared.hiddenCallbacks;if(He!==null)for(C.shared.hiddenCallbacks=null,C=0;C<He.length;C++)Jd(He[C],Re)}catch(At){tr(y,y.return,At)}}f&&ye&64&&uf(W),Jl(W,W.return);break;case 27:pf(W);case 26:case 5:fo(C,W,f),f&&y===null&&ye&4&&hf(W),Jl(W,W.return);break;case 12:fo(C,W,f);break;case 31:fo(C,W,f),f&&ye&4&&vf(C,W);break;case 13:fo(C,W,f),f&&ye&4&&bf(C,W);break;case 22:W.memoizedState===null&&fo(C,W,f),Jl(W,W.return);break;case 30:break;default:fo(C,W,f)}c=c.sibling}}function sd(o,c){var f=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),o=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(o=c.memoizedState.cachePool.pool),o!==f&&(o!=null&&o.refCount++,f!=null&&Sa(f))}function ad(o,c){o=null,c.alternate!==null&&(o=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==o&&(c.refCount++,o!=null&&Sa(o))}function wa(o,c,f,y){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)xf(o,c,f,y),c=c.sibling}function xf(o,c,f,y){var C=c.flags;switch(c.tag){case 0:case 11:case 15:wa(o,c,f,y),C&2048&&Ql(9,c);break;case 1:wa(o,c,f,y);break;case 3:wa(o,c,f,y),C&2048&&(o=null,c.alternate!==null&&(o=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==o&&(c.refCount++,o!=null&&Sa(o)));break;case 12:if(C&2048){wa(o,c,f,y),o=c.stateNode;try{var W=c.memoizedProps,ye=W.id,Re=W.onPostCommit;typeof Re=="function"&&Re(ye,c.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(He){tr(c,c.return,He)}}else wa(o,c,f,y);break;case 31:wa(o,c,f,y);break;case 13:wa(o,c,f,y);break;case 23:break;case 22:W=c.stateNode,ye=c.alternate,c.memoizedState!==null?W._visibility&2?wa(o,c,f,y):Zl(o,c):W._visibility&2?wa(o,c,f,y):(W._visibility|=2,bl(o,c,f,y,(c.subtreeFlags&10256)!==0||!1)),C&2048&&sd(ye,c);break;case 24:wa(o,c,f,y),C&2048&&ad(c.alternate,c);break;default:wa(o,c,f,y)}}function bl(o,c,f,y,C){for(C=C&&((c.subtreeFlags&10256)!==0||!1),c=c.child;c!==null;){var W=o,ye=c,Re=f,He=y,At=ye.flags;switch(ye.tag){case 0:case 11:case 15:bl(W,ye,Re,He,C),Ql(8,ye);break;case 23:break;case 22:var Qt=ye.stateNode;ye.memoizedState!==null?Qt._visibility&2?bl(W,ye,Re,He,C):Zl(W,ye):(Qt._visibility|=2,bl(W,ye,Re,He,C)),C&&At&2048&&sd(ye.alternate,ye);break;case 24:bl(W,ye,Re,He,C),C&&At&2048&&ad(ye.alternate,ye);break;default:bl(W,ye,Re,He,C)}c=c.sibling}}function Zl(o,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var f=o,y=c,C=y.flags;switch(y.tag){case 22:Zl(f,y),C&2048&&sd(y.alternate,y);break;case 24:Zl(f,y),C&2048&&ad(y.alternate,y);break;default:Zl(f,y)}c=c.sibling}}var ec=8192;function El(o,c,f){if(o.subtreeFlags&ec)for(o=o.child;o!==null;)Sf(o,c,f),o=o.sibling}function Sf(o,c,f){switch(o.tag){case 26:El(o,c,f),o.flags&ec&&o.memoizedState!==null&&qm(f,Aa,o.memoizedState,o.memoizedProps);break;case 5:El(o,c,f);break;case 3:case 4:var y=Aa;Aa=Zc(o.stateNode.containerInfo),El(o,c,f),Aa=y;break;case 22:o.memoizedState===null&&(y=o.alternate,y!==null&&y.memoizedState!==null?(y=ec,ec=16777216,El(o,c,f),ec=y):El(o,c,f));break;default:El(o,c,f)}}function Af(o){var c=o.alternate;if(c!==null&&(o=c.child,o!==null)){c.child=null;do c=o.sibling,o.sibling=null,o=c;while(o!==null)}}function tc(o){var c=o.deletions;if((o.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var y=c[f];es=y,Cf(y,o)}Af(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)wf(o),o=o.sibling}function wf(o){switch(o.tag){case 0:case 11:case 15:tc(o),o.flags&2048&&Ro(9,o,o.return);break;case 3:tc(o);break;case 12:tc(o);break;case 22:var c=o.stateNode;o.memoizedState!==null&&c._visibility&2&&(o.return===null||o.return.tag!==13)?(c._visibility&=-3,jc(o)):tc(o);break;default:tc(o)}}function jc(o){var c=o.deletions;if((o.flags&16)!==0){if(c!==null)for(var f=0;f<c.length;f++){var y=c[f];es=y,Cf(y,o)}Af(o)}for(o=o.child;o!==null;){switch(c=o,c.tag){case 0:case 11:case 15:Ro(8,c,c.return),jc(c);break;case 22:f=c.stateNode,f._visibility&2&&(f._visibility&=-3,jc(c));break;default:jc(c)}o=o.sibling}}function Cf(o,c){for(;es!==null;){var f=es;switch(f.tag){case 0:case 11:case 15:Ro(8,f,c);break;case 23:case 22:if(f.memoizedState!==null&&f.memoizedState.cachePool!==null){var y=f.memoizedState.cachePool.pool;y!=null&&y.refCount++}break;case 24:Sa(f.memoizedState.cache)}if(y=f.child,y!==null)y.return=f,es=y;else e:for(f=o;es!==null;){y=es;var C=y.sibling,W=y.return;if(_f(y),y===f){es=null;break e}if(C!==null){C.return=W,es=C;break e}es=W}}}var rm={getCacheForType:function(o){var c=Mn(mr),f=c.data.get(o);return f===void 0&&(f=o(),c.data.set(o,f)),f},cacheSignal:function(){return Mn(mr).controller.signal}},sm=typeof WeakMap=="function"?WeakMap:Map,Ki=0,hr=null,Pi=null,Mi=0,er=0,Qs=null,Po=!1,Tl=!1,od=!1,po=0,Mr=0,Io=0,il=0,ld=0,Js=0,xl=0,nc=null,Os=null,cd=!1,Uc=0,Rf=0,Hc=1/0,qc=null,Do=null,Yr=0,ko=null,Sl=null,mo=0,ud=0,dd=null,Pf=null,ic=0,hd=null;function Zs(){return(Ki&2)!==0&&Mi!==0?Mi&-Mi:le.T!==null?yd():$r()}function If(){if(Js===0)if((Mi&536870912)===0||Ri){var o=Li;Li<<=1,(Li&3932160)===0&&(Li=262144),Js=o}else Js=536870912;return o=Xs.current,o!==null&&(o.flags|=32),Js}function Fs(o,c,f){(o===hr&&(er===2||er===9)||o.cancelPendingCommit!==null)&&(Al(o,0),Mo(o,Mi,Js,!1)),Fi(o,f),((Ki&2)===0||o!==hr)&&(o===hr&&((Ki&2)===0&&(il|=f),Mr===4&&Mo(o,Mi,Js,!1)),Wa(o))}function Df(o,c,f){if((Ki&6)!==0)throw Error(n(327));var y=!f&&(c&127)===0&&(c&o.expiredLanes)===0||tt(o,c),C=y?lm(o,c):pd(o,c,!0),W=y;do{if(C===0){Tl&&!y&&Mo(o,c,0,!1);break}else{if(f=o.current.alternate,W&&!am(f)){C=pd(o,c,!1),W=!1;continue}if(C===2){if(W=c,o.errorRecoveryDisabledLanes&W)var ye=0;else ye=o.pendingLanes&-536870913,ye=ye!==0?ye:ye&536870912?536870912:0;if(ye!==0){c=ye;e:{var Re=o;C=nc;var He=Re.current.memoizedState.isDehydrated;if(He&&(Al(Re,ye).flags|=256),ye=pd(Re,ye,!1),ye!==2){if(od&&!He){Re.errorRecoveryDisabledLanes|=W,il|=W,C=4;break e}W=Os,Os=C,W!==null&&(Os===null?Os=W:Os.push.apply(Os,W))}C=ye}if(W=!1,C!==2)continue}}if(C===1){Al(o,0),Mo(o,c,0,!0);break}e:{switch(y=o,W=C,W){case 0:case 1:throw Error(n(345));case 4:if((c&4194048)!==c)break;case 6:Mo(y,c,Js,!Po);break e;case 2:Os=null;break;case 3:case 5:break;default:throw Error(n(329))}if((c&62914560)===c&&(C=Uc+300-In(),10<C)){if(Mo(y,c,Js,!Po),Fe(y,0,!0)!==0)break e;mo=c,y.timeoutHandle=lp(kf.bind(null,y,f,Os,qc,cd,c,Js,il,xl,Po,W,"Throttled",-0,0),C);break e}kf(y,f,Os,qc,cd,c,Js,il,xl,Po,W,null,-0,0)}}break}while(!0);Wa(o)}function kf(o,c,f,y,C,W,ye,Re,He,At,Qt,gn,kt,$t){if(o.timeoutHandle=-1,gn=c.subtreeFlags,gn&8192||(gn&16785408)===16785408){gn={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Qr},Sf(c,W,gn);var Hn=(W&62914560)===W?Uc-In():(W&4194048)===W?Rf-In():0;if(Hn=zm(gn,Hn),Hn!==null){mo=W,o.cancelPendingCommit=Hn(jf.bind(null,o,c,W,f,y,C,ye,Re,He,Qt,gn,null,kt,$t)),Mo(o,W,ye,!At);return}}jf(o,c,W,f,y,C,ye,Re,He)}function am(o){for(var c=o;;){var f=c.tag;if((f===0||f===11||f===15)&&c.flags&16384&&(f=c.updateQueue,f!==null&&(f=f.stores,f!==null)))for(var y=0;y<f.length;y++){var C=f[y],W=C.getSnapshot;C=C.value;try{if(!jr(W(),C))return!1}catch{return!1}}if(f=c.child,c.subtreeFlags&16384&&f!==null)f.return=c,c=f;else{if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function Mo(o,c,f,y){c&=~ld,c&=~il,o.suspendedLanes|=c,o.pingedLanes&=~c,y&&(o.warmLanes|=c),y=o.expirationTimes;for(var C=c;0<C;){var W=31-Bn(C),ye=1<<W;y[W]=-1,C&=~ye}f!==0&&Di(o,f,c)}function zc(){return(Ki&6)===0?(rc(0),!1):!0}function fd(){if(Pi!==null){if(er===0)var o=Pi.return;else o=Pi,Ie=ge=null,Pu(o),ml=null,jl=0,o=Pi;for(;o!==null;)cf(o.alternate,o),o=o.return;Pi=null}}function Al(o,c){var f=o.timeoutHandle;f!==-1&&(o.timeoutHandle=-1,wm(f)),f=o.cancelPendingCommit,f!==null&&(o.cancelPendingCommit=null,f()),mo=0,fd(),hr=o,Pi=f=xa(o.current,null),Mi=c,er=0,Qs=null,Po=!1,Tl=tt(o,c),od=!1,xl=Js=ld=il=Io=Mr=0,Os=nc=null,cd=!1,(c&8)!==0&&(c|=c&32);var y=o.entangledLanes;if(y!==0)for(o=o.entanglements,y&=c;0<y;){var C=31-Bn(y),W=1<<C;c|=o[C],y&=~W}return po=c,Va(),f}function Mf(o,c){xi=null,le.H=Kl,c===pl||c===vc?(c=Kd(),er=3):c===_u?(c=Kd(),er=4):er=c===$u?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,Qs=c,Pi===null&&(Mr=1,Mc(o,Ps(c,o.current)))}function Nf(){var o=Xs.current;return o===null?!0:(Mi&4194048)===Mi?oa===null:(Mi&62914560)===Mi||(Mi&536870912)!==0?o===oa:!1}function Lf(){var o=le.H;return le.H=Kl,o===null?Kl:o}function Of(){var o=le.A;return le.A=rm,o}function $c(){Mr=4,Po||(Mi&4194048)!==Mi&&Xs.current!==null||(Tl=!0),(Io&134217727)===0&&(il&134217727)===0||hr===null||Mo(hr,Mi,Js,!1)}function pd(o,c,f){var y=Ki;Ki|=2;var C=Lf(),W=Of();(hr!==o||Mi!==c)&&(qc=null,Al(o,c)),c=!1;var ye=Mr;e:do try{if(er!==0&&Pi!==null){var Re=Pi,He=Qs;switch(er){case 8:fd(),ye=6;break e;case 3:case 2:case 9:case 6:Xs.current===null&&(c=!0);var At=er;if(er=0,Qs=null,wl(o,Re,He,At),f&&Tl){ye=0;break e}break;default:At=er,er=0,Qs=null,wl(o,Re,He,At)}}om(),ye=Mr;break}catch(Qt){Mf(o,Qt)}while(!0);return c&&o.shellSuspendCounter++,Ie=ge=null,Ki=y,le.H=C,le.A=W,Pi===null&&(hr=null,Mi=0,Va()),ye}function om(){for(;Pi!==null;)Ff(Pi)}function lm(o,c){var f=Ki;Ki|=2;var y=Lf(),C=Of();hr!==o||Mi!==c?(qc=null,Hc=In()+500,Al(o,c)):Tl=tt(o,c);e:do try{if(er!==0&&Pi!==null){c=Pi;var W=Qs;t:switch(er){case 1:er=0,Qs=null,wl(o,c,W,1);break;case 2:case 9:if(Gd(W)){er=0,Qs=null,Vf(c);break}c=function(){er!==2&&er!==9||hr!==o||(er=7),Wa(o)},W.then(c,c);break e;case 3:er=7;break e;case 4:er=5;break e;case 7:Gd(W)?(er=0,Qs=null,Vf(c)):(er=0,Qs=null,wl(o,c,W,7));break;case 5:var ye=null;switch(Pi.tag){case 26:ye=Pi.memoizedState;case 5:case 27:var Re=Pi;if(ye?xp(ye):Re.stateNode.complete){er=0,Qs=null;var He=Re.sibling;if(He!==null)Pi=He;else{var At=Re.return;At!==null?(Pi=At,Gc(At)):Pi=null}break t}}er=0,Qs=null,wl(o,c,W,5);break;case 6:er=0,Qs=null,wl(o,c,W,6);break;case 8:fd(),Mr=6;break e;default:throw Error(n(462))}}cm();break}catch(Qt){Mf(o,Qt)}while(!0);return Ie=ge=null,le.H=y,le.A=C,Ki=f,Pi!==null?0:(hr=null,Mi=0,Va(),Mr)}function cm(){for(;Pi!==null&&!pn();)Ff(Pi)}function Ff(o){var c=of(o.alternate,o,po);o.memoizedProps=o.pendingProps,c===null?Gc(o):Pi=c}function Vf(o){var c=o,f=c.alternate;switch(c.tag){case 15:case 0:c=ef(f,c,c.pendingProps,c.type,void 0,Mi);break;case 11:c=ef(f,c,c.pendingProps,c.type.render,c.ref,Mi);break;case 5:Pu(c);default:cf(f,c),c=Pi=mc(c,po),c=of(f,c,po)}o.memoizedProps=o.pendingProps,c===null?Gc(o):Pi=c}function wl(o,c,f,y){Ie=ge=null,Pu(c),ml=null,jl=0;var C=c.return;try{if(Qp(o,C,c,f,Mi)){Mr=1,Mc(o,Ps(f,o.current)),Pi=null;return}}catch(W){if(C!==null)throw Pi=C,W;Mr=1,Mc(o,Ps(f,o.current)),Pi=null;return}c.flags&32768?(Ri||y===1?o=!0:Tl||(Mi&536870912)!==0?o=!1:(Po=o=!0,(y===2||y===9||y===3||y===6)&&(y=Xs.current,y!==null&&y.tag===13&&(y.flags|=16384))),Bf(c,o)):Gc(c)}function Gc(o){var c=o;do{if((c.flags&32768)!==0){Bf(c,Po);return}o=c.return;var f=em(c.alternate,c,po);if(f!==null){Pi=f;return}if(c=c.sibling,c!==null){Pi=c;return}Pi=c=o}while(c!==null);Mr===0&&(Mr=5)}function Bf(o,c){do{var f=tm(o.alternate,o);if(f!==null){f.flags&=32767,Pi=f;return}if(f=o.return,f!==null&&(f.flags|=32768,f.subtreeFlags=0,f.deletions=null),!c&&(o=o.sibling,o!==null)){Pi=o;return}Pi=o=f}while(o!==null);Mr=6,Pi=null}function jf(o,c,f,y,C,W,ye,Re,He){o.cancelPendingCommit=null;do Wc();while(Yr!==0);if((Ki&6)!==0)throw Error(n(327));if(c!==null){if(c===o.current)throw Error(n(177));if(W=c.lanes|c.childLanes,W|=ws,Qi(o,f,W,ye,Re,He),o===hr&&(Pi=hr=null,Mi=0),Sl=c,ko=o,mo=f,ud=W,dd=C,Pf=y,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,fm(hi,function(){return $f(),null})):(o.callbackNode=null,o.callbackPriority=0),y=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||y){y=le.T,le.T=null,C=ue.p,ue.p=2,ye=Ki,Ki|=4;try{nm(o,c,f)}finally{Ki=ye,ue.p=C,le.T=y}}Yr=1,Uf(),Hf(),qf()}}function Uf(){if(Yr===1){Yr=0;var o=ko,c=Sl,f=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||f){f=le.T,le.T=null;var y=ue.p;ue.p=2;var C=Ki;Ki|=4;try{Ef(c,o);var W=wd,ye=gs(o.containerInfo),Re=W.focusedElem,He=W.selectionRange;if(ye!==Re&&Re&&Re.ownerDocument&&ga(Re.ownerDocument.documentElement,Re)){if(He!==null&&qo(Re)){var At=He.start,Qt=He.end;if(Qt===void 0&&(Qt=At),"selectionStart"in Re)Re.selectionStart=At,Re.selectionEnd=Math.min(Qt,Re.value.length);else{var gn=Re.ownerDocument||document,kt=gn&&gn.defaultView||window;if(kt.getSelection){var $t=kt.getSelection(),Hn=Re.textContent.length,ii=Math.min(He.start,Hn),or=He.end===void 0?ii:Math.min(He.end,Hn);!$t.extend&&ii>or&&(ye=or,or=ii,ii=ye);var it=pr(Re,ii),Qe=pr(Re,or);if(it&&Qe&&($t.rangeCount!==1||$t.anchorNode!==it.node||$t.anchorOffset!==it.offset||$t.focusNode!==Qe.node||$t.focusOffset!==Qe.offset)){var vt=gn.createRange();vt.setStart(it.node,it.offset),$t.removeAllRanges(),ii>or?($t.addRange(vt),$t.extend(Qe.node,Qe.offset)):(vt.setEnd(Qe.node,Qe.offset),$t.addRange(vt))}}}}for(gn=[],$t=Re;$t=$t.parentNode;)$t.nodeType===1&&gn.push({element:$t,left:$t.scrollLeft,top:$t.scrollTop});for(typeof Re.focus=="function"&&Re.focus(),Re=0;Re<gn.length;Re++){var fn=gn[Re];fn.element.scrollLeft=fn.left,fn.element.scrollTop=fn.top}}su=!!Ad,wd=Ad=null}finally{Ki=C,ue.p=y,le.T=f}}o.current=c,Yr=2}}function Hf(){if(Yr===2){Yr=0;var o=ko,c=Sl,f=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||f){f=le.T,le.T=null;var y=ue.p;ue.p=2;var C=Ki;Ki|=4;try{gf(o,c.alternate,c)}finally{Ki=C,ue.p=y,le.T=f}}Yr=3}}function qf(){if(Yr===4||Yr===3){Yr=0,An();var o=ko,c=Sl,f=mo,y=Pf;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?Yr=5:(Yr=0,Sl=ko=null,zf(o,o.pendingLanes));var C=o.pendingLanes;if(C===0&&(Do=null),Vi(f),c=c.stateNode,xn&&typeof xn.onCommitFiberRoot=="function")try{xn.onCommitFiberRoot(Ye,c,void 0,(c.current.flags&128)===128)}catch{}if(y!==null){c=le.T,C=ue.p,ue.p=2,le.T=null;try{for(var W=o.onRecoverableError,ye=0;ye<y.length;ye++){var Re=y[ye];W(Re.value,{componentStack:Re.stack})}}finally{le.T=c,ue.p=C}}(mo&3)!==0&&Wc(),Wa(o),C=o.pendingLanes,(f&261930)!==0&&(C&42)!==0?o===hd?ic++:(ic=0,hd=o):ic=0,rc(0)}}function zf(o,c){(o.pooledCacheLanes&=c)===0&&(c=o.pooledCache,c!=null&&(o.pooledCache=null,Sa(c)))}function Wc(){return Uf(),Hf(),qf(),$f()}function $f(){if(Yr!==5)return!1;var o=ko,c=ud;ud=0;var f=Vi(mo),y=le.T,C=ue.p;try{ue.p=32>f?32:f,le.T=null,f=dd,dd=null;var W=ko,ye=mo;if(Yr=0,Sl=ko=null,mo=0,(Ki&6)!==0)throw Error(n(331));var Re=Ki;if(Ki|=4,wf(W.current),xf(W,W.current,ye,f),Ki=Re,rc(0,!1),xn&&typeof xn.onPostCommitFiberRoot=="function")try{xn.onPostCommitFiberRoot(Ye,W)}catch{}return!0}finally{ue.p=C,le.T=y,zf(o,c)}}function Gf(o,c,f){c=Ps(f,c),c=zu(o.stateNode,c,2),o=Ao(o,c,2),o!==null&&(Fi(o,2),Wa(o))}function tr(o,c,f){if(o.tag===3)Gf(o,o,f);else for(;c!==null;){if(c.tag===3){Gf(c,o,f);break}else if(c.tag===1){var y=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(Do===null||!Do.has(y))){o=Ps(f,o),f=Gh(2),y=Ao(c,f,2),y!==null&&(Wh(f,y,c,o),Fi(y,2),Wa(y));break}}c=c.return}}function md(o,c,f){var y=o.pingCache;if(y===null){y=o.pingCache=new sm;var C=new Set;y.set(c,C)}else C=y.get(c),C===void 0&&(C=new Set,y.set(c,C));C.has(f)||(od=!0,C.add(f),o=um.bind(null,o,c,f),c.then(o,o))}function um(o,c,f){var y=o.pingCache;y!==null&&y.delete(c),o.pingedLanes|=o.suspendedLanes&f,o.warmLanes&=~f,hr===o&&(Mi&f)===f&&(Mr===4||Mr===3&&(Mi&62914560)===Mi&&300>In()-Uc?(Ki&2)===0&&Al(o,0):ld|=f,xl===Mi&&(xl=0)),Wa(o)}function Wf(o,c){c===0&&(c=jn()),o=Rs(o,c),o!==null&&(Fi(o,c),Wa(o))}function dm(o){var c=o.memoizedState,f=0;c!==null&&(f=c.retryLane),Wf(o,f)}function hm(o,c){var f=0;switch(o.tag){case 31:case 13:var y=o.stateNode,C=o.memoizedState;C!==null&&(f=C.retryLane);break;case 19:y=o.stateNode;break;case 22:y=o.stateNode._retryCache;break;default:throw Error(n(314))}y!==null&&y.delete(c),Wf(o,f)}function fm(o,c){return nt(o,c)}var Kc=null,Cl=null,gd=!1,Xc=!1,_d=!1,No=0;function Wa(o){o!==Cl&&o.next===null&&(Cl===null?Kc=Cl=o:Cl=Cl.next=o),Xc=!0,gd||(gd=!0,mm())}function rc(o,c){if(!_d&&Xc){_d=!0;do for(var f=!1,y=Kc;y!==null;){if(o!==0){var C=y.pendingLanes;if(C===0)var W=0;else{var ye=y.suspendedLanes,Re=y.pingedLanes;W=(1<<31-Bn(42|o)+1)-1,W&=C&~(ye&~Re),W=W&201326741?W&201326741|1:W?W|2:0}W!==0&&(f=!0,Qf(y,W))}else W=Mi,W=Fe(y,y===hr?W:0,y.cancelPendingCommit!==null||y.timeoutHandle!==-1),(W&3)===0||tt(y,W)||(f=!0,Qf(y,W));y=y.next}while(f);_d=!1}}function pm(){Kf()}function Kf(){Xc=gd=!1;var o=0;No!==0&&Am()&&(o=No);for(var c=In(),f=null,y=Kc;y!==null;){var C=y.next,W=Xf(y,c);W===0?(y.next=null,f===null?Kc=C:f.next=C,C===null&&(Cl=f)):(f=y,(o!==0||(W&3)!==0)&&(Xc=!0)),y=C}Yr!==0&&Yr!==5||rc(o),No!==0&&(No=0)}function Xf(o,c){for(var f=o.suspendedLanes,y=o.pingedLanes,C=o.expirationTimes,W=o.pendingLanes&-62914561;0<W;){var ye=31-Bn(W),Re=1<<ye,He=C[ye];He===-1?((Re&f)===0||(Re&y)!==0)&&(C[ye]=Tn(Re,c)):He<=c&&(o.expiredLanes|=Re),W&=~Re}if(c=hr,f=Mi,f=Fe(o,o===c?f:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),y=o.callbackNode,f===0||o===c&&(er===2||er===9)||o.cancelPendingCommit!==null)return y!==null&&y!==null&&dn(y),o.callbackNode=null,o.callbackPriority=0;if((f&3)===0||tt(o,f)){if(c=f&-f,c===o.callbackPriority)return c;switch(y!==null&&dn(y),Vi(f)){case 2:case 8:f=Wn;break;case 32:f=hi;break;case 268435456:f=Zn;break;default:f=hi}return y=Yf.bind(null,o),f=nt(f,y),o.callbackPriority=c,o.callbackNode=f,c}return y!==null&&y!==null&&dn(y),o.callbackPriority=2,o.callbackNode=null,2}function Yf(o,c){if(Yr!==0&&Yr!==5)return o.callbackNode=null,o.callbackPriority=0,null;var f=o.callbackNode;if(Wc()&&o.callbackNode!==f)return null;var y=Mi;return y=Fe(o,o===hr?y:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),y===0?null:(Df(o,y,c),Xf(o,In()),o.callbackNode!=null&&o.callbackNode===f?Yf.bind(null,o):null)}function Qf(o,c){if(Wc())return null;Df(o,c,!0)}function mm(){Cm(function(){(Ki&6)!==0?nt(ri,pm):Kf()})}function yd(){if(No===0){var o=aa;o===0&&(o=oi,oi<<=1,(oi&261888)===0&&(oi=256)),No=o}return No}function Jf(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:Ma(""+o)}function Zf(o,c){var f=c.ownerDocument.createElement("input");return f.name=c.name,f.value=c.value,o.id&&f.setAttribute("form",o.id),c.parentNode.insertBefore(f,c),o=new FormData(o),f.parentNode.removeChild(f),o}function gm(o,c,f,y,C){if(c==="submit"&&f&&f.stateNode===C){var W=Jf((C[ir]||null).action),ye=y.submitter;ye&&(c=(c=ye[ir]||null)?Jf(c.formAction):ye.getAttribute("formAction"),c!==null&&(W=c,ye=null));var Re=new zt("action","action",null,y,C);o.push({event:Re,listeners:[{instance:null,listener:function(){if(y.defaultPrevented){if(No!==0){var He=ye?Zf(C,ye):new FormData(C);Vu(f,{pending:!0,data:He,method:C.method,action:W},null,He)}}else typeof W=="function"&&(Re.preventDefault(),He=ye?Zf(C,ye):new FormData(C),Vu(f,{pending:!0,data:He,method:C.method,action:W},W,He))},currentTarget:C}]})}}for(var vd=0;vd<_i.length;vd++){var bd=_i[vd],_m=bd.toLowerCase(),ym=bd[0].toUpperCase()+bd.slice(1);gi(_m,"on"+ym)}gi(zo,"onAnimationEnd"),gi(Fa,"onAnimationIteration"),gi(vo,"onAnimationStart"),gi("dblclick","onDoubleClick"),gi("focusin","onFocus"),gi("focusout","onBlur"),gi(ul,"onTransitionRun"),gi(dl,"onTransitionStart"),gi(hl,"onTransitionCancel"),gi(bn,"onTransitionEnd"),ps("onMouseEnter",["mouseout","mouseover"]),ps("onMouseLeave",["mouseout","mouseover"]),ps("onPointerEnter",["pointerout","pointerover"]),ps("onPointerLeave",["pointerout","pointerover"]),os("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),os("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),os("onBeforeInput",["compositionend","keypress","textInput","paste"]),os("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),os("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),os("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vm=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(sc));function ep(o,c){c=(c&4)!==0;for(var f=0;f<o.length;f++){var y=o[f],C=y.event;y=y.listeners;e:{var W=void 0;if(c)for(var ye=y.length-1;0<=ye;ye--){var Re=y[ye],He=Re.instance,At=Re.currentTarget;if(Re=Re.listener,He!==W&&C.isPropagationStopped())break e;W=Re,C.currentTarget=At;try{W(C)}catch(Qt){Ei(Qt)}C.currentTarget=null,W=He}else for(ye=0;ye<y.length;ye++){if(Re=y[ye],He=Re.instance,At=Re.currentTarget,Re=Re.listener,He!==W&&C.isPropagationStopped())break e;W=Re,C.currentTarget=At;try{W(C)}catch(Qt){Ei(Qt)}C.currentTarget=null,W=He}}}}function Ii(o,c){var f=c[Bs];f===void 0&&(f=c[Bs]=new Set);var y=o+"__bubble";f.has(y)||(tp(c,o,2,!1),f.add(y))}function Ed(o,c,f){var y=0;c&&(y|=4),tp(f,o,y,c)}var Yc="_reactListening"+Math.random().toString(36).slice(2);function Td(o){if(!o[Yc]){o[Yc]=!0,Pa.forEach(function(f){f!=="selectionchange"&&(vm.has(f)||Ed(f,!1,o),Ed(f,!0,o))});var c=o.nodeType===9?o:o.ownerDocument;c===null||c[Yc]||(c[Yc]=!0,Ed("selectionchange",!1,c))}}function tp(o,c,f,y){switch(Ip(c)){case 2:var C=Wm;break;case 8:C=Km;break;default:C=Fd}f=C.bind(null,c,f,o),C=void 0,!Se||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(C=!0),y?C!==void 0?o.addEventListener(c,f,{capture:!0,passive:C}):o.addEventListener(c,f,!0):C!==void 0?o.addEventListener(c,f,{passive:C}):o.addEventListener(c,f,!1)}function xd(o,c,f,y,C){var W=y;if((c&1)===0&&(c&2)===0&&y!==null)e:for(;;){if(y===null)return;var ye=y.tag;if(ye===3||ye===4){var Re=y.stateNode.containerInfo;if(Re===C)break;if(ye===4)for(ye=y.return;ye!==null;){var He=ye.tag;if((He===3||He===4)&&ye.stateNode.containerInfo===C)return;ye=ye.return}for(;Re!==null;){if(ye=fs(Re),ye===null)return;if(He=ye.tag,He===5||He===6||He===26||He===27){y=W=ye;continue e}Re=Re.parentNode}}y=y.return}na(function(){var At=W,Qt=ns(f),gn=[];e:{var kt=Xn.get(o);if(kt!==void 0){var $t=zt,Hn=o;switch(o){case"keypress":if(Ge(f)===0)break e;case"keydown":case"keyup":$t=_r;break;case"focusin":Hn="focus",$t=Ln;break;case"focusout":Hn="blur",$t=Ln;break;case"beforeblur":case"afterblur":$t=Ln;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$t=On;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$t=Dn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$t=de;break;case zo:case Fa:case vo:$t=ui;break;case bn:$t=we;break;case"scroll":case"scrollend":$t=En;break;case"wheel":$t=ze;break;case"copy":case"cut":case"paste":$t=ni;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$t=cr;break;case"toggle":case"beforetoggle":$t=yn}var ii=(c&4)!==0,or=!ii&&(o==="scroll"||o==="scrollend"),it=ii?kt!==null?kt+"Capture":null:kt;ii=[];for(var Qe=At,vt;Qe!==null;){var fn=Qe;if(vt=fn.stateNode,fn=fn.tag,fn!==5&&fn!==26&&fn!==27||vt===null||it===null||(fn=Jr(Qe,it),fn!=null&&ii.push(ac(Qe,fn,vt))),or)break;Qe=Qe.return}0<ii.length&&(kt=new $t(kt,Hn,null,f,Qt),gn.push({event:kt,listeners:ii}))}}if((c&7)===0){e:{if(kt=o==="mouseover"||o==="pointerover",$t=o==="mouseout"||o==="pointerout",kt&&f!==As&&(Hn=f.relatedTarget||f.fromElement)&&(fs(Hn)||Hn[fi]))break e;if(($t||kt)&&(kt=Qt.window===Qt?Qt:(kt=Qt.ownerDocument)?kt.defaultView||kt.parentWindow:window,$t?(Hn=f.relatedTarget||f.toElement,$t=At,Hn=Hn?fs(Hn):null,Hn!==null&&(or=s(Hn),ii=Hn.tag,Hn!==or||ii!==5&&ii!==27&&ii!==6)&&(Hn=null)):($t=null,Hn=At),$t!==Hn)){if(ii=On,fn="onMouseLeave",it="onMouseEnter",Qe="mouse",(o==="pointerout"||o==="pointerover")&&(ii=cr,fn="onPointerLeave",it="onPointerEnter",Qe="pointer"),or=$t==null?kt:ts($t),vt=Hn==null?kt:ts(Hn),kt=new ii(fn,Qe+"leave",$t,f,Qt),kt.target=or,kt.relatedTarget=vt,fn=null,fs(Qt)===At&&(ii=new ii(it,Qe+"enter",Hn,f,Qt),ii.target=vt,ii.relatedTarget=or,fn=ii),or=fn,$t&&Hn)t:{for(ii=bm,it=$t,Qe=Hn,vt=0,fn=it;fn;fn=ii(fn))vt++;fn=0;for(var Qn=Qe;Qn;Qn=ii(Qn))fn++;for(;0<vt-fn;)it=ii(it),vt--;for(;0<fn-vt;)Qe=ii(Qe),fn--;for(;vt--;){if(it===Qe||Qe!==null&&it===Qe.alternate){ii=it;break t}it=ii(it),Qe=ii(Qe)}ii=null}else ii=null;$t!==null&&np(gn,kt,$t,ii,!1),Hn!==null&&or!==null&&np(gn,or,Hn,ii,!0)}}e:{if(kt=At?ts(At):window,$t=kt.nodeName&&kt.nodeName.toLowerCase(),$t==="select"||$t==="input"&&kt.type==="file")var $i=$s;else if(Hi(kt))if(ma)$i=Nl;else{$i=ra;var $n=Ml}else $t=kt.nodeName,!$t||$t.toLowerCase()!=="input"||kt.type!=="checkbox"&&kt.type!=="radio"?At&&us(At.elementType)&&($i=$s):$i=ll;if($i&&($i=$i(o,At))){yr(gn,$i,f,Qt);break e}$n&&$n(o,kt,At),o==="focusout"&&At&&kt.type==="number"&&At.memoizedProps.value!=null&&js(kt,"number",kt.value)}switch($n=At?ts(At):window,o){case"focusin":(Hi($n)||$n.contentEditable==="true")&&(_a=$n,to=At,ya=null);break;case"focusout":ya=to=_a=null;break;case"mousedown":no=!0;break;case"contextmenu":case"mouseup":case"dragend":no=!1,Ws(gn,f,Qt);break;case"selectionchange":if(cl)break;case"keydown":case"keyup":Ws(gn,f,Qt)}var Si;if(Cn)e:{switch(o){case"compositionstart":var Ni="onCompositionStart";break e;case"compositionend":Ni="onCompositionEnd";break e;case"compositionupdate":Ni="onCompositionUpdate";break e}Ni=void 0}else Ir?Ti(o,f)&&(Ni="onCompositionEnd"):o==="keydown"&&f.keyCode===229&&(Ni="onCompositionStart");Ni&&(zn&&f.locale!=="ko"&&(Ir||Ni!=="onCompositionStart"?Ni==="onCompositionEnd"&&Ir&&(Si=Ze()):(Le=Qt,Be="value"in Le?Le.value:Le.textContent,Ir=!0)),$n=Qc(At,Ni),0<$n.length&&(Ni=new Ci(Ni,o,null,f,Qt),gn.push({event:Ni,listeners:$n}),Si?Ni.data=Si:(Si=ur(f),Si!==null&&(Ni.data=Si)))),(Si=Sn?ti(o,f):Tr(o,f))&&(Ni=Qc(At,"onBeforeInput"),0<Ni.length&&($n=new Ci("onBeforeInput","beforeinput",null,f,Qt),gn.push({event:$n,listeners:Ni}),$n.data=Si)),gm(gn,o,At,f,Qt)}ep(gn,c)})}function ac(o,c,f){return{instance:o,listener:c,currentTarget:f}}function Qc(o,c){for(var f=c+"Capture",y=[];o!==null;){var C=o,W=C.stateNode;if(C=C.tag,C!==5&&C!==26&&C!==27||W===null||(C=Jr(o,f),C!=null&&y.unshift(ac(o,C,W)),C=Jr(o,c),C!=null&&y.push(ac(o,C,W))),o.tag===3)return y;o=o.return}return[]}function bm(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function np(o,c,f,y,C){for(var W=c._reactName,ye=[];f!==null&&f!==y;){var Re=f,He=Re.alternate,At=Re.stateNode;if(Re=Re.tag,He!==null&&He===y)break;Re!==5&&Re!==26&&Re!==27||At===null||(He=At,C?(At=Jr(f,W),At!=null&&ye.unshift(ac(f,At,He))):C||(At=Jr(f,W),At!=null&&ye.push(ac(f,At,He)))),f=f.return}ye.length!==0&&o.push({event:c,listeners:ye})}var Em=/\r\n?/g,Tm=/\u0000|\uFFFD/g;function ip(o){return(typeof o=="string"?o:""+o).replace(Em,`
`).replace(Tm,"")}function rp(o,c){return c=ip(c),ip(o)===c}function ar(o,c,f,y,C,W){switch(f){case"children":typeof y=="string"?c==="body"||c==="textarea"&&y===""||Pr(o,y):(typeof y=="number"||typeof y=="bigint")&&c!=="body"&&Pr(o,""+y);break;case"className":Nr(o,"class",y);break;case"tabIndex":Nr(o,"tabindex",y);break;case"dir":case"role":case"viewBox":case"width":case"height":Nr(o,f,y);break;case"style":fa(o,y,W);break;case"data":if(c!=="object"){Nr(o,"data",y);break}case"src":case"href":if(y===""&&(c!=="a"||f!=="href")){o.removeAttribute(f);break}if(y==null||typeof y=="function"||typeof y=="symbol"||typeof y=="boolean"){o.removeAttribute(f);break}y=Ma(""+y),o.setAttribute(f,y);break;case"action":case"formAction":if(typeof y=="function"){o.setAttribute(f,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof W=="function"&&(f==="formAction"?(c!=="input"&&ar(o,c,"name",C.name,C,null),ar(o,c,"formEncType",C.formEncType,C,null),ar(o,c,"formMethod",C.formMethod,C,null),ar(o,c,"formTarget",C.formTarget,C,null)):(ar(o,c,"encType",C.encType,C,null),ar(o,c,"method",C.method,C,null),ar(o,c,"target",C.target,C,null)));if(y==null||typeof y=="symbol"||typeof y=="boolean"){o.removeAttribute(f);break}y=Ma(""+y),o.setAttribute(f,y);break;case"onClick":y!=null&&(o.onclick=Qr);break;case"onScroll":y!=null&&Ii("scroll",o);break;case"onScrollEnd":y!=null&&Ii("scrollend",o);break;case"dangerouslySetInnerHTML":if(y!=null){if(typeof y!="object"||!("__html"in y))throw Error(n(61));if(f=y.__html,f!=null){if(C.children!=null)throw Error(n(60));o.innerHTML=f}}break;case"multiple":o.multiple=y&&typeof y!="function"&&typeof y!="symbol";break;case"muted":o.muted=y&&typeof y!="function"&&typeof y!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(y==null||typeof y=="function"||typeof y=="boolean"||typeof y=="symbol"){o.removeAttribute("xlink:href");break}f=Ma(""+y),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",f);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":y!=null&&typeof y!="function"&&typeof y!="symbol"?o.setAttribute(f,""+y):o.removeAttribute(f);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":y&&typeof y!="function"&&typeof y!="symbol"?o.setAttribute(f,""):o.removeAttribute(f);break;case"capture":case"download":y===!0?o.setAttribute(f,""):y!==!1&&y!=null&&typeof y!="function"&&typeof y!="symbol"?o.setAttribute(f,y):o.removeAttribute(f);break;case"cols":case"rows":case"size":case"span":y!=null&&typeof y!="function"&&typeof y!="symbol"&&!isNaN(y)&&1<=y?o.setAttribute(f,y):o.removeAttribute(f);break;case"rowSpan":case"start":y==null||typeof y=="function"||typeof y=="symbol"||isNaN(y)?o.removeAttribute(f):o.setAttribute(f,y);break;case"popover":Ii("beforetoggle",o),Ii("toggle",o),ta(o,"popover",y);break;case"xlinkActuate":qi(o,"http://www.w3.org/1999/xlink","xlink:actuate",y);break;case"xlinkArcrole":qi(o,"http://www.w3.org/1999/xlink","xlink:arcrole",y);break;case"xlinkRole":qi(o,"http://www.w3.org/1999/xlink","xlink:role",y);break;case"xlinkShow":qi(o,"http://www.w3.org/1999/xlink","xlink:show",y);break;case"xlinkTitle":qi(o,"http://www.w3.org/1999/xlink","xlink:title",y);break;case"xlinkType":qi(o,"http://www.w3.org/1999/xlink","xlink:type",y);break;case"xmlBase":qi(o,"http://www.w3.org/XML/1998/namespace","xml:base",y);break;case"xmlLang":qi(o,"http://www.w3.org/XML/1998/namespace","xml:lang",y);break;case"xmlSpace":qi(o,"http://www.w3.org/XML/1998/namespace","xml:space",y);break;case"is":ta(o,"is",y);break;case"innerText":case"textContent":break;default:(!(2<f.length)||f[0]!=="o"&&f[0]!=="O"||f[1]!=="n"&&f[1]!=="N")&&(f=ka.get(f)||f,ta(o,f,y))}}function Sd(o,c,f,y,C,W){switch(f){case"style":fa(o,y,W);break;case"dangerouslySetInnerHTML":if(y!=null){if(typeof y!="object"||!("__html"in y))throw Error(n(61));if(f=y.__html,f!=null){if(C.children!=null)throw Error(n(60));o.innerHTML=f}}break;case"children":typeof y=="string"?Pr(o,y):(typeof y=="number"||typeof y=="bigint")&&Pr(o,""+y);break;case"onScroll":y!=null&&Ii("scroll",o);break;case"onScrollEnd":y!=null&&Ii("scrollend",o);break;case"onClick":y!=null&&(o.onclick=Qr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!da.hasOwnProperty(f))e:{if(f[0]==="o"&&f[1]==="n"&&(C=f.endsWith("Capture"),c=f.slice(2,C?f.length-7:void 0),W=o[ir]||null,W=W!=null?W[f]:null,typeof W=="function"&&o.removeEventListener(c,W,C),typeof y=="function")){typeof W!="function"&&W!==null&&(f in o?o[f]=null:o.hasAttribute(f)&&o.removeAttribute(f)),o.addEventListener(c,y,C);break e}f in o?o[f]=y:y===!0?o.setAttribute(f,""):ta(o,f,y)}}}function as(o,c,f){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ii("error",o),Ii("load",o);var y=!1,C=!1,W;for(W in f)if(f.hasOwnProperty(W)){var ye=f[W];if(ye!=null)switch(W){case"src":y=!0;break;case"srcSet":C=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:ar(o,c,W,ye,f,null)}}C&&ar(o,c,"srcSet",f.srcSet,f,null),y&&ar(o,c,"src",f.src,f,null);return;case"input":Ii("invalid",o);var Re=W=ye=C=null,He=null,At=null;for(y in f)if(f.hasOwnProperty(y)){var Qt=f[y];if(Qt!=null)switch(y){case"name":C=Qt;break;case"type":ye=Qt;break;case"checked":He=Qt;break;case"defaultChecked":At=Qt;break;case"value":W=Qt;break;case"defaultValue":Re=Qt;break;case"children":case"dangerouslySetInnerHTML":if(Qt!=null)throw Error(n(137,c));break;default:ar(o,c,y,Qt,f,null)}}Da(o,W,Re,He,At,ye,C,!1);return;case"select":Ii("invalid",o),y=ye=W=null;for(C in f)if(f.hasOwnProperty(C)&&(Re=f[C],Re!=null))switch(C){case"value":W=Re;break;case"defaultValue":ye=Re;break;case"multiple":y=Re;default:ar(o,c,C,Re,f,null)}c=W,f=ye,o.multiple=!!y,c!=null?Rr(o,!!y,c,!1):f!=null&&Rr(o,!!y,f,!0);return;case"textarea":Ii("invalid",o),W=C=y=null;for(ye in f)if(f.hasOwnProperty(ye)&&(Re=f[ye],Re!=null))switch(ye){case"value":y=Re;break;case"defaultValue":C=Re;break;case"children":W=Re;break;case"dangerouslySetInnerHTML":if(Re!=null)throw Error(n(91));break;default:ar(o,c,ye,Re,f,null)}cs(o,y,C,W);return;case"option":for(He in f)f.hasOwnProperty(He)&&(y=f[He],y!=null)&&(He==="selected"?o.selected=y&&typeof y!="function"&&typeof y!="symbol":ar(o,c,He,y,f,null));return;case"dialog":Ii("beforetoggle",o),Ii("toggle",o),Ii("cancel",o),Ii("close",o);break;case"iframe":case"object":Ii("load",o);break;case"video":case"audio":for(y=0;y<sc.length;y++)Ii(sc[y],o);break;case"image":Ii("error",o),Ii("load",o);break;case"details":Ii("toggle",o);break;case"embed":case"source":case"link":Ii("error",o),Ii("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(At in f)if(f.hasOwnProperty(At)&&(y=f[At],y!=null))switch(At){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,c));default:ar(o,c,At,y,f,null)}return;default:if(us(c)){for(Qt in f)f.hasOwnProperty(Qt)&&(y=f[Qt],y!==void 0&&Sd(o,c,Qt,y,f,void 0));return}}for(Re in f)f.hasOwnProperty(Re)&&(y=f[Re],y!=null&&ar(o,c,Re,y,f,null))}function xm(o,c,f,y){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var C=null,W=null,ye=null,Re=null,He=null,At=null,Qt=null;for($t in f){var gn=f[$t];if(f.hasOwnProperty($t)&&gn!=null)switch($t){case"checked":break;case"value":break;case"defaultValue":He=gn;default:y.hasOwnProperty($t)||ar(o,c,$t,null,y,gn)}}for(var kt in y){var $t=y[kt];if(gn=f[kt],y.hasOwnProperty(kt)&&($t!=null||gn!=null))switch(kt){case"type":W=$t;break;case"name":C=$t;break;case"checked":At=$t;break;case"defaultChecked":Qt=$t;break;case"value":ye=$t;break;case"defaultValue":Re=$t;break;case"children":case"dangerouslySetInnerHTML":if($t!=null)throw Error(n(137,c));break;default:$t!==gn&&ar(o,c,kt,$t,y,gn)}}Ia(o,ye,Re,He,At,Qt,W,C);return;case"select":$t=ye=Re=kt=null;for(W in f)if(He=f[W],f.hasOwnProperty(W)&&He!=null)switch(W){case"value":break;case"multiple":$t=He;default:y.hasOwnProperty(W)||ar(o,c,W,null,y,He)}for(C in y)if(W=y[C],He=f[C],y.hasOwnProperty(C)&&(W!=null||He!=null))switch(C){case"value":kt=W;break;case"defaultValue":Re=W;break;case"multiple":ye=W;default:W!==He&&ar(o,c,C,W,y,He)}c=Re,f=ye,y=$t,kt!=null?Rr(o,!!f,kt,!1):!!y!=!!f&&(c!=null?Rr(o,!!f,c,!0):Rr(o,!!f,f?[]:"",!1));return;case"textarea":$t=kt=null;for(Re in f)if(C=f[Re],f.hasOwnProperty(Re)&&C!=null&&!y.hasOwnProperty(Re))switch(Re){case"value":break;case"children":break;default:ar(o,c,Re,null,y,C)}for(ye in y)if(C=y[ye],W=f[ye],y.hasOwnProperty(ye)&&(C!=null||W!=null))switch(ye){case"value":kt=C;break;case"defaultValue":$t=C;break;case"children":break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(n(91));break;default:C!==W&&ar(o,c,ye,C,y,W)}Za(o,kt,$t);return;case"option":for(var Hn in f)kt=f[Hn],f.hasOwnProperty(Hn)&&kt!=null&&!y.hasOwnProperty(Hn)&&(Hn==="selected"?o.selected=!1:ar(o,c,Hn,null,y,kt));for(He in y)kt=y[He],$t=f[He],y.hasOwnProperty(He)&&kt!==$t&&(kt!=null||$t!=null)&&(He==="selected"?o.selected=kt&&typeof kt!="function"&&typeof kt!="symbol":ar(o,c,He,kt,y,$t));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ii in f)kt=f[ii],f.hasOwnProperty(ii)&&kt!=null&&!y.hasOwnProperty(ii)&&ar(o,c,ii,null,y,kt);for(At in y)if(kt=y[At],$t=f[At],y.hasOwnProperty(At)&&kt!==$t&&(kt!=null||$t!=null))switch(At){case"children":case"dangerouslySetInnerHTML":if(kt!=null)throw Error(n(137,c));break;default:ar(o,c,At,kt,y,$t)}return;default:if(us(c)){for(var or in f)kt=f[or],f.hasOwnProperty(or)&&kt!==void 0&&!y.hasOwnProperty(or)&&Sd(o,c,or,void 0,y,kt);for(Qt in y)kt=y[Qt],$t=f[Qt],!y.hasOwnProperty(Qt)||kt===$t||kt===void 0&&$t===void 0||Sd(o,c,Qt,kt,y,$t);return}}for(var it in f)kt=f[it],f.hasOwnProperty(it)&&kt!=null&&!y.hasOwnProperty(it)&&ar(o,c,it,null,y,kt);for(gn in y)kt=y[gn],$t=f[gn],!y.hasOwnProperty(gn)||kt===$t||kt==null&&$t==null||ar(o,c,gn,kt,y,$t)}function sp(o){switch(o){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Sm(){if(typeof performance.getEntriesByType=="function"){for(var o=0,c=0,f=performance.getEntriesByType("resource"),y=0;y<f.length;y++){var C=f[y],W=C.transferSize,ye=C.initiatorType,Re=C.duration;if(W&&Re&&sp(ye)){for(ye=0,Re=C.responseEnd,y+=1;y<f.length;y++){var He=f[y],At=He.startTime;if(At>Re)break;var Qt=He.transferSize,gn=He.initiatorType;Qt&&sp(gn)&&(He=He.responseEnd,ye+=Qt*(He<Re?1:(Re-At)/(He-At)))}if(--y,c+=8*(W+ye)/(C.duration/1e3),o++,10<o)break}}if(0<o)return c/o/1e6}return navigator.connection&&(o=navigator.connection.downlink,typeof o=="number")?o:5}var Ad=null,wd=null;function Jc(o){return o.nodeType===9?o:o.ownerDocument}function ap(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function op(o,c){if(o===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&c==="foreignObject"?0:o}function Cd(o,c){return o==="textarea"||o==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var Rd=null;function Am(){var o=window.event;return o&&o.type==="popstate"?o===Rd?!1:(Rd=o,!0):(Rd=null,!1)}var lp=typeof setTimeout=="function"?setTimeout:void 0,wm=typeof clearTimeout=="function"?clearTimeout:void 0,cp=typeof Promise=="function"?Promise:void 0,Cm=typeof queueMicrotask=="function"?queueMicrotask:typeof cp<"u"?function(o){return cp.resolve(null).then(o).catch(Rm)}:lp;function Rm(o){setTimeout(function(){throw o})}function Lo(o){return o==="head"}function up(o,c){var f=c,y=0;do{var C=f.nextSibling;if(o.removeChild(f),C&&C.nodeType===8)if(f=C.data,f==="/$"||f==="/&"){if(y===0){o.removeChild(C),Dl(c);return}y--}else if(f==="$"||f==="$?"||f==="$~"||f==="$!"||f==="&")y++;else if(f==="html")oc(o.ownerDocument.documentElement);else if(f==="head"){f=o.ownerDocument.head,oc(f);for(var W=f.firstChild;W;){var ye=W.nextSibling,Re=W.nodeName;W[Vr]||Re==="SCRIPT"||Re==="STYLE"||Re==="LINK"&&W.rel.toLowerCase()==="stylesheet"||f.removeChild(W),W=ye}}else f==="body"&&oc(o.ownerDocument.body);f=C}while(f);Dl(c)}function dp(o,c){var f=o;o=0;do{var y=f.nextSibling;if(f.nodeType===1?c?(f._stashedDisplay=f.style.display,f.style.display="none"):(f.style.display=f._stashedDisplay||"",f.getAttribute("style")===""&&f.removeAttribute("style")):f.nodeType===3&&(c?(f._stashedText=f.nodeValue,f.nodeValue=""):f.nodeValue=f._stashedText||""),y&&y.nodeType===8)if(f=y.data,f==="/$"){if(o===0)break;o--}else f!=="$"&&f!=="$?"&&f!=="$~"&&f!=="$!"||o++;f=y}while(f)}function Pd(o){var c=o.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var f=c;switch(c=c.nextSibling,f.nodeName){case"HTML":case"HEAD":case"BODY":Pd(f),Ui(f);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(f.rel.toLowerCase()==="stylesheet")continue}o.removeChild(f)}}function Pm(o,c,f,y){for(;o.nodeType===1;){var C=f;if(o.nodeName.toLowerCase()!==c.toLowerCase()){if(!y&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(y){if(!o[Vr])switch(c){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(W=o.getAttribute("rel"),W==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(W!==C.rel||o.getAttribute("href")!==(C.href==null||C.href===""?null:C.href)||o.getAttribute("crossorigin")!==(C.crossOrigin==null?null:C.crossOrigin)||o.getAttribute("title")!==(C.title==null?null:C.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(W=o.getAttribute("src"),(W!==(C.src==null?null:C.src)||o.getAttribute("type")!==(C.type==null?null:C.type)||o.getAttribute("crossorigin")!==(C.crossOrigin==null?null:C.crossOrigin))&&W&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(c==="input"&&o.type==="hidden"){var W=C.name==null?null:""+C.name;if(C.type==="hidden"&&o.getAttribute("name")===W)return o}else return o;if(o=la(o.nextSibling),o===null)break}return null}function Im(o,c,f){if(c==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!f||(o=la(o.nextSibling),o===null))return null;return o}function hp(o,c){for(;o.nodeType!==8;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!c||(o=la(o.nextSibling),o===null))return null;return o}function Id(o){return o.data==="$?"||o.data==="$~"}function Dd(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState!=="loading"}function Dm(o,c){var f=o.ownerDocument;if(o.data==="$~")o._reactRetry=c;else if(o.data!=="$?"||f.readyState!=="loading")c();else{var y=function(){c(),f.removeEventListener("DOMContentLoaded",y)};f.addEventListener("DOMContentLoaded",y),o._reactRetry=y}}function la(o){for(;o!=null;o=o.nextSibling){var c=o.nodeType;if(c===1||c===3)break;if(c===8){if(c=o.data,c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"||c==="F!"||c==="F")break;if(c==="/$"||c==="/&")return null}}return o}var kd=null;function fp(o){o=o.nextSibling;for(var c=0;o;){if(o.nodeType===8){var f=o.data;if(f==="/$"||f==="/&"){if(c===0)return la(o.nextSibling);c--}else f!=="$"&&f!=="$!"&&f!=="$?"&&f!=="$~"&&f!=="&"||c++}o=o.nextSibling}return null}function pp(o){o=o.previousSibling;for(var c=0;o;){if(o.nodeType===8){var f=o.data;if(f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"){if(c===0)return o;c--}else f!=="/$"&&f!=="/&"||c++}o=o.previousSibling}return null}function mp(o,c,f){switch(c=Jc(f),o){case"html":if(o=c.documentElement,!o)throw Error(n(452));return o;case"head":if(o=c.head,!o)throw Error(n(453));return o;case"body":if(o=c.body,!o)throw Error(n(454));return o;default:throw Error(n(451))}}function oc(o){for(var c=o.attributes;c.length;)o.removeAttributeNode(c[0]);Ui(o)}var ca=new Map,gp=new Set;function Zc(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var go=ue.d;ue.d={f:km,r:Mm,D:Nm,C:Lm,L:Om,m:Fm,X:Bm,S:Vm,M:jm};function km(){var o=go.f(),c=zc();return o||c}function Mm(o){var c=Gr(o);c!==null&&c.tag===5&&c.type==="form"?kh(c):go.r(o)}var Rl=typeof document>"u"?null:document;function _p(o,c,f){var y=Rl;if(y&&typeof c=="string"&&c){var C=Cr(c);C='link[rel="'+o+'"][href="'+C+'"]',typeof f=="string"&&(C+='[crossorigin="'+f+'"]'),gp.has(C)||(gp.add(C),o={rel:o,crossOrigin:f,href:c},y.querySelector(C)===null&&(c=y.createElement("link"),as(c,"link",o),lr(c),y.head.appendChild(c)))}}function Nm(o){go.D(o),_p("dns-prefetch",o,null)}function Lm(o,c){go.C(o,c),_p("preconnect",o,c)}function Om(o,c,f){go.L(o,c,f);var y=Rl;if(y&&o&&c){var C='link[rel="preload"][as="'+Cr(c)+'"]';c==="image"&&f&&f.imageSrcSet?(C+='[imagesrcset="'+Cr(f.imageSrcSet)+'"]',typeof f.imageSizes=="string"&&(C+='[imagesizes="'+Cr(f.imageSizes)+'"]')):C+='[href="'+Cr(o)+'"]';var W=C;switch(c){case"style":W=Pl(o);break;case"script":W=Il(o)}ca.has(W)||(o=p({rel:"preload",href:c==="image"&&f&&f.imageSrcSet?void 0:o,as:c},f),ca.set(W,o),y.querySelector(C)!==null||c==="style"&&y.querySelector(lc(W))||c==="script"&&y.querySelector(cc(W))||(c=y.createElement("link"),as(c,"link",o),lr(c),y.head.appendChild(c)))}}function Fm(o,c){go.m(o,c);var f=Rl;if(f&&o){var y=c&&typeof c.as=="string"?c.as:"script",C='link[rel="modulepreload"][as="'+Cr(y)+'"][href="'+Cr(o)+'"]',W=C;switch(y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":W=Il(o)}if(!ca.has(W)&&(o=p({rel:"modulepreload",href:o},c),ca.set(W,o),f.querySelector(C)===null)){switch(y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(f.querySelector(cc(W)))return}y=f.createElement("link"),as(y,"link",o),lr(y),f.head.appendChild(y)}}}function Vm(o,c,f){go.S(o,c,f);var y=Rl;if(y&&o){var C=Ts(y).hoistableStyles,W=Pl(o);c=c||"default";var ye=C.get(W);if(!ye){var Re={loading:0,preload:null};if(ye=y.querySelector(lc(W)))Re.loading=5;else{o=p({rel:"stylesheet",href:o,"data-precedence":c},f),(f=ca.get(W))&&Md(o,f);var He=ye=y.createElement("link");lr(He),as(He,"link",o),He._p=new Promise(function(At,Qt){He.onload=At,He.onerror=Qt}),He.addEventListener("load",function(){Re.loading|=1}),He.addEventListener("error",function(){Re.loading|=2}),Re.loading|=4,eu(ye,c,y)}ye={type:"stylesheet",instance:ye,count:1,state:Re},C.set(W,ye)}}}function Bm(o,c){go.X(o,c);var f=Rl;if(f&&o){var y=Ts(f).hoistableScripts,C=Il(o),W=y.get(C);W||(W=f.querySelector(cc(C)),W||(o=p({src:o,async:!0},c),(c=ca.get(C))&&Nd(o,c),W=f.createElement("script"),lr(W),as(W,"link",o),f.head.appendChild(W)),W={type:"script",instance:W,count:1,state:null},y.set(C,W))}}function jm(o,c){go.M(o,c);var f=Rl;if(f&&o){var y=Ts(f).hoistableScripts,C=Il(o),W=y.get(C);W||(W=f.querySelector(cc(C)),W||(o=p({src:o,async:!0,type:"module"},c),(c=ca.get(C))&&Nd(o,c),W=f.createElement("script"),lr(W),as(W,"link",o),f.head.appendChild(W)),W={type:"script",instance:W,count:1,state:null},y.set(C,W))}}function yp(o,c,f,y){var C=(C=Ee.current)?Zc(C):null;if(!C)throw Error(n(446));switch(o){case"meta":case"title":return null;case"style":return typeof f.precedence=="string"&&typeof f.href=="string"?(c=Pl(f.href),f=Ts(C).hoistableStyles,y=f.get(c),y||(y={type:"style",instance:null,count:0,state:null},f.set(c,y)),y):{type:"void",instance:null,count:0,state:null};case"link":if(f.rel==="stylesheet"&&typeof f.href=="string"&&typeof f.precedence=="string"){o=Pl(f.href);var W=Ts(C).hoistableStyles,ye=W.get(o);if(ye||(C=C.ownerDocument||C,ye={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},W.set(o,ye),(W=C.querySelector(lc(o)))&&!W._p&&(ye.instance=W,ye.state.loading=5),ca.has(o)||(f={rel:"preload",as:"style",href:f.href,crossOrigin:f.crossOrigin,integrity:f.integrity,media:f.media,hrefLang:f.hrefLang,referrerPolicy:f.referrerPolicy},ca.set(o,f),W||Um(C,o,f,ye.state))),c&&y===null)throw Error(n(528,""));return ye}if(c&&y!==null)throw Error(n(529,""));return null;case"script":return c=f.async,f=f.src,typeof f=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=Il(f),f=Ts(C).hoistableScripts,y=f.get(c),y||(y={type:"script",instance:null,count:0,state:null},f.set(c,y)),y):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,o))}}function Pl(o){return'href="'+Cr(o)+'"'}function lc(o){return'link[rel="stylesheet"]['+o+"]"}function vp(o){return p({},o,{"data-precedence":o.precedence,precedence:null})}function Um(o,c,f,y){o.querySelector('link[rel="preload"][as="style"]['+c+"]")?y.loading=1:(c=o.createElement("link"),y.preload=c,c.addEventListener("load",function(){return y.loading|=1}),c.addEventListener("error",function(){return y.loading|=2}),as(c,"link",f),lr(c),o.head.appendChild(c))}function Il(o){return'[src="'+Cr(o)+'"]'}function cc(o){return"script[async]"+o}function bp(o,c,f){if(c.count++,c.instance===null)switch(c.type){case"style":var y=o.querySelector('style[data-href~="'+Cr(f.href)+'"]');if(y)return c.instance=y,lr(y),y;var C=p({},f,{"data-href":f.href,"data-precedence":f.precedence,href:null,precedence:null});return y=(o.ownerDocument||o).createElement("style"),lr(y),as(y,"style",C),eu(y,f.precedence,o),c.instance=y;case"stylesheet":C=Pl(f.href);var W=o.querySelector(lc(C));if(W)return c.state.loading|=4,c.instance=W,lr(W),W;y=vp(f),(C=ca.get(C))&&Md(y,C),W=(o.ownerDocument||o).createElement("link"),lr(W);var ye=W;return ye._p=new Promise(function(Re,He){ye.onload=Re,ye.onerror=He}),as(W,"link",y),c.state.loading|=4,eu(W,f.precedence,o),c.instance=W;case"script":return W=Il(f.src),(C=o.querySelector(cc(W)))?(c.instance=C,lr(C),C):(y=f,(C=ca.get(W))&&(y=p({},f),Nd(y,C)),o=o.ownerDocument||o,C=o.createElement("script"),lr(C),as(C,"link",y),o.head.appendChild(C),c.instance=C);case"void":return null;default:throw Error(n(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(y=c.instance,c.state.loading|=4,eu(y,f.precedence,o));return c.instance}function eu(o,c,f){for(var y=f.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),C=y.length?y[y.length-1]:null,W=C,ye=0;ye<y.length;ye++){var Re=y[ye];if(Re.dataset.precedence===c)W=Re;else if(W!==C)break}W?W.parentNode.insertBefore(o,W.nextSibling):(c=f.nodeType===9?f.head:f,c.insertBefore(o,c.firstChild))}function Md(o,c){o.crossOrigin==null&&(o.crossOrigin=c.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=c.referrerPolicy),o.title==null&&(o.title=c.title)}function Nd(o,c){o.crossOrigin==null&&(o.crossOrigin=c.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=c.referrerPolicy),o.integrity==null&&(o.integrity=c.integrity)}var tu=null;function Ep(o,c,f){if(tu===null){var y=new Map,C=tu=new Map;C.set(f,y)}else C=tu,y=C.get(f),y||(y=new Map,C.set(f,y));if(y.has(o))return y;for(y.set(o,null),f=f.getElementsByTagName(o),C=0;C<f.length;C++){var W=f[C];if(!(W[Vr]||W[ci]||o==="link"&&W.getAttribute("rel")==="stylesheet")&&W.namespaceURI!=="http://www.w3.org/2000/svg"){var ye=W.getAttribute(c)||"";ye=o+ye;var Re=y.get(ye);Re?Re.push(W):y.set(ye,[W])}}return y}function Tp(o,c,f){o=o.ownerDocument||o,o.head.insertBefore(f,c==="title"?o.querySelector("head > title"):null)}function Hm(o,c,f){if(f===1||c.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;return c.rel==="stylesheet"?(o=c.disabled,typeof c.precedence=="string"&&o==null):!0;case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function xp(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}function qm(o,c,f,y){if(f.type==="stylesheet"&&(typeof y.media!="string"||matchMedia(y.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var C=Pl(y.href),W=c.querySelector(lc(C));if(W){c=W._p,c!==null&&typeof c=="object"&&typeof c.then=="function"&&(o.count++,o=nu.bind(o),c.then(o,o)),f.state.loading|=4,f.instance=W,lr(W);return}W=c.ownerDocument||c,y=vp(y),(C=ca.get(C))&&Md(y,C),W=W.createElement("link"),lr(W);var ye=W;ye._p=new Promise(function(Re,He){ye.onload=Re,ye.onerror=He}),as(W,"link",y),f.instance=W}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(f,c),(c=f.state.preload)&&(f.state.loading&3)===0&&(o.count++,f=nu.bind(o),c.addEventListener("load",f),c.addEventListener("error",f))}}var Ld=0;function zm(o,c){return o.stylesheets&&o.count===0&&ru(o,o.stylesheets),0<o.count||0<o.imgCount?function(f){var y=setTimeout(function(){if(o.stylesheets&&ru(o,o.stylesheets),o.unsuspend){var W=o.unsuspend;o.unsuspend=null,W()}},6e4+c);0<o.imgBytes&&Ld===0&&(Ld=62500*Sm());var C=setTimeout(function(){if(o.waitingForImages=!1,o.count===0&&(o.stylesheets&&ru(o,o.stylesheets),o.unsuspend)){var W=o.unsuspend;o.unsuspend=null,W()}},(o.imgBytes>Ld?50:800)+c);return o.unsuspend=f,function(){o.unsuspend=null,clearTimeout(y),clearTimeout(C)}}:null}function nu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ru(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var iu=null;function ru(o,c){o.stylesheets=null,o.unsuspend!==null&&(o.count++,iu=new Map,c.forEach($m,o),iu=null,nu.call(o))}function $m(o,c){if(!(c.state.loading&4)){var f=iu.get(o);if(f)var y=f.get(null);else{f=new Map,iu.set(o,f);for(var C=o.querySelectorAll("link[data-precedence],style[data-precedence]"),W=0;W<C.length;W++){var ye=C[W];(ye.nodeName==="LINK"||ye.getAttribute("media")!=="not all")&&(f.set(ye.dataset.precedence,ye),y=ye)}y&&f.set(null,y)}C=c.instance,ye=C.getAttribute("data-precedence"),W=f.get(ye)||y,W===y&&f.set(null,C),f.set(ye,C),this.count++,y=nu.bind(this),C.addEventListener("load",y),C.addEventListener("error",y),W?W.parentNode.insertBefore(C,W.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(C,o.firstChild)),c.state.loading|=4}}var uc={$$typeof:z,Provider:null,Consumer:null,_currentValue:oe,_currentValue2:oe,_threadCount:0};function Gm(o,c,f,y,C,W,ye,Re,He){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=li(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=li(0),this.hiddenUpdates=li(null),this.identifierPrefix=y,this.onUncaughtError=C,this.onCaughtError=W,this.onRecoverableError=ye,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=He,this.incompleteTransitions=new Map}function Sp(o,c,f,y,C,W,ye,Re,He,At,Qt,gn){return o=new Gm(o,c,f,ye,He,At,Qt,gn,Re),c=1,W===!0&&(c|=24),W=Dr(3,null,null,c),o.current=W,W.stateNode=o,c=ro(),c.refCount++,o.pooledCache=c,c.refCount++,W.memoizedState={element:y,isDehydrated:f,cache:c},yu(W),o}function Ap(o){return o?(o=ys,o):ys}function wp(o,c,f,y,C,W){C=Ap(C),y.context===null?y.context=C:y.pendingContext=C,y=So(c),y.payload={element:f},W=W===void 0?null:W,W!==null&&(y.callback=W),f=Ao(o,y,c),f!==null&&(Fs(f,o,c),Hl(f,o,c))}function Cp(o,c){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var f=o.retryLane;o.retryLane=f!==0&&f<c?f:c}}function Od(o,c){Cp(o,c),(o=o.alternate)&&Cp(o,c)}function Rp(o){if(o.tag===13||o.tag===31){var c=Rs(o,67108864);c!==null&&Fs(c,o,67108864),Od(o,67108864)}}function Pp(o){if(o.tag===13||o.tag===31){var c=Zs();c=br(c);var f=Rs(o,c);f!==null&&Fs(f,o,c),Od(o,c)}}var su=!0;function Wm(o,c,f,y){var C=le.T;le.T=null;var W=ue.p;try{ue.p=2,Fd(o,c,f,y)}finally{ue.p=W,le.T=C}}function Km(o,c,f,y){var C=le.T;le.T=null;var W=ue.p;try{ue.p=8,Fd(o,c,f,y)}finally{ue.p=W,le.T=C}}function Fd(o,c,f,y){if(su){var C=Vd(y);if(C===null)xd(o,c,y,au,f),Dp(o,y);else if(Ym(C,o,c,f,y))y.stopPropagation();else if(Dp(o,y),c&4&&-1<Xm.indexOf(o)){for(;C!==null;){var W=Gr(C);if(W!==null)switch(W.tag){case 3:if(W=W.stateNode,W.current.memoizedState.isDehydrated){var ye=Ce(W.pendingLanes);if(ye!==0){var Re=W;for(Re.pendingLanes|=2,Re.entangledLanes|=2;ye;){var He=1<<31-Bn(ye);Re.entanglements[1]|=He,ye&=~He}Wa(W),(Ki&6)===0&&(Hc=In()+500,rc(0))}}break;case 31:case 13:Re=Rs(W,2),Re!==null&&Fs(Re,W,2),zc(),Od(W,2)}if(W=Vd(y),W===null&&xd(o,c,y,au,f),W===C)break;C=W}C!==null&&y.stopPropagation()}else xd(o,c,y,null,f)}}function Vd(o){return o=ns(o),Bd(o)}var au=null;function Bd(o){if(au=null,o=fs(o),o!==null){var c=s(o);if(c===null)o=null;else{var f=c.tag;if(f===13){if(o=a(c),o!==null)return o;o=null}else if(f===31){if(o=l(c),o!==null)return o;o=null}else if(f===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;o=null}else c!==o&&(o=null)}}return au=o,null}function Ip(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Jn()){case ri:return 2;case Wn:return 8;case hi:case ai:return 32;case Zn:return 268435456;default:return 32}default:return 32}}var jd=!1,Oo=null,Fo=null,Vo=null,dc=new Map,hc=new Map,Bo=[],Xm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Dp(o,c){switch(o){case"focusin":case"focusout":Oo=null;break;case"dragenter":case"dragleave":Fo=null;break;case"mouseover":case"mouseout":Vo=null;break;case"pointerover":case"pointerout":dc.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":hc.delete(c.pointerId)}}function fc(o,c,f,y,C,W){return o===null||o.nativeEvent!==W?(o={blockedOn:c,domEventName:f,eventSystemFlags:y,nativeEvent:W,targetContainers:[C]},c!==null&&(c=Gr(c),c!==null&&Rp(c)),o):(o.eventSystemFlags|=y,c=o.targetContainers,C!==null&&c.indexOf(C)===-1&&c.push(C),o)}function Ym(o,c,f,y,C){switch(c){case"focusin":return Oo=fc(Oo,o,c,f,y,C),!0;case"dragenter":return Fo=fc(Fo,o,c,f,y,C),!0;case"mouseover":return Vo=fc(Vo,o,c,f,y,C),!0;case"pointerover":var W=C.pointerId;return dc.set(W,fc(dc.get(W)||null,o,c,f,y,C)),!0;case"gotpointercapture":return W=C.pointerId,hc.set(W,fc(hc.get(W)||null,o,c,f,y,C)),!0}return!1}function kp(o){var c=fs(o.target);if(c!==null){var f=s(c);if(f!==null){if(c=f.tag,c===13){if(c=a(f),c!==null){o.blockedOn=c,wr(o.priority,function(){Pp(f)});return}}else if(c===31){if(c=l(f),c!==null){o.blockedOn=c,wr(o.priority,function(){Pp(f)});return}}else if(c===3&&f.stateNode.current.memoizedState.isDehydrated){o.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}o.blockedOn=null}function ou(o){if(o.blockedOn!==null)return!1;for(var c=o.targetContainers;0<c.length;){var f=Vd(o.nativeEvent);if(f===null){f=o.nativeEvent;var y=new f.constructor(f.type,f);As=y,f.target.dispatchEvent(y),As=null}else return c=Gr(f),c!==null&&Rp(c),o.blockedOn=f,!1;c.shift()}return!0}function Mp(o,c,f){ou(o)&&f.delete(c)}function Qm(){jd=!1,Oo!==null&&ou(Oo)&&(Oo=null),Fo!==null&&ou(Fo)&&(Fo=null),Vo!==null&&ou(Vo)&&(Vo=null),dc.forEach(Mp),hc.forEach(Mp)}function lu(o,c){o.blockedOn===c&&(o.blockedOn=null,jd||(jd=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Qm)))}var cu=null;function Np(o){cu!==o&&(cu=o,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){cu===o&&(cu=null);for(var c=0;c<o.length;c+=3){var f=o[c],y=o[c+1],C=o[c+2];if(typeof y!="function"){if(Bd(y||f)===null)continue;break}var W=Gr(f);W!==null&&(o.splice(c,3),c-=3,Vu(W,{pending:!0,data:C,method:f.method,action:y},y,C))}}))}function Dl(o){function c(He){return lu(He,o)}Oo!==null&&lu(Oo,o),Fo!==null&&lu(Fo,o),Vo!==null&&lu(Vo,o),dc.forEach(c),hc.forEach(c);for(var f=0;f<Bo.length;f++){var y=Bo[f];y.blockedOn===o&&(y.blockedOn=null)}for(;0<Bo.length&&(f=Bo[0],f.blockedOn===null);)kp(f),f.blockedOn===null&&Bo.shift();if(f=(o.ownerDocument||o).$$reactFormReplay,f!=null)for(y=0;y<f.length;y+=3){var C=f[y],W=f[y+1],ye=C[ir]||null;if(typeof W=="function")ye||Np(f);else if(ye){var Re=null;if(W&&W.hasAttribute("formAction")){if(C=W,ye=W[ir]||null)Re=ye.formAction;else if(Bd(C)!==null)continue}else Re=ye.action;typeof Re=="function"?f[y+1]=Re:(f.splice(y,3),y-=3),Np(f)}}}function Lp(){function o(W){W.canIntercept&&W.info==="react-transition"&&W.intercept({handler:function(){return new Promise(function(ye){return C=ye})},focusReset:"manual",scroll:"manual"})}function c(){C!==null&&(C(),C=null),y||setTimeout(f,20)}function f(){if(!y&&!navigation.transition){var W=navigation.currentEntry;W&&W.url!=null&&navigation.navigate(W.url,{state:W.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var y=!1,C=null;return navigation.addEventListener("navigate",o),navigation.addEventListener("navigatesuccess",c),navigation.addEventListener("navigateerror",c),setTimeout(f,100),function(){y=!0,navigation.removeEventListener("navigate",o),navigation.removeEventListener("navigatesuccess",c),navigation.removeEventListener("navigateerror",c),C!==null&&(C(),C=null)}}}function Ud(o){this._internalRoot=o}uu.prototype.render=Ud.prototype.render=function(o){var c=this._internalRoot;if(c===null)throw Error(n(409));var f=c.current,y=Zs();wp(f,y,o,c,null,null)},uu.prototype.unmount=Ud.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var c=o.containerInfo;wp(o.current,2,null,o,null,null),zc(),c[fi]=null}};function uu(o){this._internalRoot=o}uu.prototype.unstable_scheduleHydration=function(o){if(o){var c=$r();o={blockedOn:null,target:o,priority:c};for(var f=0;f<Bo.length&&c!==0&&c<Bo[f].priority;f++);Bo.splice(f,0,o),f===0&&kp(o)}};var Op=e.version;if(Op!=="19.2.3")throw Error(n(527,Op,"19.2.3"));ue.findDOMNode=function(o){var c=o._reactInternals;if(c===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=d(c),o=o!==null?h(o):null,o=o===null?null:o.stateNode,o};var Jm={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:le,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var du=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!du.isDisabled&&du.supportsFiber)try{Ye=du.inject(Jm),xn=du}catch{}}return reactDomClient_production.createRoot=function(o,c){if(!r(o))throw Error(n(299));var f=!1,y="",C=Hh,W=qh,ye=zh;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(y=c.identifierPrefix),c.onUncaughtError!==void 0&&(C=c.onUncaughtError),c.onCaughtError!==void 0&&(W=c.onCaughtError),c.onRecoverableError!==void 0&&(ye=c.onRecoverableError)),c=Sp(o,1,!1,null,null,f,y,null,C,W,ye,Lp),o[fi]=c.current,Td(o),new Ud(c)},reactDomClient_production.hydrateRoot=function(o,c,f){if(!r(o))throw Error(n(299));var y=!1,C="",W=Hh,ye=qh,Re=zh,He=null;return f!=null&&(f.unstable_strictMode===!0&&(y=!0),f.identifierPrefix!==void 0&&(C=f.identifierPrefix),f.onUncaughtError!==void 0&&(W=f.onUncaughtError),f.onCaughtError!==void 0&&(ye=f.onCaughtError),f.onRecoverableError!==void 0&&(Re=f.onRecoverableError),f.formState!==void 0&&(He=f.formState)),c=Sp(o,1,!0,c,f??null,y,C,He,W,ye,Re,Lp),c.context=Ap(null),f=c.current,y=Zs(),y=br(y),C=So(y),C.callback=null,Ao(f,C,y),f=y,c.current.lanes=f,Fi(c,f),Wa(c),o[fi]=c.current,Td(o),new uu(c)},reactDomClient_production.version="19.2.3",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient();const ReactDOM=getDefaultExportFromCjs(clientExports);var PopStateEventType="popstate";function createBrowserHistory(i={}){function e(n,r){let{pathname:s,search:a,hash:l}=n.location;return createLocation("",{pathname:s,search:a,hash:l},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){return typeof r=="string"?r:createPath(r)}return getUrlBasedHistory(e,t,null,i)}function invariant(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function warning(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function createKey(){return Math.random().toString(36).substring(2,10)}function getHistoryState(i,e){return{usr:i.state,key:i.key,idx:e}}function createLocation(i,e,t=null,n){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?parsePath(e):e,state:t,key:e&&e.key||n||createKey()}}function createPath({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function parsePath(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let n=i.indexOf("?");n>=0&&(e.search=i.substring(n),i=i.substring(0,n)),i&&(e.pathname=i)}return e}function getUrlBasedHistory(i,e,t,n={}){let{window:r=document.defaultView,v5Compat:s=!1}=n,a=r.history,l="POP",u=null,d=h();d==null&&(d=0,a.replaceState({...a.state,idx:d},""));function h(){return(a.state||{idx:null}).idx}function p(){l="POP";let b=h(),E=b==null?null:b-d;d=b,u&&u({action:l,location:_.location,delta:E})}function m(b,E){l="PUSH";let A=createLocation(_.location,b,E);d=h()+1;let z=getHistoryState(A,d),D=_.createHref(A);try{a.pushState(z,"",D)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;r.location.assign(D)}s&&u&&u({action:l,location:_.location,delta:1})}function g(b,E){l="REPLACE";let A=createLocation(_.location,b,E);d=h();let z=getHistoryState(A,d),D=_.createHref(A);a.replaceState(z,"",D),s&&u&&u({action:l,location:_.location,delta:0})}function v(b){return createBrowserURLImpl(b)}let _={get action(){return l},get location(){return i(r,a)},listen(b){if(u)throw new Error("A history only accepts one active listener");return r.addEventListener(PopStateEventType,p),u=b,()=>{r.removeEventListener(PopStateEventType,p),u=null}},createHref(b){return e(r,b)},createURL:v,encodeLocation(b){let E=v(b);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:m,replace:g,go(b){return a.go(b)}};return _}function createBrowserURLImpl(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),invariant(t,"No window.location.(origin|href) available to create URL");let n=typeof i=="string"?i:createPath(i);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}function matchRoutes(i,e,t="/"){return matchRoutesImpl(i,e,t,!1)}function matchRoutesImpl(i,e,t,n){let r=typeof e=="string"?parsePath(e):e,s=stripBasename(r.pathname||"/",t);if(s==null)return null;let a=flattenRoutes(i);rankRouteBranches(a);let l=null;for(let u=0;l==null&&u<a.length;++u){let d=decodePath(s);l=matchRouteBranch(a[u],d,n)}return l}function flattenRoutes(i,e=[],t=[],n="",r=!1){let s=(a,l,u=r,d)=>{let h={relativePath:d===void 0?a.path||"":d,caseSensitive:a.caseSensitive===!0,childrenIndex:l,route:a};if(h.relativePath.startsWith("/")){if(!h.relativePath.startsWith(n)&&u)return;invariant(h.relativePath.startsWith(n),`Absolute route path "${h.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(n.length)}let p=joinPaths([n,h.relativePath]),m=t.concat(h);a.children&&a.children.length>0&&(invariant(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${p}".`),flattenRoutes(a.children,e,m,p,u)),!(a.path==null&&!a.index)&&e.push({path:p,score:computeScore(p,a.index),routesMeta:m})};return i.forEach((a,l)=>{if(a.path===""||!a.path?.includes("?"))s(a,l);else for(let u of explodeOptionalSegments(a.path))s(a,l,!0,u)}),e}function explodeOptionalSegments(i){let e=i.split("/");if(e.length===0)return[];let[t,...n]=e,r=t.endsWith("?"),s=t.replace(/\?$/,"");if(n.length===0)return r?[s,""]:[s];let a=explodeOptionalSegments(n.join("/")),l=[];return l.push(...a.map(u=>u===""?s:[s,u].join("/"))),r&&l.push(...a),l.map(u=>i.startsWith("/")&&u===""?"/":u)}function rankRouteBranches(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:compareIndexes(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=i=>i==="*";function computeScore(i,e){let t=i.split("/"),n=t.length;return t.some(isSplat)&&(n+=splatPenalty),e&&(n+=indexRouteValue),t.filter(r=>!isSplat(r)).reduce((r,s)=>r+(paramRe.test(s)?dynamicSegmentValue:s===""?emptySegmentValue:staticSegmentValue),n)}function compareIndexes(i,e){return i.length===e.length&&i.slice(0,-1).every((n,r)=>n===e[r])?i[i.length-1]-e[e.length-1]:0}function matchRouteBranch(i,e,t=!1){let{routesMeta:n}=i,r={},s="/",a=[];for(let l=0;l<n.length;++l){let u=n[l],d=l===n.length-1,h=s==="/"?e:e.slice(s.length)||"/",p=matchPath({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},h),m=u.route;if(!p&&d&&t&&!n[n.length-1].route.index&&(p=matchPath({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},h)),!p)return null;Object.assign(r,p.params),a.push({params:r,pathname:joinPaths([s,p.pathname]),pathnameBase:normalizePathname(joinPaths([s,p.pathnameBase])),route:m}),p.pathnameBase!=="/"&&(s=joinPaths([s,p.pathnameBase]))}return a}function matchPath(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,n]=compilePath(i.path,i.caseSensitive,i.end),r=e.match(t);if(!r)return null;let s=r[0],a=s.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:n.reduce((d,{paramName:h,isOptional:p},m)=>{if(h==="*"){let v=l[m]||"";a=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const g=l[m];return p&&!g?d[h]=void 0:d[h]=(g||"").replace(/%2F/g,"/"),d},{}),pathname:s,pathnameBase:a,pattern:i}}function compilePath(i,e=!1,t=!0){warning(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let n=[],r="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,u)=>(n.push({paramName:l,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(n.push({paramName:"*"}),r+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":i!==""&&i!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function decodePath(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return warning(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function stripBasename(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=i.charAt(t);return n&&n!=="/"?null:i.slice(t)||"/"}var ABSOLUTE_URL_REGEX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,isAbsoluteUrl=i=>ABSOLUTE_URL_REGEX.test(i);function resolvePath(i,e="/"){let{pathname:t,search:n="",hash:r=""}=typeof i=="string"?parsePath(i):i,s;if(t)if(isAbsoluteUrl(t))s=t;else{if(t.includes("//")){let a=t;t=t.replace(/\/\/+/g,"/"),warning(!1,`Pathnames cannot have embedded double slashes - normalizing ${a} -> ${t}`)}t.startsWith("/")?s=resolvePathname(t.substring(1),"/"):s=resolvePathname(t,e)}else s=e;return{pathname:s,search:normalizeSearch(n),hash:normalizeHash(r)}}function resolvePathname(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function getInvalidPathError(i,e,t,n){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function getPathContributingMatches(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function getResolveToMatches(i){let e=getPathContributingMatches(i);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function resolveTo(i,e,t,n=!1){let r;typeof i=="string"?r=parsePath(i):(r={...i},invariant(!r.pathname||!r.pathname.includes("?"),getInvalidPathError("?","pathname","search",r)),invariant(!r.pathname||!r.pathname.includes("#"),getInvalidPathError("#","pathname","hash",r)),invariant(!r.search||!r.search.includes("#"),getInvalidPathError("#","search","hash",r)));let s=i===""||r.pathname==="",a=s?"/":r.pathname,l;if(a==null)l=t;else{let p=e.length-1;if(!n&&a.startsWith("..")){let m=a.split("/");for(;m[0]==="..";)m.shift(),p-=1;r.pathname=m.join("/")}l=p>=0?e[p]:"/"}let u=resolvePath(r,l),d=a&&a!=="/"&&a.endsWith("/"),h=(s||a===".")&&t.endsWith("/");return!u.pathname.endsWith("/")&&(d||h)&&(u.pathname+="/"),u}var joinPaths=i=>i.join("/").replace(/\/\/+/g,"/"),normalizePathname=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,normalizeHash=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i,ErrorResponseImpl=class{constructor(i,e,t,n=!1){this.status=i,this.statusText=e||"",this.internal=n,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function isRouteErrorResponse(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}function getRoutePattern(i){return i.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var isBrowser=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function parseToInfo(i,e){let t=i;if(typeof t!="string"||!ABSOLUTE_URL_REGEX.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let n=t,r=!1;if(isBrowser)try{let s=new URL(window.location.href),a=t.startsWith("//")?new URL(s.protocol+t):new URL(t),l=stripBasename(a.pathname,e);a.origin===s.origin&&l!=null?t=l+a.search+a.hash:r=!0}catch{warning(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:n,isExternal:r,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var validMutationMethodsArr=["POST","PUT","PATCH","DELETE"];new Set(validMutationMethodsArr);var validRequestMethodsArr=["GET",...validMutationMethodsArr];new Set(validRequestMethodsArr);var DataRouterContext=reactExports.createContext(null);DataRouterContext.displayName="DataRouter";var DataRouterStateContext=reactExports.createContext(null);DataRouterStateContext.displayName="DataRouterState";var RSCRouterContext=reactExports.createContext(!1),ViewTransitionContext=reactExports.createContext({isTransitioning:!1});ViewTransitionContext.displayName="ViewTransition";var FetchersContext=reactExports.createContext(new Map);FetchersContext.displayName="Fetchers";var AwaitContext=reactExports.createContext(null);AwaitContext.displayName="Await";var NavigationContext=reactExports.createContext(null);NavigationContext.displayName="Navigation";var LocationContext=reactExports.createContext(null);LocationContext.displayName="Location";var RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1});RouteContext.displayName="Route";var RouteErrorContext=reactExports.createContext(null);RouteErrorContext.displayName="RouteError";var ERROR_DIGEST_BASE="REACT_ROUTER_ERROR",ERROR_DIGEST_REDIRECT="REDIRECT",ERROR_DIGEST_ROUTE_ERROR_RESPONSE="ROUTE_ERROR_RESPONSE";function decodeRedirectErrorDigest(i){if(i.startsWith(`${ERROR_DIGEST_BASE}:${ERROR_DIGEST_REDIRECT}:{`))try{let e=JSON.parse(i.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function decodeRouteErrorResponseDigest(i){if(i.startsWith(`${ERROR_DIGEST_BASE}:${ERROR_DIGEST_ROUTE_ERROR_RESPONSE}:{`))try{let e=JSON.parse(i.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new ErrorResponseImpl(e.status,e.statusText,e.data)}catch{}}function useHref(i,{relative:e}={}){invariant(useInRouterContext(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=reactExports.useContext(NavigationContext),{hash:r,pathname:s,search:a}=useResolvedPath(i,{relative:e}),l=s;return t!=="/"&&(l=s==="/"?t:joinPaths([t,s])),n.createHref({pathname:l,search:a,hash:r})}function useInRouterContext(){return reactExports.useContext(LocationContext)!=null}function useLocation(){return invariant(useInRouterContext(),"useLocation() may be used only in the context of a <Router> component."),reactExports.useContext(LocationContext).location}var navigateEffectWarning="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function useIsomorphicLayoutEffect(i){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(i)}function useNavigate(){let{isDataRoute:i}=reactExports.useContext(RouteContext);return i?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){invariant(useInRouterContext(),"useNavigate() may be used only in the context of a <Router> component.");let i=reactExports.useContext(DataRouterContext),{basename:e,navigator:t}=reactExports.useContext(NavigationContext),{matches:n}=reactExports.useContext(RouteContext),{pathname:r}=useLocation(),s=JSON.stringify(getResolveToMatches(n)),a=reactExports.useRef(!1);return useIsomorphicLayoutEffect(()=>{a.current=!0}),reactExports.useCallback((u,d={})=>{if(warning(a.current,navigateEffectWarning),!a.current)return;if(typeof u=="number"){t.go(u);return}let h=resolveTo(u,JSON.parse(s),r,d.relative==="path");i==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:joinPaths([e,h.pathname])),(d.replace?t.replace:t.push)(h,d.state,d)},[e,t,s,r,i])}reactExports.createContext(null);function useParams(){let{matches:i}=reactExports.useContext(RouteContext),e=i[i.length-1];return e?e.params:{}}function useResolvedPath(i,{relative:e}={}){let{matches:t}=reactExports.useContext(RouteContext),{pathname:n}=useLocation(),r=JSON.stringify(getResolveToMatches(t));return reactExports.useMemo(()=>resolveTo(i,JSON.parse(r),n,e==="path"),[i,r,n,e])}function useRoutes(i,e){return useRoutesImpl(i,e)}function useRoutesImpl(i,e,t,n,r){invariant(useInRouterContext(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=reactExports.useContext(NavigationContext),{matches:a}=reactExports.useContext(RouteContext),l=a[a.length-1],u=l?l.params:{},d=l?l.pathname:"/",h=l?l.pathnameBase:"/",p=l&&l.route;{let A=p&&p.path||"";warningOnce(d,!p||A.endsWith("*")||A.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${A}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${A}"> to <Route path="${A==="/"?"*":`${A}/*`}">.`)}let m=useLocation(),g;if(e){let A=typeof e=="string"?parsePath(e):e;invariant(h==="/"||A.pathname?.startsWith(h),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${h}" but pathname "${A.pathname}" was given in the \`location\` prop.`),g=A}else g=m;let v=g.pathname||"/",_=v;if(h!=="/"){let A=h.replace(/^\//,"").split("/");_="/"+v.replace(/^\//,"").split("/").slice(A.length).join("/")}let b=matchRoutes(i,{pathname:_});warning(p||b!=null,`No routes matched location "${g.pathname}${g.search}${g.hash}" `),warning(b==null||b[b.length-1].route.element!==void 0||b[b.length-1].route.Component!==void 0||b[b.length-1].route.lazy!==void 0,`Matched leaf route at location "${g.pathname}${g.search}${g.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let E=_renderMatches(b&&b.map(A=>Object.assign({},A,{params:Object.assign({},u,A.params),pathname:joinPaths([h,s.encodeLocation?s.encodeLocation(A.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?h:joinPaths([h,s.encodeLocation?s.encodeLocation(A.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathnameBase])})),a,t,n,r);return e&&E?reactExports.createElement(LocationContext.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...g},navigationType:"POP"}},E):E}function DefaultErrorComponent(){let i=useRouteError(),e=isRouteErrorResponse(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n},s={padding:"2px 4px",backgroundColor:n},a=null;return console.error("Error handled by React Router default ErrorBoundary:",i),a=reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("p",null," Hey developer "),reactExports.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",reactExports.createElement("code",{style:s},"ErrorBoundary")," or"," ",reactExports.createElement("code",{style:s},"errorElement")," prop on your route.")),reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},e),t?reactExports.createElement("pre",{style:r},t):null,a)}var defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null),RenderErrorBoundary=class extends reactExports.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){this.props.onError?this.props.onError(i,e):console.error("React Router caught the following error during render",i)}render(){let i=this.state.error;if(this.context&&typeof i=="object"&&i&&"digest"in i&&typeof i.digest=="string"){const t=decodeRouteErrorResponseDigest(i.digest);t&&(i=t)}let e=i!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:i,children:this.props.component})):this.props.children;return this.context?reactExports.createElement(RSCErrorHandler,{error:i},e):e}};RenderErrorBoundary.contextType=RSCRouterContext;var errorRedirectHandledMap=new WeakMap;function RSCErrorHandler({children:i,error:e}){let{basename:t}=reactExports.useContext(NavigationContext);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let n=decodeRedirectErrorDigest(e.digest);if(n){let r=errorRedirectHandledMap.get(e);if(r)throw r;let s=parseToInfo(n.location,t);if(isBrowser&&!errorRedirectHandledMap.get(e))if(s.isExternal||n.reloadDocument)window.location.href=s.absoluteURL||s.to;else{const a=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(s.to,{replace:n.replace}));throw errorRedirectHandledMap.set(e,a),a}return reactExports.createElement("meta",{httpEquiv:"refresh",content:`0;url=${s.absoluteURL||s.to}`})}}return i}function RenderedRoute({routeContext:i,match:e,children:t}){let n=reactExports.useContext(DataRouterContext);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),reactExports.createElement(RouteContext.Provider,{value:i},t)}function _renderMatches(i,e=[],t=null,n=null,r=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let s=i,a=t?.errors;if(a!=null){let h=s.findIndex(p=>p.route.id&&a?.[p.route.id]!==void 0);invariant(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),s=s.slice(0,Math.min(s.length,h+1))}let l=!1,u=-1;if(t)for(let h=0;h<s.length;h++){let p=s[h];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(u=h),p.route.id){let{loaderData:m,errors:g}=t,v=p.route.loader&&!m.hasOwnProperty(p.route.id)&&(!g||g[p.route.id]===void 0);if(p.route.lazy||v){l=!0,u>=0?s=s.slice(0,u+1):s=[s[0]];break}}}let d=t&&n?(h,p)=>{n(h,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:getRoutePattern(t.matches),errorInfo:p})}:void 0;return s.reduceRight((h,p,m)=>{let g,v=!1,_=null,b=null;t&&(g=a&&p.route.id?a[p.route.id]:void 0,_=p.route.errorElement||defaultErrorElement,l&&(u<0&&m===0?(warningOnce("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,b=null):u===m&&(v=!0,b=p.route.hydrateFallbackElement||null)));let E=e.concat(s.slice(0,m+1)),A=()=>{let z;return g?z=_:v?z=b:p.route.Component?z=reactExports.createElement(p.route.Component,null):p.route.element?z=p.route.element:z=h,reactExports.createElement(RenderedRoute,{match:p,routeContext:{outlet:h,matches:E,isDataRoute:t!=null},children:z})};return t&&(p.route.ErrorBoundary||p.route.errorElement||m===0)?reactExports.createElement(RenderErrorBoundary,{location:t.location,revalidation:t.revalidation,component:_,error:g,children:A(),routeContext:{outlet:null,matches:E,isDataRoute:!0},onError:d}):A()},null)}function getDataRouterConsoleError(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function useDataRouterContext(i){let e=reactExports.useContext(DataRouterContext);return invariant(e,getDataRouterConsoleError(i)),e}function useDataRouterState(i){let e=reactExports.useContext(DataRouterStateContext);return invariant(e,getDataRouterConsoleError(i)),e}function useRouteContext(i){let e=reactExports.useContext(RouteContext);return invariant(e,getDataRouterConsoleError(i)),e}function useCurrentRouteId(i){let e=useRouteContext(i),t=e.matches[e.matches.length-1];return invariant(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function useRouteId(){return useCurrentRouteId("useRouteId")}function useRouteError(){let i=reactExports.useContext(RouteErrorContext),e=useDataRouterState("useRouteError"),t=useCurrentRouteId("useRouteError");return i!==void 0?i:e.errors?.[t]}function useNavigateStable(){let{router:i}=useDataRouterContext("useNavigate"),e=useCurrentRouteId("useNavigate"),t=reactExports.useRef(!1);return useIsomorphicLayoutEffect(()=>{t.current=!0}),reactExports.useCallback(async(r,s={})=>{warning(t.current,navigateEffectWarning),t.current&&(typeof r=="number"?await i.navigate(r):await i.navigate(r,{fromRouteId:e,...s}))},[i,e])}var alreadyWarned={};function warningOnce(i,e,t){!e&&!alreadyWarned[i]&&(alreadyWarned[i]=!0,warning(!1,t))}reactExports.memo(DataRoutes);function DataRoutes({routes:i,future:e,state:t,onError:n}){return useRoutesImpl(i,void 0,t,n,e)}function Navigate({to:i,replace:e,state:t,relative:n}){invariant(useInRouterContext(),"<Navigate> may be used only in the context of a <Router> component.");let{static:r}=reactExports.useContext(NavigationContext);warning(!r,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:s}=reactExports.useContext(RouteContext),{pathname:a}=useLocation(),l=useNavigate(),u=resolveTo(i,getResolveToMatches(s),a,n==="path"),d=JSON.stringify(u);return reactExports.useEffect(()=>{l(JSON.parse(d),{replace:e,state:t,relative:n})},[l,d,n,e,t]),null}function Route(i){invariant(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Router({basename:i="/",children:e=null,location:t,navigationType:n="POP",navigator:r,static:s=!1,unstable_useTransitions:a}){invariant(!useInRouterContext(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=i.replace(/^\/*/,"/"),u=reactExports.useMemo(()=>({basename:l,navigator:r,static:s,unstable_useTransitions:a,future:{}}),[l,r,s,a]);typeof t=="string"&&(t=parsePath(t));let{pathname:d="/",search:h="",hash:p="",state:m=null,key:g="default"}=t,v=reactExports.useMemo(()=>{let _=stripBasename(d,l);return _==null?null:{location:{pathname:_,search:h,hash:p,state:m,key:g},navigationType:n}},[l,d,h,p,m,g,n]);return warning(v!=null,`<Router basename="${l}"> is not able to match the URL "${d}${h}${p}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:reactExports.createElement(NavigationContext.Provider,{value:u},reactExports.createElement(LocationContext.Provider,{children:e,value:v}))}function Routes({children:i,location:e}){return useRoutes(createRoutesFromChildren(i),e)}function createRoutesFromChildren(i,e=[]){let t=[];return reactExports.Children.forEach(i,(n,r)=>{if(!reactExports.isValidElement(n))return;let s=[...e,r];if(n.type===reactExports.Fragment){t.push.apply(t,createRoutesFromChildren(n.props.children,s));return}invariant(n.type===Route,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),invariant(!n.props.index||!n.props.children,"An index route cannot have child routes.");let a={id:n.props.id||s.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,middleware:n.props.middleware,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=createRoutesFromChildren(n.props.children,s)),t.push(a)}),t}var defaultMethod="get",defaultEncType="application/x-www-form-urlencoded";function isHtmlElement(i){return typeof HTMLElement<"u"&&i instanceof HTMLElement}function isButtonElement(i){return isHtmlElement(i)&&i.tagName.toLowerCase()==="button"}function isFormElement(i){return isHtmlElement(i)&&i.tagName.toLowerCase()==="form"}function isInputElement(i){return isHtmlElement(i)&&i.tagName.toLowerCase()==="input"}function isModifiedEvent(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function shouldProcessLinkClick(i,e){return i.button===0&&(!e||e==="_self")&&!isModifiedEvent(i)}var _formDataSupportsSubmitter=null;function isFormDataSubmitterSupported(){if(_formDataSupportsSubmitter===null)try{new FormData(document.createElement("form"),0),_formDataSupportsSubmitter=!1}catch{_formDataSupportsSubmitter=!0}return _formDataSupportsSubmitter}var supportedFormEncTypes=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function getFormEncType(i){return i!=null&&!supportedFormEncTypes.has(i)?(warning(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${defaultEncType}"`),null):i}function getFormSubmissionInfo(i,e){let t,n,r,s,a;if(isFormElement(i)){let l=i.getAttribute("action");n=l?stripBasename(l,e):null,t=i.getAttribute("method")||defaultMethod,r=getFormEncType(i.getAttribute("enctype"))||defaultEncType,s=new FormData(i)}else if(isButtonElement(i)||isInputElement(i)&&(i.type==="submit"||i.type==="image")){let l=i.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=i.getAttribute("formaction")||l.getAttribute("action");if(n=u?stripBasename(u,e):null,t=i.getAttribute("formmethod")||l.getAttribute("method")||defaultMethod,r=getFormEncType(i.getAttribute("formenctype"))||getFormEncType(l.getAttribute("enctype"))||defaultEncType,s=new FormData(l,i),!isFormDataSubmitterSupported()){let{name:d,type:h,value:p}=i;if(h==="image"){let m=d?`${d}.`:"";s.append(`${m}x`,"0"),s.append(`${m}y`,"0")}else d&&s.append(d,p)}}else{if(isHtmlElement(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=defaultMethod,n=null,r=defaultEncType,a=i}return s&&r==="text/plain"&&(a=s,s=void 0),{action:n,method:t.toLowerCase(),encType:r,formData:s,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function invariant2(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function singleFetchUrl(i,e,t,n){let r=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return t?r.pathname.endsWith("/")?r.pathname=`${r.pathname}_.${n}`:r.pathname=`${r.pathname}.${n}`:r.pathname==="/"?r.pathname=`_root.${n}`:e&&stripBasename(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function loadRouteModule(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function isHtmlLinkDescriptor(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function getKeyedPrefetchLinks(i,e,t){let n=await Promise.all(i.map(async r=>{let s=e.routes[r.route.id];if(s){let a=await loadRouteModule(s,t);return a.links?a.links():[]}return[]}));return dedupeLinkDescriptors(n.flat(1).filter(isHtmlLinkDescriptor).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function getNewMatchesForLinks(i,e,t,n,r,s){let a=(u,d)=>t[d]?u.route.id!==t[d].route.id:!0,l=(u,d)=>t[d].pathname!==u.pathname||t[d].route.path?.endsWith("*")&&t[d].params["*"]!==u.params["*"];return s==="assets"?e.filter((u,d)=>a(u,d)||l(u,d)):s==="data"?e.filter((u,d)=>{let h=n.routes[u.route.id];if(!h||!h.hasLoader)return!1;if(a(u,d)||l(u,d))return!0;if(u.route.shouldRevalidate){let p=u.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(i,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function getModuleLinkHrefs(i,e,{includeHydrateFallback:t}={}){return dedupeHrefs(i.map(n=>{let r=e.routes[n.route.id];if(!r)return[];let s=[r.module];return r.clientActionModule&&(s=s.concat(r.clientActionModule)),r.clientLoaderModule&&(s=s.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(s=s.concat(r.hydrateFallbackModule)),r.imports&&(s=s.concat(r.imports)),s}).flat(1))}function dedupeHrefs(i){return[...new Set(i)]}function sortKeys(i){let e={},t=Object.keys(i).sort();for(let n of t)e[n]=i[n];return e}function dedupeLinkDescriptors(i,e){let t=new Set;return new Set(e),i.reduce((n,r)=>{let s=JSON.stringify(sortKeys(r));return t.has(s)||(t.add(s),n.push({key:s,link:r})),n},[])}function useDataRouterContext2(){let i=reactExports.useContext(DataRouterContext);return invariant2(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function useDataRouterStateContext(){let i=reactExports.useContext(DataRouterStateContext);return invariant2(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var FrameworkContext=reactExports.createContext(void 0);FrameworkContext.displayName="FrameworkContext";function useFrameworkContext(){let i=reactExports.useContext(FrameworkContext);return invariant2(i,"You must render this element inside a <HydratedRouter> element"),i}function usePrefetchBehavior(i,e){let t=reactExports.useContext(FrameworkContext),[n,r]=reactExports.useState(!1),[s,a]=reactExports.useState(!1),{onFocus:l,onBlur:u,onMouseEnter:d,onMouseLeave:h,onTouchStart:p}=e,m=reactExports.useRef(null);reactExports.useEffect(()=>{if(i==="render"&&a(!0),i==="viewport"){let _=E=>{E.forEach(A=>{a(A.isIntersecting)})},b=new IntersectionObserver(_,{threshold:.5});return m.current&&b.observe(m.current),()=>{b.disconnect()}}},[i]),reactExports.useEffect(()=>{if(n){let _=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(_)}}},[n]);let g=()=>{r(!0)},v=()=>{r(!1),a(!1)};return t?i!=="intent"?[s,m,{}]:[s,m,{onFocus:composeEventHandlers(l,g),onBlur:composeEventHandlers(u,v),onMouseEnter:composeEventHandlers(d,g),onMouseLeave:composeEventHandlers(h,v),onTouchStart:composeEventHandlers(p,g)}]:[!1,m,{}]}function composeEventHandlers(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function PrefetchPageLinks({page:i,...e}){let{router:t}=useDataRouterContext2(),n=reactExports.useMemo(()=>matchRoutes(t.routes,i,t.basename),[t.routes,i,t.basename]);return n?reactExports.createElement(PrefetchPageLinksImpl,{page:i,matches:n,...e}):null}function useKeyedPrefetchLinks(i){let{manifest:e,routeModules:t}=useFrameworkContext(),[n,r]=reactExports.useState([]);return reactExports.useEffect(()=>{let s=!1;return getKeyedPrefetchLinks(i,e,t).then(a=>{s||r(a)}),()=>{s=!0}},[i,e,t]),n}function PrefetchPageLinksImpl({page:i,matches:e,...t}){let n=useLocation(),{future:r,manifest:s,routeModules:a}=useFrameworkContext(),{basename:l}=useDataRouterContext2(),{loaderData:u,matches:d}=useDataRouterStateContext(),h=reactExports.useMemo(()=>getNewMatchesForLinks(i,e,d,s,n,"data"),[i,e,d,s,n]),p=reactExports.useMemo(()=>getNewMatchesForLinks(i,e,d,s,n,"assets"),[i,e,d,s,n]),m=reactExports.useMemo(()=>{if(i===n.pathname+n.search+n.hash)return[];let _=new Set,b=!1;if(e.forEach(A=>{let z=s.routes[A.route.id];!z||!z.hasLoader||(!h.some(D=>D.route.id===A.route.id)&&A.route.id in u&&a[A.route.id]?.shouldRevalidate||z.hasClientLoader?b=!0:_.add(A.route.id))}),_.size===0)return[];let E=singleFetchUrl(i,l,r.unstable_trailingSlashAwareDataRequests,"data");return b&&_.size>0&&E.searchParams.set("_routes",e.filter(A=>_.has(A.route.id)).map(A=>A.route.id).join(",")),[E.pathname+E.search]},[l,r.unstable_trailingSlashAwareDataRequests,u,n,s,h,e,i,a]),g=reactExports.useMemo(()=>getModuleLinkHrefs(p,s),[p,s]),v=useKeyedPrefetchLinks(p);return reactExports.createElement(reactExports.Fragment,null,m.map(_=>reactExports.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...t})),g.map(_=>reactExports.createElement("link",{key:_,rel:"modulepreload",href:_,...t})),v.map(({key:_,link:b})=>reactExports.createElement("link",{key:_,nonce:t.nonce,...b})))}function mergeRefs(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var isBrowser2=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{isBrowser2&&(window.__reactRouterVersion="7.12.0")}catch{}function BrowserRouter({basename:i,children:e,unstable_useTransitions:t,window:n}){let r=reactExports.useRef();r.current==null&&(r.current=createBrowserHistory({window:n,v5Compat:!0}));let s=r.current,[a,l]=reactExports.useState({action:s.action,location:s.location}),u=reactExports.useCallback(d=>{t===!1?l(d):reactExports.startTransition(()=>l(d))},[t]);return reactExports.useLayoutEffect(()=>s.listen(u),[s,u]),reactExports.createElement(Router,{basename:i,children:e,location:a.location,navigationType:a.action,navigator:s,unstable_useTransitions:t})}var ABSOLUTE_URL_REGEX2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link=reactExports.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:r,reloadDocument:s,replace:a,state:l,target:u,to:d,preventScrollReset:h,viewTransition:p,unstable_defaultShouldRevalidate:m,...g},v){let{basename:_,unstable_useTransitions:b}=reactExports.useContext(NavigationContext),E=typeof d=="string"&&ABSOLUTE_URL_REGEX2.test(d),A=parseToInfo(d,_);d=A.to;let z=useHref(d,{relative:r}),[D,P,G]=usePrefetchBehavior(n,g),R=useLinkClickHandler(d,{replace:a,state:l,target:u,preventScrollReset:h,relative:r,viewTransition:p,unstable_defaultShouldRevalidate:m,unstable_useTransitions:b});function I(H){e&&e(H),H.defaultPrevented||R(H)}let w=reactExports.createElement("a",{...g,...G,href:A.absoluteURL||z,onClick:A.isExternal||s?e:I,ref:mergeRefs(v,P),target:u,"data-discover":!E&&t==="render"?"true":void 0});return D&&!E?reactExports.createElement(reactExports.Fragment,null,w,reactExports.createElement(PrefetchPageLinks,{page:z})):w});Link.displayName="Link";var NavLink=reactExports.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:r=!1,style:s,to:a,viewTransition:l,children:u,...d},h){let p=useResolvedPath(a,{relative:d.relative}),m=useLocation(),g=reactExports.useContext(DataRouterStateContext),{navigator:v,basename:_}=reactExports.useContext(NavigationContext),b=g!=null&&useViewTransitionState(p)&&l===!0,E=v.encodeLocation?v.encodeLocation(p).pathname:p.pathname,A=m.pathname,z=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;t||(A=A.toLowerCase(),z=z?z.toLowerCase():null,E=E.toLowerCase()),z&&_&&(z=stripBasename(z,_)||z);const D=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let P=A===E||!r&&A.startsWith(E)&&A.charAt(D)==="/",G=z!=null&&(z===E||!r&&z.startsWith(E)&&z.charAt(E.length)==="/"),R={isActive:P,isPending:G,isTransitioning:b},I=P?e:void 0,w;typeof n=="function"?w=n(R):w=[n,P?"active":null,G?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let H=typeof s=="function"?s(R):s;return reactExports.createElement(Link,{...d,"aria-current":I,className:w,ref:h,style:H,to:a,viewTransition:l},typeof u=="function"?u(R):u)});NavLink.displayName="NavLink";var Form=reactExports.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:r,state:s,method:a=defaultMethod,action:l,onSubmit:u,relative:d,preventScrollReset:h,viewTransition:p,unstable_defaultShouldRevalidate:m,...g},v)=>{let{unstable_useTransitions:_}=reactExports.useContext(NavigationContext),b=useSubmit(),E=useFormAction(l,{relative:d}),A=a.toLowerCase()==="get"?"get":"post",z=typeof l=="string"&&ABSOLUTE_URL_REGEX2.test(l),D=P=>{if(u&&u(P),P.defaultPrevented)return;P.preventDefault();let G=P.nativeEvent.submitter,R=G?.getAttribute("formmethod")||a,I=()=>b(G||P.currentTarget,{fetcherKey:e,method:R,navigate:t,replace:r,state:s,relative:d,preventScrollReset:h,viewTransition:p,unstable_defaultShouldRevalidate:m});_&&t!==!1?reactExports.startTransition(()=>I()):I()};return reactExports.createElement("form",{ref:v,method:A,action:E,onSubmit:n?u:D,...g,"data-discover":!z&&i==="render"?"true":void 0})});Form.displayName="Form";function getDataRouterConsoleError2(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function useDataRouterContext3(i){let e=reactExports.useContext(DataRouterContext);return invariant(e,getDataRouterConsoleError2(i)),e}function useLinkClickHandler(i,{target:e,replace:t,state:n,preventScrollReset:r,relative:s,viewTransition:a,unstable_defaultShouldRevalidate:l,unstable_useTransitions:u}={}){let d=useNavigate(),h=useLocation(),p=useResolvedPath(i,{relative:s});return reactExports.useCallback(m=>{if(shouldProcessLinkClick(m,e)){m.preventDefault();let g=t!==void 0?t:createPath(h)===createPath(p),v=()=>d(i,{replace:g,state:n,preventScrollReset:r,relative:s,viewTransition:a,unstable_defaultShouldRevalidate:l});u?reactExports.startTransition(()=>v()):v()}},[h,d,p,t,n,e,i,r,s,a,l,u])}var fetcherId=0,getUniqueFetcherId=()=>`__${String(++fetcherId)}__`;function useSubmit(){let{router:i}=useDataRouterContext3("useSubmit"),{basename:e}=reactExports.useContext(NavigationContext),t=useRouteId(),n=i.fetch,r=i.navigate;return reactExports.useCallback(async(s,a={})=>{let{action:l,method:u,encType:d,formData:h,body:p}=getFormSubmissionInfo(s,e);if(a.navigate===!1){let m=a.fetcherKey||getUniqueFetcherId();await n(m,t,a.action||l,{unstable_defaultShouldRevalidate:a.unstable_defaultShouldRevalidate,preventScrollReset:a.preventScrollReset,formData:h,body:p,formMethod:a.method||u,formEncType:a.encType||d,flushSync:a.flushSync})}else await r(a.action||l,{unstable_defaultShouldRevalidate:a.unstable_defaultShouldRevalidate,preventScrollReset:a.preventScrollReset,formData:h,body:p,formMethod:a.method||u,formEncType:a.encType||d,replace:a.replace,state:a.state,fromRouteId:t,flushSync:a.flushSync,viewTransition:a.viewTransition})},[n,r,e,t])}function useFormAction(i,{relative:e}={}){let{basename:t}=reactExports.useContext(NavigationContext),n=reactExports.useContext(RouteContext);invariant(n,"useFormAction must be used inside a RouteContext");let[r]=n.matches.slice(-1),s={...useResolvedPath(i||".",{relative:e})},a=useLocation();if(i==null){s.search=a.search;let l=new URLSearchParams(s.search),u=l.getAll("index");if(u.some(h=>h==="")){l.delete("index"),u.filter(p=>p).forEach(p=>l.append("index",p));let h=l.toString();s.search=h?`?${h}`:""}}return(!i||i===".")&&r.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:joinPaths([t,s.pathname])),createPath(s)}function useViewTransitionState(i,{relative:e}={}){let t=reactExports.useContext(ViewTransitionContext);invariant(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=useDataRouterContext3("useViewTransitionState"),r=useResolvedPath(i,{relative:e});if(!t.isTransitioning)return!1;let s=stripBasename(t.currentLocation.pathname,n)||t.currentLocation.pathname,a=stripBasename(t.nextLocation.pathname,n)||t.nextLocation.pathname;return matchPath(r.pathname,a)!=null||matchPath(r.pathname,s)!=null}const getDefaultsFromPostinstall=()=>{};var define_process_env_default={};const stringToByteArray$1=function(i){const e=[];let t=0;for(let n=0;n<i.length;n++){let r=i.charCodeAt(n);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&n+1<i.length&&(i.charCodeAt(n+1)&64512)===56320?(r=65536+((r&1023)<<10)+(i.charCodeAt(++n)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},byteArrayToString=function(i){const e=[];let t=0,n=0;for(;t<i.length;){const r=i[t++];if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){const s=i[t++];e[n++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=i[t++],a=i[t++],l=i[t++],u=((r&7)<<18|(s&63)<<12|(a&63)<<6|l&63)-65536;e[n++]=String.fromCharCode(55296+(u>>10)),e[n++]=String.fromCharCode(56320+(u&1023))}else{const s=i[t++],a=i[t++];e[n++]=String.fromCharCode((r&15)<<12|(s&63)<<6|a&63)}}return e.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(i,e){if(!Array.isArray(i))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let r=0;r<i.length;r+=3){const s=i[r],a=r+1<i.length,l=a?i[r+1]:0,u=r+2<i.length,d=u?i[r+2]:0,h=s>>2,p=(s&3)<<4|l>>4;let m=(l&15)<<2|d>>6,g=d&63;u||(g=64,a||(m=64)),n.push(t[h],t[p],t[m],t[g])}return n.join("")},encodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(i):this.encodeByteArray(stringToByteArray$1(i),e)},decodeString(i,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(i):byteArrayToString(this.decodeStringToByteArray(i,e))},decodeStringToByteArray(i,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let r=0;r<i.length;){const s=t[i.charAt(r++)],l=r<i.length?t[i.charAt(r)]:0;++r;const d=r<i.length?t[i.charAt(r)]:64;++r;const p=r<i.length?t[i.charAt(r)]:64;if(++r,s==null||l==null||d==null||p==null)throw new DecodeBase64StringError;const m=s<<2|l>>4;if(n.push(m),d!==64){const g=l<<4&240|d>>2;if(n.push(g),p!==64){const v=d<<6&192|p;n.push(v)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64Encode=function(i){const e=stringToByteArray$1(i);return base64.encodeByteArray(e,!0)},base64urlEncodeWithoutPadding=function(i){return base64Encode(i).replace(/\./g,"")},base64Decode=function(i){try{return base64.decodeString(i,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function getGlobal(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const getDefaultsFromGlobal=()=>getGlobal().__FIREBASE_DEFAULTS__,getDefaultsFromEnvVariable=()=>{if(typeof process>"u"||typeof define_process_env_default>"u")return;const i=define_process_env_default.__FIREBASE_DEFAULTS__;if(i)return JSON.parse(i)},getDefaultsFromCookie=()=>{if(typeof document>"u")return;let i;try{i=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=i&&base64Decode(i[1]);return e&&JSON.parse(e)},getDefaults=()=>{try{return getDefaultsFromPostinstall()||getDefaultsFromGlobal()||getDefaultsFromEnvVariable()||getDefaultsFromCookie()}catch(i){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${i}`);return}},getDefaultEmulatorHost=i=>getDefaults()?.emulatorHosts?.[i],getDefaultEmulatorHostnameAndPort=i=>{const e=getDefaultEmulatorHost(i);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},getDefaultAppConfig=()=>getDefaults()?.config,getExperimentalSetting=i=>getDefaults()?.[`_${i}`];class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}function isCloudWorkstation(i){try{return(i.startsWith("http://")||i.startsWith("https://")?new URL(i).hostname:i).endsWith(".cloudworkstations.dev")}catch{return!1}}async function pingServer(i){return(await fetch(i,{credentials:"include"})).ok}function createMockUserToken(i,e){if(i.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",r=i.iat||0,s=i.sub||i.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...i};return[base64urlEncodeWithoutPadding(JSON.stringify(t)),base64urlEncodeWithoutPadding(JSON.stringify(a)),""].join(".")}const emulatorStatus={};function getEmulatorSummary(){const i={prod:[],emulator:[]};for(const e of Object.keys(emulatorStatus))emulatorStatus[e]?i.emulator.push(e):i.prod.push(e);return i}function getOrCreateEl(i){let e=document.getElementById(i),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",i),t=!0),{created:t,element:e}}let previouslyDismissed=!1;function updateEmulatorBanner(i,e){if(typeof window>"u"||typeof document>"u"||!isCloudWorkstation(window.location.host)||emulatorStatus[i]===e||emulatorStatus[i]||previouslyDismissed)return;emulatorStatus[i]=e;function t(m){return`__firebase__banner__${m}`}const n="__firebase__banner",s=getEmulatorSummary().prod.length>0;function a(){const m=document.getElementById(n);m&&m.remove()}function l(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function u(m,g){m.setAttribute("width","24"),m.setAttribute("id",g),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function d(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{previouslyDismissed=!0,a()},m}function h(m,g){m.setAttribute("id",g),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function p(){const m=getOrCreateEl(n),g=t("text"),v=document.getElementById(g)||document.createElement("span"),_=t("learnmore"),b=document.getElementById(_)||document.createElement("a"),E=t("preprendIcon"),A=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const z=m.element;l(z),h(b,_);const D=d();u(A,E),z.append(A,v,b,D),document.body.appendChild(z)}s?(v.innerText="Preview backend disconnected.",A.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(A.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,v.innerText="Preview backend running in this workspace."),v.setAttribute("id",g)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function getUA(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function isMobileCordova(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())}function isNode(){const i=getDefaults()?.forceEnvironment;if(i==="node")return!0;if(i==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function isCloudflareWorker(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function isBrowserExtension(){const i=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof i=="object"&&i.id!==void 0}function isReactNative(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function isIE(){const i=getUA();return i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0}function isSafari(){return!isNode()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function isIndexedDBAvailable(){try{return typeof indexedDB=="object"}catch{return!1}}function validateIndexedDBOpenable(){return new Promise((i,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(n),i(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],a=s?replaceTemplate(s,n):"Error",l=`${this.serviceName}: ${a} (${r}).`;return new FirebaseError(r,l,n)}}function replaceTemplate(i,e){return i.replace(PATTERN,(t,n)=>{const r=e[n];return r!=null?String(r):`<${n}?>`})}const PATTERN=/\{\$([^}]+)}/g;function isEmpty$1(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}function deepEqual(i,e){if(i===e)return!0;const t=Object.keys(i),n=Object.keys(e);for(const r of t){if(!n.includes(r))return!1;const s=i[r],a=e[r];if(isObject$2(s)&&isObject$2(a)){if(!deepEqual(s,a))return!1}else if(s!==a)return!1}for(const r of n)if(!t.includes(r))return!1;return!0}function isObject$2(i){return i!==null&&typeof i=="object"}function querystring(i){const e=[];for(const[t,n]of Object.entries(i))Array.isArray(n)?n.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function querystringDecode(i){const e={};return i.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[r,s]=n.split("=");e[decodeURIComponent(r)]=decodeURIComponent(s)}}),e}function extractQuerystring(i){const e=i.indexOf("?");if(!e)return"";const t=i.indexOf("#",e);return i.substring(e,t>0?t:void 0)}function createSubscribe(i,e){const t=new ObserverProxy(i,e);return t.subscribe.bind(t)}class ObserverProxy{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");implementsAnyMethods(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:n},r.next===void 0&&(r.next=noop$1),r.error===void 0&&(r.error=noop$1),r.complete===void 0&&(r.complete=noop$1);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function implementsAnyMethods(i,e){if(typeof i!="object"||i===null)return!1;for(const t of e)if(t in i&&typeof i[t]=="function")return!0;return!1}function noop$1(){}function getModularInstance(i){return i&&i._delegate?i._delegate:i}let Component$2=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};const DEFAULT_ENTRY_NAME$1="[DEFAULT]";class Provider{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Deferred;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(n)return null;throw r}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(isComponentEager(e))try{this.getOrInitializeService({instanceIdentifier:DEFAULT_ENTRY_NAME$1})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:r});n.resolve(s)}catch{}}}}clearInstance(e=DEFAULT_ENTRY_NAME$1){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=DEFAULT_ENTRY_NAME$1){return this.instances.has(e)}getOptions(e=DEFAULT_ENTRY_NAME$1){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);n===l&&a.resolve(r)}return r}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);const s=this.instances.get(n);return s&&e(s,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=DEFAULT_ENTRY_NAME$1){return this.component?this.component.multipleInstances?e:DEFAULT_ENTRY_NAME$1:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function normalizeIdentifierForFactory(i){return i===DEFAULT_ENTRY_NAME$1?void 0:i}function isComponentEager(i){return i.instantiationMode==="EAGER"}class ComponentContainer{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Provider(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var LogLevel;(function(i){i[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT"})(LogLevel||(LogLevel={}));const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(i,e,...t)=>{if(e<i.logLevel)return;const n=new Date().toISOString(),r=ConsoleMethod[e];if(r)console[r](`[${n}]  ${i.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Logger{constructor(e){this.name=e,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in LogLevel))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?levelStringToEnum[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...e),this._logHandler(this,LogLevel.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...e),this._logHandler(this,LogLevel.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...e),this._logHandler(this,LogLevel.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...e),this._logHandler(this,LogLevel.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...e),this._logHandler(this,LogLevel.ERROR,...e)}}const instanceOfAny=(i,e)=>e.some(t=>i instanceof t);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(i){const e=new Promise((t,n)=>{const r=()=>{i.removeEventListener("success",s),i.removeEventListener("error",a)},s=()=>{t(wrap(i.result)),r()},a=()=>{n(i.error),r()};i.addEventListener("success",s),i.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&cursorRequestMap.set(t,i)}).catch(()=>{}),reverseTransformCache.set(e,i),e}function cacheDonePromiseForTransaction(i){if(transactionDoneMap.has(i))return;const e=new Promise((t,n)=>{const r=()=>{i.removeEventListener("complete",s),i.removeEventListener("error",a),i.removeEventListener("abort",a)},s=()=>{t(),r()},a=()=>{n(i.error||new DOMException("AbortError","AbortError")),r()};i.addEventListener("complete",s),i.addEventListener("error",a),i.addEventListener("abort",a)});transactionDoneMap.set(i,e)}let idbProxyTraps={get(i,e,t){if(i instanceof IDBTransaction){if(e==="done")return transactionDoneMap.get(i);if(e==="objectStoreNames")return i.objectStoreNames||transactionStoreNamesMap.get(i);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return wrap(i[e])},set(i,e,t){return i[e]=t,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function replaceTraps(i){idbProxyTraps=i(idbProxyTraps)}function wrapFunction(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=i.call(unwrap(this),e,...t);return transactionStoreNamesMap.set(n,e.sort?e.sort():[e]),wrap(n)}:getCursorAdvanceMethods().includes(i)?function(...e){return i.apply(unwrap(this),e),wrap(cursorRequestMap.get(this))}:function(...e){return wrap(i.apply(unwrap(this),e))}}function transformCachableValue(i){return typeof i=="function"?wrapFunction(i):(i instanceof IDBTransaction&&cacheDonePromiseForTransaction(i),instanceOfAny(i,getIdbProxyableTypes())?new Proxy(i,idbProxyTraps):i)}function wrap(i){if(i instanceof IDBRequest)return promisifyRequest(i);if(transformCache.has(i))return transformCache.get(i);const e=transformCachableValue(i);return e!==i&&(transformCache.set(i,e),reverseTransformCache.set(e,i)),e}const unwrap=i=>reverseTransformCache.get(i);function openDB(i,e,{blocked:t,upgrade:n,blocking:r,terminated:s}={}){const a=indexedDB.open(i,e),l=wrap(a);return n&&a.addEventListener("upgradeneeded",u=>{n(wrap(a.result),u.oldVersion,u.newVersion,wrap(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{s&&u.addEventListener("close",()=>s()),r&&u.addEventListener("versionchange",d=>r(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(cachedMethods.get(e))return cachedMethods.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,r=writeMethods.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(r||readMethods.includes(t)))return;const s=async function(a,...l){const u=this.transaction(a,r?"readwrite":"readonly");let d=u.store;return n&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),r&&u.done]))[0]};return cachedMethods.set(e,s),s}replaceTraps(i=>({...i,get:(e,t,n)=>getMethod(e,t)||i.get(e,t,n),has:(e,t)=>!!getMethod(e,t)||i.has(e,t)}));class PlatformLoggerServiceImpl{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(isVersionServiceProvider(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function isVersionServiceProvider(i){return i.getComponent()?.type==="VERSION"}const name$q="@firebase/app",version$1$1="0.14.6";const logger$1=new Logger("@firebase/app"),name$p="@firebase/app-compat",name$o="@firebase/analytics-compat",name$n="@firebase/analytics",name$m="@firebase/app-check-compat",name$l="@firebase/app-check",name$k="@firebase/auth",name$j="@firebase/auth-compat",name$i="@firebase/database",name$h="@firebase/data-connect",name$g="@firebase/database-compat",name$f="@firebase/functions",name$e="@firebase/functions-compat",name$d="@firebase/installations",name$c="@firebase/installations-compat",name$b="@firebase/messaging",name$a="@firebase/messaging-compat",name$9="@firebase/performance",name$8="@firebase/performance-compat",name$7="@firebase/remote-config",name$6="@firebase/remote-config-compat",name$5="@firebase/storage",name$4="@firebase/storage-compat",name$3="@firebase/firestore",name$2$1="@firebase/ai",name$1$1="@firebase/firestore-compat",name$r="firebase",version$b="12.6.0";const DEFAULT_ENTRY_NAME="[DEFAULT]",PLATFORM_LOG_STRING={[name$q]:"fire-core",[name$p]:"fire-core-compat",[name$n]:"fire-analytics",[name$o]:"fire-analytics-compat",[name$l]:"fire-app-check",[name$m]:"fire-app-check-compat",[name$k]:"fire-auth",[name$j]:"fire-auth-compat",[name$i]:"fire-rtdb",[name$h]:"fire-data-connect",[name$g]:"fire-rtdb-compat",[name$f]:"fire-fn",[name$e]:"fire-fn-compat",[name$d]:"fire-iid",[name$c]:"fire-iid-compat",[name$b]:"fire-fcm",[name$a]:"fire-fcm-compat",[name$9]:"fire-perf",[name$8]:"fire-perf-compat",[name$7]:"fire-rc",[name$6]:"fire-rc-compat",[name$5]:"fire-gcs",[name$4]:"fire-gcs-compat",[name$3]:"fire-fst",[name$1$1]:"fire-fst-compat",[name$2$1]:"fire-vertex","fire-js":"fire-js",[name$r]:"fire-js-all"};const _apps=new Map,_serverApps=new Map,_components=new Map;function _addComponent(i,e){try{i.container.addComponent(e)}catch(t){logger$1.debug(`Component ${e.name} failed to register with FirebaseApp ${i.name}`,t)}}function _registerComponent(i){const e=i.name;if(_components.has(e))return logger$1.debug(`There were multiple attempts to register component ${e}.`),!1;_components.set(e,i);for(const t of _apps.values())_addComponent(t,i);for(const t of _serverApps.values())_addComponent(t,i);return!0}function _getProvider(i,e){const t=i.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),i.container.getProvider(e)}function _isFirebaseServerApp(i){return i==null?!1:i.settings!==void 0}const ERRORS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ERROR_FACTORY=new ErrorFactory("app","Firebase",ERRORS);class FirebaseAppImpl{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Component$2("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY.create("app-deleted",{appName:this._name})}}const SDK_VERSION=version$b;function initializeApp(i,e={}){let t=i;typeof e!="object"&&(e={name:e});const n={name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:!0,...e},r=n.name;if(typeof r!="string"||!r)throw ERROR_FACTORY.create("bad-app-name",{appName:String(r)});if(t||(t=getDefaultAppConfig()),!t)throw ERROR_FACTORY.create("no-options");const s=_apps.get(r);if(s){if(deepEqual(t,s.options)&&deepEqual(n,s.config))return s;throw ERROR_FACTORY.create("duplicate-app",{appName:r})}const a=new ComponentContainer(r);for(const u of _components.values())a.addComponent(u);const l=new FirebaseAppImpl(t,n,a);return _apps.set(r,l),l}function getApp(i=DEFAULT_ENTRY_NAME){const e=_apps.get(i);if(!e&&i===DEFAULT_ENTRY_NAME&&getDefaultAppConfig())return initializeApp();if(!e)throw ERROR_FACTORY.create("no-app",{appName:i});return e}function registerVersion(i,e,t){let n=PLATFORM_LOG_STRING[i]??i;t&&(n+=`-${t}`);const r=n.match(/\s|\//),s=e.match(/\s|\//);if(r||s){const a=[`Unable to register library "${n}" with version "${e}":`];r&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),r&&s&&a.push("and"),s&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),logger$1.warn(a.join(" "));return}_registerComponent(new Component$2(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}const DB_NAME$1="firebase-heartbeat-database",DB_VERSION$1=1,STORE_NAME="firebase-heartbeat-store";let dbPromise=null;function getDbPromise(){return dbPromise||(dbPromise=openDB(DB_NAME$1,DB_VERSION$1,{upgrade:(i,e)=>{switch(e){case 0:try{i.createObjectStore(STORE_NAME)}catch(t){console.warn(t)}}}}).catch(i=>{throw ERROR_FACTORY.create("idb-open",{originalErrorMessage:i.message})})),dbPromise}async function readHeartbeatsFromIndexedDB(i){try{const t=(await getDbPromise()).transaction(STORE_NAME),n=await t.objectStore(STORE_NAME).get(computeKey(i));return await t.done,n}catch(e){if(e instanceof FirebaseError)logger$1.warn(e.message);else{const t=ERROR_FACTORY.create("idb-get",{originalErrorMessage:e?.message});logger$1.warn(t.message)}}}async function writeHeartbeatsToIndexedDB(i,e){try{const n=(await getDbPromise()).transaction(STORE_NAME,"readwrite");await n.objectStore(STORE_NAME).put(e,computeKey(i)),await n.done}catch(t){if(t instanceof FirebaseError)logger$1.warn(t.message);else{const n=ERROR_FACTORY.create("idb-set",{originalErrorMessage:t?.message});logger$1.warn(n.message)}}}function computeKey(i){return`${i.name}!${i.options.appId}`}const MAX_HEADER_BYTES=1024,MAX_NUM_STORED_HEARTBEATS=30;class HeartbeatServiceImpl{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=getUTCDateString();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(r=>r.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats.length>MAX_NUM_STORED_HEARTBEATS){const r=getEarliestHeartbeatIdx(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){logger$1.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=getUTCDateString(),{heartbeatsToSend:t,unsentEntries:n}=extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats),r=base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return logger$1.warn(e),""}}}function getUTCDateString(){return new Date().toISOString().substring(0,10)}function extractHeartbeatsForHeader(i,e=MAX_HEADER_BYTES){const t=[];let n=i.slice();for(const r of i){const s=t.find(a=>a.agent===r.agent);if(s){if(s.dates.push(r.date),countBytes$1(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),countBytes$1(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class HeartbeatStorageImpl{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return isIndexedDBAvailable()?validateIndexedDBOpenable().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await readHeartbeatsFromIndexedDB(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function countBytes$1(i){return base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:i})).length}function getEarliestHeartbeatIdx(i){if(i.length===0)return-1;let e=0,t=i[0].date;for(let n=1;n<i.length;n++)i[n].date<t&&(t=i[n].date,e=n);return e}function registerCoreComponents(i){_registerComponent(new Component$2("platform-logger",e=>new PlatformLoggerServiceImpl(e),"PRIVATE")),_registerComponent(new Component$2("heartbeat",e=>new HeartbeatServiceImpl(e),"PRIVATE")),registerVersion(name$q,version$1$1,i),registerVersion(name$q,version$1$1,"esm2020"),registerVersion("fire-js","")}registerCoreComponents("");var name$2="firebase",version$a="12.7.0";registerVersion(name$2,version$a,"app");function _prodErrorMap(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const prodErrorMap=_prodErrorMap,_DEFAULT_AUTH_ERROR_FACTORY=new ErrorFactory("auth","Firebase",_prodErrorMap());const logClient=new Logger("@firebase/auth");function _logWarn(i,...e){logClient.logLevel<=LogLevel.WARN&&logClient.warn(`Auth (${SDK_VERSION}): ${i}`,...e)}function _logError(i,...e){logClient.logLevel<=LogLevel.ERROR&&logClient.error(`Auth (${SDK_VERSION}): ${i}`,...e)}function _fail(i,...e){throw createErrorInternal(i,...e)}function _createError(i,...e){return createErrorInternal(i,...e)}function _errorWithCustomMessage(i,e,t){const n={...prodErrorMap(),[e]:t};return new ErrorFactory("auth","Firebase",n).create(e,{appName:i.name})}function _serverAppCurrentUserOperationNotSupportedError(i){return _errorWithCustomMessage(i,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function createErrorInternal(i,...e){if(typeof i!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=i.name),i._errorFactory.create(t,...n)}return _DEFAULT_AUTH_ERROR_FACTORY.create(i,...e)}function _assert(i,e,...t){if(!i)throw createErrorInternal(e,...t)}function debugFail(i){const e="INTERNAL ASSERTION FAILED: "+i;throw _logError(e),new Error(e)}function debugAssert(i,e){i||debugFail(e)}function _getCurrentUrl(){return typeof self<"u"&&self.location?.href||""}function _isHttpOrHttps(){return _getCurrentScheme()==="http:"||_getCurrentScheme()==="https:"}function _getCurrentScheme(){return typeof self<"u"&&self.location?.protocol||null}function _isOnline(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(_isHttpOrHttps()||isBrowserExtension()||"connection"in navigator)?navigator.onLine:!0}function _getUserLanguage(){if(typeof navigator>"u")return null;const i=navigator;return i.languages&&i.languages[0]||i.language||null}class Delay{constructor(e,t){this.shortDelay=e,this.longDelay=t,debugAssert(t>e,"Short delay should be less than long delay!"),this.isMobile=isMobileCordova()||isReactNative()}get(){return _isOnline()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function _emulatorUrl(i,e){debugAssert(i.emulator,"Emulator should always be set here");const{url:t}=i.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class FetchProvider{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;debugFail("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;debugFail("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;debugFail("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const SERVER_ERROR_MAP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const CookieAuthProxiedEndpoints=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],DEFAULT_API_TIMEOUT_MS=new Delay(3e4,6e4);function _addTidIfNecessary(i,e){return i.tenantId&&!e.tenantId?{...e,tenantId:i.tenantId}:e}async function _performApiRequest(i,e,t,n,r={}){return _performFetchWithErrorHandling(i,r,async()=>{let s={},a={};n&&(e==="GET"?a=n:s={body:JSON.stringify(n)});const l=querystring({key:i.config.apiKey,...a}).slice(1),u=await i._getAdditionalHeaders();u["Content-Type"]="application/json",i.languageCode&&(u["X-Firebase-Locale"]=i.languageCode);const d={method:e,headers:u,...s};return isCloudflareWorker()||(d.referrerPolicy="no-referrer"),i.emulatorConfig&&isCloudWorkstation(i.emulatorConfig.host)&&(d.credentials="include"),FetchProvider.fetch()(await _getFinalTarget(i,i.config.apiHost,t,l),d)})}async function _performFetchWithErrorHandling(i,e,t){i._canInitEmulator=!1;const n={...SERVER_ERROR_MAP,...e};try{const r=new NetworkTimeout(i),s=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const a=await s.json();if("needConfirmation"in a)throw _makeTaggedError(i,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{const l=s.ok?a.errorMessage:a.error.message,[u,d]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw _makeTaggedError(i,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw _makeTaggedError(i,"email-already-in-use",a);if(u==="USER_DISABLED")throw _makeTaggedError(i,"user-disabled",a);const h=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw _errorWithCustomMessage(i,h,d);_fail(i,h)}}catch(r){if(r instanceof FirebaseError)throw r;_fail(i,"network-request-failed",{message:String(r)})}}async function _performSignInRequest(i,e,t,n,r={}){const s=await _performApiRequest(i,e,t,n,r);return"mfaPendingCredential"in s&&_fail(i,"multi-factor-auth-required",{_serverResponse:s}),s}async function _getFinalTarget(i,e,t,n){const r=`${e}${t}?${n}`,s=i,a=s.config.emulator?_emulatorUrl(i.config,r):`${i.config.apiScheme}://${r}`;return CookieAuthProxiedEndpoints.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a}function _parseEnforcementState(i){switch(i){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class NetworkTimeout{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(_createError(this.auth,"network-request-failed")),DEFAULT_API_TIMEOUT_MS.get())})}}function _makeTaggedError(i,e,t){const n={appName:i.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const r=_createError(i,e,n);return r.customData._tokenResponse=t,r}function isEnterprise(i){return i!==void 0&&i.enterprise!==void 0}class RecaptchaConfig{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return _parseEnforcementState(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function getRecaptchaConfig(i,e){return _performApiRequest(i,"GET","/v2/recaptchaConfig",_addTidIfNecessary(i,e))}async function deleteAccount(i,e){return _performApiRequest(i,"POST","/v1/accounts:delete",e)}async function getAccountInfo(i,e){return _performApiRequest(i,"POST","/v1/accounts:lookup",e)}function utcTimestampToDateString(i){if(i)try{const e=new Date(Number(i));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function getIdTokenResult(i,e=!1){const t=getModularInstance(i),n=await t.getIdToken(e),r=_parseToken(n);_assert(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const s=typeof r.firebase=="object"?r.firebase:void 0,a=s?.sign_in_provider;return{claims:r,token:n,authTime:utcTimestampToDateString(secondsStringToMilliseconds(r.auth_time)),issuedAtTime:utcTimestampToDateString(secondsStringToMilliseconds(r.iat)),expirationTime:utcTimestampToDateString(secondsStringToMilliseconds(r.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}}function secondsStringToMilliseconds(i){return Number(i)*1e3}function _parseToken(i){const[e,t,n]=i.split(".");if(e===void 0||t===void 0||n===void 0)return _logError("JWT malformed, contained fewer than 3 sections"),null;try{const r=base64Decode(t);return r?JSON.parse(r):(_logError("Failed to decode base64 JWT payload"),null)}catch(r){return _logError("Caught error parsing JWT payload as JSON",r?.toString()),null}}function _tokenExpiresIn(i){const e=_parseToken(i);return _assert(e,"internal-error"),_assert(typeof e.exp<"u","internal-error"),_assert(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function _logoutIfInvalidated(i,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof FirebaseError&&isUserInvalidated(n)&&i.auth.currentUser===i&&await i.auth.signOut(),n}}function isUserInvalidated({code:i}){return i==="auth/user-disabled"||i==="auth/user-token-expired"}class ProactiveRefresh{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class UserMetadata{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=utcTimestampToDateString(this.lastLoginAt),this.creationTime=utcTimestampToDateString(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function _reloadWithoutSaving(i){const e=i.auth,t=await i.getIdToken(),n=await _logoutIfInvalidated(i,getAccountInfo(e,{idToken:t}));_assert(n?.users.length,e,"internal-error");const r=n.users[0];i._notifyReloadListener(r);const s=r.providerUserInfo?.length?extractProviderData(r.providerUserInfo):[],a=mergeProviderData(i.providerData,s),l=i.isAnonymous,u=!(i.email&&r.passwordHash)&&!a?.length,d=l?u:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new UserMetadata(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(i,h)}async function reload(i){const e=getModularInstance(i);await _reloadWithoutSaving(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function mergeProviderData(i,e){return[...i.filter(n=>!e.some(r=>r.providerId===n.providerId)),...e]}function extractProviderData(i){return i.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function requestStsToken(i,e){const t=await _performFetchWithErrorHandling(i,{},async()=>{const n=querystring({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=i.config,a=await _getFinalTarget(i,r,"/v1/token",`key=${s}`),l=await i._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:l,body:n};return i.emulatorConfig&&isCloudWorkstation(i.emulatorConfig.host)&&(u.credentials="include"),FetchProvider.fetch()(a,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function revokeToken(i,e){return _performApiRequest(i,"POST","/v2/accounts:revokeToken",_addTidIfNecessary(i,e))}class StsTokenManager{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_assert(e.idToken,"internal-error"),_assert(typeof e.idToken<"u","internal-error"),_assert(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):_tokenExpiresIn(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){_assert(e.length!==0,"internal-error");const t=_tokenExpiresIn(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(_assert(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await requestStsToken(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:s}=t,a=new StsTokenManager;return n&&(_assert(typeof n=="string","internal-error",{appName:e}),a.refreshToken=n),r&&(_assert(typeof r=="string","internal-error",{appName:e}),a.accessToken=r),s&&(_assert(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new StsTokenManager,this.toJSON())}_performRefresh(){return debugFail("not implemented")}}function assertStringOrUndefined(i,e){_assert(typeof i=="string"||typeof i>"u","internal-error",{appName:e})}class UserImpl{constructor({uid:e,auth:t,stsTokenManager:n,...r}){this.providerId="firebase",this.proactiveRefresh=new ProactiveRefresh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new UserMetadata(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await _logoutIfInvalidated(this,this.stsTokenManager.getToken(this.auth,e));return _assert(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return getIdTokenResult(this,e)}reload(){return reload(this)}_assign(e){this!==e&&(_assert(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new UserImpl({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){_assert(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await _reloadWithoutSaving(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(_isFirebaseServerApp(this.auth.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this.auth));const e=await this.getIdToken();return await _logoutIfInvalidated(this,deleteAccount(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,r=t.email??void 0,s=t.phoneNumber??void 0,a=t.photoURL??void 0,l=t.tenantId??void 0,u=t._redirectEventId??void 0,d=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:p,emailVerified:m,isAnonymous:g,providerData:v,stsTokenManager:_}=t;_assert(p&&_,e,"internal-error");const b=StsTokenManager.fromJSON(this.name,_);_assert(typeof p=="string",e,"internal-error"),assertStringOrUndefined(n,e.name),assertStringOrUndefined(r,e.name),_assert(typeof m=="boolean",e,"internal-error"),_assert(typeof g=="boolean",e,"internal-error"),assertStringOrUndefined(s,e.name),assertStringOrUndefined(a,e.name),assertStringOrUndefined(l,e.name),assertStringOrUndefined(u,e.name),assertStringOrUndefined(d,e.name),assertStringOrUndefined(h,e.name);const E=new UserImpl({uid:p,auth:e,email:r,emailVerified:m,displayName:n,isAnonymous:g,photoURL:a,phoneNumber:s,tenantId:l,stsTokenManager:b,createdAt:d,lastLoginAt:h});return v&&Array.isArray(v)&&(E.providerData=v.map(A=>({...A}))),u&&(E._redirectEventId=u),E}static async _fromIdTokenResponse(e,t,n=!1){const r=new StsTokenManager;r.updateFromServerResponse(t);const s=new UserImpl({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await _reloadWithoutSaving(s),s}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];_assert(r.localId!==void 0,"internal-error");const s=r.providerUserInfo!==void 0?extractProviderData(r.providerUserInfo):[],a=!(r.email&&r.passwordHash)&&!s?.length,l=new StsTokenManager;l.updateFromIdToken(n);const u=new UserImpl({uid:r.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new UserMetadata(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!s?.length};return Object.assign(u,d),u}}const instanceCache=new Map;function _getInstance(i){debugAssert(i instanceof Function,"Expected a class definition");let e=instanceCache.get(i);return e?(debugAssert(e instanceof i,"Instance stored in cache mismatched with class"),e):(e=new i,instanceCache.set(i,e),e)}class InMemoryPersistence{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}InMemoryPersistence.type="NONE";const inMemoryPersistence=InMemoryPersistence;function _persistenceKeyName(i,e,t){return`firebase:${i}:${e}:${t}`}class PersistenceUserManager{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:s}=this.auth;this.fullUserKey=_persistenceKeyName(this.userKey,r.apiKey,s),this.fullPersistenceKey=_persistenceKeyName("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await getAccountInfo(this.auth,{idToken:e}).catch(()=>{});return t?UserImpl._fromGetAccountInfoResponse(this.auth,t,e):null}return UserImpl._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new PersistenceUserManager(_getInstance(inMemoryPersistence),e,n);const r=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let s=r[0]||_getInstance(inMemoryPersistence);const a=_persistenceKeyName(n,e.config.apiKey,e.name);let l=null;for(const d of t)try{const h=await d._get(a);if(h){let p;if(typeof h=="string"){const m=await getAccountInfo(e,{idToken:h}).catch(()=>{});if(!m)break;p=await UserImpl._fromGetAccountInfoResponse(e,m,h)}else p=UserImpl._fromJSON(e,h);d!==s&&(l=p),s=d;break}}catch{}const u=r.filter(d=>d._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new PersistenceUserManager(s,e,n):(s=u[0],l&&await s._set(a,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==s)try{await d._remove(a)}catch{}})),new PersistenceUserManager(s,e,n))}}function _getBrowserName(i){const e=i.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(_isIEMobile(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(_isFirefox(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(_isBlackBerry(e))return"Blackberry";if(_isWebOS(e))return"Webos";if(_isSafari(e))return"Safari";if((e.includes("chrome/")||_isChromeIOS(e))&&!e.includes("edge/"))return"Chrome";if(_isAndroid(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=i.match(t);if(n?.length===2)return n[1]}return"Other"}function _isFirefox(i=getUA()){return/firefox\//i.test(i)}function _isSafari(i=getUA()){const e=i.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function _isChromeIOS(i=getUA()){return/crios\//i.test(i)}function _isIEMobile(i=getUA()){return/iemobile/i.test(i)}function _isAndroid(i=getUA()){return/android/i.test(i)}function _isBlackBerry(i=getUA()){return/blackberry/i.test(i)}function _isWebOS(i=getUA()){return/webos/i.test(i)}function _isIOS(i=getUA()){return/iphone|ipad|ipod/i.test(i)||/macintosh/i.test(i)&&/mobile/i.test(i)}function _isIOSStandalone(i=getUA()){return _isIOS(i)&&!!window.navigator?.standalone}function _isIE10(){return isIE()&&document.documentMode===10}function _isMobileBrowser(i=getUA()){return _isIOS(i)||_isAndroid(i)||_isWebOS(i)||_isBlackBerry(i)||/windows phone/i.test(i)||_isIEMobile(i)}function _getClientVersion(i,e=[]){let t;switch(i){case"Browser":t=_getBrowserName(getUA());break;case"Worker":t=`${_getBrowserName(getUA())}-${i}`;break;default:t=i}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${SDK_VERSION}/${n}`}class AuthMiddlewareQueue{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=s=>new Promise((a,l)=>{try{const u=e(s);a(u)}catch(u){l(u)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}async function _getPasswordPolicy(i,e={}){return _performApiRequest(i,"GET","/v2/passwordPolicy",_addTidIfNecessary(i,e))}const MINIMUM_MIN_PASSWORD_LENGTH=6;class PasswordPolicyImpl{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??MINIMUM_MIN_PASSWORD_LENGTH,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class AuthImpl{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Subscription(this),this.idTokenSubscription=new Subscription(this),this.beforeStateQueue=new AuthMiddlewareQueue(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_DEFAULT_AUTH_ERROR_FACTORY,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=_getInstance(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await PersistenceUserManager.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await getAccountInfo(this,{idToken:e}),n=await UserImpl._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(_isFirebaseServerApp(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=this.redirectUser?._redirectEventId,a=n?._redirectEventId,l=await this.tryRedirectSignIn(e);(!s||s===a)&&l?.user&&(n=l.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(s){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return _assert(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await _reloadWithoutSaving(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=_getUserLanguage()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(_isFirebaseServerApp(this.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this));const t=e?getModularInstance(e):null;return t&&_assert(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&_assert(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return _isFirebaseServerApp(this.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return _isFirebaseServerApp(this.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(_getInstance(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await _getPasswordPolicy(this),t=new PasswordPolicyImpl(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ErrorFactory("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await revokeToken(this,n)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&_getInstance(e)||this._popupRedirectResolver;_assert(t,this,"argument-error"),this.redirectPersistenceManager=await PersistenceUserManager.create(this,[_getInstance(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(_assert(l,this,"internal-error"),l.then(()=>{a||s(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,n,r);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _assert(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=_getClientVersion(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(_isFirebaseServerApp(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&_logWarn(`Error while retrieving App Check token: ${e.error}`),e?.token}}function _castAuth(i){return getModularInstance(i)}class Subscription{constructor(e){this.auth=e,this.observer=null,this.addObserver=createSubscribe(t=>this.observer=t)}get next(){return _assert(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let externalJSProvider={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _setExternalJSProvider(i){externalJSProvider=i}function _loadJS(i){return externalJSProvider.loadJS(i)}function _recaptchaEnterpriseScriptUrl(){return externalJSProvider.recaptchaEnterpriseScript}function _gapiScriptUrl(){return externalJSProvider.gapiScript}function _generateCallbackName(i){return`__${i}${Math.floor(Math.random()*1e6)}`}class MockGreCAPTCHATopLevel{constructor(){this.enterprise=new MockGreCAPTCHA}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class MockGreCAPTCHA{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const RECAPTCHA_ENTERPRISE_VERIFIER_TYPE="recaptcha-enterprise",FAKE_TOKEN="NO_RECAPTCHA";class RecaptchaEnterpriseVerifier{constructor(e){this.type=RECAPTCHA_ENTERPRISE_VERIFIER_TYPE,this.auth=_castAuth(e)}async verify(e="verify",t=!1){async function n(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(a,l)=>{getRecaptchaConfig(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new RecaptchaConfig(u);return s.tenantId==null?s._agentRecaptchaConfig=d:s._tenantRecaptchaConfigs[s.tenantId]=d,a(d.siteKey)}}).catch(u=>{l(u)})})}function r(s,a,l){const u=window.grecaptcha;isEnterprise(u)?u.enterprise.ready(()=>{u.enterprise.execute(s,{action:e}).then(d=>{a(d)}).catch(()=>{a(FAKE_TOKEN)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new MockGreCAPTCHATopLevel().execute("siteKey",{action:"verify"}):new Promise((s,a)=>{n(this.auth).then(l=>{if(!t&&isEnterprise(window.grecaptcha))r(l,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=_recaptchaEnterpriseScriptUrl();u.length!==0&&(u+=l),_loadJS(u).then(()=>{r(l,s,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function injectRecaptchaFields(i,e,t,n=!1,r=!1){const s=new RecaptchaEnterpriseVerifier(i);let a;if(r)a=FAKE_TOKEN;else try{a=await s.verify(t)}catch{a=await s.verify(t,!0)}const l={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const u=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const u=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return n?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function handleRecaptchaFlow(i,e,t,n,r){if(i._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await injectRecaptchaFields(i,e,t,t==="getOobCode");return n(i,s)}else return n(i,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await injectRecaptchaFields(i,e,t,t==="getOobCode");return n(i,a)}else return Promise.reject(s)})}function initializeAuth(i,e){const t=_getProvider(i,"auth");if(t.isInitialized()){const r=t.getImmediate(),s=t.getOptions();if(deepEqual(s,e??{}))return r;_fail(r,"already-initialized")}return t.initialize({options:e})}function _initializeAuthInstance(i,e){const t=e?.persistence||[],n=(Array.isArray(t)?t:[t]).map(_getInstance);e?.errorMap&&i._updateErrorMap(e.errorMap),i._initializeWithPersistence(n,e?.popupRedirectResolver)}function connectAuthEmulator(i,e,t){const n=_castAuth(i);_assert(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const r=!1,s=extractProtocol(e),{host:a,port:l}=extractHostAndPort(e),u=l===null?"":`:${l}`,d={url:`${s}//${a}${u}/`},h=Object.freeze({host:a,port:l,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!n._canInitEmulator){_assert(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),_assert(deepEqual(d,n.config.emulator)&&deepEqual(h,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=d,n.emulatorConfig=h,n.settings.appVerificationDisabledForTesting=!0,isCloudWorkstation(a)?(pingServer(`${s}//${a}${u}`),updateEmulatorBanner("Auth",!0)):emitEmulatorWarning()}function extractProtocol(i){const e=i.indexOf(":");return e<0?"":i.substr(0,e+1)}function extractHostAndPort(i){const e=extractProtocol(i),t=/(\/\/)?([^?#/]+)/.exec(i.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(n);if(r){const s=r[1];return{host:s,port:parsePort(n.substr(s.length+1))}}else{const[s,a]=n.split(":");return{host:s,port:parsePort(a)}}}function parsePort(i){if(!i)return null;const e=Number(i);return isNaN(e)?null:e}function emitEmulatorWarning(){function i(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",i):i())}class AuthCredential{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return debugFail("not implemented")}_getIdTokenResponse(e){return debugFail("not implemented")}_linkToIdToken(e,t){return debugFail("not implemented")}_getReauthenticationResolver(e){return debugFail("not implemented")}}async function linkEmailPassword(i,e){return _performApiRequest(i,"POST","/v1/accounts:signUp",e)}async function signInWithPassword(i,e){return _performSignInRequest(i,"POST","/v1/accounts:signInWithPassword",_addTidIfNecessary(i,e))}async function signInWithEmailLink$1(i,e){return _performSignInRequest(i,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(i,e))}async function signInWithEmailLinkForLinking(i,e){return _performSignInRequest(i,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(i,e))}class EmailAuthCredential extends AuthCredential{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new EmailAuthCredential(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new EmailAuthCredential(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return handleRecaptchaFlow(e,t,"signInWithPassword",signInWithPassword);case"emailLink":return signInWithEmailLink$1(e,{email:this._email,oobCode:this._password});default:_fail(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const n={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return handleRecaptchaFlow(e,n,"signUpPassword",linkEmailPassword);case"emailLink":return signInWithEmailLinkForLinking(e,{idToken:t,email:this._email,oobCode:this._password});default:_fail(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function signInWithIdp(i,e){return _performSignInRequest(i,"POST","/v1/accounts:signInWithIdp",_addTidIfNecessary(i,e))}const IDP_REQUEST_URI$1="http://localhost";class OAuthCredential extends AuthCredential{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new OAuthCredential(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):_fail("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:r,...s}=t;if(!n||!r)return null;const a=new OAuthCredential(n,r);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return signInWithIdp(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,signInWithIdp(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,signInWithIdp(e,t)}buildRequest(){const e={requestUri:IDP_REQUEST_URI$1,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=querystring(t)}return e}}function parseMode(i){switch(i){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function parseDeepLink(i){const e=querystringDecode(extractQuerystring(i)).link,t=e?querystringDecode(extractQuerystring(e)).deep_link_id:null,n=querystringDecode(extractQuerystring(i)).deep_link_id;return(n?querystringDecode(extractQuerystring(n)).link:null)||n||t||e||i}class ActionCodeURL{constructor(e){const t=querystringDecode(extractQuerystring(e)),n=t.apiKey??null,r=t.oobCode??null,s=parseMode(t.mode??null);_assert(n&&r&&s,"argument-error"),this.apiKey=n,this.operation=s,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=parseDeepLink(e);try{return new ActionCodeURL(t)}catch{return null}}}class EmailAuthProvider{constructor(){this.providerId=EmailAuthProvider.PROVIDER_ID}static credential(e,t){return EmailAuthCredential._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=ActionCodeURL.parseLink(t);return _assert(n,"argument-error"),EmailAuthCredential._fromEmailAndCode(e,n.code,n.tenantId)}}EmailAuthProvider.PROVIDER_ID="password";EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD="password";EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class FederatedAuthProvider{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class BaseOAuthProvider extends FederatedAuthProvider{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class FacebookAuthProvider extends BaseOAuthProvider{constructor(){super("facebook.com")}static credential(e){return OAuthCredential._fromParams({providerId:FacebookAuthProvider.PROVIDER_ID,signInMethod:FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return FacebookAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return FacebookAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return FacebookAuthProvider.credential(e.oauthAccessToken)}catch{return null}}}FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD="facebook.com";FacebookAuthProvider.PROVIDER_ID="facebook.com";class GoogleAuthProvider extends BaseOAuthProvider{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return OAuthCredential._fromParams({providerId:GoogleAuthProvider.PROVIDER_ID,signInMethod:GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return GoogleAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return GoogleAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return GoogleAuthProvider.credential(t,n)}catch{return null}}}GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD="google.com";GoogleAuthProvider.PROVIDER_ID="google.com";class GithubAuthProvider extends BaseOAuthProvider{constructor(){super("github.com")}static credential(e){return OAuthCredential._fromParams({providerId:GithubAuthProvider.PROVIDER_ID,signInMethod:GithubAuthProvider.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return GithubAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return GithubAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return GithubAuthProvider.credential(e.oauthAccessToken)}catch{return null}}}GithubAuthProvider.GITHUB_SIGN_IN_METHOD="github.com";GithubAuthProvider.PROVIDER_ID="github.com";class TwitterAuthProvider extends BaseOAuthProvider{constructor(){super("twitter.com")}static credential(e,t){return OAuthCredential._fromParams({providerId:TwitterAuthProvider.PROVIDER_ID,signInMethod:TwitterAuthProvider.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return TwitterAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return TwitterAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return TwitterAuthProvider.credential(t,n)}catch{return null}}}TwitterAuthProvider.TWITTER_SIGN_IN_METHOD="twitter.com";TwitterAuthProvider.PROVIDER_ID="twitter.com";async function signUp(i,e){return _performSignInRequest(i,"POST","/v1/accounts:signUp",_addTidIfNecessary(i,e))}class UserCredentialImpl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const s=await UserImpl._fromIdTokenResponse(e,n,r),a=providerIdForResponse(n);return new UserCredentialImpl({user:s,providerId:a,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=providerIdForResponse(n);return new UserCredentialImpl({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function providerIdForResponse(i){return i.providerId?i.providerId:"phoneNumber"in i?"phone":null}class MultiFactorError extends FirebaseError{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,MultiFactorError.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new MultiFactorError(e,t,n,r)}}function _processCredentialSavingMfaContextIfNecessary(i,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(i):t._getIdTokenResponse(i)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?MultiFactorError._fromErrorAndOperation(i,s,e,n):s})}async function _link$1(i,e,t=!1){const n=await _logoutIfInvalidated(i,e._linkToIdToken(i.auth,await i.getIdToken()),t);return UserCredentialImpl._forOperation(i,"link",n)}async function _reauthenticate(i,e,t=!1){const{auth:n}=i;if(_isFirebaseServerApp(n.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(n));const r="reauthenticate";try{const s=await _logoutIfInvalidated(i,_processCredentialSavingMfaContextIfNecessary(n,r,e,i),t);_assert(s.idToken,n,"internal-error");const a=_parseToken(s.idToken);_assert(a,n,"internal-error");const{sub:l}=a;return _assert(i.uid===l,n,"user-mismatch"),UserCredentialImpl._forOperation(i,r,s)}catch(s){throw s?.code==="auth/user-not-found"&&_fail(n,"user-mismatch"),s}}async function _signInWithCredential(i,e,t=!1){if(_isFirebaseServerApp(i.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(i));const n="signIn",r=await _processCredentialSavingMfaContextIfNecessary(i,n,e),s=await UserCredentialImpl._fromIdTokenResponse(i,n,r);return t||await i._updateCurrentUser(s.user),s}async function signInWithCredential(i,e){return _signInWithCredential(_castAuth(i),e)}async function recachePasswordPolicy(i){const e=_castAuth(i);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function createUserWithEmailAndPassword(i,e,t){if(_isFirebaseServerApp(i.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(i));const n=_castAuth(i),a=await handleRecaptchaFlow(n,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",signUp).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&recachePasswordPolicy(i),u}),l=await UserCredentialImpl._fromIdTokenResponse(n,"signIn",a);return await n._updateCurrentUser(l.user),l}function signInWithEmailAndPassword(i,e,t){return _isFirebaseServerApp(i.app)?Promise.reject(_serverAppCurrentUserOperationNotSupportedError(i)):signInWithCredential(getModularInstance(i),EmailAuthProvider.credential(e,t)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&recachePasswordPolicy(i),n})}async function updateProfile$1(i,e){return _performApiRequest(i,"POST","/v1/accounts:update",e)}async function updateProfile(i,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const n=getModularInstance(i),s={idToken:await n.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},a=await _logoutIfInvalidated(n,updateProfile$1(n.auth,s));n.displayName=a.displayName||null,n.photoURL=a.photoUrl||null;const l=n.providerData.find(({providerId:u})=>u==="password");l&&(l.displayName=n.displayName,l.photoURL=n.photoURL),await n._updateTokensIfNecessary(a)}function onIdTokenChanged(i,e,t,n){return getModularInstance(i).onIdTokenChanged(e,t,n)}function beforeAuthStateChanged(i,e,t){return getModularInstance(i).beforeAuthStateChanged(e,t)}function onAuthStateChanged(i,e,t,n){return getModularInstance(i).onAuthStateChanged(e,t,n)}function signOut(i){return getModularInstance(i).signOut()}const STORAGE_AVAILABLE_KEY="__sak";class BrowserPersistenceClass{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(STORAGE_AVAILABLE_KEY,"1"),this.storage.removeItem(STORAGE_AVAILABLE_KEY),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const _POLLING_INTERVAL_MS$1=1e3,IE10_LOCAL_STORAGE_SYNC_DELAY=10;class BrowserLocalPersistence extends BrowserPersistenceClass{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_isMobileBrowser(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const a=this.storage.getItem(n);!t&&this.localCache[n]===a||this.notifyListeners(n,a)},s=this.storage.getItem(n);_isIE10()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,IE10_LOCAL_STORAGE_SYNC_DELAY):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},_POLLING_INTERVAL_MS$1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}BrowserLocalPersistence.type="LOCAL";const browserLocalPersistence=BrowserLocalPersistence;class BrowserSessionPersistence extends BrowserPersistenceClass{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}BrowserSessionPersistence.type="SESSION";const browserSessionPersistence=BrowserSessionPersistence;function _allSettled(i){return Promise.all(i.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class Receiver{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const n=new Receiver(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:s}=t.data,a=this.handlersMap[r];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const l=Array.from(a).map(async d=>d(t.origin,s)),u=await _allSettled(l);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Receiver.receivers=[];function _generateEventId(i="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return i+t}class Sender{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,a;return new Promise((l,u)=>{const d=_generateEventId("",20);r.port1.start();const h=setTimeout(()=>{u(new Error("unsupported_event"))},n);a={messageChannel:r,onMessage(p){const m=p;if(m.data.eventId===d)switch(m.data.status){case"ack":clearTimeout(h),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),l(m.data.response);break;default:clearTimeout(h),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(a),r.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[r.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function _window(){return window}function _setWindowLocation(i){_window().location.href=i}function _isWorker(){return typeof _window().WorkerGlobalScope<"u"&&typeof _window().importScripts=="function"}async function _getActiveServiceWorker(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function _getServiceWorkerController(){return navigator?.serviceWorker?.controller||null}function _getWorkerGlobalScope(){return _isWorker()?self:null}const DB_NAME="firebaseLocalStorageDb",DB_VERSION=1,DB_OBJECTSTORE_NAME="firebaseLocalStorage",DB_DATA_KEYPATH="fbase_key";class DBPromise{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function getObjectStore(i,e){return i.transaction([DB_OBJECTSTORE_NAME],e?"readwrite":"readonly").objectStore(DB_OBJECTSTORE_NAME)}function _deleteDatabase(){const i=indexedDB.deleteDatabase(DB_NAME);return new DBPromise(i).toPromise()}function _openDatabase(){const i=indexedDB.open(DB_NAME,DB_VERSION);return new Promise((e,t)=>{i.addEventListener("error",()=>{t(i.error)}),i.addEventListener("upgradeneeded",()=>{const n=i.result;try{n.createObjectStore(DB_OBJECTSTORE_NAME,{keyPath:DB_DATA_KEYPATH})}catch(r){t(r)}}),i.addEventListener("success",async()=>{const n=i.result;n.objectStoreNames.contains(DB_OBJECTSTORE_NAME)?e(n):(n.close(),await _deleteDatabase(),e(await _openDatabase()))})})}async function _putObject(i,e,t){const n=getObjectStore(i,!0).put({[DB_DATA_KEYPATH]:e,value:t});return new DBPromise(n).toPromise()}async function getObject(i,e){const t=getObjectStore(i,!1).get(e),n=await new DBPromise(t).toPromise();return n===void 0?null:n.value}function _deleteObject(i,e){const t=getObjectStore(i,!0).delete(e);return new DBPromise(t).toPromise()}const _POLLING_INTERVAL_MS=800,_TRANSACTION_RETRY_COUNT=3;class IndexedDBLocalPersistence{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await _openDatabase(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>_TRANSACTION_RETRY_COUNT)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _isWorker()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Receiver._getInstance(_getWorkerGlobalScope()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await _getActiveServiceWorker(),!this.activeServiceWorker)return;this.sender=new Sender(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||_getServiceWorkerController()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await _openDatabase();return await _putObject(e,STORAGE_AVAILABLE_KEY,"1"),await _deleteObject(e,STORAGE_AVAILABLE_KEY),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>_putObject(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>getObject(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>_deleteObject(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const s=getObjectStore(r,!1).getAll();return new DBPromise(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:r,value:s}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_POLLING_INTERVAL_MS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}IndexedDBLocalPersistence.type="LOCAL";const indexedDBLocalPersistence=IndexedDBLocalPersistence;new Delay(3e4,6e4);function _withDefaultResolver(i,e){return e?_getInstance(e):(_assert(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver)}class IdpCredential extends AuthCredential{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return signInWithIdp(e,this._buildIdpRequest())}_linkToIdToken(e,t){return signInWithIdp(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return signInWithIdp(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function _signIn(i){return _signInWithCredential(i.auth,new IdpCredential(i),i.bypassAuthState)}function _reauth(i){const{auth:e,user:t}=i;return _assert(t,e,"internal-error"),_reauthenticate(t,new IdpCredential(i),i.bypassAuthState)}async function _link(i){const{auth:e,user:t}=i;return _assert(t,e,"internal-error"),_link$1(t,new IdpCredential(i),i.bypassAuthState)}class AbstractPopupRedirectOperation{constructor(e,t,n,r,s=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:s,error:a,type:l}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return _signIn;case"linkViaPopup":case"linkViaRedirect":return _link;case"reauthViaPopup":case"reauthViaRedirect":return _reauth;default:_fail(this.auth,"internal-error")}}resolve(e){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const _POLL_WINDOW_CLOSE_TIMEOUT=new Delay(2e3,1e4);class PopupOperation extends AbstractPopupRedirectOperation{constructor(e,t,n,r,s){super(e,t,r,s),this.provider=n,this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction&&PopupOperation.currentPopupAction.cancel(),PopupOperation.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _assert(e,this.auth,"internal-error"),e}async onExecution(){debugAssert(this.filter.length===1,"Popup operations only handle one event");const e=_generateEventId();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(_createError(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(_createError(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_createError(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,_POLL_WINDOW_CLOSE_TIMEOUT.get())};e()}}PopupOperation.currentPopupAction=null;const PENDING_REDIRECT_KEY="pendingRedirect",redirectOutcomeMap=new Map;class RedirectAction extends AbstractPopupRedirectOperation{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=redirectOutcomeMap.get(this.auth._key());if(!e){try{const n=await _getAndClearPendingRedirectStatus(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}redirectOutcomeMap.set(this.auth._key(),e)}return this.bypassAuthState||redirectOutcomeMap.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _getAndClearPendingRedirectStatus(i,e){const t=pendingRedirectKey(e),n=resolverPersistence(i);if(!await n._isAvailable())return!1;const r=await n._get(t)==="true";return await n._remove(t),r}function _overrideRedirectResult(i,e){redirectOutcomeMap.set(i._key(),e)}function resolverPersistence(i){return _getInstance(i._redirectPersistence)}function pendingRedirectKey(i){return _persistenceKeyName(PENDING_REDIRECT_KEY,i.config.apiKey,i.name)}async function _getRedirectResult(i,e,t=!1){if(_isFirebaseServerApp(i.app))return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(i));const n=_castAuth(i),r=_withDefaultResolver(n,e),a=await new RedirectAction(n,r,t).execute();return a&&!t&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,e)),a}const EVENT_DUPLICATION_CACHE_DURATION_MS=600*1e3;class AuthEventManager{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!isRedirectEvent(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!isNullRedirectEvent(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(_createError(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=EVENT_DUPLICATION_CACHE_DURATION_MS&&this.cachedEventUids.clear(),this.cachedEventUids.has(eventUid(e))}saveEventToCache(e){this.cachedEventUids.add(eventUid(e)),this.lastProcessedEventTime=Date.now()}}function eventUid(i){return[i.type,i.eventId,i.sessionId,i.tenantId].filter(e=>e).join("-")}function isNullRedirectEvent({type:i,error:e}){return i==="unknown"&&e?.code==="auth/no-auth-event"}function isRedirectEvent(i){switch(i.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return isNullRedirectEvent(i);default:return!1}}async function _getProjectConfig(i,e={}){return _performApiRequest(i,"GET","/v1/projects",e)}const IP_ADDRESS_REGEX=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,HTTP_REGEX=/^https?/;async function _validateOrigin(i){if(i.config.emulator)return;const{authorizedDomains:e}=await _getProjectConfig(i);for(const t of e)try{if(matchDomain(t))return}catch{}_fail(i,"unauthorized-domain")}function matchDomain(i){const e=_getCurrentUrl(),{protocol:t,hostname:n}=new URL(e);if(i.startsWith("chrome-extension://")){const a=new URL(i);return a.hostname===""&&n===""?t==="chrome-extension:"&&i.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===n}if(!HTTP_REGEX.test(t))return!1;if(IP_ADDRESS_REGEX.test(i))return n===i;const r=i.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(n)}const NETWORK_TIMEOUT=new Delay(3e4,6e4);function resetUnloadedGapiModules(){const i=_window().___jsl;if(i?.H){for(const e of Object.keys(i.H))if(i.H[e].r=i.H[e].r||[],i.H[e].L=i.H[e].L||[],i.H[e].r=[...i.H[e].L],i.CP)for(let t=0;t<i.CP.length;t++)i.CP[t]=null}}function loadGapi(i){return new Promise((e,t)=>{function n(){resetUnloadedGapiModules(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{resetUnloadedGapiModules(),t(_createError(i,"network-request-failed"))},timeout:NETWORK_TIMEOUT.get()})}if(_window().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(_window().gapi?.load)n();else{const r=_generateCallbackName("iframefcb");return _window()[r]=()=>{gapi.load?n():t(_createError(i,"network-request-failed"))},_loadJS(`${_gapiScriptUrl()}?onload=${r}`).catch(s=>t(s))}}).catch(e=>{throw cachedGApiLoader=null,e})}let cachedGApiLoader=null;function _loadGapi(i){return cachedGApiLoader=cachedGApiLoader||loadGapi(i),cachedGApiLoader}const PING_TIMEOUT=new Delay(5e3,15e3),IFRAME_PATH="__/auth/iframe",EMULATED_IFRAME_PATH="emulator/auth/iframe",IFRAME_ATTRIBUTES={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},EID_FROM_APIHOST=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function getIframeUrl(i){const e=i.config;_assert(e.authDomain,i,"auth-domain-config-required");const t=e.emulator?_emulatorUrl(e,EMULATED_IFRAME_PATH):`https://${i.config.authDomain}/${IFRAME_PATH}`,n={apiKey:e.apiKey,appName:i.name,v:SDK_VERSION},r=EID_FROM_APIHOST.get(i.config.apiHost);r&&(n.eid=r);const s=i._getFrameworks();return s.length&&(n.fw=s.join(",")),`${t}?${querystring(n).slice(1)}`}async function _openIframe(i){const e=await _loadGapi(i),t=_window().gapi;return _assert(t,i,"internal-error"),e.open({where:document.body,url:getIframeUrl(i),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:IFRAME_ATTRIBUTES,dontclear:!0},n=>new Promise(async(r,s)=>{await n.restyle({setHideOnLeave:!1});const a=_createError(i,"network-request-failed"),l=_window().setTimeout(()=>{s(a)},PING_TIMEOUT.get());function u(){_window().clearTimeout(l),r(n)}n.ping(u).then(u,()=>{s(a)})}))}const BASE_POPUP_OPTIONS={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},DEFAULT_WIDTH=500,DEFAULT_HEIGHT=600,TARGET_BLANK="_blank",FIREFOX_EMPTY_URL="http://localhost";class AuthPopup{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function _open(i,e,t,n=DEFAULT_WIDTH,r=DEFAULT_HEIGHT){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let l="";const u={...BASE_POPUP_OPTIONS,width:n.toString(),height:r.toString(),top:s,left:a},d=getUA().toLowerCase();t&&(l=_isChromeIOS(d)?TARGET_BLANK:t),_isFirefox(d)&&(e=e||FIREFOX_EMPTY_URL,u.scrollbars="yes");const h=Object.entries(u).reduce((m,[g,v])=>`${m}${g}=${v},`,"");if(_isIOSStandalone(d)&&l!=="_self")return openAsNewWindowIOS(e||"",l),new AuthPopup(null);const p=window.open(e||"",l,h);_assert(p,i,"popup-blocked");try{p.focus()}catch{}return new AuthPopup(p)}function openAsNewWindowIOS(i,e){const t=document.createElement("a");t.href=i,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}const WIDGET_PATH="__/auth/handler",EMULATOR_WIDGET_PATH="emulator/auth/handler",FIREBASE_APP_CHECK_FRAGMENT_ID=encodeURIComponent("fac");async function _getRedirectUrl(i,e,t,n,r,s){_assert(i.config.authDomain,i,"auth-domain-config-required"),_assert(i.config.apiKey,i,"invalid-api-key");const a={apiKey:i.config.apiKey,appName:i.name,authType:t,redirectUrl:n,v:SDK_VERSION,eventId:r};if(e instanceof FederatedAuthProvider){e.setDefaultLanguage(i.languageCode),a.providerId=e.providerId||"",isEmpty$1(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,p]of Object.entries({}))a[h]=p}if(e instanceof BaseOAuthProvider){const h=e.getScopes().filter(p=>p!=="");h.length>0&&(a.scopes=h.join(","))}i.tenantId&&(a.tid=i.tenantId);const l=a;for(const h of Object.keys(l))l[h]===void 0&&delete l[h];const u=await i._getAppCheckToken(),d=u?`#${FIREBASE_APP_CHECK_FRAGMENT_ID}=${encodeURIComponent(u)}`:"";return`${getHandlerBase(i)}?${querystring(l).slice(1)}${d}`}function getHandlerBase({config:i}){return i.emulator?_emulatorUrl(i,EMULATOR_WIDGET_PATH):`https://${i.authDomain}/${WIDGET_PATH}`}const WEB_STORAGE_SUPPORT_KEY="webStorageSupport";class BrowserPopupRedirectResolver{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=browserSessionPersistence,this._completeRedirectFn=_getRedirectResult,this._overrideRedirectResult=_overrideRedirectResult}async _openPopup(e,t,n,r){debugAssert(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const s=await _getRedirectUrl(e,t,n,_getCurrentUrl(),r);return _open(e,s,_generateEventId())}async _openRedirect(e,t,n,r){await this._originValidation(e);const s=await _getRedirectUrl(e,t,n,_getCurrentUrl(),r);return _setWindowLocation(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:s}=this.eventManagers[t];return r?Promise.resolve(r):(debugAssert(s,"If manager is not set, promise should be"),s)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await _openIframe(e),n=new AuthEventManager(e);return t.register("authEvent",r=>(_assert(r?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(WEB_STORAGE_SUPPORT_KEY,{type:WEB_STORAGE_SUPPORT_KEY},r=>{const s=r?.[0]?.[WEB_STORAGE_SUPPORT_KEY];s!==void 0&&t(!!s),_fail(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=_validateOrigin(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return _isMobileBrowser()||_isSafari()||_isIOS()}}const browserPopupRedirectResolver=BrowserPopupRedirectResolver;var name$1="@firebase/auth",version$9="1.12.0";class AuthInterop{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){_assert(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function getVersionForPlatform(i){switch(i){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function registerAuth(i){_registerComponent(new Component$2("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=n.options;_assert(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const u={apiKey:a,authDomain:l,clientPlatform:i,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_getClientVersion(i)},d=new AuthImpl(n,r,s,u);return _initializeAuthInstance(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),_registerComponent(new Component$2("auth-internal",e=>{const t=_castAuth(e.getProvider("auth").getImmediate());return(n=>new AuthInterop(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),registerVersion(name$1,version$9,getVersionForPlatform(i)),registerVersion(name$1,version$9,"esm2020")}const DEFAULT_ID_TOKEN_MAX_AGE=300,authIdTokenMaxAge=getExperimentalSetting("authIdTokenMaxAge")||DEFAULT_ID_TOKEN_MAX_AGE;let lastPostedIdToken=null;const mintCookieFactory=i=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>authIdTokenMaxAge)return;const r=t?.token;lastPostedIdToken!==r&&(lastPostedIdToken=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function getAuth(i=getApp()){const e=_getProvider(i,"auth");if(e.isInitialized())return e.getImmediate();const t=initializeAuth(i,{popupRedirectResolver:browserPopupRedirectResolver,persistence:[indexedDBLocalPersistence,browserLocalPersistence,browserSessionPersistence]}),n=getExperimentalSetting("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(n,location.origin);if(location.origin===s.origin){const a=mintCookieFactory(s.toString());beforeAuthStateChanged(t,a,()=>a(t.currentUser)),onIdTokenChanged(t,l=>a(l))}}const r=getDefaultEmulatorHost("auth");return r&&connectAuthEmulator(t,`http://${r}`),t}function getScriptParentElement(){return document.getElementsByTagName("head")?.[0]??document}_setExternalJSProvider({loadJS(i){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",i),n.onload=e,n.onerror=r=>{const s=_createError("internal-error");s.customData=r,t(s)},n.type="text/javascript",n.charset="UTF-8",getScriptParentElement().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});registerAuth("Browser");var commonjsGlobal$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Integer,Md5;(function(){var i;function e(R,I){function w(){}w.prototype=I.prototype,R.F=I.prototype,R.prototype=new w,R.prototype.constructor=R,R.D=function(H,V,te){for(var ae=Array(arguments.length-2),be=2;be<arguments.length;be++)ae[be-2]=arguments[be];return I.prototype[V].apply(H,ae)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(n,t),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(R,I,w){w||(w=0);const H=Array(16);if(typeof I=="string")for(var V=0;V<16;++V)H[V]=I.charCodeAt(w++)|I.charCodeAt(w++)<<8|I.charCodeAt(w++)<<16|I.charCodeAt(w++)<<24;else for(V=0;V<16;++V)H[V]=I[w++]|I[w++]<<8|I[w++]<<16|I[w++]<<24;I=R.g[0],w=R.g[1],V=R.g[2];let te=R.g[3],ae;ae=I+(te^w&(V^te))+H[0]+3614090360&4294967295,I=w+(ae<<7&4294967295|ae>>>25),ae=te+(V^I&(w^V))+H[1]+3905402710&4294967295,te=I+(ae<<12&4294967295|ae>>>20),ae=V+(w^te&(I^w))+H[2]+606105819&4294967295,V=te+(ae<<17&4294967295|ae>>>15),ae=w+(I^V&(te^I))+H[3]+3250441966&4294967295,w=V+(ae<<22&4294967295|ae>>>10),ae=I+(te^w&(V^te))+H[4]+4118548399&4294967295,I=w+(ae<<7&4294967295|ae>>>25),ae=te+(V^I&(w^V))+H[5]+1200080426&4294967295,te=I+(ae<<12&4294967295|ae>>>20),ae=V+(w^te&(I^w))+H[6]+2821735955&4294967295,V=te+(ae<<17&4294967295|ae>>>15),ae=w+(I^V&(te^I))+H[7]+4249261313&4294967295,w=V+(ae<<22&4294967295|ae>>>10),ae=I+(te^w&(V^te))+H[8]+1770035416&4294967295,I=w+(ae<<7&4294967295|ae>>>25),ae=te+(V^I&(w^V))+H[9]+2336552879&4294967295,te=I+(ae<<12&4294967295|ae>>>20),ae=V+(w^te&(I^w))+H[10]+4294925233&4294967295,V=te+(ae<<17&4294967295|ae>>>15),ae=w+(I^V&(te^I))+H[11]+2304563134&4294967295,w=V+(ae<<22&4294967295|ae>>>10),ae=I+(te^w&(V^te))+H[12]+1804603682&4294967295,I=w+(ae<<7&4294967295|ae>>>25),ae=te+(V^I&(w^V))+H[13]+4254626195&4294967295,te=I+(ae<<12&4294967295|ae>>>20),ae=V+(w^te&(I^w))+H[14]+2792965006&4294967295,V=te+(ae<<17&4294967295|ae>>>15),ae=w+(I^V&(te^I))+H[15]+1236535329&4294967295,w=V+(ae<<22&4294967295|ae>>>10),ae=I+(V^te&(w^V))+H[1]+4129170786&4294967295,I=w+(ae<<5&4294967295|ae>>>27),ae=te+(w^V&(I^w))+H[6]+3225465664&4294967295,te=I+(ae<<9&4294967295|ae>>>23),ae=V+(I^w&(te^I))+H[11]+643717713&4294967295,V=te+(ae<<14&4294967295|ae>>>18),ae=w+(te^I&(V^te))+H[0]+3921069994&4294967295,w=V+(ae<<20&4294967295|ae>>>12),ae=I+(V^te&(w^V))+H[5]+3593408605&4294967295,I=w+(ae<<5&4294967295|ae>>>27),ae=te+(w^V&(I^w))+H[10]+38016083&4294967295,te=I+(ae<<9&4294967295|ae>>>23),ae=V+(I^w&(te^I))+H[15]+3634488961&4294967295,V=te+(ae<<14&4294967295|ae>>>18),ae=w+(te^I&(V^te))+H[4]+3889429448&4294967295,w=V+(ae<<20&4294967295|ae>>>12),ae=I+(V^te&(w^V))+H[9]+568446438&4294967295,I=w+(ae<<5&4294967295|ae>>>27),ae=te+(w^V&(I^w))+H[14]+3275163606&4294967295,te=I+(ae<<9&4294967295|ae>>>23),ae=V+(I^w&(te^I))+H[3]+4107603335&4294967295,V=te+(ae<<14&4294967295|ae>>>18),ae=w+(te^I&(V^te))+H[8]+1163531501&4294967295,w=V+(ae<<20&4294967295|ae>>>12),ae=I+(V^te&(w^V))+H[13]+2850285829&4294967295,I=w+(ae<<5&4294967295|ae>>>27),ae=te+(w^V&(I^w))+H[2]+4243563512&4294967295,te=I+(ae<<9&4294967295|ae>>>23),ae=V+(I^w&(te^I))+H[7]+1735328473&4294967295,V=te+(ae<<14&4294967295|ae>>>18),ae=w+(te^I&(V^te))+H[12]+2368359562&4294967295,w=V+(ae<<20&4294967295|ae>>>12),ae=I+(w^V^te)+H[5]+4294588738&4294967295,I=w+(ae<<4&4294967295|ae>>>28),ae=te+(I^w^V)+H[8]+2272392833&4294967295,te=I+(ae<<11&4294967295|ae>>>21),ae=V+(te^I^w)+H[11]+1839030562&4294967295,V=te+(ae<<16&4294967295|ae>>>16),ae=w+(V^te^I)+H[14]+4259657740&4294967295,w=V+(ae<<23&4294967295|ae>>>9),ae=I+(w^V^te)+H[1]+2763975236&4294967295,I=w+(ae<<4&4294967295|ae>>>28),ae=te+(I^w^V)+H[4]+1272893353&4294967295,te=I+(ae<<11&4294967295|ae>>>21),ae=V+(te^I^w)+H[7]+4139469664&4294967295,V=te+(ae<<16&4294967295|ae>>>16),ae=w+(V^te^I)+H[10]+3200236656&4294967295,w=V+(ae<<23&4294967295|ae>>>9),ae=I+(w^V^te)+H[13]+681279174&4294967295,I=w+(ae<<4&4294967295|ae>>>28),ae=te+(I^w^V)+H[0]+3936430074&4294967295,te=I+(ae<<11&4294967295|ae>>>21),ae=V+(te^I^w)+H[3]+3572445317&4294967295,V=te+(ae<<16&4294967295|ae>>>16),ae=w+(V^te^I)+H[6]+76029189&4294967295,w=V+(ae<<23&4294967295|ae>>>9),ae=I+(w^V^te)+H[9]+3654602809&4294967295,I=w+(ae<<4&4294967295|ae>>>28),ae=te+(I^w^V)+H[12]+3873151461&4294967295,te=I+(ae<<11&4294967295|ae>>>21),ae=V+(te^I^w)+H[15]+530742520&4294967295,V=te+(ae<<16&4294967295|ae>>>16),ae=w+(V^te^I)+H[2]+3299628645&4294967295,w=V+(ae<<23&4294967295|ae>>>9),ae=I+(V^(w|~te))+H[0]+4096336452&4294967295,I=w+(ae<<6&4294967295|ae>>>26),ae=te+(w^(I|~V))+H[7]+1126891415&4294967295,te=I+(ae<<10&4294967295|ae>>>22),ae=V+(I^(te|~w))+H[14]+2878612391&4294967295,V=te+(ae<<15&4294967295|ae>>>17),ae=w+(te^(V|~I))+H[5]+4237533241&4294967295,w=V+(ae<<21&4294967295|ae>>>11),ae=I+(V^(w|~te))+H[12]+1700485571&4294967295,I=w+(ae<<6&4294967295|ae>>>26),ae=te+(w^(I|~V))+H[3]+2399980690&4294967295,te=I+(ae<<10&4294967295|ae>>>22),ae=V+(I^(te|~w))+H[10]+4293915773&4294967295,V=te+(ae<<15&4294967295|ae>>>17),ae=w+(te^(V|~I))+H[1]+2240044497&4294967295,w=V+(ae<<21&4294967295|ae>>>11),ae=I+(V^(w|~te))+H[8]+1873313359&4294967295,I=w+(ae<<6&4294967295|ae>>>26),ae=te+(w^(I|~V))+H[15]+4264355552&4294967295,te=I+(ae<<10&4294967295|ae>>>22),ae=V+(I^(te|~w))+H[6]+2734768916&4294967295,V=te+(ae<<15&4294967295|ae>>>17),ae=w+(te^(V|~I))+H[13]+1309151649&4294967295,w=V+(ae<<21&4294967295|ae>>>11),ae=I+(V^(w|~te))+H[4]+4149444226&4294967295,I=w+(ae<<6&4294967295|ae>>>26),ae=te+(w^(I|~V))+H[11]+3174756917&4294967295,te=I+(ae<<10&4294967295|ae>>>22),ae=V+(I^(te|~w))+H[2]+718787259&4294967295,V=te+(ae<<15&4294967295|ae>>>17),ae=w+(te^(V|~I))+H[9]+3951481745&4294967295,R.g[0]=R.g[0]+I&4294967295,R.g[1]=R.g[1]+(V+(ae<<21&4294967295|ae>>>11))&4294967295,R.g[2]=R.g[2]+V&4294967295,R.g[3]=R.g[3]+te&4294967295}n.prototype.v=function(R,I){I===void 0&&(I=R.length);const w=I-this.blockSize,H=this.C;let V=this.h,te=0;for(;te<I;){if(V==0)for(;te<=w;)r(this,R,te),te+=this.blockSize;if(typeof R=="string"){for(;te<I;)if(H[V++]=R.charCodeAt(te++),V==this.blockSize){r(this,H),V=0;break}}else for(;te<I;)if(H[V++]=R[te++],V==this.blockSize){r(this,H),V=0;break}}this.h=V,this.o+=I},n.prototype.A=function(){var R=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);R[0]=128;for(var I=1;I<R.length-8;++I)R[I]=0;I=this.o*8;for(var w=R.length-8;w<R.length;++w)R[w]=I&255,I/=256;for(this.v(R),R=Array(16),I=0,w=0;w<4;++w)for(let H=0;H<32;H+=8)R[I++]=this.g[w]>>>H&255;return R};function s(R,I){var w=l;return Object.prototype.hasOwnProperty.call(w,R)?w[R]:w[R]=I(R)}function a(R,I){this.h=I;const w=[];let H=!0;for(let V=R.length-1;V>=0;V--){const te=R[V]|0;H&&te==I||(w[V]=te,H=!1)}this.g=w}var l={};function u(R){return-128<=R&&R<128?s(R,function(I){return new a([I|0],I<0?-1:0)}):new a([R|0],R<0?-1:0)}function d(R){if(isNaN(R)||!isFinite(R))return p;if(R<0)return b(d(-R));const I=[];let w=1;for(let H=0;R>=w;H++)I[H]=R/w|0,w*=4294967296;return new a(I,0)}function h(R,I){if(R.length==0)throw Error("number format error: empty string");if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(R.charAt(0)=="-")return b(h(R.substring(1),I));if(R.indexOf("-")>=0)throw Error('number format error: interior "-" character');const w=d(Math.pow(I,8));let H=p;for(let te=0;te<R.length;te+=8){var V=Math.min(8,R.length-te);const ae=parseInt(R.substring(te,te+V),I);V<8?(V=d(Math.pow(I,V)),H=H.j(V).add(d(ae))):(H=H.j(w),H=H.add(d(ae)))}return H}var p=u(0),m=u(1),g=u(16777216);i=a.prototype,i.m=function(){if(_(this))return-b(this).m();let R=0,I=1;for(let w=0;w<this.g.length;w++){const H=this.i(w);R+=(H>=0?H:4294967296+H)*I,I*=4294967296}return R},i.toString=function(R){if(R=R||10,R<2||36<R)throw Error("radix out of range: "+R);if(v(this))return"0";if(_(this))return"-"+b(this).toString(R);const I=d(Math.pow(R,6));var w=this;let H="";for(;;){const V=D(w,I).g;w=E(w,V.j(I));let te=((w.g.length>0?w.g[0]:w.h)>>>0).toString(R);if(w=V,v(w))return te+H;for(;te.length<6;)te="0"+te;H=te+H}},i.i=function(R){return R<0?0:R<this.g.length?this.g[R]:this.h};function v(R){if(R.h!=0)return!1;for(let I=0;I<R.g.length;I++)if(R.g[I]!=0)return!1;return!0}function _(R){return R.h==-1}i.l=function(R){return R=E(this,R),_(R)?-1:v(R)?0:1};function b(R){const I=R.g.length,w=[];for(let H=0;H<I;H++)w[H]=~R.g[H];return new a(w,~R.h).add(m)}i.abs=function(){return _(this)?b(this):this},i.add=function(R){const I=Math.max(this.g.length,R.g.length),w=[];let H=0;for(let V=0;V<=I;V++){let te=H+(this.i(V)&65535)+(R.i(V)&65535),ae=(te>>>16)+(this.i(V)>>>16)+(R.i(V)>>>16);H=ae>>>16,te&=65535,ae&=65535,w[V]=ae<<16|te}return new a(w,w[w.length-1]&-2147483648?-1:0)};function E(R,I){return R.add(b(I))}i.j=function(R){if(v(this)||v(R))return p;if(_(this))return _(R)?b(this).j(b(R)):b(b(this).j(R));if(_(R))return b(this.j(b(R)));if(this.l(g)<0&&R.l(g)<0)return d(this.m()*R.m());const I=this.g.length+R.g.length,w=[];for(var H=0;H<2*I;H++)w[H]=0;for(H=0;H<this.g.length;H++)for(let V=0;V<R.g.length;V++){const te=this.i(H)>>>16,ae=this.i(H)&65535,be=R.i(V)>>>16,_e=R.i(V)&65535;w[2*H+2*V]+=ae*_e,A(w,2*H+2*V),w[2*H+2*V+1]+=te*_e,A(w,2*H+2*V+1),w[2*H+2*V+1]+=ae*be,A(w,2*H+2*V+1),w[2*H+2*V+2]+=te*be,A(w,2*H+2*V+2)}for(R=0;R<I;R++)w[R]=w[2*R+1]<<16|w[2*R];for(R=I;R<2*I;R++)w[R]=0;return new a(w,0)};function A(R,I){for(;(R[I]&65535)!=R[I];)R[I+1]+=R[I]>>>16,R[I]&=65535,I++}function z(R,I){this.g=R,this.h=I}function D(R,I){if(v(I))throw Error("division by zero");if(v(R))return new z(p,p);if(_(R))return I=D(b(R),I),new z(b(I.g),b(I.h));if(_(I))return I=D(R,b(I)),new z(b(I.g),I.h);if(R.g.length>30){if(_(R)||_(I))throw Error("slowDivide_ only works with positive integers.");for(var w=m,H=I;H.l(R)<=0;)w=P(w),H=P(H);var V=G(w,1),te=G(H,1);for(H=G(H,2),w=G(w,2);!v(H);){var ae=te.add(H);ae.l(R)<=0&&(V=V.add(w),te=ae),H=G(H,1),w=G(w,1)}return I=E(R,V.j(I)),new z(V,I)}for(V=p;R.l(I)>=0;){for(w=Math.max(1,Math.floor(R.m()/I.m())),H=Math.ceil(Math.log(w)/Math.LN2),H=H<=48?1:Math.pow(2,H-48),te=d(w),ae=te.j(I);_(ae)||ae.l(R)>0;)w-=H,te=d(w),ae=te.j(I);v(te)&&(te=m),V=V.add(te),R=E(R,ae)}return new z(V,R)}i.B=function(R){return D(this,R).h},i.and=function(R){const I=Math.max(this.g.length,R.g.length),w=[];for(let H=0;H<I;H++)w[H]=this.i(H)&R.i(H);return new a(w,this.h&R.h)},i.or=function(R){const I=Math.max(this.g.length,R.g.length),w=[];for(let H=0;H<I;H++)w[H]=this.i(H)|R.i(H);return new a(w,this.h|R.h)},i.xor=function(R){const I=Math.max(this.g.length,R.g.length),w=[];for(let H=0;H<I;H++)w[H]=this.i(H)^R.i(H);return new a(w,this.h^R.h)};function P(R){const I=R.g.length+1,w=[];for(let H=0;H<I;H++)w[H]=R.i(H)<<1|R.i(H-1)>>>31;return new a(w,R.h)}function G(R,I){const w=I>>5;I%=32;const H=R.g.length-w,V=[];for(let te=0;te<H;te++)V[te]=I>0?R.i(te+w)>>>I|R.i(te+w+1)<<32-I:R.i(te+w);return new a(V,R.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=h,Integer=a}).apply(typeof commonjsGlobal$1<"u"?commonjsGlobal$1:typeof self<"u"?self:typeof window<"u"?window:{});var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var XhrIo,WebChannel,EventType,ErrorCode$1,Stat,Event$1,getStatEventTarget,createWebChannelTransport;(function(){var i,e=Object.defineProperty;function t(T){T=[typeof globalThis=="object"&&globalThis,T,typeof window=="object"&&window,typeof self=="object"&&self,typeof commonjsGlobal=="object"&&commonjsGlobal];for(var de=0;de<T.length;++de){var ve=T[de];if(ve&&ve.Math==Math)return ve}throw Error("Cannot find global object")}var n=t(this);function r(T,de){if(de)e:{var ve=n;T=T.split(".");for(var we=0;we<T.length-1;we++){var Ue=T[we];if(!(Ue in ve))break e;ve=ve[Ue]}T=T[T.length-1],we=ve[T],de=de(we),de!=we&&de!=null&&e(ve,T,{configurable:!0,writable:!0,value:de})}}r("Symbol.dispose",function(T){return T||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(T){return T||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(T){return T||function(de){var ve=[],we;for(we in de)Object.prototype.hasOwnProperty.call(de,we)&&ve.push([we,de[we]]);return ve}});var s=s||{},a=this||self;function l(T){var de=typeof T;return de=="object"&&T!=null||de=="function"}function u(T,de,ve){return T.call.apply(T.bind,arguments)}function d(T,de,ve){return d=u,d.apply(null,arguments)}function h(T,de){var ve=Array.prototype.slice.call(arguments,1);return function(){var we=ve.slice();return we.push.apply(we,arguments),T.apply(this,we)}}function p(T,de){function ve(){}ve.prototype=de.prototype,T.Z=de.prototype,T.prototype=new ve,T.prototype.constructor=T,T.Ob=function(we,Ue,ze){for(var Mt=Array(arguments.length-2),yn=2;yn<arguments.length;yn++)Mt[yn-2]=arguments[yn];return de.prototype[Ue].apply(we,Mt)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?T=>T&&AsyncContext.Snapshot.wrap(T):T=>T;function g(T){const de=T.length;if(de>0){const ve=Array(de);for(let we=0;we<de;we++)ve[we]=T[we];return ve}return[]}function v(T,de){for(let we=1;we<arguments.length;we++){const Ue=arguments[we];var ve=typeof Ue;if(ve=ve!="object"?ve:Ue?Array.isArray(Ue)?"array":ve:"null",ve=="array"||ve=="object"&&typeof Ue.length=="number"){ve=T.length||0;const ze=Ue.length||0;T.length=ve+ze;for(let Mt=0;Mt<ze;Mt++)T[ve+Mt]=Ue[Mt]}else T.push(Ue)}}class _{constructor(de,ve){this.i=de,this.j=ve,this.h=0,this.g=null}get(){let de;return this.h>0?(this.h--,de=this.g,this.g=de.next,de.next=null):de=this.i(),de}}function b(T){a.setTimeout(()=>{throw T},0)}function E(){var T=R;let de=null;return T.g&&(de=T.g,T.g=T.g.next,T.g||(T.h=null),de.next=null),de}class A{constructor(){this.h=this.g=null}add(de,ve){const we=z.get();we.set(de,ve),this.h?this.h.next=we:this.g=we,this.h=we}}var z=new _(()=>new D,T=>T.reset());class D{constructor(){this.next=this.g=this.h=null}set(de,ve){this.h=de,this.g=ve,this.next=null}reset(){this.next=this.g=this.h=null}}let P,G=!1,R=new A,I=()=>{const T=Promise.resolve(void 0);P=()=>{T.then(w)}};function w(){for(var T;T=E();){try{T.h.call(T.g)}catch(ve){b(ve)}var de=z;de.j(T),de.h<100&&(de.h++,T.next=de.g,de.g=T)}G=!1}function H(){this.u=this.u,this.C=this.C}H.prototype.u=!1,H.prototype.dispose=function(){this.u||(this.u=!0,this.N())},H.prototype[Symbol.dispose]=function(){this.dispose()},H.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function V(T,de){this.type=T,this.g=this.target=de,this.defaultPrevented=!1}V.prototype.h=function(){this.defaultPrevented=!0};var te=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var T=!1,de=Object.defineProperty({},"passive",{get:function(){T=!0}});try{const ve=()=>{};a.addEventListener("test",ve,de),a.removeEventListener("test",ve,de)}catch{}return T})();function ae(T){return/^[\s\xa0]*$/.test(T)}function be(T,de){V.call(this,T?T.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,T&&this.init(T,de)}p(be,V),be.prototype.init=function(T,de){const ve=this.type=T.type,we=T.changedTouches&&T.changedTouches.length?T.changedTouches[0]:null;this.target=T.target||T.srcElement,this.g=de,de=T.relatedTarget,de||(ve=="mouseover"?de=T.fromElement:ve=="mouseout"&&(de=T.toElement)),this.relatedTarget=de,we?(this.clientX=we.clientX!==void 0?we.clientX:we.pageX,this.clientY=we.clientY!==void 0?we.clientY:we.pageY,this.screenX=we.screenX||0,this.screenY=we.screenY||0):(this.clientX=T.clientX!==void 0?T.clientX:T.pageX,this.clientY=T.clientY!==void 0?T.clientY:T.pageY,this.screenX=T.screenX||0,this.screenY=T.screenY||0),this.button=T.button,this.key=T.key||"",this.ctrlKey=T.ctrlKey,this.altKey=T.altKey,this.shiftKey=T.shiftKey,this.metaKey=T.metaKey,this.pointerId=T.pointerId||0,this.pointerType=T.pointerType,this.state=T.state,this.i=T,T.defaultPrevented&&be.Z.h.call(this)},be.prototype.h=function(){be.Z.h.call(this);const T=this.i;T.preventDefault?T.preventDefault():T.returnValue=!1};var _e="closure_listenable_"+(Math.random()*1e6|0),le=0;function ue(T,de,ve,we,Ue){this.listener=T,this.proxy=null,this.src=de,this.type=ve,this.capture=!!we,this.ha=Ue,this.key=++le,this.da=this.fa=!1}function oe(T){T.da=!0,T.listener=null,T.proxy=null,T.src=null,T.ha=null}function ee(T,de,ve){for(const we in T)de.call(ve,T[we],we,T)}function se(T,de){for(const ve in T)de.call(void 0,T[ve],ve,T)}function re(T){const de={};for(const ve in T)de[ve]=T[ve];return de}const fe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function pe(T,de){let ve,we;for(let Ue=1;Ue<arguments.length;Ue++){we=arguments[Ue];for(ve in we)T[ve]=we[ve];for(let ze=0;ze<fe.length;ze++)ve=fe[ze],Object.prototype.hasOwnProperty.call(we,ve)&&(T[ve]=we[ve])}}function Z(T){this.src=T,this.g={},this.h=0}Z.prototype.add=function(T,de,ve,we,Ue){const ze=T.toString();T=this.g[ze],T||(T=this.g[ze]=[],this.h++);const Mt=Ee(T,de,we,Ue);return Mt>-1?(de=T[Mt],ve||(de.fa=!1)):(de=new ue(de,this.src,ze,!!we,Ue),de.fa=ve,T.push(de)),de};function ce(T,de){const ve=de.type;if(ve in T.g){var we=T.g[ve],Ue=Array.prototype.indexOf.call(we,de,void 0),ze;(ze=Ue>=0)&&Array.prototype.splice.call(we,Ue,1),ze&&(oe(de),T.g[ve].length==0&&(delete T.g[ve],T.h--))}}function Ee(T,de,ve,we){for(let Ue=0;Ue<T.length;++Ue){const ze=T[Ue];if(!ze.da&&ze.listener==de&&ze.capture==!!ve&&ze.ha==we)return Ue}return-1}var Te="closure_lm_"+(Math.random()*1e6|0),Ae={};function Pe(T,de,ve,we,Ue){if(Array.isArray(de)){for(let ze=0;ze<de.length;ze++)Pe(T,de[ze],ve,we,Ue);return null}return ve=dt(ve),T&&T[_e]?T.J(de,ve,l(we)?!!we.capture:!1,Ue):Me(T,de,ve,!1,we,Ue)}function Me(T,de,ve,we,Ue,ze){if(!de)throw Error("Invalid event type");const Mt=l(Ue)?!!Ue.capture:!!Ue;let yn=Lt(T);if(yn||(T[Te]=yn=new Z(T)),ve=yn.add(de,ve,we,Mt,ze),ve.proxy)return ve;if(we=We(),ve.proxy=we,we.src=T,we.listener=ve,T.addEventListener)te||(Ue=Mt),Ue===void 0&&(Ue=!1),T.addEventListener(de.toString(),we,Ue);else if(T.attachEvent)T.attachEvent(wt(de.toString()),we);else if(T.addListener&&T.removeListener)T.addListener(we);else throw Error("addEventListener and attachEvent are unavailable.");return ve}function We(){function T(ve){return de.call(T.src,T.listener,ve)}const de=rt;return T}function qe(T,de,ve,we,Ue){if(Array.isArray(de))for(var ze=0;ze<de.length;ze++)qe(T,de[ze],ve,we,Ue);else we=l(we)?!!we.capture:!!we,ve=dt(ve),T&&T[_e]?(T=T.i,ze=String(de).toString(),ze in T.g&&(de=T.g[ze],ve=Ee(de,ve,we,Ue),ve>-1&&(oe(de[ve]),Array.prototype.splice.call(de,ve,1),de.length==0&&(delete T.g[ze],T.h--)))):T&&(T=Lt(T))&&(de=T.g[de.toString()],T=-1,de&&(T=Ee(de,ve,we,Ue)),(ve=T>-1?de[T]:null)&&Je(ve))}function Je(T){if(typeof T!="number"&&T&&!T.da){var de=T.src;if(de&&de[_e])ce(de.i,T);else{var ve=T.type,we=T.proxy;de.removeEventListener?de.removeEventListener(ve,we,T.capture):de.detachEvent?de.detachEvent(wt(ve),we):de.addListener&&de.removeListener&&de.removeListener(we),(ve=Lt(de))?(ce(ve,T),ve.h==0&&(ve.src=null,de[Te]=null)):oe(T)}}}function wt(T){return T in Ae?Ae[T]:Ae[T]="on"+T}function rt(T,de){if(T.da)T=!0;else{de=new be(de,this);const ve=T.listener,we=T.ha||T.src;T.fa&&Je(T),T=ve.call(we,de)}return T}function Lt(T){return T=T[Te],T instanceof Z?T:null}var ln="__closure_events_fn_"+(Math.random()*1e9>>>0);function dt(T){return typeof T=="function"?T:(T[ln]||(T[ln]=function(de){return T.handleEvent(de)}),T[ln])}function st(){H.call(this),this.i=new Z(this),this.M=this,this.G=null}p(st,H),st.prototype[_e]=!0,st.prototype.removeEventListener=function(T,de,ve,we){qe(this,T,de,ve,we)};function nt(T,de){var ve,we=T.G;if(we)for(ve=[];we;we=we.G)ve.push(we);if(T=T.M,we=de.type||de,typeof de=="string")de=new V(de,T);else if(de instanceof V)de.target=de.target||T;else{var Ue=de;de=new V(we,T),pe(de,Ue)}Ue=!0;let ze,Mt;if(ve)for(Mt=ve.length-1;Mt>=0;Mt--)ze=de.g=ve[Mt],Ue=dn(ze,we,!0,de)&&Ue;if(ze=de.g=T,Ue=dn(ze,we,!0,de)&&Ue,Ue=dn(ze,we,!1,de)&&Ue,ve)for(Mt=0;Mt<ve.length;Mt++)ze=de.g=ve[Mt],Ue=dn(ze,we,!1,de)&&Ue}st.prototype.N=function(){if(st.Z.N.call(this),this.i){var T=this.i;for(const de in T.g){const ve=T.g[de];for(let we=0;we<ve.length;we++)oe(ve[we]);delete T.g[de],T.h--}}this.G=null},st.prototype.J=function(T,de,ve,we){return this.i.add(String(T),de,!1,ve,we)},st.prototype.K=function(T,de,ve,we){return this.i.add(String(T),de,!0,ve,we)};function dn(T,de,ve,we){if(de=T.i.g[String(de)],!de)return!0;de=de.concat();let Ue=!0;for(let ze=0;ze<de.length;++ze){const Mt=de[ze];if(Mt&&!Mt.da&&Mt.capture==ve){const yn=Mt.listener,kn=Mt.ha||Mt.src;Mt.fa&&ce(T.i,Mt),Ue=yn.call(kn,we)!==!1&&Ue}}return Ue&&!we.defaultPrevented}function pn(T,de){if(typeof T!="function")if(T&&typeof T.handleEvent=="function")T=d(T.handleEvent,T);else throw Error("Invalid listener argument");return Number(de)>2147483647?-1:a.setTimeout(T,de||0)}function An(T){T.g=pn(()=>{T.g=null,T.i&&(T.i=!1,An(T))},T.l);const de=T.h;T.h=null,T.m.apply(null,de)}class In extends H{constructor(de,ve){super(),this.m=de,this.l=ve,this.h=null,this.i=!1,this.g=null}j(de){this.h=arguments,this.g?this.i=!0:An(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Jn(T){H.call(this),this.h=T,this.g={}}p(Jn,H);var ri=[];function Wn(T){ee(T.g,function(de,ve){this.g.hasOwnProperty(ve)&&Je(de)},T),T.g={}}Jn.prototype.N=function(){Jn.Z.N.call(this),Wn(this)},Jn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var hi=a.JSON.stringify,ai=a.JSON.parse,Zn=class{stringify(T){return a.JSON.stringify(T,void 0)}parse(T){return a.JSON.parse(T,void 0)}};function Ft(){}function Xe(){}var Ye={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function xn(){V.call(this,"d")}p(xn,V);function Vn(){V.call(this,"c")}p(Vn,V);var Bn={},si=null;function Yi(){return si=si||new st}Bn.Ia="serverreachability";function ei(T){V.call(this,Bn.Ia,T)}p(ei,V);function oi(T){const de=Yi();nt(de,new ei(de))}Bn.STAT_EVENT="statevent";function Li(T,de){V.call(this,Bn.STAT_EVENT,T),this.stat=de}p(Li,V);function xe(T){const de=Yi();nt(de,new Li(de,T))}Bn.Ja="timingevent";function Ce(T,de){V.call(this,Bn.Ja,T),this.size=de}p(Ce,V);function Fe(T,de){if(typeof T!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){T()},de)}function tt(){this.g=!0}tt.prototype.ua=function(){this.g=!1};function Tn(T,de,ve,we,Ue,ze){T.info(function(){if(T.g)if(ze){var Mt="",yn=ze.split("&");for(let Cn=0;Cn<yn.length;Cn++){var kn=yn[Cn].split("=");if(kn.length>1){const wn=kn[0];kn=kn[1];const Sn=wn.split("_");Mt=Sn.length>=2&&Sn[1]=="type"?Mt+(wn+"="+kn+"&"):Mt+(wn+"=redacted&")}}}else Mt=null;else Mt=ze;return"XMLHTTP REQ ("+we+") [attempt "+Ue+"]: "+de+`
`+ve+`
`+Mt})}function jn(T,de,ve,we,Ue,ze,Mt){T.info(function(){return"XMLHTTP RESP ("+we+") [ attempt "+Ue+"]: "+de+`
`+ve+`
`+ze+" "+Mt})}function li(T,de,ve,we){T.info(function(){return"XMLHTTP TEXT ("+de+"): "+Qi(T,ve)+(we?" "+we:"")})}function Fi(T,de){T.info(function(){return"TIMEOUT: "+de})}tt.prototype.info=function(){};function Qi(T,de){if(!T.g)return de;if(!de)return null;try{const ze=JSON.parse(de);if(ze){for(T=0;T<ze.length;T++)if(Array.isArray(ze[T])){var ve=ze[T];if(!(ve.length<2)){var we=ve[1];if(Array.isArray(we)&&!(we.length<1)){var Ue=we[0];if(Ue!="noop"&&Ue!="stop"&&Ue!="close")for(let Mt=1;Mt<we.length;Mt++)we[Mt]=""}}}}return hi(ze)}catch{return de}}var Di={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},nr={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},gr;function br(){}p(br,Ft),br.prototype.g=function(){return new XMLHttpRequest},gr=new br;function Vi(T){return encodeURIComponent(String(T))}function $r(T){var de=1;T=T.split(":");const ve=[];for(;de>0&&T.length;)ve.push(T.shift()),de--;return T.length&&ve.push(T.join(":")),ve}function wr(T,de,ve,we){this.j=T,this.i=de,this.l=ve,this.S=we||1,this.V=new Jn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Er}function Er(){this.i=null,this.g="",this.h=!1}var ci={},ir={};function fi(T,de,ve){T.M=1,T.A=ha(qi(de)),T.u=ve,T.R=!0,Bs(T,null)}function Bs(T,de){T.F=Date.now(),Vr(T),T.B=qi(T.A);var ve=T.B,we=T.S;Array.isArray(we)||(we=[String(we)]),us(ve.i,"t",we),T.C=0,ve=T.j.L,T.h=new Er,T.g=Wi(T.j,ve?de:null,!T.u),T.P>0&&(T.O=new In(d(T.Y,T,T.g),T.P)),de=T.V,ve=T.g,we=T.ba;var Ue="readystatechange";Array.isArray(Ue)||(Ue&&(ri[0]=Ue.toString()),Ue=ri);for(let ze=0;ze<Ue.length;ze++){const Mt=Pe(ve,Ue[ze],we||de.handleEvent,!1,de.h||de);if(!Mt)break;de.g[Mt.key]=Mt}de=T.J?re(T.J):{},T.u?(T.v||(T.v="POST"),de["Content-Type"]="application/x-www-form-urlencoded",T.g.ea(T.B,T.v,T.u,de)):(T.v="GET",T.g.ea(T.B,T.v,null,de)),oi(),Tn(T.i,T.v,T.B,T.l,T.S,T.u)}wr.prototype.ba=function(T){T=T.target;const de=this.O;de&&Ke(T)==3?de.j():this.Y(T)},wr.prototype.Y=function(T){try{if(T==this.g)e:{const yn=Ke(this.g),kn=this.g.ya(),Cn=this.g.ca();if(!(yn<3)&&(yn!=3||this.g&&(this.h.h||this.g.la()||$e(this.g)))){this.K||yn!=4||kn==7||(kn==8||Cn<=0?oi(3):oi(2)),fs(this);var de=this.g.ca();this.X=de;var ve=Ra(this);if(this.o=de==200,jn(this.i,this.v,this.B,this.l,this.S,yn,de),this.o){if(this.U&&!this.L){t:{if(this.g){var we,Ue=this.g;if((we=Ue.g?Ue.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ae(we)){var ze=we;break t}}ze=null}if(T=ze)li(this.i,this.l,T,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ts(this,T);else{this.o=!1,this.m=3,xe(12),ts(this),Gr(this);break e}}if(this.R){T=!0;let wn;for(;!this.K&&this.C<ve.length;)if(wn=yo(this,ve),wn==ir){yn==4&&(this.m=4,xe(14),T=!1),li(this.i,this.l,null,"[Incomplete Response]");break}else if(wn==ci){this.m=4,xe(15),li(this.i,this.l,ve,"[Invalid Chunk]"),T=!1;break}else li(this.i,this.l,wn,null),Ts(this,wn);if(ua(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),yn!=4||ve.length!=0||this.h.h||(this.m=1,xe(16),T=!1),this.o=this.o&&T,!T)li(this.i,this.l,ve,"[Invalid Chunked Response]"),ts(this),Gr(this);else if(ve.length>0&&!this.W){this.W=!0;var Mt=this.j;Mt.g==this&&Mt.aa&&!Mt.P&&(Mt.j.info("Great, no buffering proxy detected. Bytes received: "+ve.length),pi(Mt),Mt.P=!0,xe(11))}}else li(this.i,this.l,ve,null),Ts(this,ve);yn==4&&ts(this),this.o&&!this.K&&(yn==4?ni(this.j,this):(this.o=!1,Vr(this)))}else Gt(this.g),de==400&&ve.indexOf("Unknown SID")>0?(this.m=3,xe(12)):(this.m=0,xe(13)),ts(this),Gr(this)}}}catch{}};function Ra(T){if(!ua(T))return T.g.la();const de=$e(T.g);if(de==="")return"";let ve="";const we=de.length,Ue=Ke(T.g)==4;if(!T.h.i){if(typeof TextDecoder>"u")return ts(T),Gr(T),"";T.h.i=new a.TextDecoder}for(let ze=0;ze<we;ze++)T.h.h=!0,ve+=T.h.i.decode(de[ze],{stream:!(Ue&&ze==we-1)});return de.length=0,T.h.g+=ve,T.C=0,T.h.g}function ua(T){return T.g?T.v=="GET"&&T.M!=2&&T.j.Aa:!1}function yo(T,de){var ve=T.C,we=de.indexOf(`
`,ve);return we==-1?ir:(ve=Number(de.substring(ve,we)),isNaN(ve)?ci:(we+=1,we+ve>de.length?ir:(de=de.slice(we,we+ve),T.C=we+ve,de)))}wr.prototype.cancel=function(){this.K=!0,ts(this)};function Vr(T){T.T=Date.now()+T.H,Ui(T,T.H)}function Ui(T,de){if(T.D!=null)throw Error("WatchDog timer not null");T.D=Fe(d(T.aa,T),de)}function fs(T){T.D&&(a.clearTimeout(T.D),T.D=null)}wr.prototype.aa=function(){this.D=null;const T=Date.now();T-this.T>=0?(Fi(this.i,this.B),this.M!=2&&(oi(),xe(17)),ts(this),this.m=2,Gr(this)):Ui(this,this.T-T)};function Gr(T){T.j.I==0||T.K||ni(T.j,T)}function ts(T){fs(T);var de=T.O;de&&typeof de.dispose=="function"&&de.dispose(),T.O=null,Wn(T.V),T.g&&(de=T.g,T.g=null,de.abort(),de.dispose())}function Ts(T,de){try{var ve=T.j;if(ve.I!=0&&(ve.g==T||ps(ve.h,T))){if(!T.L&&ps(ve.h,T)&&ve.I==3){try{var we=ve.Ba.g.parse(de)}catch{we=null}if(Array.isArray(we)&&we.length==3){var Ue=we;if(Ue[0]==0){e:if(!ve.v){if(ve.g)if(ve.g.F+3e3<T.F)mi(ve),vn(ve);else break e;Ln(ve),xe(18)}}else ve.xa=Ue[1],0<ve.xa-ve.K&&Ue[2]<37500&&ve.F&&ve.A==0&&!ve.C&&(ve.C=Fe(d(ve.Va,ve),6e3));os(ve.h)<=1&&ve.ta&&(ve.ta=void 0)}else Ci(ve,11)}else if((T.L||ve.g==T)&&mi(ve),!ae(de))for(Ue=ve.Ba.g.parse(de),de=0;de<Ue.length;de++){let Cn=Ue[de];const wn=Cn[0];if(!(wn<=ve.K))if(ve.K=wn,Cn=Cn[1],ve.I==2)if(Cn[0]=="c"){ve.M=Cn[1],ve.ba=Cn[2];const Sn=Cn[3];Sn!=null&&(ve.ka=Sn,ve.j.info("VER="+ve.ka));const zn=Cn[4];zn!=null&&(ve.za=zn,ve.j.info("SVER="+ve.za));const Kn=Cn[5];Kn!=null&&typeof Kn=="number"&&Kn>0&&(we=1.5*Kn,ve.O=we,ve.j.info("backChannelRequestTimeoutMs_="+we)),we=ve;const bi=T.g;if(bi){const Ti=bi.g?bi.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ti){var ze=we.h;ze.g||Ti.indexOf("spdy")==-1&&Ti.indexOf("quic")==-1&&Ti.indexOf("h2")==-1||(ze.j=ze.l,ze.g=new Set,ze.h&&(Ya(ze,ze.h),ze.h=null))}if(we.G){const ur=bi.g?bi.g.getResponseHeader("X-HTTP-Session-Id"):null;ur&&(we.wa=ur,ki(we.J,we.G,ur))}}ve.I=3,ve.l&&ve.l.ra(),ve.aa&&(ve.T=Date.now()-T.F,ve.j.info("Handshake RTT: "+ve.T+"ms")),we=ve;var Mt=T;if(we.na=rr(we,we.L?we.ba:null,we.W),Mt.L){Qa(we.h,Mt);var yn=Mt,kn=we.O;kn&&(yn.H=kn),yn.D&&(fs(yn),Vr(yn)),we.g=Mt}else Gn(we);ve.i.length>0&&qn(ve)}else Cn[0]!="stop"&&Cn[0]!="close"||Ci(ve,7);else ve.I==3&&(Cn[0]=="stop"||Cn[0]=="close"?Cn[0]=="stop"?Ci(ve,7):En(ve):Cn[0]!="noop"&&ve.l&&ve.l.qa(Cn),ve.A=0)}}oi(4)}catch{}}var lr=class{constructor(T,de){this.g=T,this.map=de}};function Pa(T){this.l=T||10,a.PerformanceNavigationTiming?(T=a.performance.getEntriesByType("navigation"),T=T.length>0&&(T[0].nextHopProtocol=="hq"||T[0].nextHopProtocol=="h2")):T=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=T?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function da(T){return T.h?!0:T.g?T.g.size>=T.j:!1}function os(T){return T.h?1:T.g?T.g.size:0}function ps(T,de){return T.h?T.h==de:T.g?T.g.has(de):!1}function Ya(T,de){T.g?T.g.add(de):T.h=de}function Qa(T,de){T.h&&T.h==de?T.h=null:T.g&&T.g.has(de)&&T.g.delete(de)}Pa.prototype.cancel=function(){if(this.i=ms(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const T of this.g.values())T.cancel();this.g.clear()}};function ms(T){if(T.h!=null)return T.i.concat(T.h.G);if(T.g!=null&&T.g.size!==0){let de=T.i;for(const ve of T.g.values())de=de.concat(ve.G);return de}return g(T.i)}var ea=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ta(T,de){if(T){T=T.split("&");for(let ve=0;ve<T.length;ve++){const we=T[ve].indexOf("=");let Ue,ze=null;we>=0?(Ue=T[ve].substring(0,we),ze=T[ve].substring(we+1)):Ue=T[ve],de(Ue,ze?decodeURIComponent(ze.replace(/\+/g," ")):"")}}}function Nr(T){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let de;T instanceof Nr?(this.l=T.l,fr(this,T.j),this.o=T.o,this.g=T.g,ls(this,T.u),this.h=T.h,Ja(this,ka(T.i)),this.m=T.m):T&&(de=String(T).match(ea))?(this.l=!1,fr(this,de[1]||"",!0),this.o=xs(de[2]||""),this.g=xs(de[3]||"",!0),ls(this,de[4]),this.h=xs(de[5]||"",!0),Ja(this,de[6]||"",!0),this.m=xs(de[7]||"")):(this.l=!1,this.i=new cs(null,this.l))}Nr.prototype.toString=function(){const T=[];var de=this.j;de&&T.push(Wr(de,Ia,!0),":");var ve=this.g;return(ve||de=="file")&&(T.push("//"),(de=this.o)&&T.push(Wr(de,Ia,!0),"@"),T.push(Vi(ve).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ve=this.u,ve!=null&&T.push(":",String(ve))),(ve=this.h)&&(this.g&&ve.charAt(0)!="/"&&T.push("/"),T.push(Wr(ve,ve.charAt(0)=="/"?js:Da,!0))),(ve=this.i.toString())&&T.push("?",ve),(ve=this.m)&&T.push("#",Wr(ve,Za)),T.join("")},Nr.prototype.resolve=function(T){const de=qi(this);let ve=!!T.j;ve?fr(de,T.j):ve=!!T.o,ve?de.o=T.o:ve=!!T.g,ve?de.g=T.g:ve=T.u!=null;var we=T.h;if(ve)ls(de,T.u);else if(ve=!!T.h){if(we.charAt(0)!="/")if(this.g&&!this.h)we="/"+we;else{var Ue=de.h.lastIndexOf("/");Ue!=-1&&(we=de.h.slice(0,Ue+1)+we)}if(Ue=we,Ue==".."||Ue==".")we="";else if(Ue.indexOf("./")!=-1||Ue.indexOf("/.")!=-1){we=Ue.lastIndexOf("/",0)==0,Ue=Ue.split("/");const ze=[];for(let Mt=0;Mt<Ue.length;){const yn=Ue[Mt++];yn=="."?we&&Mt==Ue.length&&ze.push(""):yn==".."?((ze.length>1||ze.length==1&&ze[0]!="")&&ze.pop(),we&&Mt==Ue.length&&ze.push("")):(ze.push(yn),we=!0)}we=ze.join("/")}else we=Ue}return ve?de.h=we:ve=T.i.toString()!=="",ve?Ja(de,ka(T.i)):ve=!!T.m,ve&&(de.m=T.m),de};function qi(T){return new Nr(T)}function fr(T,de,ve){T.j=ve?xs(de,!0):de,T.j&&(T.j=T.j.replace(/:$/,""))}function ls(T,de){if(de){if(de=Number(de),isNaN(de)||de<0)throw Error("Bad port number "+de);T.u=de}else T.u=null}function Ja(T,de,ve){de instanceof cs?(T.i=de,Ma(T.i,T.l)):(ve||(de=Wr(de,Rr)),T.i=new cs(de,T.l))}function ki(T,de,ve){T.i.set(de,ve)}function ha(T){return ki(T,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),T}function xs(T,de){return T?de?decodeURI(T.replace(/%25/g,"%2525")):decodeURIComponent(T):""}function Wr(T,de,ve){return typeof T=="string"?(T=encodeURI(T).replace(de,Cr),ve&&(T=T.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),T):null}function Cr(T){return T=T.charCodeAt(0),"%"+(T>>4&15).toString(16)+(T&15).toString(16)}var Ia=/[#\/\?@]/g,Da=/[#\?:]/g,js=/[#\?]/g,Rr=/[#\?@]/g,Za=/#/g;function cs(T,de){this.h=this.g=null,this.i=T||null,this.j=!!de}function Pr(T){T.g||(T.g=new Map,T.h=0,T.i&&ta(T.i,function(de,ve){T.add(decodeURIComponent(de.replace(/\+/g," ")),ve)}))}i=cs.prototype,i.add=function(T,de){Pr(this),this.i=null,T=Hs(this,T);let ve=this.g.get(T);return ve||this.g.set(T,ve=[]),ve.push(de),this.h+=1,this};function Us(T,de){Pr(T),de=Hs(T,de),T.g.has(de)&&(T.i=null,T.h-=T.g.get(de).length,T.g.delete(de))}function Ss(T,de){return Pr(T),de=Hs(T,de),T.g.has(de)}i.forEach=function(T,de){Pr(this),this.g.forEach(function(ve,we){ve.forEach(function(Ue){T.call(de,Ue,we,this)},this)},this)};function fa(T,de){Pr(T);let ve=[];if(typeof de=="string")Ss(T,de)&&(ve=ve.concat(T.g.get(Hs(T,de))));else for(T=Array.from(T.g.values()),de=0;de<T.length;de++)ve=ve.concat(T[de]);return ve}i.set=function(T,de){return Pr(this),this.i=null,T=Hs(this,T),Ss(this,T)&&(this.h-=this.g.get(T).length),this.g.set(T,[de]),this.h+=1,this},i.get=function(T,de){return T?(T=fa(this,T),T.length>0?String(T[0]):de):de};function us(T,de,ve){Us(T,de),ve.length>0&&(T.i=null,T.g.set(Hs(T,de),g(ve)),T.h+=ve.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";const T=[],de=Array.from(this.g.keys());for(let we=0;we<de.length;we++){var ve=de[we];const Ue=Vi(ve);ve=fa(this,ve);for(let ze=0;ze<ve.length;ze++){let Mt=Ue;ve[ze]!==""&&(Mt+="="+Vi(ve[ze])),T.push(Mt)}}return this.i=T.join("&")};function ka(T){const de=new cs;return de.i=T.i,T.g&&(de.g=new Map(T.g),de.h=T.h),de}function Hs(T,de){return de=String(de),T.j&&(de=de.toLowerCase()),de}function Ma(T,de){de&&!T.j&&(Pr(T),T.i=null,T.g.forEach(function(ve,we){const Ue=we.toLowerCase();we!=Ue&&(Us(this,we),us(this,Ue,ve))},T)),T.j=de}function Qr(T,de){const ve=new tt;if(a.Image){const we=new Image;we.onload=h(ns,ve,"TestLoadImage: loaded",!0,de,we),we.onerror=h(ns,ve,"TestLoadImage: error",!1,de,we),we.onabort=h(ns,ve,"TestLoadImage: abort",!1,de,we),we.ontimeout=h(ns,ve,"TestLoadImage: timeout",!1,de,we),a.setTimeout(function(){we.ontimeout&&we.ontimeout()},1e4),we.src=T}else de(!1)}function As(T,de){const ve=new tt,we=new AbortController,Ue=setTimeout(()=>{we.abort(),ns(ve,"TestPingServer: timeout",!1,de)},1e4);fetch(T,{signal:we.signal}).then(ze=>{clearTimeout(Ue),ze.ok?ns(ve,"TestPingServer: ok",!0,de):ns(ve,"TestPingServer: server error",!1,de)}).catch(()=>{clearTimeout(Ue),ns(ve,"TestPingServer: error",!1,de)})}function ns(T,de,ve,we,Ue){try{Ue&&(Ue.onload=null,Ue.onerror=null,Ue.onabort=null,Ue.ontimeout=null),we(ve)}catch{}}function qs(){this.g=new Zn}function ds(T){this.i=T.Sb||null,this.h=T.ab||!1}p(ds,Ft),ds.prototype.g=function(){return new zs(this.i,this.h)};function zs(T,de){st.call(this),this.H=T,this.o=de,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}p(zs,st),i=zs.prototype,i.open=function(T,de){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=T,this.D=de,this.readyState=1,Jr(this)},i.send=function(T){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const de={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};T&&(de.body=T),(this.H||a).fetch(new Request(this.D,de)).then(this.Pa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,na(this)),this.readyState=0},i.Pa=function(T){if(this.g&&(this.l=T,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=T.headers,this.readyState=2,Jr(this)),this.g&&(this.readyState=3,Jr(this),this.g)))if(this.responseType==="arraybuffer")T.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in T){if(this.j=T.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;pa(this)}else T.text().then(this.Oa.bind(this),this.ga.bind(this))};function pa(T){T.j.read().then(T.Ma.bind(T)).catch(T.ga.bind(T))}i.Ma=function(T){if(this.g){if(this.o&&T.value)this.response.push(T.value);else if(!this.o){var de=T.value?T.value:new Uint8Array(0);(de=this.B.decode(de,{stream:!T.done}))&&(this.response=this.responseText+=de)}T.done?na(this):Jr(this),this.readyState==3&&pa(this)}},i.Oa=function(T){this.g&&(this.response=this.responseText=T,na(this))},i.Na=function(T){this.g&&(this.response=T,na(this))},i.ga=function(){this.g&&na(this)};function na(T){T.readyState=4,T.l=null,T.j=null,T.B=null,Jr(T)}i.setRequestHeader=function(T,de){this.A.append(T,de)},i.getResponseHeader=function(T){return this.h&&this.h.get(T.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";const T=[],de=this.h.entries();for(var ve=de.next();!ve.done;)ve=ve.value,T.push(ve[0]+": "+ve[1]),ve=de.next();return T.join(`\r
`)};function Jr(T){T.onreadystatechange&&T.onreadystatechange.call(T)}Object.defineProperty(zs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(T){this.m=T?"include":"same-origin"}});function me(T){let de="";return ee(T,function(ve,we){de+=we,de+=":",de+=ve,de+=`\r
`}),de}function Se(T,de,ve){e:{for(we in ve){var we=!1;break e}we=!0}we||(ve=me(ve),typeof T=="string"?ve!=null&&Vi(ve):ki(T,de,ve))}function De(T){st.call(this),this.headers=new Map,this.L=T||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}p(De,st);var Le=/^https?$/i,Be=["POST","PUT"];i=De.prototype,i.Fa=function(T){this.H=T},i.ea=function(T,de,ve,we){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+T);de=de?de.toUpperCase():"GET",this.D=T,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():gr.g(),this.g.onreadystatechange=m(d(this.Ca,this));try{this.B=!0,this.g.open(de,String(T),!0),this.B=!1}catch(ze){je(this,ze);return}if(T=ve||"",ve=new Map(this.headers),we)if(Object.getPrototypeOf(we)===Object.prototype)for(var Ue in we)ve.set(Ue,we[Ue]);else if(typeof we.keys=="function"&&typeof we.get=="function")for(const ze of we.keys())ve.set(ze,we.get(ze));else throw Error("Unknown input type for opt_headers: "+String(we));we=Array.from(ve.keys()).find(ze=>ze.toLowerCase()=="content-type"),Ue=a.FormData&&T instanceof a.FormData,!(Array.prototype.indexOf.call(Be,de,void 0)>=0)||we||Ue||ve.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ze,Mt]of ve)this.g.setRequestHeader(ze,Mt);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(T),this.v=!1}catch(ze){je(this,ze)}};function je(T,de){T.h=!1,T.g&&(T.j=!0,T.g.abort(),T.j=!1),T.l=de,T.o=5,Ze(T),Oe(T)}function Ze(T){T.A||(T.A=!0,nt(T,"complete"),nt(T,"error"))}i.abort=function(T){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=T||7,nt(this,"complete"),nt(this,"abort"),Oe(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Oe(this,!0)),De.Z.N.call(this)},i.Ca=function(){this.u||(this.B||this.v||this.j?Ge(this):this.Xa())},i.Xa=function(){Ge(this)};function Ge(T){if(T.h&&typeof s<"u"){if(T.v&&Ke(T)==4)setTimeout(T.Ca.bind(T),0);else if(nt(T,"readystatechange"),Ke(T)==4){T.h=!1;try{const ze=T.ca();e:switch(ze){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var de=!0;break e;default:de=!1}var ve;if(!(ve=de)){var we;if(we=ze===0){let Mt=String(T.D).match(ea)[1]||null;!Mt&&a.self&&a.self.location&&(Mt=a.self.location.protocol.slice(0,-1)),we=!Le.test(Mt?Mt.toLowerCase():"")}ve=we}if(ve)nt(T,"complete"),nt(T,"success");else{T.o=6;try{var Ue=Ke(T)>2?T.g.statusText:""}catch{Ue=""}T.l=Ue+" ["+T.ca()+"]",Ze(T)}}finally{Oe(T)}}}}function Oe(T,de){if(T.g){T.m&&(clearTimeout(T.m),T.m=null);const ve=T.g;T.g=null,de||nt(T,"ready");try{ve.onreadystatechange=null}catch{}}}i.isActive=function(){return!!this.g};function Ke(T){return T.g?T.g.readyState:0}i.ca=function(){try{return Ke(this)>2?this.g.status:-1}catch{return-1}},i.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.La=function(T){if(this.g){var de=this.g.responseText;return T&&de.indexOf(T)==0&&(de=de.substring(T.length)),ai(de)}};function $e(T){try{if(!T.g)return null;if("response"in T.g)return T.g.response;switch(T.F){case"":case"text":return T.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in T.g)return T.g.mozResponseArrayBuffer}return null}catch{return null}}function Gt(T){const de={};T=(T.g&&Ke(T)>=2&&T.g.getAllResponseHeaders()||"").split(`\r
`);for(let we=0;we<T.length;we++){if(ae(T[we]))continue;var ve=$r(T[we]);const Ue=ve[0];if(ve=ve[1],typeof ve!="string")continue;ve=ve.trim();const ze=de[Ue]||[];de[Ue]=ze,ze.push(ve)}se(de,function(we){return we.join(", ")})}i.ya=function(){return this.o},i.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function zt(T,de,ve){return ve&&ve.internalChannelParams&&ve.internalChannelParams[T]||de}function qt(T){this.za=0,this.i=[],this.j=new tt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=zt("failFast",!1,T),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=zt("baseRetryDelayMs",5e3,T),this.Za=zt("retryDelaySeedMs",1e4,T),this.Ta=zt("forwardChannelMaxRetries",2,T),this.va=zt("forwardChannelRequestTimeoutMs",2e4,T),this.ma=T&&T.xmlHttpFactory||void 0,this.Ua=T&&T.Rb||void 0,this.Aa=T&&T.useFetchStreams||!1,this.O=void 0,this.L=T&&T.supportsCrossDomainXhr||!1,this.M="",this.h=new Pa(T&&T.concurrentRequestLimit),this.Ba=new qs,this.S=T&&T.fastHandshake||!1,this.R=T&&T.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=T&&T.Pb||!1,T&&T.ua&&this.j.ua(),T&&T.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&T&&T.detectBufferingProxy||!1,this.ia=void 0,T&&T.longPollingTimeout&&T.longPollingTimeout>0&&(this.ia=T.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}i=qt.prototype,i.ka=8,i.I=1,i.connect=function(T,de,ve,we){xe(0),this.W=T,this.H=de||{},ve&&we!==void 0&&(this.H.OSID=ve,this.H.OAID=we),this.F=this.X,this.J=rr(this,null,this.W),qn(this)};function En(T){if(mn(T),T.I==3){var de=T.V++,ve=qi(T.J);if(ki(ve,"SID",T.M),ki(ve,"RID",de),ki(ve,"TYPE","terminate"),Un(T,ve),de=new wr(T,T.j,de),de.M=2,de.A=ha(qi(ve)),ve=!1,a.navigator&&a.navigator.sendBeacon)try{ve=a.navigator.sendBeacon(de.A.toString(),"")}catch{}!ve&&a.Image&&(new Image().src=de.A,ve=!0),ve||(de.g=Wi(de.j,null),de.g.ea(de.A)),de.F=Date.now(),Vr(de)}Oi(T)}function vn(T){T.g&&(pi(T),T.g.cancel(),T.g=null)}function mn(T){vn(T),T.v&&(a.clearTimeout(T.v),T.v=null),mi(T),T.h.cancel(),T.m&&(typeof T.m=="number"&&a.clearTimeout(T.m),T.m=null)}function qn(T){if(!da(T.h)&&!T.m){T.m=!0;var de=T.Ea;P||I(),G||(P(),G=!0),R.add(de,T),T.D=0}}function Nn(T,de){return os(T.h)>=T.h.j-(T.m?1:0)?!1:T.m?(T.i=de.G.concat(T.i),!0):T.I==1||T.I==2||T.D>=(T.Sa?0:T.Ta)?!1:(T.m=Fe(d(T.Ea,T,de),di(T,T.D)),T.D++,!0)}i.Ea=function(T){if(this.m)if(this.m=null,this.I==1){if(!T){this.V=Math.floor(Math.random()*1e5),T=this.V++;const Ue=new wr(this,this.j,T);let ze=this.o;if(this.U&&(ze?(ze=re(ze),pe(ze,this.U)):ze=this.U),this.u!==null||this.R||(Ue.J=ze,ze=null),this.S)e:{for(var de=0,ve=0;ve<this.i.length;ve++){t:{var we=this.i[ve];if("__data__"in we.map&&(we=we.map.__data__,typeof we=="string")){we=we.length;break t}we=void 0}if(we===void 0)break;if(de+=we,de>4096){de=ve;break e}if(de===4096||ve===this.i.length-1){de=ve+1;break e}}de=1e3}else de=1e3;de=Dn(this,Ue,de),ve=qi(this.J),ki(ve,"RID",T),ki(ve,"CVER",22),this.G&&ki(ve,"X-HTTP-Session-Id",this.G),Un(this,ve),ze&&(this.R?de="headers="+Vi(me(ze))+"&"+de:this.u&&Se(ve,this.u,ze)),Ya(this.h,Ue),this.Ra&&ki(ve,"TYPE","init"),this.S?(ki(ve,"$req",de),ki(ve,"SID","null"),Ue.U=!0,fi(Ue,ve,null)):fi(Ue,ve,de),this.I=2}}else this.I==3&&(T?On(this,T):this.i.length==0||da(this.h)||On(this))};function On(T,de){var ve;de?ve=de.l:ve=T.V++;const we=qi(T.J);ki(we,"SID",T.M),ki(we,"RID",ve),ki(we,"AID",T.K),Un(T,we),T.u&&T.o&&Se(we,T.u,T.o),ve=new wr(T,T.j,ve,T.D+1),T.u===null&&(ve.J=T.o),de&&(T.i=de.G.concat(T.i)),de=Dn(T,ve,1e3),ve.H=Math.round(T.va*.5)+Math.round(T.va*.5*Math.random()),Ya(T.h,ve),fi(ve,we,de)}function Un(T,de){T.H&&ee(T.H,function(ve,we){ki(de,we,ve)}),T.l&&ee({},function(ve,we){ki(de,we,ve)})}function Dn(T,de,ve){ve=Math.min(T.i.length,ve);const we=T.l?d(T.l.Ka,T.l,T):null;e:{var Ue=T.i;let yn=-1;for(;;){const kn=["count="+ve];yn==-1?ve>0?(yn=Ue[0].g,kn.push("ofs="+yn)):yn=0:kn.push("ofs="+yn);let Cn=!0;for(let wn=0;wn<ve;wn++){var ze=Ue[wn].g;const Sn=Ue[wn].map;if(ze-=yn,ze<0)yn=Math.max(0,Ue[wn].g-100),Cn=!1;else try{ze="req"+ze+"_"||"";try{var Mt=Sn instanceof Map?Sn:Object.entries(Sn);for(const[zn,Kn]of Mt){let bi=Kn;l(Kn)&&(bi=hi(Kn)),kn.push(ze+zn+"="+encodeURIComponent(bi))}}catch(zn){throw kn.push(ze+"type="+encodeURIComponent("_badmap")),zn}}catch{we&&we(Sn)}}if(Cn){Mt=kn.join("&");break e}}Mt=void 0}return T=T.i.splice(0,ve),de.G=T,Mt}function Gn(T){if(!T.g&&!T.v){T.Y=1;var de=T.Da;P||I(),G||(P(),G=!0),R.add(de,T),T.A=0}}function Ln(T){return T.g||T.v||T.A>=3?!1:(T.Y++,T.v=Fe(d(T.Da,T),di(T,T.A)),T.A++,!0)}i.Da=function(){if(this.v=null,ui(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var T=4*this.T;this.j.info("BP detection timer enabled: "+T),this.B=Fe(d(this.Wa,this),T)}},i.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,xe(10),vn(this),ui(this))};function pi(T){T.B!=null&&(a.clearTimeout(T.B),T.B=null)}function ui(T){T.g=new wr(T,T.j,"rpc",T.Y),T.u===null&&(T.g.J=T.o),T.g.P=0;var de=qi(T.na);ki(de,"RID","rpc"),ki(de,"SID",T.M),ki(de,"AID",T.K),ki(de,"CI",T.F?"0":"1"),!T.F&&T.ia&&ki(de,"TO",T.ia),ki(de,"TYPE","xmlhttp"),Un(T,de),T.u&&T.o&&Se(de,T.u,T.o),T.O&&(T.g.H=T.O);var ve=T.g;T=T.ba,ve.M=1,ve.A=ha(qi(de)),ve.u=null,ve.R=!0,Bs(ve,T)}i.Va=function(){this.C!=null&&(this.C=null,vn(this),Ln(this),xe(19))};function mi(T){T.C!=null&&(a.clearTimeout(T.C),T.C=null)}function ni(T,de){var ve=null;if(T.g==de){mi(T),pi(T),T.g=null;var we=2}else if(ps(T.h,de))ve=de.G,Qa(T.h,de),we=1;else return;if(T.I!=0){if(de.o)if(we==1){ve=de.u?de.u.length:0,de=Date.now()-de.F;var Ue=T.D;we=Yi(),nt(we,new Ce(we,ve)),qn(T)}else Gn(T);else if(Ue=de.m,Ue==3||Ue==0&&de.X>0||!(we==1&&Nn(T,de)||we==2&&Ln(T)))switch(ve&&ve.length>0&&(de=T.h,de.i=de.i.concat(ve)),Ue){case 1:Ci(T,5);break;case 4:Ci(T,10);break;case 3:Ci(T,6);break;default:Ci(T,2)}}}function di(T,de){let ve=T.Qa+Math.floor(Math.random()*T.Za);return T.isActive()||(ve*=2),ve*de}function Ci(T,de){if(T.j.info("Error code "+de),de==2){var ve=d(T.bb,T),we=T.Ua;const Ue=!we;we=new Nr(we||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||fr(we,"https"),ha(we),Ue?Qr(we.toString(),ve):As(we.toString(),ve)}else xe(2);T.I=0,T.l&&T.l.pa(de),Oi(T),mn(T)}i.bb=function(T){T?(this.j.info("Successfully pinged google.com"),xe(2)):(this.j.info("Failed to ping google.com"),xe(1))};function Oi(T){if(T.I=0,T.ja=[],T.l){const de=ms(T.h);(de.length!=0||T.i.length!=0)&&(v(T.ja,de),v(T.ja,T.i),T.h.i.length=0,g(T.i),T.i.length=0),T.l.oa()}}function rr(T,de,ve){var we=ve instanceof Nr?qi(ve):new Nr(ve);if(we.g!="")de&&(we.g=de+"."+we.g),ls(we,we.u);else{var Ue=a.location;we=Ue.protocol,de=de?de+"."+Ue.hostname:Ue.hostname,Ue=+Ue.port;const ze=new Nr(null);we&&fr(ze,we),de&&(ze.g=de),Ue&&ls(ze,Ue),ve&&(ze.h=ve),we=ze}return ve=T.G,de=T.wa,ve&&de&&ki(we,ve,de),ki(we,"VER",T.ka),Un(T,we),we}function Wi(T,de,ve){if(de&&!T.L)throw Error("Can't create secondary domain capable XhrIo object.");return de=T.Aa&&!T.ma?new De(new ds({ab:ve})):new De(T.ma),de.Fa(T.L),de}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function Xi(){}i=Xi.prototype,i.ra=function(){},i.qa=function(){},i.pa=function(){},i.oa=function(){},i.isActive=function(){return!0},i.Ka=function(){};function Bi(){}Bi.prototype.g=function(T,de){return new vi(T,de)};function vi(T,de){st.call(this),this.g=new qt(de),this.l=T,this.h=de&&de.messageUrlParams||null,T=de&&de.messageHeaders||null,de&&de.clientProtocolHeaderRequired&&(T?T["X-Client-Protocol"]="webchannel":T={"X-Client-Protocol":"webchannel"}),this.g.o=T,T=de&&de.initMessageHeaders||null,de&&de.messageContentType&&(T?T["X-WebChannel-Content-Type"]=de.messageContentType:T={"X-WebChannel-Content-Type":de.messageContentType}),de&&de.sa&&(T?T["X-WebChannel-Client-Profile"]=de.sa:T={"X-WebChannel-Client-Profile":de.sa}),this.g.U=T,(T=de&&de.Qb)&&!ae(T)&&(this.g.u=T),this.A=de&&de.supportsCrossDomainXhr||!1,this.v=de&&de.sendRawJson||!1,(de=de&&de.httpSessionIdParam)&&!ae(de)&&(this.g.G=de,T=this.h,T!==null&&de in T&&(T=this.h,de in T&&delete T[de])),this.j=new cr(this)}p(vi,st),vi.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},vi.prototype.close=function(){En(this.g)},vi.prototype.o=function(T){var de=this.g;if(typeof T=="string"){var ve={};ve.__data__=T,T=ve}else this.v&&(ve={},ve.__data__=hi(T),T=ve);de.i.push(new lr(de.Ya++,T)),de.I==3&&qn(de)},vi.prototype.N=function(){this.g.l=null,delete this.j,En(this.g),delete this.g,vi.Z.N.call(this)};function _r(T){xn.call(this),T.__headers__&&(this.headers=T.__headers__,this.statusCode=T.__status__,delete T.__headers__,delete T.__status__);var de=T.__sm__;if(de){e:{for(const ve in de){T=ve;break e}T=void 0}(this.i=T)&&(T=this.i,de=de!==null&&T in de?de[T]:void 0),this.data=de}else this.data=T}p(_r,xn);function Br(){Vn.call(this),this.status=1}p(Br,Vn);function cr(T){this.g=T}p(cr,Xi),cr.prototype.ra=function(){nt(this.g,"a")},cr.prototype.qa=function(T){nt(this.g,new _r(T))},cr.prototype.pa=function(T){nt(this.g,new Br)},cr.prototype.oa=function(){nt(this.g,"b")},Bi.prototype.createWebChannel=Bi.prototype.g,vi.prototype.send=vi.prototype.o,vi.prototype.open=vi.prototype.m,vi.prototype.close=vi.prototype.close,createWebChannelTransport=function(){return new Bi},getStatEventTarget=function(){return Yi()},Event$1=Bn,Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Di.NO_ERROR=0,Di.TIMEOUT=8,Di.HTTP_ERROR=6,ErrorCode$1=Di,nr.COMPLETE="complete",EventType=nr,Xe.EventType=Ye,Ye.OPEN="a",Ye.CLOSE="b",Ye.ERROR="c",Ye.MESSAGE="d",st.prototype.listen=st.prototype.J,WebChannel=Xe,De.prototype.listenOnce=De.prototype.K,De.prototype.getLastError=De.prototype.Ha,De.prototype.getLastErrorCode=De.prototype.ya,De.prototype.getStatus=De.prototype.ca,De.prototype.getResponseJson=De.prototype.La,De.prototype.getResponseText=De.prototype.la,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Fa,XhrIo=De}).apply(typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{});const F="@firebase/firestore",M="4.9.3";class User{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}User.UNAUTHENTICATED=new User(null),User.GOOGLE_CREDENTIALS=new User("google-credentials-uid"),User.FIRST_PARTY=new User("first-party-uid"),User.MOCK_USER=new User("mock-user");let x="12.7.0";const O=new Logger("@firebase/firestore");function __PRIVATE_getLogLevel(){return O.logLevel}function __PRIVATE_logDebug(i,...e){if(O.logLevel<=LogLevel.DEBUG){const t=e.map(__PRIVATE_argToString);O.debug(`Firestore (${x}): ${i}`,...t)}}function __PRIVATE_logError(i,...e){if(O.logLevel<=LogLevel.ERROR){const t=e.map(__PRIVATE_argToString);O.error(`Firestore (${x}): ${i}`,...t)}}function __PRIVATE_logWarn(i,...e){if(O.logLevel<=LogLevel.WARN){const t=e.map(__PRIVATE_argToString);O.warn(`Firestore (${x}): ${i}`,...t)}}function __PRIVATE_argToString(i){if(typeof i=="string")return i;try{return(function(t){return JSON.stringify(t)})(i)}catch{return i}}function fail(i,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,__PRIVATE__fail(i,n,t)}function __PRIVATE__fail(i,e,t){let n=`FIRESTORE (${x}) INTERNAL ASSERTION FAILED: ${e} (ID: ${i.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw __PRIVATE_logError(n),new Error(n)}function __PRIVATE_hardAssert(i,e,t,n){let r="Unexpected state";typeof t=="string"?r=t:n=t,i||__PRIVATE__fail(e,r,n)}function __PRIVATE_debugCast(i,e){return i}const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class FirestoreError extends FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class __PRIVATE_Deferred{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class __PRIVATE_OAuthToken{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class __PRIVATE_EmptyAuthCredentialsProvider{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(User.UNAUTHENTICATED)))}shutdown(){}}class __PRIVATE_EmulatorAuthCredentialsProvider{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class __PRIVATE_FirebaseAuthCredentialsProvider{constructor(e){this.t=e,this.currentUser=User.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){__PRIVATE_hardAssert(this.o===void 0,42304);let n=this.i;const r=u=>this.i!==n?(n=this.i,t(u)):Promise.resolve();let s=new __PRIVATE_Deferred;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new __PRIVATE_Deferred,e.enqueueRetryable((()=>r(this.currentUser)))};const a=()=>{const u=s;e.enqueueRetryable((async()=>{await u.promise,await r(this.currentUser)}))},l=u=>{__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>l(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new __PRIVATE_Deferred)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((n=>this.i!==e?(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(__PRIVATE_hardAssert(typeof n.accessToken=="string",31837,{l:n}),new __PRIVATE_OAuthToken(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return __PRIVATE_hardAssert(e===null||typeof e=="string",2055,{h:e}),new User(e)}}class __PRIVATE_FirstPartyToken{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=User.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class __PRIVATE_FirstPartyAuthCredentialsProvider{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new __PRIVATE_FirstPartyToken(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(User.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class AppCheckToken{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class __PRIVATE_FirebaseAppCheckTokenProvider{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,_isFirebaseServerApp(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){__PRIVATE_hardAssert(this.o===void 0,3512);const n=s=>{s.error!=null&&__PRIVATE_logDebug("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,__PRIVATE_logDebug("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable((()=>n(s)))};const r=s=>{__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((s=>r(s))),setTimeout((()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?r(s):__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new AppCheckToken(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(__PRIVATE_hardAssert(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new AppCheckToken(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function __PRIVATE_randomBytes(i){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<i;n++)t[n]=Math.floor(256*Math.random());return t}class __PRIVATE_AutoId{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const r=__PRIVATE_randomBytes(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<t&&(n+=e.charAt(r[s]%62))}return n}}function __PRIVATE_primitiveComparator(i,e){return i<e?-1:i>e?1:0}function __PRIVATE_compareUtf8Strings(i,e){const t=Math.min(i.length,e.length);for(let n=0;n<t;n++){const r=i.charAt(n),s=e.charAt(n);if(r!==s)return __PRIVATE_isSurrogate(r)===__PRIVATE_isSurrogate(s)?__PRIVATE_primitiveComparator(r,s):__PRIVATE_isSurrogate(r)?1:-1}return __PRIVATE_primitiveComparator(i.length,e.length)}const B=55296,L=57343;function __PRIVATE_isSurrogate(i){const e=i.charCodeAt(0);return e>=B&&e<=L}function __PRIVATE_arrayEquals(i,e,t){return i.length===e.length&&i.every(((n,r)=>t(n,e[r])))}const k="__name__";class BasePath{constructor(e,t,n){t===void 0?t=0:t>e.length&&fail(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&fail(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return BasePath.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof BasePath?e.forEach((n=>{t.push(n)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const s=BasePath.compareSegments(e.get(r),t.get(r));if(s!==0)return s}return __PRIVATE_primitiveComparator(e.length,t.length)}static compareSegments(e,t){const n=BasePath.isNumericId(e),r=BasePath.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?BasePath.extractNumericId(e).compare(BasePath.extractNumericId(t)):__PRIVATE_compareUtf8Strings(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Integer.fromString(e.substring(4,e.length-2))}}class ResourcePath extends BasePath{construct(e,t,n){return new ResourcePath(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((r=>r.length>0)))}return new ResourcePath(t)}static emptyPath(){return new ResourcePath([])}}const q=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class FieldPath$1 extends BasePath{construct(e,t,n){return new FieldPath$1(e,t,n)}static isValidIdentifier(e){return q.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),FieldPath$1.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===k}static keyField(){return new FieldPath$1([k])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(n.length===0)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;r<e.length;){const l=e[r];if(l==="\\"){if(r+1===e.length)throw new FirestoreError(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[r+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new FirestoreError(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,r+=2}else l==="`"?(a=!a,r++):l!=="."||a?(n+=l,r++):(s(),r++)}if(s(),a)throw new FirestoreError(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new FieldPath$1(t)}static emptyPath(){return new FieldPath$1([])}}class DocumentKey{constructor(e){this.path=e}static fromPath(e){return new DocumentKey(ResourcePath.fromString(e))}static fromName(e){return new DocumentKey(ResourcePath.fromString(e).popFirst(5))}static empty(){return new DocumentKey(ResourcePath.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ResourcePath.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ResourcePath.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new DocumentKey(new ResourcePath(e.slice()))}}function __PRIVATE_validateNonEmptyArgument(i,e,t){if(!t)throw new FirestoreError(N.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function __PRIVATE_validateIsNotUsedTogether(i,e,t,n){if(e===!0&&n===!0)throw new FirestoreError(N.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function __PRIVATE_validateDocumentPath(i){if(!DocumentKey.isDocumentKey(i))throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function __PRIVATE_validateCollectionPath(i){if(DocumentKey.isDocumentKey(i))throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function __PRIVATE_isPlainObject(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}function __PRIVATE_valueDescription(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{const e=(function(n){return n.constructor?n.constructor.name:null})(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":fail(12329,{type:typeof i})}function __PRIVATE_cast(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new FirestoreError(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=__PRIVATE_valueDescription(i);throw new FirestoreError(N.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}function property(i,e){const t={typeString:i};return e&&(t.value=e),t}function __PRIVATE_validateJSON(i,e){if(!__PRIVATE_isPlainObject(i))throw new FirestoreError(N.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const r=e[n].typeString,s="value"in e[n]?{value:e[n].value}:void 0;if(!(n in i)){t=`JSON missing required field: '${n}'`;break}const a=i[n];if(r&&typeof a!==r){t=`JSON field '${n}' must be a ${r}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${n}' field to equal '${s.value}'`;break}}if(t)throw new FirestoreError(N.INVALID_ARGUMENT,t);return!0}const Q=-62135596800,$$1=1e6;class Timestamp{static now(){return Timestamp.fromMillis(Date.now())}static fromDate(e){return Timestamp.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*$$1);return new Timestamp(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Q)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/$$1}_compareTo(e){return this.seconds===e.seconds?__PRIVATE_primitiveComparator(this.nanoseconds,e.nanoseconds):__PRIVATE_primitiveComparator(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Timestamp._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(__PRIVATE_validateJSON(e,Timestamp._jsonSchema))return new Timestamp(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Q;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Timestamp._jsonSchemaVersion="firestore/timestamp/1.0",Timestamp._jsonSchema={type:property("string",Timestamp._jsonSchemaVersion),seconds:property("number"),nanoseconds:property("number")};class SnapshotVersion{static fromTimestamp(e){return new SnapshotVersion(e)}static min(){return new SnapshotVersion(new Timestamp(0,0))}static max(){return new SnapshotVersion(new Timestamp(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const U=-1;function __PRIVATE_newIndexOffsetSuccessorFromReadTime(i,e){const t=i.toTimestamp().seconds,n=i.toTimestamp().nanoseconds+1,r=SnapshotVersion.fromTimestamp(n===1e9?new Timestamp(t+1,0):new Timestamp(t,n));return new IndexOffset(r,DocumentKey.empty(),e)}function __PRIVATE_newIndexOffsetFromDocument(i){return new IndexOffset(i.readTime,i.key,U)}class IndexOffset{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new IndexOffset(SnapshotVersion.min(),DocumentKey.empty(),U)}static max(){return new IndexOffset(SnapshotVersion.max(),DocumentKey.empty(),U)}}function __PRIVATE_indexOffsetComparator(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=DocumentKey.comparator(i.documentKey,e.documentKey),t!==0?t:__PRIVATE_primitiveComparator(i.largestBatchId,e.largestBatchId))}const K="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class PersistenceTransaction{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function __PRIVATE_ignoreIfPrimaryLeaseLoss(i){if(i.code!==N.FAILED_PRECONDITION||i.message!==K)throw i;__PRIVATE_logDebug("LocalStore","Unexpectedly lost primary lease")}class PersistencePromise{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&fail(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new PersistencePromise(((n,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof PersistencePromise?t:PersistencePromise.resolve(t)}catch(t){return PersistencePromise.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):PersistencePromise.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):PersistencePromise.reject(t)}static resolve(e){return new PersistencePromise(((t,n)=>{t(e)}))}static reject(e){return new PersistencePromise(((t,n)=>{n(e)}))}static waitFor(e){return new PersistencePromise(((t,n)=>{let r=0,s=0,a=!1;e.forEach((l=>{++r,l.next((()=>{++s,a&&s===r&&t()}),(u=>n(u)))})),a=!0,s===r&&t()}))}static or(e){let t=PersistencePromise.resolve(!1);for(const n of e)t=t.next((r=>r?PersistencePromise.resolve(r):n()));return t}static forEach(e,t){const n=[];return e.forEach(((r,s)=>{n.push(t.call(this,r,s))})),this.waitFor(n)}static mapArray(e,t){return new PersistencePromise(((n,r)=>{const s=e.length,a=new Array(s);let l=0;for(let u=0;u<s;u++){const d=u;t(e[d]).next((h=>{a[d]=h,++l,l===s&&n(a)}),(h=>r(h)))}}))}static doWhile(e,t){return new PersistencePromise(((n,r)=>{const s=()=>{e()===!0?t().next((()=>{s()}),r):n()};s()}))}}function __PRIVATE_getAndroidVersion(i){const e=i.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function __PRIVATE_isIndexedDbTransactionError(i){return i.name==="IndexedDbTransactionError"}class __PRIVATE_ListenSequence{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>t.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}__PRIVATE_ListenSequence.ce=-1;const j=-1;function __PRIVATE_isNullOrUndefined(i){return i==null}function __PRIVATE_isNegativeZero(i){return i===0&&1/i==-1/0}function isSafeInteger(i){return typeof i=="number"&&Number.isInteger(i)&&!__PRIVATE_isNegativeZero(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}const J="";function __PRIVATE_encodeResourcePath(i){let e="";for(let t=0;t<i.length;t++)e.length>0&&(e=__PRIVATE_encodeSeparator(e)),e=__PRIVATE_encodeSegment(i.get(t),e);return __PRIVATE_encodeSeparator(e)}function __PRIVATE_encodeSegment(i,e){let t=e;const n=i.length;for(let r=0;r<n;r++){const s=i.charAt(r);switch(s){case"\0":t+="";break;case J:t+="";break;default:t+=s}}return t}function __PRIVATE_encodeSeparator(i){return i+J+""}function __PRIVATE_objectSize(i){let e=0;for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function forEach(i,e){for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function __PRIVATE_mapToArray(i,e){const t=[];for(const n in i)Object.prototype.hasOwnProperty.call(i,n)&&t.push(e(i[n],n,i));return t}function isEmpty(i){for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}class SortedMap{constructor(e,t){this.comparator=e,this.root=t||LLRBNode.EMPTY}insert(e,t){return new SortedMap(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}remove(e){return new SortedMap(this.comparator,this.root.remove(e,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new SortedMapIterator(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new SortedMapIterator(this.root,e,this.comparator,!1)}getReverseIterator(){return new SortedMapIterator(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new SortedMapIterator(this.root,e,this.comparator,!0)}}class SortedMapIterator{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class LLRBNode{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=n??LLRBNode.RED,this.left=r??LLRBNode.EMPTY,this.right=s??LLRBNode.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new LLRBNode(e??this.key,t??this.value,n??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):s===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return LLRBNode.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return LLRBNode.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw fail(43730,{key:this.key,value:this.value});if(this.right.isRed())throw fail(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw fail(27949);return e+(this.isRed()?0:1)}}LLRBNode.EMPTY=null,LLRBNode.RED=!0,LLRBNode.BLACK=!1;LLRBNode.EMPTY=new class{constructor(){this.size=0}get key(){throw fail(57766)}get value(){throw fail(16141)}get color(){throw fail(16727)}get left(){throw fail(29726)}get right(){throw fail(36894)}copy(e,t,n,r,s){return this}insert(e,t,n){return new LLRBNode(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class SortedSet{constructor(e){this.comparator=e,this.data=new SortedMap(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new SortedSetIterator(this.data.getIterator())}getIteratorFrom(e){return new SortedSetIterator(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((n=>{t=t.add(n)})),t}isEqual(e){if(!(e instanceof SortedSet)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=n.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new SortedSet(this.comparator);return t.data=e,t}}class SortedSetIterator{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class FieldMask{constructor(e){this.fields=e,e.sort(FieldPath$1.comparator)}static empty(){return new FieldMask([])}unionWith(e){let t=new SortedSet(FieldPath$1.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new FieldMask(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return __PRIVATE_arrayEquals(this.fields,e.fields,((t,n)=>t.isEqual(n)))}}class __PRIVATE_Base64DecodeError extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ByteString{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new __PRIVATE_Base64DecodeError("Invalid base64 string: "+s):s}})(e);return new ByteString(t)}static fromUint8Array(e){const t=(function(r){let s="";for(let a=0;a<r.length;++a)s+=String.fromCharCode(r[a]);return s})(e);return new ByteString(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return __PRIVATE_primitiveComparator(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ByteString.EMPTY_BYTE_STRING=new ByteString("");const ot=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function __PRIVATE_normalizeTimestamp(i){if(__PRIVATE_hardAssert(!!i,39018),typeof i=="string"){let e=0;const t=ot.exec(i);if(__PRIVATE_hardAssert(!!t,46558,{timestamp:i}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const n=new Date(i);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:__PRIVATE_normalizeNumber(i.seconds),nanos:__PRIVATE_normalizeNumber(i.nanos)}}function __PRIVATE_normalizeNumber(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function __PRIVATE_normalizeByteString(i){return typeof i=="string"?ByteString.fromBase64String(i):ByteString.fromUint8Array(i)}const _t="server_timestamp",at="__type__",ut="__previous_value__",ct="__local_write_time__";function __PRIVATE_isServerTimestamp(i){return(i?.mapValue?.fields||{})[at]?.stringValue===_t}function __PRIVATE_getPreviousValue(i){const e=i.mapValue.fields[ut];return __PRIVATE_isServerTimestamp(e)?__PRIVATE_getPreviousValue(e):e}function __PRIVATE_getLocalWriteTime(i){const e=__PRIVATE_normalizeTimestamp(i.mapValue.fields[ct].timestampValue);return new Timestamp(e.seconds,e.nanos)}class DatabaseInfo{constructor(e,t,n,r,s,a,l,u,d,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=d,this.isUsingEmulator=h}}const lt="(default)";class DatabaseId{constructor(e,t){this.projectId=e,this.database=t||lt}static empty(){return new DatabaseId("","")}get isDefaultDatabase(){return this.database===lt}isEqual(e){return e instanceof DatabaseId&&e.projectId===this.projectId&&e.database===this.database}}const ht="__type__",Pt="__max__",Tt={mapValue:{}},It="__vector__",Et="value";function __PRIVATE_typeOrder(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?__PRIVATE_isServerTimestamp(i)?4:__PRIVATE_isMaxValue(i)?9007199254740991:__PRIVATE_isVectorValue(i)?10:11:fail(28295,{value:i})}function __PRIVATE_valueEquals(i,e){if(i===e)return!0;const t=__PRIVATE_typeOrder(i);if(t!==__PRIVATE_typeOrder(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return __PRIVATE_getLocalWriteTime(i).isEqual(__PRIVATE_getLocalWriteTime(e));case 3:return(function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const a=__PRIVATE_normalizeTimestamp(r.timestampValue),l=__PRIVATE_normalizeTimestamp(s.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(i,e);case 5:return i.stringValue===e.stringValue;case 6:return(function(r,s){return __PRIVATE_normalizeByteString(r.bytesValue).isEqual(__PRIVATE_normalizeByteString(s.bytesValue))})(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return(function(r,s){return __PRIVATE_normalizeNumber(r.geoPointValue.latitude)===__PRIVATE_normalizeNumber(s.geoPointValue.latitude)&&__PRIVATE_normalizeNumber(r.geoPointValue.longitude)===__PRIVATE_normalizeNumber(s.geoPointValue.longitude)})(i,e);case 2:return(function(r,s){if("integerValue"in r&&"integerValue"in s)return __PRIVATE_normalizeNumber(r.integerValue)===__PRIVATE_normalizeNumber(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const a=__PRIVATE_normalizeNumber(r.doubleValue),l=__PRIVATE_normalizeNumber(s.doubleValue);return a===l?__PRIVATE_isNegativeZero(a)===__PRIVATE_isNegativeZero(l):isNaN(a)&&isNaN(l)}return!1})(i,e);case 9:return __PRIVATE_arrayEquals(i.arrayValue.values||[],e.arrayValue.values||[],__PRIVATE_valueEquals);case 10:case 11:return(function(r,s){const a=r.mapValue.fields||{},l=s.mapValue.fields||{};if(__PRIVATE_objectSize(a)!==__PRIVATE_objectSize(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!__PRIVATE_valueEquals(a[u],l[u])))return!1;return!0})(i,e);default:return fail(52216,{left:i})}}function __PRIVATE_arrayValueContains(i,e){return(i.values||[]).find((t=>__PRIVATE_valueEquals(t,e)))!==void 0}function __PRIVATE_valueCompare(i,e){if(i===e)return 0;const t=__PRIVATE_typeOrder(i),n=__PRIVATE_typeOrder(e);if(t!==n)return __PRIVATE_primitiveComparator(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return __PRIVATE_primitiveComparator(i.booleanValue,e.booleanValue);case 2:return(function(s,a){const l=__PRIVATE_normalizeNumber(s.integerValue||s.doubleValue),u=__PRIVATE_normalizeNumber(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1})(i,e);case 3:return __PRIVATE_compareTimestamps(i.timestampValue,e.timestampValue);case 4:return __PRIVATE_compareTimestamps(__PRIVATE_getLocalWriteTime(i),__PRIVATE_getLocalWriteTime(e));case 5:return __PRIVATE_compareUtf8Strings(i.stringValue,e.stringValue);case 6:return(function(s,a){const l=__PRIVATE_normalizeByteString(s),u=__PRIVATE_normalizeByteString(a);return l.compareTo(u)})(i.bytesValue,e.bytesValue);case 7:return(function(s,a){const l=s.split("/"),u=a.split("/");for(let d=0;d<l.length&&d<u.length;d++){const h=__PRIVATE_primitiveComparator(l[d],u[d]);if(h!==0)return h}return __PRIVATE_primitiveComparator(l.length,u.length)})(i.referenceValue,e.referenceValue);case 8:return(function(s,a){const l=__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(s.latitude),__PRIVATE_normalizeNumber(a.latitude));return l!==0?l:__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(s.longitude),__PRIVATE_normalizeNumber(a.longitude))})(i.geoPointValue,e.geoPointValue);case 9:return __PRIVATE_compareArrays(i.arrayValue,e.arrayValue);case 10:return(function(s,a){const l=s.fields||{},u=a.fields||{},d=l[Et]?.arrayValue,h=u[Et]?.arrayValue,p=__PRIVATE_primitiveComparator(d?.values?.length||0,h?.values?.length||0);return p!==0?p:__PRIVATE_compareArrays(d,h)})(i.mapValue,e.mapValue);case 11:return(function(s,a){if(s===Tt.mapValue&&a===Tt.mapValue)return 0;if(s===Tt.mapValue)return 1;if(a===Tt.mapValue)return-1;const l=s.fields||{},u=Object.keys(l),d=a.fields||{},h=Object.keys(d);u.sort(),h.sort();for(let p=0;p<u.length&&p<h.length;++p){const m=__PRIVATE_compareUtf8Strings(u[p],h[p]);if(m!==0)return m;const g=__PRIVATE_valueCompare(l[u[p]],d[h[p]]);if(g!==0)return g}return __PRIVATE_primitiveComparator(u.length,h.length)})(i.mapValue,e.mapValue);default:throw fail(23264,{he:t})}}function __PRIVATE_compareTimestamps(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return __PRIVATE_primitiveComparator(i,e);const t=__PRIVATE_normalizeTimestamp(i),n=__PRIVATE_normalizeTimestamp(e),r=__PRIVATE_primitiveComparator(t.seconds,n.seconds);return r!==0?r:__PRIVATE_primitiveComparator(t.nanos,n.nanos)}function __PRIVATE_compareArrays(i,e){const t=i.values||[],n=e.values||[];for(let r=0;r<t.length&&r<n.length;++r){const s=__PRIVATE_valueCompare(t[r],n[r]);if(s)return s}return __PRIVATE_primitiveComparator(t.length,n.length)}function canonicalId(i){return __PRIVATE_canonifyValue(i)}function __PRIVATE_canonifyValue(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?(function(t){const n=__PRIVATE_normalizeTimestamp(t);return`time(${n.seconds},${n.nanos})`})(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?(function(t){return __PRIVATE_normalizeByteString(t).toBase64()})(i.bytesValue):"referenceValue"in i?(function(t){return DocumentKey.fromName(t).toString()})(i.referenceValue):"geoPointValue"in i?(function(t){return`geo(${t.latitude},${t.longitude})`})(i.geoPointValue):"arrayValue"in i?(function(t){let n="[",r=!0;for(const s of t.values||[])r?r=!1:n+=",",n+=__PRIVATE_canonifyValue(s);return n+"]"})(i.arrayValue):"mapValue"in i?(function(t){const n=Object.keys(t.fields||{}).sort();let r="{",s=!0;for(const a of n)s?s=!1:r+=",",r+=`${a}:${__PRIVATE_canonifyValue(t.fields[a])}`;return r+"}"})(i.mapValue):fail(61005,{value:i})}function __PRIVATE_estimateByteSize(i){switch(__PRIVATE_typeOrder(i)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=__PRIVATE_getPreviousValue(i);return e?16+__PRIVATE_estimateByteSize(e):16;case 5:return 2*i.stringValue.length;case 6:return __PRIVATE_normalizeByteString(i.bytesValue).approximateByteSize();case 7:return i.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((r,s)=>r+__PRIVATE_estimateByteSize(s)),0)})(i.arrayValue);case 10:case 11:return(function(n){let r=0;return forEach(n.fields,((s,a)=>{r+=s.length+__PRIVATE_estimateByteSize(a)})),r})(i.mapValue);default:throw fail(13486,{value:i})}}function __PRIVATE_refValue(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function isInteger(i){return!!i&&"integerValue"in i}function isArray(i){return!!i&&"arrayValue"in i}function __PRIVATE_isNullValue(i){return!!i&&"nullValue"in i}function __PRIVATE_isNanValue(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function __PRIVATE_isMapValue(i){return!!i&&"mapValue"in i}function __PRIVATE_isVectorValue(i){return(i?.mapValue?.fields||{})[ht]?.stringValue===It}function __PRIVATE_deepClone(i){if(i.geoPointValue)return{geoPointValue:{...i.geoPointValue}};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:{...i.timestampValue}};if(i.mapValue){const e={mapValue:{fields:{}}};return forEach(i.mapValue.fields,((t,n)=>e.mapValue.fields[t]=__PRIVATE_deepClone(n))),e}if(i.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=__PRIVATE_deepClone(i.arrayValue.values[t]);return e}return{...i}}function __PRIVATE_isMaxValue(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue===Pt}class ObjectValue{constructor(e){this.value=e}static empty(){return new ObjectValue({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!__PRIVATE_isMapValue(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=__PRIVATE_deepClone(t)}setAll(e){let t=FieldPath$1.emptyPath(),n={},r=[];e.forEach(((a,l)=>{if(!t.isImmediateParentOf(l)){const u=this.getFieldsMap(t);this.applyChanges(u,n,r),n={},r=[],t=l.popLast()}a?n[l.lastSegment()]=__PRIVATE_deepClone(a):r.push(l.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());__PRIVATE_isMapValue(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return __PRIVATE_valueEquals(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];__PRIVATE_isMapValue(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){forEach(t,((r,s)=>e[r]=s));for(const r of n)delete e[r]}clone(){return new ObjectValue(__PRIVATE_deepClone(this.value))}}function __PRIVATE_extractFieldMask(i){const e=[];return forEach(i.fields,((t,n)=>{const r=new FieldPath$1([t]);if(__PRIVATE_isMapValue(n)){const s=__PRIVATE_extractFieldMask(n.mapValue).fields;if(s.length===0)e.push(r);else for(const a of s)e.push(r.child(a))}else e.push(r)})),new FieldMask(e)}class MutableDocument{constructor(e,t,n,r,s,a,l){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=a,this.documentState=l}static newInvalidDocument(e){return new MutableDocument(e,0,SnapshotVersion.min(),SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newFoundDocument(e,t,n,r){return new MutableDocument(e,1,t,SnapshotVersion.min(),n,r,0)}static newNoDocument(e,t){return new MutableDocument(e,2,t,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newUnknownDocument(e,t){return new MutableDocument(e,3,t,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(SnapshotVersion.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ObjectValue.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ObjectValue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=SnapshotVersion.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof MutableDocument&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new MutableDocument(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Bound{constructor(e,t){this.position=e,this.inclusive=t}}function __PRIVATE_boundCompareToDocument(i,e,t){let n=0;for(let r=0;r<i.position.length;r++){const s=e[r],a=i.position[r];if(s.field.isKeyField()?n=DocumentKey.comparator(DocumentKey.fromName(a.referenceValue),t.key):n=__PRIVATE_valueCompare(a,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function __PRIVATE_boundEquals(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!__PRIVATE_valueEquals(i.position[t],e.position[t]))return!1;return!0}class OrderBy{constructor(e,t="asc"){this.field=e,this.dir=t}}function __PRIVATE_orderByEquals(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}class Filter{}class FieldFilter extends Filter{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new __PRIVATE_KeyFieldFilter(e,t,n):t==="array-contains"?new __PRIVATE_ArrayContainsFilter(e,n):t==="in"?new __PRIVATE_InFilter(e,n):t==="not-in"?new __PRIVATE_NotInFilter(e,n):t==="array-contains-any"?new __PRIVATE_ArrayContainsAnyFilter(e,n):new FieldFilter(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new __PRIVATE_KeyFieldInFilter(e,n):new __PRIVATE_KeyFieldNotInFilter(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(__PRIVATE_valueCompare(t,this.value)):t!==null&&__PRIVATE_typeOrder(this.value)===__PRIVATE_typeOrder(t)&&this.matchesComparison(__PRIVATE_valueCompare(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return fail(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class CompositeFilter extends Filter{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new CompositeFilter(e,t)}matches(e){return __PRIVATE_compositeFilterIsConjunction(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function __PRIVATE_compositeFilterIsConjunction(i){return i.op==="and"}function __PRIVATE_compositeFilterIsFlatConjunction(i){return __PRIVATE_compositeFilterIsFlat(i)&&__PRIVATE_compositeFilterIsConjunction(i)}function __PRIVATE_compositeFilterIsFlat(i){for(const e of i.filters)if(e instanceof CompositeFilter)return!1;return!0}function __PRIVATE_canonifyFilter(i){if(i instanceof FieldFilter)return i.field.canonicalString()+i.op.toString()+canonicalId(i.value);if(__PRIVATE_compositeFilterIsFlatConjunction(i))return i.filters.map((e=>__PRIVATE_canonifyFilter(e))).join(",");{const e=i.filters.map((t=>__PRIVATE_canonifyFilter(t))).join(",");return`${i.op}(${e})`}}function __PRIVATE_filterEquals(i,e){return i instanceof FieldFilter?(function(n,r){return r instanceof FieldFilter&&n.op===r.op&&n.field.isEqual(r.field)&&__PRIVATE_valueEquals(n.value,r.value)})(i,e):i instanceof CompositeFilter?(function(n,r){return r instanceof CompositeFilter&&n.op===r.op&&n.filters.length===r.filters.length?n.filters.reduce(((s,a,l)=>s&&__PRIVATE_filterEquals(a,r.filters[l])),!0):!1})(i,e):void fail(19439)}function __PRIVATE_stringifyFilter(i){return i instanceof FieldFilter?(function(t){return`${t.field.canonicalString()} ${t.op} ${canonicalId(t.value)}`})(i):i instanceof CompositeFilter?(function(t){return t.op.toString()+" {"+t.getFilters().map(__PRIVATE_stringifyFilter).join(" ,")+"}"})(i):"Filter"}class __PRIVATE_KeyFieldFilter extends FieldFilter{constructor(e,t,n){super(e,t,n),this.key=DocumentKey.fromName(n.referenceValue)}matches(e){const t=DocumentKey.comparator(e.key,this.key);return this.matchesComparison(t)}}class __PRIVATE_KeyFieldInFilter extends FieldFilter{constructor(e,t){super(e,"in",t),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class __PRIVATE_KeyFieldNotInFilter extends FieldFilter{constructor(e,t){super(e,"not-in",t),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function __PRIVATE_extractDocumentKeysFromArrayValue(i,e){return(e.arrayValue?.values||[]).map((t=>DocumentKey.fromName(t.referenceValue)))}class __PRIVATE_ArrayContainsFilter extends FieldFilter{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return isArray(t)&&__PRIVATE_arrayValueContains(t.arrayValue,this.value)}}class __PRIVATE_InFilter extends FieldFilter{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&__PRIVATE_arrayValueContains(this.value.arrayValue,t)}}class __PRIVATE_NotInFilter extends FieldFilter{constructor(e,t){super(e,"not-in",t)}matches(e){if(__PRIVATE_arrayValueContains(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!__PRIVATE_arrayValueContains(this.value.arrayValue,t)}}class __PRIVATE_ArrayContainsAnyFilter extends FieldFilter{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!isArray(t)||!t.arrayValue.values)&&t.arrayValue.values.some((n=>__PRIVATE_arrayValueContains(this.value.arrayValue,n)))}}class __PRIVATE_TargetImpl{constructor(e,t=null,n=[],r=[],s=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=a,this.endAt=l,this.Te=null}}function __PRIVATE_newTarget(i,e=null,t=[],n=[],r=null,s=null,a=null){return new __PRIVATE_TargetImpl(i,e,t,n,r,s,a)}function __PRIVATE_canonifyTarget(i){const e=__PRIVATE_debugCast(i);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((n=>__PRIVATE_canonifyFilter(n))).join(","),t+="|ob:",t+=e.orderBy.map((n=>(function(s){return s.field.canonicalString()+s.dir})(n))).join(","),__PRIVATE_isNullOrUndefined(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((n=>canonicalId(n))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((n=>canonicalId(n))).join(",")),e.Te=t}return e.Te}function __PRIVATE_targetEquals(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!__PRIVATE_orderByEquals(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!__PRIVATE_filterEquals(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!__PRIVATE_boundEquals(i.startAt,e.startAt)&&__PRIVATE_boundEquals(i.endAt,e.endAt)}function __PRIVATE_targetIsDocumentTarget(i){return DocumentKey.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}class __PRIVATE_QueryImpl{constructor(e,t=null,n=[],r=[],s=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=a,this.startAt=l,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function __PRIVATE_newQuery(i,e,t,n,r,s,a,l){return new __PRIVATE_QueryImpl(i,e,t,n,r,s,a,l)}function __PRIVATE_newQueryForPath(i){return new __PRIVATE_QueryImpl(i)}function __PRIVATE_queryMatchesAllDocuments(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function __PRIVATE_isCollectionGroupQuery(i){return i.collectionGroup!==null}function __PRIVATE_queryNormalizedOrderBy(i){const e=__PRIVATE_debugCast(i);if(e.Ie===null){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new SortedSet(FieldPath$1.comparator);return a.filters.forEach((u=>{u.getFlattenedFilters().forEach((d=>{d.isInequality()&&(l=l.add(d.field))}))})),l})(e).forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new OrderBy(s,n))})),t.has(FieldPath$1.keyField().canonicalString())||e.Ie.push(new OrderBy(FieldPath$1.keyField(),n))}return e.Ie}function __PRIVATE_queryToTarget(i){const e=__PRIVATE_debugCast(i);return e.Ee||(e.Ee=__PRIVATE__queryToTarget(e,__PRIVATE_queryNormalizedOrderBy(i))),e.Ee}function __PRIVATE_queryToAggregateTarget(i){const e=__PRIVATE_debugCast(i);return e.de||(e.de=__PRIVATE__queryToTarget(e,i.explicitOrderBy)),e.de}function __PRIVATE__queryToTarget(i,e){if(i.limitType==="F")return __PRIVATE_newTarget(i.path,i.collectionGroup,e,i.filters,i.limit,i.startAt,i.endAt);{e=e.map((r=>{const s=r.dir==="desc"?"asc":"desc";return new OrderBy(r.field,s)}));const t=i.endAt?new Bound(i.endAt.position,i.endAt.inclusive):null,n=i.startAt?new Bound(i.startAt.position,i.startAt.inclusive):null;return __PRIVATE_newTarget(i.path,i.collectionGroup,e,i.filters,i.limit,t,n)}}function __PRIVATE_queryWithAddedFilter(i,e){const t=i.filters.concat([e]);return new __PRIVATE_QueryImpl(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function __PRIVATE_queryWithLimit(i,e,t){return new __PRIVATE_QueryImpl(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function __PRIVATE_queryEquals(i,e){return __PRIVATE_targetEquals(__PRIVATE_queryToTarget(i),__PRIVATE_queryToTarget(e))&&i.limitType===e.limitType}function __PRIVATE_canonifyQuery(i){return`${__PRIVATE_canonifyTarget(__PRIVATE_queryToTarget(i))}|lt:${i.limitType}`}function __PRIVATE_stringifyQuery(i){return`Query(target=${(function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map((r=>__PRIVATE_stringifyFilter(r))).join(", ")}]`),__PRIVATE_isNullOrUndefined(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map((r=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(r))).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((r=>canonicalId(r))).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((r=>canonicalId(r))).join(",")),`Target(${n})`})(__PRIVATE_queryToTarget(i))}; limitType=${i.limitType})`}function __PRIVATE_queryMatches(i,e){return e.isFoundDocument()&&(function(n,r){const s=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):DocumentKey.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)})(i,e)&&(function(n,r){for(const s of __PRIVATE_queryNormalizedOrderBy(n))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0})(i,e)&&(function(n,r){for(const s of n.filters)if(!s.matches(r))return!1;return!0})(i,e)&&(function(n,r){return!(n.startAt&&!(function(a,l,u){const d=__PRIVATE_boundCompareToDocument(a,l,u);return a.inclusive?d<=0:d<0})(n.startAt,__PRIVATE_queryNormalizedOrderBy(n),r)||n.endAt&&!(function(a,l,u){const d=__PRIVATE_boundCompareToDocument(a,l,u);return a.inclusive?d>=0:d>0})(n.endAt,__PRIVATE_queryNormalizedOrderBy(n),r))})(i,e)}function __PRIVATE_queryCollectionGroup(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function __PRIVATE_newQueryComparator(i){return(e,t)=>{let n=!1;for(const r of __PRIVATE_queryNormalizedOrderBy(i)){const s=__PRIVATE_compareDocs(r,e,t);if(s!==0)return s;n=n||r.field.isKeyField()}return 0}}function __PRIVATE_compareDocs(i,e,t){const n=i.field.isKeyField()?DocumentKey.comparator(e.key,t.key):(function(s,a,l){const u=a.data.field(s),d=l.data.field(s);return u!==null&&d!==null?__PRIVATE_valueCompare(u,d):fail(42886)})(i.field,e,t);switch(i.dir){case"asc":return n;case"desc":return-1*n;default:return fail(19790,{direction:i.dir})}}class ObjectMap{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[r,s]of n)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return n.length===1?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){forEach(this.inner,((t,n)=>{for(const[r,s]of n)e(r,s)}))}isEmpty(){return isEmpty(this.inner)}size(){return this.innerSize}}const Rt=new SortedMap(DocumentKey.comparator);function __PRIVATE_mutableDocumentMap(){return Rt}const Vt=new SortedMap(DocumentKey.comparator);function documentMap(...i){let e=Vt;for(const t of i)e=e.insert(t.key,t);return e}function __PRIVATE_convertOverlayedDocumentMapToDocumentMap(i){let e=Vt;return i.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function __PRIVATE_newOverlayMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newMutationMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newDocumentKeyMap(){return new ObjectMap((i=>i.toString()),((i,e)=>i.isEqual(e)))}const mt=new SortedMap(DocumentKey.comparator),ft=new SortedSet(DocumentKey.comparator);function __PRIVATE_documentKeySet(...i){let e=ft;for(const t of i)e=e.add(t);return e}const gt=new SortedSet(__PRIVATE_primitiveComparator);function __PRIVATE_targetIdSet(){return gt}function __PRIVATE_toDouble(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:__PRIVATE_isNegativeZero(e)?"-0":e}}function __PRIVATE_toInteger(i){return{integerValue:""+i}}function toNumber(i,e){return isSafeInteger(e)?__PRIVATE_toInteger(e):__PRIVATE_toDouble(i,e)}class TransformOperation{constructor(){this._=void 0}}function __PRIVATE_applyTransformOperationToLocalView(i,e,t){return i instanceof __PRIVATE_ServerTimestampTransform?(function(r,s){const a={fields:{[at]:{stringValue:_t},[ct]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&__PRIVATE_isServerTimestamp(s)&&(s=__PRIVATE_getPreviousValue(s)),s&&(a.fields[ut]=s),{mapValue:a}})(t,e):i instanceof __PRIVATE_ArrayUnionTransformOperation?__PRIVATE_applyArrayUnionTransformOperation(i,e):i instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_applyArrayRemoveTransformOperation(i,e):(function(r,s){const a=__PRIVATE_computeTransformOperationBaseValue(r,s),l=asNumber(a)+asNumber(r.Ae);return isInteger(a)&&isInteger(r.Ae)?__PRIVATE_toInteger(l):__PRIVATE_toDouble(r.serializer,l)})(i,e)}function __PRIVATE_applyTransformOperationToRemoteDocument(i,e,t){return i instanceof __PRIVATE_ArrayUnionTransformOperation?__PRIVATE_applyArrayUnionTransformOperation(i,e):i instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_applyArrayRemoveTransformOperation(i,e):t}function __PRIVATE_computeTransformOperationBaseValue(i,e){return i instanceof __PRIVATE_NumericIncrementTransformOperation?(function(n){return isInteger(n)||(function(s){return!!s&&"doubleValue"in s})(n)})(e)?e:{integerValue:0}:null}class __PRIVATE_ServerTimestampTransform extends TransformOperation{}class __PRIVATE_ArrayUnionTransformOperation extends TransformOperation{constructor(e){super(),this.elements=e}}function __PRIVATE_applyArrayUnionTransformOperation(i,e){const t=__PRIVATE_coercedFieldValuesArray(e);for(const n of i.elements)t.some((r=>__PRIVATE_valueEquals(r,n)))||t.push(n);return{arrayValue:{values:t}}}class __PRIVATE_ArrayRemoveTransformOperation extends TransformOperation{constructor(e){super(),this.elements=e}}function __PRIVATE_applyArrayRemoveTransformOperation(i,e){let t=__PRIVATE_coercedFieldValuesArray(e);for(const n of i.elements)t=t.filter((r=>!__PRIVATE_valueEquals(r,n)));return{arrayValue:{values:t}}}class __PRIVATE_NumericIncrementTransformOperation extends TransformOperation{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function asNumber(i){return __PRIVATE_normalizeNumber(i.integerValue||i.doubleValue)}function __PRIVATE_coercedFieldValuesArray(i){return isArray(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}class FieldTransform{constructor(e,t){this.field=e,this.transform=t}}function __PRIVATE_fieldTransformEquals(i,e){return i.field.isEqual(e.field)&&(function(n,r){return n instanceof __PRIVATE_ArrayUnionTransformOperation&&r instanceof __PRIVATE_ArrayUnionTransformOperation||n instanceof __PRIVATE_ArrayRemoveTransformOperation&&r instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_arrayEquals(n.elements,r.elements,__PRIVATE_valueEquals):n instanceof __PRIVATE_NumericIncrementTransformOperation&&r instanceof __PRIVATE_NumericIncrementTransformOperation?__PRIVATE_valueEquals(n.Ae,r.Ae):n instanceof __PRIVATE_ServerTimestampTransform&&r instanceof __PRIVATE_ServerTimestampTransform})(i.transform,e.transform)}class MutationResult{constructor(e,t){this.version=e,this.transformResults=t}}class Precondition{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Precondition}static exists(e){return new Precondition(void 0,e)}static updateTime(e){return new Precondition(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function __PRIVATE_preconditionIsValidForDocument(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}class Mutation{}function __PRIVATE_calculateOverlayMutation(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new __PRIVATE_DeleteMutation(i.key,Precondition.none()):new __PRIVATE_SetMutation(i.key,i.data,Precondition.none());{const t=i.data,n=ObjectValue.empty();let r=new SortedSet(FieldPath$1.comparator);for(let s of e.fields)if(!r.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?n.delete(s):n.set(s,a),r=r.add(s)}return new __PRIVATE_PatchMutation(i.key,n,new FieldMask(r.toArray()),Precondition.none())}}function __PRIVATE_mutationApplyToRemoteDocument(i,e,t){i instanceof __PRIVATE_SetMutation?(function(r,s,a){const l=r.value.clone(),u=__PRIVATE_serverTransformResults(r.fieldTransforms,s,a.transformResults);l.setAll(u),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(i,e,t):i instanceof __PRIVATE_PatchMutation?(function(r,s,a){if(!__PRIVATE_preconditionIsValidForDocument(r.precondition,s))return void s.convertToUnknownDocument(a.version);const l=__PRIVATE_serverTransformResults(r.fieldTransforms,s,a.transformResults),u=s.data;u.setAll(__PRIVATE_getPatch(r)),u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(i,e,t):(function(r,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function __PRIVATE_mutationApplyToLocalView(i,e,t,n){return i instanceof __PRIVATE_SetMutation?(function(s,a,l,u){if(!__PRIVATE_preconditionIsValidForDocument(s.precondition,a))return l;const d=s.value.clone(),h=__PRIVATE_localTransformResults(s.fieldTransforms,u,a);return d.setAll(h),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(i,e,t,n):i instanceof __PRIVATE_PatchMutation?(function(s,a,l,u){if(!__PRIVATE_preconditionIsValidForDocument(s.precondition,a))return l;const d=__PRIVATE_localTransformResults(s.fieldTransforms,u,a),h=a.data;return h.setAll(__PRIVATE_getPatch(s)),h.setAll(d),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),l===null?null:l.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map((p=>p.field)))})(i,e,t,n):(function(s,a,l){return __PRIVATE_preconditionIsValidForDocument(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(i,e,t)}function __PRIVATE_mutationExtractBaseValue(i,e){let t=null;for(const n of i.fieldTransforms){const r=e.data.field(n.field),s=__PRIVATE_computeTransformOperationBaseValue(n.transform,r||null);s!=null&&(t===null&&(t=ObjectValue.empty()),t.set(n.field,s))}return t||null}function __PRIVATE_mutationEquals(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!(function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&__PRIVATE_arrayEquals(n,r,((s,a)=>__PRIVATE_fieldTransformEquals(s,a)))})(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}class __PRIVATE_SetMutation extends Mutation{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class __PRIVATE_PatchMutation extends Mutation{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function __PRIVATE_getPatch(i){const e=new Map;return i.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const n=i.data.field(t);e.set(t,n)}})),e}function __PRIVATE_serverTransformResults(i,e,t){const n=new Map;__PRIVATE_hardAssert(i.length===t.length,32656,{Re:t.length,Ve:i.length});for(let r=0;r<t.length;r++){const s=i[r],a=s.transform,l=e.data.field(s.field);n.set(s.field,__PRIVATE_applyTransformOperationToRemoteDocument(a,l,t[r]))}return n}function __PRIVATE_localTransformResults(i,e,t){const n=new Map;for(const r of i){const s=r.transform,a=t.data.field(r.field);n.set(r.field,__PRIVATE_applyTransformOperationToLocalView(s,a,e))}return n}class __PRIVATE_DeleteMutation extends Mutation{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class __PRIVATE_VerifyMutation extends Mutation{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class MutationBatch{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&__PRIVATE_mutationApplyToRemoteDocument(s,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=__PRIVATE_mutationApplyToLocalView(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=__PRIVATE_mutationApplyToLocalView(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=__PRIVATE_newMutationMap();return this.mutations.forEach((r=>{const s=e.get(r.key),a=s.overlayedDocument;let l=this.applyToLocalView(a,s.mutatedFields);l=t.has(r.key)?null:l;const u=__PRIVATE_calculateOverlayMutation(a,l);u!==null&&n.set(r.key,u),a.isValidDocument()||a.convertToNoDocument(SnapshotVersion.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),__PRIVATE_documentKeySet())}isEqual(e){return this.batchId===e.batchId&&__PRIVATE_arrayEquals(this.mutations,e.mutations,((t,n)=>__PRIVATE_mutationEquals(t,n)))&&__PRIVATE_arrayEquals(this.baseMutations,e.baseMutations,((t,n)=>__PRIVATE_mutationEquals(t,n)))}}class MutationBatchResult{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){__PRIVATE_hardAssert(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=(function(){return mt})();const s=e.mutations;for(let a=0;a<s.length;a++)r=r.insert(s[a].key,n[a].version);return new MutationBatchResult(e,t,n,r)}}class Overlay{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class __PRIVATE_AggregateImpl{constructor(e,t,n){this.alias=e,this.aggregateType=t,this.fieldPath=n}}class ExistenceFilter{constructor(e,t){this.count=e,this.unchangedNames=t}}var pt,yt;function __PRIVATE_isPermanentError(i){switch(i){case N.OK:return fail(64938);case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0;default:return fail(15467,{code:i})}}function __PRIVATE_mapCodeFromRpcCode(i){if(i===void 0)return __PRIVATE_logError("GRPC error has no .code"),N.UNKNOWN;switch(i){case pt.OK:return N.OK;case pt.CANCELLED:return N.CANCELLED;case pt.UNKNOWN:return N.UNKNOWN;case pt.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case pt.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case pt.INTERNAL:return N.INTERNAL;case pt.UNAVAILABLE:return N.UNAVAILABLE;case pt.UNAUTHENTICATED:return N.UNAUTHENTICATED;case pt.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case pt.NOT_FOUND:return N.NOT_FOUND;case pt.ALREADY_EXISTS:return N.ALREADY_EXISTS;case pt.PERMISSION_DENIED:return N.PERMISSION_DENIED;case pt.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case pt.ABORTED:return N.ABORTED;case pt.OUT_OF_RANGE:return N.OUT_OF_RANGE;case pt.UNIMPLEMENTED:return N.UNIMPLEMENTED;case pt.DATA_LOSS:return N.DATA_LOSS;default:return fail(39323,{code:i})}}(yt=pt||(pt={}))[yt.OK=0]="OK",yt[yt.CANCELLED=1]="CANCELLED",yt[yt.UNKNOWN=2]="UNKNOWN",yt[yt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",yt[yt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",yt[yt.NOT_FOUND=5]="NOT_FOUND",yt[yt.ALREADY_EXISTS=6]="ALREADY_EXISTS",yt[yt.PERMISSION_DENIED=7]="PERMISSION_DENIED",yt[yt.UNAUTHENTICATED=16]="UNAUTHENTICATED",yt[yt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",yt[yt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",yt[yt.ABORTED=10]="ABORTED",yt[yt.OUT_OF_RANGE=11]="OUT_OF_RANGE",yt[yt.UNIMPLEMENTED=12]="UNIMPLEMENTED",yt[yt.INTERNAL=13]="INTERNAL",yt[yt.UNAVAILABLE=14]="UNAVAILABLE",yt[yt.DATA_LOSS=15]="DATA_LOSS";function __PRIVATE_newTextEncoder(){return new TextEncoder}const St=new Integer([4294967295,4294967295],0);function __PRIVATE_getMd5HashValue(i){const e=__PRIVATE_newTextEncoder().encode(i),t=new Md5;return t.update(e),new Uint8Array(t.digest())}function __PRIVATE_get64BitUints(i){const e=new DataView(i.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Integer([t,n],0),new Integer([r,s],0)]}class BloomFilter{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new __PRIVATE_BloomFilterError(`Invalid padding: ${t}`);if(n<0)throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new __PRIVATE_BloomFilterError(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Integer.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(Integer.fromNumber(n)));return r.compare(St)===1&&(r=new Integer([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=__PRIVATE_getMd5HashValue(e),[n,r]=__PRIVATE_get64BitUints(t);for(let s=0;s<this.hashCount;s++){const a=this.ye(n,r,s);if(!this.we(a))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new BloomFilter(s,r,t);return n.forEach((l=>a.insert(l))),a}insert(e){if(this.ge===0)return;const t=__PRIVATE_getMd5HashValue(e),[n,r]=__PRIVATE_get64BitUints(t);for(let s=0;s<this.hashCount;s++){const a=this.ye(n,r,s);this.Se(a)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class __PRIVATE_BloomFilterError extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class RemoteEvent{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,TargetChange.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new RemoteEvent(SnapshotVersion.min(),r,new SortedMap(__PRIVATE_primitiveComparator),__PRIVATE_mutableDocumentMap(),__PRIVATE_documentKeySet())}}class TargetChange{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new TargetChange(n,t,__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet())}}class __PRIVATE_DocumentWatchChange{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class __PRIVATE_ExistenceFilterChange{constructor(e,t){this.targetId=e,this.Ce=t}}class __PRIVATE_WatchTargetChange{constructor(e,t,n=ByteString.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class __PRIVATE_TargetState{constructor(){this.ve=0,this.Fe=__PRIVATE_snapshotChangesMap(),this.Me=ByteString.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=__PRIVATE_documentKeySet(),t=__PRIVATE_documentKeySet(),n=__PRIVATE_documentKeySet();return this.Fe.forEach(((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:fail(38017,{changeType:s})}})),new TargetChange(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=__PRIVATE_snapshotChangesMap()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,__PRIVATE_hardAssert(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class __PRIVATE_WatchChangeAggregator{constructor(e){this.Ge=e,this.ze=new Map,this.je=__PRIVATE_mutableDocumentMap(),this.Je=__PRIVATE_documentTargetMap(),this.He=__PRIVATE_documentTargetMap(),this.Ye=new SortedMap(__PRIVATE_primitiveComparator)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:fail(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((n,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){const s=r.target;if(__PRIVATE_targetIsDocumentTarget(s))if(n===0){const a=new DocumentKey(s.path);this.et(t,a,MutableDocument.newNoDocument(a,SnapshotVersion.min()))}else __PRIVATE_hardAssert(n===1,20013,{expectedCount:n});else{const a=this._t(t);if(a!==n){const l=this.ut(e),u=l?this.ct(l,e,a):1;if(u!==0){this.it(t);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=t;let a,l;try{a=__PRIVATE_normalizeByteString(n).toUint8Array()}catch(u){if(u instanceof __PRIVATE_Base64DecodeError)return __PRIVATE_logWarn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new BloomFilter(a,r,s)}catch(u){return __PRIVATE_logWarn(u instanceof __PRIVATE_BloomFilterError?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.ge===0?null:l}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let r=0;return n.forEach((s=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(l)||(this.et(t,s,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((s,a)=>{const l=this.ot(a);if(l){if(s.current&&__PRIVATE_targetIsDocumentTarget(l.target)){const u=new DocumentKey(l.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,MutableDocument.newNoDocument(u,e))}s.Be&&(t.set(a,s.ke()),s.qe())}}));let n=__PRIVATE_documentKeySet();this.He.forEach(((s,a)=>{let l=!0;a.forEachWhile((u=>{const d=this.ot(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(n=n.add(s))})),this.je.forEach(((s,a)=>a.setReadTime(e)));const r=new RemoteEvent(e,t,this.Ye,this.je,n);return this.je=__PRIVATE_mutableDocumentMap(),this.Je=__PRIVATE_documentTargetMap(),this.He=__PRIVATE_documentTargetMap(),this.Ye=new SortedMap(__PRIVATE_primitiveComparator),r}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new __PRIVATE_TargetState,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new SortedSet(__PRIVATE_primitiveComparator),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new SortedSet(__PRIVATE_primitiveComparator),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||__PRIVATE_logDebug("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new __PRIVATE_TargetState),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function __PRIVATE_documentTargetMap(){return new SortedMap(DocumentKey.comparator)}function __PRIVATE_snapshotChangesMap(){return new SortedMap(DocumentKey.comparator)}const bt={asc:"ASCENDING",desc:"DESCENDING"},Dt={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ct={and:"AND",or:"OR"};class JsonProtoSerializer{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function __PRIVATE_toInt32Proto(i,e){return i.useProto3Json||__PRIVATE_isNullOrUndefined(e)?e:{value:e}}function toTimestamp(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function __PRIVATE_toBytes(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function __PRIVATE_toVersion(i,e){return toTimestamp(i,e.toTimestamp())}function __PRIVATE_fromVersion(i){return __PRIVATE_hardAssert(!!i,49232),SnapshotVersion.fromTimestamp((function(t){const n=__PRIVATE_normalizeTimestamp(t);return new Timestamp(n.seconds,n.nanos)})(i))}function __PRIVATE_toResourceName(i,e){return __PRIVATE_toResourcePath(i,e).canonicalString()}function __PRIVATE_toResourcePath(i,e){const t=(function(r){return new ResourcePath(["projects",r.projectId,"databases",r.database])})(i).child("documents");return e===void 0?t:t.child(e)}function __PRIVATE_fromResourceName(i){const e=ResourcePath.fromString(i);return __PRIVATE_hardAssert(__PRIVATE_isValidResourceName(e),10190,{key:e.toString()}),e}function __PRIVATE_toName(i,e){return __PRIVATE_toResourceName(i.databaseId,e.path)}function fromName(i,e){const t=__PRIVATE_fromResourceName(e);if(t.get(1)!==i.databaseId.projectId)throw new FirestoreError(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new FirestoreError(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new DocumentKey(__PRIVATE_extractLocalPathFromResourceName(t))}function __PRIVATE_toQueryPath(i,e){return __PRIVATE_toResourceName(i.databaseId,e)}function __PRIVATE_fromQueryPath(i){const e=__PRIVATE_fromResourceName(i);return e.length===4?ResourcePath.emptyPath():__PRIVATE_extractLocalPathFromResourceName(e)}function __PRIVATE_getEncodedDatabaseId(i){return new ResourcePath(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function __PRIVATE_extractLocalPathFromResourceName(i){return __PRIVATE_hardAssert(i.length>4&&i.get(4)==="documents",29091,{key:i.toString()}),i.popFirst(5)}function __PRIVATE_toMutationDocument(i,e,t){return{name:__PRIVATE_toName(i,e),fields:t.value.mapValue.fields}}function __PRIVATE_fromWatchChange(i,e){let t;if("targetChange"in e){e.targetChange;const n=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:fail(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=(function(d,h){return d.useProto3Json?(__PRIVATE_hardAssert(h===void 0||typeof h=="string",58123),ByteString.fromBase64String(h||"")):(__PRIVATE_hardAssert(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),ByteString.fromUint8Array(h||new Uint8Array))})(i,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&(function(d){const h=d.code===void 0?N.UNKNOWN:__PRIVATE_mapCodeFromRpcCode(d.code);return new FirestoreError(h,d.message||"")})(a);t=new __PRIVATE_WatchTargetChange(n,r,s,l||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const r=fromName(i,n.document.name),s=__PRIVATE_fromVersion(n.document.updateTime),a=n.document.createTime?__PRIVATE_fromVersion(n.document.createTime):SnapshotVersion.min(),l=new ObjectValue({mapValue:{fields:n.document.fields}}),u=MutableDocument.newFoundDocument(r,s,a,l),d=n.targetIds||[],h=n.removedTargetIds||[];t=new __PRIVATE_DocumentWatchChange(d,h,u.key,u)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const r=fromName(i,n.document),s=n.readTime?__PRIVATE_fromVersion(n.readTime):SnapshotVersion.min(),a=MutableDocument.newNoDocument(r,s),l=n.removedTargetIds||[];t=new __PRIVATE_DocumentWatchChange([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const r=fromName(i,n.document),s=n.removedTargetIds||[];t=new __PRIVATE_DocumentWatchChange([],s,r,null)}else{if(!("filter"in e))return fail(11601,{Rt:e});{e.filter;const n=e.filter;n.targetId;const{count:r=0,unchangedNames:s}=n,a=new ExistenceFilter(r,s),l=n.targetId;t=new __PRIVATE_ExistenceFilterChange(l,a)}}return t}function toMutation(i,e){let t;if(e instanceof __PRIVATE_SetMutation)t={update:__PRIVATE_toMutationDocument(i,e.key,e.value)};else if(e instanceof __PRIVATE_DeleteMutation)t={delete:__PRIVATE_toName(i,e.key)};else if(e instanceof __PRIVATE_PatchMutation)t={update:__PRIVATE_toMutationDocument(i,e.key,e.data),updateMask:__PRIVATE_toDocumentMask(e.fieldMask)};else{if(!(e instanceof __PRIVATE_VerifyMutation))return fail(16599,{Vt:e.type});t={verify:__PRIVATE_toName(i,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((n=>(function(s,a){const l=a.transform;if(l instanceof __PRIVATE_ServerTimestampTransform)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof __PRIVATE_ArrayUnionTransformOperation)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof __PRIVATE_ArrayRemoveTransformOperation)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof __PRIVATE_NumericIncrementTransformOperation)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw fail(20930,{transform:a.transform})})(0,n)))),e.precondition.isNone||(t.currentDocument=(function(r,s){return s.updateTime!==void 0?{updateTime:__PRIVATE_toVersion(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:fail(27497)})(i,e.precondition)),t}function __PRIVATE_fromWriteResults(i,e){return i&&i.length>0?(__PRIVATE_hardAssert(e!==void 0,14353),i.map((t=>(function(r,s){let a=r.updateTime?__PRIVATE_fromVersion(r.updateTime):__PRIVATE_fromVersion(s);return a.isEqual(SnapshotVersion.min())&&(a=__PRIVATE_fromVersion(s)),new MutationResult(a,r.transformResults||[])})(t,e)))):[]}function __PRIVATE_toDocumentsTarget(i,e){return{documents:[__PRIVATE_toQueryPath(i,e.path)]}}function __PRIVATE_toQueryTarget(i,e){const t={structuredQuery:{}},n=e.path;let r;e.collectionGroup!==null?(r=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=__PRIVATE_toQueryPath(i,r);const s=(function(d){if(d.length!==0)return __PRIVATE_toFilter(CompositeFilter.create(d,"and"))})(e.filters);s&&(t.structuredQuery.where=s);const a=(function(d){if(d.length!==0)return d.map((h=>(function(m){return{field:__PRIVATE_toFieldPathReference(m.field),direction:__PRIVATE_toDirection(m.dir)}})(h)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=__PRIVATE_toInt32Proto(i,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:r}}function __PRIVATE_toRunAggregationQueryRequest(i,e,t,n){const{ft:r,parent:s}=__PRIVATE_toQueryTarget(i,e),a={},l=[];let u=0;return t.forEach((d=>{const h="aggregate_"+u++;a[h]=d.alias,d.aggregateType==="count"?l.push({alias:h,count:{}}):d.aggregateType==="avg"?l.push({alias:h,avg:{field:__PRIVATE_toFieldPathReference(d.fieldPath)}}):d.aggregateType==="sum"&&l.push({alias:h,sum:{field:__PRIVATE_toFieldPathReference(d.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:l,structuredQuery:r.structuredQuery},parent:r.parent},gt:a,parent:s}}function __PRIVATE_convertQueryTargetToQuery(i){let e=__PRIVATE_fromQueryPath(i.parent);const t=i.structuredQuery,n=t.from?t.from.length:0;let r=null;if(n>0){__PRIVATE_hardAssert(n===1,65062);const h=t.from[0];h.allDescendants?r=h.collectionId:e=e.child(h.collectionId)}let s=[];t.where&&(s=(function(p){const m=__PRIVATE_fromFilter(p);return m instanceof CompositeFilter&&__PRIVATE_compositeFilterIsFlatConjunction(m)?m.getFilters():[m]})(t.where));let a=[];t.orderBy&&(a=(function(p){return p.map((m=>(function(v){return new OrderBy(__PRIVATE_fromFieldPathReference(v.field),(function(b){switch(b){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(v.direction))})(m)))})(t.orderBy));let l=null;t.limit&&(l=(function(p){let m;return m=typeof p=="object"?p.value:p,__PRIVATE_isNullOrUndefined(m)?null:m})(t.limit));let u=null;t.startAt&&(u=(function(p){const m=!!p.before,g=p.values||[];return new Bound(g,m)})(t.startAt));let d=null;return t.endAt&&(d=(function(p){const m=!p.before,g=p.values||[];return new Bound(g,m)})(t.endAt)),__PRIVATE_newQuery(e,r,a,s,l,"F",u,d)}function __PRIVATE_toListenRequestLabels(i,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fail(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function __PRIVATE_fromFilter(i){return i.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=__PRIVATE_fromFieldPathReference(t.unaryFilter.field);return FieldFilter.create(n,"==",{doubleValue:NaN});case"IS_NULL":const r=__PRIVATE_fromFieldPathReference(t.unaryFilter.field);return FieldFilter.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=__PRIVATE_fromFieldPathReference(t.unaryFilter.field);return FieldFilter.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=__PRIVATE_fromFieldPathReference(t.unaryFilter.field);return FieldFilter.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return fail(61313);default:return fail(60726)}})(i):i.fieldFilter!==void 0?(function(t){return FieldFilter.create(__PRIVATE_fromFieldPathReference(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return fail(58110);default:return fail(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(i):i.compositeFilter!==void 0?(function(t){return CompositeFilter.create(t.compositeFilter.filters.map((n=>__PRIVATE_fromFilter(n))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return fail(1026)}})(t.compositeFilter.op))})(i):fail(30097,{filter:i})}function __PRIVATE_toDirection(i){return bt[i]}function __PRIVATE_toOperatorName(i){return Dt[i]}function __PRIVATE_toCompositeOperatorName(i){return Ct[i]}function __PRIVATE_toFieldPathReference(i){return{fieldPath:i.canonicalString()}}function __PRIVATE_fromFieldPathReference(i){return FieldPath$1.fromServerFormat(i.fieldPath)}function __PRIVATE_toFilter(i){return i instanceof FieldFilter?(function(t){if(t.op==="=="){if(__PRIVATE_isNanValue(t.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:"IS_NAN"}};if(__PRIVATE_isNullValue(t.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(__PRIVATE_isNanValue(t.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:"IS_NOT_NAN"}};if(__PRIVATE_isNullValue(t.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:__PRIVATE_toOperatorName(t.op),value:t.value}}})(i):i instanceof CompositeFilter?(function(t){const n=t.getFilters().map((r=>__PRIVATE_toFilter(r)));return n.length===1?n[0]:{compositeFilter:{op:__PRIVATE_toCompositeOperatorName(t.op),filters:n}}})(i):fail(54877,{filter:i})}function __PRIVATE_toDocumentMask(i){const e=[];return i.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function __PRIVATE_isValidResourceName(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}class TargetData{constructor(e,t,n,r,s=SnapshotVersion.min(),a=SnapshotVersion.min(),l=ByteString.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new TargetData(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class __PRIVATE_LocalSerializer{constructor(e){this.yt=e}}function __PRIVATE_fromBundledQuery(i){const e=__PRIVATE_convertQueryTargetToQuery({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?__PRIVATE_queryWithLimit(e,e.limit,"L"):e}class __PRIVATE_MemoryIndexManager{constructor(){this.Cn=new __PRIVATE_MemoryCollectionParentIndex}addToCollectionParentIndex(e,t){return this.Cn.add(t),PersistencePromise.resolve()}getCollectionParents(e,t){return PersistencePromise.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return PersistencePromise.resolve()}deleteFieldIndex(e,t){return PersistencePromise.resolve()}deleteAllFieldIndexes(e){return PersistencePromise.resolve()}createTargetIndexes(e,t){return PersistencePromise.resolve()}getDocumentsMatchingTarget(e,t){return PersistencePromise.resolve(null)}getIndexType(e,t){return PersistencePromise.resolve(0)}getFieldIndexes(e,t){return PersistencePromise.resolve([])}getNextCollectionGroupToUpdate(e){return PersistencePromise.resolve(null)}getMinOffset(e,t){return PersistencePromise.resolve(IndexOffset.min())}getMinOffsetFromCollectionGroup(e,t){return PersistencePromise.resolve(IndexOffset.min())}updateCollectionGroup(e,t,n){return PersistencePromise.resolve()}updateIndexEntries(e,t){return PersistencePromise.resolve()}}class __PRIVATE_MemoryCollectionParentIndex{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new SortedSet(ResourcePath.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new SortedSet(ResourcePath.comparator)).toArray()}}const xt={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ot=41943040;class LruParams{static withCacheSize(e){return new LruParams(e,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}LruParams.DEFAULT_COLLECTION_PERCENTILE=10,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,LruParams.DEFAULT=new LruParams(Ot,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),LruParams.DISABLED=new LruParams(-1,0,0);class __PRIVATE_TargetIdGenerator{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new __PRIVATE_TargetIdGenerator(0)}static cr(){return new __PRIVATE_TargetIdGenerator(-1)}}const Nt="LruGarbageCollector",Bt=1048576;function __PRIVATE_bufferEntryComparator([i,e],[t,n]){const r=__PRIVATE_primitiveComparator(i,t);return r===0?__PRIVATE_primitiveComparator(e,n):r}class __PRIVATE_RollingSequenceNumberBuffer{constructor(e){this.Ir=e,this.buffer=new SortedSet(__PRIVATE_bufferEntryComparator),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();__PRIVATE_bufferEntryComparator(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class __PRIVATE_LruScheduler{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){__PRIVATE_logDebug(Nt,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){__PRIVATE_isIndexedDbTransactionError(t)?__PRIVATE_logDebug(Nt,"Ignoring IndexedDB error during garbage collection: ",t):await __PRIVATE_ignoreIfPrimaryLeaseLoss(t)}await this.Vr(3e5)}))}}class __PRIVATE_LruGarbageCollectorImpl{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((n=>Math.floor(t/100*n)))}nthSequenceNumber(e,t){if(t===0)return PersistencePromise.resolve(__PRIVATE_ListenSequence.ce);const n=new __PRIVATE_RollingSequenceNumberBuffer(t);return this.mr.forEachTarget(e,(r=>n.Ar(r.sequenceNumber))).next((()=>this.mr.pr(e,(r=>n.Ar(r))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(__PRIVATE_logDebug("LruGarbageCollector","Garbage collection skipped; disabled"),PersistencePromise.resolve(xt)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(__PRIVATE_logDebug("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),xt):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,s,a,l,u,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((p=>(p>this.params.maximumSequenceNumbersToCollect?(__PRIVATE_logDebug("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),r=this.params.maximumSequenceNumbersToCollect):r=p,a=Date.now(),this.nthSequenceNumber(e,r)))).next((p=>(n=p,l=Date.now(),this.removeTargets(e,n,t)))).next((p=>(s=p,u=Date.now(),this.removeOrphanedDocuments(e,n)))).next((p=>(d=Date.now(),__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${r} in `+(l-a)+`ms
	Removed ${s} targets in `+(u-l)+`ms
	Removed ${p} documents in `+(d-u)+`ms
Total Duration: ${d-h}ms`),PersistencePromise.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:p}))))}}function __PRIVATE_newLruGarbageCollector(i,e){return new __PRIVATE_LruGarbageCollectorImpl(i,e)}class RemoteDocumentChangeBuffer{constructor(){this.changes=new ObjectMap((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,MutableDocument.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?PersistencePromise.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class OverlayedDocument{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class LocalDocumentsView{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(n!==null&&__PRIVATE_mutationApplyToLocalView(n.mutation,r,FieldMask.empty(),Timestamp.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.getLocalViewOfDocuments(e,n,__PRIVATE_documentKeySet()).next((()=>n))))}getLocalViewOfDocuments(e,t,n=__PRIVATE_documentKeySet()){const r=__PRIVATE_newOverlayMap();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((s=>{let a=documentMap();return s.forEach(((l,u)=>{a=a.insert(l,u.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const n=__PRIVATE_newOverlayMap();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,__PRIVATE_documentKeySet())))}populateOverlays(e,t,n){const r=[];return n.forEach((s=>{t.has(s)||r.push(s)})),this.documentOverlayCache.getOverlays(e,r).next((s=>{s.forEach(((a,l)=>{t.set(a,l)}))}))}computeViews(e,t,n,r){let s=__PRIVATE_mutableDocumentMap();const a=__PRIVATE_newDocumentKeyMap(),l=(function(){return __PRIVATE_newDocumentKeyMap()})();return t.forEach(((u,d)=>{const h=n.get(d.key);r.has(d.key)&&(h===void 0||h.mutation instanceof __PRIVATE_PatchMutation)?s=s.insert(d.key,d):h!==void 0?(a.set(d.key,h.mutation.getFieldMask()),__PRIVATE_mutationApplyToLocalView(h.mutation,d,h.mutation.getFieldMask(),Timestamp.now())):a.set(d.key,FieldMask.empty())})),this.recalculateAndSaveOverlays(e,s).next((u=>(u.forEach(((d,h)=>a.set(d,h))),t.forEach(((d,h)=>l.set(d,new OverlayedDocument(h,a.get(d)??null)))),l)))}recalculateAndSaveOverlays(e,t){const n=__PRIVATE_newDocumentKeyMap();let r=new SortedMap(((a,l)=>a-l)),s=__PRIVATE_documentKeySet();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const l of a)l.keys().forEach((u=>{const d=t.get(u);if(d===null)return;let h=n.get(u)||FieldMask.empty();h=l.applyToLocalView(d,h),n.set(u,h);const p=(r.get(l.batchId)||__PRIVATE_documentKeySet()).add(u);r=r.insert(l.batchId,p)}))})).next((()=>{const a=[],l=r.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),d=u.key,h=u.value,p=__PRIVATE_newMutationMap();h.forEach((m=>{if(!s.has(m)){const g=__PRIVATE_calculateOverlayMutation(t.get(m),n.get(m));g!==null&&p.set(m,g),s=s.add(m)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,p))}return PersistencePromise.waitFor(a)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.recalculateAndSaveOverlays(e,n)))}getDocumentsMatchingQuery(e,t,n,r){return(function(a){return DocumentKey.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):__PRIVATE_isCollectionGroupQuery(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((s=>{const a=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):PersistencePromise.resolve(__PRIVATE_newOverlayMap());let l=U,u=s;return a.next((d=>PersistencePromise.forEach(d,((h,p)=>(l<p.largestBatchId&&(l=p.largestBatchId),s.get(h)?PersistencePromise.resolve():this.remoteDocumentCache.getEntry(e,h).next((m=>{u=u.insert(h,m)}))))).next((()=>this.populateOverlays(e,d,s))).next((()=>this.computeViews(e,u,d,__PRIVATE_documentKeySet()))).next((h=>({batchId:l,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap(h)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new DocumentKey(t)).next((n=>{let r=documentMap();return n.isFoundDocument()&&(r=r.insert(n.key,n)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const s=t.collectionGroup;let a=documentMap();return this.indexManager.getCollectionParents(e,s).next((l=>PersistencePromise.forEach(l,(u=>{const d=(function(p,m){return new __PRIVATE_QueryImpl(m,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,d,n,r).next((h=>{h.forEach(((p,m)=>{a=a.insert(p,m)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,r)))).next((a=>{s.forEach(((u,d)=>{const h=d.getKey();a.get(h)===null&&(a=a.insert(h,MutableDocument.newInvalidDocument(h)))}));let l=documentMap();return a.forEach(((u,d)=>{const h=s.get(u);h!==void 0&&__PRIVATE_mutationApplyToLocalView(h.mutation,d,FieldMask.empty(),Timestamp.now()),__PRIVATE_queryMatches(t,d)&&(l=l.insert(u,d))})),l}))}}class __PRIVATE_MemoryBundleCache{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return PersistencePromise.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:__PRIVATE_fromVersion(r.createTime)}})(t)),PersistencePromise.resolve()}getNamedQuery(e,t){return PersistencePromise.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(r){return{name:r.name,query:__PRIVATE_fromBundledQuery(r.bundledQuery),readTime:__PRIVATE_fromVersion(r.readTime)}})(t)),PersistencePromise.resolve()}}class __PRIVATE_MemoryDocumentOverlayCache{constructor(){this.overlays=new SortedMap(DocumentKey.comparator),this.qr=new Map}getOverlay(e,t){return PersistencePromise.resolve(this.overlays.get(t))}getOverlays(e,t){const n=__PRIVATE_newOverlayMap();return PersistencePromise.forEach(t,(r=>this.getOverlay(e,r).next((s=>{s!==null&&n.set(r,s)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((r,s)=>{this.St(e,t,s)})),PersistencePromise.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.qr.get(n);return r!==void 0&&(r.forEach((s=>this.overlays=this.overlays.remove(s))),this.qr.delete(n)),PersistencePromise.resolve()}getOverlaysForCollection(e,t,n){const r=__PRIVATE_newOverlayMap(),s=t.length+1,a=new DocumentKey(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,d=u.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===s&&u.largestBatchId>n&&r.set(u.getKey(),u)}return PersistencePromise.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new SortedMap(((d,h)=>d-h));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>n){let h=s.get(d.largestBatchId);h===null&&(h=__PRIVATE_newOverlayMap(),s=s.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const l=__PRIVATE_newOverlayMap(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((d,h)=>l.set(d,h))),!(l.size()>=r)););return PersistencePromise.resolve(l)}St(e,t,n){const r=this.overlays.get(n.key);if(r!==null){const a=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Overlay(t,n));let s=this.qr.get(t);s===void 0&&(s=__PRIVATE_documentKeySet(),this.qr.set(t,s)),this.qr.set(t,s.add(n.key))}}class __PRIVATE_MemoryGlobalsCache{constructor(){this.sessionToken=ByteString.EMPTY_BYTE_STRING}getSessionToken(e){return PersistencePromise.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,PersistencePromise.resolve()}}class __PRIVATE_ReferenceSet{constructor(){this.Qr=new SortedSet(__PRIVATE_DocReference.$r),this.Ur=new SortedSet(__PRIVATE_DocReference.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new __PRIVATE_DocReference(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach((n=>this.addReference(n,t)))}removeReference(e,t){this.Gr(new __PRIVATE_DocReference(e,t))}zr(e,t){e.forEach((n=>this.removeReference(n,t)))}jr(e){const t=new DocumentKey(new ResourcePath([])),n=new __PRIVATE_DocReference(t,e),r=new __PRIVATE_DocReference(t,e+1),s=[];return this.Ur.forEachInRange([n,r],(a=>{this.Gr(a),s.push(a.key)})),s}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new DocumentKey(new ResourcePath([])),n=new __PRIVATE_DocReference(t,e),r=new __PRIVATE_DocReference(t,e+1);let s=__PRIVATE_documentKeySet();return this.Ur.forEachInRange([n,r],(a=>{s=s.add(a.key)})),s}containsKey(e){const t=new __PRIVATE_DocReference(e,0),n=this.Qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class __PRIVATE_DocReference{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return DocumentKey.comparator(e.key,t.key)||__PRIVATE_primitiveComparator(e.Yr,t.Yr)}static Kr(e,t){return __PRIVATE_primitiveComparator(e.Yr,t.Yr)||DocumentKey.comparator(e.key,t.key)}}class __PRIVATE_MemoryMutationQueue{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new SortedSet(__PRIVATE_DocReference.$r)}checkEmpty(e){return PersistencePromise.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,r){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new MutationBatch(s,t,n,r);this.mutationQueue.push(a);for(const l of r)this.Zr=this.Zr.add(new __PRIVATE_DocReference(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return PersistencePromise.resolve(a)}lookupMutationBatch(e,t){return PersistencePromise.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ei(n),s=r<0?0:r;return PersistencePromise.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return PersistencePromise.resolve(this.mutationQueue.length===0?j:this.tr-1)}getAllMutationBatches(e){return PersistencePromise.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new __PRIVATE_DocReference(t,0),r=new __PRIVATE_DocReference(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,r],(a=>{const l=this.Xr(a.Yr);s.push(l)})),PersistencePromise.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new SortedSet(__PRIVATE_primitiveComparator);return t.forEach((r=>{const s=new __PRIVATE_DocReference(r,0),a=new __PRIVATE_DocReference(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,a],(l=>{n=n.add(l.Yr)}))})),PersistencePromise.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;DocumentKey.isDocumentKey(s)||(s=s.child(""));const a=new __PRIVATE_DocReference(new DocumentKey(s),0);let l=new SortedSet(__PRIVATE_primitiveComparator);return this.Zr.forEachWhile((u=>{const d=u.key.path;return!!n.isPrefixOf(d)&&(d.length===r&&(l=l.add(u.Yr)),!0)}),a),PersistencePromise.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((n=>{const r=this.Xr(n);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){__PRIVATE_hardAssert(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return PersistencePromise.forEach(t.mutations,(r=>{const s=new __PRIVATE_DocReference(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,t){const n=new __PRIVATE_DocReference(t,0),r=this.Zr.firstAfterOrEqual(n);return PersistencePromise.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,PersistencePromise.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class __PRIVATE_MemoryRemoteDocumentCacheImpl{constructor(e){this.ri=e,this.docs=(function(){return new SortedMap(DocumentKey.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,a=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return PersistencePromise.resolve(n?n.document.mutableCopy():MutableDocument.newInvalidDocument(t))}getEntries(e,t){let n=__PRIVATE_mutableDocumentMap();return t.forEach((r=>{const s=this.docs.get(r);n=n.insert(r,s?s.document.mutableCopy():MutableDocument.newInvalidDocument(r))})),PersistencePromise.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=__PRIVATE_mutableDocumentMap();const a=t.path,l=new DocumentKey(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:d,value:{document:h}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||__PRIVATE_indexOffsetComparator(__PRIVATE_newIndexOffsetFromDocument(h),n)<=0||(r.has(h.key)||__PRIVATE_queryMatches(t,h))&&(s=s.insert(h.key,h.mutableCopy()))}return PersistencePromise.resolve(s)}getAllFromCollectionGroup(e,t,n,r){fail(9500)}ii(e,t){return PersistencePromise.forEach(this.docs,(n=>t(n)))}newChangeBuffer(e){return new __PRIVATE_MemoryRemoteDocumentChangeBuffer(this)}getSize(e){return PersistencePromise.resolve(this.size)}}class __PRIVATE_MemoryRemoteDocumentChangeBuffer extends RemoteDocumentChangeBuffer{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)})),PersistencePromise.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class __PRIVATE_MemoryTargetCache{constructor(e){this.persistence=e,this.si=new ObjectMap((t=>__PRIVATE_canonifyTarget(t)),__PRIVATE_targetEquals),this.lastRemoteSnapshotVersion=SnapshotVersion.min(),this.highestTargetId=0,this.oi=0,this._i=new __PRIVATE_ReferenceSet,this.targetCount=0,this.ai=__PRIVATE_TargetIdGenerator.ur()}forEachTarget(e,t){return this.si.forEach(((n,r)=>t(r))),PersistencePromise.resolve()}getLastRemoteSnapshotVersion(e){return PersistencePromise.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return PersistencePromise.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),PersistencePromise.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),PersistencePromise.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new __PRIVATE_TargetIdGenerator(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,PersistencePromise.resolve()}updateTargetData(e,t){return this.Pr(t),PersistencePromise.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,PersistencePromise.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.si.forEach(((a,l)=>{l.sequenceNumber<=t&&n.get(l.targetId)===null&&(this.si.delete(a),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),r++)})),PersistencePromise.waitFor(s).next((()=>r))}getTargetCount(e){return PersistencePromise.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return PersistencePromise.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),PersistencePromise.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach((a=>{s.push(r.markPotentiallyOrphaned(e,a))})),PersistencePromise.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),PersistencePromise.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return PersistencePromise.resolve(n)}containsKey(e,t){return PersistencePromise.resolve(this._i.containsKey(t))}}class __PRIVATE_MemoryPersistence{constructor(e,t){this.ui={},this.overlays={},this.ci=new __PRIVATE_ListenSequence(0),this.li=!1,this.li=!0,this.hi=new __PRIVATE_MemoryGlobalsCache,this.referenceDelegate=e(this),this.Pi=new __PRIVATE_MemoryTargetCache(this),this.indexManager=new __PRIVATE_MemoryIndexManager,this.remoteDocumentCache=(function(r){return new __PRIVATE_MemoryRemoteDocumentCacheImpl(r)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new __PRIVATE_LocalSerializer(t),this.Ii=new __PRIVATE_MemoryBundleCache(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new __PRIVATE_MemoryDocumentOverlayCache,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new __PRIVATE_MemoryMutationQueue(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){__PRIVATE_logDebug("MemoryPersistence","Starting transaction:",e);const r=new __PRIVATE_MemoryTransaction(this.ci.next());return this.referenceDelegate.Ei(),n(r).next((s=>this.referenceDelegate.di(r).next((()=>s)))).toPromise().then((s=>(r.raiseOnCommittedEvent(),s)))}Ai(e,t){return PersistencePromise.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,t))))}}class __PRIVATE_MemoryTransaction extends PersistenceTransaction{constructor(e){super(),this.currentSequenceNumber=e}}class __PRIVATE_MemoryEagerDelegate{constructor(e){this.persistence=e,this.Ri=new __PRIVATE_ReferenceSet,this.Vi=null}static mi(e){return new __PRIVATE_MemoryEagerDelegate(e)}get fi(){if(this.Vi)return this.Vi;throw fail(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),PersistencePromise.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),PersistencePromise.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),PersistencePromise.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((r=>this.fi.add(r.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((s=>this.fi.add(s.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return PersistencePromise.forEach(this.fi,(n=>{const r=DocumentKey.fromPath(n);return this.gi(e,r).next((s=>{s||t.removeEntry(r,SnapshotVersion.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return PersistencePromise.or([()=>PersistencePromise.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class __PRIVATE_MemoryLruDelegate{constructor(e,t){this.persistence=e,this.pi=new ObjectMap((n=>__PRIVATE_encodeResourcePath(n.path)),((n,r)=>n.isEqual(r))),this.garbageCollector=__PRIVATE_newLruGarbageCollector(this,t)}static mi(e,t){return new __PRIVATE_MemoryLruDelegate(e,t)}Ei(){}di(e){return PersistencePromise.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((n=>t.next((r=>n+r))))}wr(e){let t=0;return this.pr(e,(n=>{t++})).next((()=>t))}pr(e,t){return PersistencePromise.forEach(this.pi,((n,r)=>this.br(e,n,r).next((s=>s?PersistencePromise.resolve():t(r)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.ii(e,(a=>this.br(e,a,t).next((l=>{l||(n++,s.removeEntry(a,SnapshotVersion.min()))})))).next((()=>s.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),PersistencePromise.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),PersistencePromise.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),PersistencePromise.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),PersistencePromise.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=__PRIVATE_estimateByteSize(e.data.value)),t}br(e,t,n){return PersistencePromise.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return PersistencePromise.resolve(r!==void 0&&r>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class __PRIVATE_LocalViewChanges{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=__PRIVATE_documentKeySet(),r=__PRIVATE_documentKeySet();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new __PRIVATE_LocalViewChanges(e,t.fromCache,n,r)}}class QueryContext{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class __PRIVATE_QueryEngine{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return isSafari()?8:__PRIVATE_getAndroidVersion(getUA())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){const s={result:null};return this.ys(e,t).next((a=>{s.result=a})).next((()=>{if(!s.result)return this.ws(e,t,r,n).next((a=>{s.result=a}))})).next((()=>{if(s.result)return;const a=new QueryContext;return this.Ss(e,t,a).next((l=>{if(s.result=l,this.Vs)return this.bs(e,t,a,l.size)}))})).next((()=>s.result))}bs(e,t,n,r){return n.documentReadCount<this.fs?(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","SDK will not create cache indexes for query:",__PRIVATE_stringifyQuery(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),PersistencePromise.resolve()):(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Query:",__PRIVATE_stringifyQuery(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","The SDK decides to create cache indexes for query:",__PRIVATE_stringifyQuery(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,__PRIVATE_queryToTarget(t))):PersistencePromise.resolve())}ys(e,t){if(__PRIVATE_queryMatchesAllDocuments(t))return PersistencePromise.resolve(null);let n=__PRIVATE_queryToTarget(t);return this.indexManager.getIndexType(e,n).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=__PRIVATE_queryWithLimit(t,null,"F"),n=__PRIVATE_queryToTarget(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((s=>{const a=__PRIVATE_documentKeySet(...s);return this.ps.getDocuments(e,a).next((l=>this.indexManager.getMinOffset(e,n).next((u=>{const d=this.Ds(t,l);return this.Cs(t,d,a,u.readTime)?this.ys(e,__PRIVATE_queryWithLimit(t,null,"F")):this.vs(e,d,t,u)}))))})))))}ws(e,t,n,r){return __PRIVATE_queryMatchesAllDocuments(t)||r.isEqual(SnapshotVersion.min())?PersistencePromise.resolve(null):this.ps.getDocuments(e,n).next((s=>{const a=this.Ds(t,s);return this.Cs(t,a,n,r)?PersistencePromise.resolve(null):(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),__PRIVATE_stringifyQuery(t)),this.vs(e,a,t,__PRIVATE_newIndexOffsetSuccessorFromReadTime(r,U)).next((l=>l)))}))}Ds(e,t){let n=new SortedSet(__PRIVATE_newQueryComparator(e));return t.forEach(((r,s)=>{__PRIVATE_queryMatches(e,s)&&(n=n.add(s))})),n}Cs(e,t,n,r){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ss(e,t,n){return __PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Using full collection scan to execute query:",__PRIVATE_stringifyQuery(t)),this.ps.getDocumentsMatchingQuery(e,t,IndexOffset.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next((s=>(t.forEach((a=>{s=s.insert(a.key,a)})),s)))}}const Ut="LocalStore",Kt=3e8;class __PRIVATE_LocalStoreImpl{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new SortedMap(__PRIVATE_primitiveComparator),this.xs=new ObjectMap((s=>__PRIVATE_canonifyTarget(s)),__PRIVATE_targetEquals),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new LocalDocumentsView(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function __PRIVATE_newLocalStore(i,e,t,n){return new __PRIVATE_LocalStoreImpl(i,e,t,n)}async function __PRIVATE_localStoreHandleUserChange(i,e){const t=__PRIVATE_debugCast(i);return await t.persistence.runTransaction("Handle user change","readonly",(n=>{let r;return t.mutationQueue.getAllMutationBatches(n).next((s=>(r=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(n)))).next((s=>{const a=[],l=[];let u=__PRIVATE_documentKeySet();for(const d of r){a.push(d.batchId);for(const h of d.mutations)u=u.add(h.key)}for(const d of s){l.push(d.batchId);for(const h of d.mutations)u=u.add(h.key)}return t.localDocuments.getDocuments(n,u).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:l})))}))}))}function __PRIVATE_localStoreAcknowledgeBatch(i,e){const t=__PRIVATE_debugCast(i);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const r=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,u,d,h){const p=d.batch,m=p.keys();let g=PersistencePromise.resolve();return m.forEach((v=>{g=g.next((()=>h.getEntry(u,v))).next((_=>{const b=d.docVersions.get(v);__PRIVATE_hardAssert(b!==null,48541),_.version.compareTo(b)<0&&(p.applyToRemoteDocument(_,d),_.isValidDocument()&&(_.setReadTime(d.commitVersion),h.addEntry(_)))}))})),g.next((()=>l.mutationQueue.removeMutationBatch(u,p)))})(t,n,e,s).next((()=>s.apply(n))).next((()=>t.mutationQueue.performConsistencyCheck(n))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(n,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(l){let u=__PRIVATE_documentKeySet();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(u=u.add(l.batch.mutations[d].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(n,r)))}))}function __PRIVATE_localStoreGetLastRemoteSnapshotVersion(i){const e=__PRIVATE_debugCast(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function __PRIVATE_localStoreApplyRemoteEventToLocalCache(i,e){const t=__PRIVATE_debugCast(i),n=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(s=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const l=[];e.targetChanges.forEach(((h,p)=>{const m=r.get(p);if(!m)return;l.push(t.Pi.removeMatchingKeys(s,h.removedDocuments,p).next((()=>t.Pi.addMatchingKeys(s,h.addedDocuments,p))));let g=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?g=g.withResumeToken(ByteString.EMPTY_BYTE_STRING,SnapshotVersion.min()).withLastLimboFreeSnapshotVersion(SnapshotVersion.min()):h.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(h.resumeToken,n)),r=r.insert(p,g),(function(_,b,E){return _.resumeToken.approximateByteSize()===0||b.snapshotVersion.toMicroseconds()-_.snapshotVersion.toMicroseconds()>=Kt?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0})(m,g,h)&&l.push(t.Pi.updateTargetData(s,g))}));let u=__PRIVATE_mutableDocumentMap(),d=__PRIVATE_documentKeySet();if(e.documentUpdates.forEach((h=>{e.resolvedLimboDocuments.has(h)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,h))})),l.push(__PRIVATE_populateDocumentChangeBuffer(s,a,e.documentUpdates).next((h=>{u=h.ks,d=h.qs}))),!n.isEqual(SnapshotVersion.min())){const h=t.Pi.getLastRemoteSnapshotVersion(s).next((p=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,n)));l.push(h)}return PersistencePromise.waitFor(l).next((()=>a.apply(s))).next((()=>t.localDocuments.getLocalViewOfDocuments(s,u,d))).next((()=>u))})).then((s=>(t.Ms=r,s)))}function __PRIVATE_populateDocumentChangeBuffer(i,e,t){let n=__PRIVATE_documentKeySet(),r=__PRIVATE_documentKeySet();return t.forEach((s=>n=n.add(s))),e.getEntries(i,n).next((s=>{let a=__PRIVATE_mutableDocumentMap();return t.forEach(((l,u)=>{const d=s.get(l);u.isFoundDocument()!==d.isFoundDocument()&&(r=r.add(l)),u.isNoDocument()&&u.version.isEqual(SnapshotVersion.min())?(e.removeEntry(l,u.readTime),a=a.insert(l,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),a=a.insert(l,u)):__PRIVATE_logDebug(Ut,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",u.version)})),{ks:a,qs:r}}))}function __PRIVATE_localStoreGetNextMutationBatch(i,e){const t=__PRIVATE_debugCast(i);return t.persistence.runTransaction("Get next mutation batch","readonly",(n=>(e===void 0&&(e=j),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e))))}function __PRIVATE_localStoreAllocateTarget(i,e){const t=__PRIVATE_debugCast(i);return t.persistence.runTransaction("Allocate target","readwrite",(n=>{let r;return t.Pi.getTargetData(n,e).next((s=>s?(r=s,PersistencePromise.resolve(r)):t.Pi.allocateTargetId(n).next((a=>(r=new TargetData(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Pi.addTargetData(n,r).next((()=>r)))))))})).then((n=>{const r=t.Ms.get(n.targetId);return(r===null||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(n.targetId,n),t.xs.set(e,n.targetId)),n}))}async function __PRIVATE_localStoreReleaseTarget(i,e,t){const n=__PRIVATE_debugCast(i),r=n.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",s,(a=>n.persistence.referenceDelegate.removeTarget(a,r)))}catch(a){if(!__PRIVATE_isIndexedDbTransactionError(a))throw a;__PRIVATE_logDebug(Ut,`Failed to update sequence numbers for target ${e}: ${a}`)}n.Ms=n.Ms.remove(e),n.xs.delete(r.target)}function __PRIVATE_localStoreExecuteQuery(i,e,t){const n=__PRIVATE_debugCast(i);let r=SnapshotVersion.min(),s=__PRIVATE_documentKeySet();return n.persistence.runTransaction("Execute query","readwrite",(a=>(function(u,d,h){const p=__PRIVATE_debugCast(u),m=p.xs.get(h);return m!==void 0?PersistencePromise.resolve(p.Ms.get(m)):p.Pi.getTargetData(d,h)})(n,a,__PRIVATE_queryToTarget(e)).next((l=>{if(l)return r=l.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(a,l.targetId).next((u=>{s=u}))})).next((()=>n.Fs.getDocumentsMatchingQuery(a,e,t?r:SnapshotVersion.min(),t?s:__PRIVATE_documentKeySet()))).next((l=>(__PRIVATE_setMaxReadTime(n,__PRIVATE_queryCollectionGroup(e),l),{documents:l,Qs:s})))))}function __PRIVATE_setMaxReadTime(i,e,t){let n=i.Os.get(e)||SnapshotVersion.min();t.forEach(((r,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)})),i.Os.set(e,n)}class __PRIVATE_LocalClientState{constructor(){this.activeTargetIds=__PRIVATE_targetIdSet()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class __PRIVATE_MemorySharedClientState{constructor(){this.Mo=new __PRIVATE_LocalClientState,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new __PRIVATE_LocalClientState,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class __PRIVATE_NoopConnectivityMonitor{Oo(e){}shutdown(){}}const Jt="ConnectivityMonitor";class __PRIVATE_BrowserConnectivityMonitor{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){__PRIVATE_logDebug(Jt,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){__PRIVATE_logDebug(Jt,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Ht=null;function __PRIVATE_generateUniqueDebugId(){return Ht===null?Ht=(function(){return 268435456+Math.round(2147483648*Math.random())})():Ht++,"0x"+Ht.toString(16)}const Yt="RestConnection",Zt={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class __PRIVATE_RestConnection{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===lt?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,s){const a=__PRIVATE_generateUniqueDebugId(),l=this.zo(e,t.toUriEncodedString());__PRIVATE_logDebug(Yt,`Sending RPC '${e}' ${a}:`,l,n);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,r,s);const{host:d}=new URL(l),h=isCloudWorkstation(d);return this.Jo(e,l,u,n,h).then((p=>(__PRIVATE_logDebug(Yt,`Received RPC '${e}' ${a}: `,p),p)),(p=>{throw __PRIVATE_logWarn(Yt,`RPC '${e}' ${a} failed with error: `,p,"url: ",l,"request:",n),p}))}Ho(e,t,n,r,s,a){return this.Go(e,t,n,r,s)}jo(e,t,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+x})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,s)=>e[s]=r)),n&&n.headers.forEach(((r,s)=>e[s]=r))}zo(e,t){const n=Zt[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class __PRIVATE_StreamBridge{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Xt="WebChannelConnection";class __PRIVATE_WebChannelConnection extends __PRIVATE_RestConnection{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,s){const a=__PRIVATE_generateUniqueDebugId();return new Promise(((l,u)=>{const d=new XhrIo;d.setWithCredentials(!0),d.listenOnce(EventType.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case ErrorCode$1.NO_ERROR:const p=d.getResponseJson();__PRIVATE_logDebug(Xt,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(p)),l(p);break;case ErrorCode$1.TIMEOUT:__PRIVATE_logDebug(Xt,`RPC '${e}' ${a} timed out`),u(new FirestoreError(N.DEADLINE_EXCEEDED,"Request time out"));break;case ErrorCode$1.HTTP_ERROR:const m=d.getStatus();if(__PRIVATE_logDebug(Xt,`RPC '${e}' ${a} failed with status:`,m,"response text:",d.getResponseText()),m>0){let g=d.getResponseJson();Array.isArray(g)&&(g=g[0]);const v=g?.error;if(v&&v.status&&v.message){const _=(function(E){const A=E.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(A)>=0?A:N.UNKNOWN})(v.status);u(new FirestoreError(_,v.message))}else u(new FirestoreError(N.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new FirestoreError(N.UNAVAILABLE,"Connection failed."));break;default:fail(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{__PRIVATE_logDebug(Xt,`RPC '${e}' ${a} completed.`)}}));const h=JSON.stringify(r);__PRIVATE_logDebug(Xt,`RPC '${e}' ${a} sending request:`,r),d.send(t,"POST",h,n,15)}))}T_(e,t,n){const r=__PRIVATE_generateUniqueDebugId(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=createWebChannelTransport(),l=getStatEventTarget(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;const h=s.join("");__PRIVATE_logDebug(Xt,`Creating RPC '${e}' stream ${r}: ${h}`,u);const p=a.createWebChannel(h,u);this.I_(p);let m=!1,g=!1;const v=new __PRIVATE_StreamBridge({Yo:b=>{g?__PRIVATE_logDebug(Xt,`Not sending because RPC '${e}' stream ${r} is closed:`,b):(m||(__PRIVATE_logDebug(Xt,`Opening RPC '${e}' stream ${r} transport.`),p.open(),m=!0),__PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} sending:`,b),p.send(b))},Zo:()=>p.close()}),_=(b,E,A)=>{b.listen(E,(z=>{try{A(z)}catch(D){setTimeout((()=>{throw D}),0)}}))};return _(p,WebChannel.EventType.OPEN,(()=>{g||(__PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} transport opened.`),v.o_())})),_(p,WebChannel.EventType.CLOSE,(()=>{g||(g=!0,__PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} transport closed`),v.a_(),this.E_(p))})),_(p,WebChannel.EventType.ERROR,(b=>{g||(g=!0,__PRIVATE_logWarn(Xt,`RPC '${e}' stream ${r} transport errored. Name:`,b.name,"Message:",b.message),v.a_(new FirestoreError(N.UNAVAILABLE,"The operation could not be completed")))})),_(p,WebChannel.EventType.MESSAGE,(b=>{if(!g){const E=b.data[0];__PRIVATE_hardAssert(!!E,16349);const A=E,z=A?.error||A[0]?.error;if(z){__PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} received error:`,z);const D=z.status;let P=(function(I){const w=pt[I];if(w!==void 0)return __PRIVATE_mapCodeFromRpcCode(w)})(D),G=z.message;P===void 0&&(P=N.INTERNAL,G="Unknown error status: "+D+" with message "+z.message),g=!0,v.a_(new FirestoreError(P,G)),p.close()}else __PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} received:`,E),v.u_(E)}})),_(l,Event$1.STAT_EVENT,(b=>{b.stat===Stat.PROXY?__PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} detected buffering proxy`):b.stat===Stat.NOPROXY&&__PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{v.__()}),0),v}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function getDocument$1(){return typeof document<"u"?document:null}function __PRIVATE_newSerializer(i){return new JsonProtoSerializer(i,!0)}class __PRIVATE_ExponentialBackoff{constructor(e,t,n=1e3,r=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&__PRIVATE_logDebug("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const en="PersistentStream";class __PRIVATE_PersistentStream{constructor(e,t,n,r,s,a,l,u){this.Mi=e,this.S_=n,this.b_=r,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new __PRIVATE_ExponentialBackoff(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===N.RESOURCE_EXHAUSTED?(__PRIVATE_logError(t.toString()),__PRIVATE_logError("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===N.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,r])=>{this.D_===t&&this.G_(n,r)}),(n=>{e((()=>{const r=new FirestoreError(N.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(r)}))}))}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((r=>{n((()=>this.z_(r)))})),this.stream.onMessage((r=>{n((()=>++this.F_==1?this.J_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return __PRIVATE_logDebug(en,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(__PRIVATE_logDebug(en,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class __PRIVATE_PersistentListenStream extends __PRIVATE_PersistentStream{constructor(e,t,n,r,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,a),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=__PRIVATE_fromWatchChange(this.serializer,e),n=(function(s){if(!("targetChange"in s))return SnapshotVersion.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?SnapshotVersion.min():a.readTime?__PRIVATE_fromVersion(a.readTime):SnapshotVersion.min()})(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=__PRIVATE_getEncodedDatabaseId(this.serializer),t.addTarget=(function(s,a){let l;const u=a.target;if(l=__PRIVATE_targetIsDocumentTarget(u)?{documents:__PRIVATE_toDocumentsTarget(s,u)}:{query:__PRIVATE_toQueryTarget(s,u).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=__PRIVATE_toBytes(s,a.resumeToken);const d=__PRIVATE_toInt32Proto(s,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(SnapshotVersion.min())>0){l.readTime=toTimestamp(s,a.snapshotVersion.toTimestamp());const d=__PRIVATE_toInt32Proto(s,a.expectedCount);d!==null&&(l.expectedCount=d)}return l})(this.serializer,e);const n=__PRIVATE_toListenRequestLabels(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=__PRIVATE_getEncodedDatabaseId(this.serializer),t.removeTarget=e,this.q_(t)}}class __PRIVATE_PersistentWriteStream extends __PRIVATE_PersistentStream{constructor(e,t,n,r,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,a),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return __PRIVATE_hardAssert(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,__PRIVATE_hardAssert(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){__PRIVATE_hardAssert(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=__PRIVATE_fromWriteResults(e.writeResults,e.commitTime),n=__PRIVATE_fromVersion(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=__PRIVATE_getEncodedDatabaseId(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((n=>toMutation(this.serializer,n)))};this.q_(t)}}class Datastore{}class __PRIVATE_DatastoreImpl extends Datastore{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new FirestoreError(N.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,a])=>this.connection.Go(e,__PRIVATE_toResourcePath(t,n),r,s,a))).catch((s=>{throw s.name==="FirebaseError"?(s.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new FirestoreError(N.UNKNOWN,s.toString())}))}Ho(e,t,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Ho(e,__PRIVATE_toResourcePath(t,n),r,a,l,s))).catch((a=>{throw a.name==="FirebaseError"?(a.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new FirestoreError(N.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class __PRIVATE_OnlineStateTracker{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(__PRIVATE_logError(t),this.aa=!1):__PRIVATE_logDebug("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const tn="RemoteStore";class __PRIVATE_RemoteStoreImpl{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((a=>{n.enqueueAndForget((async()=>{__PRIVATE_canUseNetwork(this)&&(__PRIVATE_logDebug(tn,"Restarting streams for network reachability change."),await(async function(u){const d=__PRIVATE_debugCast(u);d.Ea.add(4),await __PRIVATE_disableNetworkInternal(d),d.Ra.set("Unknown"),d.Ea.delete(4),await __PRIVATE_enableNetworkInternal(d)})(this))}))})),this.Ra=new __PRIVATE_OnlineStateTracker(n,r)}}async function __PRIVATE_enableNetworkInternal(i){if(__PRIVATE_canUseNetwork(i))for(const e of i.da)await e(!0)}async function __PRIVATE_disableNetworkInternal(i){for(const e of i.da)await e(!1)}function __PRIVATE_remoteStoreListen(i,e){const t=__PRIVATE_debugCast(i);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),__PRIVATE_shouldStartWatchStream(t)?__PRIVATE_startWatchStream(t):__PRIVATE_ensureWatchStream(t).O_()&&__PRIVATE_sendWatchRequest(t,e))}function __PRIVATE_remoteStoreUnlisten(i,e){const t=__PRIVATE_debugCast(i),n=__PRIVATE_ensureWatchStream(t);t.Ia.delete(e),n.O_()&&__PRIVATE_sendUnwatchRequest(t,e),t.Ia.size===0&&(n.O_()?n.L_():__PRIVATE_canUseNetwork(t)&&t.Ra.set("Unknown"))}function __PRIVATE_sendWatchRequest(i,e){if(i.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(SnapshotVersion.min())>0){const t=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}__PRIVATE_ensureWatchStream(i).Y_(e)}function __PRIVATE_sendUnwatchRequest(i,e){i.Va.Ue(e),__PRIVATE_ensureWatchStream(i).Z_(e)}function __PRIVATE_startWatchStream(i){i.Va=new __PRIVATE_WatchChangeAggregator({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),At:e=>i.Ia.get(e)||null,ht:()=>i.datastore.serializer.databaseId}),__PRIVATE_ensureWatchStream(i).start(),i.Ra.ua()}function __PRIVATE_shouldStartWatchStream(i){return __PRIVATE_canUseNetwork(i)&&!__PRIVATE_ensureWatchStream(i).x_()&&i.Ia.size>0}function __PRIVATE_canUseNetwork(i){return __PRIVATE_debugCast(i).Ea.size===0}function __PRIVATE_cleanUpWatchStreamState(i){i.Va=void 0}async function __PRIVATE_onWatchStreamConnected(i){i.Ra.set("Online")}async function __PRIVATE_onWatchStreamOpen(i){i.Ia.forEach(((e,t)=>{__PRIVATE_sendWatchRequest(i,e)}))}async function __PRIVATE_onWatchStreamClose(i,e){__PRIVATE_cleanUpWatchStreamState(i),__PRIVATE_shouldStartWatchStream(i)?(i.Ra.ha(e),__PRIVATE_startWatchStream(i)):i.Ra.set("Unknown")}async function __PRIVATE_onWatchStreamChange(i,e,t){if(i.Ra.set("Online"),e instanceof __PRIVATE_WatchTargetChange&&e.state===2&&e.cause)try{await(async function(r,s){const a=s.cause;for(const l of s.targetIds)r.Ia.has(l)&&(await r.remoteSyncer.rejectListen(l,a),r.Ia.delete(l),r.Va.removeTarget(l))})(i,e)}catch(n){__PRIVATE_logDebug(tn,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await __PRIVATE_disableNetworkUntilRecovery(i,n)}else if(e instanceof __PRIVATE_DocumentWatchChange?i.Va.Ze(e):e instanceof __PRIVATE_ExistenceFilterChange?i.Va.st(e):i.Va.tt(e),!t.isEqual(SnapshotVersion.min()))try{const n=await __PRIVATE_localStoreGetLastRemoteSnapshotVersion(i.localStore);t.compareTo(n)>=0&&await(function(s,a){const l=s.Va.Tt(a);return l.targetChanges.forEach(((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const h=s.Ia.get(d);h&&s.Ia.set(d,h.withResumeToken(u.resumeToken,a))}})),l.targetMismatches.forEach(((u,d)=>{const h=s.Ia.get(u);if(!h)return;s.Ia.set(u,h.withResumeToken(ByteString.EMPTY_BYTE_STRING,h.snapshotVersion)),__PRIVATE_sendUnwatchRequest(s,u);const p=new TargetData(h.target,u,d,h.sequenceNumber);__PRIVATE_sendWatchRequest(s,p)})),s.remoteSyncer.applyRemoteEvent(l)})(i,t)}catch(n){__PRIVATE_logDebug(tn,"Failed to raise snapshot:",n),await __PRIVATE_disableNetworkUntilRecovery(i,n)}}async function __PRIVATE_disableNetworkUntilRecovery(i,e,t){if(!__PRIVATE_isIndexedDbTransactionError(e))throw e;i.Ea.add(1),await __PRIVATE_disableNetworkInternal(i),i.Ra.set("Offline"),t||(t=()=>__PRIVATE_localStoreGetLastRemoteSnapshotVersion(i.localStore)),i.asyncQueue.enqueueRetryable((async()=>{__PRIVATE_logDebug(tn,"Retrying IndexedDB access"),await t(),i.Ea.delete(1),await __PRIVATE_enableNetworkInternal(i)}))}function __PRIVATE_executeWithRecovery(i,e){return e().catch((t=>__PRIVATE_disableNetworkUntilRecovery(i,t,e)))}async function __PRIVATE_fillWritePipeline(i){const e=__PRIVATE_debugCast(i),t=__PRIVATE_ensureWriteStream(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:j;for(;__PRIVATE_canAddToWritePipeline(e);)try{const r=await __PRIVATE_localStoreGetNextMutationBatch(e.localStore,n);if(r===null){e.Ta.length===0&&t.L_();break}n=r.batchId,__PRIVATE_addToWritePipeline(e,r)}catch(r){await __PRIVATE_disableNetworkUntilRecovery(e,r)}__PRIVATE_shouldStartWriteStream(e)&&__PRIVATE_startWriteStream(e)}function __PRIVATE_canAddToWritePipeline(i){return __PRIVATE_canUseNetwork(i)&&i.Ta.length<10}function __PRIVATE_addToWritePipeline(i,e){i.Ta.push(e);const t=__PRIVATE_ensureWriteStream(i);t.O_()&&t.X_&&t.ea(e.mutations)}function __PRIVATE_shouldStartWriteStream(i){return __PRIVATE_canUseNetwork(i)&&!__PRIVATE_ensureWriteStream(i).x_()&&i.Ta.length>0}function __PRIVATE_startWriteStream(i){__PRIVATE_ensureWriteStream(i).start()}async function __PRIVATE_onWriteStreamOpen(i){__PRIVATE_ensureWriteStream(i).ra()}async function __PRIVATE_onWriteHandshakeComplete(i){const e=__PRIVATE_ensureWriteStream(i);for(const t of i.Ta)e.ea(t.mutations)}async function __PRIVATE_onMutationResult(i,e,t){const n=i.Ta.shift(),r=MutationBatchResult.from(n,e,t);await __PRIVATE_executeWithRecovery(i,(()=>i.remoteSyncer.applySuccessfulWrite(r))),await __PRIVATE_fillWritePipeline(i)}async function __PRIVATE_onWriteStreamClose(i,e){e&&__PRIVATE_ensureWriteStream(i).X_&&await(async function(n,r){if((function(a){return __PRIVATE_isPermanentError(a)&&a!==N.ABORTED})(r.code)){const s=n.Ta.shift();__PRIVATE_ensureWriteStream(n).B_(),await __PRIVATE_executeWithRecovery(n,(()=>n.remoteSyncer.rejectFailedWrite(s.batchId,r))),await __PRIVATE_fillWritePipeline(n)}})(i,e),__PRIVATE_shouldStartWriteStream(i)&&__PRIVATE_startWriteStream(i)}async function __PRIVATE_remoteStoreHandleCredentialChange(i,e){const t=__PRIVATE_debugCast(i);t.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug(tn,"RemoteStore received new credentials");const n=__PRIVATE_canUseNetwork(t);t.Ea.add(3),await __PRIVATE_disableNetworkInternal(t),n&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await __PRIVATE_enableNetworkInternal(t)}async function __PRIVATE_remoteStoreApplyPrimaryState(i,e){const t=__PRIVATE_debugCast(i);e?(t.Ea.delete(2),await __PRIVATE_enableNetworkInternal(t)):e||(t.Ea.add(2),await __PRIVATE_disableNetworkInternal(t),t.Ra.set("Unknown"))}function __PRIVATE_ensureWatchStream(i){return i.ma||(i.ma=(function(t,n,r){const s=__PRIVATE_debugCast(t);return s.sa(),new __PRIVATE_PersistentListenStream(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)})(i.datastore,i.asyncQueue,{Xo:__PRIVATE_onWatchStreamConnected.bind(null,i),t_:__PRIVATE_onWatchStreamOpen.bind(null,i),r_:__PRIVATE_onWatchStreamClose.bind(null,i),H_:__PRIVATE_onWatchStreamChange.bind(null,i)}),i.da.push((async e=>{e?(i.ma.B_(),__PRIVATE_shouldStartWatchStream(i)?__PRIVATE_startWatchStream(i):i.Ra.set("Unknown")):(await i.ma.stop(),__PRIVATE_cleanUpWatchStreamState(i))}))),i.ma}function __PRIVATE_ensureWriteStream(i){return i.fa||(i.fa=(function(t,n,r){const s=__PRIVATE_debugCast(t);return s.sa(),new __PRIVATE_PersistentWriteStream(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)})(i.datastore,i.asyncQueue,{Xo:()=>Promise.resolve(),t_:__PRIVATE_onWriteStreamOpen.bind(null,i),r_:__PRIVATE_onWriteStreamClose.bind(null,i),ta:__PRIVATE_onWriteHandshakeComplete.bind(null,i),na:__PRIVATE_onMutationResult.bind(null,i)}),i.da.push((async e=>{e?(i.fa.B_(),await __PRIVATE_fillWritePipeline(i)):(await i.fa.stop(),i.Ta.length>0&&(__PRIVATE_logDebug(tn,`Stopping write stream with ${i.Ta.length} pending writes`),i.Ta=[]))}))),i.fa}class DelayedOperation{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new __PRIVATE_Deferred,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,s){const a=Date.now()+n,l=new DelayedOperation(e,t,a,r,s);return l.start(n),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new FirestoreError(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function __PRIVATE_wrapInUserErrorIfRecoverable(i,e){if(__PRIVATE_logError("AsyncQueue",`${e}: ${i}`),__PRIVATE_isIndexedDbTransactionError(i))return new FirestoreError(N.UNAVAILABLE,`${e}: ${i}`);throw i}class DocumentSet{static emptySet(e){return new DocumentSet(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||DocumentKey.comparator(t.key,n.key):(t,n)=>DocumentKey.comparator(t.key,n.key),this.keyedMap=documentMap(),this.sortedSet=new SortedMap(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof DocumentSet)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=n.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new DocumentSet;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class __PRIVATE_DocumentChangeSet{constructor(){this.ga=new SortedMap(DocumentKey.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):fail(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}}class ViewSnapshot{constructor(e,t,n,r,s,a,l,u,d){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,t,n,r,s){const a=[];return t.forEach((l=>{a.push({type:0,doc:l})})),new ViewSnapshot(e,t,DocumentSet.emptySet(t),a,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&__PRIVATE_queryEquals(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class __PRIVATE_QueryListenersInfo{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class __PRIVATE_EventManagerImpl{constructor(){this.queries=__PRIVATE_newQueriesObjectMap(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const r=__PRIVATE_debugCast(t),s=r.queries;r.queries=__PRIVATE_newQueriesObjectMap(),s.forEach(((a,l)=>{for(const u of l.Sa)u.onError(n)}))})(this,new FirestoreError(N.ABORTED,"Firestore shutting down"))}}function __PRIVATE_newQueriesObjectMap(){return new ObjectMap((i=>__PRIVATE_canonifyQuery(i)),__PRIVATE_queryEquals)}async function __PRIVATE_eventManagerListen(i,e){const t=__PRIVATE_debugCast(i);let n=3;const r=e.query;let s=t.queries.get(r);s?!s.ba()&&e.Da()&&(n=2):(s=new __PRIVATE_QueryListenersInfo,n=e.Da()?0:1);try{switch(n){case 0:s.wa=await t.onListen(r,!0);break;case 1:s.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(a){const l=__PRIVATE_wrapInUserErrorIfRecoverable(a,`Initialization of query '${__PRIVATE_stringifyQuery(e.query)}' failed`);return void e.onError(l)}t.queries.set(r,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&__PRIVATE_raiseSnapshotsInSyncEvent(t)}async function __PRIVATE_eventManagerUnlisten(i,e){const t=__PRIVATE_debugCast(i),n=e.query;let r=3;const s=t.queries.get(n);if(s){const a=s.Sa.indexOf(e);a>=0&&(s.Sa.splice(a,1),s.Sa.length===0?r=e.Da()?0:1:!s.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function __PRIVATE_eventManagerOnWatchChange(i,e){const t=__PRIVATE_debugCast(i);let n=!1;for(const r of e){const s=r.query,a=t.queries.get(s);if(a){for(const l of a.Sa)l.Fa(r)&&(n=!0);a.wa=r}}n&&__PRIVATE_raiseSnapshotsInSyncEvent(t)}function __PRIVATE_eventManagerOnWatchError(i,e,t){const n=__PRIVATE_debugCast(i),r=n.queries.get(e);if(r)for(const s of r.Sa)s.onError(t);n.queries.delete(e)}function __PRIVATE_raiseSnapshotsInSyncEvent(i){i.Ca.forEach((e=>{e.next()}))}var nn,rn;(rn=nn||(nn={})).Ma="default",rn.Cache="cache";class __PRIVATE_QueryListener{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const r of e.docChanges)r.type!==3&&n.push(r);e=new ViewSnapshot(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const n=t!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=ViewSnapshot.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==nn.Cache}}class __PRIVATE_AddedLimboDocument{constructor(e){this.key=e}}class __PRIVATE_RemovedLimboDocument{constructor(e){this.key=e}}class __PRIVATE_View{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=__PRIVATE_documentKeySet(),this.mutatedKeys=__PRIVATE_documentKeySet(),this.eu=__PRIVATE_newQueryComparator(e),this.tu=new DocumentSet(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new __PRIVATE_DocumentChangeSet,r=t?t.tu:this.tu;let s=t?t.mutatedKeys:this.mutatedKeys,a=r,l=!1;const u=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,d=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((h,p)=>{const m=r.get(h),g=__PRIVATE_queryMatches(this.query,p)?p:null,v=!!m&&this.mutatedKeys.has(m.key),_=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let b=!1;m&&g?m.data.isEqual(g.data)?v!==_&&(n.track({type:3,doc:g}),b=!0):this.su(m,g)||(n.track({type:2,doc:g}),b=!0,(u&&this.eu(g,u)>0||d&&this.eu(g,d)<0)&&(l=!0)):!m&&g?(n.track({type:0,doc:g}),b=!0):m&&!g&&(n.track({type:1,doc:m}),b=!0,(u||d)&&(l=!0)),b&&(g?(a=a.add(g),s=_?s.add(h):s.delete(h)):(a=a.delete(h),s=s.delete(h)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),s=s.delete(h.key),n.track({type:1,doc:h})}return{tu:a,iu:n,Cs:l,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((h,p)=>(function(g,v){const _=b=>{switch(b){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fail(20277,{Rt:b})}};return _(g)-_(v)})(h.type,p.type)||this.eu(h.doc,p.doc))),this.ou(n),r=r??!1;const l=t&&!r?this._u():[],u=this.Xa.size===0&&this.current&&!r?1:0,d=u!==this.Za;return this.Za=u,a.length!==0||d?{snapshot:new ViewSnapshot(this.query,e.tu,s,a,e.mutatedKeys,u===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new __PRIVATE_DocumentChangeSet,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=__PRIVATE_documentKeySet(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const t=[];return e.forEach((n=>{this.Xa.has(n)||t.push(new __PRIVATE_RemovedLimboDocument(n))})),this.Xa.forEach((n=>{e.has(n)||t.push(new __PRIVATE_AddedLimboDocument(n))})),t}cu(e){this.Ya=e.Qs,this.Xa=__PRIVATE_documentKeySet();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ViewSnapshot.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const sn="SyncEngine";class __PRIVATE_QueryView{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class LimboResolution{constructor(e){this.key=e,this.hu=!1}}class __PRIVATE_SyncEngineImpl{constructor(e,t,n,r,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new ObjectMap((l=>__PRIVATE_canonifyQuery(l)),__PRIVATE_queryEquals),this.Iu=new Map,this.Eu=new Set,this.du=new SortedMap(DocumentKey.comparator),this.Au=new Map,this.Ru=new __PRIVATE_ReferenceSet,this.Vu={},this.mu=new Map,this.fu=__PRIVATE_TargetIdGenerator.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function __PRIVATE_syncEngineListen(i,e,t=!0){const n=__PRIVATE_ensureWatchCallbacks(i);let r;const s=n.Tu.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await __PRIVATE_allocateTargetAndMaybeListen(n,e,t,!0),r}async function __PRIVATE_triggerRemoteStoreListen(i,e){const t=__PRIVATE_ensureWatchCallbacks(i);await __PRIVATE_allocateTargetAndMaybeListen(t,e,!0,!1)}async function __PRIVATE_allocateTargetAndMaybeListen(i,e,t,n){const r=await __PRIVATE_localStoreAllocateTarget(i.localStore,__PRIVATE_queryToTarget(e)),s=r.targetId,a=i.sharedClientState.addLocalQueryTarget(s,t);let l;return n&&(l=await __PRIVATE_initializeViewAndComputeSnapshot(i,e,s,a==="current",r.resumeToken)),i.isPrimaryClient&&t&&__PRIVATE_remoteStoreListen(i.remoteStore,r),l}async function __PRIVATE_initializeViewAndComputeSnapshot(i,e,t,n,r){i.pu=(p,m,g)=>(async function(_,b,E,A){let z=b.view.ru(E);z.Cs&&(z=await __PRIVATE_localStoreExecuteQuery(_.localStore,b.query,!1).then((({documents:R})=>b.view.ru(R,z))));const D=A&&A.targetChanges.get(b.targetId),P=A&&A.targetMismatches.get(b.targetId)!=null,G=b.view.applyChanges(z,_.isPrimaryClient,D,P);return __PRIVATE_updateTrackedLimbos(_,b.targetId,G.au),G.snapshot})(i,p,m,g);const s=await __PRIVATE_localStoreExecuteQuery(i.localStore,e,!0),a=new __PRIVATE_View(e,s.Qs),l=a.ru(s.documents),u=TargetChange.createSynthesizedTargetChangeForCurrentChange(t,n&&i.onlineState!=="Offline",r),d=a.applyChanges(l,i.isPrimaryClient,u);__PRIVATE_updateTrackedLimbos(i,t,d.au);const h=new __PRIVATE_QueryView(e,t,a);return i.Tu.set(e,h),i.Iu.has(t)?i.Iu.get(t).push(e):i.Iu.set(t,[e]),d.snapshot}async function __PRIVATE_syncEngineUnlisten(i,e,t){const n=__PRIVATE_debugCast(i),r=n.Tu.get(e),s=n.Iu.get(r.targetId);if(s.length>1)return n.Iu.set(r.targetId,s.filter((a=>!__PRIVATE_queryEquals(a,e)))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await __PRIVATE_localStoreReleaseTarget(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),t&&__PRIVATE_remoteStoreUnlisten(n.remoteStore,r.targetId),__PRIVATE_removeAndCleanupTarget(n,r.targetId)})).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)):(__PRIVATE_removeAndCleanupTarget(n,r.targetId),await __PRIVATE_localStoreReleaseTarget(n.localStore,r.targetId,!0))}async function __PRIVATE_triggerRemoteStoreUnlisten(i,e){const t=__PRIVATE_debugCast(i),n=t.Tu.get(e),r=t.Iu.get(n.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),__PRIVATE_remoteStoreUnlisten(t.remoteStore,n.targetId))}async function __PRIVATE_syncEngineWrite(i,e,t){const n=__PRIVATE_syncEngineEnsureWriteCallbacks(i);try{const r=await(function(a,l){const u=__PRIVATE_debugCast(a),d=Timestamp.now(),h=l.reduce(((g,v)=>g.add(v.key)),__PRIVATE_documentKeySet());let p,m;return u.persistence.runTransaction("Locally write mutations","readwrite",(g=>{let v=__PRIVATE_mutableDocumentMap(),_=__PRIVATE_documentKeySet();return u.Ns.getEntries(g,h).next((b=>{v=b,v.forEach(((E,A)=>{A.isValidDocument()||(_=_.add(E))}))})).next((()=>u.localDocuments.getOverlayedDocuments(g,v))).next((b=>{p=b;const E=[];for(const A of l){const z=__PRIVATE_mutationExtractBaseValue(A,p.get(A.key).overlayedDocument);z!=null&&E.push(new __PRIVATE_PatchMutation(A.key,z,__PRIVATE_extractFieldMask(z.value.mapValue),Precondition.exists(!0)))}return u.mutationQueue.addMutationBatch(g,d,E,l)})).next((b=>{m=b;const E=b.applyToLocalDocumentSet(p,_);return u.documentOverlayCache.saveOverlays(g,b.batchId,E)}))})).then((()=>({batchId:m.batchId,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap(p)})))})(n.localStore,e);n.sharedClientState.addPendingMutation(r.batchId),(function(a,l,u){let d=a.Vu[a.currentUser.toKey()];d||(d=new SortedMap(__PRIVATE_primitiveComparator)),d=d.insert(l,u),a.Vu[a.currentUser.toKey()]=d})(n,r.batchId,t),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,r.changes),await __PRIVATE_fillWritePipeline(n.remoteStore)}catch(r){const s=__PRIVATE_wrapInUserErrorIfRecoverable(r,"Failed to persist write");t.reject(s)}}async function __PRIVATE_syncEngineApplyRemoteEvent(i,e){const t=__PRIVATE_debugCast(i);try{const n=await __PRIVATE_localStoreApplyRemoteEventToLocalCache(t.localStore,e);e.targetChanges.forEach(((r,s)=>{const a=t.Au.get(s);a&&(__PRIVATE_hardAssert(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?a.hu=!0:r.modifiedDocuments.size>0?__PRIVATE_hardAssert(a.hu,14607):r.removedDocuments.size>0&&(__PRIVATE_hardAssert(a.hu,42227),a.hu=!1))})),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(t,n,e)}catch(n){await __PRIVATE_ignoreIfPrimaryLeaseLoss(n)}}function __PRIVATE_syncEngineApplyOnlineStateChange(i,e,t){const n=__PRIVATE_debugCast(i);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const r=[];n.Tu.forEach(((s,a)=>{const l=a.view.va(e);l.snapshot&&r.push(l.snapshot)})),(function(a,l){const u=__PRIVATE_debugCast(a);u.onlineState=l;let d=!1;u.queries.forEach(((h,p)=>{for(const m of p.Sa)m.va(l)&&(d=!0)})),d&&__PRIVATE_raiseSnapshotsInSyncEvent(u)})(n.eventManager,e),r.length&&n.Pu.H_(r),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function __PRIVATE_syncEngineRejectListen(i,e,t){const n=__PRIVATE_debugCast(i);n.sharedClientState.updateQueryState(e,"rejected",t);const r=n.Au.get(e),s=r&&r.key;if(s){let a=new SortedMap(DocumentKey.comparator);a=a.insert(s,MutableDocument.newNoDocument(s,SnapshotVersion.min()));const l=__PRIVATE_documentKeySet().add(s),u=new RemoteEvent(SnapshotVersion.min(),new Map,new SortedMap(__PRIVATE_primitiveComparator),a,l);await __PRIVATE_syncEngineApplyRemoteEvent(n,u),n.du=n.du.remove(s),n.Au.delete(e),__PRIVATE_pumpEnqueuedLimboResolutions(n)}else await __PRIVATE_localStoreReleaseTarget(n.localStore,e,!1).then((()=>__PRIVATE_removeAndCleanupTarget(n,e,t))).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)}async function __PRIVATE_syncEngineApplySuccessfulWrite(i,e){const t=__PRIVATE_debugCast(i),n=e.batch.batchId;try{const r=await __PRIVATE_localStoreAcknowledgeBatch(t.localStore,e);__PRIVATE_processUserCallback(t,n,null),__PRIVATE_triggerPendingWritesCallbacks(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(t,r)}catch(r){await __PRIVATE_ignoreIfPrimaryLeaseLoss(r)}}async function __PRIVATE_syncEngineRejectFailedWrite(i,e,t){const n=__PRIVATE_debugCast(i);try{const r=await(function(a,l){const u=__PRIVATE_debugCast(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let h;return u.mutationQueue.lookupMutationBatch(d,l).next((p=>(__PRIVATE_hardAssert(p!==null,37113),h=p.keys(),u.mutationQueue.removeMutationBatch(d,p)))).next((()=>u.mutationQueue.performConsistencyCheck(d))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(d,h,l))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h))).next((()=>u.localDocuments.getDocuments(d,h)))}))})(n.localStore,e);__PRIVATE_processUserCallback(n,e,t),__PRIVATE_triggerPendingWritesCallbacks(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,r)}catch(r){await __PRIVATE_ignoreIfPrimaryLeaseLoss(r)}}function __PRIVATE_triggerPendingWritesCallbacks(i,e){(i.mu.get(e)||[]).forEach((t=>{t.resolve()})),i.mu.delete(e)}function __PRIVATE_processUserCallback(i,e,t){const n=__PRIVATE_debugCast(i);let r=n.Vu[n.currentUser.toKey()];if(r){const s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),n.Vu[n.currentUser.toKey()]=r}}function __PRIVATE_removeAndCleanupTarget(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(const n of i.Iu.get(e))i.Tu.delete(n),t&&i.Pu.yu(n,t);i.Iu.delete(e),i.isPrimaryClient&&i.Ru.jr(e).forEach((n=>{i.Ru.containsKey(n)||__PRIVATE_removeLimboTarget(i,n)}))}function __PRIVATE_removeLimboTarget(i,e){i.Eu.delete(e.path.canonicalString());const t=i.du.get(e);t!==null&&(__PRIVATE_remoteStoreUnlisten(i.remoteStore,t),i.du=i.du.remove(e),i.Au.delete(t),__PRIVATE_pumpEnqueuedLimboResolutions(i))}function __PRIVATE_updateTrackedLimbos(i,e,t){for(const n of t)n instanceof __PRIVATE_AddedLimboDocument?(i.Ru.addReference(n.key,e),__PRIVATE_trackLimboChange(i,n)):n instanceof __PRIVATE_RemovedLimboDocument?(__PRIVATE_logDebug(sn,"Document no longer in limbo: "+n.key),i.Ru.removeReference(n.key,e),i.Ru.containsKey(n.key)||__PRIVATE_removeLimboTarget(i,n.key)):fail(19791,{wu:n})}function __PRIVATE_trackLimboChange(i,e){const t=e.key,n=t.path.canonicalString();i.du.get(t)||i.Eu.has(n)||(__PRIVATE_logDebug(sn,"New document in limbo: "+t),i.Eu.add(n),__PRIVATE_pumpEnqueuedLimboResolutions(i))}function __PRIVATE_pumpEnqueuedLimboResolutions(i){for(;i.Eu.size>0&&i.du.size<i.maxConcurrentLimboResolutions;){const e=i.Eu.values().next().value;i.Eu.delete(e);const t=new DocumentKey(ResourcePath.fromString(e)),n=i.fu.next();i.Au.set(n,new LimboResolution(t)),i.du=i.du.insert(t,n),__PRIVATE_remoteStoreListen(i.remoteStore,new TargetData(__PRIVATE_queryToTarget(__PRIVATE_newQueryForPath(t.path)),n,"TargetPurposeLimboResolution",__PRIVATE_ListenSequence.ce))}}async function __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(i,e,t){const n=__PRIVATE_debugCast(i),r=[],s=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach(((l,u)=>{a.push(n.pu(u,e,t).then((d=>{if((d||t)&&n.isPrimaryClient){const h=d?!d.fromCache:t?.targetChanges.get(u.targetId)?.current;n.sharedClientState.updateQueryState(u.targetId,h?"current":"not-current")}if(d){r.push(d);const h=__PRIVATE_LocalViewChanges.As(u.targetId,d);s.push(h)}})))})),await Promise.all(a),n.Pu.H_(r),await(async function(u,d){const h=__PRIVATE_debugCast(u);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(p=>PersistencePromise.forEach(d,(m=>PersistencePromise.forEach(m.Es,(g=>h.persistence.referenceDelegate.addReference(p,m.targetId,g))).next((()=>PersistencePromise.forEach(m.ds,(g=>h.persistence.referenceDelegate.removeReference(p,m.targetId,g)))))))))}catch(p){if(!__PRIVATE_isIndexedDbTransactionError(p))throw p;__PRIVATE_logDebug(Ut,"Failed to update sequence numbers: "+p)}for(const p of d){const m=p.targetId;if(!p.fromCache){const g=h.Ms.get(m),v=g.snapshotVersion,_=g.withLastLimboFreeSnapshotVersion(v);h.Ms=h.Ms.insert(m,_)}}})(n.localStore,s))}async function __PRIVATE_syncEngineHandleCredentialChange(i,e){const t=__PRIVATE_debugCast(i);if(!t.currentUser.isEqual(e)){__PRIVATE_logDebug(sn,"User change. New user:",e.toKey());const n=await __PRIVATE_localStoreHandleUserChange(t.localStore,e);t.currentUser=e,(function(s,a){s.mu.forEach((l=>{l.forEach((u=>{u.reject(new FirestoreError(N.CANCELLED,a))}))})),s.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(t,n.Ls)}}function __PRIVATE_syncEngineGetRemoteKeysForTarget(i,e){const t=__PRIVATE_debugCast(i),n=t.Au.get(e);if(n&&n.hu)return __PRIVATE_documentKeySet().add(n.key);{let r=__PRIVATE_documentKeySet();const s=t.Iu.get(e);if(!s)return r;for(const a of s){const l=t.Tu.get(a);r=r.unionWith(l.view.nu)}return r}}function __PRIVATE_ensureWatchCallbacks(i){const e=__PRIVATE_debugCast(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=__PRIVATE_syncEngineApplyRemoteEvent.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=__PRIVATE_syncEngineGetRemoteKeysForTarget.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=__PRIVATE_syncEngineRejectListen.bind(null,e),e.Pu.H_=__PRIVATE_eventManagerOnWatchChange.bind(null,e.eventManager),e.Pu.yu=__PRIVATE_eventManagerOnWatchError.bind(null,e.eventManager),e}function __PRIVATE_syncEngineEnsureWriteCallbacks(i){const e=__PRIVATE_debugCast(i);return e.remoteStore.remoteSyncer.applySuccessfulWrite=__PRIVATE_syncEngineApplySuccessfulWrite.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=__PRIVATE_syncEngineRejectFailedWrite.bind(null,e),e}class __PRIVATE_MemoryOfflineComponentProvider{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=__PRIVATE_newSerializer(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return __PRIVATE_newLocalStore(this.persistence,new __PRIVATE_QueryEngine,e.initialUser,this.serializer)}Cu(e){return new __PRIVATE_MemoryPersistence(__PRIVATE_MemoryEagerDelegate.mi,this.serializer)}Du(e){return new __PRIVATE_MemorySharedClientState}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}__PRIVATE_MemoryOfflineComponentProvider.provider={build:()=>new __PRIVATE_MemoryOfflineComponentProvider};class __PRIVATE_LruGcMemoryOfflineComponentProvider extends __PRIVATE_MemoryOfflineComponentProvider{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){__PRIVATE_hardAssert(this.persistence.referenceDelegate instanceof __PRIVATE_MemoryLruDelegate,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new __PRIVATE_LruScheduler(n,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?LruParams.withCacheSize(this.cacheSizeBytes):LruParams.DEFAULT;return new __PRIVATE_MemoryPersistence((n=>__PRIVATE_MemoryLruDelegate.mi(n,t)),this.serializer)}}class OnlineComponentProvider{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>__PRIVATE_syncEngineApplyOnlineStateChange(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=__PRIVATE_syncEngineHandleCredentialChange.bind(null,this.syncEngine),await __PRIVATE_remoteStoreApplyPrimaryState(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new __PRIVATE_EventManagerImpl})()}createDatastore(e){const t=__PRIVATE_newSerializer(e.databaseInfo.databaseId),n=(function(s){return new __PRIVATE_WebChannelConnection(s)})(e.databaseInfo);return(function(s,a,l,u){return new __PRIVATE_DatastoreImpl(s,a,l,u)})(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return(function(n,r,s,a,l){return new __PRIVATE_RemoteStoreImpl(n,r,s,a,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>__PRIVATE_syncEngineApplyOnlineStateChange(this.syncEngine,t,0)),(function(){return __PRIVATE_BrowserConnectivityMonitor.v()?new __PRIVATE_BrowserConnectivityMonitor:new __PRIVATE_NoopConnectivityMonitor})())}createSyncEngine(e,t){return(function(r,s,a,l,u,d,h){const p=new __PRIVATE_SyncEngineImpl(r,s,a,l,u,d);return h&&(p.gu=!0),p})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const n=__PRIVATE_debugCast(t);__PRIVATE_logDebug(tn,"RemoteStore shutting down."),n.Ea.add(5),await __PRIVATE_disableNetworkInternal(n),n.Aa.shutdown(),n.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}OnlineComponentProvider.provider={build:()=>new OnlineComponentProvider};class __PRIVATE_AsyncObserver{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):__PRIVATE_logError("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const on$1="FirestoreClient";class FirestoreClient{constructor(e,t,n,r,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=User.UNAUTHENTICATED,this.clientId=__PRIVATE_AutoId.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,(async a=>{__PRIVATE_logDebug(on$1,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,(a=>(__PRIVATE_logDebug(on$1,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new __PRIVATE_Deferred;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=__PRIVATE_wrapInUserErrorIfRecoverable(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function __PRIVATE_setOfflineComponentProvider(i,e){i.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug(on$1,"Initializing OfflineComponentProvider");const t=i.configuration;await e.initialize(t);let n=t.initialUser;i.setCredentialChangeListener((async r=>{n.isEqual(r)||(await __PRIVATE_localStoreHandleUserChange(e.localStore,r),n=r)})),e.persistence.setDatabaseDeletedListener((()=>i.terminate())),i._offlineComponents=e}async function __PRIVATE_setOnlineComponentProvider(i,e){i.asyncQueue.verifyOperationInProgress();const t=await __PRIVATE_ensureOfflineComponents(i);__PRIVATE_logDebug(on$1,"Initializing OnlineComponentProvider"),await e.initialize(t,i.configuration),i.setCredentialChangeListener((n=>__PRIVATE_remoteStoreHandleCredentialChange(e.remoteStore,n))),i.setAppCheckTokenChangeListener(((n,r)=>__PRIVATE_remoteStoreHandleCredentialChange(e.remoteStore,r))),i._onlineComponents=e}async function __PRIVATE_ensureOfflineComponents(i){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){__PRIVATE_logDebug(on$1,"Using user provided OfflineComponentProvider");try{await __PRIVATE_setOfflineComponentProvider(i,i._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===N.FAILED_PRECONDITION||r.code===N.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;__PRIVATE_logWarn("Error using user provided cache. Falling back to memory cache: "+t),await __PRIVATE_setOfflineComponentProvider(i,new __PRIVATE_MemoryOfflineComponentProvider)}}else __PRIVATE_logDebug(on$1,"Using default OfflineComponentProvider"),await __PRIVATE_setOfflineComponentProvider(i,new __PRIVATE_LruGcMemoryOfflineComponentProvider(void 0));return i._offlineComponents}async function __PRIVATE_ensureOnlineComponents(i){return i._onlineComponents||(i._uninitializedComponentsProvider?(__PRIVATE_logDebug(on$1,"Using user provided OnlineComponentProvider"),await __PRIVATE_setOnlineComponentProvider(i,i._uninitializedComponentsProvider._online)):(__PRIVATE_logDebug(on$1,"Using default OnlineComponentProvider"),await __PRIVATE_setOnlineComponentProvider(i,new OnlineComponentProvider))),i._onlineComponents}function __PRIVATE_getSyncEngine(i){return __PRIVATE_ensureOnlineComponents(i).then((e=>e.syncEngine))}function __PRIVATE_getDatastore(i){return __PRIVATE_ensureOnlineComponents(i).then((e=>e.datastore))}async function __PRIVATE_getEventManager(i){const e=await __PRIVATE_ensureOnlineComponents(i),t=e.eventManager;return t.onListen=__PRIVATE_syncEngineListen.bind(null,e.syncEngine),t.onUnlisten=__PRIVATE_syncEngineUnlisten.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=__PRIVATE_triggerRemoteStoreListen.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=__PRIVATE_triggerRemoteStoreUnlisten.bind(null,e.syncEngine),t}function __PRIVATE_firestoreClientGetDocumentViaSnapshotListener(i,e,t={}){const n=new __PRIVATE_Deferred;return i.asyncQueue.enqueueAndForget((async()=>(function(s,a,l,u,d){const h=new __PRIVATE_AsyncObserver({next:m=>{h.Nu(),a.enqueueAndForget((()=>__PRIVATE_eventManagerUnlisten(s,p)));const g=m.docs.has(l);!g&&m.fromCache?d.reject(new FirestoreError(N.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&m.fromCache&&u&&u.source==="server"?d.reject(new FirestoreError(N.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(m)},error:m=>d.reject(m)}),p=new __PRIVATE_QueryListener(__PRIVATE_newQueryForPath(l.path),h,{includeMetadataChanges:!0,qa:!0});return __PRIVATE_eventManagerListen(s,p)})(await __PRIVATE_getEventManager(i),i.asyncQueue,e,t,n))),n.promise}function __PRIVATE_firestoreClientGetDocumentsViaSnapshotListener(i,e,t={}){const n=new __PRIVATE_Deferred;return i.asyncQueue.enqueueAndForget((async()=>(function(s,a,l,u,d){const h=new __PRIVATE_AsyncObserver({next:m=>{h.Nu(),a.enqueueAndForget((()=>__PRIVATE_eventManagerUnlisten(s,p))),m.fromCache&&u.source==="server"?d.reject(new FirestoreError(N.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(m)},error:m=>d.reject(m)}),p=new __PRIVATE_QueryListener(l,h,{includeMetadataChanges:!0,qa:!0});return __PRIVATE_eventManagerListen(s,p)})(await __PRIVATE_getEventManager(i),i.asyncQueue,e,t,n))),n.promise}function __PRIVATE_firestoreClientRunAggregateQuery(i,e,t){const n=new __PRIVATE_Deferred;return i.asyncQueue.enqueueAndForget((async()=>{try{const r=await __PRIVATE_getDatastore(i);n.resolve((async function(a,l,u){const d=__PRIVATE_debugCast(a),{request:h,gt:p,parent:m}=__PRIVATE_toRunAggregationQueryRequest(d.serializer,__PRIVATE_queryToAggregateTarget(l),u);d.connection.$o||delete h.parent;const g=(await d.Ho("RunAggregationQuery",d.serializer.databaseId,m,h,1)).filter((_=>!!_.result));__PRIVATE_hardAssert(g.length===1,64727);const v=g[0].result?.aggregateFields;return Object.keys(v).reduce(((_,b)=>(_[p[b]]=v[b],_)),{})})(r,e,t))}catch(r){n.reject(r)}})),n.promise}function __PRIVATE_cloneLongPollingOptions(i){const e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}const _n=new Map;const an="firestore.googleapis.com",un=!0;class FirestoreSettingsImpl{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new FirestoreError(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=an,this.ssl=un}else this.host=e.host,this.ssl=e.ssl??un;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Ot;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Bt)throw new FirestoreError(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}__PRIVATE_validateIsNotUsedTogether("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=__PRIVATE_cloneLongPollingOptions(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new FirestoreError(N.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new FirestoreError(N.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new FirestoreError(N.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,r){return n.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Firestore$1{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new FirestoreSettingsImpl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new FirestoreError(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new FirestoreError(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new FirestoreSettingsImpl(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new __PRIVATE_EmptyAuthCredentialsProvider;switch(n.type){case"firstParty":return new __PRIVATE_FirstPartyAuthCredentialsProvider(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new FirestoreError(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const n=_n.get(t);n&&(__PRIVATE_logDebug("ComponentProvider","Removing Datastore"),_n.delete(t),n.terminate())})(this),Promise.resolve()}}function connectFirestoreEmulator(i,e,t,n={}){i=__PRIVATE_cast(i,Firestore$1);const r=isCloudWorkstation(e),s=i._getSettings(),a={...s,emulatorOptions:i._getEmulatorOptions()},l=`${e}:${t}`;r&&(pingServer(`https://${l}`),updateEmulatorBanner("Firestore",!0)),s.host!==an&&s.host!==l&&__PRIVATE_logWarn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...s,host:l,ssl:r,emulatorOptions:n};if(!deepEqual(u,a)&&(i._setSettings(u),n.mockUserToken)){let d,h;if(typeof n.mockUserToken=="string")d=n.mockUserToken,h=User.MOCK_USER;else{d=createMockUserToken(n.mockUserToken,i._app?.options.projectId);const p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new FirestoreError(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new User(p)}i._authCredentials=new __PRIVATE_EmulatorAuthCredentialsProvider(new __PRIVATE_OAuthToken(d,h))}}class Query{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Query(this.firestore,e,this._query)}}class DocumentReference{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new CollectionReference(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new DocumentReference(this.firestore,e,this._key)}toJSON(){return{type:DocumentReference._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(__PRIVATE_validateJSON(t,DocumentReference._jsonSchema))return new DocumentReference(e,n||null,new DocumentKey(ResourcePath.fromString(t.referencePath)))}}DocumentReference._jsonSchemaVersion="firestore/documentReference/1.0",DocumentReference._jsonSchema={type:property("string",DocumentReference._jsonSchemaVersion),referencePath:property("string")};class CollectionReference extends Query{constructor(e,t,n){super(e,t,__PRIVATE_newQueryForPath(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new DocumentReference(this.firestore,null,new DocumentKey(e))}withConverter(e){return new CollectionReference(this.firestore,e,this._path)}}function collection(i,e,...t){if(i=getModularInstance(i),__PRIVATE_validateNonEmptyArgument("collection","path",e),i instanceof Firestore$1){const n=ResourcePath.fromString(e,...t);return __PRIVATE_validateCollectionPath(n),new CollectionReference(i,null,n)}{if(!(i instanceof DocumentReference||i instanceof CollectionReference))throw new FirestoreError(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=i._path.child(ResourcePath.fromString(e,...t));return __PRIVATE_validateCollectionPath(n),new CollectionReference(i.firestore,null,n)}}function doc(i,e,...t){if(i=getModularInstance(i),arguments.length===1&&(e=__PRIVATE_AutoId.newId()),__PRIVATE_validateNonEmptyArgument("doc","path",e),i instanceof Firestore$1){const n=ResourcePath.fromString(e,...t);return __PRIVATE_validateDocumentPath(n),new DocumentReference(i,null,new DocumentKey(n))}{if(!(i instanceof DocumentReference||i instanceof CollectionReference))throw new FirestoreError(N.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=i._path.child(ResourcePath.fromString(e,...t));return __PRIVATE_validateDocumentPath(n),new DocumentReference(i.firestore,i instanceof CollectionReference?i.converter:null,new DocumentKey(n))}}const cn="AsyncQueue";class __PRIVATE_AsyncQueueImpl{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new __PRIVATE_ExponentialBackoff(this,"async_queue_retry"),this._c=()=>{const n=getDocument$1();n&&__PRIVATE_logDebug(cn,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=getDocument$1();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=getDocument$1();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new __PRIVATE_Deferred;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!__PRIVATE_isIndexedDbTransactionError(e))throw e;__PRIVATE_logDebug(cn,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((n=>{throw this.nc=n,this.rc=!1,__PRIVATE_logError("INTERNAL UNHANDLED ERROR: ",__PRIVATE_getMessageOrStack(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=DelayedOperation.createAndSchedule(this,e,t,n,(s=>this.hc(s)));return this.tc.push(r),r}uc(){this.nc&&fail(47125,{Pc:__PRIVATE_getMessageOrStack(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,n)=>t.targetTimeMs-n.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function __PRIVATE_getMessageOrStack(i){let e=i.message||"";return i.stack&&(e=i.stack.includes(i.message)?i.stack:i.message+`
`+i.stack),e}function __PRIVATE_isPartialObserver(i){return(function(t,n){if(typeof t!="object"||t===null)return!1;const r=t;for(const s of n)if(s in r&&typeof r[s]=="function")return!0;return!1})(i,["next","error","complete"])}class Firestore extends Firestore$1{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new __PRIVATE_AsyncQueueImpl,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new __PRIVATE_AsyncQueueImpl(e),this._firestoreClient=void 0,await e}}}function getFirestore(i,e){const t=typeof i=="object"?i:getApp(),n=typeof i=="string"?i:lt,r=_getProvider(t,"firestore").getImmediate({identifier:n});if(!r._initialized){const s=getDefaultEmulatorHostnameAndPort("firestore");s&&connectFirestoreEmulator(r,...s)}return r}function ensureFirestoreConfigured(i){if(i._terminated)throw new FirestoreError(N.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||__PRIVATE_configureFirestore(i),i._firestoreClient}function __PRIVATE_configureFirestore(i){const e=i._freezeSettings(),t=(function(r,s,a,l){return new DatabaseInfo(r,s,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,__PRIVATE_cloneLongPollingOptions(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(i._databaseId,i._app?.options.appId||"",i._persistenceKey,e);i._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(i._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),i._firestoreClient=new FirestoreClient(i._authCredentials,i._appCheckCredentials,i._queue,t,i._componentsProvider&&(function(r){const s=r?._online.build();return{_offline:r?._offline.build(s),_online:s}})(i._componentsProvider))}class AggregateField{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class AggregateQuerySnapshot{constructor(e,t,n){this._userDataWriter=t,this._data=n,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class Bytes{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Bytes(ByteString.fromBase64String(e))}catch(t){throw new FirestoreError(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Bytes(ByteString.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Bytes._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(__PRIVATE_validateJSON(e,Bytes._jsonSchema))return Bytes.fromBase64String(e.bytes)}}Bytes._jsonSchemaVersion="firestore/bytes/1.0",Bytes._jsonSchema={type:property("string",Bytes._jsonSchemaVersion),bytes:property("string")};class FieldPath{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new FirestoreError(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new FieldPath$1(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class FieldValue{constructor(e){this._methodName=e}}class GeoPoint{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new FirestoreError(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new FirestoreError(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return __PRIVATE_primitiveComparator(this._lat,e._lat)||__PRIVATE_primitiveComparator(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:GeoPoint._jsonSchemaVersion}}static fromJSON(e){if(__PRIVATE_validateJSON(e,GeoPoint._jsonSchema))return new GeoPoint(e.latitude,e.longitude)}}GeoPoint._jsonSchemaVersion="firestore/geoPoint/1.0",GeoPoint._jsonSchema={type:property("string",GeoPoint._jsonSchemaVersion),latitude:property("number"),longitude:property("number")};class VectorValue{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(n,r){if(n.length!==r.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==r[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:VectorValue._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(__PRIVATE_validateJSON(e,VectorValue._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new VectorValue(e.vectorValues);throw new FirestoreError(N.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}VectorValue._jsonSchemaVersion="firestore/vectorValue/1.0",VectorValue._jsonSchema={type:property("string",VectorValue._jsonSchemaVersion),vectorValues:property("object")};const hn=/^__.*__$/;class ParsedSetData{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new __PRIVATE_PatchMutation(e,this.data,this.fieldMask,t,this.fieldTransforms):new __PRIVATE_SetMutation(e,this.data,t,this.fieldTransforms)}}class ParsedUpdateData{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new __PRIVATE_PatchMutation(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function __PRIVATE_isWrite(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fail(40011,{Ac:i})}}class __PRIVATE_ParseContextImpl{constructor(e,t,n,r,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new __PRIVATE_ParseContextImpl({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return __PRIVATE_createError(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(__PRIVATE_isWrite(this.Ac)&&hn.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class __PRIVATE_UserDataReader{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||__PRIVATE_newSerializer(e)}Cc(e,t,n,r=!1){return new __PRIVATE_ParseContextImpl({Ac:e,methodName:t,Dc:n,path:FieldPath$1.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function __PRIVATE_newUserDataReader(i){const e=i._freezeSettings(),t=__PRIVATE_newSerializer(i._databaseId);return new __PRIVATE_UserDataReader(i._databaseId,!!e.ignoreUndefinedProperties,t)}function __PRIVATE_parseSetData(i,e,t,n,r,s={}){const a=i.Cc(s.merge||s.mergeFields?2:0,e,t,r);__PRIVATE_validatePlainObject("Data must be an object, but it was:",a,n);const l=__PRIVATE_parseObject(n,a);let u,d;if(s.merge)u=new FieldMask(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){const h=[];for(const p of s.mergeFields){const m=__PRIVATE_fieldPathFromArgument$1(e,p,t);if(!a.contains(m))throw new FirestoreError(N.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);__PRIVATE_fieldMaskContains(h,m)||h.push(m)}u=new FieldMask(h),d=a.fieldTransforms.filter((p=>u.covers(p.field)))}else u=null,d=a.fieldTransforms;return new ParsedSetData(new ObjectValue(l),u,d)}class __PRIVATE_DeleteFieldValueImpl extends FieldValue{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof __PRIVATE_DeleteFieldValueImpl}}function __PRIVATE_createSentinelChildContext(i,e,t){return new __PRIVATE_ParseContextImpl({Ac:3,Dc:e.settings.Dc,methodName:i._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class __PRIVATE_ServerTimestampFieldValueImpl extends FieldValue{_toFieldTransform(e){return new FieldTransform(e.path,new __PRIVATE_ServerTimestampTransform)}isEqual(e){return e instanceof __PRIVATE_ServerTimestampFieldValueImpl}}class __PRIVATE_ArrayUnionFieldValueImpl extends FieldValue{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=__PRIVATE_createSentinelChildContext(this,e,!0),n=this.vc.map((s=>__PRIVATE_parseData(s,t))),r=new __PRIVATE_ArrayUnionTransformOperation(n);return new FieldTransform(e.path,r)}isEqual(e){return e instanceof __PRIVATE_ArrayUnionFieldValueImpl&&deepEqual(this.vc,e.vc)}}class __PRIVATE_ArrayRemoveFieldValueImpl extends FieldValue{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=__PRIVATE_createSentinelChildContext(this,e,!0),n=this.vc.map((s=>__PRIVATE_parseData(s,t))),r=new __PRIVATE_ArrayRemoveTransformOperation(n);return new FieldTransform(e.path,r)}isEqual(e){return e instanceof __PRIVATE_ArrayRemoveFieldValueImpl&&deepEqual(this.vc,e.vc)}}function __PRIVATE_parseUpdateData(i,e,t,n){const r=i.Cc(1,e,t);__PRIVATE_validatePlainObject("Data must be an object, but it was:",r,n);const s=[],a=ObjectValue.empty();forEach(n,((u,d)=>{const h=__PRIVATE_fieldPathFromDotSeparatedString(e,u,t);d=getModularInstance(d);const p=r.yc(h);if(d instanceof __PRIVATE_DeleteFieldValueImpl)s.push(h);else{const m=__PRIVATE_parseData(d,p);m!=null&&(s.push(h),a.set(h,m))}}));const l=new FieldMask(s);return new ParsedUpdateData(a,l,r.fieldTransforms)}function __PRIVATE_parseUpdateVarargs(i,e,t,n,r,s){const a=i.Cc(1,e,t),l=[__PRIVATE_fieldPathFromArgument$1(e,n,t)],u=[r];if(s.length%2!=0)throw new FirestoreError(N.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<s.length;m+=2)l.push(__PRIVATE_fieldPathFromArgument$1(e,s[m])),u.push(s[m+1]);const d=[],h=ObjectValue.empty();for(let m=l.length-1;m>=0;--m)if(!__PRIVATE_fieldMaskContains(d,l[m])){const g=l[m];let v=u[m];v=getModularInstance(v);const _=a.yc(g);if(v instanceof __PRIVATE_DeleteFieldValueImpl)d.push(g);else{const b=__PRIVATE_parseData(v,_);b!=null&&(d.push(g),h.set(g,b))}}const p=new FieldMask(d);return new ParsedUpdateData(h,p,a.fieldTransforms)}function __PRIVATE_parseQueryValue(i,e,t,n=!1){return __PRIVATE_parseData(t,i.Cc(n?4:3,e))}function __PRIVATE_parseData(i,e){if(__PRIVATE_looksLikeJsonObject(i=getModularInstance(i)))return __PRIVATE_validatePlainObject("Unsupported field value:",e,i),__PRIVATE_parseObject(i,e);if(i instanceof FieldValue)return(function(n,r){if(!__PRIVATE_isWrite(r.Ac))throw r.Sc(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(r);s&&r.fieldTransforms.push(s)})(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(n,r){const s=[];let a=0;for(const l of n){let u=__PRIVATE_parseData(l,r.wc(a));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),a++}return{arrayValue:{values:s}}})(i,e)}return(function(n,r){if((n=getModularInstance(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return toNumber(r.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const s=Timestamp.fromDate(n);return{timestampValue:toTimestamp(r.serializer,s)}}if(n instanceof Timestamp){const s=new Timestamp(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:toTimestamp(r.serializer,s)}}if(n instanceof GeoPoint)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Bytes)return{bytesValue:__PRIVATE_toBytes(r.serializer,n._byteString)};if(n instanceof DocumentReference){const s=r.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw r.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:__PRIVATE_toResourceName(n.firestore._databaseId||r.databaseId,n._key.path)}}if(n instanceof VectorValue)return(function(a,l){return{mapValue:{fields:{[ht]:{stringValue:It},[Et]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return __PRIVATE_toDouble(l.serializer,d)}))}}}}}})(n,r);throw r.Sc(`Unsupported field value: ${__PRIVATE_valueDescription(n)}`)})(i,e)}function __PRIVATE_parseObject(i,e){const t={};return isEmpty(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):forEach(i,((n,r)=>{const s=__PRIVATE_parseData(r,e.mc(n));s!=null&&(t[n]=s)})),{mapValue:{fields:t}}}function __PRIVATE_looksLikeJsonObject(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof Timestamp||i instanceof GeoPoint||i instanceof Bytes||i instanceof DocumentReference||i instanceof FieldValue||i instanceof VectorValue)}function __PRIVATE_validatePlainObject(i,e,t){if(!__PRIVATE_looksLikeJsonObject(t)||!__PRIVATE_isPlainObject(t)){const n=__PRIVATE_valueDescription(t);throw n==="an object"?e.Sc(i+" a custom object"):e.Sc(i+" "+n)}}function __PRIVATE_fieldPathFromArgument$1(i,e,t){if((e=getModularInstance(e))instanceof FieldPath)return e._internalPath;if(typeof e=="string")return __PRIVATE_fieldPathFromDotSeparatedString(i,e);throw __PRIVATE_createError("Field path arguments must be of type string or ",i,!1,void 0,t)}const Pn=new RegExp("[~\\*/\\[\\]]");function __PRIVATE_fieldPathFromDotSeparatedString(i,e,t){if(e.search(Pn)>=0)throw __PRIVATE_createError(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new FieldPath(...e.split("."))._internalPath}catch{throw __PRIVATE_createError(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function __PRIVATE_createError(i,e,t,n,r){const s=n&&!n.isEmpty(),a=r!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(s||a)&&(u+=" (found",s&&(u+=` in field ${n}`),a&&(u+=` in document ${r}`),u+=")"),new FirestoreError(N.INVALID_ARGUMENT,l+i+u)}function __PRIVATE_fieldMaskContains(i,e){return i.some((t=>t.isEqual(e)))}class DocumentSnapshot$1{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new DocumentReference(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new QueryDocumentSnapshot$1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class QueryDocumentSnapshot$1 extends DocumentSnapshot$1{data(){return super.data()}}function __PRIVATE_fieldPathFromArgument(i,e){return typeof e=="string"?__PRIVATE_fieldPathFromDotSeparatedString(i,e):e instanceof FieldPath?e._internalPath:e._delegate._internalPath}function __PRIVATE_validateHasExplicitOrderByForLimitToLast(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new FirestoreError(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class AppliableConstraint{}class QueryConstraint extends AppliableConstraint{}function query(i,e,...t){let n=[];e instanceof AppliableConstraint&&n.push(e),n=n.concat(t),(function(s){const a=s.filter((u=>u instanceof QueryCompositeFilterConstraint)).length,l=s.filter((u=>u instanceof QueryFieldFilterConstraint)).length;if(a>1||a>0&&l>0)throw new FirestoreError(N.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const r of n)i=r._apply(i);return i}class QueryFieldFilterConstraint extends QueryConstraint{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new QueryFieldFilterConstraint(e,t,n)}_apply(e){const t=this._parse(e);return __PRIVATE_validateNewFieldFilter(e._query,t),new Query(e.firestore,e.converter,__PRIVATE_queryWithAddedFilter(e._query,t))}_parse(e){const t=__PRIVATE_newUserDataReader(e.firestore);return(function(s,a,l,u,d,h,p){let m;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){__PRIVATE_validateDisjunctiveFilterElements(p,h);const v=[];for(const _ of p)v.push(__PRIVATE_parseDocumentIdValue(u,s,_));m={arrayValue:{values:v}}}else m=__PRIVATE_parseDocumentIdValue(u,s,p)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||__PRIVATE_validateDisjunctiveFilterElements(p,h),m=__PRIVATE_parseQueryValue(l,a,p,h==="in"||h==="not-in");return FieldFilter.create(d,h,m)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function where(i,e,t){const n=e,r=__PRIVATE_fieldPathFromArgument("where",i);return QueryFieldFilterConstraint._create(r,n,t)}class QueryCompositeFilterConstraint extends AppliableConstraint{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new QueryCompositeFilterConstraint(e,t)}_parse(e){const t=this._queryConstraints.map((n=>n._parse(e))).filter((n=>n.getFilters().length>0));return t.length===1?t[0]:CompositeFilter.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(r,s){let a=r;const l=s.getFlattenedFilters();for(const u of l)__PRIVATE_validateNewFieldFilter(a,u),a=__PRIVATE_queryWithAddedFilter(a,u)})(e._query,t),new Query(e.firestore,e.converter,__PRIVATE_queryWithAddedFilter(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class QueryOrderByConstraint extends QueryConstraint{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new QueryOrderByConstraint(e,t)}_apply(e){const t=(function(r,s,a){if(r.startAt!==null)throw new FirestoreError(N.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new FirestoreError(N.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new OrderBy(s,a)})(e._query,this._field,this._direction);return new Query(e.firestore,e.converter,(function(r,s){const a=r.explicitOrderBy.concat([s]);return new __PRIVATE_QueryImpl(r.path,r.collectionGroup,a,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)})(e._query,t))}}function orderBy(i,e="asc"){const t=e,n=__PRIVATE_fieldPathFromArgument("orderBy",i);return QueryOrderByConstraint._create(n,t)}function __PRIVATE_parseDocumentIdValue(i,e,t){if(typeof(t=getModularInstance(t))=="string"){if(t==="")throw new FirestoreError(N.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!__PRIVATE_isCollectionGroupQuery(e)&&t.indexOf("/")!==-1)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(ResourcePath.fromString(t));if(!DocumentKey.isDocumentKey(n))throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return __PRIVATE_refValue(i,new DocumentKey(n))}if(t instanceof DocumentReference)return __PRIVATE_refValue(i,t._key);throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${__PRIVATE_valueDescription(t)}.`)}function __PRIVATE_validateDisjunctiveFilterElements(i,e){if(!Array.isArray(i)||i.length===0)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function __PRIVATE_validateNewFieldFilter(i,e){const t=(function(r,s){for(const a of r)for(const l of a.getFlattenedFilters())if(s.indexOf(l.op)>=0)return l.op;return null})(i.filters,(function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class AbstractUserDataWriter{convertValue(e,t="none"){switch(__PRIVATE_typeOrder(e)){case 0:return null;case 1:return e.booleanValue;case 2:return __PRIVATE_normalizeNumber(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(__PRIVATE_normalizeByteString(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw fail(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return forEach(e,((r,s)=>{n[r]=this.convertValue(s,t)})),n}convertVectorValue(e){const t=e.fields?.[Et].arrayValue?.values?.map((n=>__PRIVATE_normalizeNumber(n.doubleValue)));return new VectorValue(t)}convertGeoPoint(e){return new GeoPoint(__PRIVATE_normalizeNumber(e.latitude),__PRIVATE_normalizeNumber(e.longitude))}convertArray(e,t){return(e.values||[]).map((n=>this.convertValue(n,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=__PRIVATE_getPreviousValue(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(__PRIVATE_getLocalWriteTime(e));default:return null}}convertTimestamp(e){const t=__PRIVATE_normalizeTimestamp(e);return new Timestamp(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ResourcePath.fromString(e);__PRIVATE_hardAssert(__PRIVATE_isValidResourceName(n),9688,{name:e});const r=new DatabaseId(n.get(1),n.get(3)),s=new DocumentKey(n.popFirst(5));return r.isEqual(t)||__PRIVATE_logError(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function __PRIVATE_applyFirestoreDataConverter(i,e,t){let n;return n=i?t&&(t.merge||t.mergeFields)?i.toFirestore(e,t):i.toFirestore(e):e,n}function count(){return new AggregateField("count")}class SnapshotMetadata{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class DocumentSnapshot extends DocumentSnapshot$1{constructor(e,t,n,r,s,a){super(e,t,n,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new QueryDocumentSnapshot(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new FirestoreError(N.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=DocumentSnapshot._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}DocumentSnapshot._jsonSchemaVersion="firestore/documentSnapshot/1.0",DocumentSnapshot._jsonSchema={type:property("string",DocumentSnapshot._jsonSchemaVersion),bundleSource:property("string","DocumentSnapshot"),bundleName:property("string"),bundle:property("string")};class QueryDocumentSnapshot extends DocumentSnapshot{data(e={}){return super.data(e)}}class QuerySnapshot{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new SnapshotMetadata(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new QueryDocumentSnapshot(this._firestore,this._userDataWriter,n.key,n,new SnapshotMetadata(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new FirestoreError(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,s){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map((l=>{const u=new QueryDocumentSnapshot(r._firestore,r._userDataWriter,l.doc.key,l.doc,new SnapshotMetadata(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((l=>s||l.type!==3)).map((l=>{const u=new QueryDocumentSnapshot(r._firestore,r._userDataWriter,l.doc.key,l.doc,new SnapshotMetadata(r._snapshot.mutatedKeys.has(l.doc.key),r._snapshot.fromCache),r.query.converter);let d=-1,h=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),h=a.indexOf(l.doc.key)),{type:__PRIVATE_resultChangeType(l.type),doc:u,oldIndex:d,newIndex:h}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new FirestoreError(N.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=QuerySnapshot._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=__PRIVATE_AutoId.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach((s=>{s._document!==null&&(t.push(s._document),n.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),r.push(s.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function __PRIVATE_resultChangeType(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fail(61501,{type:i})}}function getDoc(i){i=__PRIVATE_cast(i,DocumentReference);const e=__PRIVATE_cast(i.firestore,Firestore);return __PRIVATE_firestoreClientGetDocumentViaSnapshotListener(ensureFirestoreConfigured(e),i._key).then((t=>__PRIVATE_convertToDocSnapshot(e,i,t)))}QuerySnapshot._jsonSchemaVersion="firestore/querySnapshot/1.0",QuerySnapshot._jsonSchema={type:property("string",QuerySnapshot._jsonSchemaVersion),bundleSource:property("string","QuerySnapshot"),bundleName:property("string"),bundle:property("string")};class __PRIVATE_ExpUserDataWriter extends AbstractUserDataWriter{constructor(e){super(),this.firestore=e}convertBytes(e){return new Bytes(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new DocumentReference(this.firestore,null,t)}}function getDocs(i){i=__PRIVATE_cast(i,Query);const e=__PRIVATE_cast(i.firestore,Firestore),t=ensureFirestoreConfigured(e),n=new __PRIVATE_ExpUserDataWriter(e);return __PRIVATE_validateHasExplicitOrderByForLimitToLast(i._query),__PRIVATE_firestoreClientGetDocumentsViaSnapshotListener(t,i._query).then((r=>new QuerySnapshot(e,n,i,r)))}function setDoc(i,e,t){i=__PRIVATE_cast(i,DocumentReference);const n=__PRIVATE_cast(i.firestore,Firestore),r=__PRIVATE_applyFirestoreDataConverter(i.converter,e,t);return executeWrite(n,[__PRIVATE_parseSetData(__PRIVATE_newUserDataReader(n),"setDoc",i._key,r,i.converter!==null,t).toMutation(i._key,Precondition.none())])}function updateDoc(i,e,t,...n){i=__PRIVATE_cast(i,DocumentReference);const r=__PRIVATE_cast(i.firestore,Firestore),s=__PRIVATE_newUserDataReader(r);let a;return a=typeof(e=getModularInstance(e))=="string"||e instanceof FieldPath?__PRIVATE_parseUpdateVarargs(s,"updateDoc",i._key,e,t,n):__PRIVATE_parseUpdateData(s,"updateDoc",i._key,e),executeWrite(r,[a.toMutation(i._key,Precondition.exists(!0))])}function deleteDoc(i){return executeWrite(__PRIVATE_cast(i.firestore,Firestore),[new __PRIVATE_DeleteMutation(i._key,Precondition.none())])}function addDoc(i,e){const t=__PRIVATE_cast(i.firestore,Firestore),n=doc(i),r=__PRIVATE_applyFirestoreDataConverter(i.converter,e);return executeWrite(t,[__PRIVATE_parseSetData(__PRIVATE_newUserDataReader(i.firestore),"addDoc",n._key,r,i.converter!==null,{}).toMutation(n._key,Precondition.exists(!1))]).then((()=>n))}function onSnapshot(i,...e){i=getModularInstance(i);let t={includeMetadataChanges:!1,source:"default"},n=0;typeof e[n]!="object"||__PRIVATE_isPartialObserver(e[n])||(t=e[n++]);const r={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(__PRIVATE_isPartialObserver(e[n])){const u=e[n];e[n]=u.next?.bind(u),e[n+1]=u.error?.bind(u),e[n+2]=u.complete?.bind(u)}let s,a,l;if(i instanceof DocumentReference)a=__PRIVATE_cast(i.firestore,Firestore),l=__PRIVATE_newQueryForPath(i._key.path),s={next:u=>{e[n]&&e[n](__PRIVATE_convertToDocSnapshot(a,i,u))},error:e[n+1],complete:e[n+2]};else{const u=__PRIVATE_cast(i,Query);a=__PRIVATE_cast(u.firestore,Firestore),l=u._query;const d=new __PRIVATE_ExpUserDataWriter(a);s={next:h=>{e[n]&&e[n](new QuerySnapshot(a,d,u,h))},error:e[n+1],complete:e[n+2]},__PRIVATE_validateHasExplicitOrderByForLimitToLast(i._query)}return(function(d,h,p,m){const g=new __PRIVATE_AsyncObserver(m),v=new __PRIVATE_QueryListener(h,g,p);return d.asyncQueue.enqueueAndForget((async()=>__PRIVATE_eventManagerListen(await __PRIVATE_getEventManager(d),v))),()=>{g.Nu(),d.asyncQueue.enqueueAndForget((async()=>__PRIVATE_eventManagerUnlisten(await __PRIVATE_getEventManager(d),v)))}})(ensureFirestoreConfigured(a),l,r,s)}function executeWrite(i,e){return(function(n,r){const s=new __PRIVATE_Deferred;return n.asyncQueue.enqueueAndForget((async()=>__PRIVATE_syncEngineWrite(await __PRIVATE_getSyncEngine(n),r,s))),s.promise})(ensureFirestoreConfigured(i),e)}function __PRIVATE_convertToDocSnapshot(i,e,t){const n=t.docs.get(e._key),r=new __PRIVATE_ExpUserDataWriter(i);return new DocumentSnapshot(i,r,e._key,n,new SnapshotMetadata(t.hasPendingWrites,t.fromCache),e.converter)}function getCountFromServer(i){return getAggregateFromServer(i,{count:count()})}function getAggregateFromServer(i,e){const t=__PRIVATE_cast(i.firestore,Firestore),n=ensureFirestoreConfigured(t),r=__PRIVATE_mapToArray(e,((s,a)=>new __PRIVATE_AggregateImpl(a,s.aggregateType,s._internalFieldPath)));return __PRIVATE_firestoreClientRunAggregateQuery(n,i._query,r).then((s=>(function(l,u,d){const h=new __PRIVATE_ExpUserDataWriter(l);return new AggregateQuerySnapshot(u,h,d)})(t,i,s)))}function serverTimestamp(){return new __PRIVATE_ServerTimestampFieldValueImpl("serverTimestamp")}function arrayUnion(...i){return new __PRIVATE_ArrayUnionFieldValueImpl("arrayUnion",i)}function arrayRemove(...i){return new __PRIVATE_ArrayRemoveFieldValueImpl("arrayRemove",i)}(function(e,t=!0){(function(r){x=r})(SDK_VERSION),_registerComponent(new Component$2("firestore",((n,{instanceIdentifier:r,options:s})=>{const a=n.getProvider("app").getImmediate(),l=new Firestore(new __PRIVATE_FirebaseAuthCredentialsProvider(n.getProvider("auth-internal")),new __PRIVATE_FirebaseAppCheckTokenProvider(a,n.getProvider("app-check-internal")),(function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new FirestoreError(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new DatabaseId(d.options.projectId,h)})(a,r),a);return s={useFetchStreams:t,...s},l._setSettings(s),l}),"PUBLIC").setMultipleInstances(!0)),registerVersion(F,M,e),registerVersion(F,M,"esm2020")})();const DEFAULT_HOST="firebasestorage.googleapis.com",CONFIG_STORAGE_BUCKET_KEY="storageBucket",DEFAULT_MAX_OPERATION_RETRY_TIME=120*1e3,DEFAULT_MAX_UPLOAD_RETRY_TIME=600*1e3;class StorageError extends FirebaseError{constructor(e,t,n=0){super(prependCode(e),`Firebase Storage: ${t} (${prependCode(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,StorageError.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return prependCode(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var StorageErrorCode;(function(i){i.UNKNOWN="unknown",i.OBJECT_NOT_FOUND="object-not-found",i.BUCKET_NOT_FOUND="bucket-not-found",i.PROJECT_NOT_FOUND="project-not-found",i.QUOTA_EXCEEDED="quota-exceeded",i.UNAUTHENTICATED="unauthenticated",i.UNAUTHORIZED="unauthorized",i.UNAUTHORIZED_APP="unauthorized-app",i.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",i.INVALID_CHECKSUM="invalid-checksum",i.CANCELED="canceled",i.INVALID_EVENT_NAME="invalid-event-name",i.INVALID_URL="invalid-url",i.INVALID_DEFAULT_BUCKET="invalid-default-bucket",i.NO_DEFAULT_BUCKET="no-default-bucket",i.CANNOT_SLICE_BLOB="cannot-slice-blob",i.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",i.NO_DOWNLOAD_URL="no-download-url",i.INVALID_ARGUMENT="invalid-argument",i.INVALID_ARGUMENT_COUNT="invalid-argument-count",i.APP_DELETED="app-deleted",i.INVALID_ROOT_OPERATION="invalid-root-operation",i.INVALID_FORMAT="invalid-format",i.INTERNAL_ERROR="internal-error",i.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(StorageErrorCode||(StorageErrorCode={}));function prependCode(i){return"storage/"+i}function unknown(){const i="An unknown error occurred, please check the error payload for server response.";return new StorageError(StorageErrorCode.UNKNOWN,i)}function retryLimitExceeded(){return new StorageError(StorageErrorCode.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function canceled(){return new StorageError(StorageErrorCode.CANCELED,"User canceled the upload/download.")}function invalidUrl(i){return new StorageError(StorageErrorCode.INVALID_URL,"Invalid URL '"+i+"'.")}function invalidDefaultBucket(i){return new StorageError(StorageErrorCode.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.")}function invalidArgument(i){return new StorageError(StorageErrorCode.INVALID_ARGUMENT,i)}function appDeleted(){return new StorageError(StorageErrorCode.APP_DELETED,"The Firebase app was deleted.")}function invalidRootOperation(i){return new StorageError(StorageErrorCode.INVALID_ROOT_OPERATION,"The operation '"+i+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}class Location{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Location.makeFromUrl(e,t)}catch{return new Location(e,"")}if(n.path==="")return n;throw invalidDefaultBucket(e)}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";function s(D){D.path.charAt(D.path.length-1)==="/"&&(D.path_=D.path_.slice(0,-1))}const a="(/(.*))?$",l=new RegExp("^gs://"+r+a,"i"),u={bucket:1,path:3};function d(D){D.path_=decodeURIComponent(D.path)}const h="v[A-Za-z0-9_]+",p=t.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",g=new RegExp(`^https?://${p}/${h}/b/${r}/o${m}`,"i"),v={bucket:1,path:3},_=t===DEFAULT_HOST?"(?:storage.googleapis.com|storage.cloud.google.com)":t,b="([^?#]*)",E=new RegExp(`^https?://${_}/${r}/${b}`,"i"),z=[{regex:l,indices:u,postModify:s},{regex:g,indices:v,postModify:d},{regex:E,indices:{bucket:1,path:2},postModify:d}];for(let D=0;D<z.length;D++){const P=z[D],G=P.regex.exec(e);if(G){const R=G[P.indices.bucket];let I=G[P.indices.path];I||(I=""),n=new Location(R,I),P.postModify(n);break}}if(n==null)throw invalidUrl(e);return n}}class FailRequest{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function start(i,e,t){let n=1,r=null,s=null,a=!1,l=0;function u(){return l===2}let d=!1;function h(...b){d||(d=!0,e.apply(null,b))}function p(b){r=setTimeout(()=>{r=null,i(g,u())},b)}function m(){s&&clearTimeout(s)}function g(b,...E){if(d){m();return}if(b){m(),h.call(null,b,...E);return}if(u()||a){m(),h.call(null,b,...E);return}n<64&&(n*=2);let z;l===1?(l=2,z=0):z=(n+Math.random())*1e3,p(z)}let v=!1;function _(b){v||(v=!0,m(),!d&&(r!==null?(b||(l=2),clearTimeout(r),p(0)):b||(l=1)))}return p(0),s=setTimeout(()=>{a=!0,_(!0)},t),_}function stop(i){i(!1)}function isJustDef(i){return i!==void 0}function validateNumber(i,e,t,n){if(n<e)throw invalidArgument(`Invalid value for '${i}'. Expected ${e} or greater.`);if(n>t)throw invalidArgument(`Invalid value for '${i}'. Expected ${t} or less.`)}function makeQueryString(i){const e=encodeURIComponent;let t="?";for(const n in i)if(i.hasOwnProperty(n)){const r=e(n)+"="+e(i[n]);t=t+r+"&"}return t=t.slice(0,-1),t}var ErrorCode;(function(i){i[i.NO_ERROR=0]="NO_ERROR",i[i.NETWORK_ERROR=1]="NETWORK_ERROR",i[i.ABORT=2]="ABORT"})(ErrorCode||(ErrorCode={}));function isRetryStatusCode(i,e){const t=i>=500&&i<600,r=[408,429].indexOf(i)!==-1,s=e.indexOf(i)!==-1;return t||r||s}class NetworkRequest{constructor(e,t,n,r,s,a,l,u,d,h,p,m=!0,g=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=a,this.callback_=l,this.errorCallback_=u,this.timeout_=d,this.progressCallback_=h,this.connectionFactory_=p,this.retry=m,this.isUsingEmulator=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((v,_)=>{this.resolve_=v,this.reject_=_,this.start_()})}start_(){const e=(n,r)=>{if(r){n(!1,new RequestEndStatus(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const a=l=>{const u=l.loaded,d=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,d)};this.progressCallback_!==null&&s.addUploadProgressListener(a),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(a),this.pendingConnection_=null;const l=s.getErrorCode()===ErrorCode.NO_ERROR,u=s.getStatus();if(!l||isRetryStatusCode(u,this.additionalRetryCodes_)&&this.retry){const h=s.getErrorCode()===ErrorCode.ABORT;n(!1,new RequestEndStatus(!1,null,h));return}const d=this.successCodes_.indexOf(u)!==-1;n(!0,new RequestEndStatus(d,s))})},t=(n,r)=>{const s=this.resolve_,a=this.reject_,l=r.connection;if(r.wasSuccessCode)try{const u=this.callback_(l,l.getResponse());isJustDef(u)?s(u):s()}catch(u){a(u)}else if(l!==null){const u=unknown();u.serverResponse=l.getErrorText(),this.errorCallback_?a(this.errorCallback_(l,u)):a(u)}else if(r.canceled){const u=this.appDelete_?appDeleted():canceled();a(u)}else{const u=retryLimitExceeded();a(u)}};this.canceled_?t(!1,new RequestEndStatus(!1,null,!0)):this.backoffId_=start(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&stop(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class RequestEndStatus{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function addAuthHeader_(i,e){e!==null&&e.length>0&&(i.Authorization="Firebase "+e)}function addVersionHeader_(i,e){i["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function addGmpidHeader_(i,e){e&&(i["X-Firebase-GMPID"]=e)}function addAppCheckHeader_(i,e){e!==null&&(i["X-Firebase-AppCheck"]=e)}function makeRequest(i,e,t,n,r,s,a=!0,l=!1){const u=makeQueryString(i.urlParams),d=i.url+u,h=Object.assign({},i.headers);return addGmpidHeader_(h,e),addAuthHeader_(h,t),addVersionHeader_(h,s),addAppCheckHeader_(h,n),new NetworkRequest(d,i.method,h,i.body,i.successCodes,i.additionalRetryCodes,i.handler,i.errorHandler,i.timeout,i.progressCallback,r,a,l)}function parent(i){if(i.length===0)return null;const e=i.lastIndexOf("/");return e===-1?"":i.slice(0,e)}function lastComponent(i){const e=i.lastIndexOf("/",i.length-2);return e===-1?i:i.slice(e+1)}class Reference{constructor(e,t){this._service=e,t instanceof Location?this._location=t:this._location=Location.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Reference(e,t)}get root(){const e=new Location(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return lastComponent(this._location.path)}get storage(){return this._service}get parent(){const e=parent(this._location.path);if(e===null)return null;const t=new Location(this._location.bucket,e);return new Reference(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw invalidRootOperation(e)}}function extractBucket(i,e){const t=e?.[CONFIG_STORAGE_BUCKET_KEY];return t==null?null:Location.makeFromBucketSpec(t,i)}function connectStorageEmulator$1(i,e,t,n={}){i.host=`${e}:${t}`;const r=isCloudWorkstation(e);r&&(pingServer(`https://${i.host}/b`),updateEmulatorBanner("Storage",!0)),i._isUsingEmulator=!0,i._protocol=r?"https":"http";const{mockUserToken:s}=n;s&&(i._overrideAuthToken=typeof s=="string"?s:createMockUserToken(s,i.app.options.projectId))}class FirebaseStorageImpl{constructor(e,t,n,r,s,a=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=s,this._isUsingEmulator=a,this._bucket=null,this._host=DEFAULT_HOST,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=DEFAULT_MAX_OPERATION_RETRY_TIME,this._maxUploadRetryTime=DEFAULT_MAX_UPLOAD_RETRY_TIME,this._requests=new Set,r!=null?this._bucket=Location.makeFromBucketSpec(r,this._host):this._bucket=extractBucket(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Location.makeFromBucketSpec(this._url,e):this._bucket=extractBucket(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){validateNumber("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){validateNumber("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(_isFirebaseServerApp(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Reference(this,e)}_makeRequest(e,t,n,r,s=!0){if(this._deleted)return new FailRequest(appDeleted());{const a=makeRequest(e,this._appId,n,r,t,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const name="@firebase/storage",version$8="0.14.0";const STORAGE_TYPE="storage";function getStorage(i=getApp(),e){i=getModularInstance(i);const n=_getProvider(i,STORAGE_TYPE).getImmediate({identifier:e}),r=getDefaultEmulatorHostnameAndPort("storage");return r&&connectStorageEmulator(n,...r),n}function connectStorageEmulator(i,e,t,n={}){connectStorageEmulator$1(i,e,t,n)}function factory$1(i,{instanceIdentifier:e}){const t=i.getProvider("app").getImmediate(),n=i.getProvider("auth-internal"),r=i.getProvider("app-check-internal");return new FirebaseStorageImpl(t,n,r,e,SDK_VERSION)}function registerStorage(){_registerComponent(new Component$2(STORAGE_TYPE,factory$1,"PUBLIC").setMultipleInstances(!0)),registerVersion(name,version$8,""),registerVersion(name,version$8,"esm2020")}registerStorage();const firebaseConfig={apiKey:"AIzaSyChE69ZDE8KcEfT0Z9eUnD6XvOs2qq4Dm8",authDomain:"abpc-64d8b.firebaseapp.com",projectId:"abpc-64d8b",databaseURL:"https://abpc-64d8b-default-rtdb.firebaseio.com",storageBucket:"abpc-64d8b.firebasestorage.app",messagingSenderId:"611307120927",appId:"1:611307120927:web:d759a2fc66bec9cdefa82a",measurementId:"G-K0ETV96SF6"},app=initializeApp(firebaseConfig),auth=getAuth(app);new GoogleAuthProvider;const db=getFirestore(app);getStorage(app);const AuthContext=reactExports.createContext(),useAuth=()=>reactExports.useContext(AuthContext),AuthProvider=({children:i})=>{const[e,t]=reactExports.useState(null),[n,r]=reactExports.useState(null),[s,a]=reactExports.useState(!0);function l(h,p){return signInWithEmailAndPassword(auth,h,p)}function u(){return r(null),signOut(auth)}reactExports.useEffect(()=>onAuthStateChanged(auth,async p=>{if(p){const m=await getDoc(doc(db,"users",p.uid));m.exists()?r(m.data().role||"student"):r("student"),t(p)}else t(null),r(null);a(!1)}),[]);const d={currentUser:e,userRole:n,loading:s,login:l,logout:u};return jsxRuntimeExports.jsx(AuthContext.Provider,{value:d,children:!s&&i})};const toKebabCase=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),toCamelCase=i=>i.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),toPascalCase=i=>{const e=toCamelCase(i);return e.charAt(0).toUpperCase()+e.slice(1)},mergeClasses=(...i)=>i.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),hasA11yProp=i=>{for(const e in i)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Icon=reactExports.forwardRef(({color:i="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:r="",children:s,iconNode:a,...l},u)=>reactExports.createElement("svg",{ref:u,...defaultAttributes,width:e,height:e,stroke:i,strokeWidth:n?Number(t)*24/Number(e):t,className:mergeClasses("lucide",r),...!s&&!hasA11yProp(l)&&{"aria-hidden":"true"},...l},[...a.map(([d,h])=>reactExports.createElement(d,h)),...Array.isArray(s)?s:[s]]));const createLucideIcon=(i,e)=>{const t=reactExports.forwardRef(({className:n,...r},s)=>reactExports.createElement(Icon,{ref:s,iconNode:e,className:mergeClasses(`lucide-${toKebabCase(toPascalCase(i))}`,`lucide-${i}`,n),...r}));return t.displayName=toPascalCase(i),t};const __iconNode$x=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ArrowLeft=createLucideIcon("arrow-left",__iconNode$x);const __iconNode$w=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Bell=createLucideIcon("bell",__iconNode$w);const __iconNode$v=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],BookOpen=createLucideIcon("book-open",__iconNode$v);const __iconNode$u=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],Book=createLucideIcon("book",__iconNode$u);const __iconNode$t=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ChevronRight=createLucideIcon("chevron-right",__iconNode$t);const __iconNode$s=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],CircleCheckBig=createLucideIcon("circle-check-big",__iconNode$s);const __iconNode$r=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],CirclePlay=createLucideIcon("circle-play",__iconNode$r);const __iconNode$q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],CircleQuestionMark=createLucideIcon("circle-question-mark",__iconNode$q);const __iconNode$p=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]],CircleUser=createLucideIcon("circle-user",__iconNode$p);const __iconNode$o=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Clock=createLucideIcon("clock",__iconNode$o);const __iconNode$n=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Download=createLucideIcon("download",__iconNode$n);const __iconNode$m=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],FileText=createLucideIcon("file-text",__iconNode$m);const __iconNode$l=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Folder=createLucideIcon("folder",__iconNode$l);const __iconNode$k=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Heart=createLucideIcon("heart",__iconNode$k);const __iconNode$j=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],House=createLucideIcon("house",__iconNode$j);const __iconNode$i=[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]],IndianRupee=createLucideIcon("indian-rupee",__iconNode$i);const __iconNode$h=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Layers=createLucideIcon("layers",__iconNode$h);const __iconNode$g=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],LayoutDashboard=createLucideIcon("layout-dashboard",__iconNode$g);const __iconNode$f=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Lock=createLucideIcon("lock",__iconNode$f);const __iconNode$e=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],LogOut=createLucideIcon("log-out",__iconNode$e);const __iconNode$d=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Mail=createLucideIcon("mail",__iconNode$d);const __iconNode$c=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],Menu$1=createLucideIcon("menu",__iconNode$c);const __iconNode$b=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],MessageCircle=createLucideIcon("message-circle",__iconNode$b);const __iconNode$a=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Phone=createLucideIcon("phone",__iconNode$a);const __iconNode$9=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Plus=createLucideIcon("plus",__iconNode$9);const __iconNode$8=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Search=createLucideIcon("search",__iconNode$8);const __iconNode$7=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Send=createLucideIcon("send",__iconNode$7);const __iconNode$6=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Settings=createLucideIcon("settings",__iconNode$6);const __iconNode$5=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Shield=createLucideIcon("shield",__iconNode$5);const __iconNode$4=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Trash2=createLucideIcon("trash-2",__iconNode$4);const __iconNode$3=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],TrendingUp=createLucideIcon("trending-up",__iconNode$3);const __iconNode$2=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Users=createLucideIcon("users",__iconNode$2);const __iconNode$1=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Video=createLucideIcon("video",__iconNode$1);const __iconNode=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],X=createLucideIcon("x",__iconNode),BottomNav=()=>{const i=useLocation(),e=t=>i.pathname===t;return jsxRuntimeExports.jsxs("div",{className:"fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 flex justify-around items-center py-3 z-50 md:hidden shadow-[0_-2px_10px_rgba(0,0,0,0.05)]",children:[jsxRuntimeExports.jsxs(Link,{to:"/student/home",className:"flex flex-col items-center gap-1",children:[jsxRuntimeExports.jsx(House,{size:24,className:e("/student/home")?"text-blue-600 fill-blue-100":"text-gray-500"}),jsxRuntimeExports.jsx("span",{className:`text-[10px] font-medium ${e("/student/home")?"text-blue-600":"text-gray-500"}`,children:"Home"})]}),jsxRuntimeExports.jsxs(Link,{to:"/student",className:"flex flex-col items-center gap-1",children:[jsxRuntimeExports.jsx(BookOpen,{size:24,className:e("/student")?"text-blue-600 fill-blue-100":"text-gray-500"}),jsxRuntimeExports.jsx("span",{className:`text-[10px] font-medium ${e("/student")?"text-blue-600":"text-gray-500"}`,children:"Courses"})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-1 opacity-50",children:[jsxRuntimeExports.jsx(CircleUser,{size:24,className:"text-gray-500"}),jsxRuntimeExports.jsx("span",{className:"text-[10px] font-medium text-gray-500",children:"Profile"})]})]})},Sidebar=({isOpen:i,onClose:e})=>{const{logout:t}=useAuth(),n=useNavigate(),r=useLocation(),s=l=>r.pathname===l,a=async()=>{try{await t(),n("/login")}catch(l){console.error("Logout failed",l)}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[i&&jsxRuntimeExports.jsx("div",{onClick:e,className:"fixed inset-0 bg-black/50 z-40 md:hidden"}),jsxRuntimeExports.jsxs("div",{className:`
        fixed top-0 left-0 h-full w-64 bg-white border-r z-50 shadow-lg transform transition-transform duration-300
        ${i?"translate-x-0":"-translate-x-full"} 
        md:translate-x-0 md:static md:shadow-none
        flex flex-col
      `,children:[jsxRuntimeExports.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-blue-600",children:"ABP Classes"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"md:hidden text-gray-500 hover:text-red-500",children:jsxRuntimeExports.jsx(X,{size:24})})]}),jsxRuntimeExports.jsxs("nav",{className:"flex-1 p-4 space-y-2",children:[jsxRuntimeExports.jsxs(Link,{to:"/student/home",onClick:e,className:`flex items-center gap-3 p-3 rounded-lg transition font-medium ${s("/student/home")?"bg-blue-50 text-blue-600":"text-gray-700 hover:bg-gray-50 hover:text-blue-600"}`,children:[jsxRuntimeExports.jsx(House,{size:20}),jsxRuntimeExports.jsx("span",{children:"Home"})]}),jsxRuntimeExports.jsxs(Link,{to:"/student/my-courses",onClick:e,className:`flex items-center gap-3 p-3 rounded-lg transition font-medium ${s("/student/my-courses")?"bg-blue-50 text-blue-600":"text-gray-700 hover:bg-gray-50 hover:text-blue-600"}`,children:[jsxRuntimeExports.jsx(BookOpen,{size:20}),jsxRuntimeExports.jsx("span",{children:"My Courses"})]}),jsxRuntimeExports.jsxs(Link,{to:"/student/profile",onClick:e,className:`flex items-center gap-3 p-3 rounded-lg transition font-medium ${s("/student/profile")?"bg-blue-50 text-blue-600":"text-gray-700 hover:bg-gray-50 hover:text-blue-600"}`,children:[jsxRuntimeExports.jsx(CircleUser,{size:20}),jsxRuntimeExports.jsx("span",{children:"My Profile"})]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t",children:jsxRuntimeExports.jsxs("button",{onClick:a,className:"flex items-center gap-3 w-full p-3 text-red-600 hover:bg-red-50 rounded-lg transition font-medium",children:[jsxRuntimeExports.jsx(LogOut,{size:20}),jsxRuntimeExports.jsx("span",{children:"Logout"})]})})]})]})},AdminSidebar=({isOpen:i,onClose:e})=>{const{logout:t}=useAuth(),n=useNavigate(),r=useLocation(),s=l=>r.pathname.startsWith(l),a=async()=>{try{await t(),n("/login")}catch(l){console.error("Logout failed",l)}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[i&&jsxRuntimeExports.jsx("div",{onClick:e,className:"fixed inset-0 bg-black/50 z-40 md:hidden"}),jsxRuntimeExports.jsxs("div",{className:`
        fixed top-0 left-0 min-h-screen w-64 bg-slate-900 text-white border-r border-slate-800 z-50 shadow-lg transform transition-transform duration-300
        ${i?"translate-x-0":"-translate-x-full"} 
        md:translate-x-0 md:static md:shadow-none
        flex flex-col
      `,children:[jsxRuntimeExports.jsxs("div",{className:"p-6 border-b border-slate-800 flex justify-between items-center",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-white",children:"Admin Panel"}),jsxRuntimeExports.jsx("button",{onClick:e,className:"md:hidden text-gray-400 hover:text-white",children:jsxRuntimeExports.jsx(X,{size:24})})]}),jsxRuntimeExports.jsxs("nav",{className:"flex-1 p-4 space-y-2",children:[jsxRuntimeExports.jsxs(Link,{to:"/admin/dashboard",onClick:e,className:`flex items-center gap-3 p-3 rounded-lg transition font-medium ${s("/admin/dashboard")?"bg-blue-600 text-white":"text-gray-400 hover:bg-slate-800 hover:text-white"}`,children:[jsxRuntimeExports.jsx(LayoutDashboard,{size:20}),jsxRuntimeExports.jsx("span",{children:"Dashboard"})]}),jsxRuntimeExports.jsxs(Link,{to:"/admin/batches",onClick:e,className:`flex items-center gap-3 p-3 rounded-lg transition font-medium ${s("/admin/batches")||s("/admin/batch")?"bg-blue-600 text-white":"text-gray-400 hover:bg-slate-800 hover:text-white"}`,children:[jsxRuntimeExports.jsx(Layers,{size:20}),jsxRuntimeExports.jsx("span",{children:"Batches"})]}),jsxRuntimeExports.jsxs(Link,{to:"/admin/students",onClick:e,className:`flex items-center gap-3 p-3 rounded-lg transition font-medium ${s("/admin/students")?"bg-blue-600 text-white":"text-gray-400 hover:bg-slate-800 hover:text-white"}`,children:[jsxRuntimeExports.jsx(Users,{size:20}),jsxRuntimeExports.jsx("span",{children:"Students"})]}),jsxRuntimeExports.jsxs(Link,{to:"/admin/students/doubts",onClick:e,className:`flex items-center gap-3 p-3 rounded-lg transition font-medium ${s("/admin/students/doubts")?"bg-blue-600 text-white":"text-gray-400 hover:bg-slate-800 hover:text-white"}`,children:[jsxRuntimeExports.jsx(CircleQuestionMark,{size:20}),jsxRuntimeExports.jsx("span",{children:"Doubt Solver"})]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-slate-800",children:jsxRuntimeExports.jsxs("button",{onClick:a,className:"flex items-center gap-3 w-full p-3 text-red-400 hover:bg-red-500/10 rounded-lg transition font-medium",children:[jsxRuntimeExports.jsx(LogOut,{size:20}),jsxRuntimeExports.jsx("span",{children:"Logout"})]})})]})]})},Footer=()=>jsxRuntimeExports.jsx("footer",{className:"bg-white border-t py-6 mt-auto",children:jsxRuntimeExports.jsxs("div",{className:"container mx-auto px-4 text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:" 2026 ABP Classes. All rights reserved."}),jsxRuntimeExports.jsxs("div",{className:"flex justify-center items-center gap-1 mt-2 text-xs text-gray-400",children:["Made with ",jsxRuntimeExports.jsx(Heart,{size:12,className:"text-red-500 fill-red-500"})," for Students"]})]})}),Login=()=>{const i=useNavigate(),[e,t]=reactExports.useState(""),[n,r]=reactExports.useState(""),[s,a]=reactExports.useState(!1),[l,u]=reactExports.useState(""),d=async h=>{h.preventDefault(),a(!0),u("");try{await signInWithEmailAndPassword(auth,e,n),alert("Login Successful! Welcome Back."),i("/student/home")}catch(p){u("Invalid Email or Password"),console.error(p)}a(!1)};return jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg w-full max-w-md",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-center mb-6 text-blue-600",children:"Student Login"}),l&&jsxRuntimeExports.jsx("p",{className:"bg-red-100 text-red-600 p-2 rounded text-sm mb-4",children:l}),jsxRuntimeExports.jsxs("form",{onSubmit:d,className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email Address"}),jsxRuntimeExports.jsx("input",{required:!0,type:"email",placeholder:"student@example.com",className:"w-full border p-2 rounded mt-1",value:e,onChange:h=>t(h.target.value)})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),jsxRuntimeExports.jsx("input",{required:!0,type:"password",placeholder:"Enter password",className:"w-full border p-2 rounded mt-1",value:n,onChange:h=>r(h.target.value)})]}),jsxRuntimeExports.jsx("button",{disabled:s,className:"w-full bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-700",children:s?"Logging in...":"Login"})]}),jsxRuntimeExports.jsxs("p",{className:"text-center mt-4 text-sm text-gray-600",children:["New Student? ",jsxRuntimeExports.jsx(Link,{to:"/signup",className:"text-blue-600 font-bold hover:underline",children:"Register Here"})]})]})})},Signup=()=>{const i=useNavigate(),[e,t]=reactExports.useState({name:"",email:"",password:"",phone:""}),[n,r]=reactExports.useState(!1),[s,a]=reactExports.useState(""),l=async u=>{u.preventDefault(),r(!0),a("");try{const h=(await createUserWithEmailAndPassword(auth,e.email,e.password)).user;await updateProfile(h,{displayName:e.name}),await setDoc(doc(db,"users",h.uid),{uid:h.uid,name:e.name,email:e.email,phone:e.phone,role:"student",createdAt:new Date}),alert("Account Created Successfully! "),i("/")}catch(d){a(d.message)}r(!1)};return jsxRuntimeExports.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg w-full max-w-md",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-center mb-6 text-blue-600",children:"Create Account"}),s&&jsxRuntimeExports.jsx("p",{className:"bg-red-100 text-red-600 p-2 rounded text-sm mb-4",children:s}),jsxRuntimeExports.jsxs("form",{onSubmit:l,className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),jsxRuntimeExports.jsx("input",{required:!0,type:"text",placeholder:"Enter your name",className:"w-full border p-2 rounded mt-1",value:e.name,onChange:u=>t({...e,name:u.target.value})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone Number"}),jsxRuntimeExports.jsx("input",{required:!0,type:"tel",placeholder:"Mobile number",className:"w-full border p-2 rounded mt-1",value:e.phone,onChange:u=>t({...e,phone:u.target.value})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email Address"}),jsxRuntimeExports.jsx("input",{required:!0,type:"email",placeholder:"student@example.com",className:"w-full border p-2 rounded mt-1",value:e.email,onChange:u=>t({...e,email:u.target.value})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),jsxRuntimeExports.jsx("input",{required:!0,type:"password",placeholder:"Create a password",className:"w-full border p-2 rounded mt-1",value:e.password,onChange:u=>t({...e,password:u.target.value})})]}),jsxRuntimeExports.jsx("button",{disabled:n,className:"w-full bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-700",children:n?"Creating Account...":"Register"})]}),jsxRuntimeExports.jsxs("p",{className:"text-center text-sm text-gray-500 mt-4",children:["Already have an account? ",jsxRuntimeExports.jsx(Link,{to:"/login",className:"text-blue-600 font-bold",children:"Login"})]})]})})},AdminTests=()=>{const{batchId:i}=useParams(),e=useNavigate(),[t,n]=reactExports.useState([]),[r,s]=reactExports.useState(!1),[a,l]=reactExports.useState({title:"",duration:"",totalMarks:""}),u=async()=>{const p=query(collection(db,"tests"),where("batchId","==",i)),m=await getDocs(p);n(m.docs.map(g=>({id:g.id,...g.data()})))};reactExports.useEffect(()=>{u()},[i]);const d=async p=>{p.preventDefault(),await addDoc(collection(db,"tests"),{...a,batchId:i,createdAt:new Date}),s(!1),l({title:"",duration:"",totalMarks:""}),u()},h=async p=>{confirm("Delete this test?")&&(await deleteDoc(doc(db,"tests",p)),u())};return jsxRuntimeExports.jsxs("div",{className:"p-6 bg-slate-50 min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>e(-1),className:"p-2 hover:bg-white rounded-full",children:jsxRuntimeExports.jsx(ArrowLeft,{size:20})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Manage Tests"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>s(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex gap-2 font-bold",children:[jsxRuntimeExports.jsx(Plus,{size:20})," Create Test"]})]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(p=>jsxRuntimeExports.jsxs("div",{className:"bg-white p-5 rounded-xl border shadow-sm hover:shadow-md transition",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-2",children:[jsxRuntimeExports.jsx("div",{className:"bg-purple-100 p-3 rounded-lg text-purple-600",children:jsxRuntimeExports.jsx(FileText,{size:24})}),jsxRuntimeExports.jsx("button",{onClick:()=>h(p.id),className:"text-red-400 hover:text-red-600",children:jsxRuntimeExports.jsx(Trash2,{size:18})})]}),jsxRuntimeExports.jsx("h3",{className:"font-bold text-lg text-gray-800",children:p.title}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-gray-500 mt-1 flex gap-4",children:[jsxRuntimeExports.jsxs("span",{children:[" ",p.duration," Mins"]}),jsxRuntimeExports.jsxs("span",{children:["Marks: ",p.totalMarks]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>e(`/admin/test/${p.id}/questions`),className:"w-full mt-4 bg-purple-50 text-purple-700 py-2 rounded-lg font-bold hover:bg-purple-100 border border-purple-200",children:"Add/Edit Questions"})]},p.id))}),r&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white p-6 rounded-xl w-full max-w-md",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold mb-4",children:"Create New Test"}),jsxRuntimeExports.jsxs("form",{onSubmit:d,className:"space-y-4",children:[jsxRuntimeExports.jsx("input",{required:!0,placeholder:"Test Title (e.g. Physics Mock Test 1)",className:"w-full border p-2 rounded",value:a.title,onChange:p=>l({...a,title:p.target.value})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsx("input",{required:!0,type:"number",placeholder:"Duration (Mins)",className:"w-full border p-2 rounded",value:a.duration,onChange:p=>l({...a,duration:p.target.value})}),jsxRuntimeExports.jsx("input",{required:!0,type:"number",placeholder:"Total Marks",className:"w-full border p-2 rounded",value:a.totalMarks,onChange:p=>l({...a,totalMarks:p.target.value})})]}),jsxRuntimeExports.jsx("button",{className:"w-full bg-blue-600 text-white py-2 rounded-lg font-bold mt-2",children:"Create Test"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>s(!1),className:"w-full text-gray-500 py-2",children:"Cancel"})]})]})})]})},TestQuestions=()=>{const{testId:i}=useParams(),e=useNavigate(),[t,n]=reactExports.useState([]),[r,s]=reactExports.useState({question:"",optionA:"",optionB:"",optionC:"",optionD:"",correctOption:"optionA"}),a=async()=>{const d=query(collection(db,"questions"),where("testId","==",i)),h=await getDocs(d);n(h.docs.map(p=>({id:p.id,...p.data()})))};reactExports.useEffect(()=>{a()},[i]);const l=async d=>{d.preventDefault(),await addDoc(collection(db,"questions"),{...r,testId:i}),s({question:"",optionA:"",optionB:"",optionC:"",optionD:"",correctOption:"optionA"}),a()},u=async d=>{confirm("Delete question?")&&(await deleteDoc(doc(db,"questions",d)),a())};return jsxRuntimeExports.jsxs("div",{className:"p-6 bg-slate-50 min-h-screen grid grid-cols-1 lg:grid-cols-2 gap-8",children:[jsxRuntimeExports.jsxs("div",{className:"h-fit sticky top-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>e(-1),className:"p-2 hover:bg-white rounded-full",children:jsxRuntimeExports.jsx(ArrowLeft,{size:20})}),jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold",children:"Add Question"})]}),jsxRuntimeExports.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border",children:jsxRuntimeExports.jsxs("form",{onSubmit:l,className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Question Text"}),jsxRuntimeExports.jsx("textarea",{required:!0,className:"w-full border p-2 rounded h-24",value:r.question,onChange:d=>s({...r,question:d.target.value})})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsx("input",{required:!0,placeholder:"Option A",className:"border p-2 rounded",value:r.optionA,onChange:d=>s({...r,optionA:d.target.value})}),jsxRuntimeExports.jsx("input",{required:!0,placeholder:"Option B",className:"border p-2 rounded",value:r.optionB,onChange:d=>s({...r,optionB:d.target.value})}),jsxRuntimeExports.jsx("input",{required:!0,placeholder:"Option C",className:"border p-2 rounded",value:r.optionC,onChange:d=>s({...r,optionC:d.target.value})}),jsxRuntimeExports.jsx("input",{required:!0,placeholder:"Option D",className:"border p-2 rounded",value:r.optionD,onChange:d=>s({...r,optionD:d.target.value})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Correct Option"}),jsxRuntimeExports.jsxs("select",{className:"w-full border p-2 rounded",value:r.correctOption,onChange:d=>s({...r,correctOption:d.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"optionA",children:"Option A"}),jsxRuntimeExports.jsx("option",{value:"optionB",children:"Option B"}),jsxRuntimeExports.jsx("option",{value:"optionC",children:"Option C"}),jsxRuntimeExports.jsx("option",{value:"optionD",children:"Option D"})]})]}),jsxRuntimeExports.jsx("button",{className:"w-full bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-700 mt-2",children:"Save Question"})]})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Questions List (",t.length,")"]}),t.map((d,h)=>jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm relative",children:[jsxRuntimeExports.jsx("button",{onClick:()=>u(d.id),className:"absolute top-3 right-3 text-red-400 hover:text-red-600",children:jsxRuntimeExports.jsx(Trash2,{size:18})}),jsxRuntimeExports.jsxs("h3",{className:"font-bold text-gray-800 pr-8",children:["Q",h+1,". ",d.question]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-3 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:`p-2 rounded border ${d.correctOption==="optionA"?"bg-green-100 border-green-300":""}`,children:["A. ",d.optionA]}),jsxRuntimeExports.jsxs("div",{className:`p-2 rounded border ${d.correctOption==="optionB"?"bg-green-100 border-green-300":""}`,children:["B. ",d.optionB]}),jsxRuntimeExports.jsxs("div",{className:`p-2 rounded border ${d.correctOption==="optionC"?"bg-green-100 border-green-300":""}`,children:["C. ",d.optionC]}),jsxRuntimeExports.jsxs("div",{className:`p-2 rounded border ${d.correctOption==="optionD"?"bg-green-100 border-green-300":""}`,children:["D. ",d.optionD]})]})]},d.id))]})]})},TestPlayer=()=>{const{testId:i}=useParams(),e=useNavigate(),[t,n]=reactExports.useState([]),[r,s]=reactExports.useState(0),[a,l]=reactExports.useState({}),[u,d]=reactExports.useState(!0),[h,p]=reactExports.useState(!1),[m,g]=reactExports.useState(0);reactExports.useEffect(()=>{(async()=>{try{const A=query(collection(db,"questions"),where("testId","==",i)),z=await getDocs(A);n(z.docs.map(D=>({id:D.id,...D.data()})))}catch(A){console.error(A)}d(!1)})()},[i]);const v=E=>{h||l({...a,[t[r].id]:E})},_=()=>{if(!confirm("Are you sure you want to submit?"))return;let E=0;t.forEach(A=>{a[A.id]===A.correctOption&&(E+=1)}),g(E),p(!0)};if(u)return jsxRuntimeExports.jsx("div",{className:"p-10 text-center",children:"Loading Test..."});if(t.length===0)return jsxRuntimeExports.jsxs("div",{className:"p-10 text-center",children:["No questions in this test. ",jsxRuntimeExports.jsx("button",{onClick:()=>e(-1),className:"text-blue-500 underline",children:"Go Back"})]});const b=t[r];return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 border-b flex justify-between items-center sticky top-0 z-10 shadow-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>e(-1),className:"text-gray-600 hover:text-black",children:jsxRuntimeExports.jsx(ArrowLeft,{})}),jsxRuntimeExports.jsx("h1",{className:"font-bold text-lg hidden md:block",children:"Test Mode"})]}),h?jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-bold",children:[jsxRuntimeExports.jsx(CircleCheckBig,{size:16})," Completed"]}):jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 text-blue-600 px-3 py-1 rounded-full text-sm font-bold",children:[jsxRuntimeExports.jsx(Clock,{size:16})," In Progress"]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 p-4 max-w-3xl mx-auto w-full",children:h?jsxRuntimeExports.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-lg text-center space-y-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Test Submitted! "}),jsxRuntimeExports.jsxs("div",{className:"w-32 h-32 bg-blue-600 text-white rounded-full flex flex-col items-center justify-center mx-auto shadow-lg border-4 border-blue-100",children:[jsxRuntimeExports.jsx("span",{className:"text-4xl font-bold",children:m}),jsxRuntimeExports.jsxs("span",{className:"text-sm opacity-80",children:["out of ",t.length]})]}),jsxRuntimeExports.jsxs("p",{className:"text-gray-500",children:["You answered ",jsxRuntimeExports.jsx("b",{children:m})," correctly out of ",jsxRuntimeExports.jsx("b",{children:t.length})," questions."]}),jsxRuntimeExports.jsx("button",{onClick:()=>e(-1),className:"bg-gray-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-black transition",children:"Back to Course"}),jsxRuntimeExports.jsxs("div",{className:"mt-8 text-left space-y-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-lg border-b pb-2",children:"Answer Key"}),t.map((E,A)=>jsxRuntimeExports.jsxs("div",{className:"p-3 bg-gray-50 rounded border",children:[jsxRuntimeExports.jsxs("p",{className:"font-bold mb-2 text-sm",children:[A+1,". ",E.question]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4 text-xs",children:[jsxRuntimeExports.jsxs("span",{className:`px-2 py-1 rounded ${a[E.id]===E.correctOption?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:["Your: ",a[E.id]||"Skipped"]}),jsxRuntimeExports.jsxs("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded",children:["Correct: ",E.correctOption]})]})]},E.id))]})]}):jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border overflow-hidden min-h-[400px] flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"p-6 border-b bg-gray-50",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:["Question ",r+1," of ",t.length]}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-800 mt-2",children:b.question})]}),jsxRuntimeExports.jsx("div",{className:"p-6 space-y-3 flex-1",children:["optionA","optionB","optionC","optionD"].map(E=>jsxRuntimeExports.jsxs("button",{onClick:()=>v(E),className:`w-full text-left p-4 rounded-xl border-2 transition flex items-center justify-between group ${a[b.id]===E?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-100 hover:border-gray-300"}`,children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:b[E]}),a[b.id]===E&&jsxRuntimeExports.jsx(CircleCheckBig,{size:20,className:"text-blue-600"})]},E))}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-t bg-gray-50 flex justify-between",children:[jsxRuntimeExports.jsx("button",{disabled:r===0,onClick:()=>s(E=>E-1),className:"px-4 py-2 rounded-lg font-bold text-gray-600 hover:bg-gray-200 disabled:opacity-50",children:"Previous"}),r===t.length-1?jsxRuntimeExports.jsx("button",{onClick:_,className:"px-6 py-2 rounded-lg font-bold bg-green-600 text-white hover:bg-green-700",children:"Submit Test"}):jsxRuntimeExports.jsx("button",{onClick:()=>s(E=>E+1),className:"px-6 py-2 rounded-lg font-bold bg-blue-600 text-white hover:bg-blue-700",children:"Next Question"})]})]})})]})};var window_1,hasRequiredWindow;function requireWindow(){if(hasRequiredWindow)return window_1;hasRequiredWindow=1;var i;return typeof window<"u"?i=window:typeof commonjsGlobal$2<"u"?i=commonjsGlobal$2:typeof self<"u"?i=self:i={},window_1=i,window_1}var windowExports=requireWindow();const window$1=getDefaultExportFromCjs(windowExports),__viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);var document_1,hasRequiredDocument;function requireDocument(){if(hasRequiredDocument)return document_1;hasRequiredDocument=1;var i=typeof commonjsGlobal$2<"u"?commonjsGlobal$2:typeof window<"u"?window:{},e=require$$5,t;return typeof document<"u"?t=document:(t=i["__GLOBAL_DOCUMENT_CACHE@4"],t||(t=i["__GLOBAL_DOCUMENT_CACHE@4"]=e)),document_1=t,document_1}var documentExports=requireDocument();const document$1=getDefaultExportFromCjs(documentExports);var lib$j={exports:{}},_extends$1={exports:{}},hasRequired_extends;function require_extends(){return hasRequired_extends||(hasRequired_extends=1,(function(i){function e(){return i.exports=e=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var s in r)({}).hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},i.exports.__esModule=!0,i.exports.default=i.exports,e.apply(null,arguments)}i.exports=e,i.exports.__esModule=!0,i.exports.default=i.exports})(_extends$1)),_extends$1.exports}var isFunction_1,hasRequiredIsFunction;function requireIsFunction(){if(hasRequiredIsFunction)return isFunction_1;hasRequiredIsFunction=1,isFunction_1=e;var i=Object.prototype.toString;function e(t){if(!t)return!1;var n=i.call(t);return n==="[object Function]"||typeof t=="function"&&n!=="[object RegExp]"||typeof window<"u"&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}return isFunction_1}var interceptors,hasRequiredInterceptors;function requireInterceptors(){if(hasRequiredInterceptors)return interceptors;hasRequiredInterceptors=1;function i(r,s){var a=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(a)return(a=a.call(r)).next.bind(a);if(Array.isArray(r)||(a=e(r))||s){a&&(r=a);var l=0;return function(){return l>=r.length?{done:!0}:{done:!1,value:r[l++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e(r,s){if(r){if(typeof r=="string")return t(r,s);var a=Object.prototype.toString.call(r).slice(8,-1);if(a==="Object"&&r.constructor&&(a=r.constructor.name),a==="Map"||a==="Set")return Array.from(r);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return t(r,s)}}function t(r,s){(s==null||s>r.length)&&(s=r.length);for(var a=0,l=new Array(s);a<s;a++)l[a]=r[a];return l}var n=(function(){function r(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1}var s=r.prototype;return s.getIsEnabled=function(){return this.enabled_},s.enable=function(){this.enabled_=!0},s.disable=function(){this.enabled_=!1},s.reset=function(){this.typeToInterceptorsMap_=new Map,this.enabled_=!1},s.addInterceptor=function(l,u){this.typeToInterceptorsMap_.has(l)||this.typeToInterceptorsMap_.set(l,new Set);var d=this.typeToInterceptorsMap_.get(l);return d.has(u)?!1:(d.add(u),!0)},s.removeInterceptor=function(l,u){var d=this.typeToInterceptorsMap_.get(l);return d&&d.has(u)?(d.delete(u),!0):!1},s.clearInterceptorsByType=function(l){var u=this.typeToInterceptorsMap_.get(l);return u?(this.typeToInterceptorsMap_.delete(l),this.typeToInterceptorsMap_.set(l,new Set),!0):!1},s.clear=function(){return this.typeToInterceptorsMap_.size?(this.typeToInterceptorsMap_=new Map,!0):!1},s.getForType=function(l){return this.typeToInterceptorsMap_.get(l)||new Set},s.execute=function(l,u){for(var d=this.getForType(l),h=i(d),p;!(p=h()).done;){var m=p.value;try{u=m(u)}catch{}}return u},r})();return interceptors=n,interceptors}var retry,hasRequiredRetry;function requireRetry(){if(hasRequiredRetry)return retry;hasRequiredRetry=1;var i=(function(){function t(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1}var n=t.prototype;return n.getIsEnabled=function(){return this.enabled_},n.enable=function(){this.enabled_=!0},n.disable=function(){this.enabled_=!1},n.reset=function(){this.maxAttempts_=1,this.delayFactor_=.1,this.fuzzFactor_=.1,this.initialDelay_=1e3,this.enabled_=!1},n.getMaxAttempts=function(){return this.maxAttempts_},n.setMaxAttempts=function(s){this.maxAttempts_=s},n.getDelayFactor=function(){return this.delayFactor_},n.setDelayFactor=function(s){this.delayFactor_=s},n.getFuzzFactor=function(){return this.fuzzFactor_},n.setFuzzFactor=function(s){this.fuzzFactor_=s},n.getInitialDelay=function(){return this.initialDelay_},n.setInitialDelay=function(s){this.initialDelay_=s},n.createRetry=function(s){var a=s===void 0?{}:s,l=a.maxAttempts,u=a.delayFactor,d=a.fuzzFactor,h=a.initialDelay;return new e({maxAttempts:l||this.maxAttempts_,delayFactor:u||this.delayFactor_,fuzzFactor:d||this.fuzzFactor_,initialDelay:h||this.initialDelay_})},t})(),e=(function(){function t(r){this.maxAttempts_=r.maxAttempts,this.delayFactor_=r.delayFactor,this.fuzzFactor_=r.fuzzFactor,this.currentDelay_=r.initialDelay,this.currentAttempt_=1}var n=t.prototype;return n.moveToNextAttempt=function(){this.currentAttempt_++;var s=this.currentDelay_*this.delayFactor_;this.currentDelay_=this.currentDelay_+s},n.shouldRetry=function(){return this.currentAttempt_<this.maxAttempts_},n.getCurrentDelay=function(){return this.currentDelay_},n.getCurrentMinPossibleDelay=function(){return(1-this.fuzzFactor_)*this.currentDelay_},n.getCurrentMaxPossibleDelay=function(){return(1+this.fuzzFactor_)*this.currentDelay_},n.getCurrentFuzzedDelay=function(){var s=this.getCurrentMinPossibleDelay(),a=this.getCurrentMaxPossibleDelay();return s+Math.random()*(a-s)},t})();return retry=i,retry}var httpHandler,hasRequiredHttpHandler;function requireHttpHandler(){if(hasRequiredHttpHandler)return httpHandler;hasRequiredHttpHandler=1;var i=requireWindow(),e=function(r,s){return s===void 0&&(s=!1),function(a,l,u){if(a){r(a);return}if(l.statusCode>=400&&l.statusCode<=599){var d=u;if(s)if(i.TextDecoder){var h=t(l.headers&&l.headers["content-type"]);try{d=new TextDecoder(h).decode(u)}catch{}}else d=String.fromCharCode.apply(null,new Uint8Array(u));r({cause:d});return}r(null,u)}};function t(n){return n===void 0&&(n=""),n.toLowerCase().split(";").reduce(function(r,s){var a=s.split("="),l=a[0],u=a[1];return l.trim()==="charset"?u.trim():r},"utf-8")}return httpHandler=e,httpHandler}var hasRequiredLib$j;function requireLib$j(){if(hasRequiredLib$j)return lib$j.exports;hasRequiredLib$j=1;var i=requireWindow(),e=require_extends(),t=requireIsFunction(),n=requireInterceptors(),r=requireRetry();d.httpHandler=requireHttpHandler(),d.requestInterceptorsStorage=new n,d.responseInterceptorsStorage=new n,d.retryManager=new r;var s=function(v){var _={};return v&&v.trim().split(`
`).forEach(function(b){var E=b.indexOf(":"),A=b.slice(0,E).trim().toLowerCase(),z=b.slice(E+1).trim();typeof _[A]>"u"?_[A]=z:Array.isArray(_[A])?_[A].push(z):_[A]=[_[A],z]}),_};lib$j.exports=d,lib$j.exports.default=d,d.XMLHttpRequest=i.XMLHttpRequest||m,d.XDomainRequest="withCredentials"in new d.XMLHttpRequest?d.XMLHttpRequest:i.XDomainRequest,a(["get","put","post","patch","head","delete"],function(g){d[g==="delete"?"del":g]=function(v,_,b){return _=u(v,_,b),_.method=g.toUpperCase(),h(_)}});function a(g,v){for(var _=0;_<g.length;_++)v(g[_])}function l(g){for(var v in g)if(g.hasOwnProperty(v))return!1;return!0}function u(g,v,_){var b=g;return t(v)?(_=v,typeof g=="string"&&(b={uri:g})):b=e({},v,{uri:g}),b.callback=_,b}function d(g,v,_){return v=u(g,v,_),h(v)}function h(g){if(typeof g.callback>"u")throw new Error("callback argument missing");if(g.requestType&&d.requestInterceptorsStorage.getIsEnabled()){var v={uri:g.uri||g.url,headers:g.headers||{},body:g.body,metadata:g.metadata||{},retry:g.retry,timeout:g.timeout},_=d.requestInterceptorsStorage.execute(g.requestType,v);g.uri=_.uri,g.headers=_.headers,g.body=_.body,g.metadata=_.metadata,g.retry=_.retry,g.timeout=_.timeout}var b=!1,E=function(oe,ee,se){b||(b=!0,g.callback(oe,ee,se))};function A(){G.readyState===4&&!d.responseInterceptorsStorage.getIsEnabled()&&setTimeout(P,0)}function z(){var ue=void 0;if(G.response?ue=G.response:ue=G.responseText||p(G),be)try{ue=JSON.parse(ue)}catch{}return ue}function D(ue){if(clearTimeout(_e),clearTimeout(g.retryTimeout),ue instanceof Error||(ue=new Error(""+(ue||"Unknown XMLHttpRequest Error"))),ue.statusCode=0,!I&&d.retryManager.getIsEnabled()&&g.retry&&g.retry.shouldRetry()){g.retryTimeout=setTimeout(function(){g.retry.moveToNextAttempt(),g.xhr=G,h(g)},g.retry.getCurrentFuzzedDelay());return}if(g.requestType&&d.responseInterceptorsStorage.getIsEnabled()){var oe={headers:le.headers||{},body:le.body,responseUrl:G.responseURL,responseType:G.responseType},ee=d.responseInterceptorsStorage.execute(g.requestType,oe);le.body=ee.body,le.headers=ee.headers}return E(ue,le)}function P(){if(!I){var ue;clearTimeout(_e),clearTimeout(g.retryTimeout),g.useXDR&&G.status===void 0?ue=200:ue=G.status===1223?204:G.status;var oe=le,ee=null;if(ue!==0?(oe={body:z(),statusCode:ue,method:H,headers:{},url:w,rawRequest:G},G.getAllResponseHeaders&&(oe.headers=s(G.getAllResponseHeaders()))):ee=new Error("Internal XMLHttpRequest Error"),g.requestType&&d.responseInterceptorsStorage.getIsEnabled()){var se={headers:oe.headers||{},body:oe.body,responseUrl:G.responseURL,responseType:G.responseType},re=d.responseInterceptorsStorage.execute(g.requestType,se);oe.body=re.body,oe.headers=re.headers}return E(ee,oe,oe.body)}}var G=g.xhr||null;G||(g.cors||g.useXDR?G=new d.XDomainRequest:G=new d.XMLHttpRequest);var R,I,w=G.url=g.uri||g.url,H=G.method=g.method||"GET",V=g.body||g.data,te=G.headers=g.headers||{},ae=!!g.sync,be=!1,_e,le={body:void 0,headers:{},statusCode:0,method:H,url:w,rawRequest:G};if("json"in g&&g.json!==!1&&(be=!0,te.accept||te.Accept||(te.Accept="application/json"),H!=="GET"&&H!=="HEAD"&&(te["content-type"]||te["Content-Type"]||(te["Content-Type"]="application/json"),V=JSON.stringify(g.json===!0?V:g.json))),G.onreadystatechange=A,G.onload=P,G.onerror=D,G.onprogress=function(){},G.onabort=function(){I=!0,clearTimeout(g.retryTimeout)},G.ontimeout=D,G.open(H,w,!ae,g.username,g.password),ae||(G.withCredentials=!!g.withCredentials),!ae&&g.timeout>0&&(_e=setTimeout(function(){if(!I){I=!0,G.abort("timeout");var ue=new Error("XMLHttpRequest timeout");ue.code="ETIMEDOUT",D(ue)}},g.timeout)),G.setRequestHeader)for(R in te)te.hasOwnProperty(R)&&G.setRequestHeader(R,te[R]);else if(g.headers&&!l(g.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in g&&(G.responseType=g.responseType),"beforeSend"in g&&typeof g.beforeSend=="function"&&g.beforeSend(G),G.send(V||null),G}function p(g){try{if(g.responseType==="document")return g.responseXML;var v=g.responseXML&&g.responseXML.documentElement.nodeName==="parsererror";if(g.responseType===""&&!v)return g.responseXML}catch{}return null}function m(){}return lib$j.exports}var libExports$3=requireLib$j();const XHR=getDefaultExportFromCjs(libExports$3);var browserIndex={exports:{}},vtt$1,hasRequiredVtt;function requireVtt(){if(hasRequiredVtt)return vtt$1;hasRequiredVtt=1;var i=requireDocument(),e=Object.create||(function(){function w(){}return function(H){if(arguments.length!==1)throw new Error("Object.create shim only accepts one parameter.");return w.prototype=H,new w}})();function t(w,H){this.name="ParsingError",this.code=w.code,this.message=H||w.message}t.prototype=e(Error.prototype),t.prototype.constructor=t,t.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function n(w){function H(te,ae,be,_e){return(te|0)*3600+(ae|0)*60+(be|0)+(_e|0)/1e3}var V=w.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return V?V[3]?H(V[1],V[2],V[3].replace(":",""),V[4]):V[1]>59?H(V[1],V[2],0,V[4]):H(0,V[1],V[2],V[4]):null}function r(){this.values=e(null)}r.prototype={set:function(w,H){!this.get(w)&&H!==""&&(this.values[w]=H)},get:function(w,H,V){return V?this.has(w)?this.values[w]:H[V]:this.has(w)?this.values[w]:H},has:function(w){return w in this.values},alt:function(w,H,V){for(var te=0;te<V.length;++te)if(H===V[te]){this.set(w,H);break}},integer:function(w,H){/^-?\d+$/.test(H)&&this.set(w,parseInt(H,10))},percent:function(w,H){return H.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(H=parseFloat(H),H>=0&&H<=100)?(this.set(w,H),!0):!1}};function s(w,H,V,te){var ae=te?w.split(te):[w];for(var be in ae)if(typeof ae[be]=="string"){var _e=ae[be].split(V);if(_e.length===2){var le=_e[0].trim(),ue=_e[1].trim();H(le,ue)}}}function a(w,H,V){var te=w;function ae(){var le=n(w);if(le===null)throw new t(t.Errors.BadTimeStamp,"Malformed timestamp: "+te);return w=w.replace(/^[^\sa-zA-Z-]+/,""),le}function be(le,ue){var oe=new r;s(le,function(ee,se){switch(ee){case"region":for(var re=V.length-1;re>=0;re--)if(V[re].id===se){oe.set(ee,V[re].region);break}break;case"vertical":oe.alt(ee,se,["rl","lr"]);break;case"line":var fe=se.split(","),pe=fe[0];oe.integer(ee,pe),oe.percent(ee,pe)&&oe.set("snapToLines",!1),oe.alt(ee,pe,["auto"]),fe.length===2&&oe.alt("lineAlign",fe[1],["start","center","end"]);break;case"position":fe=se.split(","),oe.percent(ee,fe[0]),fe.length===2&&oe.alt("positionAlign",fe[1],["start","center","end"]);break;case"size":oe.percent(ee,se);break;case"align":oe.alt(ee,se,["start","center","end","left","right"]);break}},/:/,/\s/),ue.region=oe.get("region",null),ue.vertical=oe.get("vertical","");try{ue.line=oe.get("line","auto")}catch{}ue.lineAlign=oe.get("lineAlign","start"),ue.snapToLines=oe.get("snapToLines",!0),ue.size=oe.get("size",100);try{ue.align=oe.get("align","center")}catch{ue.align=oe.get("align","middle")}try{ue.position=oe.get("position","auto")}catch{ue.position=oe.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},ue.align)}ue.positionAlign=oe.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},ue.align)}function _e(){w=w.replace(/^\s+/,"")}if(_e(),H.startTime=ae(),_e(),w.substr(0,3)!=="-->")throw new t(t.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+te);w=w.substr(3),_e(),H.endTime=ae(),_e(),be(w,H)}var l=i.createElement&&i.createElement("textarea"),u={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},d={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},h={v:"title",lang:"lang"},p={rt:"ruby"};function m(w,H){function V(){if(!H)return null;function pe(ce){return H=H.substr(ce.length),ce}var Z=H.match(/^([^<]*)(<[^>]*>?)?/);return pe(Z[1]?Z[1]:Z[2])}function te(pe){return l.innerHTML=pe,pe=l.textContent,l.textContent="",pe}function ae(pe,Z){return!p[Z.localName]||p[Z.localName]===pe.localName}function be(pe,Z){var ce=u[pe];if(!ce)return null;var Ee=w.document.createElement(ce),Te=h[pe];return Te&&Z&&(Ee[Te]=Z.trim()),Ee}for(var _e=w.document.createElement("div"),le=_e,ue,oe=[];(ue=V())!==null;){if(ue[0]==="<"){if(ue[1]==="/"){oe.length&&oe[oe.length-1]===ue.substr(2).replace(">","")&&(oe.pop(),le=le.parentNode);continue}var ee=n(ue.substr(1,ue.length-2)),se;if(ee){se=w.document.createProcessingInstruction("timestamp",ee),le.appendChild(se);continue}var re=ue.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!re||(se=be(re[1],re[3]),!se)||!ae(le,se))continue;if(re[2]){var fe=re[2].split(".");fe.forEach(function(pe){var Z=/^bg_/.test(pe),ce=Z?pe.slice(3):pe;if(d.hasOwnProperty(ce)){var Ee=Z?"background-color":"color",Te=d[ce];se.style[Ee]=Te}}),se.className=fe.join(" ")}oe.push(re[1]),le.appendChild(se),le=se;continue}le.appendChild(w.document.createTextNode(te(ue)))}return _e}var g=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function v(w){for(var H=0;H<g.length;H++){var V=g[H];if(w>=V[0]&&w<=V[1])return!0}return!1}function _(w){var H=[],V="",te;if(!w||!w.childNodes)return"ltr";function ae(le,ue){for(var oe=ue.childNodes.length-1;oe>=0;oe--)le.push(ue.childNodes[oe])}function be(le){if(!le||!le.length)return null;var ue=le.pop(),oe=ue.textContent||ue.innerText;if(oe){var ee=oe.match(/^.*(\n|\r)/);return ee?(le.length=0,ee[0]):oe}if(ue.tagName==="ruby")return be(le);if(ue.childNodes)return ae(le,ue),be(le)}for(ae(H,w);V=be(H);)for(var _e=0;_e<V.length;_e++)if(te=V.charCodeAt(_e),v(te))return"rtl";return"ltr"}function b(w){if(typeof w.line=="number"&&(w.snapToLines||w.line>=0&&w.line<=100))return w.line;if(!w.track||!w.track.textTrackList||!w.track.textTrackList.mediaElement)return-1;for(var H=w.track,V=H.textTrackList,te=0,ae=0;ae<V.length&&V[ae]!==H;ae++)V[ae].mode==="showing"&&te++;return++te*-1}function E(){}E.prototype.applyStyles=function(w,H){H=H||this.div;for(var V in w)w.hasOwnProperty(V)&&(H.style[V]=w[V])},E.prototype.formatStyle=function(w,H){return w===0?0:w+H};function A(w,H,V){E.call(this),this.cue=H,this.cueDiv=m(w,H.text);var te={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:H.vertical===""?"horizontal-tb":H.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(te,this.cueDiv),this.div=w.document.createElement("div"),te={direction:_(this.cueDiv),writingMode:H.vertical===""?"horizontal-tb":H.vertical==="lr"?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:H.align==="middle"?"center":H.align,font:V.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(te),this.div.appendChild(this.cueDiv);var ae=0;switch(H.positionAlign){case"start":case"line-left":ae=H.position;break;case"center":ae=H.position-H.size/2;break;case"end":case"line-right":ae=H.position-H.size;break}H.vertical===""?this.applyStyles({left:this.formatStyle(ae,"%"),width:this.formatStyle(H.size,"%")}):this.applyStyles({top:this.formatStyle(ae,"%"),height:this.formatStyle(H.size,"%")}),this.move=function(be){this.applyStyles({top:this.formatStyle(be.top,"px"),bottom:this.formatStyle(be.bottom,"px"),left:this.formatStyle(be.left,"px"),right:this.formatStyle(be.right,"px"),height:this.formatStyle(be.height,"px"),width:this.formatStyle(be.width,"px")})}}A.prototype=e(E.prototype),A.prototype.constructor=A;function z(w){var H,V,te,ae;if(w.div){V=w.div.offsetHeight,te=w.div.offsetWidth,ae=w.div.offsetTop;var be=(be=w.div.childNodes)&&(be=be[0])&&be.getClientRects&&be.getClientRects();w=w.div.getBoundingClientRect(),H=be?Math.max(be[0]&&be[0].height||0,w.height/be.length):0}this.left=w.left,this.right=w.right,this.top=w.top||ae,this.height=w.height||V,this.bottom=w.bottom||ae+(w.height||V),this.width=w.width||te,this.lineHeight=H!==void 0?H:w.lineHeight}z.prototype.move=function(w,H){switch(H=H!==void 0?H:this.lineHeight,w){case"+x":this.left+=H,this.right+=H;break;case"-x":this.left-=H,this.right-=H;break;case"+y":this.top+=H,this.bottom+=H;break;case"-y":this.top-=H,this.bottom-=H;break}},z.prototype.overlaps=function(w){return this.left<w.right&&this.right>w.left&&this.top<w.bottom&&this.bottom>w.top},z.prototype.overlapsAny=function(w){for(var H=0;H<w.length;H++)if(this.overlaps(w[H]))return!0;return!1},z.prototype.within=function(w){return this.top>=w.top&&this.bottom<=w.bottom&&this.left>=w.left&&this.right<=w.right},z.prototype.overlapsOppositeAxis=function(w,H){switch(H){case"+x":return this.left<w.left;case"-x":return this.right>w.right;case"+y":return this.top<w.top;case"-y":return this.bottom>w.bottom}},z.prototype.intersectPercentage=function(w){var H=Math.max(0,Math.min(this.right,w.right)-Math.max(this.left,w.left)),V=Math.max(0,Math.min(this.bottom,w.bottom)-Math.max(this.top,w.top)),te=H*V;return te/(this.height*this.width)},z.prototype.toCSSCompatValues=function(w){return{top:this.top-w.top,bottom:w.bottom-this.bottom,left:this.left-w.left,right:w.right-this.right,height:this.height,width:this.width}},z.getSimpleBoxPosition=function(w){var H=w.div?w.div.offsetHeight:w.tagName?w.offsetHeight:0,V=w.div?w.div.offsetWidth:w.tagName?w.offsetWidth:0,te=w.div?w.div.offsetTop:w.tagName?w.offsetTop:0;w=w.div?w.div.getBoundingClientRect():w.tagName?w.getBoundingClientRect():w;var ae={left:w.left,right:w.right,top:w.top||te,height:w.height||H,bottom:w.bottom||te+(w.height||H),width:w.width||V};return ae};function D(w,H,V,te){function ae(ce,Ee){for(var Te,Ae=new z(ce),Pe=1,Me=0;Me<Ee.length;Me++){for(;ce.overlapsOppositeAxis(V,Ee[Me])||ce.within(V)&&ce.overlapsAny(te);)ce.move(Ee[Me]);if(ce.within(V))return ce;var We=ce.intersectPercentage(V);Pe>We&&(Te=new z(ce),Pe=We),ce=new z(Ae)}return Te||Ae}var be=new z(H),_e=H.cue,le=b(_e),ue=[];if(_e.snapToLines){var oe;switch(_e.vertical){case"":ue=["+y","-y"],oe="height";break;case"rl":ue=["+x","-x"],oe="width";break;case"lr":ue=["-x","+x"],oe="width";break}var ee=be.lineHeight,se=ee*Math.round(le),re=V[oe]+ee,fe=ue[0];Math.abs(se)>re&&(se=se<0?-1:1,se*=Math.ceil(re/ee)*ee),le<0&&(se+=_e.vertical===""?V.height:V.width,ue=ue.reverse()),be.move(fe,se)}else{var pe=be.lineHeight/V.height*100;switch(_e.lineAlign){case"center":le-=pe/2;break;case"end":le-=pe;break}switch(_e.vertical){case"":H.applyStyles({top:H.formatStyle(le,"%")});break;case"rl":H.applyStyles({left:H.formatStyle(le,"%")});break;case"lr":H.applyStyles({right:H.formatStyle(le,"%")});break}ue=["+y","-x","+x","-y"],be=new z(H)}var Z=ae(be,ue);H.move(Z.toCSSCompatValues(V))}function P(){}P.StringDecoder=function(){return{decode:function(w){if(!w)return"";if(typeof w!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(w))}}},P.convertCueToDOMTree=function(w,H){return!w||!H?null:m(w,H)};var G=.05,R="sans-serif",I="1.5%";return P.processCues=function(w,H,V){if(!w||!H||!V)return null;for(;V.firstChild;)V.removeChild(V.firstChild);var te=w.document.createElement("div");te.style.position="absolute",te.style.left="0",te.style.right="0",te.style.top="0",te.style.bottom="0",te.style.margin=I,V.appendChild(te);function ae(ee){for(var se=0;se<ee.length;se++)if(ee[se].hasBeenReset||!ee[se].displayState)return!0;return!1}if(!ae(H)){for(var be=0;be<H.length;be++)te.appendChild(H[be].displayState);return}var _e=[],le=z.getSimpleBoxPosition(te),ue=Math.round(le.height*G*100)/100,oe={font:ue+"px "+R};(function(){for(var ee,se,re=0;re<H.length;re++)se=H[re],ee=new A(w,se,oe),te.appendChild(ee.div),D(w,ee,le,_e),se.displayState=ee.div,_e.push(z.getSimpleBoxPosition(ee))})()},P.Parser=function(w,H,V){V||(V=H,H={}),H||(H={}),this.window=w,this.vttjs=H,this.state="INITIAL",this.buffer="",this.decoder=V||new TextDecoder("utf8"),this.regionList=[]},P.Parser.prototype={reportOrThrowError:function(w){if(w instanceof t)this.onparsingerror&&this.onparsingerror(w);else throw w},parse:function(w){var H=this;w&&(H.buffer+=H.decoder.decode(w,{stream:!0}));function V(){for(var ee=H.buffer,se=0;se<ee.length&&ee[se]!=="\r"&&ee[se]!==`
`;)++se;var re=ee.substr(0,se);return ee[se]==="\r"&&++se,ee[se]===`
`&&++se,H.buffer=ee.substr(se),re}function te(ee){var se=new r;if(s(ee,function(fe,pe){switch(fe){case"id":se.set(fe,pe);break;case"width":se.percent(fe,pe);break;case"lines":se.integer(fe,pe);break;case"regionanchor":case"viewportanchor":var Z=pe.split(",");if(Z.length!==2)break;var ce=new r;if(ce.percent("x",Z[0]),ce.percent("y",Z[1]),!ce.has("x")||!ce.has("y"))break;se.set(fe+"X",ce.get("x")),se.set(fe+"Y",ce.get("y"));break;case"scroll":se.alt(fe,pe,["up"]);break}},/=/,/\s/),se.has("id")){var re=new(H.vttjs.VTTRegion||H.window.VTTRegion);re.width=se.get("width",100),re.lines=se.get("lines",3),re.regionAnchorX=se.get("regionanchorX",0),re.regionAnchorY=se.get("regionanchorY",100),re.viewportAnchorX=se.get("viewportanchorX",0),re.viewportAnchorY=se.get("viewportanchorY",100),re.scroll=se.get("scroll",""),H.onregion&&H.onregion(re),H.regionList.push({id:se.get("id"),region:re})}}function ae(ee){var se=new r;s(ee,function(re,fe){switch(re){case"MPEGT":se.integer(re+"S",fe);break;case"LOCA":se.set(re+"L",n(fe));break}},/[^\d]:/,/,/),H.ontimestampmap&&H.ontimestampmap({MPEGTS:se.get("MPEGTS"),LOCAL:se.get("LOCAL")})}function be(ee){ee.match(/X-TIMESTAMP-MAP/)?s(ee,function(se,re){se==="X-TIMESTAMP-MAP"&&ae(re)},/=/):s(ee,function(se,re){se==="Region"&&te(re)},/:/)}try{var _e;if(H.state==="INITIAL"){if(!/\r\n|\n/.test(H.buffer))return this;_e=V();var le=_e.match(/^WEBVTT([ \t].*)?$/);if(!le||!le[0])throw new t(t.Errors.BadSignature);H.state="HEADER"}for(var ue=!1;H.buffer;){if(!/\r\n|\n/.test(H.buffer))return this;switch(ue?ue=!1:_e=V(),H.state){case"HEADER":/:/.test(_e)?be(_e):_e||(H.state="ID");continue;case"NOTE":_e||(H.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(_e)){H.state="NOTE";break}if(!_e)continue;H.cue=new(H.vttjs.VTTCue||H.window.VTTCue)(0,0,"");try{H.cue.align="center"}catch{H.cue.align="middle"}if(H.state="CUE",_e.indexOf("-->")===-1){H.cue.id=_e;continue}case"CUE":try{a(_e,H.cue,H.regionList)}catch(ee){H.reportOrThrowError(ee),H.cue=null,H.state="BADCUE";continue}H.state="CUETEXT";continue;case"CUETEXT":var oe=_e.indexOf("-->")!==-1;if(!_e||oe&&(ue=!0)){H.oncue&&H.oncue(H.cue),H.cue=null,H.state="ID";continue}H.cue.text&&(H.cue.text+=`
`),H.cue.text+=_e.replace(/\u2028/g,`
`).replace(/u2029/g,`
`);continue;case"BADCUE":_e||(H.state="ID");continue}}}catch(ee){H.reportOrThrowError(ee),H.state==="CUETEXT"&&H.cue&&H.oncue&&H.oncue(H.cue),H.cue=null,H.state=H.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},flush:function(){var w=this;try{if(w.buffer+=w.decoder.decode(),(w.cue||w.state==="HEADER")&&(w.buffer+=`

`,w.parse()),w.state==="INITIAL")throw new t(t.Errors.BadSignature)}catch(H){w.reportOrThrowError(H)}return w.onflush&&w.onflush(),this}},vtt$1=P,vtt$1}var vttcue,hasRequiredVttcue;function requireVttcue(){if(hasRequiredVttcue)return vttcue;hasRequiredVttcue=1;var i="auto",e={"":1,lr:1,rl:1},t={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function n(a){if(typeof a!="string")return!1;var l=e[a.toLowerCase()];return l?a.toLowerCase():!1}function r(a){if(typeof a!="string")return!1;var l=t[a.toLowerCase()];return l?a.toLowerCase():!1}function s(a,l,u){this.hasBeenReset=!1;var d="",h=!1,p=a,m=l,g=u,v=null,_="",b=!0,E="auto",A="start",z="auto",D="auto",P=100,G="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return d},set:function(R){d=""+R}},pauseOnExit:{enumerable:!0,get:function(){return h},set:function(R){h=!!R}},startTime:{enumerable:!0,get:function(){return p},set:function(R){if(typeof R!="number")throw new TypeError("Start time must be set to a number.");p=R,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return m},set:function(R){if(typeof R!="number")throw new TypeError("End time must be set to a number.");m=R,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return g},set:function(R){g=""+R,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return v},set:function(R){v=R,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return _},set:function(R){var I=n(R);if(I===!1)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");_=I,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return b},set:function(R){b=!!R,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return E},set:function(R){if(typeof R!="number"&&R!==i)throw new SyntaxError("Line: an invalid number or illegal string was specified.");E=R,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return A},set:function(R){var I=r(R);I?(A=I,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return z},set:function(R){if(R<0||R>100)throw new Error("Position must be between 0 and 100.");z=R,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return D},set:function(R){var I=r(R);I?(D=I,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return P},set:function(R){if(R<0||R>100)throw new Error("Size must be between 0 and 100.");P=R,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return G},set:function(R){var I=r(R);if(!I)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");G=I,this.hasBeenReset=!0}}}),this.displayState=void 0}return s.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},vttcue=s,vttcue}var vttregion,hasRequiredVttregion;function requireVttregion(){if(hasRequiredVttregion)return vttregion;hasRequiredVttregion=1;var i={"":!0,up:!0};function e(r){if(typeof r!="string")return!1;var s=i[r.toLowerCase()];return s?r.toLowerCase():!1}function t(r){return typeof r=="number"&&r>=0&&r<=100}function n(){var r=100,s=3,a=0,l=100,u=0,d=100,h="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return r},set:function(p){if(!t(p))throw new Error("Width must be between 0 and 100.");r=p}},lines:{enumerable:!0,get:function(){return s},set:function(p){if(typeof p!="number")throw new TypeError("Lines must be set to a number.");s=p}},regionAnchorY:{enumerable:!0,get:function(){return l},set:function(p){if(!t(p))throw new Error("RegionAnchorX must be between 0 and 100.");l=p}},regionAnchorX:{enumerable:!0,get:function(){return a},set:function(p){if(!t(p))throw new Error("RegionAnchorY must be between 0 and 100.");a=p}},viewportAnchorY:{enumerable:!0,get:function(){return d},set:function(p){if(!t(p))throw new Error("ViewportAnchorY must be between 0 and 100.");d=p}},viewportAnchorX:{enumerable:!0,get:function(){return u},set:function(p){if(!t(p))throw new Error("ViewportAnchorX must be between 0 and 100.");u=p}},scroll:{enumerable:!0,get:function(){return h},set:function(p){var m=e(p);m===!1?console.warn("Scroll: an invalid or illegal string was specified."):h=m}}})}return vttregion=n,vttregion}var hasRequiredBrowserIndex;function requireBrowserIndex(){if(hasRequiredBrowserIndex)return browserIndex.exports;hasRequiredBrowserIndex=1;var i=requireWindow(),e=browserIndex.exports={WebVTT:requireVtt(),VTTCue:requireVttcue(),VTTRegion:requireVttregion()};i.vttjs=e,i.WebVTT=e.WebVTT;var t=e.VTTCue,n=e.VTTRegion,r=i.VTTCue,s=i.VTTRegion;return e.shim=function(){i.VTTCue=t,i.VTTRegion=n},e.restore=function(){i.VTTCue=r,i.VTTRegion=s},i.VTTCue||e.shim(),browserIndex.exports}var browserIndexExports=requireBrowserIndex();const vtt=getDefaultExportFromCjs(browserIndexExports);function _extends(){return _extends=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},_extends.apply(null,arguments)}var DEFAULT_LOCATION="https://example.com",resolveUrl$1=function(e,t){if(/^[a-z]+:/i.test(t))return t;/^data:/.test(e)&&(e=window$1.location&&window$1.location.href||"");var n=/^\/\//.test(e),r=!window$1.location&&!/\/\//i.test(e);e=new window$1.URL(e,window$1.location||DEFAULT_LOCATION);var s=new URL(t,e);return r?s.href.slice(DEFAULT_LOCATION.length):n?s.href.slice(s.protocol.length):s.href},Stream=(function(){function i(){this.listeners={}}var e=i.prototype;return e.on=function(n,r){this.listeners[n]||(this.listeners[n]=[]),this.listeners[n].push(r)},e.off=function(n,r){if(!this.listeners[n])return!1;var s=this.listeners[n].indexOf(r);return this.listeners[n]=this.listeners[n].slice(0),this.listeners[n].splice(s,1),s>-1},e.trigger=function(n){var r=this.listeners[n];if(r)if(arguments.length===2)for(var s=r.length,a=0;a<s;++a)r[a].call(this,arguments[1]);else for(var l=Array.prototype.slice.call(arguments,1),u=r.length,d=0;d<u;++d)r[d].apply(this,l)},e.dispose=function(){this.listeners={}},e.pipe=function(n){this.on("data",function(r){n.push(r)})},i})(),atob$1=function(e){return window$1.atob?window$1.atob(e):Buffer.from(e,"base64").toString("binary")};function decodeB64ToUint8Array(i){for(var e=atob$1(i),t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}class LineStream extends Stream{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf(`
`);t>-1;t=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const TAB="	",parseByterange=function(i){const e=/([0-9.]*)?@?([0-9.]*)?/.exec(i||""),t={};return e[1]&&(t.length=parseInt(e[1],10)),e[2]&&(t.offset=parseInt(e[2],10)),t},attributeSeparator=function(){const t="(?:"+"[^=]*"+")=(?:"+'"[^"]*"|[^,]*'+")";return new RegExp("(?:^|,)("+t+")")},parseAttributes$1=function(i){const e={};if(!i)return e;const t=i.split(attributeSeparator());let n=t.length,r;for(;n--;)t[n]!==""&&(r=/([^=]*)=(.*)/.exec(t[n]).slice(1),r[0]=r[0].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^['"](.*)['"]$/g,"$1"),e[r[0]]=r[1]);return e},parseResolution=i=>{const e=i.split("x"),t={};return e[0]&&(t.width=parseInt(e[0],10)),e[1]&&(t.height=parseInt(e[1],10)),t};class ParseStream extends Stream{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,n;if(e=e.trim(),e.length===0)return;if(e[0]!=="#"){this.trigger("data",{type:"uri",uri:e});return}this.tagMappers.reduce((s,a)=>{const l=a(e);return l===e?s:s.concat([l])},[e]).forEach(s=>{for(let a=0;a<this.customParsers.length;a++)if(this.customParsers[a].call(this,s))return;if(s.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:s.slice(1)});return}if(s=s.replace("\r",""),t=/^#EXTM3U/.exec(s),t){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(s),t){n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),this.trigger("data",n);return}if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(s),t){n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(s),t){n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(s),t){n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(s),t){n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),this.trigger("data",n);return}if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(s),t){n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),this.trigger("data",n);return}if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(s),t){n=_extends(parseByterange(t[1]),{type:"tag",tagType:"byterange"}),this.trigger("data",n);return}if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(s),t){n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),this.trigger("data",n);return}if(t=/^#EXT-X-MAP:(.*)$/.exec(s),t){if(n={type:"tag",tagType:"map"},t[1]){const a=parseAttributes$1(t[1]);a.URI&&(n.uri=a.URI),a.BYTERANGE&&(n.byterange=parseByterange(a.BYTERANGE))}this.trigger("data",n);return}if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(s),t){n={type:"tag",tagType:"stream-inf"},t[1]&&(n.attributes=parseAttributes$1(t[1]),n.attributes.RESOLUTION&&(n.attributes.RESOLUTION=parseResolution(n.attributes.RESOLUTION)),n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))),this.trigger("data",n);return}if(t=/^#EXT-X-MEDIA:(.*)$/.exec(s),t){n={type:"tag",tagType:"media"},t[1]&&(n.attributes=parseAttributes$1(t[1])),this.trigger("data",n);return}if(t=/^#EXT-X-ENDLIST/.exec(s),t){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(t=/^#EXT-X-DISCONTINUITY/.exec(s),t){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(s),t){n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),this.trigger("data",n);return}if(t=/^#EXT-X-KEY:(.*)$/.exec(s),t){n={type:"tag",tagType:"key"},t[1]&&(n.attributes=parseAttributes$1(t[1]),n.attributes.IV&&(n.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),this.trigger("data",n);return}if(t=/^#EXT-X-START:(.*)$/.exec(s),t){n={type:"tag",tagType:"start"},t[1]&&(n.attributes=parseAttributes$1(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),this.trigger("data",n);return}if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(s),t){n={type:"tag",tagType:"cue-out-cont"},t[1]?n.data=t[1]:n.data="",this.trigger("data",n);return}if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(s),t){n={type:"tag",tagType:"cue-out"},t[1]?n.data=t[1]:n.data="",this.trigger("data",n);return}if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(s),t){n={type:"tag",tagType:"cue-in"},t[1]?n.data=t[1]:n.data="",this.trigger("data",n);return}if(t=/^#EXT-X-SKIP:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"skip"},n.attributes=parseAttributes$1(t[1]),n.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(n.attributes["SKIPPED-SEGMENTS"]=parseInt(n.attributes["SKIPPED-SEGMENTS"],10)),n.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(n.attributes["RECENTLY-REMOVED-DATERANGES"]=n.attributes["RECENTLY-REMOVED-DATERANGES"].split(TAB)),this.trigger("data",n);return}if(t=/^#EXT-X-PART:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"part"},n.attributes=parseAttributes$1(t[1]),["DURATION"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseFloat(n.attributes[a]))}),["INDEPENDENT","GAP"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=/YES/.test(n.attributes[a]))}),n.attributes.hasOwnProperty("BYTERANGE")&&(n.attributes.byterange=parseByterange(n.attributes.BYTERANGE)),this.trigger("data",n);return}if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"server-control"},n.attributes=parseAttributes$1(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseFloat(n.attributes[a]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=/YES/.test(n.attributes[a]))}),this.trigger("data",n);return}if(t=/^#EXT-X-PART-INF:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"part-inf"},n.attributes=parseAttributes$1(t[1]),["PART-TARGET"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseFloat(n.attributes[a]))}),this.trigger("data",n);return}if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"preload-hint"},n.attributes=parseAttributes$1(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(a){if(n.attributes.hasOwnProperty(a)){n.attributes[a]=parseInt(n.attributes[a],10);const l=a==="BYTERANGE-LENGTH"?"length":"offset";n.attributes.byterange=n.attributes.byterange||{},n.attributes.byterange[l]=n.attributes[a],delete n.attributes[a]}}),this.trigger("data",n);return}if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"rendition-report"},n.attributes=parseAttributes$1(t[1]),["LAST-MSN","LAST-PART"].forEach(function(a){n.attributes.hasOwnProperty(a)&&(n.attributes[a]=parseInt(n.attributes[a],10))}),this.trigger("data",n);return}if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(s),t&&t[1]){n={type:"tag",tagType:"daterange"},n.attributes=parseAttributes$1(t[1]),["ID","CLASS"].forEach(function(l){n.attributes.hasOwnProperty(l)&&(n.attributes[l]=String(n.attributes[l]))}),["START-DATE","END-DATE"].forEach(function(l){n.attributes.hasOwnProperty(l)&&(n.attributes[l]=new Date(n.attributes[l]))}),["DURATION","PLANNED-DURATION"].forEach(function(l){n.attributes.hasOwnProperty(l)&&(n.attributes[l]=parseFloat(n.attributes[l]))}),["END-ON-NEXT"].forEach(function(l){n.attributes.hasOwnProperty(l)&&(n.attributes[l]=/YES/i.test(n.attributes[l]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(l){n.attributes.hasOwnProperty(l)&&(n.attributes[l]=n.attributes[l].toString(16))});const a=/^X-([A-Z]+-)+[A-Z]+$/;for(const l in n.attributes){if(!a.test(l))continue;const u=/[0-9A-Fa-f]{6}/g.test(n.attributes[l]),d=/^\d+(\.\d+)?$/.test(n.attributes[l]);n.attributes[l]=u?n.attributes[l].toString(16):d?parseFloat(n.attributes[l]):String(n.attributes[l])}this.trigger("data",n);return}if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(s),t){this.trigger("data",{type:"tag",tagType:"independent-segments"});return}if(t=/^#EXT-X-I-FRAMES-ONLY/.exec(s),t){this.trigger("data",{type:"tag",tagType:"i-frames-only"});return}if(t=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(s),t){n={type:"tag",tagType:"content-steering"},n.attributes=parseAttributes$1(t[1]),this.trigger("data",n);return}if(t=/^#EXT-X-I-FRAME-STREAM-INF:(.*)$/.exec(s),t){n={type:"tag",tagType:"i-frame-playlist"},n.attributes=parseAttributes$1(t[1]),n.attributes.URI&&(n.uri=n.attributes.URI),n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes.RESOLUTION&&(n.attributes.RESOLUTION=parseResolution(n.attributes.RESOLUTION)),n.attributes["AVERAGE-BANDWIDTH"]&&(n.attributes["AVERAGE-BANDWIDTH"]=parseInt(n.attributes["AVERAGE-BANDWIDTH"],10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),this.trigger("data",n);return}if(t=/^#EXT-X-DEFINE:(.*)$/.exec(s),t){n={type:"tag",tagType:"define"},n.attributes=parseAttributes$1(t[1]),this.trigger("data",n);return}this.trigger("data",{type:"tag",data:s.slice(4)})})}addParser({expression:e,customType:t,dataParser:n,segment:r}){typeof n!="function"&&(n=s=>s),this.customParsers.push(s=>{if(e.exec(s))return this.trigger("data",{type:"custom",data:n(s),customType:t,segment:r}),!0})}addTagMapper({expression:e,map:t}){const n=r=>e.test(r)?t(r):r;this.tagMappers.push(n)}}const camelCase=i=>i.toLowerCase().replace(/-(\w)/g,e=>e[1].toUpperCase()),camelCaseKeys=function(i){const e={};return Object.keys(i).forEach(function(t){e[camelCase(t)]=i[t]}),e},setHoldBack=function(i){const{serverControl:e,targetDuration:t,partTargetDuration:n}=i;if(!e)return;const r="#EXT-X-SERVER-CONTROL",s="holdBack",a="partHoldBack",l=t&&t*3,u=n&&n*2;t&&!e.hasOwnProperty(s)&&(e[s]=l,this.trigger("info",{message:`${r} defaulting HOLD-BACK to targetDuration * 3 (${l}).`})),l&&e[s]<l&&(this.trigger("warn",{message:`${r} clamping HOLD-BACK (${e[s]}) to targetDuration * 3 (${l})`}),e[s]=l),n&&!e.hasOwnProperty(a)&&(e[a]=n*3,this.trigger("info",{message:`${r} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${e[a]}).`})),n&&e[a]<u&&(this.trigger("warn",{message:`${r} clamping PART-HOLD-BACK (${e[a]}) to partTargetDuration * 2 (${u}).`}),e[a]=u)};class Parser extends Stream{constructor(e={}){super(),this.lineStream=new LineStream,this.parseStream=new ParseStream,this.lineStream.pipe(this.parseStream),this.mainDefinitions=e.mainDefinitions||{},this.params=new URL(e.uri,"https://a.com").searchParams,this.lastProgramDateTime=null;const t=this,n=[];let r={},s,a,l=!1;const u=function(){},d={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},h="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";let p=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],iFramePlaylists:[],segments:[]};let m=0,g=0;const v={};this.on("end",()=>{r.uri||!r.parts&&!r.preloadHints||(!r.map&&s&&(r.map=s),!r.key&&a&&(r.key=a),!r.timeline&&typeof p=="number"&&(r.timeline=p),this.manifest.preloadSegment=r)}),this.parseStream.on("data",function(_){let b,E;if(t.manifest.definitions){for(const A in t.manifest.definitions)if(_.uri&&(_.uri=_.uri.replace(`{$${A}}`,t.manifest.definitions[A])),_.attributes)for(const z in _.attributes)typeof _.attributes[z]=="string"&&(_.attributes[z]=_.attributes[z].replace(`{$${A}}`,t.manifest.definitions[A]))}({tag(){({version(){_.version&&(this.manifest.version=_.version)},"allow-cache"(){this.manifest.allowCache=_.allowed,"allowed"in _||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const A={};"length"in _&&(r.byterange=A,A.length=_.length,"offset"in _||(_.offset=m)),"offset"in _&&(r.byterange=A,A.offset=_.offset),m=A.offset+A.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),_.title&&(r.title=_.title),_.duration>0&&(r.duration=_.duration),_.duration===0&&(r.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=n},key(){if(!_.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(_.attributes.METHOD==="NONE"){a=null;return}if(!_.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(_.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:_.attributes};return}if(_.attributes.KEYFORMAT==="com.microsoft.playready"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:_.attributes.URI};return}if(_.attributes.KEYFORMAT===h){if(["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(_.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(_.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),_.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(_.attributes.KEYID&&_.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:_.attributes.KEYFORMAT,keyId:_.attributes.KEYID.substring(2)},pssh:decodeB64ToUint8Array(_.attributes.URI.split(",")[1])};return}_.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),a={method:_.attributes.METHOD||"AES-128",uri:_.attributes.URI},typeof _.attributes.IV<"u"&&(a.iv=_.attributes.IV)},"media-sequence"(){if(!isFinite(_.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+_.number});return}this.manifest.mediaSequence=_.number},"discontinuity-sequence"(){if(!isFinite(_.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+_.number});return}this.manifest.discontinuitySequence=_.number,p=_.number},"playlist-type"(){if(!/VOD|EVENT/.test(_.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+_.playlist});return}this.manifest.playlistType=_.playlistType},map(){s={},_.uri&&(s.uri=_.uri),_.byterange&&(s.byterange=_.byterange),a&&(s.key=a)},"stream-inf"(){if(this.manifest.playlists=n,this.manifest.mediaGroups=this.manifest.mediaGroups||d,!_.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}r.attributes||(r.attributes={}),_extends(r.attributes,_.attributes)},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||d,!(_.attributes&&_.attributes.TYPE&&_.attributes["GROUP-ID"]&&_.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}const A=this.manifest.mediaGroups[_.attributes.TYPE];A[_.attributes["GROUP-ID"]]=A[_.attributes["GROUP-ID"]]||{},b=A[_.attributes["GROUP-ID"]],E={default:/yes/i.test(_.attributes.DEFAULT)},E.default?E.autoselect=!0:E.autoselect=/yes/i.test(_.attributes.AUTOSELECT),_.attributes.LANGUAGE&&(E.language=_.attributes.LANGUAGE),_.attributes.URI&&(E.uri=_.attributes.URI),_.attributes["INSTREAM-ID"]&&(E.instreamId=_.attributes["INSTREAM-ID"]),_.attributes.CHARACTERISTICS&&(E.characteristics=_.attributes.CHARACTERISTICS),_.attributes.FORCED&&(E.forced=/yes/i.test(_.attributes.FORCED)),b[_.attributes.NAME]=E},discontinuity(){p+=1,r.discontinuity=!0,this.manifest.discontinuityStarts.push(n.length)},"program-date-time"(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=_.dateTimeString,this.manifest.dateTimeObject=_.dateTimeObject),r.dateTimeString=_.dateTimeString,r.dateTimeObject=_.dateTimeObject;const{lastProgramDateTime:A}=this;this.lastProgramDateTime=new Date(_.dateTimeString).getTime(),A===null&&this.manifest.segments.reduceRight((z,D)=>(D.programDateTime=z-D.duration*1e3,D.programDateTime),this.lastProgramDateTime)},targetduration(){if(!isFinite(_.duration)||_.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+_.duration});return}this.manifest.targetDuration=_.duration,setHoldBack.call(this,this.manifest)},start(){if(!_.attributes||isNaN(_.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:_.attributes["TIME-OFFSET"],precise:_.attributes.PRECISE}},"cue-out"(){r.cueOut=_.data},"cue-out-cont"(){r.cueOutCont=_.data},"cue-in"(){r.cueIn=_.data},skip(){this.manifest.skip=camelCaseKeys(_.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",_.attributes,["SKIPPED-SEGMENTS"])},part(){l=!0;const A=this.manifest.segments.length,z=camelCaseKeys(_.attributes);r.parts=r.parts||[],r.parts.push(z),z.byterange&&(z.byterange.hasOwnProperty("offset")||(z.byterange.offset=g),g=z.byterange.offset+z.byterange.length);const D=r.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${D} for segment #${A}`,_.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((P,G)=>{P.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${G} lacks required attribute(s): LAST-PART`})})},"server-control"(){const A=this.manifest.serverControl=camelCaseKeys(_.attributes);A.hasOwnProperty("canBlockReload")||(A.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),setHoldBack.call(this,this.manifest),A.canSkipDateranges&&!A.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const A=this.manifest.segments.length,z=camelCaseKeys(_.attributes),D=z.type&&z.type==="PART";r.preloadHints=r.preloadHints||[],r.preloadHints.push(z),z.byterange&&(z.byterange.hasOwnProperty("offset")||(z.byterange.offset=D?g:0,D&&(g=z.byterange.offset+z.byterange.length)));const P=r.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${P} for segment #${A}`,_.attributes,["TYPE","URI"]),!!z.type)for(let G=0;G<r.preloadHints.length-1;G++){const R=r.preloadHints[G];R.type&&R.type===z.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${P} for segment #${A} has the same TYPE ${z.type} as preload hint #${G}`})}},"rendition-report"(){const A=camelCaseKeys(_.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(A);const z=this.manifest.renditionReports.length-1,D=["LAST-MSN","URI"];l&&D.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${z}`,_.attributes,D)},"part-inf"(){this.manifest.partInf=camelCaseKeys(_.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",_.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),setHoldBack.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(camelCaseKeys(_.attributes));const A=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${A}`,_.attributes,["ID","START-DATE"]);const z=this.manifest.dateRanges[A];z.endDate&&z.startDate&&new Date(z.endDate)<new Date(z.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),z.duration&&z.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),z.plannedDuration&&z.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const D=!!z.endOnNext;if(D&&!z.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),D&&(z.duration||z.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),z.duration&&z.endDate){const G=z.startDate.getTime()+z.duration*1e3;this.manifest.dateRanges[A].endDate=new Date(G)}if(!v[z.id])v[z.id]=z;else{for(const G in v[z.id])if(z[G]&&JSON.stringify(v[z.id][G])!==JSON.stringify(z[G])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}const P=this.manifest.dateRanges.findIndex(G=>G.id===z.id);this.manifest.dateRanges[P]=_extends(this.manifest.dateRanges[P],z),v[z.id]=_extends(v[z.id],z),this.manifest.dateRanges.pop()}},"independent-segments"(){this.manifest.independentSegments=!0},"i-frames-only"(){this.manifest.iFramesOnly=!0,this.requiredCompatibilityversion(this.manifest.version,4)},"content-steering"(){this.manifest.contentSteering=camelCaseKeys(_.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",_.attributes,["SERVER-URI"])},define(){this.manifest.definitions=this.manifest.definitions||{};const A=(z,D)=>{if(z in this.manifest.definitions){this.trigger("error",{message:`EXT-X-DEFINE: Duplicate name ${z}`});return}this.manifest.definitions[z]=D};if("QUERYPARAM"in _.attributes){if("NAME"in _.attributes||"IMPORT"in _.attributes){this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});return}const z=this.params.get(_.attributes.QUERYPARAM);if(!z){this.trigger("error",{message:`EXT-X-DEFINE: No query param ${_.attributes.QUERYPARAM}`});return}A(_.attributes.QUERYPARAM,decodeURIComponent(z));return}if("NAME"in _.attributes){if("IMPORT"in _.attributes){this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});return}if(!("VALUE"in _.attributes)||typeof _.attributes.VALUE!="string"){this.trigger("error",{message:`EXT-X-DEFINE: No value for ${_.attributes.NAME}`});return}A(_.attributes.NAME,_.attributes.VALUE);return}if("IMPORT"in _.attributes){if(!this.mainDefinitions[_.attributes.IMPORT]){this.trigger("error",{message:`EXT-X-DEFINE: No value ${_.attributes.IMPORT} to import, or IMPORT used on main playlist`});return}A(_.attributes.IMPORT,this.mainDefinitions[_.attributes.IMPORT]);return}this.trigger("error",{message:"EXT-X-DEFINE: No attribute"})},"i-frame-playlist"(){this.manifest.iFramePlaylists.push({attributes:_.attributes,uri:_.uri,timeline:p}),this.warnOnMissingAttributes_("#EXT-X-I-FRAME-STREAM-INF",_.attributes,["BANDWIDTH","URI"])}}[_.tagType]||u).call(t)},uri(){r.uri=_.uri,n.push(r),this.manifest.targetDuration&&!("duration"in r)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),r.duration=this.manifest.targetDuration),a&&(r.key=a),r.timeline=p,s&&(r.map=s),g=0,this.lastProgramDateTime!==null&&(r.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=r.duration*1e3),r={}},comment(){},custom(){_.segment?(r.custom=r.custom||{},r.custom[_.customType]=_.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[_.customType]=_.data)}})[_.type].call(t)})}requiredCompatibilityversion(e,t){(e<t||!e)&&this.trigger("warn",{message:`manifest must be at least version ${t}`})}warnOnMissingAttributes_(e,t,n){const r=[];n.forEach(function(s){t.hasOwnProperty(s)||r.push(s)}),r.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${r.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push(`
`),this.manifest.dateRanges.length&&this.lastProgramDateTime===null&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}var regexs={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},mediaTypes=["video","audio","text"],upperMediaTypes=["Video","Audio","Text"],translateLegacyCodec=function(e){return e&&e.replace(/avc1\.(\d+)\.(\d+)/i,function(t,n,r){var s=("00"+Number(n).toString(16)).slice(-2),a=("00"+Number(r).toString(16)).slice(-2);return"avc1."+s+"00"+a})},parseCodecs=function(e){e===void 0&&(e="");var t=e.split(","),n=[];return t.forEach(function(r){r=r.trim();var s;mediaTypes.forEach(function(a){var l=regexs[a].exec(r.toLowerCase());if(!(!l||l.length<=1)){s=a;var u=r.substring(0,l[1].length),d=r.replace(u,"");n.push({type:u,details:d,mediaType:a})}}),s||n.push({type:r,details:"",mediaType:"unknown"})}),n},codecsFromDefault=function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var n=e.mediaGroups.AUDIO[t];if(!n)return null;for(var r in n){var s=n[r];if(s.default&&s.playlists)return parseCodecs(s.playlists[0].attributes.CODECS)}return null},isAudioCodec=function(e){return e===void 0&&(e=""),regexs.audio.test(e.trim().toLowerCase())},isTextCodec=function(e){return e===void 0&&(e=""),regexs.text.test(e.trim().toLowerCase())},getMimeForCodec=function(e){if(!(!e||typeof e!="string")){var t=e.toLowerCase().split(",").map(function(s){return translateLegacyCodec(s.trim())}),n="video";t.length===1&&isAudioCodec(t[0])?n="audio":t.length===1&&isTextCodec(t[0])&&(n="application");var r="mp4";return t.every(function(s){return regexs.mp4.test(s)})?r="mp4":t.every(function(s){return regexs.webm.test(s)})?r="webm":t.every(function(s){return regexs.ogg.test(s)})&&(r="ogg"),n+"/"+r+';codecs="'+e+'"'}},browserSupportsCodec=function(e,t){return e===void 0&&(e=""),t===void 0&&(t=!1),window$1.MediaSource&&window$1.MediaSource.isTypeSupported&&window$1.MediaSource.isTypeSupported(getMimeForCodec(e))||t&&window$1.ManagedMediaSource&&window$1.ManagedMediaSource.isTypeSupported&&window$1.ManagedMediaSource.isTypeSupported(getMimeForCodec(e))||!1},muxerSupportsCodec=function(e){return e===void 0&&(e=""),e.toLowerCase().split(",").every(function(t){t=t.trim();for(var n=0;n<upperMediaTypes.length;n++){var r=upperMediaTypes[n];if(regexs["muxer"+r].test(t))return!0}return!1})},DEFAULT_AUDIO_CODEC="mp4a.40.2",DEFAULT_VIDEO_CODEC="avc1.4d400d",MPEGURL_REGEX=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,DASH_REGEX=/^application\/dash\+xml/i,simpleTypeFromSourceType=function(e){return MPEGURL_REGEX.test(e)?"hls":DASH_REGEX.test(e)?"dash":e==="application/vnd.videojs.vhs+json"?"vhs-json":null},countBits=function(e){return e.toString(2).length},countBytes=function(e){return Math.ceil(countBits(e)/8)},isArrayBufferView=function(e){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},isTypedArray=function(e){return isArrayBufferView(e)},toUint8=function(e){return e instanceof Uint8Array?e:(!Array.isArray(e)&&!isTypedArray(e)&&!(e instanceof ArrayBuffer)&&(typeof e!="number"||typeof e=="number"&&e!==e?e=0:e=[e]),new Uint8Array(e&&e.buffer||e,e&&e.byteOffset||0,e&&e.byteLength||0))},BigInt=window$1.BigInt||Number,BYTE_TABLE=[BigInt("0x1"),BigInt("0x100"),BigInt("0x10000"),BigInt("0x1000000"),BigInt("0x100000000"),BigInt("0x10000000000"),BigInt("0x1000000000000"),BigInt("0x100000000000000"),BigInt("0x10000000000000000")];(function(){var i=new Uint16Array([65484]),e=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);return e[0]===255?"big":e[0]===204?"little":"unknown"})();var bytesToNumber=function(e,t){var n=t===void 0?{}:t,r=n.signed,s=r===void 0?!1:r,a=n.le,l=a===void 0?!1:a;e=toUint8(e);var u=l?"reduce":"reduceRight",d=e[u]?e[u]:Array.prototype[u],h=d.call(e,function(m,g,v){var _=l?v:Math.abs(v+1-e.length);return m+BigInt(g)*BYTE_TABLE[_]},BigInt(0));if(s){var p=BYTE_TABLE[e.length]/BigInt(2)-BigInt(1);h=BigInt(h),h>p&&(h-=p,h-=p,h-=BigInt(2))}return Number(h)},numberToBytes=function(e,t){var n={},r=n.le,s=r===void 0?!1:r;(typeof e!="bigint"&&typeof e!="number"||typeof e=="number"&&e!==e)&&(e=0),e=BigInt(e);for(var a=countBytes(e),l=new Uint8Array(new ArrayBuffer(a)),u=0;u<a;u++){var d=s?u:Math.abs(u+1-l.length);l[d]=Number(e/BYTE_TABLE[u]&BigInt(255)),e<0&&(l[d]=Math.abs(~l[d]),l[d]-=u===0?1:2)}return l},stringToBytes$1=function(e,t){if(typeof e!="string"&&e&&typeof e.toString=="function"&&(e=e.toString()),typeof e!="string")return new Uint8Array;t||(e=unescape(encodeURIComponent(e)));for(var n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},concatTypedArrays=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t=t.filter(function(l){return l&&(l.byteLength||l.length)&&typeof l!="string"}),t.length<=1)return toUint8(t[0]);var r=t.reduce(function(l,u,d){return l+(u.byteLength||u.length)},0),s=new Uint8Array(r),a=0;return t.forEach(function(l){l=toUint8(l),s.set(l,a),a+=l.byteLength}),s},bytesMatch=function(e,t,n){var r=n===void 0?{}:n,s=r.offset,a=s===void 0?0:s,l=r.mask,u=l===void 0?[]:l;e=toUint8(e),t=toUint8(t);var d=t.every?t.every:Array.prototype.every;return t.length&&e.length-a>=t.length&&d.call(t,function(h,p){var m=u[p]?u[p]&e[a+p]:e[a+p];return h===m})},forEachMediaGroup$1=function(e,t,n){t.forEach(function(r){for(var s in e.mediaGroups[r])for(var a in e.mediaGroups[r][s]){var l=e.mediaGroups[r][s][a];n(l,r,s,a)}})},lib$i={},dom={},conventions={},hasRequiredConventions;function requireConventions(){if(hasRequiredConventions)return conventions;hasRequiredConventions=1;function i(s,a,l){if(l===void 0&&(l=Array.prototype),s&&typeof l.find=="function")return l.find.call(s,a);for(var u=0;u<s.length;u++)if(Object.prototype.hasOwnProperty.call(s,u)){var d=s[u];if(a.call(void 0,d,u,s))return d}}function e(s,a){return a===void 0&&(a=Object),a&&typeof a.freeze=="function"?a.freeze(s):s}function t(s,a){if(s===null||typeof s!="object")throw new TypeError("target is not an object");for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(s[l]=a[l]);return s}var n=e({HTML:"text/html",isHTML:function(s){return s===n.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),r=e({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(s){return s===r.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});return conventions.assign=t,conventions.find=i,conventions.freeze=e,conventions.MIME_TYPE=n,conventions.NAMESPACE=r,conventions}var hasRequiredDom;function requireDom(){if(hasRequiredDom)return dom;hasRequiredDom=1;var i=requireConventions(),e=i.find,t=i.NAMESPACE;function n(xe){return xe!==""}function r(xe){return xe?xe.split(/[\t\n\f\r ]+/).filter(n):[]}function s(xe,Ce){return xe.hasOwnProperty(Ce)||(xe[Ce]=!0),xe}function a(xe){if(!xe)return[];var Ce=r(xe);return Object.keys(Ce.reduce(s,{}))}function l(xe){return function(Ce){return xe&&xe.indexOf(Ce)!==-1}}function u(xe,Ce){for(var Fe in xe)Object.prototype.hasOwnProperty.call(xe,Fe)&&(Ce[Fe]=xe[Fe])}function d(xe,Ce){var Fe=xe.prototype;if(!(Fe instanceof Ce)){let tt=function(){};tt.prototype=Ce.prototype,tt=new tt,u(Fe,tt),xe.prototype=Fe=tt}Fe.constructor!=xe&&(typeof xe!="function"&&console.error("unknown Class:"+xe),Fe.constructor=xe)}var h={},p=h.ELEMENT_NODE=1,m=h.ATTRIBUTE_NODE=2,g=h.TEXT_NODE=3,v=h.CDATA_SECTION_NODE=4,_=h.ENTITY_REFERENCE_NODE=5,b=h.ENTITY_NODE=6,E=h.PROCESSING_INSTRUCTION_NODE=7,A=h.COMMENT_NODE=8,z=h.DOCUMENT_NODE=9,D=h.DOCUMENT_TYPE_NODE=10,P=h.DOCUMENT_FRAGMENT_NODE=11,G=h.NOTATION_NODE=12,R={},I={};R.INDEX_SIZE_ERR=(I[1]="Index size error",1),R.DOMSTRING_SIZE_ERR=(I[2]="DOMString size error",2);var w=R.HIERARCHY_REQUEST_ERR=(I[3]="Hierarchy request error",3);R.WRONG_DOCUMENT_ERR=(I[4]="Wrong document",4),R.INVALID_CHARACTER_ERR=(I[5]="Invalid character",5),R.NO_DATA_ALLOWED_ERR=(I[6]="No data allowed",6),R.NO_MODIFICATION_ALLOWED_ERR=(I[7]="No modification allowed",7);var H=R.NOT_FOUND_ERR=(I[8]="Not found",8);R.NOT_SUPPORTED_ERR=(I[9]="Not supported",9);var V=R.INUSE_ATTRIBUTE_ERR=(I[10]="Attribute in use",10);R.INVALID_STATE_ERR=(I[11]="Invalid state",11),R.SYNTAX_ERR=(I[12]="Syntax error",12),R.INVALID_MODIFICATION_ERR=(I[13]="Invalid modification",13),R.NAMESPACE_ERR=(I[14]="Invalid namespace",14),R.INVALID_ACCESS_ERR=(I[15]="Invalid access",15);function te(xe,Ce){if(Ce instanceof Error)var Fe=Ce;else Fe=this,Error.call(this,I[xe]),this.message=I[xe],Error.captureStackTrace&&Error.captureStackTrace(this,te);return Fe.code=xe,Ce&&(this.message=this.message+": "+Ce),Fe}te.prototype=Error.prototype,u(R,te);function ae(){}ae.prototype={length:0,item:function(xe){return xe>=0&&xe<this.length?this[xe]:null},toString:function(xe,Ce){for(var Fe=[],tt=0;tt<this.length;tt++)Yi(this[tt],Fe,xe,Ce);return Fe.join("")},filter:function(xe){return Array.prototype.filter.call(this,xe)},indexOf:function(xe){return Array.prototype.indexOf.call(this,xe)}};function be(xe,Ce){this._node=xe,this._refresh=Ce,_e(this)}function _e(xe){var Ce=xe._node._inc||xe._node.ownerDocument._inc;if(xe._inc!==Ce){var Fe=xe._refresh(xe._node);if(Li(xe,"length",Fe.length),!xe.$$length||Fe.length<xe.$$length)for(var tt=Fe.length;tt in xe;tt++)Object.prototype.hasOwnProperty.call(xe,tt)&&delete xe[tt];u(Fe,xe),xe._inc=Ce}}be.prototype.item=function(xe){return _e(this),this[xe]||null},d(be,ae);function le(){}function ue(xe,Ce){for(var Fe=xe.length;Fe--;)if(xe[Fe]===Ce)return Fe}function oe(xe,Ce,Fe,tt){if(tt?Ce[ue(Ce,tt)]=Fe:Ce[Ce.length++]=Fe,xe){Fe.ownerElement=xe;var Tn=xe.ownerDocument;Tn&&(tt&&Ee(Tn,xe,tt),ce(Tn,xe,Fe))}}function ee(xe,Ce,Fe){var tt=ue(Ce,Fe);if(tt>=0){for(var Tn=Ce.length-1;tt<Tn;)Ce[tt]=Ce[++tt];if(Ce.length=Tn,xe){var jn=xe.ownerDocument;jn&&(Ee(jn,xe,Fe),Fe.ownerElement=null)}}else throw new te(H,new Error(xe.tagName+"@"+Fe))}le.prototype={length:0,item:ae.prototype.item,getNamedItem:function(xe){for(var Ce=this.length;Ce--;){var Fe=this[Ce];if(Fe.nodeName==xe)return Fe}},setNamedItem:function(xe){var Ce=xe.ownerElement;if(Ce&&Ce!=this._ownerElement)throw new te(V);var Fe=this.getNamedItem(xe.nodeName);return oe(this._ownerElement,this,xe,Fe),Fe},setNamedItemNS:function(xe){var Ce=xe.ownerElement,Fe;if(Ce&&Ce!=this._ownerElement)throw new te(V);return Fe=this.getNamedItemNS(xe.namespaceURI,xe.localName),oe(this._ownerElement,this,xe,Fe),Fe},removeNamedItem:function(xe){var Ce=this.getNamedItem(xe);return ee(this._ownerElement,this,Ce),Ce},removeNamedItemNS:function(xe,Ce){var Fe=this.getNamedItemNS(xe,Ce);return ee(this._ownerElement,this,Fe),Fe},getNamedItemNS:function(xe,Ce){for(var Fe=this.length;Fe--;){var tt=this[Fe];if(tt.localName==Ce&&tt.namespaceURI==xe)return tt}return null}};function se(){}se.prototype={hasFeature:function(xe,Ce){return!0},createDocument:function(xe,Ce,Fe){var tt=new Z;if(tt.implementation=this,tt.childNodes=new ae,tt.doctype=Fe||null,Fe&&tt.appendChild(Fe),Ce){var Tn=tt.createElementNS(xe,Ce);tt.appendChild(Tn)}return tt},createDocumentType:function(xe,Ce,Fe){var tt=new hi;return tt.name=xe,tt.nodeName=xe,tt.publicId=Ce||"",tt.systemId=Fe||"",tt}};function re(){}re.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(xe,Ce){return st(this,xe,Ce)},replaceChild:function(xe,Ce){st(this,xe,Ce,dt),Ce&&this.removeChild(Ce)},removeChild:function(xe){return Ae(this,xe)},appendChild:function(xe){return this.insertBefore(xe,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(xe){return oi(this.ownerDocument||this,this,xe)},normalize:function(){for(var xe=this.firstChild;xe;){var Ce=xe.nextSibling;Ce&&Ce.nodeType==g&&xe.nodeType==g?(this.removeChild(Ce),xe.appendData(Ce.data)):(xe.normalize(),xe=Ce)}},isSupported:function(xe,Ce){return this.ownerDocument.implementation.hasFeature(xe,Ce)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(xe){for(var Ce=this;Ce;){var Fe=Ce._nsMap;if(Fe){for(var tt in Fe)if(Object.prototype.hasOwnProperty.call(Fe,tt)&&Fe[tt]===xe)return tt}Ce=Ce.nodeType==m?Ce.ownerDocument:Ce.parentNode}return null},lookupNamespaceURI:function(xe){for(var Ce=this;Ce;){var Fe=Ce._nsMap;if(Fe&&Object.prototype.hasOwnProperty.call(Fe,xe))return Fe[xe];Ce=Ce.nodeType==m?Ce.ownerDocument:Ce.parentNode}return null},isDefaultNamespace:function(xe){var Ce=this.lookupPrefix(xe);return Ce==null}};function fe(xe){return xe=="<"&&"&lt;"||xe==">"&&"&gt;"||xe=="&"&&"&amp;"||xe=='"'&&"&quot;"||"&#"+xe.charCodeAt()+";"}u(h,re),u(h,re.prototype);function pe(xe,Ce){if(Ce(xe))return!0;if(xe=xe.firstChild)do if(pe(xe,Ce))return!0;while(xe=xe.nextSibling)}function Z(){this.ownerDocument=this}function ce(xe,Ce,Fe){xe&&xe._inc++;var tt=Fe.namespaceURI;tt===t.XMLNS&&(Ce._nsMap[Fe.prefix?Fe.localName:""]=Fe.value)}function Ee(xe,Ce,Fe,tt){xe&&xe._inc++;var Tn=Fe.namespaceURI;Tn===t.XMLNS&&delete Ce._nsMap[Fe.prefix?Fe.localName:""]}function Te(xe,Ce,Fe){if(xe&&xe._inc){xe._inc++;var tt=Ce.childNodes;if(Fe)tt[tt.length++]=Fe;else{for(var Tn=Ce.firstChild,jn=0;Tn;)tt[jn++]=Tn,Tn=Tn.nextSibling;tt.length=jn,delete tt[tt.length]}}}function Ae(xe,Ce){var Fe=Ce.previousSibling,tt=Ce.nextSibling;return Fe?Fe.nextSibling=tt:xe.firstChild=tt,tt?tt.previousSibling=Fe:xe.lastChild=Fe,Ce.parentNode=null,Ce.previousSibling=null,Ce.nextSibling=null,Te(xe.ownerDocument,xe),Ce}function Pe(xe){return xe&&(xe.nodeType===re.DOCUMENT_NODE||xe.nodeType===re.DOCUMENT_FRAGMENT_NODE||xe.nodeType===re.ELEMENT_NODE)}function Me(xe){return xe&&(qe(xe)||Je(xe)||We(xe)||xe.nodeType===re.DOCUMENT_FRAGMENT_NODE||xe.nodeType===re.COMMENT_NODE||xe.nodeType===re.PROCESSING_INSTRUCTION_NODE)}function We(xe){return xe&&xe.nodeType===re.DOCUMENT_TYPE_NODE}function qe(xe){return xe&&xe.nodeType===re.ELEMENT_NODE}function Je(xe){return xe&&xe.nodeType===re.TEXT_NODE}function wt(xe,Ce){var Fe=xe.childNodes||[];if(e(Fe,qe)||We(Ce))return!1;var tt=e(Fe,We);return!(Ce&&tt&&Fe.indexOf(tt)>Fe.indexOf(Ce))}function rt(xe,Ce){var Fe=xe.childNodes||[];function tt(jn){return qe(jn)&&jn!==Ce}if(e(Fe,tt))return!1;var Tn=e(Fe,We);return!(Ce&&Tn&&Fe.indexOf(Tn)>Fe.indexOf(Ce))}function Lt(xe,Ce,Fe){if(!Pe(xe))throw new te(w,"Unexpected parent node type "+xe.nodeType);if(Fe&&Fe.parentNode!==xe)throw new te(H,"child not in parent");if(!Me(Ce)||We(Ce)&&xe.nodeType!==re.DOCUMENT_NODE)throw new te(w,"Unexpected node type "+Ce.nodeType+" for parent node type "+xe.nodeType)}function ln(xe,Ce,Fe){var tt=xe.childNodes||[],Tn=Ce.childNodes||[];if(Ce.nodeType===re.DOCUMENT_FRAGMENT_NODE){var jn=Tn.filter(qe);if(jn.length>1||e(Tn,Je))throw new te(w,"More than one element or text in fragment");if(jn.length===1&&!wt(xe,Fe))throw new te(w,"Element in fragment can not be inserted before doctype")}if(qe(Ce)&&!wt(xe,Fe))throw new te(w,"Only one element can be added and only after doctype");if(We(Ce)){if(e(tt,We))throw new te(w,"Only one doctype is allowed");var li=e(tt,qe);if(Fe&&tt.indexOf(li)<tt.indexOf(Fe))throw new te(w,"Doctype can only be inserted before an element");if(!Fe&&li)throw new te(w,"Doctype can not be appended since element is present")}}function dt(xe,Ce,Fe){var tt=xe.childNodes||[],Tn=Ce.childNodes||[];if(Ce.nodeType===re.DOCUMENT_FRAGMENT_NODE){var jn=Tn.filter(qe);if(jn.length>1||e(Tn,Je))throw new te(w,"More than one element or text in fragment");if(jn.length===1&&!rt(xe,Fe))throw new te(w,"Element in fragment can not be inserted before doctype")}if(qe(Ce)&&!rt(xe,Fe))throw new te(w,"Only one element can be added and only after doctype");if(We(Ce)){if(e(tt,function(Qi){return We(Qi)&&Qi!==Fe}))throw new te(w,"Only one doctype is allowed");var li=e(tt,qe);if(Fe&&tt.indexOf(li)<tt.indexOf(Fe))throw new te(w,"Doctype can only be inserted before an element")}}function st(xe,Ce,Fe,tt){Lt(xe,Ce,Fe),xe.nodeType===re.DOCUMENT_NODE&&(tt||ln)(xe,Ce,Fe);var Tn=Ce.parentNode;if(Tn&&Tn.removeChild(Ce),Ce.nodeType===P){var jn=Ce.firstChild;if(jn==null)return Ce;var li=Ce.lastChild}else jn=li=Ce;var Fi=Fe?Fe.previousSibling:xe.lastChild;jn.previousSibling=Fi,li.nextSibling=Fe,Fi?Fi.nextSibling=jn:xe.firstChild=jn,Fe==null?xe.lastChild=li:Fe.previousSibling=li;do{jn.parentNode=xe;var Qi=xe.ownerDocument||xe;nt(jn,Qi)}while(jn!==li&&(jn=jn.nextSibling));return Te(xe.ownerDocument||xe,xe),Ce.nodeType==P&&(Ce.firstChild=Ce.lastChild=null),Ce}function nt(xe,Ce){if(xe.ownerDocument!==Ce){if(xe.ownerDocument=Ce,xe.nodeType===p&&xe.attributes)for(var Fe=0;Fe<xe.attributes.length;Fe++){var tt=xe.attributes.item(Fe);tt&&(tt.ownerDocument=Ce)}for(var Tn=xe.firstChild;Tn;)nt(Tn,Ce),Tn=Tn.nextSibling}}function dn(xe,Ce){Ce.parentNode&&Ce.parentNode.removeChild(Ce),Ce.parentNode=xe,Ce.previousSibling=xe.lastChild,Ce.nextSibling=null,Ce.previousSibling?Ce.previousSibling.nextSibling=Ce:xe.firstChild=Ce,xe.lastChild=Ce,Te(xe.ownerDocument,xe,Ce);var Fe=xe.ownerDocument||xe;return nt(Ce,Fe),Ce}Z.prototype={nodeName:"#document",nodeType:z,doctype:null,documentElement:null,_inc:1,insertBefore:function(xe,Ce){if(xe.nodeType==P){for(var Fe=xe.firstChild;Fe;){var tt=Fe.nextSibling;this.insertBefore(Fe,Ce),Fe=tt}return xe}return st(this,xe,Ce),nt(xe,this),this.documentElement===null&&xe.nodeType===p&&(this.documentElement=xe),xe},removeChild:function(xe){return this.documentElement==xe&&(this.documentElement=null),Ae(this,xe)},replaceChild:function(xe,Ce){st(this,xe,Ce,dt),nt(xe,this),Ce&&this.removeChild(Ce),qe(xe)&&(this.documentElement=xe)},importNode:function(xe,Ce){return ei(this,xe,Ce)},getElementById:function(xe){var Ce=null;return pe(this.documentElement,function(Fe){if(Fe.nodeType==p&&Fe.getAttribute("id")==xe)return Ce=Fe,!0}),Ce},getElementsByClassName:function(xe){var Ce=a(xe);return new be(this,function(Fe){var tt=[];return Ce.length>0&&pe(Fe.documentElement,function(Tn){if(Tn!==Fe&&Tn.nodeType===p){var jn=Tn.getAttribute("class");if(jn){var li=xe===jn;if(!li){var Fi=a(jn);li=Ce.every(l(Fi))}li&&tt.push(Tn)}}}),tt})},createElement:function(xe){var Ce=new pn;Ce.ownerDocument=this,Ce.nodeName=xe,Ce.tagName=xe,Ce.localName=xe,Ce.childNodes=new ae;var Fe=Ce.attributes=new le;return Fe._ownerElement=Ce,Ce},createDocumentFragment:function(){var xe=new Xe;return xe.ownerDocument=this,xe.childNodes=new ae,xe},createTextNode:function(xe){var Ce=new Jn;return Ce.ownerDocument=this,Ce.appendData(xe),Ce},createComment:function(xe){var Ce=new ri;return Ce.ownerDocument=this,Ce.appendData(xe),Ce},createCDATASection:function(xe){var Ce=new Wn;return Ce.ownerDocument=this,Ce.appendData(xe),Ce},createProcessingInstruction:function(xe,Ce){var Fe=new Ye;return Fe.ownerDocument=this,Fe.tagName=Fe.nodeName=Fe.target=xe,Fe.nodeValue=Fe.data=Ce,Fe},createAttribute:function(xe){var Ce=new An;return Ce.ownerDocument=this,Ce.name=xe,Ce.nodeName=xe,Ce.localName=xe,Ce.specified=!0,Ce},createEntityReference:function(xe){var Ce=new Ft;return Ce.ownerDocument=this,Ce.nodeName=xe,Ce},createElementNS:function(xe,Ce){var Fe=new pn,tt=Ce.split(":"),Tn=Fe.attributes=new le;return Fe.childNodes=new ae,Fe.ownerDocument=this,Fe.nodeName=Ce,Fe.tagName=Ce,Fe.namespaceURI=xe,tt.length==2?(Fe.prefix=tt[0],Fe.localName=tt[1]):Fe.localName=Ce,Tn._ownerElement=Fe,Fe},createAttributeNS:function(xe,Ce){var Fe=new An,tt=Ce.split(":");return Fe.ownerDocument=this,Fe.nodeName=Ce,Fe.name=Ce,Fe.namespaceURI=xe,Fe.specified=!0,tt.length==2?(Fe.prefix=tt[0],Fe.localName=tt[1]):Fe.localName=Ce,Fe}},d(Z,re);function pn(){this._nsMap={}}pn.prototype={nodeType:p,hasAttribute:function(xe){return this.getAttributeNode(xe)!=null},getAttribute:function(xe){var Ce=this.getAttributeNode(xe);return Ce&&Ce.value||""},getAttributeNode:function(xe){return this.attributes.getNamedItem(xe)},setAttribute:function(xe,Ce){var Fe=this.ownerDocument.createAttribute(xe);Fe.value=Fe.nodeValue=""+Ce,this.setAttributeNode(Fe)},removeAttribute:function(xe){var Ce=this.getAttributeNode(xe);Ce&&this.removeAttributeNode(Ce)},appendChild:function(xe){return xe.nodeType===P?this.insertBefore(xe,null):dn(this,xe)},setAttributeNode:function(xe){return this.attributes.setNamedItem(xe)},setAttributeNodeNS:function(xe){return this.attributes.setNamedItemNS(xe)},removeAttributeNode:function(xe){return this.attributes.removeNamedItem(xe.nodeName)},removeAttributeNS:function(xe,Ce){var Fe=this.getAttributeNodeNS(xe,Ce);Fe&&this.removeAttributeNode(Fe)},hasAttributeNS:function(xe,Ce){return this.getAttributeNodeNS(xe,Ce)!=null},getAttributeNS:function(xe,Ce){var Fe=this.getAttributeNodeNS(xe,Ce);return Fe&&Fe.value||""},setAttributeNS:function(xe,Ce,Fe){var tt=this.ownerDocument.createAttributeNS(xe,Ce);tt.value=tt.nodeValue=""+Fe,this.setAttributeNode(tt)},getAttributeNodeNS:function(xe,Ce){return this.attributes.getNamedItemNS(xe,Ce)},getElementsByTagName:function(xe){return new be(this,function(Ce){var Fe=[];return pe(Ce,function(tt){tt!==Ce&&tt.nodeType==p&&(xe==="*"||tt.tagName==xe)&&Fe.push(tt)}),Fe})},getElementsByTagNameNS:function(xe,Ce){return new be(this,function(Fe){var tt=[];return pe(Fe,function(Tn){Tn!==Fe&&Tn.nodeType===p&&(xe==="*"||Tn.namespaceURI===xe)&&(Ce==="*"||Tn.localName==Ce)&&tt.push(Tn)}),tt})}},Z.prototype.getElementsByTagName=pn.prototype.getElementsByTagName,Z.prototype.getElementsByTagNameNS=pn.prototype.getElementsByTagNameNS,d(pn,re);function An(){}An.prototype.nodeType=m,d(An,re);function In(){}In.prototype={data:"",substringData:function(xe,Ce){return this.data.substring(xe,xe+Ce)},appendData:function(xe){xe=this.data+xe,this.nodeValue=this.data=xe,this.length=xe.length},insertData:function(xe,Ce){this.replaceData(xe,0,Ce)},appendChild:function(xe){throw new Error(I[w])},deleteData:function(xe,Ce){this.replaceData(xe,Ce,"")},replaceData:function(xe,Ce,Fe){var tt=this.data.substring(0,xe),Tn=this.data.substring(xe+Ce);Fe=tt+Fe+Tn,this.nodeValue=this.data=Fe,this.length=Fe.length}},d(In,re);function Jn(){}Jn.prototype={nodeName:"#text",nodeType:g,splitText:function(xe){var Ce=this.data,Fe=Ce.substring(xe);Ce=Ce.substring(0,xe),this.data=this.nodeValue=Ce,this.length=Ce.length;var tt=this.ownerDocument.createTextNode(Fe);return this.parentNode&&this.parentNode.insertBefore(tt,this.nextSibling),tt}},d(Jn,In);function ri(){}ri.prototype={nodeName:"#comment",nodeType:A},d(ri,In);function Wn(){}Wn.prototype={nodeName:"#cdata-section",nodeType:v},d(Wn,In);function hi(){}hi.prototype.nodeType=D,d(hi,re);function ai(){}ai.prototype.nodeType=G,d(ai,re);function Zn(){}Zn.prototype.nodeType=b,d(Zn,re);function Ft(){}Ft.prototype.nodeType=_,d(Ft,re);function Xe(){}Xe.prototype.nodeName="#document-fragment",Xe.prototype.nodeType=P,d(Xe,re);function Ye(){}Ye.prototype.nodeType=E,d(Ye,re);function xn(){}xn.prototype.serializeToString=function(xe,Ce,Fe){return Vn.call(xe,Ce,Fe)},re.prototype.toString=Vn;function Vn(xe,Ce){var Fe=[],tt=this.nodeType==9&&this.documentElement||this,Tn=tt.prefix,jn=tt.namespaceURI;if(jn&&Tn==null){var Tn=tt.lookupPrefix(jn);if(Tn==null)var li=[{namespace:jn,prefix:null}]}return Yi(this,Fe,xe,Ce,li),Fe.join("")}function Bn(xe,Ce,Fe){var tt=xe.prefix||"",Tn=xe.namespaceURI;if(!Tn||tt==="xml"&&Tn===t.XML||Tn===t.XMLNS)return!1;for(var jn=Fe.length;jn--;){var li=Fe[jn];if(li.prefix===tt)return li.namespace!==Tn}return!0}function si(xe,Ce,Fe){xe.push(" ",Ce,'="',Fe.replace(/[<>&"\t\n\r]/g,fe),'"')}function Yi(xe,Ce,Fe,tt,Tn){if(Tn||(Tn=[]),tt)if(xe=tt(xe),xe){if(typeof xe=="string"){Ce.push(xe);return}}else return;switch(xe.nodeType){case p:var jn=xe.attributes,li=jn.length,ci=xe.firstChild,Fi=xe.tagName;Fe=t.isHTML(xe.namespaceURI)||Fe;var Qi=Fi;if(!Fe&&!xe.prefix&&xe.namespaceURI){for(var Di,nr=0;nr<jn.length;nr++)if(jn.item(nr).name==="xmlns"){Di=jn.item(nr).value;break}if(!Di)for(var gr=Tn.length-1;gr>=0;gr--){var br=Tn[gr];if(br.prefix===""&&br.namespace===xe.namespaceURI){Di=br.namespace;break}}if(Di!==xe.namespaceURI)for(var gr=Tn.length-1;gr>=0;gr--){var br=Tn[gr];if(br.namespace===xe.namespaceURI){br.prefix&&(Qi=br.prefix+":"+Fi);break}}}Ce.push("<",Qi);for(var Vi=0;Vi<li;Vi++){var $r=jn.item(Vi);$r.prefix=="xmlns"?Tn.push({prefix:$r.localName,namespace:$r.value}):$r.nodeName=="xmlns"&&Tn.push({prefix:"",namespace:$r.value})}for(var Vi=0;Vi<li;Vi++){var $r=jn.item(Vi);if(Bn($r,Fe,Tn)){var wr=$r.prefix||"",Er=$r.namespaceURI;si(Ce,wr?"xmlns:"+wr:"xmlns",Er),Tn.push({prefix:wr,namespace:Er})}Yi($r,Ce,Fe,tt,Tn)}if(Fi===Qi&&Bn(xe,Fe,Tn)){var wr=xe.prefix||"",Er=xe.namespaceURI;si(Ce,wr?"xmlns:"+wr:"xmlns",Er),Tn.push({prefix:wr,namespace:Er})}if(ci||Fe&&!/^(?:meta|link|img|br|hr|input)$/i.test(Fi)){if(Ce.push(">"),Fe&&/^script$/i.test(Fi))for(;ci;)ci.data?Ce.push(ci.data):Yi(ci,Ce,Fe,tt,Tn.slice()),ci=ci.nextSibling;else for(;ci;)Yi(ci,Ce,Fe,tt,Tn.slice()),ci=ci.nextSibling;Ce.push("</",Qi,">")}else Ce.push("/>");return;case z:case P:for(var ci=xe.firstChild;ci;)Yi(ci,Ce,Fe,tt,Tn.slice()),ci=ci.nextSibling;return;case m:return si(Ce,xe.name,xe.value);case g:return Ce.push(xe.data.replace(/[<&>]/g,fe));case v:return Ce.push("<![CDATA[",xe.data,"]]>");case A:return Ce.push("<!--",xe.data,"-->");case D:var ir=xe.publicId,fi=xe.systemId;if(Ce.push("<!DOCTYPE ",xe.name),ir)Ce.push(" PUBLIC ",ir),fi&&fi!="."&&Ce.push(" ",fi),Ce.push(">");else if(fi&&fi!=".")Ce.push(" SYSTEM ",fi,">");else{var Bs=xe.internalSubset;Bs&&Ce.push(" [",Bs,"]"),Ce.push(">")}return;case E:return Ce.push("<?",xe.target," ",xe.data,"?>");case _:return Ce.push("&",xe.nodeName,";");default:Ce.push("??",xe.nodeName)}}function ei(xe,Ce,Fe){var tt;switch(Ce.nodeType){case p:tt=Ce.cloneNode(!1),tt.ownerDocument=xe;case P:break;case m:Fe=!0;break}if(tt||(tt=Ce.cloneNode(!1)),tt.ownerDocument=xe,tt.parentNode=null,Fe)for(var Tn=Ce.firstChild;Tn;)tt.appendChild(ei(xe,Tn,Fe)),Tn=Tn.nextSibling;return tt}function oi(xe,Ce,Fe){var tt=new Ce.constructor;for(var Tn in Ce)if(Object.prototype.hasOwnProperty.call(Ce,Tn)){var jn=Ce[Tn];typeof jn!="object"&&jn!=tt[Tn]&&(tt[Tn]=jn)}switch(Ce.childNodes&&(tt.childNodes=new ae),tt.ownerDocument=xe,tt.nodeType){case p:var li=Ce.attributes,Fi=tt.attributes=new le,Qi=li.length;Fi._ownerElement=tt;for(var Di=0;Di<Qi;Di++)tt.setAttributeNode(oi(xe,li.item(Di),!0));break;case m:Fe=!0}if(Fe)for(var nr=Ce.firstChild;nr;)tt.appendChild(oi(xe,nr,Fe)),nr=nr.nextSibling;return tt}function Li(xe,Ce,Fe){xe[Ce]=Fe}try{if(Object.defineProperty){let xe=function(Ce){switch(Ce.nodeType){case p:case P:var Fe=[];for(Ce=Ce.firstChild;Ce;)Ce.nodeType!==7&&Ce.nodeType!==8&&Fe.push(xe(Ce)),Ce=Ce.nextSibling;return Fe.join("");default:return Ce.nodeValue}};Object.defineProperty(be.prototype,"length",{get:function(){return _e(this),this.$$length}}),Object.defineProperty(re.prototype,"textContent",{get:function(){return xe(this)},set:function(Ce){switch(this.nodeType){case p:case P:for(;this.firstChild;)this.removeChild(this.firstChild);(Ce||String(Ce))&&this.appendChild(this.ownerDocument.createTextNode(Ce));break;default:this.data=Ce,this.value=Ce,this.nodeValue=Ce}}}),Li=function(Ce,Fe,tt){Ce["$$"+Fe]=tt}}}catch{}return dom.DocumentType=hi,dom.DOMException=te,dom.DOMImplementation=se,dom.Element=pn,dom.Node=re,dom.NodeList=ae,dom.XMLSerializer=xn,dom}var domParser={},entities={},hasRequiredEntities;function requireEntities(){return hasRequiredEntities||(hasRequiredEntities=1,(function(i){var e=requireConventions().freeze;i.XML_ENTITIES=e({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),i.HTML_ENTITIES=e({Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",AMP:"&",amp:"&",And:"",and:"",andand:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsd:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",ap:"",apacir:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",Barwed:"",barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",Because:"",because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxDL:"",boxDl:"",boxdL:"",boxdl:"",boxDR:"",boxDr:"",boxdR:"",boxdr:"",boxH:"",boxh:"",boxHD:"",boxHd:"",boxhD:"",boxhd:"",boxHU:"",boxHu:"",boxhU:"",boxhu:"",boxminus:"",boxplus:"",boxtimes:"",boxUL:"",boxUl:"",boxuL:"",boxul:"",boxUR:"",boxUr:"",boxuR:"",boxur:"",boxV:"",boxv:"",boxVH:"",boxVh:"",boxvH:"",boxvh:"",boxVL:"",boxVl:"",boxvL:"",boxvl:"",boxVR:"",boxVr:"",boxvR:"",boxvr:"",bprime:"",Breve:"",breve:"",brvbar:"",Bscr:"",bscr:"",bsemi:"",bsim:"",bsime:"",bsol:"\\",bsolb:"",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",Cap:"",cap:"",capand:"",capbrcup:"",capcap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",CenterDot:"",centerdot:"",Cfr:"",cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",cir:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",Colon:"",colon:":",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",Conint:"",conint:"",ContourIntegral:"",Copf:"",copf:"",coprod:"",Coproduct:"",COPY:"",copy:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",Cross:"",cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",Cup:"",cup:"",cupbrcap:"",CupCap:"",cupcap:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",Dagger:"",dagger:"",daleth:"",Darr:"",dArr:"",darr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",DD:"",dd:"",ddagger:"",ddarr:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",Diamond:"",diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrow:"",Downarrow:"",downarrow:"",DownArrowBar:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVector:"",DownLeftVectorBar:"",DownRightTeeVector:"",DownRightVector:"",DownRightVectorBar:"",DownTee:"",DownTeeArrow:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",ecir:"",Ecirc:"",ecirc:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",eDot:"",edot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp:"",emsp13:"",emsp14:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",Escr:"",escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",ExponentialE:"",exponentiale:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",ForAll:"",forall:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",Fscr:"",fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",gE:"",ge:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",ges:"",gescc:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",Gg:"",gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gl:"",gla:"",glE:"",glj:"",gnap:"",gnapprox:"",gnE:"",gne:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",Gt:"",GT:">",gt:">",gtcc:"",gtcir:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",hArr:"",harr:"",harrcir:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",Hfr:"",hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",Hopf:"",hopf:"",horbar:"",HorizontalLine:"",Hscr:"",hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",Ifr:"",ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Im:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",imof:"",imped:"",Implies:"",in:"",incare:"",infin:"",infintie:"",inodot:"",Int:"",int:"",intcal:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",Iscr:"",iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",Lang:"",lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",Larr:"",lArr:"",larr:"",larrb:"",larrbfs:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",lat:"",lAtail:"",latail:"",late:"",lates:"",lBarr:"",lbarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",lE:"",le:"",LeftAngleBracket:"",LeftArrow:"",Leftarrow:"",leftarrow:"",LeftArrowBar:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVector:"",LeftDownVectorBar:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTee:"",LeftTeeArrow:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangle:"",LeftTriangleBar:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVector:"",LeftUpVectorBar:"",LeftVector:"",LeftVectorBar:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",les:"",lescc:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",Ll:"",ll:"",llarr:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoust:"",lmoustache:"",lnap:"",lnapprox:"",lnE:"",lne:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",LongLeftArrow:"",Longleftarrow:"",longleftarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longleftrightarrow:"",longmapsto:"",LongRightArrow:"",Longrightarrow:"",longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",Lscr:"",lscr:"",Lsh:"",lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",Lt:"",LT:"<",lt:"<",ltcc:"",ltcir:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",mid:"",midast:"*",midcir:"",middot:"",minus:"",minusb:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",Mscr:"",mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natur:"",natural:"",naturals:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",ne:"",nearhk:"",neArr:"",nearr:"",nearrow:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:`
`,nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nhArr:"",nharr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlArr:"",nlarr:"",nldr:"",nlE:"",nle:"",nLeftarrow:"",nleftarrow:"",nLeftrightarrow:"",nleftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",Nopf:"",nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangle:"",NotLeftTriangleBar:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangle:"",NotRightTriangleBar:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",npar:"",nparallel:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",npre:"",nprec:"",npreceq:"",nrArr:"",nrarr:"",nrarrc:"",nrarrw:"",nRightarrow:"",nrightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nVDash:"",nVdash:"",nvDash:"",nvdash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwArr:"",nwarr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",ocir:"",Ocirc:"",ocirc:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",Or:"",or:"",orarr:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",Otimes:"",otimes:"",otimesas:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",par:"",para:"",parallel:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plus:"+",plusacir:"",plusb:"",pluscir:"",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",Popf:"",popf:"",pound:"",Pr:"",pr:"",prap:"",prcue:"",prE:"",pre:"",prec:"",precapprox:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",precsim:"",Prime:"",prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportion:"",Proportional:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",Qopf:"",qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",QUOT:'"',quot:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",Rang:"",rang:"",rangd:"",range:"",rangle:"",raquo:"",Rarr:"",rArr:"",rarr:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",rAtail:"",ratail:"",ratio:"",rationals:"",RBarr:"",rBarr:"",rbarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",Re:"",real:"",realine:"",realpart:"",reals:"",rect:"",REG:"",reg:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",Rfr:"",rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrow:"",Rightarrow:"",rightarrow:"",RightArrowBar:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVector:"",RightDownVectorBar:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTee:"",RightTeeArrow:"",RightTeeVector:"",rightthreetimes:"",RightTriangle:"",RightTriangleBar:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVector:"",RightUpVectorBar:"",RightVector:"",RightVectorBar:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoust:"",rmoustache:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",Ropf:"",ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",Rscr:"",rscr:"",Rsh:"",rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",Sc:"",sc:"",scap:"",Scaron:"",scaron:"",sccue:"",scE:"",sce:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdot:"",sdotb:"",sdote:"",searhk:"",seArr:"",searr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",sol:"/",solb:"",solbar:"",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",squ:"",Square:"",square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",Sub:"",sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",Subset:"",subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succ:"",succapprox:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",Sum:"",sum:"",sung:"",Sup:"",sup:"",sup1:"",sup2:"",sup3:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",Supset:"",supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swArr:"",swarr:"",swarrow:"",swnwar:"",szlig:"",Tab:"	",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",Therefore:"",therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",thinsp:"",ThinSpace:"",thkap:"",thksim:"",THORN:"",thorn:"",Tilde:"",tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",times:"",timesb:"",timesbar:"",timesd:"",tint:"",toea:"",top:"",topbot:"",topcir:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",TRADE:"",trade:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",Uarr:"",uArr:"",uarr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrow:"",Uparrow:"",uparrow:"",UpArrowBar:"",UpArrowDownArrow:"",UpDownArrow:"",Updownarrow:"",updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",Upsi:"",upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTee:"",UpTeeArrow:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",vArr:"",varr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",Vbar:"",vBar:"",vBarv:"",Vcy:"",vcy:"",VDash:"",Vdash:"",vDash:"",vdash:"",Vdashl:"",Vee:"",vee:"",veebar:"",veeeq:"",vellip:"",Verbar:"",verbar:"|",Vert:"",vert:"|",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",Wedge:"",wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xhArr:"",xharr:"",Xi:"",xi:"",xlArr:"",xlarr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrArr:"",xrarr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",Yuml:"",yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",Zfr:"",zfr:"",ZHcy:"",zhcy:"",zigrarr:"",Zopf:"",zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}),i.entityMap=i.HTML_ENTITIES})(entities)),entities}var sax={},hasRequiredSax;function requireSax(){if(hasRequiredSax)return sax;hasRequiredSax=1;var i=requireConventions().NAMESPACE,e=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,t=new RegExp("[\\-\\.0-9"+e.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),n=new RegExp("^"+e.source+t.source+"*(?::"+e.source+t.source+"*)?$"),r=0,s=1,a=2,l=3,u=4,d=5,h=6,p=7;function m(w,H){this.message=w,this.locator=H,Error.captureStackTrace&&Error.captureStackTrace(this,m)}m.prototype=new Error,m.prototype.name=m.name;function g(){}g.prototype={parse:function(w,H,V){var te=this.domBuilder;te.startDocument(),D(H,H={}),v(w,H,V,te,this.errorHandler),te.endDocument()}};function v(w,H,V,te,ae){function be(dn){if(dn>65535){dn-=65536;var pn=55296+(dn>>10),An=56320+(dn&1023);return String.fromCharCode(pn,An)}else return String.fromCharCode(dn)}function _e(dn){var pn=dn.slice(1,-1);return Object.hasOwnProperty.call(V,pn)?V[pn]:pn.charAt(0)==="#"?be(parseInt(pn.substr(1).replace("x","0x"))):(ae.error("entity not found:"+dn),dn)}function le(dn){if(dn>Z){var pn=w.substring(Z,dn).replace(/&#?\w+;/g,_e);re&&ue(Z),te.characters(pn,0,dn-Z),Z=dn}}function ue(dn,pn){for(;dn>=ee&&(pn=se.exec(w));)oe=pn.index,ee=oe+pn[0].length,re.lineNumber++;re.columnNumber=dn-oe+1}for(var oe=0,ee=0,se=/.*(?:\r\n?|\n)|.*$/g,re=te.locator,fe=[{currentNSMap:H}],pe={},Z=0;;){try{var ce=w.indexOf("<",Z);if(ce<0){if(!w.substr(Z).match(/^\s*$/)){var Ee=te.doc,Te=Ee.createTextNode(w.substr(Z));Ee.appendChild(Te),te.currentElement=Te}return}switch(ce>Z&&le(ce),w.charAt(ce+1)){case"/":var Lt=w.indexOf(">",ce+3),Ae=w.substring(ce+2,Lt).replace(/[ \t\n\r]+$/g,""),Pe=fe.pop();Lt<0?(Ae=w.substring(ce+2).replace(/[\s<].*/,""),ae.error("end tag name: "+Ae+" is not complete:"+Pe.tagName),Lt=ce+1+Ae.length):Ae.match(/\s</)&&(Ae=Ae.replace(/[\s<].*/,""),ae.error("end tag name: "+Ae+" maybe not complete"),Lt=ce+1+Ae.length);var Me=Pe.localNSMap,We=Pe.tagName==Ae,qe=We||Pe.tagName&&Pe.tagName.toLowerCase()==Ae.toLowerCase();if(qe){if(te.endElement(Pe.uri,Pe.localName,Ae),Me)for(var Je in Me)Object.prototype.hasOwnProperty.call(Me,Je)&&te.endPrefixMapping(Je);We||ae.fatalError("end tag name: "+Ae+" is not match the current start tagName:"+Pe.tagName)}else fe.push(Pe);Lt++;break;case"?":re&&ue(ce),Lt=G(w,ce,te);break;case"!":re&&ue(ce),Lt=P(w,ce,te,ae);break;default:re&&ue(ce);var wt=new R,rt=fe[fe.length-1].currentNSMap,Lt=b(w,ce,wt,rt,_e,ae),ln=wt.length;if(!wt.closed&&z(w,Lt,wt.tagName,pe)&&(wt.closed=!0,V.nbsp||ae.warning("unclosed xml attribute")),re&&ln){for(var dt=_(re,{}),st=0;st<ln;st++){var nt=wt[st];ue(nt.offset),nt.locator=_(re,{})}te.locator=dt,E(wt,te,rt)&&fe.push(wt),te.locator=re}else E(wt,te,rt)&&fe.push(wt);i.isHTML(wt.uri)&&!wt.closed?Lt=A(w,Lt,wt.tagName,_e,te):Lt++}}catch(dn){if(dn instanceof m)throw dn;ae.error("element parse error: "+dn),Lt=-1}Lt>Z?Z=Lt:le(Math.max(ce,Z)+1)}}function _(w,H){return H.lineNumber=w.lineNumber,H.columnNumber=w.columnNumber,H}function b(w,H,V,te,ae,be){function _e(re,fe,pe){V.attributeNames.hasOwnProperty(re)&&be.fatalError("Attribute "+re+" redefined"),V.addValue(re,fe.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,ae),pe)}for(var le,ue,oe=++H,ee=r;;){var se=w.charAt(oe);switch(se){case"=":if(ee===s)le=w.slice(H,oe),ee=l;else if(ee===a)ee=l;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(ee===l||ee===s)if(ee===s&&(be.warning('attribute value must after "="'),le=w.slice(H,oe)),H=oe+1,oe=w.indexOf(se,H),oe>0)ue=w.slice(H,oe),_e(le,ue,H-1),ee=d;else throw new Error("attribute value no end '"+se+"' match");else if(ee==u)ue=w.slice(H,oe),_e(le,ue,H),be.warning('attribute "'+le+'" missed start quot('+se+")!!"),H=oe+1,ee=d;else throw new Error('attribute value must after "="');break;case"/":switch(ee){case r:V.setTagName(w.slice(H,oe));case d:case h:case p:ee=p,V.closed=!0;case u:case s:break;case a:V.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return be.error("unexpected end of input"),ee==r&&V.setTagName(w.slice(H,oe)),oe;case">":switch(ee){case r:V.setTagName(w.slice(H,oe));case d:case h:case p:break;case u:case s:ue=w.slice(H,oe),ue.slice(-1)==="/"&&(V.closed=!0,ue=ue.slice(0,-1));case a:ee===a&&(ue=le),ee==u?(be.warning('attribute "'+ue+'" missed quot(")!'),_e(le,ue,H)):((!i.isHTML(te[""])||!ue.match(/^(?:disabled|checked|selected)$/i))&&be.warning('attribute "'+ue+'" missed value!! "'+ue+'" instead!!'),_e(ue,ue,H));break;case l:throw new Error("attribute value missed!!")}return oe;case"":se=" ";default:if(se<=" ")switch(ee){case r:V.setTagName(w.slice(H,oe)),ee=h;break;case s:le=w.slice(H,oe),ee=a;break;case u:var ue=w.slice(H,oe);be.warning('attribute "'+ue+'" missed quot(")!!'),_e(le,ue,H);case d:ee=h;break}else switch(ee){case a:V.tagName,(!i.isHTML(te[""])||!le.match(/^(?:disabled|checked|selected)$/i))&&be.warning('attribute "'+le+'" missed value!! "'+le+'" instead2!!'),_e(le,le,H),H=oe,ee=s;break;case d:be.warning('attribute space is required"'+le+'"!!');case h:ee=s,H=oe;break;case l:ee=u,H=oe;break;case p:throw new Error("elements closed character '/' and '>' must be connected to")}}oe++}}function E(w,H,V){for(var te=w.tagName,ae=null,se=w.length;se--;){var be=w[se],_e=be.qName,le=be.value,re=_e.indexOf(":");if(re>0)var ue=be.prefix=_e.slice(0,re),oe=_e.slice(re+1),ee=ue==="xmlns"&&oe;else oe=_e,ue=null,ee=_e==="xmlns"&&"";be.localName=oe,ee!==!1&&(ae==null&&(ae={},D(V,V={})),V[ee]=ae[ee]=le,be.uri=i.XMLNS,H.startPrefixMapping(ee,le))}for(var se=w.length;se--;){be=w[se];var ue=be.prefix;ue&&(ue==="xml"&&(be.uri=i.XML),ue!=="xmlns"&&(be.uri=V[ue||""]))}var re=te.indexOf(":");re>0?(ue=w.prefix=te.slice(0,re),oe=w.localName=te.slice(re+1)):(ue=null,oe=w.localName=te);var fe=w.uri=V[ue||""];if(H.startElement(fe,oe,te,w),w.closed){if(H.endElement(fe,oe,te),ae)for(ue in ae)Object.prototype.hasOwnProperty.call(ae,ue)&&H.endPrefixMapping(ue)}else return w.currentNSMap=V,w.localNSMap=ae,!0}function A(w,H,V,te,ae){if(/^(?:script|textarea)$/i.test(V)){var be=w.indexOf("</"+V+">",H),_e=w.substring(H+1,be);if(/[&<]/.test(_e))return/^script$/i.test(V)?(ae.characters(_e,0,_e.length),be):(_e=_e.replace(/&#?\w+;/g,te),ae.characters(_e,0,_e.length),be)}return H+1}function z(w,H,V,te){var ae=te[V];return ae==null&&(ae=w.lastIndexOf("</"+V+">"),ae<H&&(ae=w.lastIndexOf("</"+V)),te[V]=ae),ae<H}function D(w,H){for(var V in w)Object.prototype.hasOwnProperty.call(w,V)&&(H[V]=w[V])}function P(w,H,V,te){var ae=w.charAt(H+2);switch(ae){case"-":if(w.charAt(H+3)==="-"){var be=w.indexOf("-->",H+4);return be>H?(V.comment(w,H+4,be-H-4),be+3):(te.error("Unclosed comment"),-1)}else return-1;default:if(w.substr(H+3,6)=="CDATA["){var be=w.indexOf("]]>",H+9);return V.startCDATA(),V.characters(w,H+9,be-H-9),V.endCDATA(),be+3}var _e=I(w,H),le=_e.length;if(le>1&&/!doctype/i.test(_e[0][0])){var ue=_e[1][0],oe=!1,ee=!1;le>3&&(/^public$/i.test(_e[2][0])?(oe=_e[3][0],ee=le>4&&_e[4][0]):/^system$/i.test(_e[2][0])&&(ee=_e[3][0]));var se=_e[le-1];return V.startDTD(ue,oe,ee),V.endDTD(),se.index+se[0].length}}return-1}function G(w,H,V){var te=w.indexOf("?>",H);if(te){var ae=w.substring(H,te).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return ae?(ae[0].length,V.processingInstruction(ae[1],ae[2]),te+2):-1}return-1}function R(){this.attributeNames={}}R.prototype={setTagName:function(w){if(!n.test(w))throw new Error("invalid tagName:"+w);this.tagName=w},addValue:function(w,H,V){if(!n.test(w))throw new Error("invalid attribute:"+w);this.attributeNames[w]=this.length,this[this.length++]={qName:w,value:H,offset:V}},length:0,getLocalName:function(w){return this[w].localName},getLocator:function(w){return this[w].locator},getQName:function(w){return this[w].qName},getURI:function(w){return this[w].uri},getValue:function(w){return this[w].value}};function I(w,H){var V,te=[],ae=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(ae.lastIndex=H,ae.exec(w);V=ae.exec(w);)if(te.push(V),V[1])return te}return sax.XMLReader=g,sax.ParseError=m,sax}var hasRequiredDomParser;function requireDomParser(){if(hasRequiredDomParser)return domParser;hasRequiredDomParser=1;var i=requireConventions(),e=requireDom(),t=requireEntities(),n=requireSax(),r=e.DOMImplementation,s=i.NAMESPACE,a=n.ParseError,l=n.XMLReader;function u(b){return b.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function d(b){this.options=b||{locator:{}}}d.prototype.parseFromString=function(b,E){var A=this.options,z=new l,D=A.domBuilder||new p,P=A.errorHandler,G=A.locator,R=A.xmlns||{},I=/\/x?html?$/.test(E),w=I?t.HTML_ENTITIES:t.XML_ENTITIES;G&&D.setDocumentLocator(G),z.errorHandler=h(P,D,G),z.domBuilder=A.domBuilder||D,I&&(R[""]=s.HTML),R.xml=R.xml||s.XML;var H=A.normalizeLineEndings||u;return b&&typeof b=="string"?z.parse(H(b),R,w):z.errorHandler.error("invalid doc source"),D.doc};function h(b,E,A){if(!b){if(E instanceof p)return E;b=E}var z={},D=b instanceof Function;A=A||{};function P(G){var R=b[G];!R&&D&&(R=b.length==2?function(I){b(G,I)}:b),z[G]=R&&function(I){R("[xmldom "+G+"]	"+I+g(A))}||function(){}}return P("warning"),P("error"),P("fatalError"),z}function p(){this.cdata=!1}function m(b,E){E.lineNumber=b.lineNumber,E.columnNumber=b.columnNumber}p.prototype={startDocument:function(){this.doc=new r().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(b,E,A,z){var D=this.doc,P=D.createElementNS(b,A||E),G=z.length;_(this,P),this.currentElement=P,this.locator&&m(this.locator,P);for(var R=0;R<G;R++){var b=z.getURI(R),I=z.getValue(R),A=z.getQName(R),w=D.createAttributeNS(b,A);this.locator&&m(z.getLocator(R),w),w.value=w.nodeValue=I,P.setAttributeNode(w)}},endElement:function(b,E,A){var z=this.currentElement;z.tagName,this.currentElement=z.parentNode},startPrefixMapping:function(b,E){},endPrefixMapping:function(b){},processingInstruction:function(b,E){var A=this.doc.createProcessingInstruction(b,E);this.locator&&m(this.locator,A),_(this,A)},ignorableWhitespace:function(b,E,A){},characters:function(b,E,A){if(b=v.apply(this,arguments),b){if(this.cdata)var z=this.doc.createCDATASection(b);else var z=this.doc.createTextNode(b);this.currentElement?this.currentElement.appendChild(z):/^\s*$/.test(b)&&this.doc.appendChild(z),this.locator&&m(this.locator,z)}},skippedEntity:function(b){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(b){(this.locator=b)&&(b.lineNumber=0)},comment:function(b,E,A){b=v.apply(this,arguments);var z=this.doc.createComment(b);this.locator&&m(this.locator,z),_(this,z)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(b,E,A){var z=this.doc.implementation;if(z&&z.createDocumentType){var D=z.createDocumentType(b,E,A);this.locator&&m(this.locator,D),_(this,D),this.doc.doctype=D}},warning:function(b){console.warn("[xmldom warning]	"+b,g(this.locator))},error:function(b){console.error("[xmldom error]	"+b,g(this.locator))},fatalError:function(b){throw new a(b,this.locator)}};function g(b){if(b)return`
@`+(b.systemId||"")+"#[line:"+b.lineNumber+",col:"+b.columnNumber+"]"}function v(b,E,A){return typeof b=="string"?b.substr(E,A):b.length>=E+A||E?new java.lang.String(b,E,A)+"":b}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(b){p.prototype[b]=function(){return null}});function _(b,E){b.currentElement?b.currentElement.appendChild(E):b.doc.appendChild(E)}return domParser.__DOMHandler=p,domParser.normalizeLineEndings=u,domParser.DOMParser=d,domParser}var hasRequiredLib$i;function requireLib$i(){if(hasRequiredLib$i)return lib$i;hasRequiredLib$i=1;var i=requireDom();return lib$i.DOMImplementation=i.DOMImplementation,lib$i.XMLSerializer=i.XMLSerializer,lib$i.DOMParser=requireDomParser().DOMParser,lib$i}var libExports$2=requireLib$i();const isObject$1=i=>!!i&&typeof i=="object",merge$2=(...i)=>i.reduce((e,t)=>(typeof t!="object"||Object.keys(t).forEach(n=>{Array.isArray(e[n])&&Array.isArray(t[n])?e[n]=e[n].concat(t[n]):isObject$1(e[n])&&isObject$1(t[n])?e[n]=merge$2(e[n],t[n]):e[n]=t[n]}),e),{}),values$1=i=>Object.keys(i).map(e=>i[e]),range=(i,e)=>{const t=[];for(let n=i;n<e;n++)t.push(n);return t},flatten=i=>i.reduce((e,t)=>e.concat(t),[]),from=i=>{if(!i.length)return[];const e=[];for(let t=0;t<i.length;t++)e.push(i[t]);return e},findIndexes=(i,e)=>i.reduce((t,n,r)=>(n[e]&&t.push(r),t),[]),union=(i,e)=>values$1(i.reduce((t,n)=>(n.forEach(r=>{t[e(r)]=r}),t),{}));var errors={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"};const urlTypeToSegment=({baseUrl:i="",source:e="",range:t="",indexRange:n=""})=>{const r={uri:e,resolvedUri:resolveUrl$1(i||"",e)};if(t||n){const a=(t||n).split("-");let l=window$1.BigInt?window$1.BigInt(a[0]):parseInt(a[0],10),u=window$1.BigInt?window$1.BigInt(a[1]):parseInt(a[1],10);l<Number.MAX_SAFE_INTEGER&&typeof l=="bigint"&&(l=Number(l)),u<Number.MAX_SAFE_INTEGER&&typeof u=="bigint"&&(u=Number(u));let d;typeof u=="bigint"||typeof l=="bigint"?d=window$1.BigInt(u)-window$1.BigInt(l)+window$1.BigInt(1):d=u-l+1,typeof d=="bigint"&&d<Number.MAX_SAFE_INTEGER&&(d=Number(d)),r.byterange={length:d,offset:l}}return r},byteRangeToString=i=>{let e;return typeof i.offset=="bigint"||typeof i.length=="bigint"?e=window$1.BigInt(i.offset)+window$1.BigInt(i.length)-window$1.BigInt(1):e=i.offset+i.length-1,`${i.offset}-${e}`},parseEndNumber=i=>(i&&typeof i!="number"&&(i=parseInt(i,10)),isNaN(i)?null:i),segmentRange={static(i){const{duration:e,timescale:t=1,sourceDuration:n,periodDuration:r}=i,s=parseEndNumber(i.endNumber),a=e/t;return typeof s=="number"?{start:0,end:s}:typeof r=="number"?{start:0,end:r/a}:{start:0,end:n/a}},dynamic(i){const{NOW:e,clientOffset:t,availabilityStartTime:n,timescale:r=1,duration:s,periodStart:a=0,minimumUpdatePeriod:l=0,timeShiftBufferDepth:u=1/0}=i,d=parseEndNumber(i.endNumber),h=(e+t)/1e3,p=n+a,g=h+l-p,v=Math.ceil(g*r/s),_=Math.floor((h-p-u)*r/s),b=Math.floor((h-p)*r/s);return{start:Math.max(0,_),end:typeof d=="number"?d:Math.min(v,b)}}},toSegments=i=>e=>{const{duration:t,timescale:n=1,periodStart:r,startNumber:s=1}=i;return{number:s+e,duration:t/n,timeline:r,time:e*t}},parseByDuration=i=>{const{type:e,duration:t,timescale:n=1,periodDuration:r,sourceDuration:s}=i,{start:a,end:l}=segmentRange[e](i),u=range(a,l).map(toSegments(i));if(e==="static"){const d=u.length-1,h=typeof r=="number"?r:s;u[d].duration=h-t/n*d}return u},segmentsFromBase=i=>{const{baseUrl:e,initialization:t={},sourceDuration:n,indexRange:r="",periodStart:s,presentationTime:a,number:l=0,duration:u}=i;if(!e)throw new Error(errors.NO_BASE_URL);const d=urlTypeToSegment({baseUrl:e,source:t.sourceURL,range:t.range}),h=urlTypeToSegment({baseUrl:e,source:e,indexRange:r});if(h.map=d,u){const p=parseByDuration(i);p.length&&(h.duration=p[0].duration,h.timeline=p[0].timeline)}else n&&(h.duration=n,h.timeline=s);return h.presentationTime=a||s,h.number=l,[h]},addSidxSegmentsToPlaylist$1=(i,e,t)=>{const n=i.sidx.map?i.sidx.map:null,r=i.sidx.duration,s=i.timeline||0,a=i.sidx.byterange,l=a.offset+a.length,u=e.timescale,d=e.references.filter(b=>b.referenceType!==1),h=[],p=i.endList?"static":"dynamic",m=i.sidx.timeline;let g=m,v=i.mediaSequence||0,_;typeof e.firstOffset=="bigint"?_=window$1.BigInt(l)+e.firstOffset:_=l+e.firstOffset;for(let b=0;b<d.length;b++){const E=e.references[b],A=E.referencedSize,z=E.subsegmentDuration;let D;typeof _=="bigint"?D=_+window$1.BigInt(A)-window$1.BigInt(1):D=_+A-1;const P=`${_}-${D}`,R=segmentsFromBase({baseUrl:t,timescale:u,timeline:s,periodStart:m,presentationTime:g,number:v,duration:z,sourceDuration:r,indexRange:P,type:p})[0];n&&(R.map=n),h.push(R),typeof _=="bigint"?_+=window$1.BigInt(A):_+=A,g+=z/u,v++}return i.segments=h,i},SUPPORTED_MEDIA_TYPES=["AUDIO","SUBTITLES"],TIME_FUDGE=1/60,getUniqueTimelineStarts=i=>union(i,({timeline:e})=>e).sort((e,t)=>e.timeline>t.timeline?1:-1),findPlaylistWithName=(i,e)=>{for(let t=0;t<i.length;t++)if(i[t].attributes.NAME===e)return i[t];return null},getMediaGroupPlaylists=i=>{let e=[];return forEachMediaGroup$1(i,SUPPORTED_MEDIA_TYPES,(t,n,r,s)=>{e=e.concat(t.playlists||[])}),e},updateMediaSequenceForPlaylist=({playlist:i,mediaSequence:e})=>{i.mediaSequence=e,i.segments.forEach((t,n)=>{t.number=i.mediaSequence+n})},updateSequenceNumbers=({oldPlaylists:i,newPlaylists:e,timelineStarts:t})=>{e.forEach(n=>{n.discontinuitySequence=t.findIndex(function({timeline:u}){return u===n.timeline});const r=findPlaylistWithName(i,n.attributes.NAME);if(!r||n.sidx)return;const s=n.segments[0],a=r.segments.findIndex(function(u){return Math.abs(u.presentationTime-s.presentationTime)<TIME_FUDGE});if(a===-1){updateMediaSequenceForPlaylist({playlist:n,mediaSequence:r.mediaSequence+r.segments.length}),n.segments[0].discontinuity=!0,n.discontinuityStarts.unshift(0),(!r.segments.length&&n.timeline>r.timeline||r.segments.length&&n.timeline>r.segments[r.segments.length-1].timeline)&&n.discontinuitySequence--;return}r.segments[a].discontinuity&&!s.discontinuity&&(s.discontinuity=!0,n.discontinuityStarts.unshift(0),n.discontinuitySequence--),updateMediaSequenceForPlaylist({playlist:n,mediaSequence:r.segments[a].number})})},positionManifestOnTimeline=({oldManifest:i,newManifest:e})=>{const t=i.playlists.concat(getMediaGroupPlaylists(i)),n=e.playlists.concat(getMediaGroupPlaylists(e));return e.timelineStarts=getUniqueTimelineStarts([i.timelineStarts,e.timelineStarts]),updateSequenceNumbers({oldPlaylists:t,newPlaylists:n,timelineStarts:e.timelineStarts}),e},generateSidxKey=i=>i&&i.uri+"-"+byteRangeToString(i.byterange),mergeDiscontiguousPlaylists=i=>{const e=i.reduce(function(n,r){return n[r.attributes.baseUrl]||(n[r.attributes.baseUrl]=[]),n[r.attributes.baseUrl].push(r),n},{});let t=[];return Object.values(e).forEach(n=>{const r=values$1(n.reduce((s,a)=>{const l=a.attributes.id+(a.attributes.lang||"");return s[l]?(a.segments&&(a.segments[0]&&(a.segments[0].discontinuity=!0),s[l].segments.push(...a.segments)),a.attributes.contentProtection&&(s[l].attributes.contentProtection=a.attributes.contentProtection)):(s[l]=a,s[l].attributes.timelineStarts=[]),s[l].attributes.timelineStarts.push({start:a.attributes.periodStart,timeline:a.attributes.periodStart}),s},{}));t=t.concat(r)}),t.map(n=>(n.discontinuityStarts=findIndexes(n.segments||[],"discontinuity"),n))},addSidxSegmentsToPlaylist=(i,e)=>{const t=generateSidxKey(i.sidx),n=t&&e[t]&&e[t].sidx;return n&&addSidxSegmentsToPlaylist$1(i,n,i.sidx.resolvedUri),i},addSidxSegmentsToPlaylists=(i,e={})=>{if(!Object.keys(e).length)return i;for(const t in i)i[t]=addSidxSegmentsToPlaylist(i[t],e);return i},formatAudioPlaylist=({attributes:i,segments:e,sidx:t,mediaSequence:n,discontinuitySequence:r,discontinuityStarts:s},a)=>{const l={attributes:{NAME:i.id,BANDWIDTH:i.bandwidth,CODECS:i.codecs,"PROGRAM-ID":1},uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:i.baseUrl||"",targetDuration:i.duration,discontinuitySequence:r,discontinuityStarts:s,timelineStarts:i.timelineStarts,mediaSequence:n,segments:e};return i.contentProtection&&(l.contentProtection=i.contentProtection),i.serviceLocation&&(l.attributes.serviceLocation=i.serviceLocation),t&&(l.sidx=t),a&&(l.attributes.AUDIO="audio",l.attributes.SUBTITLES="subs"),l},formatVttPlaylist=({attributes:i,segments:e,mediaSequence:t,discontinuityStarts:n,discontinuitySequence:r})=>{typeof e>"u"&&(e=[{uri:i.baseUrl,timeline:i.periodStart,resolvedUri:i.baseUrl||"",duration:i.sourceDuration,number:0}],i.duration=i.sourceDuration);const s={NAME:i.id,BANDWIDTH:i.bandwidth,"PROGRAM-ID":1};i.codecs&&(s.CODECS=i.codecs);const a={attributes:s,uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:i.baseUrl||"",targetDuration:i.duration,timelineStarts:i.timelineStarts,discontinuityStarts:n,discontinuitySequence:r,mediaSequence:t,segments:e};return i.serviceLocation&&(a.attributes.serviceLocation=i.serviceLocation),a},organizeAudioPlaylists=(i,e={},t=!1)=>{let n;const r=i.reduce((s,a)=>{const l=a.attributes.role&&a.attributes.role.value||"",u=a.attributes.lang||"";let d=a.attributes.label||"main";if(u&&!a.attributes.label){const p=l?` (${l})`:"";d=`${a.attributes.lang}${p}`}s[d]||(s[d]={language:u,autoselect:!0,default:l==="main",playlists:[],uri:""});const h=addSidxSegmentsToPlaylist(formatAudioPlaylist(a,t),e);return s[d].playlists.push(h),typeof n>"u"&&l==="main"&&(n=a,n.default=!0),s},{});if(!n){const s=Object.keys(r)[0];r[s].default=!0}return r},organizeVttPlaylists=(i,e={})=>i.reduce((t,n)=>{const r=n.attributes.label||n.attributes.lang||"text",s=n.attributes.lang||"und";return t[r]||(t[r]={language:s,default:!1,autoselect:!1,playlists:[],uri:""}),t[r].playlists.push(addSidxSegmentsToPlaylist(formatVttPlaylist(n),e)),t},{}),organizeCaptionServices=i=>i.reduce((e,t)=>(t&&t.forEach(n=>{const{channel:r,language:s}=n;e[s]={autoselect:!1,default:!1,instreamId:r,language:s},n.hasOwnProperty("aspectRatio")&&(e[s].aspectRatio=n.aspectRatio),n.hasOwnProperty("easyReader")&&(e[s].easyReader=n.easyReader),n.hasOwnProperty("3D")&&(e[s]["3D"]=n["3D"])}),e),{}),formatVideoPlaylist=({attributes:i,segments:e,sidx:t,discontinuityStarts:n})=>{const r={attributes:{NAME:i.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:i.width,height:i.height},CODECS:i.codecs,BANDWIDTH:i.bandwidth,"PROGRAM-ID":1},uri:"",endList:i.type==="static",timeline:i.periodStart,resolvedUri:i.baseUrl||"",targetDuration:i.duration,discontinuityStarts:n,timelineStarts:i.timelineStarts,segments:e};return i.frameRate&&(r.attributes["FRAME-RATE"]=i.frameRate),i.contentProtection&&(r.contentProtection=i.contentProtection),i.serviceLocation&&(r.attributes.serviceLocation=i.serviceLocation),t&&(r.sidx=t),r},videoOnly=({attributes:i})=>i.mimeType==="video/mp4"||i.mimeType==="video/webm"||i.contentType==="video",audioOnly=({attributes:i})=>i.mimeType==="audio/mp4"||i.mimeType==="audio/webm"||i.contentType==="audio",vttOnly=({attributes:i})=>i.mimeType==="text/vtt"||i.contentType==="text",addMediaSequenceValues=(i,e)=>{i.forEach(t=>{t.mediaSequence=0,t.discontinuitySequence=e.findIndex(function({timeline:n}){return n===t.timeline}),t.segments&&t.segments.forEach((n,r)=>{n.number=r})})},flattenMediaGroupPlaylists=i=>i?Object.keys(i).reduce((e,t)=>{const n=i[t];return e.concat(n.playlists)},[]):[],toM3u8=({dashPlaylists:i,locations:e,contentSteering:t,sidxMapping:n={},previousManifest:r,eventStream:s})=>{if(!i.length)return{};const{sourceDuration:a,type:l,suggestedPresentationDelay:u,minimumUpdatePeriod:d}=i[0].attributes,h=mergeDiscontiguousPlaylists(i.filter(videoOnly)).map(formatVideoPlaylist),p=mergeDiscontiguousPlaylists(i.filter(audioOnly)),m=mergeDiscontiguousPlaylists(i.filter(vttOnly)),g=i.map(D=>D.attributes.captionServices).filter(Boolean),v={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:"",duration:a,playlists:addSidxSegmentsToPlaylists(h,n)};d>=0&&(v.minimumUpdatePeriod=d*1e3),e&&(v.locations=e),t&&(v.contentSteering=t),l==="dynamic"&&(v.suggestedPresentationDelay=u),s&&s.length>0&&(v.eventStream=s);const _=v.playlists.length===0,b=p.length?organizeAudioPlaylists(p,n,_):null,E=m.length?organizeVttPlaylists(m,n):null,A=h.concat(flattenMediaGroupPlaylists(b),flattenMediaGroupPlaylists(E)),z=A.map(({timelineStarts:D})=>D);return v.timelineStarts=getUniqueTimelineStarts(z),addMediaSequenceValues(A,v.timelineStarts),b&&(v.mediaGroups.AUDIO.audio=b),E&&(v.mediaGroups.SUBTITLES.subs=E),g.length&&(v.mediaGroups["CLOSED-CAPTIONS"].cc=organizeCaptionServices(g)),r?positionManifestOnTimeline({oldManifest:r,newManifest:v}):v},getLiveRValue=(i,e,t)=>{const{NOW:n,clientOffset:r,availabilityStartTime:s,timescale:a=1,periodStart:l=0,minimumUpdatePeriod:u=0}=i,d=(n+r)/1e3,h=s+l,m=d+u-h;return Math.ceil((m*a-e)/t)},parseByTimeline=(i,e)=>{const{type:t,minimumUpdatePeriod:n=0,media:r="",sourceDuration:s,timescale:a=1,startNumber:l=1,periodStart:u}=i,d=[];let h=-1;for(let p=0;p<e.length;p++){const m=e[p],g=m.d,v=m.r||0,_=m.t||0;h<0&&(h=_),_&&_>h&&(h=_);let b;if(v<0){const z=p+1;z===e.length?t==="dynamic"&&n>0&&r.indexOf("$Number$")>0?b=getLiveRValue(i,h,g):b=(s*a-h)/g:b=(e[z].t-h)/g}else b=v+1;const E=l+d.length+b;let A=l+d.length;for(;A<E;)d.push({number:A,duration:g/a,time:h,timeline:u}),h+=g,A++}return d},identifierPattern=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,identifierReplacement=i=>(e,t,n,r)=>{if(e==="$$")return"$";if(typeof i[t]>"u")return e;const s=""+i[t];return t==="RepresentationID"||(n?r=parseInt(r,10):r=1,s.length>=r)?s:`${new Array(r-s.length+1).join("0")}${s}`},constructTemplateUrl=(i,e)=>i.replace(identifierPattern,identifierReplacement(e)),parseTemplateInfo=(i,e)=>!i.duration&&!e?[{number:i.startNumber||1,duration:i.sourceDuration,time:0,timeline:i.periodStart}]:i.duration?parseByDuration(i):parseByTimeline(i,e),segmentsFromTemplate=(i,e)=>{const t={RepresentationID:i.id,Bandwidth:i.bandwidth||0},{initialization:n={sourceURL:"",range:""}}=i,r=urlTypeToSegment({baseUrl:i.baseUrl,source:constructTemplateUrl(n.sourceURL,t),range:n.range});return parseTemplateInfo(i,e).map(a=>{t.Number=a.number,t.Time=a.time;const l=constructTemplateUrl(i.media||"",t),u=i.timescale||1,d=i.presentationTimeOffset||0,h=i.periodStart+(a.time-d)/u;return{uri:l,timeline:a.timeline,duration:a.duration,resolvedUri:resolveUrl$1(i.baseUrl||"",l),map:r,number:a.number,presentationTime:h}})},SegmentURLToSegmentObject=(i,e)=>{const{baseUrl:t,initialization:n={}}=i,r=urlTypeToSegment({baseUrl:t,source:n.sourceURL,range:n.range}),s=urlTypeToSegment({baseUrl:t,source:e.media,range:e.mediaRange});return s.map=r,s},segmentsFromList=(i,e)=>{const{duration:t,segmentUrls:n=[],periodStart:r}=i;if(!t&&!e||t&&e)throw new Error(errors.SEGMENT_TIME_UNSPECIFIED);const s=n.map(u=>SegmentURLToSegmentObject(i,u));let a;return t&&(a=parseByDuration(i)),e&&(a=parseByTimeline(i,e)),a.map((u,d)=>{if(s[d]){const h=s[d],p=i.timescale||1,m=i.presentationTimeOffset||0;return h.timeline=u.timeline,h.duration=u.duration,h.number=u.number,h.presentationTime=r+(u.time-m)/p,h}}).filter(u=>u)},generateSegments=({attributes:i,segmentInfo:e})=>{let t,n;e.template?(n=segmentsFromTemplate,t=merge$2(i,e.template)):e.base?(n=segmentsFromBase,t=merge$2(i,e.base)):e.list&&(n=segmentsFromList,t=merge$2(i,e.list));const r={attributes:i};if(!n)return r;const s=n(t,e.segmentTimeline);if(t.duration){const{duration:a,timescale:l=1}=t;t.duration=a/l}else s.length?t.duration=s.reduce((a,l)=>Math.max(a,Math.ceil(l.duration)),0):t.duration=0;return r.attributes=t,r.segments=s,e.base&&t.indexRange&&(r.sidx=s[0],r.segments=[]),r},toPlaylists=i=>i.map(generateSegments),findChildren=(i,e)=>from(i.childNodes).filter(({tagName:t})=>t===e),getContent=i=>i.textContent.trim(),parseDivisionValue=i=>parseFloat(i.split("/").reduce((e,t)=>e/t)),parseDuration=i=>{const l=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(i);if(!l)return 0;const[u,d,h,p,m,g]=l.slice(1);return parseFloat(u||0)*31536e3+parseFloat(d||0)*2592e3+parseFloat(h||0)*86400+parseFloat(p||0)*3600+parseFloat(m||0)*60+parseFloat(g||0)},parseDate=i=>(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(i)&&(i+="Z"),Date.parse(i)),parsers={mediaPresentationDuration(i){return parseDuration(i)},availabilityStartTime(i){return parseDate(i)/1e3},minimumUpdatePeriod(i){return parseDuration(i)},suggestedPresentationDelay(i){return parseDuration(i)},type(i){return i},timeShiftBufferDepth(i){return parseDuration(i)},start(i){return parseDuration(i)},width(i){return parseInt(i,10)},height(i){return parseInt(i,10)},bandwidth(i){return parseInt(i,10)},frameRate(i){return parseDivisionValue(i)},startNumber(i){return parseInt(i,10)},timescale(i){return parseInt(i,10)},presentationTimeOffset(i){return parseInt(i,10)},duration(i){const e=parseInt(i,10);return isNaN(e)?parseDuration(i):e},d(i){return parseInt(i,10)},t(i){return parseInt(i,10)},r(i){return parseInt(i,10)},presentationTime(i){return parseInt(i,10)},DEFAULT(i){return i}},parseAttributes=i=>i&&i.attributes?from(i.attributes).reduce((e,t)=>{const n=parsers[t.name]||parsers.DEFAULT;return e[t.name]=n(t.value),e},{}):{},keySystemsMap={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime","urn:mpeg:dash:mp4protection:2011":"mp4protection"},buildBaseUrls=(i,e)=>e.length?flatten(i.map(function(t){return e.map(function(n){const r=getContent(n),s=resolveUrl$1(t.baseUrl,r),a=merge$2(parseAttributes(n),{baseUrl:s});return s!==r&&!a.serviceLocation&&t.serviceLocation&&(a.serviceLocation=t.serviceLocation),a})})):i,getSegmentInformation=i=>{const e=findChildren(i,"SegmentTemplate")[0],t=findChildren(i,"SegmentList")[0],n=t&&findChildren(t,"SegmentURL").map(p=>merge$2({tag:"SegmentURL"},parseAttributes(p))),r=findChildren(i,"SegmentBase")[0],s=t||e,a=s&&findChildren(s,"SegmentTimeline")[0],l=t||r||e,u=l&&findChildren(l,"Initialization")[0],d=e&&parseAttributes(e);d&&u?d.initialization=u&&parseAttributes(u):d&&d.initialization&&(d.initialization={sourceURL:d.initialization});const h={template:d,segmentTimeline:a&&findChildren(a,"S").map(p=>parseAttributes(p)),list:t&&merge$2(parseAttributes(t),{segmentUrls:n,initialization:parseAttributes(u)}),base:r&&merge$2(parseAttributes(r),{initialization:parseAttributes(u)})};return Object.keys(h).forEach(p=>{h[p]||delete h[p]}),h},inheritBaseUrls=(i,e,t)=>n=>{const r=findChildren(n,"BaseURL"),s=buildBaseUrls(e,r),a=merge$2(i,parseAttributes(n)),l=getSegmentInformation(n);return s.map(u=>({segmentInfo:merge$2(t,l),attributes:merge$2(a,u)}))},generateKeySystemInformation=i=>i.reduce((e,t)=>{const n=parseAttributes(t);n.schemeIdUri&&(n.schemeIdUri=n.schemeIdUri.toLowerCase());const r=keySystemsMap[n.schemeIdUri];if(r){e[r]={attributes:n};const s=findChildren(t,"cenc:pssh")[0];if(s){const a=getContent(s);e[r].pssh=a&&decodeB64ToUint8Array(a)}}return e},{}),parseCaptionServiceMetadata=i=>{if(i.schemeIdUri==="urn:scte:dash:cc:cea-608:2015")return(typeof i.value!="string"?[]:i.value.split(";")).map(t=>{let n,r;return r=t,/^CC\d=/.test(t)?[n,r]=t.split("="):/^CC\d$/.test(t)&&(n=t),{channel:n,language:r}});if(i.schemeIdUri==="urn:scte:dash:cc:cea-708:2015")return(typeof i.value!="string"?[]:i.value.split(";")).map(t=>{const n={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(t)){const[r,s=""]=t.split("=");n.channel=r,n.language=t,s.split(",").forEach(a=>{const[l,u]=a.split(":");l==="lang"?n.language=u:l==="er"?n.easyReader=Number(u):l==="war"?n.aspectRatio=Number(u):l==="3D"&&(n["3D"]=Number(u))})}else n.language=t;return n.channel&&(n.channel="SERVICE"+n.channel),n})},toEventStream=i=>flatten(findChildren(i.node,"EventStream").map(e=>{const t=parseAttributes(e),n=t.schemeIdUri;return findChildren(e,"Event").map(r=>{const s=parseAttributes(r),a=s.presentationTime||0,l=t.timescale||1,u=s.duration||0,d=a/l+i.attributes.start;return{schemeIdUri:n,value:t.value,id:s.id,start:d,end:d+u/l,messageData:getContent(r)||s.messageData,contentEncoding:t.contentEncoding,presentationTimeOffset:t.presentationTimeOffset||0}})})),toRepresentations=(i,e,t)=>n=>{const r=parseAttributes(n),s=buildBaseUrls(e,findChildren(n,"BaseURL")),a=findChildren(n,"Role")[0],l={role:parseAttributes(a)};let u=merge$2(i,r,l);const d=findChildren(n,"Accessibility")[0],h=parseCaptionServiceMetadata(parseAttributes(d));h&&(u=merge$2(u,{captionServices:h}));const p=findChildren(n,"Label")[0];if(p&&p.childNodes.length){const b=p.childNodes[0].nodeValue.trim();u=merge$2(u,{label:b})}const m=generateKeySystemInformation(findChildren(n,"ContentProtection"));Object.keys(m).length&&(u=merge$2(u,{contentProtection:m}));const g=getSegmentInformation(n),v=findChildren(n,"Representation"),_=merge$2(t,g);return flatten(v.map(inheritBaseUrls(u,s,_)))},toAdaptationSets=(i,e)=>(t,n)=>{const r=buildBaseUrls(e,findChildren(t.node,"BaseURL")),s=merge$2(i,{periodStart:t.attributes.start});typeof t.attributes.duration=="number"&&(s.periodDuration=t.attributes.duration);const a=findChildren(t.node,"AdaptationSet"),l=getSegmentInformation(t.node);return flatten(a.map(toRepresentations(s,r,l)))},generateContentSteeringInformation=(i,e)=>{if(i.length>1&&e({type:"warn",message:"The MPD manifest should contain no more than one ContentSteering tag"}),!i.length)return null;const t=merge$2({serverURL:getContent(i[0])},parseAttributes(i[0]));return t.queryBeforeStart=t.queryBeforeStart==="true",t},getPeriodStart=({attributes:i,priorPeriodAttributes:e,mpdType:t})=>typeof i.start=="number"?i.start:e&&typeof e.start=="number"&&typeof e.duration=="number"?e.start+e.duration:!e&&t==="static"?0:null,inheritAttributes=(i,e={})=>{const{manifestUri:t="",NOW:n=Date.now(),clientOffset:r=0,eventHandler:s=function(){}}=e,a=findChildren(i,"Period");if(!a.length)throw new Error(errors.INVALID_NUMBER_OF_PERIOD);const l=findChildren(i,"Location"),u=parseAttributes(i),d=buildBaseUrls([{baseUrl:t}],findChildren(i,"BaseURL")),h=findChildren(i,"ContentSteering");u.type=u.type||"static",u.sourceDuration=u.mediaPresentationDuration||0,u.NOW=n,u.clientOffset=r,l.length&&(u.locations=l.map(getContent));const p=[];return a.forEach((m,g)=>{const v=parseAttributes(m),_=p[g-1];v.start=getPeriodStart({attributes:v,priorPeriodAttributes:_?_.attributes:null,mpdType:u.type}),p.push({node:m,attributes:v})}),{locations:u.locations,contentSteeringInfo:generateContentSteeringInformation(h,s),representationInfo:flatten(p.map(toAdaptationSets(u,d))),eventStream:flatten(p.map(toEventStream))}},stringToMpdXml=i=>{if(i==="")throw new Error(errors.DASH_EMPTY_MANIFEST);const e=new libExports$2.DOMParser;let t,n;try{t=e.parseFromString(i,"application/xml"),n=t&&t.documentElement.tagName==="MPD"?t.documentElement:null}catch{}if(!n||n&&n.getElementsByTagName("parsererror").length>0)throw new Error(errors.DASH_INVALID_XML);return n},parseUTCTimingScheme=i=>{const e=findChildren(i,"UTCTiming")[0];if(!e)return null;const t=parseAttributes(e);switch(t.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":t.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":t.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":t.method="DIRECT",t.value=Date.parse(t.value);break;default:throw new Error(errors.UNSUPPORTED_UTC_TIMING_SCHEME)}return t},parse=(i,e={})=>{const t=inheritAttributes(stringToMpdXml(i),e),n=toPlaylists(t.representationInfo);return toM3u8({dashPlaylists:n,locations:t.locations,contentSteering:t.contentSteeringInfo,sidxMapping:e.sidxMapping,previousManifest:e.previousManifest,eventStream:t.eventStream})},parseUTCTiming=i=>parseUTCTimingScheme(stringToMpdXml(i));var numbers,hasRequiredNumbers;function requireNumbers(){if(hasRequiredNumbers)return numbers;hasRequiredNumbers=1;var i=Math.pow(2,32),e=function(t){var n=new DataView(t.buffer,t.byteOffset,t.byteLength),r;return n.getBigUint64?(r=n.getBigUint64(0),r<Number.MAX_SAFE_INTEGER?Number(r):r):n.getUint32(0)*i+n.getUint32(4)};return numbers={getUint64:e,MAX_UINT32:i},numbers}var parseSidx_1,hasRequiredParseSidx;function requireParseSidx(){if(hasRequiredParseSidx)return parseSidx_1;hasRequiredParseSidx=1;var i=requireNumbers().getUint64,e=function(t){var n=new DataView(t.buffer,t.byteOffset,t.byteLength),r={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:n.getUint32(4),timescale:n.getUint32(8)},s=12;r.version===0?(r.earliestPresentationTime=n.getUint32(s),r.firstOffset=n.getUint32(s+4),s+=8):(r.earliestPresentationTime=i(t.subarray(s)),r.firstOffset=i(t.subarray(s+8)),s+=16),s+=2;var a=n.getUint16(s);for(s+=2;a>0;s+=12,a--)r.references.push({referenceType:(t[s]&128)>>>7,referencedSize:n.getUint32(s)&2147483647,subsegmentDuration:n.getUint32(s+4),startsWithSap:!!(t[s+8]&128),sapType:(t[s+8]&112)>>>4,sapDeltaTime:n.getUint32(s+8)&268435455});return r};return parseSidx_1=e,parseSidx_1}var parseSidxExports=requireParseSidx();const parseSidx=getDefaultExportFromCjs(parseSidxExports);var ID3=toUint8([73,68,51]),getId3Size=function(e,t){t===void 0&&(t=0),e=toUint8(e);var n=e[t+5],r=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],s=(n&16)>>4;return s?r+20:r+10},getId3Offset=function i(e,t){return t===void 0&&(t=0),e=toUint8(e),e.length-t<10||!bytesMatch(e,ID3,{offset:t})?t:(t+=getId3Size(e,t),i(e,t))},normalizePath$1=function(e){return typeof e=="string"?stringToBytes$1(e):e},normalizePaths$1=function(e){return Array.isArray(e)?e.map(function(t){return normalizePath$1(t)}):[normalizePath$1(e)]},findBox=function i(e,t,n){n===void 0&&(n=!1),t=normalizePaths$1(t),e=toUint8(e);var r=[];if(!t.length)return r;for(var s=0;s<e.length;){var a=(e[s]<<24|e[s+1]<<16|e[s+2]<<8|e[s+3])>>>0,l=e.subarray(s+4,s+8);if(a===0)break;var u=s+a;if(u>e.length){if(n)break;u=e.length}var d=e.subarray(s+8,u);bytesMatch(l,t[0])&&(t.length===1?r.push(d):r.push.apply(r,i(d,t.slice(1),n))),s=u}return r},EBML_TAGS={EBML:toUint8([26,69,223,163]),DocType:toUint8([66,130]),Segment:toUint8([24,83,128,103]),SegmentInfo:toUint8([21,73,169,102]),Tracks:toUint8([22,84,174,107]),Track:toUint8([174]),TrackNumber:toUint8([215]),DefaultDuration:toUint8([35,227,131]),TrackEntry:toUint8([174]),TrackType:toUint8([131]),FlagDefault:toUint8([136]),CodecID:toUint8([134]),CodecPrivate:toUint8([99,162]),VideoTrack:toUint8([224]),AudioTrack:toUint8([225]),Cluster:toUint8([31,67,182,117]),Timestamp:toUint8([231]),TimestampScale:toUint8([42,215,177]),BlockGroup:toUint8([160]),BlockDuration:toUint8([155]),Block:toUint8([161]),SimpleBlock:toUint8([163])},LENGTH_TABLE=[128,64,32,16,8,4,2,1],getLength=function(e){for(var t=1,n=0;n<LENGTH_TABLE.length&&!(e&LENGTH_TABLE[n]);n++)t++;return t},getvint=function(e,t,n,r){n===void 0&&(n=!0),r===void 0&&(r=!1);var s=getLength(e[t]),a=e.subarray(t,t+s);return n&&(a=Array.prototype.slice.call(e,t,t+s),a[0]^=LENGTH_TABLE[s-1]),{length:s,value:bytesToNumber(a,{signed:r}),bytes:a}},normalizePath=function i(e){return typeof e=="string"?e.match(/.{1,2}/g).map(function(t){return i(t)}):typeof e=="number"?numberToBytes(e):e},normalizePaths=function(e){return Array.isArray(e)?e.map(function(t){return normalizePath(t)}):[normalizePath(e)]},getInfinityDataSize=function i(e,t,n){if(n>=t.length)return t.length;var r=getvint(t,n,!1);if(bytesMatch(e.bytes,r.bytes))return n;var s=getvint(t,n+r.length);return i(e,t,n+s.length+s.value+r.length)},findEbml=function i(e,t){t=normalizePaths(t),e=toUint8(e);var n=[];if(!t.length)return n;for(var r=0;r<e.length;){var s=getvint(e,r,!1),a=getvint(e,r+s.length),l=r+s.length+a.length;a.value===127&&(a.value=getInfinityDataSize(s,e,l),a.value!==e.length&&(a.value-=l));var u=l+a.value>e.length?e.length:l+a.value,d=e.subarray(l,u);bytesMatch(t[0],s.bytes)&&(t.length===1?n.push(d):n=n.concat(i(d,t.slice(1))));var h=s.length+a.length+d.length;r+=h}return n},NAL_TYPE_ONE=toUint8([0,0,0,1]),NAL_TYPE_TWO=toUint8([0,0,1]),EMULATION_PREVENTION=toUint8([0,0,3]),discardEmulationPreventionBytes=function(e){for(var t=[],n=1;n<e.length-2;)bytesMatch(e.subarray(n,n+3),EMULATION_PREVENTION)&&(t.push(n+2),n++),n++;if(t.length===0)return e;var r=e.length-t.length,s=new Uint8Array(r),a=0;for(n=0;n<r;a++,n++)a===t[0]&&(a++,t.shift()),s[n]=e[a];return s},findNal=function(e,t,n,r){e=toUint8(e),n=[].concat(n);for(var s=0,a,l=0;s<e.length&&(l<r||a);){var u=void 0;if(bytesMatch(e.subarray(s),NAL_TYPE_ONE)?u=4:bytesMatch(e.subarray(s),NAL_TYPE_TWO)&&(u=3),!u){s++;continue}if(l++,a)return discardEmulationPreventionBytes(e.subarray(a,s));var d=void 0;t==="h264"?d=e[s+u]&31:t==="h265"&&(d=e[s+u]>>1&63),n.indexOf(d)!==-1&&(a=s+u),s+=u+(t==="h264"?1:2)}return e.subarray(0,0)},findH264Nal=function(e,t,n){return findNal(e,"h264",t,n)},findH265Nal=function(e,t,n){return findNal(e,"h265",t,n)},CONSTANTS={webm:toUint8([119,101,98,109]),matroska:toUint8([109,97,116,114,111,115,107,97]),flac:toUint8([102,76,97,67]),ogg:toUint8([79,103,103,83]),ac3:toUint8([11,119]),riff:toUint8([82,73,70,70]),avi:toUint8([65,86,73]),wav:toUint8([87,65,86,69]),"3gp":toUint8([102,116,121,112,51,103]),mp4:toUint8([102,116,121,112]),fmp4:toUint8([115,116,121,112]),mov:toUint8([102,116,121,112,113,116]),moov:toUint8([109,111,111,118]),moof:toUint8([109,111,111,102])},_isLikely={aac:function(e){var t=getId3Offset(e);return bytesMatch(e,[255,16],{offset:t,mask:[255,22]})},mp3:function(e){var t=getId3Offset(e);return bytesMatch(e,[255,2],{offset:t,mask:[255,6]})},webm:function(e){var t=findEbml(e,[EBML_TAGS.EBML,EBML_TAGS.DocType])[0];return bytesMatch(t,CONSTANTS.webm)},mkv:function(e){var t=findEbml(e,[EBML_TAGS.EBML,EBML_TAGS.DocType])[0];return bytesMatch(t,CONSTANTS.matroska)},mp4:function(e){if(_isLikely["3gp"](e)||_isLikely.mov(e))return!1;if(bytesMatch(e,CONSTANTS.mp4,{offset:4})||bytesMatch(e,CONSTANTS.fmp4,{offset:4})||bytesMatch(e,CONSTANTS.moof,{offset:4})||bytesMatch(e,CONSTANTS.moov,{offset:4}))return!0},mov:function(e){return bytesMatch(e,CONSTANTS.mov,{offset:4})},"3gp":function(e){return bytesMatch(e,CONSTANTS["3gp"],{offset:4})},ac3:function(e){var t=getId3Offset(e);return bytesMatch(e,CONSTANTS.ac3,{offset:t})},ts:function(e){if(e.length<189&&e.length>=1)return e[0]===71;for(var t=0;t+188<e.length&&t<188;){if(e[t]===71&&e[t+188]===71)return!0;t+=1}return!1},flac:function(e){var t=getId3Offset(e);return bytesMatch(e,CONSTANTS.flac,{offset:t})},ogg:function(e){return bytesMatch(e,CONSTANTS.ogg)},avi:function(e){return bytesMatch(e,CONSTANTS.riff)&&bytesMatch(e,CONSTANTS.avi,{offset:8})},wav:function(e){return bytesMatch(e,CONSTANTS.riff)&&bytesMatch(e,CONSTANTS.wav,{offset:8})},h264:function(e){return findH264Nal(e,7,3).length},h265:function(e){return findH265Nal(e,[32,33],3).length}},isLikelyTypes=Object.keys(_isLikely).filter(function(i){return i!=="ts"&&i!=="h264"&&i!=="h265"}).concat(["ts","h264","h265"]);isLikelyTypes.forEach(function(i){var e=_isLikely[i];_isLikely[i]=function(t){return e(toUint8(t))}});var isLikely=_isLikely,detectContainerForBytes=function(e){e=toUint8(e);for(var t=0;t<isLikelyTypes.length;t++){var n=isLikelyTypes[t];if(isLikely[n](e))return n}return""},isLikelyFmp4MediaSegment=function(e){return findBox(e,["moof"]).length>0},clock,hasRequiredClock;function requireClock(){if(hasRequiredClock)return clock;hasRequiredClock=1;var i=9e4,e,t,n,r,s,a,l;return e=function(u){return u*i},t=function(u,d){return u*d},n=function(u){return u/i},r=function(u,d){return u/d},s=function(u,d){return e(r(u,d))},a=function(u,d){return t(n(u),d)},l=function(u,d,h){return n(h?u:u-d)},clock={ONE_SECOND_IN_TS:i,secondsToVideoTs:e,secondsToAudioTs:t,videoTsToSeconds:n,audioTsToSeconds:r,audioTsToVideoTs:s,videoTsToAudioTs:a,metadataTsToSeconds:l},clock}var clockExports=requireClock();var version$6="8.23.4";const hooks_={},hooks=function(i,e){return hooks_[i]=hooks_[i]||[],e&&(hooks_[i]=hooks_[i].concat(e)),hooks_[i]},hook=function(i,e){hooks(i,e)},removeHook=function(i,e){const t=hooks(i).indexOf(e);return t<=-1?!1:(hooks_[i]=hooks_[i].slice(),hooks_[i].splice(t,1),!0)},hookOnce=function(i,e){hooks(i,[].concat(e).map(t=>{const n=(...r)=>(removeHook(i,n),t(...r));return n}))},FullscreenApi={prefixed:!0},apiMap=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"]],specApi=apiMap[0];let browserApi;for(let i=0;i<apiMap.length;i++)if(apiMap[i][1]in document$1){browserApi=apiMap[i];break}if(browserApi){for(let i=0;i<browserApi.length;i++)FullscreenApi[specApi[i]]=browserApi[i];FullscreenApi.prefixed=browserApi[0]!==specApi[0]}let history=[];const LogByTypeFactory=(i,e,t)=>(n,r,s)=>{const a=e.levels[r],l=new RegExp(`^(${a})$`);let u=i;if(n!=="log"&&s.unshift(n.toUpperCase()+":"),t&&(u=`%c${i}`,s.unshift(t)),s.unshift(u+":"),history){history.push([].concat(s));const h=history.length-1e3;history.splice(0,h>0?h:0)}if(!window$1.console)return;let d=window$1.console[n];!d&&n==="debug"&&(d=window$1.console.info||window$1.console.log),!(!d||!a||!l.test(n))&&d[Array.isArray(s)?"apply":"call"](window$1.console,s)};function createLogger$1(i,e=":",t=""){let n="info",r;function s(...a){r("log",n,a)}return r=LogByTypeFactory(i,s,t),s.createLogger=(a,l,u)=>{const d=l!==void 0?l:e,h=u!==void 0?u:t,p=`${i} ${d} ${a}`;return createLogger$1(p,d,h)},s.createNewLogger=(a,l,u)=>createLogger$1(a,l,u),s.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:n},s.level=a=>{if(typeof a=="string"){if(!s.levels.hasOwnProperty(a))throw new Error(`"${a}" in not a valid log level`);n=a}return n},s.history=()=>history?[].concat(history):[],s.history.filter=a=>(history||[]).filter(l=>new RegExp(`.*${a}.*`).test(l[0])),s.history.clear=()=>{history&&(history.length=0)},s.history.disable=()=>{history!==null&&(history.length=0,history=null)},s.history.enable=()=>{history===null&&(history=[])},s.error=(...a)=>r("error",n,a),s.warn=(...a)=>r("warn",n,a),s.debug=(...a)=>r("debug",n,a),s}const log$1=createLogger$1("VIDEOJS"),createLogger=log$1.createLogger,toString=Object.prototype.toString,keys=function(i){return isObject(i)?Object.keys(i):[]};function each(i,e){keys(i).forEach(t=>e(i[t],t))}function reduce(i,e,t=0){return keys(i).reduce((n,r)=>e(n,i[r],r),t)}function isObject(i){return!!i&&typeof i=="object"}function isPlain(i){return isObject(i)&&toString.call(i)==="[object Object]"&&i.constructor===Object}function merge$1(...i){const e={};return i.forEach(t=>{t&&each(t,(n,r)=>{if(!isPlain(n)){e[r]=n;return}isPlain(e[r])||(e[r]={}),e[r]=merge$1(e[r],n)})}),e}function values(i={}){const e=[];for(const t in i)if(i.hasOwnProperty(t)){const n=i[t];e.push(n)}return e}function defineLazyProperty(i,e,t,n=!0){const r=a=>Object.defineProperty(i,e,{value:a,enumerable:!0,writable:!0}),s={configurable:!0,enumerable:!0,get(){const a=t();return r(a),a}};return n&&(s.set=r),Object.defineProperty(i,e,s)}var Obj=Object.freeze({__proto__:null,each,reduce,isObject,isPlain,merge:merge$1,values,defineLazyProperty});let IS_IPOD=!1,IOS_VERSION=null,IS_ANDROID=!1,ANDROID_VERSION,IS_FIREFOX=!1,IS_EDGE=!1,IS_CHROMIUM=!1,IS_CHROME=!1,CHROMIUM_VERSION=null,CHROME_VERSION=null;const IS_CHROMECAST_RECEIVER=!!(window$1.cast&&window$1.cast.framework&&window$1.cast.framework.CastReceiverContext);let IE_VERSION=null,IS_SAFARI=!1,IS_WINDOWS=!1,IS_IPAD=!1,IS_IPHONE=!1,IS_TIZEN=!1,IS_WEBOS=!1,IS_SMART_TV=!1;const TOUCH_ENABLED=!!(isReal()&&("ontouchstart"in window$1||window$1.navigator.maxTouchPoints||window$1.DocumentTouch&&window$1.document instanceof window$1.DocumentTouch)),UAD=window$1.navigator&&window$1.navigator.userAgentData;UAD&&UAD.platform&&UAD.brands&&(IS_ANDROID=UAD.platform==="Android",IS_EDGE=!!UAD.brands.find(i=>i.brand==="Microsoft Edge"),IS_CHROMIUM=!!UAD.brands.find(i=>i.brand==="Chromium"),IS_CHROME=!IS_EDGE&&IS_CHROMIUM,CHROMIUM_VERSION=CHROME_VERSION=(UAD.brands.find(i=>i.brand==="Chromium")||{}).version||null,IS_WINDOWS=UAD.platform==="Windows");if(!IS_CHROMIUM){const i=window$1.navigator&&window$1.navigator.userAgent||"";IS_IPOD=/iPod/i.test(i),IOS_VERSION=(function(){const e=i.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null})(),IS_ANDROID=/Android/i.test(i),ANDROID_VERSION=(function(){const e=i.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null})(),IS_FIREFOX=/Firefox/i.test(i),IS_EDGE=/Edg/i.test(i),IS_CHROMIUM=/Chrome/i.test(i)||/CriOS/i.test(i),IS_CHROME=!IS_EDGE&&IS_CHROMIUM,CHROMIUM_VERSION=CHROME_VERSION=(function(){const e=i.match(/(Chrome|CriOS)\/(\d+)/);return e&&e[2]?parseFloat(e[2]):null})(),IE_VERSION=(function(){const e=/MSIE\s(\d+)\.\d/.exec(i);let t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(i)&&/rv:11.0/.test(i)&&(t=11),t})(),IS_TIZEN=/Tizen/i.test(i),IS_WEBOS=/Web0S/i.test(i),IS_SMART_TV=IS_TIZEN||IS_WEBOS,IS_SAFARI=/Safari/i.test(i)&&!IS_CHROME&&!IS_ANDROID&&!IS_EDGE&&!IS_SMART_TV,IS_WINDOWS=/Windows/i.test(i),IS_IPAD=/iPad/i.test(i)||IS_SAFARI&&TOUCH_ENABLED&&!/iPhone/i.test(i),IS_IPHONE=/iPhone/i.test(i)&&!IS_IPAD}const IS_IOS=IS_IPHONE||IS_IPAD||IS_IPOD,IS_ANY_SAFARI=(IS_SAFARI||IS_IOS)&&!IS_CHROME;var browser$1=Object.freeze({__proto__:null,get IS_IPOD(){return IS_IPOD},get IOS_VERSION(){return IOS_VERSION},get IS_ANDROID(){return IS_ANDROID},get ANDROID_VERSION(){return ANDROID_VERSION},get IS_FIREFOX(){return IS_FIREFOX},get IS_EDGE(){return IS_EDGE},get IS_CHROMIUM(){return IS_CHROMIUM},get IS_CHROME(){return IS_CHROME},get CHROMIUM_VERSION(){return CHROMIUM_VERSION},get CHROME_VERSION(){return CHROME_VERSION},IS_CHROMECAST_RECEIVER,get IE_VERSION(){return IE_VERSION},get IS_SAFARI(){return IS_SAFARI},get IS_WINDOWS(){return IS_WINDOWS},get IS_IPAD(){return IS_IPAD},get IS_IPHONE(){return IS_IPHONE},get IS_TIZEN(){return IS_TIZEN},get IS_WEBOS(){return IS_WEBOS},get IS_SMART_TV(){return IS_SMART_TV},TOUCH_ENABLED,IS_IOS,IS_ANY_SAFARI});function isNonBlankString(i){return typeof i=="string"&&!!i.trim()}function throwIfWhitespace(i){if(i.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function isReal(){return document$1===window$1.document}function isEl(i){return isObject(i)&&i.nodeType===1}function isInFrame(){try{return window$1.parent!==window$1.self}catch{return!0}}function createQuerier(i){return function(e,t){if(!isNonBlankString(e))return document$1[i](null);isNonBlankString(t)&&(t=document$1.querySelector(t));const n=isEl(t)?t:document$1;return n[i]&&n[i](e)}}function createEl(i="div",e={},t={},n){const r=document$1.createElement(i);return Object.getOwnPropertyNames(e).forEach(function(s){const a=e[s];s==="textContent"?textContent(r,a):(r[s]!==a||s==="tabIndex")&&(r[s]=a)}),Object.getOwnPropertyNames(t).forEach(function(s){r.setAttribute(s,t[s])}),n&&appendContent(r,n),r}function textContent(i,e){return typeof i.textContent>"u"?i.innerText=e:i.textContent=e,i}function prependTo(i,e){e.firstChild?e.insertBefore(i,e.firstChild):e.appendChild(i)}function hasClass(i,e){return throwIfWhitespace(e),i.classList.contains(e)}function addClass(i,...e){return i.classList.add(...e.reduce((t,n)=>t.concat(n.split(/\s+/)),[])),i}function removeClass(i,...e){return i?(i.classList.remove(...e.reduce((t,n)=>t.concat(n.split(/\s+/)),[])),i):(log$1.warn("removeClass was called with an element that doesn't exist"),null)}function toggleClass(i,e,t){return typeof t=="function"&&(t=t(i,e)),typeof t!="boolean"&&(t=void 0),e.split(/\s+/).forEach(n=>i.classList.toggle(n,t)),i}function setAttributes(i,e){Object.getOwnPropertyNames(e).forEach(function(t){const n=e[t];n===null||typeof n>"u"||n===!1?i.removeAttribute(t):i.setAttribute(t,n===!0?"":n)})}function getAttributes(i){const e={},t=["autoplay","controls","playsinline","loop","muted","default","defaultMuted"];if(i&&i.attributes&&i.attributes.length>0){const n=i.attributes;for(let r=n.length-1;r>=0;r--){const s=n[r].name;let a=n[r].value;t.includes(s)&&(a=a!==null),e[s]=a}}return e}function getAttribute(i,e){return i.getAttribute(e)}function setAttribute(i,e,t){i.setAttribute(e,t)}function removeAttribute(i,e){i.removeAttribute(e)}function blockTextSelection(){document$1.body.focus(),document$1.onselectstart=function(){return!1}}function unblockTextSelection(){document$1.onselectstart=function(){return!0}}function getBoundingClientRect(i){if(i&&i.getBoundingClientRect&&i.parentNode){const e=i.getBoundingClientRect(),t={};return["bottom","height","left","right","top","width"].forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t.height||(t.height=parseFloat(computedStyle(i,"height"))),t.width||(t.width=parseFloat(computedStyle(i,"width"))),t}}function findPosition(i){if(!i||i&&!i.offsetParent)return{left:0,top:0,width:0,height:0};const e=i.offsetWidth,t=i.offsetHeight;let n=0,r=0;for(;i.offsetParent&&i!==document$1[FullscreenApi.fullscreenElement];)n+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;return{left:n,top:r,width:e,height:t}}function getPointerPosition(i,e){const t={x:0,y:0};if(IS_IOS){let h=i;for(;h&&h.nodeName.toLowerCase()!=="html";){const p=computedStyle(h,"transform");if(/^matrix/.test(p)){const m=p.slice(7,-1).split(/,\s/).map(Number);t.x+=m[4],t.y+=m[5]}else if(/^matrix3d/.test(p)){const m=p.slice(9,-1).split(/,\s/).map(Number);t.x+=m[12],t.y+=m[13]}if(h.assignedSlot&&h.assignedSlot.parentElement&&window$1.WebKitCSSMatrix){const m=window$1.getComputedStyle(h.assignedSlot.parentElement).transform,g=new window$1.WebKitCSSMatrix(m);t.x+=g.m41,t.y+=g.m42}h=h.parentNode||h.host}}const n={},r=findPosition(e.target),s=findPosition(i),a=s.width,l=s.height;let u=e.offsetY-(s.top-r.top),d=e.offsetX-(s.left-r.left);return e.changedTouches&&(d=e.changedTouches[0].pageX-s.left,u=e.changedTouches[0].pageY+s.top,IS_IOS&&(d-=t.x,u-=t.y)),n.y=1-Math.max(0,Math.min(1,u/l)),n.x=Math.max(0,Math.min(1,d/a)),n}function isTextNode(i){return isObject(i)&&i.nodeType===3}function emptyEl(i){for(;i.firstChild;)i.removeChild(i.firstChild);return i}function normalizeContent(i){return typeof i=="function"&&(i=i()),(Array.isArray(i)?i:[i]).map(e=>{if(typeof e=="function"&&(e=e()),isEl(e)||isTextNode(e))return e;if(typeof e=="string"&&/\S/.test(e))return document$1.createTextNode(e)}).filter(e=>e)}function appendContent(i,e){return normalizeContent(e).forEach(t=>i.appendChild(t)),i}function insertContent(i,e){return appendContent(emptyEl(i),e)}function isSingleLeftClick(i){return i.button===void 0&&i.buttons===void 0||i.button===0&&i.buttons===void 0||i.type==="mouseup"&&i.button===0&&i.buttons===0||i.type==="mousedown"&&i.button===0&&i.buttons===0?!0:!(i.button!==0||i.buttons!==1)}const $=createQuerier("querySelector"),$$=createQuerier("querySelectorAll");function computedStyle(i,e){if(!i||!e)return"";if(typeof window$1.getComputedStyle=="function"){let t;try{t=window$1.getComputedStyle(i)}catch{return""}return t?t.getPropertyValue(e)||t[e]:""}return""}function copyStyleSheetsToWindow(i){[...document$1.styleSheets].forEach(e=>{try{const t=[...e.cssRules].map(r=>r.cssText).join(""),n=document$1.createElement("style");n.textContent=t,i.document.head.appendChild(n)}catch{const n=document$1.createElement("link");n.rel="stylesheet",n.type=e.type,n.media=e.media.mediaText,n.href=e.href,i.document.head.appendChild(n)}})}var Dom=Object.freeze({__proto__:null,isReal,isEl,isInFrame,createEl,textContent,prependTo,hasClass,addClass,removeClass,toggleClass,setAttributes,getAttributes,getAttribute,setAttribute,removeAttribute,blockTextSelection,unblockTextSelection,getBoundingClientRect,findPosition,getPointerPosition,isTextNode,emptyEl,normalizeContent,appendContent,insertContent,isSingleLeftClick,$,$$,computedStyle,copyStyleSheetsToWindow});let _windowLoaded=!1,videojs$1;const autoSetup=function(){if(videojs$1.options.autoSetup===!1)return;const i=Array.prototype.slice.call(document$1.getElementsByTagName("video")),e=Array.prototype.slice.call(document$1.getElementsByTagName("audio")),t=Array.prototype.slice.call(document$1.getElementsByTagName("video-js")),n=i.concat(e,t);if(n&&n.length>0)for(let r=0,s=n.length;r<s;r++){const a=n[r];if(a&&a.getAttribute)a.player===void 0&&a.getAttribute("data-setup")!==null&&videojs$1(a);else{autoSetupTimeout(1);break}}else _windowLoaded||autoSetupTimeout(1)};function autoSetupTimeout(i,e){isReal()&&(e&&(videojs$1=e),window$1.setTimeout(autoSetup,i))}function setWindowLoaded(){_windowLoaded=!0,window$1.removeEventListener("load",setWindowLoaded)}isReal()&&(document$1.readyState==="complete"?setWindowLoaded():window$1.addEventListener("load",setWindowLoaded));const createStyleElement=function(i){const e=document$1.createElement("style");return e.className=i,e},setTextContent=function(i,e){i.styleSheet?i.styleSheet.cssText=e:i.textContent=e};var DomData=new WeakMap;const _initialGuid=3;let _guid=_initialGuid;function newGUID(){return _guid++}function _cleanUpEvents(i,e){if(!DomData.has(i))return;const t=DomData.get(i);t.handlers[e].length===0&&(delete t.handlers[e],i.removeEventListener?i.removeEventListener(e,t.dispatcher,!1):i.detachEvent&&i.detachEvent("on"+e,t.dispatcher)),Object.getOwnPropertyNames(t.handlers).length<=0&&(delete t.handlers,delete t.dispatcher,delete t.disabled),Object.getOwnPropertyNames(t).length===0&&DomData.delete(i)}function _handleMultipleEvents(i,e,t,n){t.forEach(function(r){i(e,r,n)})}function fixEvent(i){if(i.fixed_)return i;function e(){return!0}function t(){return!1}if(!i||!i.isPropagationStopped||!i.isImmediatePropagationStopped){const n=i||window$1.event;i={};const r=["layerX","layerY","keyLocation","path","webkitMovementX","webkitMovementY","mozPressure","mozInputSource"];for(const s in n)r.includes(s)||s==="returnValue"&&n.preventDefault||(i[s]=n[s]);if(i.target||(i.target=i.srcElement||document$1),i.relatedTarget||(i.relatedTarget=i.fromElement===i.target?i.toElement:i.fromElement),i.preventDefault=function(){n.preventDefault&&n.preventDefault(),i.returnValue=!1,n.returnValue=!1,i.defaultPrevented=!0},i.defaultPrevented=!1,i.stopPropagation=function(){n.stopPropagation&&n.stopPropagation(),i.cancelBubble=!0,n.cancelBubble=!0,i.isPropagationStopped=e},i.isPropagationStopped=t,i.stopImmediatePropagation=function(){n.stopImmediatePropagation&&n.stopImmediatePropagation(),i.isImmediatePropagationStopped=e,i.stopPropagation()},i.isImmediatePropagationStopped=t,i.clientX!==null&&i.clientX!==void 0){const s=document$1.documentElement,a=document$1.body;i.pageX=i.clientX+(s&&s.scrollLeft||a&&a.scrollLeft||0)-(s&&s.clientLeft||a&&a.clientLeft||0),i.pageY=i.clientY+(s&&s.scrollTop||a&&a.scrollTop||0)-(s&&s.clientTop||a&&a.clientTop||0)}i.which=i.charCode||i.keyCode,i.button!==null&&i.button!==void 0&&(i.button=i.button&1?0:i.button&4?1:i.button&2?2:0)}return i.fixed_=!0,i}let _supportsPassive;const supportsPassive=function(){if(typeof _supportsPassive!="boolean"){_supportsPassive=!1;try{const i=Object.defineProperty({},"passive",{get(){_supportsPassive=!0}});window$1.addEventListener("test",null,i),window$1.removeEventListener("test",null,i)}catch{}}return _supportsPassive},passiveEvents=["touchstart","touchmove"];function on(i,e,t){if(Array.isArray(e))return _handleMultipleEvents(on,i,e,t);DomData.has(i)||DomData.set(i,{});const n=DomData.get(i);if(n.handlers||(n.handlers={}),n.handlers[e]||(n.handlers[e]=[]),t.guid||(t.guid=newGUID()),n.handlers[e].push(t),n.dispatcher||(n.disabled=!1,n.dispatcher=function(r,s){if(n.disabled)return;r=fixEvent(r);const a=n.handlers[r.type];if(a){const l=a.slice(0);for(let u=0,d=l.length;u<d&&!r.isImmediatePropagationStopped();u++)try{l[u].call(i,r,s)}catch(h){log$1.error(h)}}}),n.handlers[e].length===1)if(i.addEventListener){let r=!1;supportsPassive()&&passiveEvents.indexOf(e)>-1&&(r={passive:!0}),i.addEventListener(e,n.dispatcher,r)}else i.attachEvent&&i.attachEvent("on"+e,n.dispatcher)}function off(i,e,t){if(!DomData.has(i))return;const n=DomData.get(i);if(!n.handlers)return;if(Array.isArray(e))return _handleMultipleEvents(off,i,e,t);const r=function(a,l){n.handlers[l]=[],_cleanUpEvents(a,l)};if(e===void 0){for(const a in n.handlers)Object.prototype.hasOwnProperty.call(n.handlers||{},a)&&r(i,a);return}const s=n.handlers[e];if(s){if(!t){r(i,e);return}if(t.guid)for(let a=0;a<s.length;a++)s[a].guid===t.guid&&s.splice(a--,1);_cleanUpEvents(i,e)}}function trigger(i,e,t){const n=DomData.has(i)?DomData.get(i):{},r=i.parentNode||i.ownerDocument;if(typeof e=="string"?e={type:e,target:i}:e.target||(e.target=i),e=fixEvent(e),n.dispatcher&&n.dispatcher.call(i,e,t),r&&!e.isPropagationStopped()&&e.bubbles===!0)trigger.call(null,r,e,t);else if(!r&&!e.defaultPrevented&&e.target&&e.target[e.type]){DomData.has(e.target)||DomData.set(e.target,{});const s=DomData.get(e.target);e.target[e.type]&&(s.disabled=!0,typeof e.target[e.type]=="function"&&e.target[e.type](),s.disabled=!1)}return!e.defaultPrevented}function one(i,e,t){if(Array.isArray(e))return _handleMultipleEvents(one,i,e,t);const n=function(){off(i,e,n),t.apply(this,arguments)};n.guid=t.guid=t.guid||newGUID(),on(i,e,n)}function any(i,e,t){const n=function(){off(i,e,n),t.apply(this,arguments)};n.guid=t.guid=t.guid||newGUID(),on(i,e,n)}var Events=Object.freeze({__proto__:null,fixEvent,on,off,trigger,one,any});const UPDATE_REFRESH_INTERVAL=30,bind_=function(i,e,t){e.guid||(e.guid=newGUID());const n=e.bind(i);return n.guid=t?t+"_"+e.guid:e.guid,n},throttle=function(i,e){let t=window$1.performance.now();return function(...r){const s=window$1.performance.now();s-t>=e&&(i(...r),t=s)}},debounce$1=function(i,e,t,n=window$1){let r;const s=()=>{n.clearTimeout(r),r=null},a=function(){const l=this,u=arguments;let d=function(){r=null,d=null,t||i.apply(l,u)};!r&&t&&i.apply(l,u),n.clearTimeout(r),r=n.setTimeout(d,e)};return a.cancel=s,a};var Fn=Object.freeze({__proto__:null,UPDATE_REFRESH_INTERVAL,bind_,throttle,debounce:debounce$1});let EVENT_MAP;class EventTarget$2{on(e,t){const n=this.addEventListener;this.addEventListener=()=>{},on(this,e,t),this.addEventListener=n}off(e,t){off(this,e,t)}one(e,t){const n=this.addEventListener;this.addEventListener=()=>{},one(this,e,t),this.addEventListener=n}any(e,t){const n=this.addEventListener;this.addEventListener=()=>{},any(this,e,t),this.addEventListener=n}trigger(e){const t=e.type||e;typeof e=="string"&&(e={type:t}),e=fixEvent(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),trigger(this,e)}queueTrigger(e){EVENT_MAP||(EVENT_MAP=new Map);const t=e.type||e;let n=EVENT_MAP.get(this);n||(n=new Map,EVENT_MAP.set(this,n));const r=n.get(t);n.delete(t),window$1.clearTimeout(r);const s=window$1.setTimeout(()=>{n.delete(t),n.size===0&&(n=null,EVENT_MAP.delete(this)),this.trigger(e)},0);n.set(t,s)}}EventTarget$2.prototype.allowedEvents_={};EventTarget$2.prototype.addEventListener=EventTarget$2.prototype.on;EventTarget$2.prototype.removeEventListener=EventTarget$2.prototype.off;EventTarget$2.prototype.dispatchEvent=EventTarget$2.prototype.trigger;const objName=i=>typeof i.name=="function"?i.name():typeof i.name=="string"?i.name:i.name_?i.name_:i.constructor&&i.constructor.name?i.constructor.name:typeof i,isEvented=i=>i instanceof EventTarget$2||!!i.eventBusEl_&&["on","one","off","trigger"].every(e=>typeof i[e]=="function"),addEventedCallback=(i,e)=>{isEvented(i)?e():(i.eventedCallbacks||(i.eventedCallbacks=[]),i.eventedCallbacks.push(e))},isValidEventType=i=>typeof i=="string"&&/\S/.test(i)||Array.isArray(i)&&!!i.length,validateTarget=(i,e,t)=>{if(!i||!i.nodeName&&!isEvented(i))throw new Error(`Invalid target for ${objName(e)}#${t}; must be a DOM node or evented object.`)},validateEventType=(i,e,t)=>{if(!isValidEventType(i))throw new Error(`Invalid event type for ${objName(e)}#${t}; must be a non-empty string or array.`)},validateListener=(i,e,t)=>{if(typeof i!="function")throw new Error(`Invalid listener for ${objName(e)}#${t}; must be a function.`)},normalizeListenArgs=(i,e,t)=>{const n=e.length<3||e[0]===i||e[0]===i.eventBusEl_;let r,s,a;return n?(r=i.eventBusEl_,e.length>=3&&e.shift(),[s,a]=e):(r=e[0],s=e[1],a=e[2]),validateTarget(r,i,t),validateEventType(s,i,t),validateListener(a,i,t),a=bind_(i,a),{isTargetingSelf:n,target:r,type:s,listener:a}},listen=(i,e,t,n)=>{validateTarget(i,i,e),i.nodeName?Events[e](i,t,n):i[e](t,n)},EventedMixin={on(...i){const{isTargetingSelf:e,target:t,type:n,listener:r}=normalizeListenArgs(this,i,"on");if(listen(t,"on",n,r),!e){const s=()=>this.off(t,n,r);s.guid=r.guid;const a=()=>this.off("dispose",s);a.guid=r.guid,listen(this,"on","dispose",s),listen(t,"on","dispose",a)}},one(...i){const{isTargetingSelf:e,target:t,type:n,listener:r}=normalizeListenArgs(this,i,"one");if(e)listen(t,"one",n,r);else{const s=(...a)=>{this.off(t,n,s),r.apply(null,a)};s.guid=r.guid,listen(t,"one",n,s)}},any(...i){const{isTargetingSelf:e,target:t,type:n,listener:r}=normalizeListenArgs(this,i,"any");if(e)listen(t,"any",n,r);else{const s=(...a)=>{this.off(t,n,s),r.apply(null,a)};s.guid=r.guid,listen(t,"any",n,s)}},off(i,e,t){if(!i||isValidEventType(i))off(this.eventBusEl_,i,e);else{const n=i,r=e;validateTarget(n,this,"off"),validateEventType(r,this,"off"),validateListener(t,this,"off"),t=bind_(this,t),this.off("dispose",t),n.nodeName?(off(n,r,t),off(n,"dispose",t)):isEvented(n)&&(n.off(r,t),n.off("dispose",t))}},trigger(i,e){validateTarget(this.eventBusEl_,this,"trigger");const t=i&&typeof i!="string"?i.type:i;if(!isValidEventType(t))throw new Error(`Invalid event type for ${objName(this)}#trigger; must be a non-empty string or object with a type key that has a non-empty value.`);return trigger(this.eventBusEl_,i,e)}};function evented(i,e={}){const{eventBusKey:t}=e;if(t){if(!i[t].nodeName)throw new Error(`The eventBusKey "${t}" does not refer to an element.`);i.eventBusEl_=i[t]}else i.eventBusEl_=createEl("span",{className:"vjs-event-bus"});return Object.assign(i,EventedMixin),i.eventedCallbacks&&i.eventedCallbacks.forEach(n=>{n()}),i.on("dispose",()=>{i.off(),[i,i.el_,i.eventBusEl_].forEach(function(n){n&&DomData.has(n)&&DomData.delete(n)}),window$1.setTimeout(()=>{i.eventBusEl_=null},0)}),i}const StatefulMixin={state:{},setState(i){typeof i=="function"&&(i=i());let e;return each(i,(t,n)=>{this.state[n]!==t&&(e=e||{},e[n]={from:this.state[n],to:t}),this.state[n]=t}),e&&isEvented(this)&&this.trigger({changes:e,type:"statechanged"}),e}};function stateful(i,e){return Object.assign(i,StatefulMixin),i.state=Object.assign({},i.state,e),typeof i.handleStateChanged=="function"&&isEvented(i)&&i.on("statechanged",i.handleStateChanged),i}const toLowerCase=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toLowerCase())},toTitleCase$1=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toUpperCase())},titleCaseEquals=function(i,e){return toTitleCase$1(i)===toTitleCase$1(e)};var Str=Object.freeze({__proto__:null,toLowerCase,toTitleCase:toTitleCase$1,titleCaseEquals});class Component$1{constructor(e,t,n){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=merge$1({},this.options_),t=this.options_=merge$1(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const r=e&&e.id&&e.id()||"no_player";this.id_=`${r}_component_${newGUID()}`}this.name_=t.name||null,t.el?this.el_=t.el:t.createEl!==!1&&(this.el_=this.createEl()),t.className&&this.el_&&t.className.split(" ").forEach(r=>this.addClass(r)),["on","off","one","any","trigger"].forEach(r=>{this[r]=void 0}),t.evented!==!1&&(evented(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),stateful(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Set,this.setIntervalIds_=new Set,this.rafIds_=new Set,this.namedRafs_=new Map,this.clearingTimersOnDispose_=!1,t.initChildren!==!1&&this.initChildren(),this.ready(n),t.reportTouchActivity!==!1&&this.enableTouchActivity()}dispose(e={}){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let t=this.children_.length-1;t>=0;t--)this.children_[t].dispose&&this.children_[t].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(e.restoreEl?this.el_.parentNode.replaceChild(e.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}}isDisposed(){return!!this.isDisposed_}player(){return this.player_}options(e){return e?(this.options_=merge$1(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,n){return createEl(e,t,n)}localize(e,t,n=e){const r=this.player_.language&&this.player_.language(),s=this.player_.languages&&this.player_.languages(),a=s&&s[r],l=r&&r.split("-")[0],u=s&&s[l];let d=n;return a&&a[e]?d=a[e]:u&&u[e]&&(d=u[e]),t&&(d=d.replace(/\{(\d+)\}/g,function(h,p){const m=t[p-1];let g=m;return typeof m>"u"&&(g=h),g})),d}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce((n,r)=>n.concat(r),[]);let t=this;for(let n=0;n<e.length;n++)if(t=t.getChild(e[n]),!t||!t.getChild)return;return t}setIcon(e,t=this.el()){if(!this.player_.options_.experimentalSvgIcons)return;const n="http://www.w3.org/2000/svg",r=createEl("span",{className:"vjs-icon-placeholder vjs-svg-icon"},{"aria-hidden":"true"}),s=document$1.createElementNS(n,"svg");s.setAttributeNS(null,"viewBox","0 0 512 512");const a=document$1.createElementNS(n,"use");return s.appendChild(a),a.setAttributeNS(null,"href",`#vjs-icon-${e}`),r.appendChild(s),this.iconIsSet_?t.replaceChild(r,t.querySelector(".vjs-icon-placeholder")):t.appendChild(r),this.iconIsSet_=!0,r}addChild(e,t={},n=this.children_.length){let r,s;if(typeof e=="string"){s=toTitleCase$1(e);const a=t.componentClass||s;t.name=s;const l=Component$1.getComponent(a);if(!l)throw new Error(`Component ${a} does not exist`);if(typeof l!="function")return null;r=new l(this.player_||this,t)}else r=e;if(r.parentComponent_&&r.parentComponent_.removeChild(r),this.children_.splice(n,0,r),r.parentComponent_=this,typeof r.id=="function"&&(this.childIndex_[r.id()]=r),s=s||r.name&&toTitleCase$1(r.name()),s&&(this.childNameIndex_[s]=r,this.childNameIndex_[toLowerCase(s)]=r),typeof r.el=="function"&&r.el()){let a=null;this.children_[n+1]&&(this.children_[n+1].el_?a=this.children_[n+1].el_:isEl(this.children_[n+1])&&(a=this.children_[n+1])),this.contentEl().insertBefore(r.el(),a)}return r}removeChild(e){if(typeof e=="string"&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let r=this.children_.length-1;r>=0;r--)if(this.children_[r]===e){t=!0,this.children_.splice(r,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[toTitleCase$1(e.name())]=null,this.childNameIndex_[toLowerCase(e.name())]=null;const n=e.el();n&&n.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,n=a=>{const l=a.name;let u=a.opts;if(t[l]!==void 0&&(u=t[l]),u===!1)return;u===!0&&(u={}),u.playerOptions=this.options_.playerOptions;const d=this.addChild(l,u);d&&(this[l]=d)};let r;const s=Component$1.getComponent("Tech");Array.isArray(e)?r=e:r=Object.keys(e),r.concat(Object.keys(this.options_).filter(function(a){return!r.some(function(l){return typeof l=="string"?a===l:a===l.name})})).map(a=>{let l,u;return typeof a=="string"?(l=a,u=e[l]||this.options_[l]||{}):(l=a.name,u=a),{name:l,opts:u}}).filter(a=>{const l=Component$1.getComponent(a.opts.componentClass||toTitleCase$1(a.name));return l&&!s.isTech(l)}).forEach(n)}}buildCSSClass(){return""}ready(e,t=!1){if(e){if(!this.isReady_){this.readyQueue_=this.readyQueue_||[],this.readyQueue_.push(e);return}t?e.call(this):this.setTimeout(e,1)}}triggerReady(){this.isReady_=!0,this.setTimeout(function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(t){t.call(this)},this),this.trigger("ready")},1)}$(e,t){return $(e,t||this.contentEl())}$$(e,t){return $$(e,t||this.contentEl())}hasClass(e){return hasClass(this.el_,e)}addClass(...e){addClass(this.el_,...e)}removeClass(...e){removeClass(this.el_,...e)}toggleClass(e,t){toggleClass(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return getAttribute(this.el_,e)}setAttribute(e,t){setAttribute(this.el_,e,t)}removeAttribute(e){removeAttribute(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,n){if(t!==void 0){(t===null||t!==t)&&(t=0),(""+t).indexOf("%")!==-1||(""+t).indexOf("px")!==-1?this.el_.style[e]=t:t==="auto"?this.el_.style[e]="":this.el_.style[e]=t+"px",n||this.trigger("componentresize");return}if(!this.el_)return 0;const r=this.el_.style[e],s=r.indexOf("px");return parseInt(s!==-1?r.slice(0,s):this.el_["offset"+toTitleCase$1(e)],10)}currentDimension(e){let t=0;if(e!=="width"&&e!=="height")throw new Error("currentDimension only accepts width or height value");if(t=computedStyle(this.el_,e),t=parseFloat(t),t===0||isNaN(t)){const n=`offset${toTitleCase$1(e)}`;t=this.el_[n]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}getPositions(){const e=this.el_.getBoundingClientRect(),t={x:e.x,y:e.y,width:e.width,height:e.height,top:e.top,right:e.right,bottom:e.bottom,left:e.left},n={x:e.left+e.width/2,y:e.top+e.height/2,width:0,height:0,top:e.top+e.height/2,right:e.left+e.width/2,bottom:e.top+e.height/2,left:e.left+e.width/2};return{boundingClientRect:t,center:n}}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&(e.key!=="Tab"&&!(this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled)&&e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;const n=10,r=200;let s;this.on("touchstart",function(l){l.touches.length===1&&(t={pageX:l.touches[0].pageX,pageY:l.touches[0].pageY},e=window$1.performance.now(),s=!0)}),this.on("touchmove",function(l){if(l.touches.length>1)s=!1;else if(t){const u=l.touches[0].pageX-t.pageX,d=l.touches[0].pageY-t.pageY;Math.sqrt(u*u+d*d)>n&&(s=!1)}});const a=function(){s=!1};this.on("touchleave",a),this.on("touchcancel",a),this.on("touchend",function(l){t=null,s===!0&&window$1.performance.now()-e<r&&(l.preventDefault(),this.trigger("tap"))})}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=bind_(this.player(),this.player().reportUserActivity);let t;this.on("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)});const n=function(r){e(),this.clearInterval(t)};this.on("touchmove",e),this.on("touchend",n),this.on("touchcancel",n)}setTimeout(e,t){var n;return e=bind_(this,e),this.clearTimersOnDispose_(),n=window$1.setTimeout(()=>{this.setTimeoutIds_.has(n)&&this.setTimeoutIds_.delete(n),e()},t),this.setTimeoutIds_.add(n),n}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),window$1.clearTimeout(e)),e}setInterval(e,t){e=bind_(this,e),this.clearTimersOnDispose_();const n=window$1.setInterval(e,t);return this.setIntervalIds_.add(n),n}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),window$1.clearInterval(e)),e}requestAnimationFrame(e){this.clearTimersOnDispose_();var t;return e=bind_(this,e),t=window$1.requestAnimationFrame(()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()}),this.rafIds_.add(t),t}requestNamedAnimationFrame(e,t){this.namedRafs_.has(e)&&this.cancelNamedAnimationFrame(e),this.clearTimersOnDispose_(),t=bind_(this,t);const n=this.requestAnimationFrame(()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)});return this.namedRafs_.set(e,n),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.rafIds_.has(e)&&(this.rafIds_.delete(e),window$1.cancelAnimationFrame(e)),e}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(([e,t])=>{this[e].forEach((n,r)=>this[t](r))}),this.clearingTimersOnDispose_=!1}))}getIsDisabled(){return!!this.el_.disabled}getIsExpresslyInert(){return this.el_.inert&&!this.el_.ownerDocument.documentElement.inert}getIsFocusable(e){return(e||this.el_).tabIndex>=0&&!(this.getIsDisabled()||this.getIsExpresslyInert())}getIsAvailableToBeFocused(e){function t(s){const a=window$1.getComputedStyle(s,null),l=a.getPropertyValue("visibility");return a.getPropertyValue("display")!=="none"&&!["hidden","collapse"].includes(l)}function n(s){return!(!t(s.parentElement)||!t(s)||s.style.opacity==="0"||window$1.getComputedStyle(s).height==="0px"||window$1.getComputedStyle(s).width==="0px")}function r(s){if(s.offsetWidth+s.offsetHeight+s.getBoundingClientRect().height+s.getBoundingClientRect().width===0)return!1;const a={x:s.getBoundingClientRect().left+s.offsetWidth/2,y:s.getBoundingClientRect().top+s.offsetHeight/2};if(a.x<0||a.x>(document$1.documentElement.clientWidth||window$1.innerWidth)||a.y<0||a.y>(document$1.documentElement.clientHeight||window$1.innerHeight))return!1;let l=document$1.elementFromPoint(a.x,a.y);for(;l;){if(l===s)return!0;if(l.parentNode)l=l.parentNode;else return!1}}return e||(e=this.el()),!!(r(e)&&n(e)&&(!e.parentElement||e.tabIndex>=0))}static registerComponent(e,t){if(typeof e!="string"||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const n=Component$1.getComponent("Tech"),r=n&&n.isTech(t),s=Component$1===t||Component$1.prototype.isPrototypeOf(t.prototype);if(r||!s){let l;throw r?l="techs must be registered using Tech.registerTech()":l="must be a Component subclass",new Error(`Illegal component, "${e}"; ${l}.`)}e=toTitleCase$1(e),Component$1.components_||(Component$1.components_={});const a=Component$1.getComponent("Player");if(e==="Player"&&a&&a.players){const l=a.players,u=Object.keys(l);if(l&&u.length>0){for(let d=0;d<u.length;d++)if(l[u[d]]!==null)throw new Error("Can not register Player component after player has been created.")}}return Component$1.components_[e]=t,Component$1.components_[toLowerCase(e)]=t,t}static getComponent(e){if(!(!e||!Component$1.components_))return Component$1.components_[e]}}Component$1.registerComponent("Component",Component$1);function rangeCheck(i,e,t){if(typeof e!="number"||e<0||e>t)throw new Error(`Failed to execute '${i}' on 'TimeRanges': The index provided (${e}) is non-numeric or out of bounds (0-${t}).`)}function getRange(i,e,t,n){return rangeCheck(i,n,t.length-1),t[n][e]}function createTimeRangesObj(i){let e;return i===void 0||i.length===0?e={length:0,start(){throw new Error("This TimeRanges object is empty")},end(){throw new Error("This TimeRanges object is empty")}}:e={length:i.length,start:getRange.bind(null,"start",0,i),end:getRange.bind(null,"end",1,i)},window$1.Symbol&&window$1.Symbol.iterator&&(e[window$1.Symbol.iterator]=()=>(i||[]).values()),e}function createTimeRanges$1(i,e){return Array.isArray(i)?createTimeRangesObj(i):i===void 0||e===void 0?createTimeRangesObj():createTimeRangesObj([[i,e]])}const defaultImplementation=function(i,e){i=i<0?0:i;let t=Math.floor(i%60),n=Math.floor(i/60%60),r=Math.floor(i/3600);const s=Math.floor(e/60%60),a=Math.floor(e/3600);return(isNaN(i)||i===1/0)&&(r=n=t="-"),r=r>0||a>0?r+":":"",n=((r||s>=10)&&n<10?"0"+n:n)+":",t=t<10?"0"+t:t,r+n+t};let implementation=defaultImplementation;function setFormatTime(i){implementation=i}function resetFormatTime(){implementation=defaultImplementation}function formatTime(i,e=i){return implementation(i,e)}var Time=Object.freeze({__proto__:null,createTimeRanges:createTimeRanges$1,createTimeRange:createTimeRanges$1,setFormatTime,resetFormatTime,formatTime});function bufferedPercent(i,e){let t=0,n,r;if(!e)return 0;(!i||!i.length)&&(i=createTimeRanges$1(0,0));for(let s=0;s<i.length;s++)n=i.start(s),r=i.end(s),r>e&&(r=e),t+=r-n;return t/e}function MediaError(i){if(i instanceof MediaError)return i;typeof i=="number"?this.code=i:typeof i=="string"?this.message=i:isObject(i)&&(typeof i.code=="number"&&(this.code=i.code),Object.assign(this,i)),this.message||(this.message=MediaError.defaultMessages[this.code]||"")}MediaError.prototype.code=0;MediaError.prototype.message="";MediaError.prototype.status=null;MediaError.prototype.metadata=null;MediaError.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"];MediaError.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};MediaError.MEDIA_ERR_CUSTOM=0;MediaError.prototype.MEDIA_ERR_CUSTOM=0;MediaError.MEDIA_ERR_ABORTED=1;MediaError.prototype.MEDIA_ERR_ABORTED=1;MediaError.MEDIA_ERR_NETWORK=2;MediaError.prototype.MEDIA_ERR_NETWORK=2;MediaError.MEDIA_ERR_DECODE=3;MediaError.prototype.MEDIA_ERR_DECODE=3;MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED=4;MediaError.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED=4;MediaError.MEDIA_ERR_ENCRYPTED=5;MediaError.prototype.MEDIA_ERR_ENCRYPTED=5;function isPromise(i){return i!=null&&typeof i.then=="function"}function silencePromise(i){isPromise(i)&&i.then(null,e=>{})}const trackToJson=function(i){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce((t,n,r)=>(i[n]&&(t[n]=i[n]),t),{cues:i.cues&&Array.prototype.map.call(i.cues,function(t){return{startTime:t.startTime,endTime:t.endTime,text:t.text,id:t.id}})})},textTracksToJson=function(i){const e=i.$$("track"),t=Array.prototype.map.call(e,r=>r.track);return Array.prototype.map.call(e,function(r){const s=trackToJson(r.track);return r.src&&(s.src=r.src),s}).concat(Array.prototype.filter.call(i.textTracks(),function(r){return t.indexOf(r)===-1}).map(trackToJson))},jsonToTextTracks=function(i,e){return i.forEach(function(t){const n=e.addRemoteTextTrack(t).track;!t.src&&t.cues&&t.cues.forEach(r=>n.addCue(r))}),e.textTracks()};var textTrackConverter={textTracksToJson,jsonToTextTracks,trackToJson};const MODAL_CLASS_NAME="vjs-modal-dialog";class ModalDialog extends Component$1{constructor(e,t){super(e,t),this.handleKeyDown_=n=>this.handleKeyDown(n),this.close_=n=>this.close(n),this.opened_=this.hasBeenOpened_=this.hasBeenFilled_=!1,this.closeable(!this.options_.uncloseable),this.content(this.options_.content),this.contentEl_=createEl("div",{className:`${MODAL_CLASS_NAME}-content`},{role:"document"}),this.descEl_=createEl("p",{className:`${MODAL_CLASS_NAME}-description vjs-control-text`,id:this.el().getAttribute("aria-describedby")}),textContent(this.descEl_,this.description()),this.el_.appendChild(this.descEl_),this.el_.appendChild(this.contentEl_)}createEl(){return super.createEl("div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":`${this.id()}_description`,"aria-hidden":"true","aria-label":this.label(),role:"dialog","aria-live":"polite"})}dispose(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,super.dispose()}buildCSSClass(){return`${MODAL_CLASS_NAME} vjs-hidden ${super.buildCSSClass()}`}label(){return this.localize(this.options_.label||"Modal Window")}description(){let e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e}open(){if(this.opened_){this.options_.fillAlways&&this.fill();return}const e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}opened(e){return typeof e=="boolean"&&this[e?"open":"close"](),this.opened_}close(){if(!this.opened_)return;const e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger({type:"modalclose",bubbles:!0}),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}closeable(e){if(typeof e=="boolean"){const t=this.closeable_=!!e;let n=this.getChild("closeButton");if(t&&!n){const r=this.contentEl_;this.contentEl_=this.el_,n=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=r,this.on(n,"close",this.close_)}!t&&n&&(this.off(n,"close",this.close_),this.removeChild(n),n.dispose())}return this.closeable_}fill(){this.fillWith(this.content())}fillWith(e){const t=this.contentEl(),n=t.parentNode,r=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,n.removeChild(t),this.empty(),insertContent(t,e),this.trigger("modalfill"),r?n.insertBefore(t,r):n.appendChild(t);const s=this.getChild("closeButton");s&&n.appendChild(s.el_),this.trigger("aftermodalfill")}empty(){this.trigger("beforemodalempty"),emptyEl(this.contentEl()),this.trigger("modalempty")}content(e){return typeof e<"u"&&(this.content_=e),this.content_}conditionalFocus_(){const e=document$1.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())}conditionalBlur_(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)}handleKeyDown(e){if(this.trigger({type:"modalKeydown",originalEvent:e,target:this,bubbles:!0}),e.stopPropagation(),e.key==="Escape"&&this.closeable()){e.preventDefault(),this.close();return}if(e.key!=="Tab")return;const t=this.focusableEls_(),n=this.el_.querySelector(":focus");let r;for(let s=0;s<t.length;s++)if(n===t[s]){r=s;break}document$1.activeElement===this.el_&&(r=0),e.shiftKey&&r===0?(t[t.length-1].focus(),e.preventDefault()):!e.shiftKey&&r===t.length-1&&(t[0].focus(),e.preventDefault())}focusableEls_(){const e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,t=>(t instanceof window$1.HTMLAnchorElement||t instanceof window$1.HTMLAreaElement)&&t.hasAttribute("href")||(t instanceof window$1.HTMLInputElement||t instanceof window$1.HTMLSelectElement||t instanceof window$1.HTMLTextAreaElement||t instanceof window$1.HTMLButtonElement)&&!t.hasAttribute("disabled")||t instanceof window$1.HTMLIFrameElement||t instanceof window$1.HTMLObjectElement||t instanceof window$1.HTMLEmbedElement||t.hasAttribute("tabindex")&&t.getAttribute("tabindex")!==-1||t.hasAttribute("contenteditable"))}}ModalDialog.prototype.options_={pauseOnOpen:!0,temporary:!0};Component$1.registerComponent("ModalDialog",ModalDialog);class TrackList extends EventTarget$2{constructor(e=[]){super(),this.tracks_=[],Object.defineProperty(this,"length",{get(){return this.tracks_.length}});for(let t=0;t<e.length;t++)this.addTrack(e[t])}addTrack(e){const t=this.tracks_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.tracks_[t]}}),this.tracks_.indexOf(e)===-1&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=()=>{this.trigger({track:e,type:"labelchange",target:this})},isEvented(e)&&e.addEventListener("labelchange",e.labelchange_)}removeTrack(e){let t;for(let n=0,r=this.length;n<r;n++)if(this[n]===e){t=this[n],t.off&&t.off(),this.tracks_.splice(n,1);break}t&&this.trigger({track:t,type:"removetrack",target:this})}getTrackById(e){let t=null;for(let n=0,r=this.length;n<r;n++){const s=this[n];if(s.id===e){t=s;break}}return t}}TrackList.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"};for(const i in TrackList.prototype.allowedEvents_)TrackList.prototype["on"+i]=null;const disableOthers$1=function(i,e){for(let t=0;t<i.length;t++)!Object.keys(i[t]).length||e.id===i[t].id||(i[t].enabled=!1)};class AudioTrackList extends TrackList{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].enabled){disableOthers$1(e,e[t]);break}super(e),this.changing_=!1}addTrack(e){e.enabled&&disableOthers$1(this,e),super.addTrack(e),e.addEventListener&&(e.enabledChange_=()=>{this.changing_||(this.changing_=!0,disableOthers$1(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)}}const disableOthers=function(i,e){for(let t=0;t<i.length;t++)!Object.keys(i[t]).length||e.id===i[t].id||(i[t].selected=!1)};class VideoTrackList extends TrackList{constructor(e=[]){for(let t=e.length-1;t>=0;t--)if(e[t].selected){disableOthers(e,e[t]);break}super(e),this.changing_=!1,Object.defineProperty(this,"selectedIndex",{get(){for(let t=0;t<this.length;t++)if(this[t].selected)return t;return-1},set(){}})}addTrack(e){e.selected&&disableOthers(this,e),super.addTrack(e),e.addEventListener&&(e.selectedChange_=()=>{this.changing_||(this.changing_=!0,disableOthers(this,e),this.changing_=!1,this.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))}removeTrack(e){super.removeTrack(e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)}}class TextTrackList extends TrackList{addTrack(e){super.addTrack(e),this.queueChange_||(this.queueChange_=()=>this.queueTrigger("change")),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=()=>this.trigger("selectedlanguagechange")),e.addEventListener("modechange",this.queueChange_),["metadata","chapters"].indexOf(e.kind)===-1&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)}removeTrack(e){super.removeTrack(e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))}toJSON(){return this.tracks_.map(e=>e.toJSON())}}class HtmlTrackElementList{constructor(e=[]){this.trackElements_=[],Object.defineProperty(this,"length",{get(){return this.trackElements_.length}});for(let t=0,n=e.length;t<n;t++)this.addTrackElement_(e[t])}addTrackElement_(e){const t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get(){return this.trackElements_[t]}}),this.trackElements_.indexOf(e)===-1&&this.trackElements_.push(e)}getTrackElementByTrack_(e){let t;for(let n=0,r=this.trackElements_.length;n<r;n++)if(e===this.trackElements_[n].track){t=this.trackElements_[n];break}return t}removeTrackElement_(e){for(let t=0,n=this.trackElements_.length;t<n;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&typeof this.trackElements_[t].track.off=="function"&&this.trackElements_[t].track.off(),typeof this.trackElements_[t].off=="function"&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}}}class TextTrackCueList{constructor(e){TextTrackCueList.prototype.setCues_.call(this,e),Object.defineProperty(this,"length",{get(){return this.length_}})}setCues_(e){const t=this.length||0;let n=0;const r=e.length;this.cues_=e,this.length_=e.length;const s=function(a){""+a in this||Object.defineProperty(this,""+a,{get(){return this.cues_[a]}})};if(t<r)for(n=t;n<r;n++)s.call(this,n)}getCueById(e){let t=null;for(let n=0,r=this.length;n<r;n++){const s=this[n];if(s.id===e){t=s;break}}return t}}const VideoTrackKind={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},AudioTrackKind={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},TextTrackKind={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},TextTrackMode={disabled:"disabled",hidden:"hidden",showing:"showing"};class Track extends EventTarget$2{constructor(e={}){super();const t={id:e.id||"vjs_track_"+newGUID(),kind:e.kind||"",language:e.language||""};let n=e.label||"";for(const r in t)Object.defineProperty(this,r,{get(){return t[r]},set(){}});Object.defineProperty(this,"label",{get(){return n},set(r){r!==n&&(n=r,this.trigger("labelchange"))}})}}const parseUrl=function(i){return new URL(i,document$1.baseURI)},getAbsoluteURL=function(i){return new URL(i,document$1.baseURI).href},getFileExtension=function(i){if(typeof i=="string"){const t=i.split("?")[0].replace(/\/+$/,"").match(/\.([^.\/]+)$/);return t?t[1].toLowerCase():""}return""},isCrossOrigin=function(i,e=window$1.location){return parseUrl(i).origin!==e.origin};var Url=Object.freeze({__proto__:null,parseUrl,getAbsoluteURL,getFileExtension,isCrossOrigin});const parseCues=function(i,e){const t=new window$1.WebVTT.Parser(window$1,window$1.vttjs,window$1.WebVTT.StringDecoder()),n=[];t.oncue=function(r){e.addCue(r)},t.onparsingerror=function(r){n.push(r)},t.onflush=function(){e.trigger({type:"loadeddata",target:e})},t.parse(i),n.length>0&&(window$1.console&&window$1.console.groupCollapsed&&window$1.console.groupCollapsed(`Text Track parsing errors for ${e.src}`),n.forEach(r=>log$1.error(r)),window$1.console&&window$1.console.groupEnd&&window$1.console.groupEnd()),t.flush()},loadTrack=function(i,e){const t={uri:i},n=isCrossOrigin(i);n&&(t.cors=n);const r=e.tech_.crossOrigin()==="use-credentials";r&&(t.withCredentials=r),XHR(t,bind_(this,function(s,a,l){if(s)return log$1.error(s,a);e.loaded_=!0,typeof window$1.WebVTT!="function"?e.tech_&&e.tech_.any(["vttjsloaded","vttjserror"],u=>{if(u.type==="vttjserror"){log$1.error(`vttjs failed to load, stopping trying to process ${e.src}`);return}return parseCues(l,e)}):parseCues(l,e)}))};class TextTrack extends Track{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const t=merge$1(e,{kind:TextTrackKind[e.kind]||"subtitles",language:e.language||e.srclang||""});let n=TextTrackMode[t.mode]||"disabled";const r=t.default;(t.kind==="metadata"||t.kind==="chapters")&&(n="hidden"),super(t),this.tech_=t.tech,this.cues_=[],this.activeCues_=[],this.preload_=this.tech_.preloadTextTracks!==!1;const s=new TextTrackCueList(this.cues_),a=new TextTrackCueList(this.activeCues_);let l=!1;this.timeupdateHandler=bind_(this,function(d={}){if(!this.tech_.isDisposed()){if(!this.tech_.isReady_){d.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler));return}this.activeCues=this.activeCues,l&&(this.trigger("cuechange"),l=!1),d.type!=="timeupdate"&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}});const u=()=>{this.stopTracking()};this.tech_.one("dispose",u),n!=="disabled"&&this.startTracking(),Object.defineProperties(this,{default:{get(){return r},set(){}},mode:{get(){return n},set(d){TextTrackMode[d]&&n!==d&&(n=d,!this.preload_&&n!=="disabled"&&this.cues.length===0&&loadTrack(this.src,this),this.stopTracking(),n!=="disabled"&&this.startTracking(),this.trigger("modechange"))}},cues:{get(){return this.loaded_?s:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(this.cues.length===0)return a;const d=this.tech_.currentTime(),h=[];for(let p=0,m=this.cues.length;p<m;p++){const g=this.cues[p];g.startTime<=d&&g.endTime>=d&&h.push(g)}if(l=!1,h.length!==this.activeCues_.length)l=!0;else for(let p=0;p<h.length;p++)this.activeCues_.indexOf(h[p])===-1&&(l=!0);return this.activeCues_=h,a.setCues_(this.activeCues_),a},set(){}}}),t.src?(this.src=t.src,this.preload_||(this.loaded_=!0),(this.preload_||t.kind!=="subtitles"&&t.kind!=="captions")&&loadTrack(this.src,this)):this.loaded_=!0}startTracking(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)}stopTracking(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)}addCue(e){let t=e;if(!("getCueAsHTML"in t)){t=new window$1.vttjs.VTTCue(e.startTime,e.endTime,e.text);for(const r in e)r in t||(t[r]=e[r]);t.id=e.id,t.originalCue_=e}const n=this.tech_.textTracks();for(let r=0;r<n.length;r++)n[r]!==this&&n[r].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)}toJSON(){return textTrackConverter.trackToJson(this)}removeCue(e){let t=this.cues_.length;for(;t--;){const n=this.cues_[t];if(n===e||n.originalCue_&&n.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}TextTrack.prototype.allowedEvents_={cuechange:"cuechange"};class AudioTrack extends Track{constructor(e={}){const t=merge$1(e,{kind:AudioTrackKind[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"enabled",{get(){return n},set(r){typeof r!="boolean"||r===n||(n=r,this.trigger("enabledchange"))}}),t.enabled&&(this.enabled=t.enabled),this.loaded_=!0}}class VideoTrack extends Track{constructor(e={}){const t=merge$1(e,{kind:VideoTrackKind[e.kind]||""});super(t);let n=!1;Object.defineProperty(this,"selected",{get(){return n},set(r){typeof r!="boolean"||r===n||(n=r,this.trigger("selectedchange"))}}),t.selected&&(this.selected=t.selected)}}class HTMLTrackElement extends EventTarget$2{constructor(e={}){super();let t;const n=new TextTrack(e);this.kind=n.kind,this.src=n.src,this.srclang=n.language,this.label=n.label,this.default=n.default,Object.defineProperties(this,{readyState:{get(){return t}},track:{get(){return n}}}),t=HTMLTrackElement.NONE,n.addEventListener("loadeddata",()=>{t=HTMLTrackElement.LOADED,this.trigger({type:"load",target:this})})}}HTMLTrackElement.prototype.allowedEvents_={load:"load"};HTMLTrackElement.NONE=0;HTMLTrackElement.LOADING=1;HTMLTrackElement.LOADED=2;HTMLTrackElement.ERROR=3;const NORMAL={audio:{ListClass:AudioTrackList,TrackClass:AudioTrack,capitalName:"Audio"},video:{ListClass:VideoTrackList,TrackClass:VideoTrack,capitalName:"Video"},text:{ListClass:TextTrackList,TrackClass:TextTrack,capitalName:"Text"}};Object.keys(NORMAL).forEach(function(i){NORMAL[i].getterName=`${i}Tracks`,NORMAL[i].privateName=`${i}Tracks_`});const REMOTE={remoteText:{ListClass:TextTrackList,TrackClass:TextTrack,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:HtmlTrackElementList,TrackClass:HTMLTrackElement,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},ALL=Object.assign({},NORMAL,REMOTE);REMOTE.names=Object.keys(REMOTE);NORMAL.names=Object.keys(NORMAL);ALL.names=[].concat(REMOTE.names).concat(NORMAL.names);function createTrackHelper(i,e,t,n,r={}){const s=i.textTracks();r.kind=e,t&&(r.label=t),n&&(r.language=n),r.tech=i;const a=new ALL.text.TrackClass(r);return s.addTrack(a),a}class Tech extends Component$1{constructor(e={},t=function(){}){e.reportTouchActivity=!1,super(null,e,t),this.onDurationChange_=n=>this.onDurationChange(n),this.trackProgress_=n=>this.trackProgress(n),this.trackCurrentTime_=n=>this.trackCurrentTime(n),this.stopTrackingCurrentTime_=n=>this.stopTrackingCurrentTime(n),this.disposeSourceHandler_=n=>this.disposeSourceHandler(n),this.queuedHanders_=new Set,this.hasStarted_=!1,this.on("playing",function(){this.hasStarted_=!0}),this.on("loadstart",function(){this.hasStarted_=!1}),ALL.names.forEach(n=>{const r=ALL[n];e&&e[r.getterName]&&(this[r.privateName]=e[r.getterName])}),this.featuresProgressEvents||this.manualProgressOn(),this.featuresTimeupdateEvents||this.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(n=>{e[`native${n}Tracks`]===!1&&(this[`featuresNative${n}Tracks`]=!1)}),e.nativeCaptions===!1||e.nativeTextTracks===!1?this.featuresNativeTextTracks=!1:(e.nativeCaptions===!0||e.nativeTextTracks===!0)&&(this.featuresNativeTextTracks=!0),this.featuresNativeTextTracks||this.emulateTextTracks(),this.preloadTextTracks=e.preloadTextTracks!==!1,this.autoRemoteTextTracks_=new ALL.text.ListClass,this.initTrackListeners(),e.nativeControlsForTouch||this.emitTapEvents(),this.constructor&&(this.name_=this.constructor.name||"Unknown Tech")}triggerSourceset(e){this.isReady_||this.one("ready",()=>this.setTimeout(()=>this.triggerSourceset(e),1)),this.trigger({src:e,type:"sourceset"})}manualProgressOn(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)}manualProgressOff(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)}trackProgress(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(bind_(this,function(){const t=this.bufferedPercent();this.bufferedPercent_!==t&&this.trigger("progress"),this.bufferedPercent_=t,t===1&&this.stopTrackingProgress()}),500)}onDurationChange(e){this.duration_=this.duration()}buffered(){return createTimeRanges$1(0,0)}bufferedPercent(){return bufferedPercent(this.buffered(),this.duration_)}stopTrackingProgress(){this.clearInterval(this.progressInterval)}manualTimeUpdatesOn(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)}manualTimeUpdatesOff(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)}trackCurrentTime(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)}stopTrackingCurrentTime(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}dispose(){this.clearTracks(NORMAL.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),super.dispose()}clearTracks(e){e=[].concat(e),e.forEach(t=>{const n=this[`${t}Tracks`]()||[];let r=n.length;for(;r--;){const s=n[r];t==="text"&&this.removeRemoteTextTrack(s),n.removeTrack(s)}})}cleanupAutoTextTracks(){const e=this.autoRemoteTextTracks_||[];let t=e.length;for(;t--;){const n=e[t];this.removeRemoteTextTrack(n)}}reset(){}crossOrigin(){}setCrossOrigin(){}error(e){return e!==void 0&&(this.error_=new MediaError(e),this.trigger("error")),this.error_}played(){return this.hasStarted_?createTimeRanges$1(0,0):createTimeRanges$1()}play(){}setScrubbing(e){}scrubbing(){}setCurrentTime(e){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}initTrackListeners(){NORMAL.names.forEach(e=>{const t=NORMAL[e],n=()=>{this.trigger(`${e}trackchange`)},r=this[t.getterName]();r.addEventListener("removetrack",n),r.addEventListener("addtrack",n),this.on("dispose",()=>{r.removeEventListener("removetrack",n),r.removeEventListener("addtrack",n)})})}addWebVttScript_(){if(!window$1.WebVTT)if(document$1.body.contains(this.el())){if(!this.options_["vtt.js"]&&isPlain(vtt)&&Object.keys(vtt).length>0){this.trigger("vttjsloaded");return}const e=document$1.createElement("script");e.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",e.onload=()=>{this.trigger("vttjsloaded")},e.onerror=()=>{this.trigger("vttjserror")},this.on("dispose",()=>{e.onload=null,e.onerror=null}),window$1.WebVTT=!0,this.el().parentNode.appendChild(e)}else this.ready(this.addWebVttScript_)}emulateTextTracks(){const e=this.textTracks(),t=this.remoteTextTracks(),n=l=>e.addTrack(l.track),r=l=>e.removeTrack(l.track);t.on("addtrack",n),t.on("removetrack",r),this.addWebVttScript_();const s=()=>this.trigger("texttrackchange"),a=()=>{s();for(let l=0;l<e.length;l++){const u=e[l];u.removeEventListener("cuechange",s),u.mode==="showing"&&u.addEventListener("cuechange",s)}};a(),e.addEventListener("change",a),e.addEventListener("addtrack",a),e.addEventListener("removetrack",a),this.on("dispose",function(){t.off("addtrack",n),t.off("removetrack",r),e.removeEventListener("change",a),e.removeEventListener("addtrack",a),e.removeEventListener("removetrack",a);for(let l=0;l<e.length;l++)e[l].removeEventListener("cuechange",s)})}addTextTrack(e,t,n){if(!e)throw new Error("TextTrack kind is required but was not provided");return createTrackHelper(this,e,t,n)}createRemoteTextTrack(e){const t=merge$1(e,{tech:this});return new REMOTE.remoteTextEl.TrackClass(t)}addRemoteTextTrack(e={},t){const n=this.createRemoteTextTrack(e);return typeof t!="boolean"&&(t=!1),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),t===!1&&this.ready(()=>this.autoRemoteTextTracks_.addTrack(n.track)),n}removeRemoteTextTrack(e){const t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)}getVideoPlaybackQuality(){return{}}requestPictureInPicture(){return Promise.reject()}disablePictureInPicture(){return!0}setDisablePictureInPicture(){}requestVideoFrameCallback(e){const t=newGUID();return!this.isReady_||this.paused()?(this.queuedHanders_.add(t),this.one("playing",()=>{this.queuedHanders_.has(t)&&(this.queuedHanders_.delete(t),e())})):this.requestNamedAnimationFrame(t,e),t}cancelVideoFrameCallback(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)}setPoster(){}playsinline(){}setPlaysinline(){}overrideNativeAudioTracks(e){}overrideNativeVideoTracks(e){}canPlayType(e){return""}static canPlayType(e){return""}static canPlaySource(e,t){return Tech.canPlayType(e.type)}static isTech(e){return e.prototype instanceof Tech||e instanceof Tech||e===Tech}static registerTech(e,t){if(Tech.techs_||(Tech.techs_={}),!Tech.isTech(t))throw new Error(`Tech ${e} must be a Tech`);if(!Tech.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!Tech.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=toTitleCase$1(e),Tech.techs_[e]=t,Tech.techs_[toLowerCase(e)]=t,e!=="Tech"&&Tech.defaultTechOrder_.push(e),t}static getTech(e){if(e){if(Tech.techs_&&Tech.techs_[e])return Tech.techs_[e];if(e=toTitleCase$1(e),window$1&&window$1.videojs&&window$1.videojs[e])return log$1.warn(`The ${e} tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)`),window$1.videojs[e]}}}ALL.names.forEach(function(i){const e=ALL[i];Tech.prototype[e.getterName]=function(){return this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName]}});Tech.prototype.featuresVolumeControl=!0;Tech.prototype.featuresMuteControl=!0;Tech.prototype.featuresFullscreenResize=!1;Tech.prototype.featuresPlaybackRate=!1;Tech.prototype.featuresProgressEvents=!1;Tech.prototype.featuresSourceset=!1;Tech.prototype.featuresTimeupdateEvents=!1;Tech.prototype.featuresNativeTextTracks=!1;Tech.prototype.featuresVideoFrameCallback=!1;Tech.withSourceHandlers=function(i){i.registerSourceHandler=function(t,n){let r=i.sourceHandlers;r||(r=i.sourceHandlers=[]),n===void 0&&(n=r.length),r.splice(n,0,t)},i.canPlayType=function(t){const n=i.sourceHandlers||[];let r;for(let s=0;s<n.length;s++)if(r=n[s].canPlayType(t),r)return r;return""},i.selectSourceHandler=function(t,n){const r=i.sourceHandlers||[];let s;for(let a=0;a<r.length;a++)if(s=r[a].canHandleSource(t,n),s)return r[a];return null},i.canPlaySource=function(t,n){const r=i.selectSourceHandler(t,n);return r?r.canHandleSource(t,n):""},["seekable","seeking","duration"].forEach(function(t){const n=this[t];typeof n=="function"&&(this[t]=function(){return this.sourceHandler_&&this.sourceHandler_[t]?this.sourceHandler_[t].apply(this.sourceHandler_,arguments):n.apply(this,arguments)})},i.prototype),i.prototype.setSource=function(t){let n=i.selectSourceHandler(t,this.options_);n||(i.nativeSourceHandler?n=i.nativeSourceHandler:log$1.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),n!==i.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=n.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},i.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}};Component$1.registerComponent("Tech",Tech);Tech.registerTech("Tech",Tech);Tech.defaultTechOrder_=[];const middlewares={},middlewareInstances={},TERMINATOR={};function use(i,e){middlewares[i]=middlewares[i]||[],middlewares[i].push(e)}function setSource(i,e,t){i.setTimeout(()=>setSourceHelper(e,middlewares[e.type],t,i),1)}function setTech(i,e){i.forEach(t=>t.setTech&&t.setTech(e))}function get(i,e,t){return i.reduceRight(middlewareIterator(t),e[t]())}function set(i,e,t,n){return e[t](i.reduce(middlewareIterator(t),n))}function mediate(i,e,t,n=null){const r="call"+toTitleCase$1(t),s=i.reduce(middlewareIterator(r),n),a=s===TERMINATOR,l=a?null:e[t](s);return executeRight(i,t,l,a),l}const allowedGetters={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},allowedSetters={setCurrentTime:1,setMuted:1,setVolume:1},allowedMediators={play:1,pause:1};function middlewareIterator(i){return(e,t)=>e===TERMINATOR?TERMINATOR:t[i]?t[i](e):e}function executeRight(i,e,t,n){for(let r=i.length-1;r>=0;r--){const s=i[r];s[e]&&s[e](n,t)}}function clearCacheForPlayer(i){middlewareInstances.hasOwnProperty(i.id())&&delete middlewareInstances[i.id()]}function getOrCreateFactory(i,e){const t=middlewareInstances[i.id()];let n=null;if(t==null)return n=e(i),middlewareInstances[i.id()]=[[e,n]],n;for(let r=0;r<t.length;r++){const[s,a]=t[r];s===e&&(n=a)}return n===null&&(n=e(i),t.push([e,n])),n}function setSourceHelper(i={},e=[],t,n,r=[],s=!1){const[a,...l]=e;if(typeof a=="string")setSourceHelper(i,middlewares[a],t,n,r,s);else if(a){const u=getOrCreateFactory(n,a);if(!u.setSource)return r.push(u),setSourceHelper(i,l,t,n,r,s);u.setSource(Object.assign({},i),function(d,h){if(d)return setSourceHelper(i,l,t,n,r,s);r.push(u),setSourceHelper(h,i.type===h.type?l:middlewares[h.type],t,n,r,s)})}else l.length?setSourceHelper(i,l,t,n,r,s):s?t(i,r):setSourceHelper(i,middlewares["*"],t,n,r,!0)}const MimetypesKind={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},getMimetype=function(i=""){const e=getFileExtension(i);return MimetypesKind[e.toLowerCase()]||""},findMimetype=(i,e)=>{if(!e)return"";if(i.cache_.source.src===e&&i.cache_.source.type)return i.cache_.source.type;const t=i.cache_.sources.filter(r=>r.src===e);if(t.length)return t[0].type;const n=i.$$("source");for(let r=0;r<n.length;r++){const s=n[r];if(s.type&&s.src&&s.src===e)return s.type}return getMimetype(e)},filterSource=function(i){if(Array.isArray(i)){let e=[];i.forEach(function(t){t=filterSource(t),Array.isArray(t)?e=e.concat(t):isObject(t)&&e.push(t)}),i=e}else typeof i=="string"&&i.trim()?i=[fixSource({src:i})]:isObject(i)&&typeof i.src=="string"&&i.src&&i.src.trim()?i=[fixSource(i)]:i=[];return i};function fixSource(i){if(!i.type){const e=getMimetype(i.src);e&&(i.type=e)}return i}var icons=`<svg xmlns="http://www.w3.org/2000/svg">
  <defs>
    <symbol viewBox="0 0 48 48" id="vjs-icon-play">
      <path d="M16 10v28l22-14z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-pause">
      <path d="M12 38h8V10h-8v28zm16-28v28h8V10h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-audio">
      <path d="M24 2C14.06 2 6 10.06 6 20v14c0 3.31 2.69 6 6 6h6V24h-8v-4c0-7.73 6.27-14 14-14s14 6.27 14 14v4h-8v16h6c3.31 0 6-2.69 6-6V20c0-9.94-8.06-18-18-18z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-captions">
      <path d="M38 8H10c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM22 22h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2zm14 0h-3v-1h-4v6h4v-1h3v2a2 2 0 0 1-2 2h-6a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-subtitles">
      <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-enter">
      <path d="M14 28h-4v10h10v-4h-6v-6zm-4-8h4v-6h6v-4H10v10zm24 14h-6v4h10V28h-4v6zm-6-24v4h6v6h4V10H28z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-fullscreen-exit">
      <path d="M10 32h6v6h4V28H10v4zm6-16h-6v4h10V10h-4v6zm12 22h4v-6h6v-4H28v10zm4-22v-6h-4v10h10v-4h-6z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-play-circle">
      <path d="M20 33l12-9-12-9v18zm4-29C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-mute">
      <path d="M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13a17.94 17.94 0 0 0 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-low">
      <path d="M14 18v12h8l10 10V8L22 18h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-medium">
      <path d="M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-volume-high">
      <path d="M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-spinner">
      <path d="M18.8 21l9.53-16.51C26.94 4.18 25.49 4 24 4c-4.8 0-9.19 1.69-12.64 4.51l7.33 12.69.11-.2zm24.28-3c-1.84-5.85-6.3-10.52-11.99-12.68L23.77 18h19.31zm.52 2H28.62l.58 1 9.53 16.5C41.99 33.94 44 29.21 44 24c0-1.37-.14-2.71-.4-4zm-26.53 4l-7.8-13.5C6.01 14.06 4 18.79 4 24c0 1.37.14 2.71.4 4h14.98l-2.31-4zM4.92 30c1.84 5.85 6.3 10.52 11.99 12.68L24.23 30H4.92zm22.54 0l-7.8 13.51c1.4.31 2.85.49 4.34.49 4.8 0 9.19-1.69 12.64-4.51L29.31 26.8 27.46 30z"></path>
    </symbol>
    <symbol viewBox="0 0 24 24" id="vjs-icon-hd">
      <path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm2-6h4c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1h-4V9zm1.5 4.5h2v-3h-2v3z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-chapters">
      <path d="M6 26h4v-4H6v4zm0 8h4v-4H6v4zm0-16h4v-4H6v4zm8 8h28v-4H14v4zm0 8h28v-4H14v4zm0-20v4h28v-4H14z"></path>
    </symbol>
    <symbol viewBox="0 0 40 40" id="vjs-icon-downloading">
      <path d="M18.208 36.875q-3.208-.292-5.979-1.729-2.771-1.438-4.812-3.729-2.042-2.292-3.188-5.229-1.146-2.938-1.146-6.23 0-6.583 4.334-11.416 4.333-4.834 10.833-5.5v3.166q-5.167.75-8.583 4.646Q6.25 14.75 6.25 19.958q0 5.209 3.396 9.104 3.396 3.896 8.562 4.646zM20 28.417L11.542 20l2.083-2.083 4.917 4.916v-11.25h2.916v11.25l4.875-4.916L28.417 20zm1.792 8.458v-3.167q1.833-.25 3.541-.958 1.709-.708 3.167-1.875l2.333 2.292q-1.958 1.583-4.25 2.541-2.291.959-4.791 1.167zm6.791-27.792q-1.541-1.125-3.25-1.854-1.708-.729-3.541-1.021V3.042q2.5.25 4.77 1.208 2.271.958 4.271 2.5zm4.584 21.584l-2.25-2.25q1.166-1.5 1.854-3.209.687-1.708.937-3.541h3.209q-.292 2.5-1.229 4.791-.938 2.292-2.521 4.209zm.541-12.417q-.291-1.833-.958-3.562-.667-1.73-1.833-3.188l2.375-2.208q1.541 1.916 2.458 4.208.917 2.292 1.167 4.75z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download">
      <path d="M10.8 40.55q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h26.35v-7.7h3.4v7.7q0 1.4-1 2.4t-2.4 1zM24 32.1L13.9 22.05l2.45-2.45 5.95 5.95V7.15h3.4v18.4l5.95-5.95 2.45 2.45z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-done">
      <path d="M9.8 40.5v-3.45h28.4v3.45zm9.2-9.05L7.4 19.85l2.45-2.35L19 26.65l19.2-19.2 2.4 2.4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-file-download-off">
      <path d="M4.9 4.75L43.25 43.1 41 45.3l-4.75-4.75q-.05.05-.075.025-.025-.025-.075-.025H10.8q-1.35 0-2.375-1T7.4 37.15v-7.7h3.4v7.7h22.05l-7-7-1.85 1.8L13.9 21.9l1.85-1.85L2.7 7zm26.75 14.7l2.45 2.45-3.75 3.8-2.45-2.5zM25.7 7.15V21.1l-3.4-3.45V7.15z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-share">
      <path d="M36 32.17c-1.52 0-2.89.59-3.93 1.54L17.82 25.4c.11-.45.18-.92.18-1.4s-.07-.95-.18-1.4l14.1-8.23c1.07 1 2.5 1.62 4.08 1.62 3.31 0 6-2.69 6-6s-2.69-6-6-6-6 2.69-6 6c0 .48.07.95.18 1.4l-14.1 8.23c-1.07-1-2.5-1.62-4.08-1.62-3.31 0-6 2.69-6 6s2.69 6 6 6c1.58 0 3.01-.62 4.08-1.62l14.25 8.31c-.1.42-.16.86-.16 1.31A5.83 5.83 0 1 0 36 32.17z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cog">
      <path d="M38.86 25.95c.08-.64.14-1.29.14-1.95s-.06-1.31-.14-1.95l4.23-3.31c.38-.3.49-.84.24-1.28l-4-6.93c-.25-.43-.77-.61-1.22-.43l-4.98 2.01c-1.03-.79-2.16-1.46-3.38-1.97L29 4.84c-.09-.47-.5-.84-1-.84h-8c-.5 0-.91.37-.99.84l-.75 5.3a14.8 14.8 0 0 0-3.38 1.97L9.9 10.1a1 1 0 0 0-1.22.43l-4 6.93c-.25.43-.14.97.24 1.28l4.22 3.31C9.06 22.69 9 23.34 9 24s.06 1.31.14 1.95l-4.22 3.31c-.38.3-.49.84-.24 1.28l4 6.93c.25.43.77.61 1.22.43l4.98-2.01c1.03.79 2.16 1.46 3.38 1.97l.75 5.3c.08.47.49.84.99.84h8c.5 0 .91-.37.99-.84l.75-5.3a14.8 14.8 0 0 0 3.38-1.97l4.98 2.01a1 1 0 0 0 1.22-.43l4-6.93c.25-.43.14-.97-.24-1.28l-4.22-3.31zM24 31c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-square">
      <path d="M36 8H12c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h24c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm0 28H12V12h24v24z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle">
      <circle cx="24" cy="24" r="20"></circle>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-outline">
      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-circle-inner-circle">
      <path d="M24 4C12.97 4 4 12.97 4 24s8.97 20 20 20 20-8.97 20-20S35.03 4 24 4zm0 36c-8.82 0-16-7.18-16-16S15.18 8 24 8s16 7.18 16 16-7.18 16-16 16zm6-16c0 3.31-2.69 6-6 6s-6-2.69-6-6 2.69-6 6-6 6 2.69 6 6z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cancel">
      <path d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm10 27.17L31.17 34 24 26.83 16.83 34 14 31.17 21.17 24 14 16.83 16.83 14 24 21.17 31.17 14 34 16.83 26.83 24 34 31.17z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-replay">
      <path d="M24 10V2L14 12l10 10v-8c6.63 0 12 5.37 12 12s-5.37 12-12 12-12-5.37-12-12H8c0 8.84 7.16 16 16 16s16-7.16 16-16-7.16-16-16-16z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-repeat">
      <path d="M14 14h20v6l8-8-8-8v6H10v12h4v-8zm20 20H14v-6l-8 8 8 8v-6h24V26h-4v8z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-5">
      <path d="M17.689 98l-8.697 8.696 8.697 8.697 2.486-2.485-4.32-4.319h1.302c4.93 0 9.071 1.722 12.424 5.165 3.352 3.443 5.029 7.638 5.029 12.584h3.55c0-2.958-.553-5.73-1.658-8.313-1.104-2.583-2.622-4.841-4.555-6.774-1.932-1.932-4.19-3.45-6.773-4.555-2.584-1.104-5.355-1.657-8.313-1.657H15.5l4.615-4.615zm-8.08 21.659v13.861h11.357v5.008H9.609V143h12.7c.834 0 1.55-.298 2.146-.894.596-.597.895-1.31.895-2.145v-7.781c0-.835-.299-1.55-.895-2.147a2.929 2.929 0 0 0-2.147-.894h-8.227v-5.096H25.35v-4.384z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-10">
      <path d="M42.315 125.63c0-4.997-1.694-9.235-5.08-12.713-3.388-3.479-7.571-5.218-12.552-5.218h-1.315l4.363 4.363-2.51 2.51-8.787-8.786L25.221 97l2.45 2.45-4.662 4.663h1.375c2.988 0 5.788.557 8.397 1.673 2.61 1.116 4.892 2.65 6.844 4.602 1.953 1.953 3.487 4.234 4.602 6.844 1.116 2.61 1.674 5.41 1.674 8.398zM8.183 142v-19.657H3.176V117.8h9.643V142zm13.63 0c-1.156 0-2.127-.393-2.912-1.178-.778-.778-1.168-1.746-1.168-2.902v-16.04c0-1.156.393-2.127 1.178-2.912.779-.779 1.746-1.168 2.902-1.168h7.696c1.156 0 2.126.392 2.911 1.177.779.78 1.168 1.747 1.168 2.903v16.04c0 1.156-.392 2.127-1.177 2.912-.779.779-1.746 1.168-2.902 1.168zm.556-4.636h6.583v-15.02H22.37z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-replay-30">
      <path d="M26.047 97l-8.733 8.732 8.733 8.733 2.496-2.494-4.336-4.338h1.307c4.95 0 9.108 1.73 12.474 5.187 3.367 3.458 5.051 7.668 5.051 12.635h3.565c0-2.97-.556-5.751-1.665-8.346-1.109-2.594-2.633-4.862-4.574-6.802-1.94-1.941-4.208-3.466-6.803-4.575-2.594-1.109-5.375-1.664-8.345-1.664H23.85l4.634-4.634zM2.555 117.531v4.688h10.297v5.25H5.873v4.687h6.979v5.156H2.555V142H13.36c1.061 0 1.95-.395 2.668-1.186.718-.79 1.076-1.772 1.076-2.94v-16.218c0-1.168-.358-2.149-1.076-2.94-.717-.79-1.607-1.185-2.668-1.185zm22.482.14c-1.149 0-2.11.39-2.885 1.165-.78.78-1.172 1.744-1.172 2.893v15.943c0 1.149.388 2.11 1.163 2.885.78.78 1.745 1.172 2.894 1.172h7.649c1.148 0 2.11-.388 2.884-1.163.78-.78 1.17-1.745 1.17-2.894v-15.943c0-1.15-.386-2.111-1.16-2.885-.78-.78-1.746-1.172-2.894-1.172zm.553 4.518h6.545v14.93H25.59z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-5">
      <path d="M29.508 97l-2.431 2.43 4.625 4.625h-1.364c-2.965 0-5.742.554-8.332 1.66-2.589 1.107-4.851 2.629-6.788 4.566-1.937 1.937-3.458 4.2-4.565 6.788-1.107 2.59-1.66 5.367-1.66 8.331h3.557c0-4.957 1.68-9.16 5.04-12.611 3.36-3.45 7.51-5.177 12.451-5.177h1.304l-4.326 4.33 2.49 2.49 8.715-8.716zm-9.783 21.61v13.89h11.382v5.018H19.725V142h12.727a2.93 2.93 0 0 0 2.15-.896 2.93 2.93 0 0 0 .896-2.15v-7.798c0-.837-.299-1.554-.896-2.152a2.93 2.93 0 0 0-2.15-.896h-8.245V123h11.29v-4.392z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-10">
      <path d="M23.119 97l-2.386 2.383 4.538 4.538h-1.339c-2.908 0-5.633.543-8.173 1.63-2.54 1.085-4.76 2.577-6.66 4.478-1.9 1.9-3.392 4.12-4.478 6.66-1.085 2.54-1.629 5.264-1.629 8.172h3.49c0-4.863 1.648-8.986 4.944-12.372 3.297-3.385 7.368-5.078 12.216-5.078h1.279l-4.245 4.247 2.443 2.442 8.55-8.55zm-9.52 21.45v4.42h4.871V142h4.513v-23.55zm18.136 0c-1.125 0-2.066.377-2.824 1.135-.764.764-1.148 1.709-1.148 2.834v15.612c0 1.124.38 2.066 1.139 2.824.764.764 1.708 1.145 2.833 1.145h7.489c1.125 0 2.066-.378 2.824-1.136.764-.764 1.145-1.709 1.145-2.833v-15.612c0-1.125-.378-2.067-1.136-2.825-.764-.764-1.708-1.145-2.833-1.145zm.54 4.42h6.408v14.617h-6.407z"></path>
    </symbol>
    <symbol viewBox="0 96 48 48" id="vjs-icon-forward-30">
      <path d="M25.549 97l-2.437 2.434 4.634 4.635H26.38c-2.97 0-5.753.555-8.347 1.664-2.594 1.109-4.861 2.633-6.802 4.574-1.94 1.94-3.465 4.207-4.574 6.802-1.109 2.594-1.664 5.377-1.664 8.347h3.565c0-4.967 1.683-9.178 5.05-12.636 3.366-3.458 7.525-5.187 12.475-5.187h1.307l-4.335 4.338 2.495 2.494 8.732-8.732zm-11.553 20.53v4.689h10.297v5.249h-6.978v4.688h6.978v5.156H13.996V142h10.808c1.06 0 1.948-.395 2.666-1.186.718-.79 1.077-1.771 1.077-2.94v-16.217c0-1.169-.36-2.15-1.077-2.94-.718-.79-1.605-1.186-2.666-1.186zm21.174.168c-1.149 0-2.11.389-2.884 1.163-.78.78-1.172 1.745-1.172 2.894v15.942c0 1.15.388 2.11 1.162 2.885.78.78 1.745 1.17 2.894 1.17h7.649c1.149 0 2.11-.386 2.885-1.16.78-.78 1.17-1.746 1.17-2.895v-15.942c0-1.15-.387-2.11-1.161-2.885-.78-.78-1.745-1.172-2.894-1.172zm.552 4.516h6.542v14.931h-6.542z"></path>
    </symbol>
    <symbol viewBox="0 0 512 512" id="vjs-icon-audio-description">
      <g fill-rule="evenodd"><path d="M227.29 381.351V162.993c50.38-1.017 89.108-3.028 117.631 17.126 27.374 19.342 48.734 56.965 44.89 105.325-4.067 51.155-41.335 94.139-89.776 98.475-24.085 2.155-71.972 0-71.972 0s-.84-1.352-.773-2.568m48.755-54.804c31.43 1.26 53.208-16.633 56.495-45.386 4.403-38.51-21.188-63.552-58.041-60.796v103.612c-.036 1.466.575 2.22 1.546 2.57"></path><path d="M383.78 381.328c13.336 3.71 17.387-11.06 23.215-21.408 12.722-22.571 22.294-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.226 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M425.154 381.328c13.336 3.71 17.384-11.061 23.215-21.408 12.721-22.571 22.291-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.511c-.586 3.874 2.226 7.315 3.866 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894"></path><path d="M466.26 381.328c13.337 3.71 17.385-11.061 23.216-21.408 12.722-22.571 22.292-51.594 22.445-84.774.221-47.594-18.343-82.517-35.6-106.182h-8.51c-.587 3.874 2.225 7.315 3.865 10.276 13.166 23.762 25.367 56.553 25.54 94.194.2 43.176-14.162 79.278-30.955 107.894M4.477 383.005H72.58l18.573-28.484 64.169-.135s.065 19.413.065 28.62h48.756V160.307h-58.816c-5.653 9.537-140.85 222.697-140.85 222.697zm152.667-145.282v71.158l-40.453-.27 40.453-70.888z"></path></g>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-next-item">
      <path d="M12 36l17-12-17-12v24zm20-24v24h4V12h-4z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-previous-item">
      <path d="M12 12h4v24h-4zm7 12l17 12V12z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-shuffle">
      <path d="M21.17 18.34L10.83 8 8 10.83l10.34 10.34 2.83-2.83zM29 8l4.09 4.09L8 37.17 10.83 40l25.09-25.09L40 19V8H29zm.66 18.83l-2.83 2.83 6.26 6.26L29 40h11V29l-4.09 4.09-6.25-6.26z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-cast">
      <path d="M42 6H6c-2.21 0-4 1.79-4 4v6h4v-6h36v28H28v4h14c2.21 0 4-1.79 4-4V10c0-2.21-1.79-4-4-4zM2 36v6h6c0-3.31-2.69-6-6-6zm0-8v4c5.52 0 10 4.48 10 10h4c0-7.73-6.27-14-14-14zm0-8v4c9.94 0 18 8.06 18 18h4c0-12.15-9.85-22-22-22z"></path>
    </symbol>
    <symbol viewBox="0 0 48 48" id="vjs-icon-picture-in-picture-enter">
      <path d="M38 22H22v11.99h16V22zm8 16V9.96C46 7.76 44.2 6 42 6H6C3.8 6 2 7.76 2 9.96V38c0 2.2 1.8 4 4 4h36c2.2 0 4-1.8 4-4zm-4 .04H6V9.94h36v28.1z"></path>
    </symbol>
    <symbol viewBox="0 0 22 18" id="vjs-icon-picture-in-picture-exit">
      <path d="M18 4H4v10h14V4zm4 12V1.98C22 .88 21.1 0 20 0H2C.9 0 0 .88 0 1.98V16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H2V1.97h18v14.05z"></path>
      <path fill="none" d="M-1-3h24v24H-1z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-facebook">
      <path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759H734V905H479V609h255V391q0-186 104-288.5T1115 0q147 0 228 12z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-linkedin">
      <path d="M477 625v991H147V625h330zm21-306q1 73-50.5 122T312 490h-2q-82 0-132-49t-50-122q0-74 51.5-122.5T314 148t133 48.5T498 319zm1166 729v568h-329v-530q0-105-40.5-164.5T1168 862q-63 0-105.5 34.5T999 982q-11 30-11 81v553H659q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5T1285 602q171 0 275 113.5t104 332.5z"></path>
    </symbol>
    <symbol viewBox="0 0 1200 1227" id="vjs-icon-twitter">
      <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-tumblr">
      <path d="M1328 1329l80 237q-23 35-111 66t-177 32q-104 2-190.5-26T787 1564t-95-106-55.5-120-16.5-118V676H452V461q72-26 129-69.5t91-90 58-102 34-99T779 12q1-5 4.5-8.5T791 0h244v424h333v252h-334v518q0 30 6.5 56t22.5 52.5 49.5 41.5 81.5 14q78-2 134-29z"></path>
    </symbol>
    <symbol viewBox="0 0 1792 1792" id="vjs-icon-pinterest">
      <path d="M1664 896q0 209-103 385.5T1281.5 1561 896 1664q-111 0-218-32 59-93 78-164 9-34 54-211 20 39 73 67.5t114 28.5q121 0 216-68.5t147-188.5 52-270q0-114-59.5-214T1180 449t-255-63q-105 0-196 29t-154.5 77-109 110.5-67 129.5T377 866q0 104 40 183t117 111q30 12 38-20 2-7 8-31t8-30q6-23-11-43-51-61-51-151 0-151 104.5-259.5T904 517q151 0 235.5 82t84.5 213q0 170-68.5 289T980 1220q-61 0-98-43.5T859 1072q8-35 26.5-93.5t30-103T927 800q0-50-27-83t-77-33q-62 0-105 57t-43 142q0 73 25 122l-99 418q-17 70-13 177-206-91-333-281T128 896q0-209 103-385.5T510.5 231 896 128t385.5 103T1561 510.5 1664 896z"></path>
    </symbol>
  </defs>
</svg>`;const backKeyCode=IS_TIZEN?10009:IS_WEBOS?461:8,SpatialNavKeyCodes={codes:{play:415,pause:19,ff:417,rw:412,back:backKeyCode},names:{415:"play",19:"pause",417:"ff",412:"rw",[backKeyCode]:"back"},isEventKey(i,e){return e=e.toLowerCase(),!!(this.names[i.keyCode]&&this.names[i.keyCode]===e)},getEventName(i){if(this.names[i.keyCode])return this.names[i.keyCode];if(this.codes[i.code]){const e=this.codes[i.code];return this.names[e]}return null}},STEP_SECONDS=5;class SpatialNavigation extends EventTarget$2{constructor(e){super(),this.player_=e,this.focusableComponents=[],this.isListening_=!1,this.isPaused_=!1,this.onKeyDown_=this.onKeyDown_.bind(this),this.lastFocusedComponent_=null}start(){this.isListening_||(this.player_.on("keydown",this.onKeyDown_),this.player_.on("modalKeydown",this.onKeyDown_),this.player_.on("loadedmetadata",()=>{this.focus(this.updateFocusableComponents()[0])}),this.player_.on("modalclose",()=>{this.refocusComponent()}),this.player_.on("focusin",this.handlePlayerFocus_.bind(this)),this.player_.on("focusout",this.handlePlayerBlur_.bind(this)),this.isListening_=!0,this.player_.errorDisplay&&this.player_.errorDisplay.on("aftermodalfill",()=>{this.updateFocusableComponents(),this.focusableComponents.length&&(this.focusableComponents.length>1?this.focusableComponents[1].focus():this.focusableComponents[0].focus())}))}stop(){this.player_.off("keydown",this.onKeyDown_),this.isListening_=!1}onKeyDown_(e){const t=e.originalEvent?e.originalEvent:e;if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)){if(this.isPaused_)return;t.preventDefault();const n=t.key.substring(5).toLowerCase();this.move(n)}else if(SpatialNavKeyCodes.isEventKey(t,"play")||SpatialNavKeyCodes.isEventKey(t,"pause")||SpatialNavKeyCodes.isEventKey(t,"ff")||SpatialNavKeyCodes.isEventKey(t,"rw")){t.preventDefault();const n=SpatialNavKeyCodes.getEventName(t);this.performMediaAction_(n)}else SpatialNavKeyCodes.isEventKey(t,"Back")&&e.target&&typeof e.target.closeable=="function"&&e.target.closeable()&&(t.preventDefault(),e.target.close())}performMediaAction_(e){if(this.player_)switch(e){case"play":this.player_.paused()&&this.player_.play();break;case"pause":this.player_.paused()||this.player_.pause();break;case"ff":this.userSeek_(this.player_.currentTime()+STEP_SECONDS);break;case"rw":this.userSeek_(this.player_.currentTime()-STEP_SECONDS);break}}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}pause(){this.isPaused_=!0}resume(){this.isPaused_=!1}handlePlayerBlur_(e){const t=e.relatedTarget;let n=null;const r=this.getCurrentComponent(e.target);t&&(n=!!t.closest(".video-js"),t.classList.contains("vjs-text-track-settings")&&!this.isPaused_&&this.searchForTrackSelect_()),(!e.currentTarget.contains(e.relatedTarget)&&!n||!t)&&(r&&r.name()==="CloseButton"?this.refocusComponent():(this.pause(),r&&r.el()&&(this.lastFocusedComponent_=r)))}handlePlayerFocus_(){this.getCurrentComponent()&&this.getCurrentComponent().getIsFocusable()&&this.resume()}updateFocusableComponents(){const e=this.player_,t=[];function n(r){for(const s of r)s.hasOwnProperty("el_")&&s.getIsFocusable()&&s.getIsAvailableToBeFocused(s.el())&&t.push(s),s.hasOwnProperty("children_")&&s.children_.length>0&&n(s.children_)}return e.children_.forEach(r=>{if(r.hasOwnProperty("el_"))if(r.getIsFocusable&&r.getIsAvailableToBeFocused&&r.getIsFocusable()&&r.getIsAvailableToBeFocused(r.el())){t.push(r);return}else r.hasOwnProperty("children_")&&r.children_.length>0?n(r.children_):r.hasOwnProperty("items")&&r.items.length>0?n(r.items):this.findSuitableDOMChild(r)&&t.push(r);if(r.name_==="ErrorDisplay"&&r.opened_){const s=r.el_.querySelector(".vjs-errors-ok-button-container");s&&s.querySelectorAll("button").forEach((l,u)=>{t.push({name:()=>"ModalButton"+(u+1),el:()=>l,getPositions:()=>{const d=l.getBoundingClientRect(),h={x:d.x,y:d.y,width:d.width,height:d.height,top:d.top,right:d.right,bottom:d.bottom,left:d.left},p={x:d.left+d.width/2,y:d.top+d.height/2,width:0,height:0,top:d.top+d.height/2,right:d.left+d.width/2,bottom:d.top+d.height/2,left:d.left+d.width/2};return{boundingClientRect:h,center:p}},getIsAvailableToBeFocused:()=>!0,getIsFocusable:d=>!0,focus:()=>l.focus()})})}}),this.focusableComponents=t,this.focusableComponents}findSuitableDOMChild(e){function t(n){if(e.getIsFocusable(n)&&e.getIsAvailableToBeFocused(n))return n;for(let r=0;r<n.children.length;r++){const s=n.children[r],a=t(s);if(a)return a}return null}return e.el()?t(e.el()):null}getCurrentComponent(e){this.updateFocusableComponents();const t=e||document.activeElement;if(this.focusableComponents.length){for(const n of this.focusableComponents)if(n.el()===t)return n}}add(e){const t=[...this.focusableComponents];e.hasOwnProperty("el_")&&e.getIsFocusable()&&e.getIsAvailableToBeFocused(e.el())&&t.push(e),this.focusableComponents=t,this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents})}remove(e){for(let t=0;t<this.focusableComponents.length;t++)if(this.focusableComponents[t].name()===e.name()){this.focusableComponents.splice(t,1),this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents});return}}clear(){this.focusableComponents.length>0&&(this.focusableComponents=[],this.trigger({type:"focusableComponentsChanged",focusableComponents:this.focusableComponents}))}move(e){const t=this.getCurrentComponent();if(!t)return;const n=t.getPositions(),r=this.focusableComponents.filter(a=>a!==t&&this.isInDirection_(n.boundingClientRect,a.getPositions().boundingClientRect,e)),s=this.findBestCandidate_(n.center,r,e);s?this.focus(s):this.trigger({type:"endOfFocusableComponents",direction:e,focusedComponent:t})}findBestCandidate_(e,t,n){let r=1/0,s=null;for(const a of t){const l=a.getPositions().center,u=this.calculateDistance_(e,l,n);u<r&&(r=u,s=a)}return s}isInDirection_(e,t,n){switch(n){case"right":return t.left>=e.right;case"left":return t.right<=e.left;case"down":return t.top>=e.bottom;case"up":return t.bottom<=e.top;default:return!1}}refocusComponent(){if(this.lastFocusedComponent_){this.player_.userActive()||this.player_.userActive(!0),this.updateFocusableComponents();for(let e=0;e<this.focusableComponents.length;e++)if(this.focusableComponents[e].name()===this.lastFocusedComponent_.name()){this.focus(this.focusableComponents[e]);return}}else this.focus(this.updateFocusableComponents()[0])}focus(e){typeof e=="object"&&(e.getIsAvailableToBeFocused(e.el())?e.focus():this.findSuitableDOMChild(e)&&this.findSuitableDOMChild(e).focus())}calculateDistance_(e,t,n){const r=Math.abs(e.x-t.x),s=Math.abs(e.y-t.y);let a;switch(n){case"right":case"left":a=r+s*100;break;case"up":a=s*2+r*.5;break;case"down":a=s*5+r;break;default:a=r+s}return a}searchForTrackSelect_(){const e=this;for(const t of e.updateFocusableComponents())if(t.constructor.name==="TextTrackSelect"){e.focus(t);break}}}class MediaLoader extends Component$1{constructor(e,t,n){const r=merge$1({createEl:!1},t);if(super(e,r,n),!t.playerOptions.sources||t.playerOptions.sources.length===0)for(let s=0,a=t.playerOptions.techOrder;s<a.length;s++){const l=toTitleCase$1(a[s]);let u=Tech.getTech(l);if(l||(u=Component$1.getComponent(l)),u&&u.isSupported()){e.loadTech_(l);break}}else e.src(t.playerOptions.sources)}}Component$1.registerComponent("MediaLoader",MediaLoader);class ClickableComponent extends Component$1{constructor(e,t){super(e,t),this.options_.controlText&&this.controlText(this.options_.controlText),this.handleMouseOver_=n=>this.handleMouseOver(n),this.handleMouseOut_=n=>this.handleMouseOut(n),this.handleClick_=n=>this.handleClick(n),this.handleKeyDown_=n=>this.handleKeyDown(n),this.emitTapEvents(),this.enable()}createEl(e="div",t={},n={}){t=Object.assign({className:this.buildCSSClass(),tabIndex:0},t),e==="button"&&log$1.error(`Creating a ClickableComponent with an HTML element of ${e} is not supported; use a Button instead.`),n=Object.assign({role:"button"},n),this.tabIndex_=t.tabIndex;const r=createEl(e,t,n);return this.player_.options_.experimentalSvgIcons||r.appendChild(createEl("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(r),r}dispose(){this.controlTextEl_=null,super.dispose()}createControlTextEl(e){return this.controlTextEl_=createEl("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_}controlText(e,t=this.el()){if(e===void 0)return this.controlText_||"Need Text";const n=this.localize(e);this.controlText_=e,textContent(this.controlTextEl_,n),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&t.setAttribute("title",n)}buildCSSClass(){return`vjs-control vjs-button ${super.buildCSSClass()}`}enable(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_<"u"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))}disable(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_<"u"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)}handleLanguagechange(){this.controlText(this.controlText_)}handleClick(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)}handleKeyDown(e){e.key===" "||e.key==="Enter"?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}Component$1.registerComponent("ClickableComponent",ClickableComponent);class PosterImage extends ClickableComponent{constructor(e,t){super(e,t),this.update(),this.update_=n=>this.update(n),e.on("posterchange",this.update_)}dispose(){this.player().off("posterchange",this.update_),super.dispose()}createEl(){return createEl("div",{className:"vjs-poster"})}crossOrigin(e){if(typeof e>"u")return this.$("img")?this.$("img").crossOrigin:this.player_.tech_&&this.player_.tech_.isReady_?this.player_.crossOrigin():this.player_.options_.crossOrigin||this.player_.options_.crossorigin||null;if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){this.player_.log.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.$("img")&&(this.$("img").crossOrigin=e)}update(e){const t=this.player().poster();this.setSrc(t),t?this.show():this.hide()}setSrc(e){if(!e){this.el_.textContent="";return}this.$("img")||this.el_.appendChild(createEl("picture",{className:"vjs-poster",tabIndex:-1},{},createEl("img",{loading:"lazy",crossOrigin:this.crossOrigin()},{alt:""}))),this.$("img").src=e}handleClick(e){this.player_.controls()&&(this.player_.tech(!0)&&this.player_.tech(!0).focus(),this.player_.paused()?silencePromise(this.player_.play()):this.player_.pause())}}PosterImage.prototype.crossorigin=PosterImage.prototype.crossOrigin;Component$1.registerComponent("PosterImage",PosterImage);const darkGray="#222",lightGray="#ccc",fontMap={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function constructColor(i,e){let t;if(i.length===4)t=i[1]+i[1]+i[2]+i[2]+i[3]+i[3];else if(i.length===7)t=i.slice(1);else throw new Error("Invalid color code provided, "+i+"; must be formatted as e.g. #f0e or #f604e2.");return"rgba("+parseInt(t.slice(0,2),16)+","+parseInt(t.slice(2,4),16)+","+parseInt(t.slice(4,6),16)+","+e+")"}function tryUpdateStyle(i,e,t){try{i.style[e]=t}catch{return}}function getCSSPositionValue(i){return i?`${i}px`:""}class TextTrackDisplay extends Component$1{constructor(e,t,n){super(e,t,n);const r=a=>this.updateDisplay(a),s=a=>{this.updateDisplayOverlay(),this.updateDisplay(a)};e.on("loadstart",a=>this.toggleDisplay(a)),e.on("useractive",r),e.on("userinactive",r),e.on("texttrackchange",r),e.on("loadedmetadata",a=>{this.updateDisplayOverlay(),this.preselectTrack(a)}),e.ready(bind_(this,function(){if(e.tech_&&e.tech_.featuresNativeTextTracks){this.hide();return}e.on("fullscreenchange",s),e.on("playerresize",s);const a=window$1.screen.orientation||window$1,l=window$1.screen.orientation?"change":"orientationchange";a.addEventListener(l,s),e.on("dispose",()=>a.removeEventListener(l,s));const u=this.options_.playerOptions.tracks||[];for(let d=0;d<u.length;d++)this.player_.addRemoteTextTrack(u[d],!0);this.preselectTrack()}))}preselectTrack(){const e={captions:1,subtitles:1},t=this.player_.textTracks(),n=this.player_.cache_.selectedLanguage;let r,s,a;for(let l=0;l<t.length;l++){const u=t[l];n&&n.enabled&&n.language&&n.language===u.language&&u.kind in e?u.kind===n.kind?a=u:a||(a=u):n&&!n.enabled?(a=null,r=null,s=null):u.default&&(u.kind==="descriptions"&&!r?r=u:u.kind in e&&!s&&(s=u))}a?a.mode="showing":s?s.mode="showing":r&&(r.mode="showing")}toggleDisplay(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()}createEl(){return super.createEl("div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})}clearDisplay(){typeof window$1.WebVTT=="function"&&window$1.WebVTT.processCues(window$1,[],this.el_)}updateDisplay(){const e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){const a=[];for(let l=0;l<e.length;++l){const u=e[l];u.mode==="showing"&&a.push(u)}this.updateForTrack(a);return}let n=null,r=null,s=e.length;for(;s--;){const a=e[s];a.mode==="showing"&&(a.kind==="descriptions"?n=a:r=a)}if(r?(this.getAttribute("aria-live")!=="off"&&this.setAttribute("aria-live","off"),this.updateForTrack(r)):n&&(this.getAttribute("aria-live")!=="assertive"&&this.setAttribute("aria-live","assertive"),this.updateForTrack(n)),!window$1.CSS.supports("inset","10px")){const a=this.el_,l=a.querySelectorAll(".vjs-text-track-cue"),u=this.player_.controlBar.el_.getBoundingClientRect().height,d=this.player_.el_.getBoundingClientRect().height;a.style="",tryUpdateStyle(a,"position","relative"),tryUpdateStyle(a,"height",d-u+"px"),tryUpdateStyle(a,"top","unset"),IS_SMART_TV?tryUpdateStyle(a,"bottom",d+"px"):tryUpdateStyle(a,"bottom","0px"),l.length>0&&l.forEach(h=>{if(h.style.inset){const p=h.style.inset.split(" ");p.length===3&&Object.assign(h.style,{top:p[0],right:p[1],bottom:p[2],left:"unset"})}})}}updateDisplayOverlay(){if(!this.player_.videoHeight()||!window$1.CSS.supports("inset-inline: 10px"))return;const e=this.player_.currentWidth(),t=this.player_.currentHeight(),n=e/t,r=this.player_.videoWidth()/this.player_.videoHeight();let s=0,a=0;Math.abs(n-r)>.1&&(n>r?s=Math.round((e-t*r)/2):a=Math.round((t-e/r)/2)),tryUpdateStyle(this.el_,"insetInline",getCSSPositionValue(s)),tryUpdateStyle(this.el_,"insetBlock",getCSSPositionValue(a))}updateDisplayState(e){const t=this.player_.textTrackSettings.getValues(),n=e.activeCues;let r=n.length;for(;r--;){const s=n[r];if(!s)continue;const a=s.displayState;if(t.color&&(a.firstChild.style.color=t.color),t.textOpacity&&tryUpdateStyle(a.firstChild,"color",constructColor(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(a.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&tryUpdateStyle(a.firstChild,"backgroundColor",constructColor(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?tryUpdateStyle(a,"backgroundColor",constructColor(t.windowColor,t.windowOpacity)):a.style.backgroundColor=t.windowColor),t.edgeStyle&&(t.edgeStyle==="dropshadow"?a.firstChild.style.textShadow=`2px 2px 3px ${darkGray}, 2px 2px 4px ${darkGray}, 2px 2px 5px ${darkGray}`:t.edgeStyle==="raised"?a.firstChild.style.textShadow=`1px 1px ${darkGray}, 2px 2px ${darkGray}, 3px 3px ${darkGray}`:t.edgeStyle==="depressed"?a.firstChild.style.textShadow=`1px 1px ${lightGray}, 0 1px ${lightGray}, -1px -1px ${darkGray}, 0 -1px ${darkGray}`:t.edgeStyle==="uniform"&&(a.firstChild.style.textShadow=`0 0 4px ${darkGray}, 0 0 4px ${darkGray}, 0 0 4px ${darkGray}, 0 0 4px ${darkGray}`)),t.fontPercent&&t.fontPercent!==1){const l=window$1.parseFloat(a.style.fontSize);a.style.fontSize=l*t.fontPercent+"px",a.style.height="auto",a.style.top="auto"}t.fontFamily&&t.fontFamily!=="default"&&(t.fontFamily==="small-caps"?a.firstChild.style.fontVariant="small-caps":a.firstChild.style.fontFamily=fontMap[t.fontFamily])}}updateForTrack(e){if(Array.isArray(e)||(e=[e]),typeof window$1.WebVTT!="function"||e.every(n=>!n.activeCues))return;const t=[];for(let n=0;n<e.length;++n){const r=e[n];for(let s=0;s<r.activeCues.length;++s)t.push(r.activeCues[s])}window$1.WebVTT.processCues(window$1,t,this.el_);for(let n=0;n<e.length;++n){const r=e[n];for(let s=0;s<r.activeCues.length;++s){const a=r.activeCues[s].displayState;addClass(a,"vjs-text-track-cue","vjs-text-track-cue-"+(r.language?r.language:n)),r.language&&setAttribute(a,"lang",r.language)}this.player_.textTrackSettings&&this.updateDisplayState(r)}}}Component$1.registerComponent("TextTrackDisplay",TextTrackDisplay);class LoadingSpinner extends Component$1{createEl(){const e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),n=createEl("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),r=super.createEl("div",{className:"vjs-loading-spinner",dir:"ltr"});return r.appendChild(n),r}handleLanguagechange(){this.$(".vjs-control-text").textContent=this.localize("{1} is loading.",[this.player_.isAudio()?"Audio Player":"Video Player"])}}Component$1.registerComponent("LoadingSpinner",LoadingSpinner);class Button extends ClickableComponent{createEl(e,t={},n={}){e="button",t=Object.assign({className:this.buildCSSClass()},t),n=Object.assign({type:"button"},n);const r=createEl(e,t,n);return this.player_.options_.experimentalSvgIcons||r.appendChild(createEl("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(r),r}addChild(e,t={}){const n=this.constructor.name;return log$1.warn(`Adding an actionable (user controllable) child to a Button (${n}) is not supported; use a ClickableComponent instead.`),Component$1.prototype.addChild.call(this,e,t)}enable(){super.enable(),this.el_.removeAttribute("disabled")}disable(){super.disable(),this.el_.setAttribute("disabled","disabled")}handleKeyDown(e){if(e.key===" "||e.key==="Enter"){e.stopPropagation();return}super.handleKeyDown(e)}}Component$1.registerComponent("Button",Button);class BigPlayButton extends Button{constructor(e,t){super(e,t),this.mouseused_=!1,this.setIcon("play"),this.on("mousedown",n=>this.handleMouseDown(n))}buildCSSClass(){return"vjs-big-play-button"}handleClick(e){const t=this.player_.play();if(e.type==="tap"||this.mouseused_&&"clientX"in e&&"clientY"in e){silencePromise(t),this.player_.tech(!0)&&this.player_.tech(!0).focus();return}const n=this.player_.getChild("controlBar"),r=n&&n.getChild("playToggle");if(!r){this.player_.tech(!0).focus();return}const s=()=>r.focus();isPromise(t)?t.then(s,()=>{}):this.setTimeout(s,1)}handleKeyDown(e){this.mouseused_=!1,super.handleKeyDown(e)}handleMouseDown(e){this.mouseused_=!0}}BigPlayButton.prototype.controlText_="Play Video";Component$1.registerComponent("BigPlayButton",BigPlayButton);class CloseButton extends Button{constructor(e,t){super(e,t),this.setIcon("cancel"),this.controlText(t&&t.controlText||this.localize("Close"))}buildCSSClass(){return`vjs-close-button ${super.buildCSSClass()}`}handleClick(e){this.trigger({type:"close",bubbles:!1})}handleKeyDown(e){e.key==="Escape"?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):super.handleKeyDown(e)}}Component$1.registerComponent("CloseButton",CloseButton);class PlayToggle extends Button{constructor(e,t={}){super(e,t),t.replay=t.replay===void 0||t.replay,this.setIcon("play"),this.on(e,"play",n=>this.handlePlay(n)),this.on(e,"pause",n=>this.handlePause(n)),t.replay&&this.on(e,"ended",n=>this.handleEnded(n))}buildCSSClass(){return`vjs-play-control ${super.buildCSSClass()}`}handleClick(e){this.player_.paused()?silencePromise(this.player_.play()):this.player_.pause()}handleSeeked(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)}handlePlay(e){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.setIcon("pause"),this.controlText("Pause")}handlePause(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.setIcon("play"),this.controlText("Play")}handleEnded(e){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.setIcon("replay"),this.controlText("Replay"),this.one(this.player_,"seeked",t=>this.handleSeeked(t))}}PlayToggle.prototype.controlText_="Play";Component$1.registerComponent("PlayToggle",PlayToggle);class TimeDisplay extends Component$1{constructor(e,t){super(e,t),this.on(e,["timeupdate","ended","seeking"],n=>this.update(n)),this.updateTextNode_()}createEl(){const e=this.buildCSSClass(),t=super.createEl("div",{className:`${e} vjs-time-control vjs-control`}),n=createEl("span",{className:"vjs-control-text",textContent:`${this.localize(this.labelText_)}`},{role:"presentation"});return t.appendChild(n),this.contentEl_=createEl("span",{className:`${e}-display`},{role:"presentation"}),t.appendChild(this.contentEl_),t}dispose(){this.contentEl_=null,this.textNode_=null,super.dispose()}update(e){!this.player_.options_.enableSmoothSeeking&&e.type==="seeking"||this.updateContent(e)}updateTextNode_(e=0){e=formatTime(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",()=>{if(!this.contentEl_)return;let t=this.textNode_;t&&this.contentEl_.firstChild!==t&&(t=null,log$1.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),this.textNode_=document$1.createTextNode(this.formattedTime_),this.textNode_&&(t?this.contentEl_.replaceChild(this.textNode_,t):this.contentEl_.appendChild(this.textNode_))}))}updateContent(e){}}TimeDisplay.prototype.labelText_="Time";TimeDisplay.prototype.controlText_="Time";Component$1.registerComponent("TimeDisplay",TimeDisplay);class CurrentTimeDisplay extends TimeDisplay{buildCSSClass(){return"vjs-current-time"}updateContent(e){let t;this.player_.ended()?t=this.player_.duration():e&&e.target&&typeof e.target.pendingSeekTime=="function"?t=e.target.pendingSeekTime():t=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)}}CurrentTimeDisplay.prototype.labelText_="Current Time";CurrentTimeDisplay.prototype.controlText_="Current Time";Component$1.registerComponent("CurrentTimeDisplay",CurrentTimeDisplay);class DurationDisplay extends TimeDisplay{constructor(e,t){super(e,t);const n=r=>this.updateContent(r);this.on(e,"durationchange",n),this.on(e,"loadstart",n),this.on(e,"loadedmetadata",n)}buildCSSClass(){return"vjs-duration"}updateContent(e){const t=this.player_.duration();this.updateTextNode_(t)}}DurationDisplay.prototype.labelText_="Duration";DurationDisplay.prototype.controlText_="Duration";Component$1.registerComponent("DurationDisplay",DurationDisplay);class TimeDivider extends Component$1{createEl(){const e=super.createEl("div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=super.createEl("div"),n=super.createEl("span",{textContent:"/"});return t.appendChild(n),e.appendChild(t),e}}Component$1.registerComponent("TimeDivider",TimeDivider);class RemainingTimeDisplay extends TimeDisplay{constructor(e,t){super(e,t),this.on(e,"durationchange",n=>this.updateContent(n))}buildCSSClass(){return"vjs-remaining-time"}createEl(){const e=super.createEl();return this.options_.displayNegative!==!1&&e.insertBefore(createEl("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e}updateContent(e){if(typeof this.player_.duration()!="number")return;let t;this.player_.ended()?t=0:this.player_.remainingTimeDisplay?t=this.player_.remainingTimeDisplay():t=this.player_.remainingTime(),this.updateTextNode_(t)}}RemainingTimeDisplay.prototype.labelText_="Remaining Time";RemainingTimeDisplay.prototype.controlText_="Remaining Time";Component$1.registerComponent("RemainingTimeDisplay",RemainingTimeDisplay);class LiveDisplay extends Component$1{constructor(e,t){super(e,t),this.updateShowing(),this.on(this.player(),"durationchange",n=>this.updateShowing(n))}createEl(){const e=super.createEl("div",{className:"vjs-live-control vjs-control"});return this.contentEl_=createEl("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(createEl("span",{className:"vjs-control-text",textContent:`${this.localize("Stream Type")}`})),this.contentEl_.appendChild(document$1.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e}dispose(){this.contentEl_=null,super.dispose()}updateShowing(e){this.player().duration()===1/0?this.show():this.hide()}}Component$1.registerComponent("LiveDisplay",LiveDisplay);class SeekToLive extends Button{constructor(e,t){super(e,t),this.updateLiveEdgeStatus(),this.player_.liveTracker&&(this.updateLiveEdgeStatusHandler_=n=>this.updateLiveEdgeStatus(n),this.on(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_))}createEl(){const e=super.createEl("button",{className:"vjs-seek-to-live-control vjs-control"});return this.setIcon("circle",e),this.textEl_=createEl("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e}updateLiveEdgeStatus(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))}handleClick(){this.player_.liveTracker.seekToLiveEdge()}dispose(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,super.dispose()}}SeekToLive.prototype.controlText_="Seek to live, currently playing live";Component$1.registerComponent("SeekToLive",SeekToLive);function clamp(i,e,t){return i=Number(i),Math.min(t,Math.max(e,isNaN(i)?e:i))}var Num=Object.freeze({__proto__:null,clamp});class Slider extends Component$1{constructor(e,t){super(e,t),this.handleMouseDown_=n=>this.handleMouseDown(n),this.handleMouseUp_=n=>this.handleMouseUp(n),this.handleKeyDown_=n=>this.handleKeyDown(n),this.handleClick_=n=>this.handleClick(n),this.handleMouseMove_=n=>this.handleMouseMove(n),this.update_=n=>this.update(n),this.bar=this.getChild(this.options_.barName),this.vertical(!!this.options_.vertical),this.enable()}enabled(){return this.enabled_}enable(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)}disable(){if(!this.enabled())return;const e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}createEl(e,t={},n={}){return t.className=t.className+" vjs-slider",t=Object.assign({tabIndex:0},t),n=Object.assign({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},n),super.createEl(e,t,n)}handleMouseDown(e){const t=this.bar.el_.ownerDocument;e.type==="mousedown"&&e.preventDefault(),e.type==="touchstart"&&!IS_CHROME&&e.preventDefault(),blockTextSelection(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)}handleMouseMove(e){}handleMouseUp(e){const t=this.bar.el_.ownerDocument;unblockTextSelection(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove_),this.off(t,"mouseup",this.handleMouseUp_),this.off(t,"touchmove",this.handleMouseMove_),this.off(t,"touchend",this.handleMouseUp_),this.update()}update(){if(!this.el_||!this.bar)return;const e=this.getProgress();return e===this.progress_||(this.progress_=e,this.requestNamedAnimationFrame("Slider#update",()=>{const t=this.vertical()?"height":"width";this.bar.el().style[t]=(e*100).toFixed(2)+"%"})),e}getProgress(){return Number(clamp(this.getPercent(),0,1).toFixed(4))}calculateDistance(e){const t=getPointerPosition(this.el_,e);return this.vertical()?t.y:t.x}handleKeyDown(e){const t=this.options_.playerOptions.spatialNavigation,n=t&&t.enabled,r=t&&t.horizontalSeek;n?r&&e.key==="ArrowLeft"||!r&&e.key==="ArrowDown"?(e.preventDefault(),e.stopPropagation(),this.stepBack()):r&&e.key==="ArrowRight"||!r&&e.key==="ArrowUp"?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(this.pendingSeekTime()&&(this.pendingSeekTime(null),this.userSeek_(this.player_.currentTime())),super.handleKeyDown(e)):e.key==="ArrowLeft"||e.key==="ArrowDown"?(e.preventDefault(),e.stopPropagation(),this.stepBack()):e.key==="ArrowUp"||e.key==="ArrowRight"?(e.preventDefault(),e.stopPropagation(),this.stepForward()):super.handleKeyDown(e)}handleClick(e){e.stopPropagation(),e.preventDefault()}vertical(e){if(e===void 0)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")}}Component$1.registerComponent("Slider",Slider);const percentify=(i,e)=>clamp(i/e*100,0,100).toFixed(2)+"%";class LoadProgressBar extends Component$1{constructor(e,t){super(e,t),this.partEls_=[],this.on(e,"progress",n=>this.update(n))}createEl(){const e=super.createEl("div",{className:"vjs-load-progress"}),t=createEl("span",{className:"vjs-control-text"}),n=createEl("span",{textContent:this.localize("Loaded")}),r=document$1.createTextNode(": ");return this.percentageEl_=createEl("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(n),t.appendChild(r),t.appendChild(this.percentageEl_),e}dispose(){this.partEls_=null,this.percentageEl_=null,super.dispose()}update(e){this.requestNamedAnimationFrame("LoadProgressBar#update",()=>{const t=this.player_.liveTracker,n=this.player_.buffered(),r=t&&t.isLive()?t.seekableEnd():this.player_.duration(),s=this.player_.bufferedEnd(),a=this.partEls_,l=percentify(s,r);this.percent_!==l&&(this.el_.style.width=l,textContent(this.percentageEl_,l),this.percent_=l);for(let u=0;u<n.length;u++){const d=n.start(u),h=n.end(u);let p=a[u];p||(p=this.el_.appendChild(createEl()),a[u]=p),!(p.dataset.start===d&&p.dataset.end===h)&&(p.dataset.start=d,p.dataset.end=h,p.style.left=percentify(d,s),p.style.width=percentify(h-d,s))}for(let u=a.length;u>n.length;u--)this.el_.removeChild(a[u-1]);a.length=n.length})}}Component$1.registerComponent("LoadProgressBar",LoadProgressBar);class TimeTooltip extends Component$1{constructor(e,t){super(e,t),this.update=throttle(bind_(this,this.update),UPDATE_REFRESH_INTERVAL)}createEl(){return super.createEl("div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})}update(e,t,n){const r=findPosition(this.el_),s=getBoundingClientRect(this.player_.el()),a=e.width*t;if(!s||!r)return;let l=e.left-s.left+a,u=e.width-a+(s.right-e.right);u||(u=e.width-a,l=a);let d=r.width/2;l<d?d+=d-l:u<d&&(d=u),d<0?d=0:d>r.width&&(d=r.width),d=Math.round(d),this.el_.style.right=`-${d}px`,this.write(n)}write(e){textContent(this.el_,e)}updateTime(e,t,n,r){this.requestNamedAnimationFrame("TimeTooltip#updateTime",()=>{let s;const a=this.player_.duration();if(this.player_.liveTracker&&this.player_.liveTracker.isLive()){const l=this.player_.liveTracker.liveWindow(),u=l-t*l;s=(u<1?"":"-")+formatTime(u,l)}else s=formatTime(n,a);this.update(e,t,s),r&&r()})}}Component$1.registerComponent("TimeTooltip",TimeTooltip);class PlayProgressBar extends Component$1{constructor(e,t){super(e,t),this.setIcon("circle"),this.update=throttle(bind_(this,this.update),UPDATE_REFRESH_INTERVAL)}createEl(){return super.createEl("div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})}update(e,t,n){const r=this.getChild("timeTooltip");if(!r)return;const s=n&&n.target&&typeof n.target.pendingSeekTime=="function"?n.target.pendingSeekTime():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();r.updateTime(e,t,s)}}PlayProgressBar.prototype.options_={children:[]};!IS_IOS&&!IS_ANDROID&&PlayProgressBar.prototype.options_.children.push("timeTooltip");Component$1.registerComponent("PlayProgressBar",PlayProgressBar);class MouseTimeDisplay extends Component$1{constructor(e,t){super(e,t),this.update=throttle(bind_(this,this.update),UPDATE_REFRESH_INTERVAL)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t){const n=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,n,()=>{this.el_.style.left=`${e.width*t}px`})}}MouseTimeDisplay.prototype.options_={children:["timeTooltip"]};Component$1.registerComponent("MouseTimeDisplay",MouseTimeDisplay);class SeekBar extends Slider{constructor(e,t){t=merge$1(SeekBar.prototype.options_,t),t.children=[...t.children];const n=e.options_.disableSeekWhileScrubbingOnMobile&&(IS_IOS||IS_ANDROID)||e.options_.disableSeekWhileScrubbingOnSTV;(!IS_IOS&&!IS_ANDROID||n)&&t.children.splice(1,0,"mouseTimeDisplay"),super(e,t),this.shouldDisableSeekWhileScrubbing_=n,this.pendingSeekTime_=null,this.setEventHandlers_()}setEventHandlers_(){this.update_=bind_(this,this.update),this.update=throttle(this.update_,UPDATE_REFRESH_INTERVAL),this.on(this.player_,["durationchange","timeupdate"],this.update),this.on(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document$1&&"visibilityState"in document$1&&this.on(document$1,"visibilitychange",this.toggleVisibility_)}toggleVisibility_(e){document$1.visibilityState==="hidden"?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())}enableInterval_(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,UPDATE_REFRESH_INTERVAL))}disableInterval_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&e.type!=="ended"||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)}createEl(){return super.createEl("div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})}update(e){if(document$1.visibilityState==="hidden")return;const t=super.update();return this.requestNamedAnimationFrame("SeekBar#update",()=>{const n=this.player_.ended()?this.player_.duration():this.getCurrentTime_(),r=this.player_.liveTracker;let s=this.player_.duration();r&&r.isLive()&&(s=this.player_.liveTracker.liveCurrentTime()),this.percent_!==t&&(this.el_.setAttribute("aria-valuenow",(t*100).toFixed(2)),this.percent_=t),(this.currentTime_!==n||this.duration_!==s)&&(this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[formatTime(n,s),formatTime(s,s)],"{1} of {2}")),this.currentTime_=n,this.duration_=s),this.bar&&this.bar.update(getBoundingClientRect(this.el()),this.getProgress(),e)}),t}userSeek_(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)}getCurrentTime_(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()}pendingSeekTime(e){if(e!==void 0)if(e!==null){const t=this.player_.duration();this.pendingSeekTime_=Math.max(0,Math.min(e,t))}else this.pendingSeekTime_=null;return this.pendingSeekTime_}getPercent(){if(this.pendingSeekTime()!==null)return this.pendingSeekTime()/this.player_.duration();const e=this.getCurrentTime_();let t;const n=this.player_.liveTracker;return n&&n.isLive()?(t=(e-n.seekableStart())/n.liveWindow(),n.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t}handleMouseDown(e){isSingleLeftClick(e)&&(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.shouldDisableSeekWhileScrubbing_||this.player_.pause(),super.handleMouseDown(e))}handleMouseMove(e,t=!1){if(!isSingleLeftClick(e)||isNaN(this.player_.duration()))return;!t&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);let n;const r=this.calculateDistance(e),s=this.player_.liveTracker;if(!s||!s.isLive())n=r*this.player_.duration(),n===this.player_.duration()&&(n=n-.1);else{if(r>=.99){s.seekToLiveEdge();return}const a=s.seekableStart(),l=s.liveCurrentTime();if(n=a+r*s.liveWindow(),n>=l&&(n=l),n<=a&&(n=a+.1),n===1/0)return}this.shouldDisableSeekWhileScrubbing_?this.pendingSeekTime(n):this.userSeek_(n),this.player_.options_.enableSmoothSeeking&&this.update()}enable(){super.enable();const e=this.getChild("mouseTimeDisplay");e&&e.show()}disable(){super.disable();const e=this.getChild("mouseTimeDisplay");e&&e.hide()}handleMouseUp(e){super.handleMouseUp(e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.pendingSeekTime()!==null&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?silencePromise(this.player_.play()):this.update_()}handlePendingSeek_(e){this.player_.paused()||this.player_.pause();const t=this.pendingSeekTime()!==null?this.pendingSeekTime():this.player_.currentTime();this.pendingSeekTime(t+e),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}stepForward(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(this.options().stepSeconds):this.userSeek_(this.player_.currentTime()+this.options().stepSeconds)}stepBack(){this.shouldDisableSeekWhileScrubbing_?this.handlePendingSeek_(-this.options().stepSeconds):this.userSeek_(this.player_.currentTime()-this.options().stepSeconds)}handleAction(e){this.pendingSeekTime()!==null&&(this.userSeek_(this.pendingSeekTime()),this.pendingSeekTime(null)),this.player_.paused()?this.player_.play():this.player_.pause()}handleKeyDown(e){const t=this.player_.liveTracker;if(e.key===" "||e.key==="Enter")e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if(e.key==="Home")e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if(e.key==="End")e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(e.key)){e.preventDefault(),e.stopPropagation();const n=parseInt(e.key,10)*.1;t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*n):this.userSeek_(this.player_.duration()*n)}else e.key==="PageDown"?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-this.options().stepSeconds*this.options().pageMultiplier)):e.key==="PageUp"?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+this.options().stepSeconds*this.options().pageMultiplier)):super.handleKeyDown(e)}dispose(){this.disableInterval_(),this.off(this.player_,["durationchange","timeupdate"],this.update),this.off(this.player_,["ended"],this.update_),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document$1&&"visibilityState"in document$1&&this.off(document$1,"visibilitychange",this.toggleVisibility_),super.dispose()}}SeekBar.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar",stepSeconds:5,pageMultiplier:12};Component$1.registerComponent("SeekBar",SeekBar);class ProgressControl extends Component$1{constructor(e,t){super(e,t),this.handleMouseMove=throttle(bind_(this,this.handleMouseMove),UPDATE_REFRESH_INTERVAL),this.throttledHandleMouseSeek=throttle(bind_(this,this.handleMouseSeek),UPDATE_REFRESH_INTERVAL),this.handleMouseUpHandler_=n=>this.handleMouseUp(n),this.handleMouseDownHandler_=n=>this.handleMouseDown(n),this.enable()}createEl(){return super.createEl("div",{className:"vjs-progress-control vjs-control"})}handleMouseMove(e){const t=this.getChild("seekBar");if(!t)return;const n=t.getChild("playProgressBar"),r=t.getChild("mouseTimeDisplay");if(!n&&!r)return;const s=t.el(),a=findPosition(s);let l=getPointerPosition(s,e).x;l=clamp(l,0,1),r&&r.update(a,l),n&&n.update(a,t.getProgress())}handleMouseSeek(e){const t=this.getChild("seekBar");t&&t.handleMouseMove(e)}enabled(){return this.enabled_}disable(){if(this.children().forEach(e=>e.disable&&e.disable()),!!this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){const e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&silencePromise(this.player_.play())}}enable(){this.children().forEach(e=>e.enable&&e.enable()),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,["mousemove","touchmove"],this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)}removeListenersAddedOnMousedownAndTouchstart(){const e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)}handleMouseDown(e){const t=this.el_.ownerDocument,n=this.getChild("seekBar");n&&n.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()}}ProgressControl.prototype.options_={children:["seekBar"]};Component$1.registerComponent("ProgressControl",ProgressControl);class PictureInPictureToggle extends Button{constructor(e,t){super(e,t),this.setIcon("picture-in-picture-enter"),this.on(e,["enterpictureinpicture","leavepictureinpicture"],n=>this.handlePictureInPictureChange(n)),this.on(e,["disablepictureinpicturechanged","loadedmetadata"],n=>this.handlePictureInPictureEnabledChange(n)),this.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],()=>this.handlePictureInPictureAudioModeChange()),this.disable()}buildCSSClass(){return`vjs-picture-in-picture-control vjs-hidden ${super.buildCSSClass()}`}handlePictureInPictureAudioModeChange(){if(!(this.player_.currentType().substring(0,5)==="audio"||this.player_.audioPosterMode()||this.player_.audioOnlyMode())){this.show();return}this.player_.isInPictureInPicture()&&this.player_.exitPictureInPicture(),this.hide()}handlePictureInPictureEnabledChange(){document$1.pictureInPictureEnabled&&this.player_.disablePictureInPicture()===!1||this.player_.options_.enableDocumentPictureInPicture&&"documentPictureInPicture"in window$1?this.enable():this.disable()}handlePictureInPictureChange(e){this.player_.isInPictureInPicture()?(this.setIcon("picture-in-picture-exit"),this.controlText("Exit Picture-in-Picture")):(this.setIcon("picture-in-picture-enter"),this.controlText("Picture-in-Picture")),this.handlePictureInPictureEnabledChange()}handleClick(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()}show(){typeof document$1.exitPictureInPicture=="function"&&super.show()}}PictureInPictureToggle.prototype.controlText_="Picture-in-Picture";Component$1.registerComponent("PictureInPictureToggle",PictureInPictureToggle);class FullscreenToggle extends Button{constructor(e,t){super(e,t),this.setIcon("fullscreen-enter"),this.on(e,"fullscreenchange",n=>this.handleFullscreenChange(n)),document$1[e.fsApi_.fullscreenEnabled]===!1&&this.disable()}buildCSSClass(){return`vjs-fullscreen-control ${super.buildCSSClass()}`}handleFullscreenChange(e){this.player_.isFullscreen()?(this.controlText("Exit Fullscreen"),this.setIcon("fullscreen-exit")):(this.controlText("Fullscreen"),this.setIcon("fullscreen-enter"))}handleClick(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}FullscreenToggle.prototype.controlText_="Fullscreen";Component$1.registerComponent("FullscreenToggle",FullscreenToggle);const checkVolumeSupport=function(i,e){e.tech_&&!e.tech_.featuresVolumeControl&&i.addClass("vjs-hidden"),i.on(e,"loadstart",function(){e.tech_.featuresVolumeControl?i.removeClass("vjs-hidden"):i.addClass("vjs-hidden")})};class VolumeLevel extends Component$1{createEl(){const e=super.createEl("div",{className:"vjs-volume-level"});return this.setIcon("circle",e),e.appendChild(super.createEl("span",{className:"vjs-control-text"})),e}}Component$1.registerComponent("VolumeLevel",VolumeLevel);class VolumeLevelTooltip extends Component$1{constructor(e,t){super(e,t),this.update=throttle(bind_(this,this.update),UPDATE_REFRESH_INTERVAL)}createEl(){return super.createEl("div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})}update(e,t,n,r){if(!n){const s=getBoundingClientRect(this.el_),a=getBoundingClientRect(this.player_.el()),l=e.width*t;if(!a||!s)return;const u=e.left-a.left+l,d=e.width-l+(a.right-e.right);let h=s.width/2;u<h?h+=h-u:d<h&&(h=d),h<0?h=0:h>s.width&&(h=s.width),this.el_.style.right=`-${h}px`}this.write(`${r}%`)}write(e){textContent(this.el_,e)}updateVolume(e,t,n,r,s){this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",()=>{this.update(e,t,n,r.toFixed(0)),s&&s()})}}Component$1.registerComponent("VolumeLevelTooltip",VolumeLevelTooltip);class MouseVolumeLevelDisplay extends Component$1{constructor(e,t){super(e,t),this.update=throttle(bind_(this,this.update),UPDATE_REFRESH_INTERVAL)}createEl(){return super.createEl("div",{className:"vjs-mouse-display"})}update(e,t,n){const r=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,n,r,()=>{n?this.el_.style.bottom=`${e.height*t}px`:this.el_.style.left=`${e.width*t}px`})}}MouseVolumeLevelDisplay.prototype.options_={children:["volumeLevelTooltip"]};Component$1.registerComponent("MouseVolumeLevelDisplay",MouseVolumeLevelDisplay);class VolumeBar extends Slider{constructor(e,t){super(e,t),this.on("slideractive",n=>this.updateLastVolume_(n)),this.on(e,"volumechange",n=>this.updateARIAAttributes(n)),e.ready(()=>this.updateARIAAttributes())}createEl(){return super.createEl("div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})}handleMouseDown(e){isSingleLeftClick(e)&&super.handleMouseDown(e)}handleMouseMove(e){const t=this.getChild("mouseVolumeLevelDisplay");if(t){const n=this.el(),r=getBoundingClientRect(n),s=this.vertical();let a=getPointerPosition(n,e);a=s?a.y:a.x,a=clamp(a,0,1),t.update(r,a,s)}isSingleLeftClick(e)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))}checkMuted(){this.player_.muted()&&this.player_.muted(!1)}getPercent(){return this.player_.muted()?0:this.player_.volume()}stepForward(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)}stepBack(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)}updateARIAAttributes(e){const t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")}volumeAsPercentage_(){return Math.round(this.player_.volume()*100)}updateLastVolume_(){const e=this.player_.volume();this.one("sliderinactive",()=>{this.player_.volume()===0&&this.player_.lastVolume_(e)})}}VolumeBar.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"};!IS_IOS&&!IS_ANDROID&&VolumeBar.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay");VolumeBar.prototype.playerEvent="volumechange";Component$1.registerComponent("VolumeBar",VolumeBar);class VolumeControl extends Component$1{constructor(e,t={}){t.vertical=t.vertical||!1,(typeof t.volumeBar>"u"||isPlain(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),super(e,t),checkVolumeSupport(this,e),this.throttledHandleMouseMove=throttle(bind_(this,this.handleMouseMove),UPDATE_REFRESH_INTERVAL),this.handleMouseUpHandler_=n=>this.handleMouseUp(n),this.on("mousedown",n=>this.handleMouseDown(n)),this.on("touchstart",n=>this.handleMouseDown(n)),this.on("mousemove",n=>this.handleMouseMove(n)),this.on(this.volumeBar,["focus","slideractive"],()=>{this.volumeBar.addClass("vjs-slider-active"),this.addClass("vjs-slider-active"),this.trigger("slideractive")}),this.on(this.volumeBar,["blur","sliderinactive"],()=>{this.volumeBar.removeClass("vjs-slider-active"),this.removeClass("vjs-slider-active"),this.trigger("sliderinactive")})}createEl(){let e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),super.createEl("div",{className:`vjs-volume-control vjs-control ${e}`})}handleMouseDown(e){const t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)}handleMouseUp(e){const t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)}handleMouseMove(e){this.volumeBar.handleMouseMove(e)}}VolumeControl.prototype.options_={children:["volumeBar"]};Component$1.registerComponent("VolumeControl",VolumeControl);const checkMuteSupport=function(i,e){e.tech_&&!e.tech_.featuresMuteControl&&i.addClass("vjs-hidden"),i.on(e,"loadstart",function(){e.tech_.featuresMuteControl?i.removeClass("vjs-hidden"):i.addClass("vjs-hidden")})};class MuteToggle extends Button{constructor(e,t){super(e,t),checkMuteSupport(this,e),this.on(e,["loadstart","volumechange"],n=>this.update(n))}buildCSSClass(){return`vjs-mute-control ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.volume(),n=this.player_.lastVolume_();if(t===0){const r=n<.1?.1:n;this.player_.volume(r),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())}update(e){this.updateIcon_(),this.updateControlText_()}updateIcon_(){const e=this.player_.volume();let t=3;this.setIcon("volume-high"),IS_IOS&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),e===0||this.player_.muted()?(this.setIcon("volume-mute"),t=0):e<.33?(this.setIcon("volume-low"),t=1):e<.67&&(this.setIcon("volume-medium"),t=2),removeClass(this.el_,[0,1,2,3].reduce((n,r)=>n+`${r?" ":""}vjs-vol-${r}`,"")),addClass(this.el_,`vjs-vol-${t}`)}updateControlText_(){const t=this.player_.muted()||this.player_.volume()===0?"Unmute":"Mute";this.controlText()!==t&&this.controlText(t)}}MuteToggle.prototype.controlText_="Mute";Component$1.registerComponent("MuteToggle",MuteToggle);class VolumePanel extends Component$1{constructor(e,t={}){typeof t.inline<"u"?t.inline=t.inline:t.inline=!0,(typeof t.volumeControl>"u"||isPlain(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),super(e,t),this.handleKeyPressHandler_=n=>this.handleKeyPress(n),this.on(e,["loadstart"],n=>this.volumePanelState_(n)),this.on(this.muteToggle,"keyup",n=>this.handleKeyPress(n)),this.on(this.volumeControl,"keyup",n=>this.handleVolumeControlKeyUp(n)),this.on("keydown",n=>this.handleKeyPress(n)),this.on("mouseover",n=>this.handleMouseOver(n)),this.on("mouseout",n=>this.handleMouseOut(n)),this.on(this.volumeControl,["slideractive"],this.sliderActive_),this.on(this.volumeControl,["sliderinactive"],this.sliderInactive_)}sliderActive_(){this.addClass("vjs-slider-active")}sliderInactive_(){this.removeClass("vjs-slider-active")}volumePanelState_(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")}createEl(){let e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),super.createEl("div",{className:`vjs-volume-panel vjs-control ${e}`})}dispose(){this.handleMouseOut(),super.dispose()}handleVolumeControlKeyUp(e){e.key==="Escape"&&this.muteToggle.focus()}handleMouseOver(e){this.addClass("vjs-hover"),on(document$1,"keyup",this.handleKeyPressHandler_)}handleMouseOut(e){this.removeClass("vjs-hover"),off(document$1,"keyup",this.handleKeyPressHandler_)}handleKeyPress(e){e.key==="Escape"&&this.handleMouseOut()}}VolumePanel.prototype.options_={children:["muteToggle","volumeControl"]};Component$1.registerComponent("VolumePanel",VolumePanel);class SkipForward extends Button{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipForwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`forward-${this.skipTime}`),this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipForwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.forward}buildCSSClass(){return`vjs-skip-forward-${this.getSkipForwardTime()} ${super.buildCSSClass()}`}handleClick(e){if(isNaN(this.player_.duration()))return;const t=this.player_.currentTime(),n=this.player_.liveTracker,r=n&&n.isLive()?n.seekableEnd():this.player_.duration();let s;t+this.skipTime<=r?s=t+this.skipTime:s=r,this.player_.currentTime(s)}handleLanguagechange(){this.controlText(this.localize("Skip forward {1} seconds",[this.skipTime]))}}SkipForward.prototype.controlText_="Skip Forward";Component$1.registerComponent("SkipForward",SkipForward);class SkipBackward extends Button{constructor(e,t){super(e,t),this.validOptions=[5,10,30],this.skipTime=this.getSkipBackwardTime(),this.skipTime&&this.validOptions.includes(this.skipTime)?(this.setIcon(`replay-${this.skipTime}`),this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime.toLocaleString(e.language())])),this.show()):this.hide()}getSkipBackwardTime(){const e=this.options_.playerOptions;return e.controlBar&&e.controlBar.skipButtons&&e.controlBar.skipButtons.backward}buildCSSClass(){return`vjs-skip-backward-${this.getSkipBackwardTime()} ${super.buildCSSClass()}`}handleClick(e){const t=this.player_.currentTime(),n=this.player_.liveTracker,r=n&&n.isLive()&&n.seekableStart();let s;r&&t-this.skipTime<=r?s=r:t>=this.skipTime?s=t-this.skipTime:s=0,this.player_.currentTime(s)}handleLanguagechange(){this.controlText(this.localize("Skip backward {1} seconds",[this.skipTime]))}}SkipBackward.prototype.controlText_="Skip Backward";Component$1.registerComponent("SkipBackward",SkipBackward);class Menu extends Component$1{constructor(e,t){super(e,t),t&&(this.menuButton_=t.menuButton),this.focusedChild_=-1,this.on("keydown",n=>this.handleKeyDown(n)),this.boundHandleBlur_=n=>this.handleBlur(n),this.boundHandleTapClick_=n=>this.handleTapClick(n)}addEventListenerForItem(e){e instanceof Component$1&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))}removeEventListenerForItem(e){e instanceof Component$1&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))}removeChild(e){typeof e=="string"&&(e=this.getChild(e)),this.removeEventListenerForItem(e),super.removeChild(e)}addItem(e){const t=this.addChild(e);t&&this.addEventListenerForItem(t)}createEl(){const e=this.options_.contentElType||"ul";this.contentEl_=createEl(e,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");const t=super.createEl("div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),on(t,"click",function(n){n.preventDefault(),n.stopImmediatePropagation()}),t}dispose(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,super.dispose()}handleBlur(e){const t=e.relatedTarget||document$1.activeElement;if(!this.children().some(n=>n.el()===t)){const n=this.menuButton_;n&&n.buttonPressed_&&t!==n.el().firstChild&&n.unpressButton()}}handleTapClick(e){if(this.menuButton_){this.menuButton_.unpressButton();const t=this.children();if(!Array.isArray(t))return;const n=t.filter(r=>r.el()===e.target)[0];if(!n)return;n.name()!=="CaptionSettingsMenuItem"&&this.menuButton_.focus()}}handleKeyDown(e){e.key==="ArrowLeft"||e.key==="ArrowDown"?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(e.key==="ArrowRight"||e.key==="ArrowUp")&&(e.preventDefault(),e.stopPropagation(),this.stepBack())}stepForward(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_+1),this.focus(e)}stepBack(){let e=0;this.focusedChild_!==void 0&&(e=this.focusedChild_-1),this.focus(e)}focus(e=0){const t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())}}Component$1.registerComponent("Menu",Menu);class MenuButton extends Component$1{constructor(e,t={}){super(e,t),this.menuButton_=new Button(e,t),this.menuButton_.controlText(this.controlText_),this.menuButton_.el_.setAttribute("aria-haspopup","true");const n=Button.prototype.buildCSSClass();this.menuButton_.el_.className=this.buildCSSClass()+" "+n,this.menuButton_.removeClass("vjs-control"),this.addChild(this.menuButton_),this.update(),this.enabled_=!0;const r=s=>this.handleClick(s);this.handleMenuKeyUp_=s=>this.handleMenuKeyUp(s),this.on(this.menuButton_,"tap",r),this.on(this.menuButton_,"click",r),this.on(this.menuButton_,"keydown",s=>this.handleKeyDown(s)),this.on(this.menuButton_,"mouseenter",()=>{this.addClass("vjs-hover"),this.menu.show(),on(document$1,"keyup",this.handleMenuKeyUp_)}),this.on("mouseleave",s=>this.handleMouseLeave(s)),this.on("keydown",s=>this.handleSubmenuKeyDown(s))}update(){const e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))}createMenu(){const e=new Menu(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const t=createEl("li",{className:"vjs-menu-title",textContent:toTitleCase$1(this.options_.title),tabIndex:-1}),n=new Component$1(this.player_,{el:t});e.addItem(n)}if(this.items=this.createItems(),this.items)for(let t=0;t<this.items.length;t++)e.addItem(this.items[t]);return e}createItems(){}createEl(){return super.createEl("div",{className:this.buildWrapperCSSClass()},{})}setIcon(e){super.setIcon(e,this.menuButton_.el_)}buildWrapperCSSClass(){let e="vjs-menu-button";this.options_.inline===!0?e+="-inline":e+="-popup";const t=Button.prototype.buildCSSClass();return`vjs-menu-button ${e} ${t} ${super.buildCSSClass()}`}buildCSSClass(){let e="vjs-menu-button";return this.options_.inline===!0?e+="-inline":e+="-popup",`vjs-menu-button ${e} ${super.buildCSSClass()}`}controlText(e,t=this.menuButton_.el()){return this.menuButton_.controlText(e,t)}dispose(){this.handleMouseLeave(),super.dispose()}handleClick(e){this.buttonPressed_?this.unpressButton():this.pressButton()}handleMouseLeave(e){this.removeClass("vjs-hover"),off(document$1,"keyup",this.handleMenuKeyUp_)}focus(){this.menuButton_.focus()}blur(){this.menuButton_.blur()}handleKeyDown(e){e.key==="Escape"||e.key==="Tab"?(this.buttonPressed_&&this.unpressButton(),!e.key==="Tab"&&(e.preventDefault(),this.menuButton_.focus())):(e.key==="Up"||e.key==="Down"&&!(this.player_.options_.playerOptions.spatialNavigation&&this.player_.options_.playerOptions.spatialNavigation.enabled))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))}handleMenuKeyUp(e){(e.key==="Escape"||e.key==="Tab")&&this.removeClass("vjs-hover")}handleSubmenuKeyPress(e){this.handleSubmenuKeyDown(e)}handleSubmenuKeyDown(e){(e.key==="Escape"||e.key==="Tab")&&(this.buttonPressed_&&this.unpressButton(),!e.key==="Tab"&&(e.preventDefault(),this.menuButton_.focus()))}pressButton(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),IS_IOS&&isInFrame())return;this.menu.focus()}}unpressButton(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))}disable(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()}enable(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()}}Component$1.registerComponent("MenuButton",MenuButton);class TrackButton extends MenuButton{constructor(e,t){const n=t.tracks;if(super(e,t),this.items.length<=1&&this.hide(),!n)return;const r=bind_(this,this.update);n.addEventListener("removetrack",r),n.addEventListener("addtrack",r),n.addEventListener("labelchange",r),this.player_.on("ready",r),this.player_.on("dispose",function(){n.removeEventListener("removetrack",r),n.removeEventListener("addtrack",r),n.removeEventListener("labelchange",r)})}}Component$1.registerComponent("TrackButton",TrackButton);class MenuItem extends ClickableComponent{constructor(e,t){super(e,t),this.selectable=t.selectable,this.isSelected_=t.selected||!1,this.multiSelectable=t.multiSelectable,this.selected(this.isSelected_),this.selectable?this.multiSelectable?this.el_.setAttribute("role","menuitemcheckbox"):this.el_.setAttribute("role","menuitemradio"):this.el_.setAttribute("role","menuitem")}createEl(e,t,n){this.nonIconControl=!0;const r=super.createEl("li",Object.assign({className:"vjs-menu-item",tabIndex:-1},t),n),s=createEl("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)});return this.player_.options_.experimentalSvgIcons?r.appendChild(s):r.replaceChild(s,r.querySelector(".vjs-icon-placeholder")),r}handleKeyDown(e){["Tab","Escape","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"].includes(e.key)||super.handleKeyDown(e)}handleClick(e){this.selected(!0)}selected(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))}}Component$1.registerComponent("MenuItem",MenuItem);class TextTrackMenuItem extends MenuItem{constructor(e,t){const n=t.track,r=e.textTracks();t.label=n.label||n.language||"Unknown",t.selected=n.mode==="showing",super(e,t),this.track=n,this.kinds=(t.kinds||[t.kind||this.track.kind]).filter(Boolean);const s=(...l)=>{this.handleTracksChange.apply(this,l)},a=(...l)=>{this.handleSelectedLanguageChange.apply(this,l)};if(e.on(["loadstart","texttrackchange"],s),r.addEventListener("change",s),r.addEventListener("selectedlanguagechange",a),this.on("dispose",function(){e.off(["loadstart","texttrackchange"],s),r.removeEventListener("change",s),r.removeEventListener("selectedlanguagechange",a)}),r.onchange===void 0){let l;this.on(["tap","click"],function(){if(typeof window$1.Event!="object")try{l=new window$1.Event("change")}catch{}l||(l=document$1.createEvent("Event"),l.initEvent("change",!0,!0)),r.dispatchEvent(l)})}this.handleTracksChange()}handleClick(e){const t=this.track,n=this.player_.textTracks();if(super.handleClick(e),!!n)for(let r=0;r<n.length;r++){const s=n[r];this.kinds.indexOf(s.kind)!==-1&&(s===t?s.mode!=="showing"&&(s.mode="showing"):s.mode!=="disabled"&&(s.mode="disabled"))}}handleTracksChange(e){const t=this.track.mode==="showing";t!==this.isSelected_&&this.selected(t)}handleSelectedLanguageChange(e){if(this.track.mode==="showing"){const t=this.player_.cache_.selectedLanguage;if(t&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}}dispose(){this.track=null,super.dispose()}}Component$1.registerComponent("TextTrackMenuItem",TextTrackMenuItem);class OffTextTrackMenuItem extends TextTrackMenuItem{constructor(e,t){t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.label?t.track.label=t.label:t.track.label=t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,super(e,t)}handleTracksChange(e){const t=this.player().textTracks();let n=!0;for(let r=0,s=t.length;r<s;r++){const a=t[r];if(this.options_.kinds.indexOf(a.kind)>-1&&a.mode==="showing"){n=!1;break}}n!==this.isSelected_&&this.selected(n)}handleSelectedLanguageChange(e){const t=this.player().textTracks();let n=!0;for(let r=0,s=t.length;r<s;r++){const a=t[r];if(["captions","descriptions","subtitles"].indexOf(a.kind)>-1&&a.mode==="showing"){n=!1;break}}n&&(this.player_.cache_.selectedLanguage={enabled:!1})}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.label),super.handleLanguagechange()}}Component$1.registerComponent("OffTextTrackMenuItem",OffTextTrackMenuItem);class TextTrackButton extends TrackButton{constructor(e,t={}){t.tracks=e.textTracks(),super(e,t)}createItems(e=[],t=TextTrackMenuItem){let n;this.label_&&(n=`${this.label_} off`),e.push(new OffTextTrackMenuItem(this.player_,{kinds:this.kinds_,kind:this.kind_,label:n})),this.hideThreshold_+=1;const r=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(let s=0;s<r.length;s++){const a=r[s];if(this.kinds_.indexOf(a.kind)>-1){const l=new t(this.player_,{track:a,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});l.addClass(`vjs-${a.kind}-menu-item`),e.push(l)}}return e}}Component$1.registerComponent("TextTrackButton",TextTrackButton);class ChaptersTrackMenuItem extends MenuItem{constructor(e,t){const n=t.track,r=t.cue,s=e.currentTime();t.selectable=!0,t.multiSelectable=!1,t.label=r.text,t.selected=r.startTime<=s&&s<r.endTime,super(e,t),this.track=n,this.cue=r}handleClick(e){super.handleClick(),this.player_.currentTime(this.cue.startTime)}}Component$1.registerComponent("ChaptersTrackMenuItem",ChaptersTrackMenuItem);class ChaptersButton extends TextTrackButton{constructor(e,t,n){super(e,t,n),this.setIcon("chapters"),this.selectCurrentItem_=()=>{this.items.forEach(r=>{r.selected(this.track_.activeCues[0]===r.cue)})}}buildCSSClass(){return`vjs-chapters-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-chapters-button ${super.buildWrapperCSSClass()}`}update(e){if(e&&e.track&&e.track.kind!=="chapters")return;const t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),super.update()):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&super.update()}setTrack(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){const t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";const t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}}findChaptersTrack(){const e=this.player_.textTracks()||[];for(let t=e.length-1;t>=0;t--){const n=e[t];if(n.kind===this.kind_)return n}}getMenuCaption(){return this.track_&&this.track_.label?this.track_.label:this.localize(toTitleCase$1(this.kind_))}createMenu(){return this.options_.title=this.getMenuCaption(),super.createMenu()}createItems(){const e=[];if(!this.track_)return e;const t=this.track_.cues;if(!t)return e;for(let n=0,r=t.length;n<r;n++){const s=t[n],a=new ChaptersTrackMenuItem(this.player_,{track:this.track_,cue:s});e.push(a)}return e}}ChaptersButton.prototype.kind_="chapters";ChaptersButton.prototype.controlText_="Chapters";Component$1.registerComponent("ChaptersButton",ChaptersButton);class DescriptionsButton extends TextTrackButton{constructor(e,t,n){super(e,t,n),this.setIcon("audio-description");const r=e.textTracks(),s=bind_(this,this.handleTracksChange);r.addEventListener("change",s),this.on("dispose",function(){r.removeEventListener("change",s)})}handleTracksChange(e){const t=this.player().textTracks();let n=!1;for(let r=0,s=t.length;r<s;r++){const a=t[r];if(a.kind!==this.kind_&&a.mode==="showing"){n=!0;break}}n?this.disable():this.enable()}buildCSSClass(){return`vjs-descriptions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-descriptions-button ${super.buildWrapperCSSClass()}`}}DescriptionsButton.prototype.kind_="descriptions";DescriptionsButton.prototype.controlText_="Descriptions";Component$1.registerComponent("DescriptionsButton",DescriptionsButton);class SubtitlesButton extends TextTrackButton{constructor(e,t,n){super(e,t,n),this.setIcon("subtitles")}buildCSSClass(){return`vjs-subtitles-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subtitles-button ${super.buildWrapperCSSClass()}`}}SubtitlesButton.prototype.kind_="subtitles";SubtitlesButton.prototype.controlText_="Subtitles";Component$1.registerComponent("SubtitlesButton",SubtitlesButton);class CaptionSettingsMenuItem extends TextTrackMenuItem{constructor(e,t){t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",super(e,t),this.addClass("vjs-texttrack-settings"),this.controlText(", opens "+t.kind+" settings dialog")}handleClick(e){this.player().getChild("textTrackSettings").open()}handleLanguagechange(){this.$(".vjs-menu-item-text").textContent=this.player_.localize(this.options_.kind+" settings"),super.handleLanguagechange()}}Component$1.registerComponent("CaptionSettingsMenuItem",CaptionSettingsMenuItem);class CaptionsButton extends TextTrackButton{constructor(e,t,n){super(e,t,n),this.setIcon("captions")}buildCSSClass(){return`vjs-captions-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-captions-button ${super.buildWrapperCSSClass()}`}createItems(){const e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new CaptionSettingsMenuItem(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),super.createItems(e)}}CaptionsButton.prototype.kind_="captions";CaptionsButton.prototype.controlText_="Captions";Component$1.registerComponent("CaptionsButton",CaptionsButton);class SubsCapsMenuItem extends TextTrackMenuItem{createEl(e,t,n){const r=super.createEl(e,t,n),s=r.querySelector(".vjs-menu-item-text");return this.options_.track.kind==="captions"&&(this.player_.options_.experimentalSvgIcons?this.setIcon("captions",r):s.appendChild(createEl("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),s.appendChild(createEl("span",{className:"vjs-control-text",textContent:` ${this.localize("Captions")}`}))),r}}Component$1.registerComponent("SubsCapsMenuItem",SubsCapsMenuItem);class SubsCapsButton extends TextTrackButton{constructor(e,t={}){super(e,t),this.label_="subtitles",this.setIcon("subtitles"),["en","en-us","en-ca","fr-ca"].indexOf(this.player_.language_)>-1&&(this.label_="captions",this.setIcon("captions")),this.menuButton_.controlText(toTitleCase$1(this.label_))}buildCSSClass(){return`vjs-subs-caps-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-subs-caps-button ${super.buildWrapperCSSClass()}`}createItems(){let e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new CaptionSettingsMenuItem(this.player_,{kind:this.label_})),this.hideThreshold_+=1),e=super.createItems(e,SubsCapsMenuItem),e}}SubsCapsButton.prototype.kinds_=["captions","subtitles"];SubsCapsButton.prototype.controlText_="Subtitles";Component$1.registerComponent("SubsCapsButton",SubsCapsButton);class AudioTrackMenuItem extends MenuItem{constructor(e,t){const n=t.track,r=e.audioTracks();t.label=n.label||n.language||"Unknown",t.selected=n.enabled,super(e,t),this.track=n,this.addClass(`vjs-${n.kind}-menu-item`);const s=(...a)=>{this.handleTracksChange.apply(this,a)};r.addEventListener("change",s),this.on("dispose",()=>{r.removeEventListener("change",s)})}createEl(e,t,n){const r=super.createEl(e,t,n),s=r.querySelector(".vjs-menu-item-text");return["main-desc","descriptions"].indexOf(this.options_.track.kind)>=0&&(s.appendChild(createEl("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),s.appendChild(createEl("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),r}handleClick(e){if(super.handleClick(e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks){const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const r=t[n];r!==this.track&&(r.enabled=r===this.track)}}}handleTracksChange(e){this.selected(this.track.enabled)}}Component$1.registerComponent("AudioTrackMenuItem",AudioTrackMenuItem);class AudioTrackButton extends TrackButton{constructor(e,t={}){t.tracks=e.audioTracks(),super(e,t),this.setIcon("audio")}buildCSSClass(){return`vjs-audio-button ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-audio-button ${super.buildWrapperCSSClass()}`}createItems(e=[]){this.hideThreshold_=1;const t=this.player_.audioTracks();for(let n=0;n<t.length;n++){const r=t[n];e.push(new AudioTrackMenuItem(this.player_,{track:r,selectable:!0,multiSelectable:!1}))}return e}}AudioTrackButton.prototype.controlText_="Audio Track";Component$1.registerComponent("AudioTrackButton",AudioTrackButton);class PlaybackRateMenuItem extends MenuItem{constructor(e,t){const n=t.rate,r=parseFloat(n,10);t.label=n,t.selected=r===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,super(e,t),this.label=n,this.rate=r,this.on(e,"ratechange",s=>this.update(s))}handleClick(e){super.handleClick(),this.player().playbackRate(this.rate)}update(e){this.selected(this.player().playbackRate()===this.rate)}}PlaybackRateMenuItem.prototype.contentElType="button";Component$1.registerComponent("PlaybackRateMenuItem",PlaybackRateMenuItem);class PlaybackRateMenuButton extends MenuButton{constructor(e,t){super(e,t),this.menuButton_.el_.setAttribute("aria-describedby",this.labelElId_),this.updateVisibility(),this.updateLabel(),this.on(e,"loadstart",n=>this.updateVisibility(n)),this.on(e,"ratechange",n=>this.updateLabel(n)),this.on(e,"playbackrateschange",n=>this.handlePlaybackRateschange(n))}createEl(){const e=super.createEl();return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=createEl("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e}dispose(){this.labelEl_=null,super.dispose()}buildCSSClass(){return`vjs-playback-rate ${super.buildCSSClass()}`}buildWrapperCSSClass(){return`vjs-playback-rate ${super.buildWrapperCSSClass()}`}createItems(){const e=this.playbackRates(),t=[];for(let n=e.length-1;n>=0;n--)t.push(new PlaybackRateMenuItem(this.player(),{rate:e[n]+"x"}));return t}handlePlaybackRateschange(e){this.update()}playbackRates(){const e=this.player();return e.playbackRates&&e.playbackRates()||[]}playbackRateSupported(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0}updateVisibility(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")}updateLabel(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")}}PlaybackRateMenuButton.prototype.controlText_="Playback Rate";Component$1.registerComponent("PlaybackRateMenuButton",PlaybackRateMenuButton);class Spacer extends Component$1{buildCSSClass(){return`vjs-spacer ${super.buildCSSClass()}`}createEl(e="div",t={},n={}){return t.className||(t.className=this.buildCSSClass()),super.createEl(e,t,n)}}Component$1.registerComponent("Spacer",Spacer);class CustomControlSpacer extends Spacer{buildCSSClass(){return`vjs-custom-control-spacer ${super.buildCSSClass()}`}createEl(){return super.createEl("div",{className:this.buildCSSClass(),textContent:""})}}Component$1.registerComponent("CustomControlSpacer",CustomControlSpacer);class ControlBar extends Component$1{createEl(){return super.createEl("div",{className:"vjs-control-bar",dir:"ltr"})}}ControlBar.prototype.options_={children:["playToggle","skipBackward","skipForward","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","pictureInPictureToggle","fullscreenToggle"]};Component$1.registerComponent("ControlBar",ControlBar);class ErrorDisplay extends ModalDialog{constructor(e,t){super(e,t),this.on(e,"error",n=>{this.open(n)})}buildCSSClass(){return`vjs-error-display ${super.buildCSSClass()}`}content(){const e=this.player().error();return e?this.localize(e.message):""}}ErrorDisplay.prototype.options_=Object.assign({},ModalDialog.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0});Component$1.registerComponent("ErrorDisplay",ErrorDisplay);class TextTrackSelect extends Component$1{constructor(e,t={}){super(e,t),this.el_.setAttribute("aria-labelledby",this.selectLabelledbyIds)}createEl(){return this.selectLabelledbyIds=[this.options_.legendId,this.options_.labelId].join(" ").trim(),createEl("select",{id:this.options_.id},{},this.options_.SelectOptions.map(t=>{const n=(this.options_.labelId?this.options_.labelId:`vjs-track-option-${newGUID()}`)+"-"+t[1].replace(/\W+/g,""),r=createEl("option",{id:n,value:this.localize(t[0]),textContent:this.localize(t[1])});return r.setAttribute("aria-labelledby",`${this.selectLabelledbyIds} ${n}`),r}))}}Component$1.registerComponent("TextTrackSelect",TextTrackSelect);class TextTrackFieldset extends Component$1{constructor(e,t={}){super(e,t);const n=createEl("legend",{textContent:this.localize(this.options_.legendText),id:this.options_.legendId});this.el().appendChild(n);const r=this.options_.selects;for(const s of r){const a=this.options_.selectConfigs[s],l=a.className,u=a.id.replace("%s",this.options_.id_);let d=null;const h=`vjs_select_${newGUID()}`;if(this.options_.type==="colors"){d=createEl("span",{className:l});const m=createEl("label",{id:u,className:"vjs-label",textContent:this.localize(a.label)});m.setAttribute("for",h),d.appendChild(m)}const p=new TextTrackSelect(e,{SelectOptions:a.options,legendId:this.options_.legendId,id:h,labelId:u});this.addChild(p),this.options_.type==="colors"&&(d.appendChild(p.el()),this.el().appendChild(d))}}createEl(){return createEl("fieldset",{className:this.options_.className})}}Component$1.registerComponent("TextTrackFieldset",TextTrackFieldset);class TextTrackSettingsColors extends Component$1{constructor(e,t={}){super(e,t);const n=this.options_.textTrackComponentid,r=new TextTrackFieldset(e,{id_:n,legendId:`captions-text-legend-${n}`,legendText:this.localize("Text"),className:"vjs-fg vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(r);const s=new TextTrackFieldset(e,{id_:n,legendId:`captions-background-${n}`,legendText:this.localize("Text Background"),className:"vjs-bg vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(s);const a=new TextTrackFieldset(e,{id_:n,legendId:`captions-window-${n}`,legendText:this.localize("Caption Area Background"),className:"vjs-window vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"colors"});this.addChild(a)}createEl(){return createEl("div",{className:"vjs-track-settings-colors"})}}Component$1.registerComponent("TextTrackSettingsColors",TextTrackSettingsColors);class TextTrackSettingsFont extends Component$1{constructor(e,t={}){super(e,t);const n=this.options_.textTrackComponentid,r=new TextTrackFieldset(e,{id_:n,legendId:`captions-font-size-${n}`,legendText:"Font Size",className:"vjs-font-percent vjs-track-setting",selects:this.options_.fieldSets[0],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(r);const s=new TextTrackFieldset(e,{id_:n,legendId:`captions-edge-style-${n}`,legendText:this.localize("Text Edge Style"),className:"vjs-edge-style vjs-track-setting",selects:this.options_.fieldSets[1],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(s);const a=new TextTrackFieldset(e,{id_:n,legendId:`captions-font-family-${n}`,legendText:this.localize("Font Family"),className:"vjs-font-family vjs-track-setting",selects:this.options_.fieldSets[2],selectConfigs:this.options_.selectConfigs,type:"font"});this.addChild(a)}createEl(){return createEl("div",{className:"vjs-track-settings-font"})}}Component$1.registerComponent("TextTrackSettingsFont",TextTrackSettingsFont);class TrackSettingsControls extends Component$1{constructor(e,t={}){super(e,t);const n=new Button(e,{controlText:this.localize("restore all settings to the default values"),className:"vjs-default-button"});n.el().classList.remove("vjs-control","vjs-button"),n.el().textContent=this.localize("Reset"),this.addChild(n);const r=this.localize("Done"),s=new Button(e,{controlText:r,className:"vjs-done-button"});s.el().classList.remove("vjs-control","vjs-button"),s.el().textContent=r,this.addChild(s)}createEl(){return createEl("div",{className:"vjs-track-settings-controls"})}}Component$1.registerComponent("TrackSettingsControls",TrackSettingsControls);const LOCAL_STORAGE_KEY$1="vjs-text-track-settings",COLOR_BLACK=["#000","Black"],COLOR_BLUE=["#00F","Blue"],COLOR_CYAN=["#0FF","Cyan"],COLOR_GREEN=["#0F0","Green"],COLOR_MAGENTA=["#F0F","Magenta"],COLOR_RED=["#F00","Red"],COLOR_WHITE=["#FFF","White"],COLOR_YELLOW=["#FF0","Yellow"],OPACITY_OPAQUE=["1","Opaque"],OPACITY_SEMI=["0.5","Semi-Transparent"],OPACITY_TRANS=["0","Transparent"],selectConfigs={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[COLOR_BLACK,COLOR_WHITE,COLOR_RED,COLOR_GREEN,COLOR_BLUE,COLOR_YELLOW,COLOR_MAGENTA,COLOR_CYAN],className:"vjs-bg-color"},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Opacity",options:[OPACITY_OPAQUE,OPACITY_SEMI,OPACITY_TRANS],className:"vjs-bg-opacity vjs-opacity"},color:{selector:".vjs-text-color > select",id:"captions-foreground-color-%s",label:"Color",options:[COLOR_WHITE,COLOR_BLACK,COLOR_RED,COLOR_GREEN,COLOR_BLUE,COLOR_YELLOW,COLOR_MAGENTA,COLOR_CYAN],className:"vjs-text-color"},edgeStyle:{selector:".vjs-edge-style > select",id:"",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Drop shadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:i=>i==="1.00"?null:Number(i)},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Opacity",options:[OPACITY_OPAQUE,OPACITY_SEMI],className:"vjs-text-opacity vjs-opacity"},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color",className:"vjs-window-color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Opacity",options:[OPACITY_TRANS,OPACITY_SEMI,OPACITY_OPAQUE],className:"vjs-window-opacity vjs-opacity"}};selectConfigs.windowColor.options=selectConfigs.backgroundColor.options;function parseOptionValue(i,e){if(e&&(i=e(i)),i&&i!=="none")return i}function getSelectedOptionValue(i,e){const t=i.options[i.options.selectedIndex].value;return parseOptionValue(t,e)}function setSelectedOption(i,e,t){if(e){for(let n=0;n<i.options.length;n++)if(parseOptionValue(i.options[n].value,t)===e){i.selectedIndex=n;break}}}class TextTrackSettings extends ModalDialog{constructor(e,t){t.temporary=!1,super(e,t),this.updateDisplay=this.updateDisplay.bind(this),this.fill(),this.hasBeenOpened_=this.hasBeenFilled_=!0,this.renderModalComponents(e),this.endDialog=createEl("p",{className:"vjs-control-text",textContent:this.localize("End of dialog window.")}),this.el().appendChild(this.endDialog),this.setDefaults(),t.persistTextTrackSettings===void 0&&(this.options_.persistTextTrackSettings=this.options_.playerOptions.persistTextTrackSettings),this.bindFunctionsToSelectsAndButtons(),this.options_.persistTextTrackSettings&&this.restoreSettings()}renderModalComponents(e){const t=new TextTrackSettingsColors(e,{textTrackComponentid:this.id_,selectConfigs,fieldSets:[["color","textOpacity"],["backgroundColor","backgroundOpacity"],["windowColor","windowOpacity"]]});this.addChild(t);const n=new TextTrackSettingsFont(e,{textTrackComponentid:this.id_,selectConfigs,fieldSets:[["fontPercent"],["edgeStyle"],["fontFamily"]]});this.addChild(n);const r=new TrackSettingsControls(e);this.addChild(r)}bindFunctionsToSelectsAndButtons(){this.on(this.$(".vjs-done-button"),["click","tap"],()=>{this.saveSettings(),this.close()}),this.on(this.$(".vjs-default-button"),["click","tap"],()=>{this.setDefaults(),this.updateDisplay()}),each(selectConfigs,e=>{this.on(this.$(e.selector),"change",this.updateDisplay)})}dispose(){this.endDialog=null,super.dispose()}label(){return this.localize("Caption Settings Dialog")}description(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")}buildCSSClass(){return super.buildCSSClass()+" vjs-text-track-settings"}getValues(){return reduce(selectConfigs,(e,t,n)=>{const r=getSelectedOptionValue(this.$(t.selector),t.parser);return r!==void 0&&(e[n]=r),e},{})}setValues(e){each(selectConfigs,(t,n)=>{setSelectedOption(this.$(t.selector),e[n],t.parser)})}setDefaults(){each(selectConfigs,e=>{const t=e.hasOwnProperty("default")?e.default:0;this.$(e.selector).selectedIndex=t})}restoreSettings(){let e;try{e=JSON.parse(window$1.localStorage.getItem(LOCAL_STORAGE_KEY$1))}catch(t){log$1.warn(t)}e&&this.setValues(e)}saveSettings(){if(!this.options_.persistTextTrackSettings)return;const e=this.getValues();try{Object.keys(e).length?window$1.localStorage.setItem(LOCAL_STORAGE_KEY$1,JSON.stringify(e)):window$1.localStorage.removeItem(LOCAL_STORAGE_KEY$1)}catch(t){log$1.warn(t)}}updateDisplay(){const e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()}handleLanguagechange(){this.fill(),this.renderModalComponents(this.player_),this.bindFunctionsToSelectsAndButtons()}}Component$1.registerComponent("TextTrackSettings",TextTrackSettings);class ResizeManager extends Component$1{constructor(e,t){let n=t.ResizeObserver||window$1.ResizeObserver;t.ResizeObserver===null&&(n=!1);const r=merge$1({createEl:!n,reportTouchActivity:!1},t);super(e,r),this.ResizeObserver=t.ResizeObserver||window$1.ResizeObserver,this.loadListener_=null,this.resizeObserver_=null,this.debouncedHandler_=debounce$1(()=>{this.resizeHandler()},100,!1,this),n?(this.resizeObserver_=new this.ResizeObserver(this.debouncedHandler_),this.resizeObserver_.observe(e.el())):(this.loadListener_=()=>{if(!this.el_||!this.el_.contentWindow)return;const s=this.debouncedHandler_;let a=this.unloadListener_=function(){off(this,"resize",s),off(this,"unload",a),a=null};on(this.el_.contentWindow,"unload",a),on(this.el_.contentWindow,"resize",s)},this.one("load",this.loadListener_))}createEl(){return super.createEl("iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})}resizeHandler(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")}dispose(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,super.dispose()}}Component$1.registerComponent("ResizeManager",ResizeManager);const defaults$1={trackingThreshold:20,liveTolerance:15};class LiveTracker extends Component$1{constructor(e,t){const n=merge$1(defaults$1,t,{createEl:!1});super(e,n),this.trackLiveHandler_=()=>this.trackLive_(),this.handlePlay_=r=>this.handlePlay(r),this.handleFirstTimeupdate_=r=>this.handleFirstTimeupdate(r),this.handleSeeked_=r=>this.handleSeeked(r),this.seekToLiveEdge_=r=>this.seekToLiveEdge(r),this.reset_(),this.on(this.player_,"durationchange",r=>this.handleDurationchange(r)),this.on(this.player_,"canplay",()=>this.toggleTracking())}trackLive_(){const e=this.player_.seekable();if(!e||!e.length)return;const t=Number(window$1.performance.now().toFixed(4)),n=this.lastTime_===-1?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+n;const r=this.liveCurrentTime(),s=this.player_.currentTime();let a=this.player_.paused()||this.seekedBehindLive_||Math.abs(r-s)>this.options_.liveTolerance;(!this.timeupdateSeen_||r===1/0)&&(a=!1),a!==this.behindLiveEdge_&&(this.behindLiveEdge_=a,this.trigger("liveedgechange"))}handleDurationchange(){this.toggleTracking()}toggleTracking(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())}startTracking(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,UPDATE_REFRESH_INTERVAL),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))}handleFirstTimeupdate(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)}handleSeeked(){const e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()}handlePlay(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)}reset_(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)}nextSeekedFromUser(){this.nextSeekedFromUser_=!0}stopTracking(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))}seekableEnd(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.end(n));return t.length?t.sort()[t.length-1]:1/0}seekableStart(){const e=this.player_.seekable(),t=[];let n=e?e.length:0;for(;n--;)t.push(e.start(n));return t.length?t.sort()[0]:0}liveWindow(){const e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()}isLive(){return this.isTracking()}atLiveEdge(){return!this.behindLiveEdge()}liveCurrentTime(){return this.pastSeekEnd()+this.seekableEnd()}pastSeekEnd(){const e=this.seekableEnd();return this.lastSeekEnd_!==-1&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_}behindLiveEdge(){return this.behindLiveEdge_}isTracking(){return typeof this.trackingInterval_=="number"}seekToLiveEdge(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))}dispose(){this.stopTracking(),super.dispose()}}Component$1.registerComponent("LiveTracker",LiveTracker);class TitleBar extends Component$1{constructor(e,t){super(e,t),this.on("statechanged",n=>this.updateDom_()),this.updateDom_()}createEl(){return this.els={title:createEl("div",{className:"vjs-title-bar-title",id:`vjs-title-bar-title-${newGUID()}`}),description:createEl("div",{className:"vjs-title-bar-description",id:`vjs-title-bar-description-${newGUID()}`})},createEl("div",{className:"vjs-title-bar"},{},values(this.els))}updateDom_(){const e=this.player_.tech_,t=e&&e.el_,n={title:"aria-labelledby",description:"aria-describedby"};["title","description"].forEach(r=>{const s=this.state[r],a=this.els[r],l=n[r];emptyEl(a),s&&textContent(a,s),t&&(t.removeAttribute(l),s&&t.setAttribute(l,a.id))}),this.state.title||this.state.description?this.show():this.hide()}update(e){this.setState(e)}dispose(){const e=this.player_.tech_,t=e&&e.el_;t&&(t.removeAttribute("aria-labelledby"),t.removeAttribute("aria-describedby")),super.dispose(),this.els=null}}Component$1.registerComponent("TitleBar",TitleBar);const defaults={initialDisplay:4e3,position:[],takeFocus:!1};class TransientButton extends Button{constructor(e,t){t=merge$1(defaults,t),super(e,t),this.controlText(t.controlText),this.hide(),this.on(this.player_,["useractive","userinactive"],n=>{this.removeClass("force-display")})}buildCSSClass(){return`vjs-transient-button focus-visible ${this.options_.position.map(e=>`vjs-${e}`).join(" ")}`}createEl(){const e=createEl("button",{},{type:"button",class:this.buildCSSClass()},createEl("span"));return this.controlTextEl_=e.querySelector("span"),e}show(){super.show(),this.addClass("force-display"),this.options_.takeFocus&&this.el().focus({preventScroll:!0}),this.forceDisplayTimeout=this.player_.setTimeout(()=>{this.removeClass("force-display")},this.options_.initialDisplay)}hide(){this.removeClass("force-display"),super.hide()}dispose(){this.player_.clearTimeout(this.forceDisplayTimeout),super.dispose()}}Component$1.registerComponent("TransientButton",TransientButton);const sourcesetLoad=i=>{const e=i.el();if(e.hasAttribute("src"))return i.triggerSourceset(e.src),!0;const t=i.$$("source"),n=[];let r="";if(!t.length)return!1;for(let s=0;s<t.length;s++){const a=t[s].src;a&&n.indexOf(a)===-1&&n.push(a)}return n.length?(n.length===1&&(r=n[0]),i.triggerSourceset(r),!0):!1},innerHTMLDescriptorPolyfill=Object.defineProperty({},"innerHTML",{get(){return this.cloneNode(!0).innerHTML},set(i){const e=document$1.createElement(this.nodeName.toLowerCase());e.innerHTML=i;const t=document$1.createDocumentFragment();for(;e.childNodes.length;)t.appendChild(e.childNodes[0]);return this.innerText="",window$1.Element.prototype.appendChild.call(this,t),this.innerHTML}}),getDescriptor=(i,e)=>{let t={};for(let n=0;n<i.length&&(t=Object.getOwnPropertyDescriptor(i[n],e),!(t&&t.set&&t.get));n++);return t.enumerable=!0,t.configurable=!0,t},getInnerHTMLDescriptor=i=>getDescriptor([i.el(),window$1.HTMLMediaElement.prototype,window$1.Element.prototype,innerHTMLDescriptorPolyfill],"innerHTML"),firstSourceWatch=function(i){const e=i.el();if(e.resetSourceWatch_)return;const t={},n=getInnerHTMLDescriptor(i),r=s=>(...a)=>{const l=s.apply(e,a);return sourcesetLoad(i),l};["append","appendChild","insertAdjacentHTML"].forEach(s=>{e[s]&&(t[s]=e[s],e[s]=r(t[s]))}),Object.defineProperty(e,"innerHTML",merge$1(n,{set:r(n.set)})),e.resetSourceWatch_=()=>{e.resetSourceWatch_=null,Object.keys(t).forEach(s=>{e[s]=t[s]}),Object.defineProperty(e,"innerHTML",n)},i.one("sourceset",e.resetSourceWatch_)},srcDescriptorPolyfill=Object.defineProperty({},"src",{get(){return this.hasAttribute("src")?getAbsoluteURL(window$1.Element.prototype.getAttribute.call(this,"src")):""},set(i){return window$1.Element.prototype.setAttribute.call(this,"src",i),i}}),getSrcDescriptor=i=>getDescriptor([i.el(),window$1.HTMLMediaElement.prototype,srcDescriptorPolyfill],"src"),setupSourceset=function(i){if(!i.featuresSourceset)return;const e=i.el();if(e.resetSourceset_)return;const t=getSrcDescriptor(i),n=e.setAttribute,r=e.load;Object.defineProperty(e,"src",merge$1(t,{set:s=>{const a=t.set.call(e,s);return i.triggerSourceset(e.src),a}})),e.setAttribute=(s,a)=>{const l=n.call(e,s,a);return/src/i.test(s)&&i.triggerSourceset(e.src),l},e.load=()=>{const s=r.call(e);return sourcesetLoad(i)||(i.triggerSourceset(""),firstSourceWatch(i)),s},e.currentSrc?i.triggerSourceset(e.currentSrc):sourcesetLoad(i)||firstSourceWatch(i),e.resetSourceset_=()=>{e.resetSourceset_=null,e.load=r,e.setAttribute=n,Object.defineProperty(e,"src",t),e.resetSourceWatch_&&e.resetSourceWatch_()}};class Html5 extends Tech{constructor(e,t){super(e,t);const n=e.source;let r=!1;if(this.featuresVideoFrameCallback=this.featuresVideoFrameCallback&&this.el_.tagName==="VIDEO",n&&(this.el_.currentSrc!==n.src||e.tag&&e.tag.initNetworkState_===3)?this.setSource(n):this.handleLateInit_(this.el_),e.enableSourceset&&this.setupSourcesetHandling_(),this.isScrubbing_=!1,this.el_.hasChildNodes()){const s=this.el_.childNodes;let a=s.length;const l=[];for(;a--;){const u=s[a];u.nodeName.toLowerCase()==="track"&&(this.featuresNativeTextTracks?(this.remoteTextTrackEls().addTrackElement_(u),this.remoteTextTracks().addTrack(u.track),this.textTracks().addTrack(u.track),!r&&!this.el_.hasAttribute("crossorigin")&&isCrossOrigin(u.src)&&(r=!0)):l.push(u))}for(let u=0;u<l.length;u++)this.el_.removeChild(l[u])}this.proxyNativeTracks_(),this.featuresNativeTextTracks&&r&&log$1.warn(`Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.
This may prevent text tracks from loading.`),this.restoreMetadataTracksInIOSNativePlayer_(),(TOUCH_ENABLED||IS_IPHONE)&&e.nativeControlsForTouch===!0&&this.setControls(!0),this.proxyWebkitFullscreen_(),this.triggerReady()}dispose(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),Html5.disposeMediaElement(this.el_),this.options_=null,super.dispose()}setupSourcesetHandling_(){setupSourceset(this)}restoreMetadataTracksInIOSNativePlayer_(){const e=this.textTracks();let t;const n=()=>{t=[];for(let s=0;s<e.length;s++){const a=e[s];a.kind==="metadata"&&t.push({track:a,storedMode:a.mode})}};n(),e.addEventListener("change",n),this.on("dispose",()=>e.removeEventListener("change",n));const r=()=>{for(let s=0;s<t.length;s++){const a=t[s];a.track.mode==="disabled"&&a.track.mode!==a.storedMode&&(a.track.mode=a.storedMode)}e.removeEventListener("change",r)};this.on("webkitbeginfullscreen",()=>{e.removeEventListener("change",n),e.removeEventListener("change",r),e.addEventListener("change",r)}),this.on("webkitendfullscreen",()=>{e.removeEventListener("change",n),e.addEventListener("change",n),e.removeEventListener("change",r)})}overrideNative_(e,t){if(t!==this[`featuresNative${e}Tracks`])return;const n=e.toLowerCase();this[`${n}TracksListeners_`]&&Object.keys(this[`${n}TracksListeners_`]).forEach(r=>{this.el()[`${n}Tracks`].removeEventListener(r,this[`${n}TracksListeners_`][r])}),this[`featuresNative${e}Tracks`]=!t,this[`${n}TracksListeners_`]=null,this.proxyNativeTracksForType_(n)}overrideNativeAudioTracks(e){this.overrideNative_("Audio",e)}overrideNativeVideoTracks(e){this.overrideNative_("Video",e)}proxyNativeTracksForType_(e){const t=NORMAL[e],n=this.el()[t.getterName],r=this[t.getterName]();if(!this[`featuresNative${t.capitalName}Tracks`]||!n||!n.addEventListener)return;const s={change:l=>{const u={type:"change",target:r,currentTarget:r,srcElement:r};r.trigger(u),e==="text"&&this[REMOTE.remoteText.getterName]().trigger(u)},addtrack(l){r.addTrack(l.track)},removetrack(l){r.removeTrack(l.track)}},a=function(){const l=[];for(let u=0;u<r.length;u++){let d=!1;for(let h=0;h<n.length;h++)if(n[h]===r[u]){d=!0;break}d||l.push(r[u])}for(;l.length;)r.removeTrack(l.shift())};this[t.getterName+"Listeners_"]=s,Object.keys(s).forEach(l=>{const u=s[l];n.addEventListener(l,u),this.on("dispose",d=>n.removeEventListener(l,u))}),this.on("loadstart",a),this.on("dispose",l=>this.off("loadstart",a))}proxyNativeTracks_(){NORMAL.names.forEach(e=>{this.proxyNativeTracksForType_(e)})}createEl(){let e=this.options_.tag;if(!e||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(e){const n=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(n,e),Html5.disposeMediaElement(e),e=n}else{e=document$1.createElement("video");const n=this.options_.tag&&getAttributes(this.options_.tag),r=merge$1({},n);(!TOUCH_ENABLED||this.options_.nativeControlsForTouch!==!0)&&delete r.controls,setAttributes(e,Object.assign(r,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}typeof this.options_.preload<"u"&&setAttribute(e,"preload",this.options_.preload),this.options_.disablePictureInPicture!==void 0&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);const t=["loop","muted","playsinline","autoplay"];for(let n=0;n<t.length;n++){const r=t[n],s=this.options_[r];typeof s<"u"&&(s?setAttribute(e,r,r):removeAttribute(e,r),e[r]=s)}return e}handleLateInit_(e){if(e.networkState===0||e.networkState===3)return;if(e.readyState===0){let n=!1;const r=function(){n=!0};this.on("loadstart",r);const s=function(){n||this.trigger("loadstart")};this.on("loadedmetadata",s),this.ready(function(){this.off("loadstart",r),this.off("loadedmetadata",s),n||this.trigger("loadstart")});return}const t=["loadstart"];t.push("loadedmetadata"),e.readyState>=2&&t.push("loadeddata"),e.readyState>=3&&t.push("canplay"),e.readyState>=4&&t.push("canplaythrough"),this.ready(function(){t.forEach(function(n){this.trigger(n)},this)})}setScrubbing(e){this.isScrubbing_=e}scrubbing(){return this.isScrubbing_}setCurrentTime(e){try{this.isScrubbing_&&this.el_.fastSeek&&IS_ANY_SAFARI?this.el_.fastSeek(e):this.el_.currentTime=e}catch(t){log$1(t,"Video is not ready. (Video.js)")}}duration(){if(this.el_.duration===1/0&&IS_ANDROID&&IS_CHROME&&this.el_.currentTime===0){const e=()=>{this.el_.currentTime>0&&(this.el_.duration===1/0&&this.trigger("durationchange"),this.off("timeupdate",e))};return this.on("timeupdate",e),NaN}return this.el_.duration||NaN}width(){return this.el_.offsetWidth}height(){return this.el_.offsetHeight}proxyWebkitFullscreen_(){if(!("webkitDisplayingFullscreen"in this.el_))return;const e=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},t=function(){"webkitPresentationMode"in this.el_&&this.el_.webkitPresentationMode!=="picture-in-picture"&&(this.one("webkitendfullscreen",e),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",t),this.on("dispose",()=>{this.off("webkitbeginfullscreen",t),this.off("webkitendfullscreen",e)})}supportsFullScreen(){return typeof this.el_.webkitEnterFullScreen=="function"}enterFullScreen(){const e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)silencePromise(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},0);else try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}}exitFullScreen(){if(!this.el_.webkitDisplayingFullscreen){this.trigger("fullscreenerror",new Error("The video is not fullscreen"));return}this.el_.webkitExitFullScreen()}requestPictureInPicture(){return this.el_.requestPictureInPicture()}requestVideoFrameCallback(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):super.requestVideoFrameCallback(e)}cancelVideoFrameCallback(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):super.cancelVideoFrameCallback(e)}src(e){if(e===void 0)return this.el_.src;this.setSrc(e)}addSourceElement(e,t){if(!e)return log$1.error("Invalid source URL."),!1;const n={src:e};t&&(n.type=t);const r=createEl("source",{},n);return this.el_.appendChild(r),!0}removeSourceElement(e){if(!e)return log$1.error("Source URL is required to remove the source element."),!1;const t=this.el_.querySelectorAll("source");for(const n of t)if(n.src===e)return this.el_.removeChild(n),!0;return log$1.warn(`No matching source element found with src: ${e}`),!1}reset(){Html5.resetMediaElement(this.el_)}currentSrc(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc}setControls(e){this.el_.controls=!!e}addTextTrack(e,t,n){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,n):super.addTextTrack(e,t,n)}createRemoteTextTrack(e){if(!this.featuresNativeTextTracks)return super.createRemoteTextTrack(e);const t=document$1.createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t}addRemoteTextTrack(e,t){const n=super.addRemoteTextTrack(e,t);return this.featuresNativeTextTracks&&this.el().appendChild(n),n}removeRemoteTextTrack(e){if(super.removeRemoteTextTrack(e),this.featuresNativeTextTracks){const t=this.$$("track");let n=t.length;for(;n--;)(e===t[n]||e===t[n].track)&&this.el().removeChild(t[n])}}getVideoPlaybackQuality(){if(typeof this.el().getVideoPlaybackQuality=="function")return this.el().getVideoPlaybackQuality();const e={};return typeof this.el().webkitDroppedFrameCount<"u"&&typeof this.el().webkitDecodedFrameCount<"u"&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),window$1.performance&&(e.creationTime=window$1.performance.now()),e}}defineLazyProperty(Html5,"TEST_VID",function(){if(!isReal())return;const i=document$1.createElement("video"),e=document$1.createElement("track");return e.kind="captions",e.srclang="en",e.label="English",i.appendChild(e),i});Html5.isSupported=function(){try{Html5.TEST_VID.volume=.5}catch{return!1}return!!(Html5.TEST_VID&&Html5.TEST_VID.canPlayType)};Html5.canPlayType=function(i){return Html5.TEST_VID.canPlayType(i)};Html5.canPlaySource=function(i,e){return Html5.canPlayType(i.type)};Html5.canControlVolume=function(){try{const i=Html5.TEST_VID.volume;Html5.TEST_VID.volume=i/2+.1;const e=i!==Html5.TEST_VID.volume;return e&&IS_IOS?(window$1.setTimeout(()=>{Html5&&Html5.prototype&&(Html5.prototype.featuresVolumeControl=i!==Html5.TEST_VID.volume)}),!1):e}catch{return!1}};Html5.canMuteVolume=function(){try{const i=Html5.TEST_VID.muted;return Html5.TEST_VID.muted=!i,Html5.TEST_VID.muted?setAttribute(Html5.TEST_VID,"muted","muted"):removeAttribute(Html5.TEST_VID,"muted","muted"),i!==Html5.TEST_VID.muted}catch{return!1}};Html5.canControlPlaybackRate=function(){if(IS_ANDROID&&IS_CHROME&&CHROME_VERSION<58)return!1;try{const i=Html5.TEST_VID.playbackRate;return Html5.TEST_VID.playbackRate=i/2+.1,i!==Html5.TEST_VID.playbackRate}catch{return!1}};Html5.canOverrideAttributes=function(){try{const i=()=>{};Object.defineProperty(document$1.createElement("video"),"src",{get:i,set:i}),Object.defineProperty(document$1.createElement("audio"),"src",{get:i,set:i}),Object.defineProperty(document$1.createElement("video"),"innerHTML",{get:i,set:i}),Object.defineProperty(document$1.createElement("audio"),"innerHTML",{get:i,set:i})}catch{return!1}return!0};Html5.supportsNativeTextTracks=function(){return IS_ANY_SAFARI||IS_IOS&&IS_CHROME};Html5.supportsNativeVideoTracks=function(){return!!(Html5.TEST_VID&&Html5.TEST_VID.videoTracks)};Html5.supportsNativeAudioTracks=function(){return!!(Html5.TEST_VID&&Html5.TEST_VID.audioTracks)};Html5.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"];[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function([i,e]){defineLazyProperty(Html5.prototype,i,()=>Html5[e](),!0)});Html5.prototype.featuresVolumeControl=Html5.canControlVolume();Html5.prototype.movingMediaElementInDOM=!IS_IOS;Html5.prototype.featuresFullscreenResize=!0;Html5.prototype.featuresProgressEvents=!0;Html5.prototype.featuresTimeupdateEvents=!0;Html5.prototype.featuresVideoFrameCallback=!!(Html5.TEST_VID&&Html5.TEST_VID.requestVideoFrameCallback);Html5.disposeMediaElement=function(i){if(i){for(i.parentNode&&i.parentNode.removeChild(i);i.hasChildNodes();)i.removeChild(i.firstChild);i.removeAttribute("src"),typeof i.load=="function"&&(function(){try{i.load()}catch{}})()}};Html5.resetMediaElement=function(i){if(!i)return;const e=i.querySelectorAll("source");let t=e.length;for(;t--;)i.removeChild(e[t]);i.removeAttribute("src"),typeof i.load=="function"&&(function(){try{i.load()}catch{}})()};["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(i){Html5.prototype[i]=function(){return this.el_[i]||this.el_.hasAttribute(i)}});["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(i){Html5.prototype["set"+toTitleCase$1(i)]=function(e){this.el_[i]=e,e?this.el_.setAttribute(i,i):this.el_.removeAttribute(i)}});["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(i){Html5.prototype[i]=function(){return this.el_[i]}});["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(i){Html5.prototype["set"+toTitleCase$1(i)]=function(e){this.el_[i]=e}});["pause","load","play"].forEach(function(i){Html5.prototype[i]=function(){return this.el_[i]()}});Tech.withSourceHandlers(Html5);Html5.nativeSourceHandler={};Html5.nativeSourceHandler.canPlayType=function(i){try{return Html5.TEST_VID.canPlayType(i)}catch{return""}};Html5.nativeSourceHandler.canHandleSource=function(i,e){if(i.type)return Html5.nativeSourceHandler.canPlayType(i.type);if(i.src){const t=getFileExtension(i.src);return Html5.nativeSourceHandler.canPlayType(`video/${t}`)}return""};Html5.nativeSourceHandler.handleSource=function(i,e,t){e.setSrc(i.src)};Html5.nativeSourceHandler.dispose=function(){};Html5.registerSourceHandler(Html5.nativeSourceHandler);Tech.registerTech("Html5",Html5);const TECH_EVENTS_RETRIGGER=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],TECH_EVENTS_QUEUE={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},BREAKPOINT_ORDER=["tiny","xsmall","small","medium","large","xlarge","huge"],BREAKPOINT_CLASSES={};BREAKPOINT_ORDER.forEach(i=>{const e=i.charAt(0)==="x"?`x-${i.substring(1)}`:i;BREAKPOINT_CLASSES[i]=`vjs-layout-${e}`});const DEFAULT_BREAKPOINTS={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};class Player extends Component$1{constructor(e,t,n){if(e.id=e.id||t.id||`vjs_video_${newGUID()}`,t=Object.assign(Player.getTagSettings(e),t),t.initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language){const a=e.closest("[lang]");a&&(t.language=a.getAttribute("lang"))}if(super(null,t,n),this.boundDocumentFullscreenChange_=a=>this.documentFullscreenChange_(a),this.boundFullWindowOnEscKey_=a=>this.fullWindowOnEscKey(a),this.boundUpdateStyleEl_=a=>this.updateStyleEl_(a),this.boundApplyInitTime_=a=>this.applyInitTime_(a),this.boundUpdateCurrentBreakpoint_=a=>this.updateCurrentBreakpoint_(a),this.boundHandleTechClick_=a=>this.handleTechClick_(a),this.boundHandleTechDoubleClick_=a=>this.handleTechDoubleClick_(a),this.boundHandleTechTouchStart_=a=>this.handleTechTouchStart_(a),this.boundHandleTechTouchMove_=a=>this.handleTechTouchMove_(a),this.boundHandleTechTouchEnd_=a=>this.handleTechTouchEnd_(a),this.boundHandleTechTap_=a=>this.handleTechTap_(a),this.boundUpdatePlayerHeightOnAudioOnlyMode_=a=>this.updatePlayerHeightOnAudioOnlyMode_(a),this.isFullscreen_=!1,this.log=createLogger(this.id_),this.fsApi_=FullscreenApi,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,this.audioOnlyMode_=!1,this.audioPosterMode_=!1,this.audioOnlyCache_={controlBarHeight:null,playerHeight:null,hiddenChildren:[]},!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&getAttributes(e),this.language(this.options_.language),t.languages){const a={};Object.getOwnPropertyNames(t.languages).forEach(function(l){a[l.toLowerCase()]=t.languages[l]}),this.languages_=a}else this.languages_=Player.prototype.options_.languages;this.resetCache_(),this.poster_=t.poster||"",this.controls_=!!t.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach(a=>{if(typeof this[a]!="function")throw new Error(`plugin "${a}" does not exist`)}),this.scrubbing_=!1,this.el_=this.createEl(),evented(this,{eventBusKey:"el_"}),this.fsApi_.requestFullscreen&&(on(document$1,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.on(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.on(["playerreset","resize"],this.boundUpdateStyleEl_);const r=merge$1(this.options_);if(t.plugins&&Object.keys(t.plugins).forEach(a=>{this[a](t.plugins[a])}),t.debug&&this.debug(!0),this.options_.playerOptions=r,this.middleware_=[],this.playbackRates(t.playbackRates),t.experimentalSvgIcons){const l=new window$1.DOMParser().parseFromString(icons,"image/svg+xml");if(l.querySelector("parsererror"))log$1.warn("Failed to load SVG Icons. Falling back to Font Icons."),this.options_.experimentalSvgIcons=null;else{const d=l.documentElement;d.style.display="none",this.el_.appendChild(d),this.addClass("vjs-svg-icons-enabled")}}this.initChildren(),this.isAudio(e.nodeName.toLowerCase()==="audio"),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),t.spatialNavigation&&t.spatialNavigation.enabled&&(this.spatialNavigation=new SpatialNavigation(this),this.addClass("vjs-spatial-navigation-enabled")),TOUCH_ENABLED&&this.addClass("vjs-touch-enabled"),IS_IOS||this.addClass("vjs-workinghover"),Player.players[this.id_]=this;const s=version$6.split(".")[0];this.addClass(`vjs-v${s}`),this.userActive(!0),this.reportUserActivity(),this.one("play",a=>this.listenForUserActivity_(a)),this.on("keydown",a=>this.handleKeyDown(a)),this.on("languagechange",a=>this.handleLanguagechange(a)),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive),this.on("ready",()=>{this.audioPosterMode(this.options_.audioPosterMode),this.audioOnlyMode(this.options_.audioOnlyMode)})}dispose(){this.trigger("dispose"),this.off("dispose"),off(document$1,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),off(document$1,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),Player.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),clearCacheForPlayer(this),ALL.names.forEach(e=>{const t=ALL[e],n=this[t.getterName]();n&&n.off&&n.off()}),super.dispose({restoreEl:this.options_.restoreEl})}createEl(){let e=this.tag,t,n=this.playerElIngest_=e.parentNode&&e.parentNode.hasAttribute&&e.parentNode.hasAttribute("data-vjs-player");const r=this.tag.tagName.toLowerCase()==="video-js";n?t=this.el_=e.parentNode:r||(t=this.el_=super.createEl("div"));const s=getAttributes(e);if(r){for(t=this.el_=e,e=this.tag=document$1.createElement("video");t.children.length;)e.appendChild(t.firstChild);hasClass(t,"video-js")||addClass(t,"video-js"),t.appendChild(e),n=this.playerElIngest_=t,Object.keys(t).forEach(u=>{try{e[u]=t[u]}catch{}})}e.setAttribute("tabindex","-1"),s.tabindex="-1",IS_CHROME&&IS_WINDOWS&&(e.setAttribute("role","application"),s.role="application"),e.removeAttribute("width"),e.removeAttribute("height"),"width"in s&&delete s.width,"height"in s&&delete s.height,Object.getOwnPropertyNames(s).forEach(function(u){r&&u==="class"||t.setAttribute(u,s[u]),r&&e.setAttribute(u,s[u])}),e.playerId=e.id,e.id+="_html5_api",e.className="vjs-tech",e.player=t.player=this,this.addClass("vjs-paused");const a=["IS_SMART_TV","IS_TIZEN","IS_WEBOS","IS_ANDROID","IS_IPAD","IS_IPHONE","IS_CHROMECAST_RECEIVER"].filter(u=>browser$1[u]).map(u=>"vjs-device-"+u.substring(3).toLowerCase().replace(/\_/g,"-"));if(this.addClass(...a),window$1.VIDEOJS_NO_DYNAMIC_STYLE!==!0){this.styleEl_=createStyleElement("vjs-styles-dimensions");const u=$(".vjs-styles-defaults"),d=$("head");d.insertBefore(this.styleEl_,u?u.nextSibling:d.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const l=e.getElementsByTagName("a");for(let u=0;u<l.length;u++){const d=l.item(u);addClass(d,"vjs-hidden"),d.setAttribute("hidden","hidden")}return e.initNetworkState_=e.networkState,e.parentNode&&!n&&e.parentNode.insertBefore(t,e),prependTo(e,t),this.children_.unshift(e),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=t,t}crossOrigin(e){if(typeof e>"u")return this.techGet_("crossOrigin");if(e!==null&&e!=="anonymous"&&e!=="use-credentials"){log$1.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${e}"`);return}this.techCall_("setCrossOrigin",e),this.posterImage&&this.posterImage.crossOrigin(e)}width(e){return this.dimension("width",e)}height(e){return this.dimension("height",e)}dimension(e,t){const n=e+"_";if(t===void 0)return this[n]||0;if(t===""||t==="auto"){this[n]=void 0,this.updateStyleEl_();return}const r=parseFloat(t);if(isNaN(r)){log$1.error(`Improper value "${t}" supplied for for ${e}`);return}this[n]=r,this.updateStyleEl_()}fluid(e){if(e===void 0)return!!this.fluid_;this.fluid_=!!e,isEvented(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),addEventedCallback(this,()=>{this.on(["playerreset","resize"],this.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(e){if(e===void 0)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(e){if(e===void 0)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(window$1.VIDEOJS_NO_DYNAMIC_STYLE===!0){const l=typeof this.width_=="number"?this.width_:this.options_.width,u=typeof this.height_=="number"?this.height_:this.options_.height,d=this.tech_&&this.tech_.el();d&&(l>=0&&(d.width=l),u>=0&&(d.height=u));return}let e,t,n,r;this.aspectRatio_!==void 0&&this.aspectRatio_!=="auto"?n=this.aspectRatio_:this.videoWidth()>0?n=this.videoWidth()+":"+this.videoHeight():n="16:9";const s=n.split(":"),a=s[1]/s[0];this.width_!==void 0?e=this.width_:this.height_!==void 0?e=this.height_/a:e=this.videoWidth()||300,this.height_!==void 0?t=this.height_:t=e*a,/^[^a-zA-Z]/.test(this.id())?r="dimensions-"+this.id():r=this.id()+"-dimensions",this.addClass(r),setTextContent(this.styleEl_,`
      .${r} {
        width: ${e}px;
        height: ${t}px;
      }

      .${r}.vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: ${a*100}%;
      }
    `)}loadTech_(e,t){this.tech_&&this.unloadTech_();const n=toTitleCase$1(e),r=e.charAt(0).toLowerCase()+e.slice(1);n!=="Html5"&&this.tag&&(Tech.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;let s=this.autoplay();(typeof this.autoplay()=="string"||this.autoplay()===!0&&this.options_.normalizeAutoplay)&&(s=!1);const a={source:t,autoplay:s,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${r}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset};ALL.names.forEach(u=>{const d=ALL[u];a[d.getterName]=this[d.privateName]}),Object.assign(a,this.options_[n]),Object.assign(a,this.options_[r]),Object.assign(a,this.options_[e.toLowerCase()]),this.tag&&(a.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(a.startTime=this.cache_.currentTime);const l=Tech.getTech(e);if(!l)throw new Error(`No Tech named '${n}' exists! '${n}' should be registered using videojs.registerTech()'`);this.tech_=new l(a),this.tech_.ready(bind_(this,this.handleTechReady_),!0),textTrackConverter.jsonToTextTracks(this.textTracksJson_||[],this.tech_),TECH_EVENTS_RETRIGGER.forEach(u=>{this.on(this.tech_,u,d=>this[`handleTech${toTitleCase$1(u)}_`](d))}),Object.keys(TECH_EVENTS_QUEUE).forEach(u=>{this.on(this.tech_,u,d=>{if(this.tech_.playbackRate()===0&&this.tech_.seeking()){this.queuedCallbacks_.push({callback:this[`handleTech${TECH_EVENTS_QUEUE[u]}_`].bind(this),event:d});return}this[`handleTech${TECH_EVENTS_QUEUE[u]}_`](d)})}),this.on(this.tech_,"loadstart",u=>this.handleTechLoadStart_(u)),this.on(this.tech_,"sourceset",u=>this.handleTechSourceset_(u)),this.on(this.tech_,"waiting",u=>this.handleTechWaiting_(u)),this.on(this.tech_,"ended",u=>this.handleTechEnded_(u)),this.on(this.tech_,"seeking",u=>this.handleTechSeeking_(u)),this.on(this.tech_,"play",u=>this.handleTechPlay_(u)),this.on(this.tech_,"pause",u=>this.handleTechPause_(u)),this.on(this.tech_,"durationchange",u=>this.handleTechDurationChange_(u)),this.on(this.tech_,"fullscreenchange",(u,d)=>this.handleTechFullscreenChange_(u,d)),this.on(this.tech_,"fullscreenerror",(u,d)=>this.handleTechFullscreenError_(u,d)),this.on(this.tech_,"enterpictureinpicture",u=>this.handleTechEnterPictureInPicture_(u)),this.on(this.tech_,"leavepictureinpicture",u=>this.handleTechLeavePictureInPicture_(u)),this.on(this.tech_,"error",u=>this.handleTechError_(u)),this.on(this.tech_,"posterchange",u=>this.handleTechPosterChange_(u)),this.on(this.tech_,"textdata",u=>this.handleTechTextData_(u)),this.on(this.tech_,"ratechange",u=>this.handleTechRateChange_(u)),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&(n!=="Html5"||!this.tag)&&prependTo(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){ALL.names.forEach(e=>{const t=ALL[e];this[t.privateName]=this[t.getterName]()}),this.textTracksJson_=textTrackConverter.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(e){return e===void 0&&log$1.warn(`Using the tech directly can be dangerous. I hope you know what you're doing.
See https://github.com/videojs/video.js/issues/2617 for more info.
`),this.tech_}version(){return{"video.js":version$6}}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)}removeTechControlsListeners_(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended","vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):this.trigger("loadstart"),this.manualAutoplay_(this.autoplay()===!0&&this.options_.normalizeAutoplay?"play":this.autoplay())}manualAutoplay_(e){if(!this.tech_||typeof e!="string")return;const t=()=>{const r=this.muted();this.muted(!0);const s=()=>{this.muted(r)};this.playTerminatedQueue_.push(s);const a=this.play();if(isPromise(a))return a.catch(l=>{throw s(),new Error(`Rejection at manualAutoplay. Restoring muted value. ${l||""}`)})};let n;if(e==="any"&&!this.muted()?(n=this.play(),isPromise(n)&&(n=n.catch(t))):e==="muted"&&!this.muted()?n=t():n=this.play(),!!isPromise(n))return n.then(()=>{this.trigger({type:"autoplay-success",autoplay:e})}).catch(()=>{this.trigger({type:"autoplay-failure",autoplay:e})})}updateSourceCaches_(e=""){let t=e,n="";typeof t!="string"&&(t=e.src,n=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!n&&(n=findMimetype(this,t)),this.cache_.source=merge$1({},e,{src:t,type:n});const r=this.cache_.sources.filter(u=>u.src&&u.src===t),s=[],a=this.$$("source"),l=[];for(let u=0;u<a.length;u++){const d=getAttributes(a[u]);s.push(d),d.src&&d.src===t&&l.push(d.src)}l.length&&!r.length?this.cache_.sources=s:r.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t}handleTechSourceset_(e){if(!this.changingSrc_){let t=s=>this.updateSourceCaches_(s);const n=this.currentSource().src,r=e.src;n&&!/^blob:/.test(n)&&/^blob:/.test(r)&&(!this.lastSource_||this.lastSource_.tech!==r&&this.lastSource_.player!==n)&&(t=()=>{}),t(r),e.src||this.tech_.any(["sourceset","loadstart"],s=>{if(s.type==="sourceset")return;const a=this.techGet_("currentSrc");this.lastSource_.tech=a,this.updateSourceCaches_(a)})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})}hasStarted(e){if(e===void 0)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?this.addClass("vjs-has-started"):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended","vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&this.cache_.lastPlaybackRate===0&&(this.queuedCallbacks_.forEach(e=>e.callback(e.event)),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const e=this.currentTime(),t=()=>{e!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.off("timeupdate",t))};this.on("timeupdate",t)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking","vjs-ended"),this.trigger("seeked")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(e){this.controls_&&(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.click===void 0||this.options_.userActions.click!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.click=="function"?this.options_.userActions.click.call(this,e):this.paused()?silencePromise(this.play()):this.pause())}handleTechDoubleClick_(e){if(!this.controls_)return;Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),n=>n.contains(e.target))||(this.options_===void 0||this.options_.userActions===void 0||this.options_.userActions.doubleClick===void 0||this.options_.userActions.doubleClick!==!1)&&(this.options_!==void 0&&this.options_.userActions!==void 0&&typeof this.options_.userActions.doubleClick=="function"?this.options_.userActions.doubleClick.call(this,e):this.isInPictureInPicture()&&!document$1.pictureInPictureElement?this.exitPictureInPicture():this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(e){e.cancelable&&e.preventDefault()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const t=e.target.player;if(t&&t!==this)return;const n=this.el();let r=document$1[this.fsApi_.fullscreenElement]===n;!r&&n.matches&&(r=n.matches(":"+this.fsApi_.fullscreen)),this.isFullscreen(r)}handleTechFullscreenChange_(e,t){t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",()=>{this.removeClass("vjs-ios-native-fs")})),this.isFullscreen(t.isFullscreen))}handleTechFullscreenError_(e,t){this.trigger("fullscreenerror",t)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(e){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(e){this.isInPictureInPicture(!1)}handleTechError_(){const e=this.tech_.error();e&&this.error(e)}handleTechTextData_(){let e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}techCall_(e,t){this.ready(function(){if(e in allowedSetters)return set(this.middleware_,this.tech_,e,t);if(e in allowedMediators)return mediate(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(n){throw log$1(n),n}},!0)}techGet_(e){if(!(!this.tech_||!this.tech_.isReady_)){if(e in allowedGetters)return get(this.middleware_,this.tech_,e);if(e in allowedMediators)return mediate(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){throw this.tech_[e]===void 0?(log$1(`Video.js: ${e} method not defined for ${this.techName_} playback technology.`,t),t):t.name==="TypeError"?(log$1(`Video.js: ${e} unavailable on ${this.techName_} playback technology element.`,t),this.tech_.isReady_=!1,t):(log$1(t),t)}}}play(){return new Promise(e=>{this.play_(e)})}play_(e=silencePromise){this.playCallbacks_.push(e);const t=!!(!this.changingSrc_&&(this.src()||this.currentSrc())),n=!!(IS_ANY_SAFARI||IS_IOS);if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t){this.waitToPlay_=a=>{this.play_()},this.one(["ready","loadstart"],this.waitToPlay_),!t&&n&&this.load();return}const r=this.techGet_("play");n&&this.hasClass("vjs-ended")&&this.resetProgressBar_(),r===null?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(r)}runPlayTerminatedQueue_(){const e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(t){t()})}runPlayCallbacks_(e){const t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(n){n(e)})}pause(){this.techCall_("pause")}paused(){return this.techGet_("paused")!==!1}played(){return this.techGet_("played")||createTimeRanges$1(0,0)}scrubbing(e){if(typeof e>"u")return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(e){if(e===void 0)return this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime;if(e<0&&(e=0),!this.isReady_||this.changingSrc_||!this.tech_||!this.tech_.isReady_){this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),this.one("canplay",this.boundApplyInitTime_);return}this.techCall_("setCurrentTime",e),this.cache_.initTime=0,isFinite(e)&&(this.cache_.currentTime=Number(e))}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(e){if(e===void 0)return this.cache_.duration!==void 0?this.cache_.duration:NaN;e=parseFloat(e),e<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let e=this.techGet_("buffered");return(!e||!e.length)&&(e=createTimeRanges$1(0,0)),e}seekable(){let e=this.techGet_("seekable");return(!e||!e.length)&&(e=createTimeRanges$1(0,0)),e}seeking(){return this.techGet_("seeking")}ended(){return this.techGet_("ended")}networkState(){return this.techGet_("networkState")}readyState(){return this.techGet_("readyState")}bufferedPercent(){return bufferedPercent(this.buffered(),this.duration())}bufferedEnd(){const e=this.buffered(),t=this.duration();let n=e.end(e.length-1);return n>t&&(n=t),n}volume(e){let t;if(e!==void 0){t=Math.max(0,Math.min(1,e)),this.cache_.volume=t,this.techCall_("setVolume",t),t>0&&this.lastVolume_(t);return}return t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t}muted(e){if(e!==void 0){this.techCall_("setMuted",e);return}return this.techGet_("muted")||!1}defaultMuted(e){return e!==void 0&&this.techCall_("setDefaultMuted",e),this.techGet_("defaultMuted")||!1}lastVolume_(e){if(e!==void 0&&e!==0){this.cache_.lastVolume=e;return}return this.cache_.lastVolume}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(e){if(e!==void 0){const t=this.isFullscreen_;this.isFullscreen_=!!e,this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_();return}return this.isFullscreen_}requestFullscreen(e){this.isInPictureInPicture()&&this.exitPictureInPicture();const t=this;return new Promise((n,r)=>{function s(){t.off("fullscreenerror",l),t.off("fullscreenchange",a)}function a(){s(),n()}function l(d,h){s(),r(h)}t.one("fullscreenchange",a),t.one("fullscreenerror",l);const u=t.requestFullscreenHelper_(e);u&&(u.then(s,s),u.then(n,r))})}requestFullscreenHelper_(e){let t;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},e!==void 0&&(t=e)),this.fsApi_.requestFullscreen){const n=this.el_[this.fsApi_.requestFullscreen](t);return n&&n.then(()=>this.isFullscreen(!0),()=>this.isFullscreen(!1)),n}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const e=this;return new Promise((t,n)=>{function r(){e.off("fullscreenerror",a),e.off("fullscreenchange",s)}function s(){r(),t()}function a(u,d){r(),n(d)}e.one("fullscreenchange",s),e.one("fullscreenerror",a);const l=e.exitFullscreenHelper_();l&&(l.then(r,r),l.then(t,n))})}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=document$1[this.fsApi_.exitFullscreen]();return e&&silencePromise(e.then(()=>this.isFullscreen(!1))),e}else this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=document$1.documentElement.style.overflow,on(document$1,"keydown",this.boundFullWindowOnEscKey_),document$1.documentElement.style.overflow="hidden",addClass(document$1.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(e){e.key==="Escape"&&this.isFullscreen()===!0&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,off(document$1,"keydown",this.boundFullWindowOnEscKey_),document$1.documentElement.style.overflow=this.docOrigOverflow,removeClass(document$1.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(e){if(e===void 0)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(e){if(e!==void 0){this.isInPictureInPicture_=!!e,this.togglePictureInPictureClass_();return}return!!this.isInPictureInPicture_}requestPictureInPicture(){if(this.options_.enableDocumentPictureInPicture&&window$1.documentPictureInPicture){const e=document$1.createElement(this.el().tagName);return e.classList=this.el().classList,e.classList.add("vjs-pip-container"),this.posterImage&&e.appendChild(this.posterImage.el().cloneNode(!0)),this.titleBar&&e.appendChild(this.titleBar.el().cloneNode(!0)),e.appendChild(createEl("p",{className:"vjs-pip-text"},{},this.localize("Playing in picture-in-picture"))),window$1.documentPictureInPicture.requestWindow({width:this.videoWidth(),height:this.videoHeight()}).then(t=>(copyStyleSheetsToWindow(t),this.el_.parentNode.insertBefore(e,this.el_),t.document.body.appendChild(this.el_),t.document.body.classList.add("vjs-pip-window"),this.player_.isInPictureInPicture(!0),this.player_.trigger({type:"enterpictureinpicture",pipWindow:t}),t.addEventListener("pagehide",n=>{const r=n.target.querySelector(".video-js");e.parentNode.replaceChild(r,e),this.player_.isInPictureInPicture(!1),this.player_.trigger("leavepictureinpicture")}),t))}return"pictureInPictureEnabled"in document$1&&this.disablePictureInPicture()===!1?this.techGet_("requestPictureInPicture"):Promise.reject("No PiP mode is available")}exitPictureInPicture(){if(window$1.documentPictureInPicture&&window$1.documentPictureInPicture.window)return window$1.documentPictureInPicture.window.close(),Promise.resolve();if("pictureInPictureEnabled"in document$1)return document$1.exitPictureInPicture()}handleKeyDown(e){const{userActions:t}=this.options_;!t||!t.hotkeys||(r=>{const s=r.tagName.toLowerCase();if(r.isContentEditable)return!0;const a=["button","checkbox","hidden","radio","reset","submit"];return s==="input"?a.indexOf(r.type)===-1:["textarea"].indexOf(s)!==-1})(this.el_.ownerDocument.activeElement)||(typeof t.hotkeys=="function"?t.hotkeys.call(this,e):this.handleHotkeys(e))}handleHotkeys(e){const t=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:n=a=>e.key.toLowerCase()==="f",muteKey:r=a=>e.key.toLowerCase()==="m",playPauseKey:s=a=>e.key.toLowerCase()==="k"||e.key.toLowerCase()===" "}=t;if(n.call(this,e)){e.preventDefault(),e.stopPropagation();const a=Component$1.getComponent("FullscreenToggle");document$1[this.fsApi_.fullscreenEnabled]!==!1&&a.prototype.handleClick.call(this,e)}else r.call(this,e)?(e.preventDefault(),e.stopPropagation(),Component$1.getComponent("MuteToggle").prototype.handleClick.call(this,e)):s.call(this,e)&&(e.preventDefault(),e.stopPropagation(),Component$1.getComponent("PlayToggle").prototype.handleClick.call(this,e))}canPlayType(e){let t;for(let n=0,r=this.options_.techOrder;n<r.length;n++){const s=r[n];let a=Tech.getTech(s);if(a||(a=Component$1.getComponent(s)),!a){log$1.error(`The "${s}" tech is undefined. Skipped browser support check for that tech.`);continue}if(a.isSupported()&&(t=a.canPlayType(e),t))return t}return""}selectSource(e){const t=this.options_.techOrder.map(l=>[l,Tech.getTech(l)]).filter(([l,u])=>u?u.isSupported():(log$1.error(`The "${l}" tech is undefined. Skipped browser support check for that tech.`),!1)),n=function(l,u,d){let h;return l.some(p=>u.some(m=>{if(h=d(p,m),h)return!0})),h};let r;const s=l=>(u,d)=>l(d,u),a=([l,u],d)=>{if(u.canPlaySource(d,this.options_[l.toLowerCase()]))return{source:d,tech:l}};return this.options_.sourceOrder?r=n(e,t,s(a)):r=n(t,e,a),r||!1}handleSrc_(e,t){if(typeof e>"u")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();const n=filterSource(e);if(!n.length){this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0);return}if(this.changingSrc_=!0,t||(this.cache_.sources=n),this.updateSourceCaches_(n[0]),setSource(this,n[0],(r,s)=>{if(this.middleware_=s,t||(this.cache_.sources=n),this.updateSourceCaches_(r),this.src_(r)){if(n.length>1)return this.handleSrc_(n.slice(1));this.changingSrc_=!1,this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),this.triggerReady();return}setTech(s,this.tech_)}),n.length>1){const r=()=>{this.error(null),this.handleSrc_(n.slice(1),!0)},s=()=>{this.off("error",r)};this.one("error",r),this.one("playing",s),this.resetRetryOnError_=()=>{this.off("error",r),this.off("playing",s)}}}src(e){return this.handleSrc_(e,!1)}src_(e){const t=this.selectSource([e]);return t?titleCaseEquals(t.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(t.tech,t.source),this.tech_.ready(()=>{this.changingSrc_=!1}),!1):!0}addSourceElement(e,t){return this.tech_?this.tech_.addSourceElement(e,t):!1}removeSourceElement(e){return this.tech_?this.tech_.removeSourceElement(e):!1}load(){if(this.tech_&&this.tech_.vhs){this.src(this.currentSource());return}this.techCall_("load")}reset(){if(this.paused())this.doReset_();else{const e=this.play();silencePromise(e.then(()=>this.doReset_()))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),this.error(null),this.titleBar&&this.titleBar.update({title:void 0,description:void 0}),isEvented(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{currentTimeDisplay:e,durationDisplay:t,progressControl:n,remainingTimeDisplay:r}=this.controlBar||{},{seekBar:s}=n||{};e&&e.updateContent(),t&&t.updateContent(),r&&r.updateContent(),s&&(s.update(),s.loadProgressBar&&s.loadProgressBar.update())}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const e=this.currentSource(),t=[];return Object.keys(e).length!==0&&t.push(e),this.cache_.sources||t}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(e){if(e!==void 0){this.techCall_("setPreload",e),this.options_.preload=e;return}return this.techGet_("preload")}autoplay(e){if(e===void 0)return this.options_.autoplay||!1;let t;typeof e=="string"&&/(any|play|muted)/.test(e)||e===!0&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_(typeof e=="string"?e:"play"),t=!1):e?this.options_.autoplay=!0:this.options_.autoplay=!1,t=typeof t>"u"?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)}playsinline(e){return e!==void 0&&(this.techCall_("setPlaysinline",e),this.options_.playsinline=e),this.techGet_("playsinline")}loop(e){if(e!==void 0){this.techCall_("setLoop",e),this.options_.loop=e;return}return this.techGet_("loop")}poster(e){if(e===void 0)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(e){if(e===void 0)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(e){if(e===void 0)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(e){if(e===void 0)return this.error_||null;if(hooks("beforeerror").forEach(t=>{const n=t(this,e);if(!(isObject(n)&&!Array.isArray(n)||typeof n=="string"||typeof n=="number"||n===null)){this.log.error("please return a value that MediaError expects in beforeerror hooks");return}e=n}),this.options_.suppressNotSupportedError&&e&&e.code===4){const t=function(){this.error(e)};this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],t),this.one("loadstart",function(){this.off(["click","touchstart"],t)});return}if(e===null){this.error_=null,this.removeClass("vjs-error"),this.errorDisplay&&this.errorDisplay.close();return}this.error_=new MediaError(e),this.addClass("vjs-error"),log$1.error(`(CODE:${this.error_.code} ${MediaError.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error"),hooks("error").forEach(t=>t(this,this.error_))}reportUserActivity(e){this.userActivity_=!0}userActive(e){if(e===void 0)return this.userActive_;if(e=!!e,e!==this.userActive_){if(this.userActive_=e,this.userActive_){this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive");return}this.tech_&&this.tech_.one("mousemove",function(t){t.stopPropagation(),t.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let e,t,n;const r=bind_(this,this.reportUserActivity),s=function(p){(p.screenX!==t||p.screenY!==n)&&(t=p.screenX,n=p.screenY,r())},a=function(){r(),this.clearInterval(e),e=this.setInterval(r,250)},l=function(p){r(),this.clearInterval(e)};this.on("mousedown",a),this.on("mousemove",s),this.on("mouseup",l),this.on("mouseleave",l);const u=this.getChild("controlBar");u&&!IS_IOS&&!IS_ANDROID&&(u.on("mouseenter",function(p){this.player().options_.inactivityTimeout!==0&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),u.on("mouseleave",function(p){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",r),this.on("keyup",r);let d;const h=function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(d);const p=this.options_.inactivityTimeout;p<=0||(d=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},p))};this.setInterval(h,250)}playbackRate(e){if(e!==void 0){this.techCall_("setPlaybackRate",e);return}return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1}defaultPlaybackRate(e){return e!==void 0?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(e){if(e!==void 0){this.isAudio_=!!e;return}return!!this.isAudio_}updatePlayerHeightOnAudioOnlyMode_(){const e=this.getChild("ControlBar");!e||this.audioOnlyCache_.controlBarHeight===e.currentHeight()||(this.audioOnlyCache_.controlBarHeight=e.currentHeight(),this.height(this.audioOnlyCache_.controlBarHeight))}enableAudioOnlyUI_(){this.addClass("vjs-audio-only-mode");const e=this.children(),t=this.getChild("ControlBar"),n=t&&t.currentHeight();e.forEach(r=>{r!==t&&r.el_&&!r.hasClass("vjs-hidden")&&(r.hide(),this.audioOnlyCache_.hiddenChildren.push(r))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.audioOnlyCache_.controlBarHeight=n,this.on("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.height(n),this.trigger("audioonlymodechange")}disableAudioOnlyUI_(){this.removeClass("vjs-audio-only-mode"),this.off("playerresize",this.boundUpdatePlayerHeightOnAudioOnlyMode_),this.audioOnlyCache_.hiddenChildren.forEach(e=>e.show()),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")}audioOnlyMode(e){if(typeof e!="boolean"||e===this.audioOnlyMode_)return this.audioOnlyMode_;if(this.audioOnlyMode_=e,e){const t=[];return this.isInPictureInPicture()&&t.push(this.exitPictureInPicture()),this.isFullscreen()&&t.push(this.exitFullscreen()),this.audioPosterMode()&&t.push(this.audioPosterMode(!1)),Promise.all(t).then(()=>this.enableAudioOnlyUI_())}return Promise.resolve().then(()=>this.disableAudioOnlyUI_())}enablePosterModeUI_(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}disablePosterModeUI_(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")}audioPosterMode(e){return typeof e!="boolean"||e===this.audioPosterMode_?this.audioPosterMode_:(this.audioPosterMode_=e,e?this.audioOnlyMode()?this.audioOnlyMode(!1).then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.enablePosterModeUI_()}):Promise.resolve().then(()=>{this.disablePosterModeUI_()}))}addTextTrack(e,t,n){if(this.tech_)return this.tech_.addTextTrack(e,t,n)}addRemoteTextTrack(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)}removeRemoteTextTrack(e={}){let{track:t}=e;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(e){if(e===void 0)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),isEvented(this)&&this.trigger("languagechange"))}languages(){return merge$1(Player.prototype.options_.languages,this.languages_)}toJSON(){const e=merge$1(this.options_),t=e.tracks;e.tracks=[];for(let n=0;n<t.length;n++){let r=t[n];r=merge$1(r),r.player=void 0,e.tracks[n]=r}return e}createModal(e,t){t=t||{},t.content=e||"";const n=new ModalDialog(this,t);return this.addChild(n),n.on("dispose",()=>{this.removeChild(n)}),n.open(),n}updateCurrentBreakpoint_(){if(!this.responsive())return;const e=this.currentBreakpoint(),t=this.currentWidth();for(let n=0;n<BREAKPOINT_ORDER.length;n++){const r=BREAKPOINT_ORDER[n],s=this.breakpoints_[r];if(t<=s){if(e===r)return;e&&this.removeClass(BREAKPOINT_CLASSES[e]),this.addClass(BREAKPOINT_CLASSES[r]),this.breakpoint_=r;break}}}removeCurrentBreakpoint_(){const e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)}breakpoints(e){return e===void 0?Object.assign(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=Object.assign({},DEFAULT_BREAKPOINTS,e),this.updateCurrentBreakpoint_(),Object.assign(this.breakpoints_))}responsive(e){if(e===void 0)return this.responsive_;e=!!e;const t=this.responsive_;if(e!==t)return this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return BREAKPOINT_CLASSES[this.breakpoint_]||""}loadMedia(e,t){if(!e||typeof e!="object")return;const n=this.crossOrigin();this.reset(),this.cache_.media=merge$1(e);const{artist:r,artwork:s,description:a,poster:l,src:u,textTracks:d,title:h}=this.cache_.media;!s&&l&&(this.cache_.media.artwork=[{src:l,type:getMimetype(l)}]),n&&this.crossOrigin(n),u&&this.src(u),l&&this.poster(l),Array.isArray(d)&&d.forEach(p=>this.addRemoteTextTrack(p,!1)),this.titleBar&&this.titleBar.update({title:h,description:a||r||""}),this.ready(t)}getMedia(){if(!this.cache_.media){const e=this.poster(),t=this.currentSources(),n=Array.prototype.map.call(this.remoteTextTracks(),s=>({kind:s.kind,label:s.label,language:s.language,src:s.src})),r={src:t,textTracks:n};return e&&(r.poster=e,r.artwork=[{src:r.poster,type:getMimetype(r.poster)}]),r}return merge$1(this.cache_.media)}static getTagSettings(e){const t={sources:[],tracks:[]},n=getAttributes(e),r=n["data-setup"];if(hasClass(e,"vjs-fill")&&(n.fill=!0),hasClass(e,"vjs-fluid")&&(n.fluid=!0),r!==null)try{Object.assign(n,JSON.parse(r||"{}"))}catch(s){log$1.error("data-setup",s)}if(Object.assign(t,n),e.hasChildNodes()){const s=e.childNodes;for(let a=0,l=s.length;a<l;a++){const u=s[a],d=u.nodeName.toLowerCase();d==="source"?t.sources.push(getAttributes(u)):d==="track"&&t.tracks.push(getAttributes(u))}}return t}debug(e){if(e===void 0)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}playbackRates(e){if(e===void 0)return this.cache_.playbackRates;Array.isArray(e)&&e.every(t=>typeof t=="number")&&(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))}}Player.prototype.videoTracks=()=>{};Player.prototype.audioTracks=()=>{};Player.prototype.textTracks=()=>{};Player.prototype.remoteTextTracks=()=>{};Player.prototype.remoteTextTrackEls=()=>{};ALL.names.forEach(function(i){const e=ALL[i];Player.prototype[e.getterName]=function(){return this.tech_?this.tech_[e.getterName]():(this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName])}});Player.prototype.crossorigin=Player.prototype.crossOrigin;Player.players={};const navigator$1=window$1.navigator;Player.prototype.options_={techOrder:Tech.defaultTechOrder_,html5:{},enableSourceset:!0,inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","titleBar","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:navigator$1&&(navigator$1.languages&&navigator$1.languages[0]||navigator$1.userLanguage||navigator$1.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1,spatialNavigation:{enabled:!1,horizontalSeek:!1},enableSmoothSeeking:!1,disableSeekWhileScrubbingOnMobile:!1,disableSeekWhileScrubbingOnSTV:!1};TECH_EVENTS_RETRIGGER.forEach(function(i){Player.prototype[`handleTech${toTitleCase$1(i)}_`]=function(){return this.trigger(i)}});Component$1.registerComponent("Player",Player);const BASE_PLUGIN_NAME="plugin",PLUGIN_CACHE_KEY="activePlugins_",pluginStorage={},pluginExists=i=>pluginStorage.hasOwnProperty(i),getPlugin=i=>pluginExists(i)?pluginStorage[i]:void 0,markPluginAsActive=(i,e)=>{i[PLUGIN_CACHE_KEY]=i[PLUGIN_CACHE_KEY]||{},i[PLUGIN_CACHE_KEY][e]=!0},triggerSetupEvent=(i,e,t)=>{const n=(t?"before":"")+"pluginsetup";i.trigger(n,e),i.trigger(n+":"+e.name,e)},createBasicPlugin=function(i,e){const t=function(){triggerSetupEvent(this,{name:i,plugin:e,instance:null},!0);const n=e.apply(this,arguments);return markPluginAsActive(this,i),triggerSetupEvent(this,{name:i,plugin:e,instance:n}),n};return Object.keys(e).forEach(function(n){t[n]=e[n]}),t},createPluginFactory=(i,e)=>(e.prototype.name=i,function(...t){triggerSetupEvent(this,{name:i,plugin:e,instance:null},!0);const n=new e(this,...t);return this[i]=()=>n,triggerSetupEvent(this,n.getEventHash()),n});class Plugin{constructor(e){if(this.constructor===Plugin)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=e,this.log||(this.log=this.player.log.createLogger(this.name)),evented(this),delete this.trigger,stateful(this,this.constructor.defaultState),markPluginAsActive(e,this.name),this.dispose=this.dispose.bind(this),e.on("dispose",this.dispose)}version(){return this.constructor.VERSION}getEventHash(e={}){return e.name=this.name,e.plugin=this.constructor,e.instance=this,e}trigger(e,t={}){return trigger(this.eventBusEl_,e,this.getEventHash(t))}handleStateChanged(e){}dispose(){const{name:e,player:t}=this;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[PLUGIN_CACHE_KEY][e]=!1,this.player=this.state=null,t[e]=createPluginFactory(e,pluginStorage[e])}static isBasic(e){const t=typeof e=="string"?getPlugin(e):e;return typeof t=="function"&&!Plugin.prototype.isPrototypeOf(t.prototype)}static registerPlugin(e,t){if(typeof e!="string")throw new Error(`Illegal plugin name, "${e}", must be a string, was ${typeof e}.`);if(pluginExists(e))log$1.warn(`A plugin named "${e}" already exists. You may want to avoid re-registering plugins!`);else if(Player.prototype.hasOwnProperty(e))throw new Error(`Illegal plugin name, "${e}", cannot share a name with an existing player method!`);if(typeof t!="function")throw new Error(`Illegal plugin for "${e}", must be a function, was ${typeof t}.`);return pluginStorage[e]=t,e!==BASE_PLUGIN_NAME&&(Plugin.isBasic(t)?Player.prototype[e]=createBasicPlugin(e,t):Player.prototype[e]=createPluginFactory(e,t)),t}static deregisterPlugin(e){if(e===BASE_PLUGIN_NAME)throw new Error("Cannot de-register base plugin.");pluginExists(e)&&(delete pluginStorage[e],delete Player.prototype[e])}static getPlugins(e=Object.keys(pluginStorage)){let t;return e.forEach(n=>{const r=getPlugin(n);r&&(t=t||{},t[n]=r)}),t}static getPluginVersion(e){const t=getPlugin(e);return t&&t.VERSION||""}}Plugin.getPlugin=getPlugin;Plugin.BASE_PLUGIN_NAME=BASE_PLUGIN_NAME;Plugin.registerPlugin(BASE_PLUGIN_NAME,Plugin);Player.prototype.usingPlugin=function(i){return!!this[PLUGIN_CACHE_KEY]&&this[PLUGIN_CACHE_KEY][i]===!0};Player.prototype.hasPlugin=function(i){return!!pluginExists(i)};function deprecate(i,e){let t=!1;return function(...n){return t||log$1.warn(i),t=!0,e.apply(this,n)}}function deprecateForMajor(i,e,t,n){return deprecate(`${e} is deprecated and will be removed in ${i}.0; please use ${t} instead.`,n)}var VjsErrors={NetworkBadStatus:"networkbadstatus",NetworkRequestFailed:"networkrequestfailed",NetworkRequestAborted:"networkrequestaborted",NetworkRequestTimeout:"networkrequesttimeout",NetworkBodyParserFailed:"networkbodyparserfailed",StreamingHlsPlaylistParserError:"streaminghlsplaylistparsererror",StreamingDashManifestParserError:"streamingdashmanifestparsererror",StreamingContentSteeringParserError:"streamingcontentsteeringparsererror",StreamingVttParserError:"streamingvttparsererror",StreamingFailedToSelectNextSegment:"streamingfailedtoselectnextsegment",StreamingFailedToDecryptSegment:"streamingfailedtodecryptsegment",StreamingFailedToTransmuxSegment:"streamingfailedtotransmuxsegment",StreamingFailedToAppendSegment:"streamingfailedtoappendsegment",StreamingCodecsChangeError:"streamingcodecschangeerror"};const normalizeId=i=>i.indexOf("#")===0?i.slice(1):i;function videojs(i,e,t){let n=videojs.getPlayer(i);if(n)return e&&log$1.warn(`Player "${i}" is already initialised. Options will not be applied.`),t&&n.ready(t),n;const r=typeof i=="string"?$("#"+normalizeId(i)):i;if(!isEl(r))throw new TypeError("The element or ID supplied is not valid. (videojs)");const a=("getRootNode"in r?r.getRootNode()instanceof window$1.ShadowRoot:!1)?r.getRootNode():r.ownerDocument.body;(!r.ownerDocument.defaultView||!a.contains(r))&&log$1.warn("The element supplied is not included in the DOM"),e=e||{},e.restoreEl===!0&&(e.restoreEl=(r.parentNode&&r.parentNode.hasAttribute&&r.parentNode.hasAttribute("data-vjs-player")?r.parentNode:r).cloneNode(!0)),hooks("beforesetup").forEach(u=>{const d=u(r,merge$1(e));if(!isObject(d)||Array.isArray(d)){log$1.error("please return an object in beforesetup hooks");return}e=merge$1(e,d)});const l=Component$1.getComponent("Player");return n=new l(r,e,t),hooks("setup").forEach(u=>u(n)),n}videojs.hooks_=hooks_;videojs.hooks=hooks;videojs.hook=hook;videojs.hookOnce=hookOnce;videojs.removeHook=removeHook;if(window$1.VIDEOJS_NO_DYNAMIC_STYLE!==!0&&isReal()){let i=$(".vjs-styles-defaults");if(!i){i=createStyleElement("vjs-styles-defaults");const e=$("head");e&&e.insertBefore(i,e.firstChild),setTextContent(i,`
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid:not(.vjs-audio-only-mode) {
        padding-top: 56.25%
      }
    `)}}autoSetupTimeout(1,videojs);videojs.VERSION=version$6;videojs.options=Player.prototype.options_;videojs.getPlayers=()=>Player.players;videojs.getPlayer=i=>{const e=Player.players;let t;if(typeof i=="string"){const n=normalizeId(i),r=e[n];if(r)return r;t=$("#"+n)}else t=i;if(isEl(t)){const{player:n,playerId:r}=t;if(n||e[r])return n||e[r]}};videojs.getAllPlayers=()=>Object.keys(Player.players).map(i=>Player.players[i]).filter(Boolean);videojs.players=Player.players;videojs.getComponent=Component$1.getComponent;videojs.registerComponent=(i,e)=>(Tech.isTech(e)&&log$1.warn(`The ${i} tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)`),Component$1.registerComponent.call(Component$1,i,e));videojs.getTech=Tech.getTech;videojs.registerTech=Tech.registerTech;videojs.use=use;Object.defineProperty(videojs,"middleware",{value:{},writeable:!1,enumerable:!0});Object.defineProperty(videojs.middleware,"TERMINATOR",{value:TERMINATOR,writeable:!1,enumerable:!0});videojs.browser=browser$1;videojs.obj=Obj;videojs.mergeOptions=deprecateForMajor(9,"videojs.mergeOptions","videojs.obj.merge",merge$1);videojs.defineLazyProperty=deprecateForMajor(9,"videojs.defineLazyProperty","videojs.obj.defineLazyProperty",defineLazyProperty);videojs.bind=deprecateForMajor(9,"videojs.bind","native Function.prototype.bind",bind_);videojs.registerPlugin=Plugin.registerPlugin;videojs.deregisterPlugin=Plugin.deregisterPlugin;videojs.plugin=(i,e)=>(log$1.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),Plugin.registerPlugin(i,e));videojs.getPlugins=Plugin.getPlugins;videojs.getPlugin=Plugin.getPlugin;videojs.getPluginVersion=Plugin.getPluginVersion;videojs.addLanguage=function(i,e){return i=(""+i).toLowerCase(),videojs.options.languages=merge$1(videojs.options.languages,{[i]:e}),videojs.options.languages[i]};videojs.log=log$1;videojs.createLogger=createLogger;videojs.time=Time;videojs.createTimeRange=deprecateForMajor(9,"videojs.createTimeRange","videojs.time.createTimeRanges",createTimeRanges$1);videojs.createTimeRanges=deprecateForMajor(9,"videojs.createTimeRanges","videojs.time.createTimeRanges",createTimeRanges$1);videojs.formatTime=deprecateForMajor(9,"videojs.formatTime","videojs.time.formatTime",formatTime);videojs.setFormatTime=deprecateForMajor(9,"videojs.setFormatTime","videojs.time.setFormatTime",setFormatTime);videojs.resetFormatTime=deprecateForMajor(9,"videojs.resetFormatTime","videojs.time.resetFormatTime",resetFormatTime);videojs.parseUrl=deprecateForMajor(9,"videojs.parseUrl","videojs.url.parseUrl",parseUrl);videojs.isCrossOrigin=deprecateForMajor(9,"videojs.isCrossOrigin","videojs.url.isCrossOrigin",isCrossOrigin);videojs.EventTarget=EventTarget$2;videojs.any=any;videojs.on=on;videojs.one=one;videojs.off=off;videojs.trigger=trigger;videojs.xhr=XHR;videojs.TrackList=TrackList;videojs.TextTrack=TextTrack;videojs.TextTrackList=TextTrackList;videojs.AudioTrack=AudioTrack;videojs.AudioTrackList=AudioTrackList;videojs.VideoTrack=VideoTrack;videojs.VideoTrackList=VideoTrackList;["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(i=>{videojs[i]=function(){return log$1.warn(`videojs.${i}() is deprecated; use videojs.dom.${i}() instead`),Dom[i].apply(null,arguments)}});videojs.computedStyle=deprecateForMajor(9,"videojs.computedStyle","videojs.dom.computedStyle",computedStyle);videojs.dom=Dom;videojs.fn=Fn;videojs.num=Num;videojs.str=Str;videojs.url=Url;videojs.Error=VjsErrors;class QualityLevel{constructor(e){let t=this;return t.id=e.id,t.label=t.id,t.width=e.width,t.height=e.height,t.bitrate=e.bandwidth,t.frameRate=e.frameRate,t.enabled_=e.enabled,Object.defineProperty(t,"enabled",{get(){return t.enabled_()},set(n){t.enabled_(n)}}),t}}class QualityLevelList extends videojs.EventTarget{constructor(){super();let e=this;return e.levels_=[],e.selectedIndex_=-1,Object.defineProperty(e,"selectedIndex",{get(){return e.selectedIndex_}}),Object.defineProperty(e,"length",{get(){return e.levels_.length}}),e[Symbol.iterator]=()=>e.levels_.values(),e}addQualityLevel(e){let t=this.getQualityLevelById(e.id);if(t)return t;const n=this.levels_.length;return t=new QualityLevel(e),""+n in this||Object.defineProperty(this,n,{get(){return this.levels_[n]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t}removeQualityLevel(e){let t=null;for(let n=0,r=this.length;n<r;n++)if(this[n]===e){t=this.levels_.splice(n,1)[0],this.selectedIndex_===n?this.selectedIndex_=-1:this.selectedIndex_>n&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t}getQualityLevelById(e){for(let t=0,n=this.length;t<n;t++){const r=this[t];if(r.id===e)return r}return null}dispose(){this.selectedIndex_=-1,this.levels_.length=0}}QualityLevelList.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"};for(const i in QualityLevelList.prototype.allowedEvents_)QualityLevelList.prototype["on"+i]=null;var version$5="4.1.0";const initPlugin$1=function(i,e){const t=i.qualityLevels,n=new QualityLevelList,r=function(){n.dispose(),i.qualityLevels=t,i.off("dispose",r)};return i.on("dispose",r),i.qualityLevels=()=>n,i.qualityLevels.VERSION=version$5,n},qualityLevels=function(i){return initPlugin$1(this,videojs.obj.merge({},i))};videojs.registerPlugin("qualityLevels",qualityLevels);qualityLevels.VERSION=version$5;const resolveUrl=resolveUrl$1,resolveManifestRedirect=(i,e)=>e&&e.responseURL&&i!==e.responseURL?e.responseURL:i,logger=i=>videojs.log.debug?videojs.log.debug.bind(videojs,"VHS:",`${i} >`):function(){};function merge(...i){const e=videojs.obj||videojs;return(e.merge||e.mergeOptions).apply(e,i)}function createTimeRanges(...i){const e=videojs.time||videojs;return(e.createTimeRanges||e.createTimeRanges).apply(e,i)}function bufferedRangesToString(i){if(i.length===0)return"Buffered Ranges are empty";let e=`Buffered Ranges: 
`;for(let t=0;t<i.length;t++){const n=i.start(t),r=i.end(t);e+=`${n} --> ${r}. Duration (${r-n})
`}return e}const TIME_FUDGE_FACTOR=1/30,SAFE_TIME_DELTA=TIME_FUDGE_FACTOR*3,filterRanges=function(i,e){const t=[];let n;if(i&&i.length)for(n=0;n<i.length;n++)e(i.start(n),i.end(n))&&t.push([i.start(n),i.end(n)]);return createTimeRanges(t)},findRange=function(i,e){return filterRanges(i,function(t,n){return t-SAFE_TIME_DELTA<=e&&n+SAFE_TIME_DELTA>=e})},findNextRange=function(i,e){return filterRanges(i,function(t){return t-TIME_FUDGE_FACTOR>=e})},findGaps=function(i){if(i.length<2)return createTimeRanges();const e=[];for(let t=1;t<i.length;t++){const n=i.end(t-1),r=i.start(t);e.push([n,r])}return createTimeRanges(e)},bufferIntersection=function(i,e){let t=null,n=null,r=0;const s=[],a=[];if(!i||!i.length||!e||!e.length)return createTimeRanges();let l=i.length;for(;l--;)s.push({time:i.start(l),type:"start"}),s.push({time:i.end(l),type:"end"});for(l=e.length;l--;)s.push({time:e.start(l),type:"start"}),s.push({time:e.end(l),type:"end"});for(s.sort(function(u,d){return u.time-d.time}),l=0;l<s.length;l++)s[l].type==="start"?(r++,r===2&&(t=s[l].time)):s[l].type==="end"&&(r--,r===1&&(n=s[l].time)),t!==null&&n!==null&&(a.push([t,n]),t=null,n=null);return createTimeRanges(a)},printableRange=i=>{const e=[];if(!i||!i.length)return"";for(let t=0;t<i.length;t++)e.push(i.start(t)+" => "+i.end(t));return e.join(", ")},timeUntilRebuffer=function(i,e,t=1){return((i.length?i.end(i.length-1):0)-e)/t},timeRangesToArray=i=>{const e=[];for(let t=0;t<i.length;t++)e.push({start:i.start(t),end:i.end(t)});return e},isRangeDifferent=function(i,e){if(i===e)return!1;if(!i&&e||!e&&i||i.length!==e.length)return!0;for(let t=0;t<i.length;t++)if(i.start(t)!==e.start(t)||i.end(t)!==e.end(t))return!0;return!1},lastBufferedEnd=function(i){if(!(!i||!i.length||!i.end))return i.end(i.length-1)},timeAheadOf=function(i,e){let t=0;if(!i||!i.length)return t;for(let n=0;n<i.length;n++){const r=i.start(n),s=i.end(n);if(!(e>s)){if(e>r&&e<=s){t+=s-e;continue}t+=s-r}}return t},segmentDurationWithParts=(i,e)=>{if(!e.preload)return e.duration;let t=0;return(e.parts||[]).forEach(function(n){t+=n.duration}),(e.preloadHints||[]).forEach(function(n){n.type==="PART"&&(t+=i.partTargetDuration)}),t},getPartsAndSegments=i=>(i.segments||[]).reduce((e,t,n)=>(t.parts?t.parts.forEach(function(r,s){e.push({duration:r.duration,segmentIndex:n,partIndex:s,part:r,segment:t})}):e.push({duration:t.duration,segmentIndex:n,partIndex:null,segment:t,part:null}),e),[]),getLastParts=i=>{const e=i.segments&&i.segments.length&&i.segments[i.segments.length-1];return e&&e.parts||[]},getKnownPartCount=({preloadSegment:i})=>{if(!i)return;const{parts:e,preloadHints:t}=i;let n=(t||[]).reduce((r,s)=>r+(s.type==="PART"?1:0),0);return n+=e&&e.length?e.length:0,n},liveEdgeDelay=(i,e)=>{if(e.endList)return 0;if(i&&i.suggestedPresentationDelay)return i.suggestedPresentationDelay;const t=getLastParts(e).length>0;return t&&e.serverControl&&e.serverControl.partHoldBack?e.serverControl.partHoldBack:t&&e.partTargetDuration?e.partTargetDuration*3:e.serverControl&&e.serverControl.holdBack?e.serverControl.holdBack:e.targetDuration?e.targetDuration*3:0},backwardDuration=function(i,e){let t=0,n=e-i.mediaSequence,r=i.segments[n];if(r){if(typeof r.start<"u")return{result:r.start,precise:!0};if(typeof r.end<"u")return{result:r.end-r.duration,precise:!0}}for(;n--;){if(r=i.segments[n],typeof r.end<"u")return{result:t+r.end,precise:!0};if(t+=segmentDurationWithParts(i,r),typeof r.start<"u")return{result:t+r.start,precise:!0}}return{result:t,precise:!1}},forwardDuration=function(i,e){let t=0,n,r=e-i.mediaSequence;for(;r<i.segments.length;r++){if(n=i.segments[r],typeof n.start<"u")return{result:n.start-t,precise:!0};if(t+=segmentDurationWithParts(i,n),typeof n.end<"u")return{result:n.end-t,precise:!0}}return{result:-1,precise:!1}},intervalDuration=function(i,e,t){if(typeof e>"u"&&(e=i.mediaSequence+i.segments.length),e<i.mediaSequence)return 0;const n=backwardDuration(i,e);if(n.precise)return n.result;const r=forwardDuration(i,e);return r.precise?r.result:n.result+t},duration=function(i,e,t){if(!i)return 0;if(typeof t!="number"&&(t=0),typeof e>"u"){if(i.totalDuration)return i.totalDuration;if(!i.endList)return window$1.Infinity}return intervalDuration(i,e,t)},sumDurations=function({defaultDuration:i,durationList:e,startIndex:t,endIndex:n}){let r=0;if(t>n&&([t,n]=[n,t]),t<0){for(let s=t;s<Math.min(0,n);s++)r+=i;t=0}for(let s=t;s<n;s++)r+=e[s].duration;return r},playlistEnd=function(i,e,t,n){if(!i||!i.segments)return null;if(i.endList)return duration(i);if(e===null)return null;e=e||0;let r=intervalDuration(i,i.mediaSequence+i.segments.length,e);return t&&(n=typeof n=="number"?n:liveEdgeDelay(null,i),r-=n),Math.max(0,r)},seekable=function(i,e,t){const r=e||0;let s=playlistEnd(i,e,!0,t);return s===null?createTimeRanges():(s<r&&(s=r),createTimeRanges(r,s))},getMediaInfoForTime=function({playlist:i,currentTime:e,startingSegmentIndex:t,startingPartIndex:n,startTime:r,exactManifestTimings:s}){let a=e-r;const l=getPartsAndSegments(i);let u=0;for(let d=0;d<l.length;d++){const h=l[d];if(t===h.segmentIndex&&!(typeof n=="number"&&typeof h.partIndex=="number"&&n!==h.partIndex)){u=d;break}}if(a<0){if(u>0)for(let d=u-1;d>=0;d--){const h=l[d];if(a+=h.duration,s){if(a<0)continue}else if(a+TIME_FUDGE_FACTOR<=0)continue;return{partIndex:h.partIndex,segmentIndex:h.segmentIndex,startTime:r-sumDurations({defaultDuration:i.targetDuration,durationList:l,startIndex:u,endIndex:d})}}return{partIndex:l[0]&&l[0].partIndex||null,segmentIndex:l[0]&&l[0].segmentIndex||0,startTime:e}}if(u<0){for(let d=u;d<0;d++)if(a-=i.targetDuration,a<0)return{partIndex:l[0]&&l[0].partIndex||null,segmentIndex:l[0]&&l[0].segmentIndex||0,startTime:e};u=0}for(let d=u;d<l.length;d++){const h=l[d];a-=h.duration;const p=h.duration>TIME_FUDGE_FACTOR,m=a===0,g=p&&a+TIME_FUDGE_FACTOR>=0;if(!((m||g)&&d!==l.length-1)){if(s){if(a>0)continue}else if(a-TIME_FUDGE_FACTOR>=0)continue;return{partIndex:h.partIndex,segmentIndex:h.segmentIndex,startTime:r+sumDurations({defaultDuration:i.targetDuration,durationList:l,startIndex:u,endIndex:d})}}}return{segmentIndex:l[l.length-1].segmentIndex,partIndex:l[l.length-1].partIndex,startTime:e}},isExcluded=function(i){return i.excludeUntil&&i.excludeUntil>Date.now()},isIncompatible=function(i){return i.excludeUntil&&i.excludeUntil===1/0},isEnabled=function(i){const e=isExcluded(i);return!i.disabled&&!e},isDisabled=function(i){return i.disabled},isAes=function(i){for(let e=0;e<i.segments.length;e++)if(i.segments[e].key)return!0;return!1},hasAttribute=function(i,e){return e.attributes&&e.attributes[i]},estimateSegmentRequestTime=function(i,e,t,n=0){return hasAttribute("BANDWIDTH",t)?(i*t.attributes.BANDWIDTH-n*8)/e:NaN},isLowestEnabledRendition=(i,e)=>{if(i.playlists.length===1)return!0;const t=e.attributes.BANDWIDTH||Number.MAX_VALUE;return i.playlists.filter(n=>isEnabled(n)?(n.attributes.BANDWIDTH||0)<t:!1).length===0},playlistMatch=(i,e)=>!i&&!e||!i&&e||i&&!e?!1:!!(i===e||i.id&&e.id&&i.id===e.id||i.resolvedUri&&e.resolvedUri&&i.resolvedUri===e.resolvedUri||i.uri&&e.uri&&i.uri===e.uri),someAudioVariant=function(i,e){const t=i&&i.mediaGroups&&i.mediaGroups.AUDIO||{};let n=!1;for(const r in t){for(const s in t[r])if(n=e(t[r][s]),n)break;if(n)break}return!!n},isAudioOnly=i=>{if(!i||!i.playlists||!i.playlists.length)return someAudioVariant(i,t=>t.playlists&&t.playlists.length||t.uri);for(let e=0;e<i.playlists.length;e++){const t=i.playlists[e],n=t.attributes&&t.attributes.CODECS;if(!(n&&n.split(",").every(s=>isAudioCodec(s))||someAudioVariant(i,s=>playlistMatch(t,s))))return!1}return!0};var Playlist={liveEdgeDelay,duration,seekable,getMediaInfoForTime,isEnabled,isDisabled,isExcluded,isIncompatible,playlistEnd,isAes,hasAttribute,estimateSegmentRequestTime,isLowestEnabledRendition,isAudioOnly,playlistMatch,segmentDurationWithParts};const{log}=videojs,createPlaylistID=(i,e)=>`${i}-${e}`,groupID=(i,e,t)=>`placeholder-uri-${i}-${e}-${t}`,parseManifest=({onwarn:i,oninfo:e,manifestString:t,customTagParsers:n=[],customTagMappers:r=[],llhls:s})=>{const a=new Parser;i&&a.on("warn",i),e&&a.on("info",e),n.forEach(d=>a.addParser(d)),r.forEach(d=>a.addTagMapper(d)),a.push(t),a.end();const l=a.manifest;if(s||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(d){l.hasOwnProperty(d)&&delete l[d]}),l.segments&&l.segments.forEach(function(d){["parts","preloadHints"].forEach(function(h){d.hasOwnProperty(h)&&delete d[h]})})),!l.targetDuration){let d=10;l.segments&&l.segments.length&&(d=l.segments.reduce((h,p)=>Math.max(h,p.duration),0)),i&&i({message:`manifest has no targetDuration defaulting to ${d}`}),l.targetDuration=d}const u=getLastParts(l);if(u.length&&!l.partTargetDuration){const d=u.reduce((h,p)=>Math.max(h,p.duration),0);i&&(i({message:`manifest has no partTargetDuration defaulting to ${d}`}),log.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),l.partTargetDuration=d}return l},forEachMediaGroup=(i,e)=>{i.mediaGroups&&["AUDIO","SUBTITLES"].forEach(t=>{if(i.mediaGroups[t])for(const n in i.mediaGroups[t])for(const r in i.mediaGroups[t][n]){const s=i.mediaGroups[t][n][r];e(s,t,n,r)}})},setupMediaPlaylist=({playlist:i,uri:e,id:t})=>{i.id=t,i.playlistErrors_=0,e&&(i.uri=e),i.attributes=i.attributes||{}},setupMediaPlaylists=i=>{let e=i.playlists.length;for(;e--;){const t=i.playlists[e];setupMediaPlaylist({playlist:t,id:createPlaylistID(e,t.uri)}),t.resolvedUri=resolveUrl(i.uri,t.uri),i.playlists[t.id]=t,i.playlists[t.uri]=t,t.attributes.BANDWIDTH||log.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}},resolveMediaGroupUris=i=>{forEachMediaGroup(i,e=>{e.uri&&(e.resolvedUri=resolveUrl(i.uri,e.uri))})},mainForMedia=(i,e)=>{const t=createPlaylistID(0,e),n={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:window$1.location.href,resolvedUri:window$1.location.href,playlists:[{uri:e,id:t,resolvedUri:e,attributes:{}}]};return n.playlists[t]=n.playlists[0],n.playlists[e]=n.playlists[0],n},addPropertiesToMain=(i,e,t=groupID)=>{i.uri=e;for(let r=0;r<i.playlists.length;r++)if(!i.playlists[r].uri){const s=`placeholder-uri-${r}`;i.playlists[r].uri=s}const n=isAudioOnly(i);forEachMediaGroup(i,(r,s,a,l)=>{if(!r.playlists||!r.playlists.length){if(n&&s==="AUDIO"&&!r.uri)for(let u=0;u<i.playlists.length;u++){const d=i.playlists[u];if(d.attributes&&d.attributes.AUDIO&&d.attributes.AUDIO===a)return}r.playlists=[_extends({},r)]}r.playlists.forEach(function(u,d){const h=t(s,a,l,u),p=createPlaylistID(d,h);u.uri?u.resolvedUri=u.resolvedUri||resolveUrl(i.uri,u.uri):(u.uri=d===0?h:p,u.resolvedUri=u.uri),u.id=u.id||p,u.attributes=u.attributes||{},i.playlists[u.id]=u,i.playlists[u.uri]=u})}),setupMediaPlaylists(i),resolveMediaGroupUris(i)};class DateRangesStorage{constructor(){this.offset_=null,this.pendingDateRanges_=new Map,this.processedDateRanges_=new Map}setOffset(e=[]){if(this.offset_!==null||!e.length)return;const[t]=e;t.programDateTime!==void 0&&(this.offset_=t.programDateTime/1e3)}setPendingDateRanges(e=[]){if(!e.length)return;const[t]=e,n=t.startDate.getTime();this.trimProcessedDateRanges_(n),this.pendingDateRanges_=e.reduce((r,s)=>(r.set(s.id,s),r),new Map)}processDateRange(e){this.pendingDateRanges_.delete(e.id),this.processedDateRanges_.set(e.id,e)}getDateRangesToProcess(){if(this.offset_===null)return[];const e={},t=[];this.pendingDateRanges_.forEach((n,r)=>{if(!this.processedDateRanges_.has(r)&&(n.startTime=n.startDate.getTime()/1e3-this.offset_,n.processDateRange=()=>this.processDateRange(n),t.push(n),!!n.class))if(e[n.class]){const s=e[n.class].push(n);n.classListIndex=s-1}else e[n.class]=[n],n.classListIndex=0});for(const n of t){const r=e[n.class]||[];n.endDate?n.endTime=n.endDate.getTime()/1e3-this.offset_:n.endOnNext&&r[n.classListIndex+1]?n.endTime=r[n.classListIndex+1].startTime:n.duration?n.endTime=n.startTime+n.duration:n.plannedDuration?n.endTime=n.startTime+n.plannedDuration:n.endTime=n.startTime}return t}trimProcessedDateRanges_(e){new Map(this.processedDateRanges_).forEach((n,r)=>{n.startDate.getTime()<e&&this.processedDateRanges_.delete(r)})}}const QUOTA_EXCEEDED_ERR=22,getStreamingNetworkErrorMetadata=({requestType:i,request:e,error:t,parseFailure:n})=>{const r=e.status<200||e.status>299,s=e.status>=400&&e.status<=499,a={uri:e.uri,requestType:i},l=r&&!s||n;if(t&&s)a.error=_extends({},t),a.errorType=videojs.Error.NetworkRequestFailed;else if(e.aborted)a.errorType=videojs.Error.NetworkRequestAborted;else if(e.timedout)a.errorType=videojs.Error.NetworkRequestTimeout;else if(l){const u=n?videojs.Error.NetworkBodyParserFailed:videojs.Error.NetworkBadStatus;a.errorType=u,a.status=e.status,a.headers=e.headers}return a},logFn$1=logger("CodecUtils"),getCodecs=function(i){const e=i.attributes||{};if(e.CODECS)return parseCodecs(e.CODECS)},isMaat=(i,e)=>{const t=e.attributes||{};return i&&i.mediaGroups&&i.mediaGroups.AUDIO&&t.AUDIO&&i.mediaGroups.AUDIO[t.AUDIO]},isMuxed=(i,e)=>{if(!isMaat(i,e))return!0;const t=e.attributes||{},n=i.mediaGroups.AUDIO[t.AUDIO];for(const r in n)if(!n[r].uri&&!n[r].playlists)return!0;return!1},unwrapCodecList=function(i){const e={};return i.forEach(({mediaType:t,type:n,details:r})=>{e[t]=e[t]||[],e[t].push(translateLegacyCodec(`${n}${r}`))}),Object.keys(e).forEach(function(t){if(e[t].length>1){logFn$1(`multiple ${t} codecs found as attributes: ${e[t].join(", ")}. Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs.`),e[t]=null;return}e[t]=e[t][0]}),e},codecCount=function(i){let e=0;return i.audio&&e++,i.video&&e++,e},codecsForPlaylist=function(i,e){const t=e.attributes||{},n=unwrapCodecList(getCodecs(e)||[]);if(isMaat(i,e)&&!n.audio&&!isMuxed(i,e)){const r=unwrapCodecList(codecsFromDefault(i,t.AUDIO)||[]);r.audio&&(n.audio=r.audio)}return n},{EventTarget:EventTarget$1}=videojs,addLLHLSQueryDirectives=(i,e)=>{if(e.endList||!e.serverControl)return i;const t={};if(e.serverControl.canBlockReload){const{preloadSegment:n}=e;let r=e.mediaSequence+e.segments.length;if(n){const s=n.parts||[],a=getKnownPartCount(e)-1;a>-1&&a!==s.length-1&&(t._HLS_part=a),(a>-1||s.length)&&r--}t._HLS_msn=r}if(e.serverControl&&e.serverControl.canSkipUntil&&(t._HLS_skip=e.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(t).length){const n=new window$1.URL(i);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(r){t.hasOwnProperty(r)&&n.searchParams.set(r,t[r])}),i=n.toString()}return i},updateSegment=(i,e)=>{if(!i)return e;const t=merge(i,e);if(i.preloadHints&&!e.preloadHints&&delete t.preloadHints,i.parts&&!e.parts)delete t.parts;else if(i.parts&&e.parts)for(let n=0;n<e.parts.length;n++)i.parts&&i.parts[n]&&(t.parts[n]=merge(i.parts[n],e.parts[n]));return!i.skipped&&e.skipped&&(t.skipped=!1),i.preload&&!e.preload&&(t.preload=!1),t},updateSegments=(i,e,t)=>{const n=i.slice(),r=e.slice();t=t||0;const s=[];let a;for(let l=0;l<r.length;l++){const u=n[l+t],d=r[l];u?(a=u.map||a,s.push(updateSegment(u,d))):(a&&!d.map&&(d.map=a),s.push(d))}return s},resolveSegmentUris=(i,e)=>{!i.resolvedUri&&i.uri&&(i.resolvedUri=resolveUrl(e,i.uri)),i.key&&!i.key.resolvedUri&&(i.key.resolvedUri=resolveUrl(e,i.key.uri)),i.map&&!i.map.resolvedUri&&(i.map.resolvedUri=resolveUrl(e,i.map.uri)),i.map&&i.map.key&&!i.map.key.resolvedUri&&(i.map.key.resolvedUri=resolveUrl(e,i.map.key.uri)),i.parts&&i.parts.length&&i.parts.forEach(t=>{t.resolvedUri||(t.resolvedUri=resolveUrl(e,t.uri))}),i.preloadHints&&i.preloadHints.length&&i.preloadHints.forEach(t=>{t.resolvedUri||(t.resolvedUri=resolveUrl(e,t.uri))})},getAllSegments=function(i){const e=i.segments||[],t=i.preloadSegment;if(t&&t.parts&&t.parts.length){if(t.preloadHints){for(let n=0;n<t.preloadHints.length;n++)if(t.preloadHints[n].type==="MAP")return e}t.duration=i.targetDuration,t.preload=!0,e.push(t)}return e},isPlaylistUnchanged=(i,e)=>i===e||i.segments&&e.segments&&i.segments.length===e.segments.length&&i.endList===e.endList&&i.mediaSequence===e.mediaSequence&&i.preloadSegment===e.preloadSegment,updateMain$1=(i,e,t=isPlaylistUnchanged)=>{const n=merge(i,{}),r=n.playlists[e.id];if(!r||t(r,e))return null;e.segments=getAllSegments(e);const s=merge(r,e);if(s.preloadSegment&&!e.preloadSegment&&delete s.preloadSegment,r.segments){if(e.skip){e.segments=e.segments||[];for(let a=0;a<e.skip.skippedSegments;a++)e.segments.unshift({skipped:!0})}s.segments=updateSegments(r.segments,e.segments,e.mediaSequence-r.mediaSequence)}s.segments.forEach(a=>{resolveSegmentUris(a,s.resolvedUri)});for(let a=0;a<n.playlists.length;a++)n.playlists[a].id===e.id&&(n.playlists[a]=s);return n.playlists[e.id]=s,n.playlists[e.uri]=s,forEachMediaGroup(i,(a,l,u,d)=>{if(a.playlists)for(let h=0;h<a.playlists.length;h++)e.id===a.playlists[h].id&&(a.playlists[h]=s)}),n},refreshDelay=(i,e)=>{const t=i.segments||[],n=t[t.length-1],r=n&&n.parts&&n.parts[n.parts.length-1],s=r&&r.duration||n&&n.duration;return e&&s?s*1e3:(i.partTargetDuration||i.targetDuration||10)*500},playlistMetadataPayload=(i,e,t)=>{if(!i)return;const n=[];return i.forEach(r=>{if(!r.attributes)return;const{BANDWIDTH:s,RESOLUTION:a,CODECS:l}=r.attributes;n.push({id:r.id,bandwidth:s,resolution:a,codecs:l})}),{type:e,isLive:t,renditions:n}};class PlaylistLoader extends EventTarget$1{constructor(e,t,n={}){if(super(),!e)throw new Error("A non-empty playlist URL or object is required");this.logger_=logger("PlaylistLoader");const{withCredentials:r=!1}=n;this.src=e,this.vhs_=t,this.withCredentials=r,this.addDateRangesToTextTrack_=n.addDateRangesToTextTrack;const s=t.options_;this.customTagParsers=s&&s.customTagParsers||[],this.customTagMappers=s&&s.customTagMappers||[],this.llhls=s&&s.llhls,this.dateRangesStorage_=new DateRangesStorage,this.state="HAVE_NOTHING",this.handleMediaupdatetimeout_=this.handleMediaupdatetimeout_.bind(this),this.on("mediaupdatetimeout",this.handleMediaupdatetimeout_),this.on("loadedplaylist",this.handleLoadedPlaylist_.bind(this))}handleLoadedPlaylist_(){const e=this.media();if(!e)return;this.dateRangesStorage_.setOffset(e.segments),this.dateRangesStorage_.setPendingDateRanges(e.dateRanges);const t=this.dateRangesStorage_.getDateRangesToProcess();!t.length||!this.addDateRangesToTextTrack_||this.addDateRangesToTextTrack_(t)}handleMediaupdatetimeout_(){if(this.state!=="HAVE_METADATA")return;const e=this.media();let t=resolveUrl(this.main.uri,e.uri);this.llhls&&(t=addLLHLSQueryDirectives(t,e)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:t,withCredentials:this.withCredentials,requestType:"hls-playlist"},(n,r)=>{if(this.request){if(n)return this.playlistRequestError(this.request,this.media(),"HAVE_METADATA");this.haveMetadata({playlistString:this.request.responseText,url:this.media().uri,id:this.media().id})}})}playlistRequestError(e,t,n){const{uri:r,id:s}=t;this.request=null,n&&(this.state=n),this.error={playlist:this.main.playlists[s],status:e.status,message:`HLS playlist request error at URL: ${r}.`,responseText:e.responseText,code:e.status>=500?4:2,metadata:getStreamingNetworkErrorMetadata({requestType:e.requestType,request:e,error:e.error})},this.trigger("error")}parseManifest_({url:e,manifestString:t}){try{const n=parseManifest({onwarn:({message:r})=>this.logger_(`m3u8-parser warn for ${e}: ${r}`),oninfo:({message:r})=>this.logger_(`m3u8-parser info for ${e}: ${r}`),manifestString:t,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,llhls:this.llhls});return!n.playlists||!n.playlists.length||this.excludeAudioOnlyVariants(n.playlists),n}catch(n){this.error=n,this.error.metadata={errorType:videojs.Error.StreamingHlsPlaylistParserError,error:n}}}excludeAudioOnlyVariants(e){const t=n=>{const r=n.attributes||{},{width:s,height:a}=r.RESOLUTION||{};if(s&&a)return!0;const l=getCodecs(n)||[];return!!unwrapCodecList(l).video};e.some(t)&&e.forEach(n=>{t(n)||(n.excludeUntil=1/0)})}haveMetadata({playlistString:e,playlistObject:t,url:n,id:r}){this.request=null,this.state="HAVE_METADATA";const s={playlistInfo:{type:"media",uri:n}};this.trigger({type:"playlistparsestart",metadata:s});const a=t||this.parseManifest_({url:n,manifestString:e});a.lastRequest=Date.now(),setupMediaPlaylist({playlist:a,uri:n,id:r});const l=updateMain$1(this.main,a);this.targetDuration=a.partTargetDuration||a.targetDuration,this.pendingMedia_=null,l?(this.main=l,this.media_=this.main.playlists[r]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_(refreshDelay(this.media(),!!l)),s.parsedPlaylist=playlistMetadataPayload(this.main.playlists,s.playlistInfo.type,!this.media_.endList),this.trigger({type:"playlistparsecomplete",metadata:s}),this.trigger("loadedplaylist")}dispose(){this.trigger("dispose"),this.stopRequest(),window$1.clearTimeout(this.mediaUpdateTimeout),window$1.clearTimeout(this.finalRenditionTimeout),this.dateRangesStorage_=new DateRangesStorage,this.off()}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e,t){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);if(typeof e=="string"){if(!this.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.main.playlists[e]}if(window$1.clearTimeout(this.finalRenditionTimeout),t){const l=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=window$1.setTimeout(this.media.bind(this,e,!1),l);return}const n=this.state,r=!this.media_||e.id!==this.media_.id,s=this.main.playlists[e.id];if(s&&s.endList||e.endList&&e.segments.length){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,r&&(this.trigger("mediachanging"),n==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange"));return}if(this.updateMediaUpdateTimeout_(refreshDelay(e,!0)),!r)return;if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e;const a={playlistInfo:{type:"media",uri:e.uri}};this.trigger({type:"playlistrequeststart",metadata:a}),this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials,requestType:"hls-playlist"},(l,u)=>{if(this.request){if(e.lastRequest=Date.now(),e.resolvedUri=resolveManifestRedirect(e.resolvedUri,u),l)return this.playlistRequestError(this.request,e,n);this.trigger({type:"playlistrequestcomplete",metadata:a}),this.haveMetadata({playlistString:u.responseText,url:e.uri,id:e.id}),n==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}})}pause(){this.mediaUpdateTimeout&&(window$1.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),this.state==="HAVE_NOTHING"&&(this.started=!1),this.state==="SWITCHING_MEDIA"?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MAIN_MANIFEST":this.state==="HAVE_CURRENT_METADATA"&&(this.state="HAVE_METADATA")}load(e){this.mediaUpdateTimeout&&(window$1.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);const t=this.media();if(e){const n=t?(t.partTargetDuration||t.targetDuration)/2*1e3:5e3;this.mediaUpdateTimeout=window$1.setTimeout(()=>{this.mediaUpdateTimeout=null,this.load()},n);return}if(!this.started){this.start();return}t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist")}updateMediaUpdateTimeout_(e){this.mediaUpdateTimeout&&(window$1.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),!(!this.media()||this.media().endList)&&(this.mediaUpdateTimeout=window$1.setTimeout(()=>{this.mediaUpdateTimeout=null,this.trigger("mediaupdatetimeout"),this.updateMediaUpdateTimeout_(e)},e))}start(){if(this.started=!0,typeof this.src=="object"){this.src.uri||(this.src.uri=window$1.location.href),this.src.resolvedUri=this.src.uri,setTimeout(()=>{this.setupInitialPlaylist(this.src)},0);return}const e={playlistInfo:{type:"multivariant",uri:this.src}};this.trigger({type:"playlistrequeststart",metadata:e}),this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials,requestType:"hls-playlist"},(t,n)=>{if(!this.request)return;if(this.request=null,t)return this.error={status:n.status,message:`HLS playlist request error at URL: ${this.src}.`,responseText:n.responseText,code:2,metadata:getStreamingNetworkErrorMetadata({requestType:n.requestType,request:n,error:t})},this.state==="HAVE_NOTHING"&&(this.started=!1),this.trigger("error");this.trigger({type:"playlistrequestcomplete",metadata:e}),this.src=resolveManifestRedirect(this.src,n),this.trigger({type:"playlistparsestart",metadata:e});const r=this.parseManifest_({manifestString:n.responseText,url:this.src});e.parsedPlaylist=playlistMetadataPayload(r.playlists,e.playlistInfo.type,!1),this.trigger({type:"playlistparsecomplete",metadata:e}),this.setupInitialPlaylist(r)})}srcUri(){return typeof this.src=="string"?this.src:this.src.uri}setupInitialPlaylist(e){if(this.state="HAVE_MAIN_MANIFEST",e.playlists){this.main=e,addPropertiesToMain(this.main,this.srcUri()),e.playlists.forEach(n=>{n.segments=getAllSegments(n),n.segments.forEach(r=>{resolveSegmentUris(r,n.resolvedUri)})}),this.trigger("loadedplaylist"),this.request||this.media(this.main.playlists[0]);return}const t=this.srcUri()||window$1.location.href;this.main=mainForMedia(e,t),this.haveMetadata({playlistObject:e,url:t,id:this.main.playlists[0].id}),this.trigger("loadedmetadata")}updateOrDeleteClone(e,t){const n=this.main,r=e.ID;let s=n.playlists.length;for(;s--;){const a=n.playlists[s];if(a.attributes["PATHWAY-ID"]===r){const l=a.resolvedUri,u=a.id;if(t){const d=this.createCloneURI_(a.resolvedUri,e),h=createPlaylistID(r,d),p=this.createCloneAttributes_(r,a.attributes),m=this.createClonePlaylist_(a,h,e,p);n.playlists[s]=m,n.playlists[h]=m,n.playlists[d]=m}else n.playlists.splice(s,1);delete n.playlists[u],delete n.playlists[l]}}this.updateOrDeleteCloneMedia(e,t)}updateOrDeleteCloneMedia(e,t){const n=this.main,r=e.ID;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(s=>{if(!(!n.mediaGroups[s]||!n.mediaGroups[s][r])){for(const a in n.mediaGroups[s])if(a===r){for(const l in n.mediaGroups[s][a])n.mediaGroups[s][a][l].playlists.forEach((d,h)=>{const p=n.playlists[d.id],m=p.id,g=p.resolvedUri;delete n.playlists[m],delete n.playlists[g]});delete n.mediaGroups[s][a]}}}),t&&this.createClonedMediaGroups_(e)}addClonePathway(e,t={}){const n=this.main,r=n.playlists.length,s=this.createCloneURI_(t.resolvedUri,e),a=createPlaylistID(e.ID,s),l=this.createCloneAttributes_(e.ID,t.attributes),u=this.createClonePlaylist_(t,a,e,l);n.playlists[r]=u,n.playlists[a]=u,n.playlists[s]=u,this.createClonedMediaGroups_(e)}createClonedMediaGroups_(e){const t=e.ID,n=e["BASE-ID"],r=this.main;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(s=>{if(!(!r.mediaGroups[s]||r.mediaGroups[s][t]))for(const a in r.mediaGroups[s]){if(a===n)r.mediaGroups[s][t]={};else continue;for(const l in r.mediaGroups[s][a]){const u=r.mediaGroups[s][a][l];r.mediaGroups[s][t][l]=_extends({},u);const d=r.mediaGroups[s][t][l],h=this.createCloneURI_(u.resolvedUri,e);d.resolvedUri=h,d.uri=h,d.playlists=[],u.playlists.forEach((p,m)=>{const g=r.playlists[p.id],v=groupID(s,t,l),_=createPlaylistID(t,v);if(g&&!r.playlists[_]){const b=this.createClonePlaylist_(g,_,e),E=b.resolvedUri;r.playlists[_]=b,r.playlists[E]=b}d.playlists[m]=this.createClonePlaylist_(p,_,e)})}}})}createClonePlaylist_(e,t,n,r){const s=this.createCloneURI_(e.resolvedUri,n),a={resolvedUri:s,uri:s,id:t};return e.segments&&(a.segments=[]),r&&(a.attributes=r),merge(e,a)}createCloneURI_(e,t){const n=new URL(e);n.hostname=t["URI-REPLACEMENT"].HOST;const r=t["URI-REPLACEMENT"].PARAMS;for(const s of Object.keys(r))n.searchParams.set(s,r[s]);return n.href}createCloneAttributes_(e,t){const n={"PATHWAY-ID":e};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(r=>{t[r]&&(n[r]=e)}),n}getKeyIdSet(e){const t=new Set;if(!e||!e.contentProtection)return t;for(const n in e.contentProtection)if(e.contentProtection[n]&&e.contentProtection[n].attributes&&e.contentProtection[n].attributes.keyId){const r=e.contentProtection[n].attributes.keyId;t.add(r.toLowerCase())}return t}}const callbackWrapper=function(i,e,t,n){const r=i.responseType==="arraybuffer"?i.response:i.responseText;!e&&r&&(i.responseTime=Date.now(),i.roundTripTime=i.responseTime-i.requestTime,i.bytesReceived=r.byteLength||r.length,i.bandwidth||(i.bandwidth=Math.floor(i.bytesReceived/i.roundTripTime*8*1e3))),t.headers&&(i.responseHeaders=t.headers),e&&e.code==="ETIMEDOUT"&&(i.timedout=!0),!e&&!i.aborted&&t.statusCode!==200&&t.statusCode!==206&&t.statusCode!==0&&(e=new Error("XHR Failed with a response of: "+(i&&(r||i.responseText)))),n(e,i)},callAllRequestHooks=(i,e)=>{if(!i||!i.size)return;let t=e;return i.forEach(n=>{t=n(t)}),t},callAllResponseHooks=(i,e,t,n)=>{!i||!i.size||i.forEach(r=>{r(e,t,n)})},xhrFactory=function(){const i=function e(t,n){t=merge({timeout:45e3},t);const r=e.beforeRequest||videojs.Vhs.xhr.beforeRequest,s=e._requestCallbackSet||videojs.Vhs.xhr._requestCallbackSet||new Set,a=e._responseCallbackSet||videojs.Vhs.xhr._responseCallbackSet;r&&typeof r=="function"&&(videojs.log.warn("beforeRequest is deprecated, use onRequest instead."),s.add(r));const l=videojs.Vhs.xhr.original===!0?videojs.xhr:videojs.Vhs.xhr,u=callAllRequestHooks(s,t);s.delete(r);const d=l(u||t,function(p,m){return callAllResponseHooks(a,d,p,m),callbackWrapper(d,p,m,n)}),h=d.abort;return d.abort=function(){return d.aborted=!0,h.apply(d,arguments)},d.uri=t.uri,d.requestType=t.requestType,d.requestTime=Date.now(),d};return i.original=!0,i},byterangeStr=function(i){let e;const t=i.offset;return typeof i.offset=="bigint"||typeof i.length=="bigint"?e=window$1.BigInt(i.offset)+window$1.BigInt(i.length)-window$1.BigInt(1):e=i.offset+i.length-1,"bytes="+t+"-"+e},segmentXhrHeaders=function(i){const e={};return i.byterange&&(e.Range=byterangeStr(i.byterange)),e},textRange=function(i,e){return i.start(e)+"-"+i.end(e)},formatHexString=function(i,e){const t=i.toString(16);return"00".substring(0,2-t.length)+t+(e%2?" ":"")},formatAsciiString=function(i){return i>=32&&i<126?String.fromCharCode(i):"."},createTransferableMessage=function(i){const e={};return Object.keys(i).forEach(t=>{const n=i[t];isArrayBufferView(n)?e[t]={bytes:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}:e[t]=n}),e},initSegmentId=function(i){const e=i.byterange||{length:1/0,offset:0};return[e.length,e.offset,i.resolvedUri].join(",")},segmentKeyId=function(i){return i.resolvedUri},hexDump=i=>{const e=Array.prototype.slice.call(i),t=16;let n="",r,s;for(let a=0;a<e.length/t;a++)r=e.slice(a*t,a*t+t).map(formatHexString).join(""),s=e.slice(a*t,a*t+t).map(formatAsciiString).join(""),n+=r+" "+s+`
`;return n},tagDump=({bytes:i})=>hexDump(i),textRanges=i=>{let e="",t;for(t=0;t<i.length;t++)e+=textRange(i,t)+" ";return e};var utils=Object.freeze({__proto__:null,createTransferableMessage,initSegmentId,segmentKeyId,hexDump,tagDump,textRanges});const SEGMENT_END_FUDGE_PERCENT=.25,playerTimeToProgramTime=(i,e)=>{if(!e.dateTimeObject)return null;const t=e.videoTimingInfo.transmuxerPrependedSeconds,r=e.videoTimingInfo.transmuxedPresentationStart+t,s=i-r;return new Date(e.dateTimeObject.getTime()+s*1e3)},originalSegmentVideoDuration=i=>i.transmuxedPresentationEnd-i.transmuxedPresentationStart-i.transmuxerPrependedSeconds,findSegmentForProgramTime=(i,e)=>{let t;try{t=new Date(i)}catch{return null}if(!e||!e.segments||e.segments.length===0)return null;let n=e.segments[0];if(t<new Date(n.dateTimeObject))return null;for(let u=0;u<e.segments.length-1;u++){n=e.segments[u];const d=new Date(e.segments[u+1].dateTimeObject);if(t<d)break}const r=e.segments[e.segments.length-1],s=r.dateTimeObject,a=r.videoTimingInfo?originalSegmentVideoDuration(r.videoTimingInfo):r.duration+r.duration*SEGMENT_END_FUDGE_PERCENT,l=new Date(s.getTime()+a*1e3);return t>l?null:(t>new Date(s)&&(n=r),{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:Playlist.duration(e,e.mediaSequence+e.segments.indexOf(n)),type:n.videoTimingInfo?"accurate":"estimate"})},findSegmentForPlayerTime=(i,e)=>{if(!e||!e.segments||e.segments.length===0)return null;let t=0,n;for(let s=0;s<e.segments.length&&(n=e.segments[s],t=n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationEnd:t+n.duration,!(i<=t));s++);const r=e.segments[e.segments.length-1];if(r.videoTimingInfo&&r.videoTimingInfo.transmuxedPresentationEnd<i)return null;if(i>t){if(i>t+r.duration*SEGMENT_END_FUDGE_PERCENT)return null;n=r}return{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:t-n.duration,type:n.videoTimingInfo?"accurate":"estimate"}},getOffsetFromTimestamp=(i,e)=>{let t,n;try{t=new Date(i),n=new Date(e)}catch{}const r=t.getTime();return(n.getTime()-r)/1e3},verifyProgramDateTimeTags=i=>{if(!i.segments||i.segments.length===0)return!1;for(let e=0;e<i.segments.length;e++)if(!i.segments[e].dateTimeObject)return!1;return!0},getProgramTime=({playlist:i,time:e=void 0,callback:t})=>{if(!t)throw new Error("getProgramTime: callback must be provided");if(!i||e===void 0)return t({message:"getProgramTime: playlist and time must be provided"});const n=findSegmentForPlayerTime(e,i);if(!n)return t({message:"valid programTime was not found"});if(n.type==="estimate")return t({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:n.estimatedStart});const r={mediaSeconds:e},s=playerTimeToProgramTime(e,n.segment);return s&&(r.programDateTime=s.toISOString()),t(null,r)},seekToProgramTime=({programTime:i,playlist:e,retryCount:t=2,seekTo:n,pauseAfterSeek:r=!0,tech:s,callback:a})=>{if(!a)throw new Error("seekToProgramTime: callback must be provided");if(typeof i>"u"||!e||!n)return a({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!e.endList&&!s.hasStarted_)return a({message:"player must be playing a live stream to start buffering"});if(!verifyProgramDateTimeTags(e))return a({message:"programDateTime tags must be provided in the manifest "+e.resolvedUri});const l=findSegmentForProgramTime(i,e);if(!l)return a({message:`${i} was not found in the stream`});const u=l.segment,d=getOffsetFromTimestamp(u.dateTimeObject,i);if(l.type==="estimate"){if(t===0)return a({message:`${i} is not buffered yet. Try again`});n(l.estimatedStart+d),s.one("seeked",()=>{seekToProgramTime({programTime:i,playlist:e,retryCount:t-1,seekTo:n,pauseAfterSeek:r,tech:s,callback:a})});return}const h=u.start+d,p=()=>a(null,s.currentTime());s.one("seeked",p),r&&s.pause(),n(h)},callbackOnCompleted=(i,e)=>{if(i.readyState===4)return e()},containerRequest=(i,e,t,n)=>{let r=[],s,a=!1;const l=function(p,m,g,v){return m.abort(),a=!0,t(p,m,g,v)},u=function(p,m){if(a)return;if(p)return p.metadata=getStreamingNetworkErrorMetadata({requestType:n,request:m,error:p}),l(p,m,"",r);const g=m.responseText.substring(r&&r.byteLength||0,m.responseText.length);if(r=concatTypedArrays(r,stringToBytes$1(g,!0)),s=s||getId3Offset(r),r.length<10||s&&r.length<s+2)return callbackOnCompleted(m,()=>l(p,m,"",r));const v=detectContainerForBytes(r);return v==="ts"&&r.length<188?callbackOnCompleted(m,()=>l(p,m,"",r)):!v&&r.length<376?callbackOnCompleted(m,()=>l(p,m,"",r)):l(null,m,v,r)},h=e({uri:i,beforeSend(p){p.overrideMimeType("text/plain; charset=x-user-defined"),p.addEventListener("progress",function({total:m,loaded:g}){return callbackWrapper(p,null,{statusCode:p.status},u)})}},function(p,m){return callbackWrapper(h,p,m,u)});return h},{EventTarget}=videojs,dashPlaylistUnchanged=function(i,e){if(!isPlaylistUnchanged(i,e)||i.sidx&&e.sidx&&(i.sidx.offset!==e.sidx.offset||i.sidx.length!==e.sidx.length))return!1;if(!i.sidx&&e.sidx||i.sidx&&!e.sidx||i.segments&&!e.segments||!i.segments&&e.segments)return!1;if(!i.segments&&!e.segments)return!0;for(let t=0;t<i.segments.length;t++){const n=i.segments[t],r=e.segments[t];if(n.uri!==r.uri)return!1;if(!n.byterange&&!r.byterange)continue;const s=n.byterange,a=r.byterange;if(s&&!a||!s&&a||s.offset!==a.offset||s.length!==a.length)return!1}return!0},dashGroupId=(i,e,t,n)=>{const r=n.attributes.NAME||t;return`placeholder-uri-${i}-${e}-${r}`},parseMainXml=({mainXml:i,srcUrl:e,clientOffset:t,sidxMapping:n,previousManifest:r})=>{const s=parse(i,{manifestUri:e,clientOffset:t,sidxMapping:n,previousManifest:r});return addPropertiesToMain(s,e,dashGroupId),s},removeOldMediaGroupLabels=(i,e)=>{forEachMediaGroup(i,(t,n,r,s)=>{(!e.mediaGroups[n][r]||!(s in e.mediaGroups[n][r]))&&delete i.mediaGroups[n][r][s]})},updateMain=(i,e,t)=>{let n=!0,r=merge(i,{duration:e.duration,minimumUpdatePeriod:e.minimumUpdatePeriod,timelineStarts:e.timelineStarts});for(let s=0;s<e.playlists.length;s++){const a=e.playlists[s];if(a.sidx){const u=generateSidxKey(a.sidx);t&&t[u]&&t[u].sidx&&addSidxSegmentsToPlaylist$1(a,t[u].sidx,a.sidx.resolvedUri)}const l=updateMain$1(r,a,dashPlaylistUnchanged);l&&(r=l,n=!1)}return forEachMediaGroup(e,(s,a,l,u)=>{if(s.playlists&&s.playlists.length){const d=s.playlists[0].id,h=updateMain$1(r,s.playlists[0],dashPlaylistUnchanged);h&&(r=h,u in r.mediaGroups[a][l]||(r.mediaGroups[a][l][u]=s),r.mediaGroups[a][l][u].playlists[0]=r.playlists[d],n=!1)}}),removeOldMediaGroupLabels(r,e),e.minimumUpdatePeriod!==i.minimumUpdatePeriod&&(n=!1),n?null:r},equivalentSidx=(i,e)=>(!i.map&&!e.map||!!(i.map&&e.map&&i.map.byterange.offset===e.map.byterange.offset&&i.map.byterange.length===e.map.byterange.length))&&i.uri===e.uri&&i.byterange.offset===e.byterange.offset&&i.byterange.length===e.byterange.length,compareSidxEntry=(i,e)=>{const t={};for(const n in i){const s=i[n].sidx;if(s){const a=generateSidxKey(s);if(!e[a])break;const l=e[a].sidxInfo;equivalentSidx(l,s)&&(t[a]=e[a])}}return t},filterChangedSidxMappings=(i,e)=>{let n=compareSidxEntry(i.playlists,e);return forEachMediaGroup(i,(r,s,a,l)=>{if(r.playlists&&r.playlists.length){const u=r.playlists;n=merge(n,compareSidxEntry(u,e))}}),n};class DashPlaylistLoader extends EventTarget{constructor(e,t,n={},r){super(),this.isPaused_=!0,this.mainPlaylistLoader_=r||this,r||(this.isMain_=!0);const{withCredentials:s=!1}=n;if(this.vhs_=t,this.withCredentials=s,this.addMetadataToTextTrack=n.addMetadataToTextTrack,!e)throw new Error("A non-empty playlist URL or object is required");this.on("minimumUpdatePeriod",()=>{this.refreshXml_()}),this.on("mediaupdatetimeout",()=>{this.refreshMedia_(this.media().id)}),this.state="HAVE_NOTHING",this.loadedPlaylists_={},this.logger_=logger("DashPlaylistLoader"),this.isMain_?(this.mainPlaylistLoader_.srcUrl=e,this.mainPlaylistLoader_.sidxMapping_={}):this.childPlaylist_=e}get isPaused(){return this.isPaused_}requestErrored_(e,t,n){if(!this.request)return!0;if(this.request=null,e)return this.error=typeof e=="object"&&!(e instanceof Error)?e:{status:t.status,message:"DASH request error at URL: "+t.uri,response:t.response,code:2,metadata:e.metadata},n&&(this.state=n),this.trigger("error"),!0}addSidxSegments_(e,t,n){const r=e.sidx&&generateSidxKey(e.sidx);if(!e.sidx||!r||this.mainPlaylistLoader_.sidxMapping_[r]){window$1.clearTimeout(this.mediaRequest_),this.mediaRequest_=window$1.setTimeout(()=>n(!1),0);return}const s=resolveManifestRedirect(e.sidx.resolvedUri),a=(u,d)=>{if(this.requestErrored_(u,d,t))return;const h=this.mainPlaylistLoader_.sidxMapping_,{requestType:p}=d;let m;try{m=parseSidx(toUint8(d.response).subarray(8))}catch(g){g.metadata=getStreamingNetworkErrorMetadata({requestType:p,request:d,parseFailure:!0}),this.requestErrored_(g,d,t);return}return h[r]={sidxInfo:e.sidx,sidx:m},addSidxSegmentsToPlaylist$1(e,m,e.sidx.resolvedUri),n(!0)},l="dash-sidx";this.request=containerRequest(s,this.vhs_.xhr,(u,d,h,p)=>{if(u)return a(u,d);if(!h||h!=="mp4"){const v=h||"unknown";return a({status:d.status,message:`Unsupported ${v} container type for sidx segment at URL: ${s}`,response:"",playlist:e,internal:!0,playlistExclusionDuration:1/0,code:2},d)}const{offset:m,length:g}=e.sidx.byterange;if(p.length>=g+m)return a(u,{response:p.subarray(m,m+g),status:d.status,uri:d.uri});this.request=this.vhs_.xhr({uri:s,responseType:"arraybuffer",requestType:"dash-sidx",headers:segmentXhrHeaders({byterange:e.sidx.byterange})},a)},l)}dispose(){this.isPaused_=!0,this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},window$1.clearTimeout(this.minimumUpdatePeriodTimeout_),window$1.clearTimeout(this.mediaRequest_),window$1.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.off()}hasPendingRequest(){return this.request||this.mediaRequest_}stopRequest(){if(this.request){const e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}media(e){if(!e)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);const t=this.state;if(typeof e=="string"){if(!this.mainPlaylistLoader_.main.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.mainPlaylistLoader_.main.playlists[e]}const n=!this.media_||e.id!==this.media_.id;if(n&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList){this.state="HAVE_METADATA",this.media_=e,n&&(this.trigger("mediachanging"),this.trigger("mediachange"));return}n&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,t,r=>{this.haveMetadata({startingState:t,playlist:e})}))}haveMetadata({startingState:e,playlist:t}){this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,window$1.clearTimeout(this.mediaRequest_),this.mediaRequest_=null,this.refreshMedia_(t.id),e==="HAVE_MAIN_MANIFEST"?this.trigger("loadedmetadata"):this.trigger("mediachange")}pause(){this.isPaused_=!0,this.mainPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.mainPlaylistLoader_.createMupOnMedia_),this.mainPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),window$1.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMain_&&(window$1.clearTimeout(this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_),this.mainPlaylistLoader_.minimumUpdatePeriodTimeout_=null),this.state==="HAVE_NOTHING"&&(this.started=!1)}load(e){this.isPaused_=!1,window$1.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;const t=this.media();if(e){const n=t?t.targetDuration/2*1e3:5e3;this.mediaUpdateTimeout=window$1.setTimeout(()=>this.load(),n);return}if(!this.started){this.start();return}t&&!t.endList?(this.isMain_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist")}start(){if(this.started=!0,!this.isMain_){window$1.clearTimeout(this.mediaRequest_),this.mediaRequest_=window$1.setTimeout(()=>this.haveMain_(),0);return}this.requestMain_((e,t)=>{this.haveMain_(),!this.hasPendingRequest()&&!this.media_&&this.media(this.mainPlaylistLoader_.main.playlists[0])})}requestMain_(e){const t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestrequeststart",metadata:t}),this.request=this.vhs_.xhr({uri:this.mainPlaylistLoader_.srcUrl,withCredentials:this.withCredentials,requestType:"dash-manifest"},(n,r)=>{if(n){const{requestType:a}=r;n.metadata=getStreamingNetworkErrorMetadata({requestType:a,request:r,error:n})}if(this.requestErrored_(n,r)){this.state==="HAVE_NOTHING"&&(this.started=!1);return}this.trigger({type:"manifestrequestcomplete",metadata:t});const s=r.responseText!==this.mainPlaylistLoader_.mainXml_;if(this.mainPlaylistLoader_.mainXml_=r.responseText,r.responseHeaders&&r.responseHeaders.date?this.mainLoaded_=Date.parse(r.responseHeaders.date):this.mainLoaded_=Date.now(),this.mainPlaylistLoader_.srcUrl=resolveManifestRedirect(this.mainPlaylistLoader_.srcUrl,r),s){this.handleMain_(),this.syncClientServerClock_(()=>e(r,s));return}return e(r,s)})}syncClientServerClock_(e){const t=parseUTCTiming(this.mainPlaylistLoader_.mainXml_);if(t===null)return this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e();if(t.method==="DIRECT")return this.mainPlaylistLoader_.clientOffset_=t.value-Date.now(),e();this.request=this.vhs_.xhr({uri:resolveUrl(this.mainPlaylistLoader_.srcUrl,t.value),method:t.method,withCredentials:this.withCredentials,requestType:"dash-clock-sync"},(n,r)=>{if(!this.request)return;if(n){const{requestType:a}=r;return this.error.metadata=getStreamingNetworkErrorMetadata({requestType:a,request:r,error:n}),this.mainPlaylistLoader_.clientOffset_=this.mainLoaded_-Date.now(),e()}let s;t.method==="HEAD"?!r.responseHeaders||!r.responseHeaders.date?s=this.mainLoaded_:s=Date.parse(r.responseHeaders.date):s=Date.parse(r.responseText),this.mainPlaylistLoader_.clientOffset_=s-Date.now(),e()})}haveMain_(){this.state="HAVE_MAIN_MANIFEST",this.isMain_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)}handleMain_(){window$1.clearTimeout(this.mediaRequest_),this.mediaRequest_=null;const e=this.mainPlaylistLoader_.main,t={manifestInfo:{uri:this.mainPlaylistLoader_.srcUrl}};this.trigger({type:"manifestparsestart",metadata:t});let n;try{n=parseMainXml({mainXml:this.mainPlaylistLoader_.mainXml_,srcUrl:this.mainPlaylistLoader_.srcUrl,clientOffset:this.mainPlaylistLoader_.clientOffset_,sidxMapping:this.mainPlaylistLoader_.sidxMapping_,previousManifest:e})}catch(s){this.error=s,this.error.metadata={errorType:videojs.Error.StreamingDashManifestParserError,error:s},this.trigger("error")}e&&(n=updateMain(e,n,this.mainPlaylistLoader_.sidxMapping_)),this.mainPlaylistLoader_.main=n||e;const r=this.mainPlaylistLoader_.main.locations&&this.mainPlaylistLoader_.main.locations[0];if(r&&r!==this.mainPlaylistLoader_.srcUrl&&(this.mainPlaylistLoader_.srcUrl=r),(!e||n&&n.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),this.addEventStreamToMetadataTrack_(n),n){const{duration:s,endList:a}=n,l=[];n.playlists.forEach(d=>{l.push({id:d.id,bandwidth:d.attributes.BANDWIDTH,resolution:d.attributes.RESOLUTION,codecs:d.attributes.CODECS})});const u={duration:s,isLive:!a,renditions:l};t.parsedManifest=u,this.trigger({type:"manifestparsecomplete",metadata:t})}return!!n}updateMinimumUpdatePeriodTimeout_(){const e=this.mainPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(window$1.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);let t=e.main&&e.main.minimumUpdatePeriod;if(t===0&&(e.media()?t=e.media().targetDuration*1e3:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),typeof t!="number"||t<=0){t<0&&this.logger_(`found invalid minimumUpdatePeriod of ${t}, not setting a timeout`);return}this.createMUPTimeout_(t)}createMUPTimeout_(e){const t=this.mainPlaylistLoader_;t.minimumUpdatePeriodTimeout_=window$1.setTimeout(()=>{t.minimumUpdatePeriodTimeout_=null,t.trigger("minimumUpdatePeriod"),t.createMUPTimeout_(e)},e)}refreshXml_(){this.requestMain_((e,t)=>{t&&(this.media_&&(this.media_=this.mainPlaylistLoader_.main.playlists[this.media_.id]),this.mainPlaylistLoader_.sidxMapping_=filterChangedSidxMappings(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.sidxMapping_),this.addSidxSegments_(this.media(),this.state,n=>{this.refreshMedia_(this.media().id)}))})}refreshMedia_(e){if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMain_&&this.handleMain_();const t=this.mainPlaylistLoader_.main.playlists,n=!this.media_||this.media_!==t[e];if(n?this.media_=t[e]:this.trigger("playlistunchanged"),!this.mediaUpdateTimeout){const r=()=>{this.media().endList||(this.mediaUpdateTimeout=window$1.setTimeout(()=>{this.trigger("mediaupdatetimeout"),r()},refreshDelay(this.media(),!!n)))};r()}this.trigger("loadedplaylist")}addEventStreamToMetadataTrack_(e){if(e&&this.mainPlaylistLoader_.main.eventStream){const t=this.mainPlaylistLoader_.main.eventStream.map(n=>({cueTime:n.start,frames:[{data:n.messageData}]}));this.addMetadataToTextTrack("EventStream",t,this.mainPlaylistLoader_.main.duration)}}getKeyIdSet(e){if(e.contentProtection){const t=new Set;for(const n in e.contentProtection){const r=e.contentProtection[n].attributes["cenc:default_KID"];r&&t.add(r.replace(/-/g,"").toLowerCase())}return t}}}var Config={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30};const stringToArrayBuffer=i=>{const e=new Uint8Array(new ArrayBuffer(i.length));for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e.buffer},browserWorkerPolyFill=function(i){return i.on=i.addEventListener,i.off=i.removeEventListener,i},createObjectURL=function(i){try{return URL.createObjectURL(new Blob([i],{type:"application/javascript"}))}catch{const t=new BlobBuilder;return t.append(i),URL.createObjectURL(t.getBlob())}},factory=function(i){return function(){const e=createObjectURL(i),t=browserWorkerPolyFill(new Worker(e));t.objURL=e;const n=t.terminate;return t.on=t.addEventListener,t.off=t.removeEventListener,t.terminate=function(){return URL.revokeObjectURL(e),n.call(this)},t}},transform=function(i){return`var browserWorkerPolyFill = ${browserWorkerPolyFill.toString()};
browserWorkerPolyFill(self);
`+i},getWorkerString=function(i){return i.toString().replace(/^function.+?{/,"").slice(0,-1)},workerCode$1=transform(getWorkerString(function(){var i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=function(){this.init=function(){var S={};this.on=function(Y,ie){S[Y]||(S[Y]=[]),S[Y]=S[Y].concat(ie)},this.off=function(Y,ie){var ne;return S[Y]?(ne=S[Y].indexOf(ie),S[Y]=S[Y].slice(),S[Y].splice(ne,1),ne>-1):!1},this.trigger=function(Y){var ie,ne,he,ge;if(ie=S[Y],!!ie)if(arguments.length===2)for(he=ie.length,ne=0;ne<he;++ne)ie[ne].call(this,arguments[1]);else{for(ge=[],ne=arguments.length,ne=1;ne<arguments.length;++ne)ge.push(arguments[ne]);for(he=ie.length,ne=0;ne<he;++ne)ie[ne].apply(this,ge)}},this.dispose=function(){S={}}}};e.prototype.pipe=function(S){return this.on("data",function(Y){S.push(Y)}),this.on("done",function(Y){S.flush(Y)}),this.on("partialdone",function(Y){S.partialFlush(Y)}),this.on("endedtimeline",function(Y){S.endTimeline(Y)}),this.on("reset",function(Y){S.reset(Y)}),S},e.prototype.push=function(S){this.trigger("data",S)},e.prototype.flush=function(S){this.trigger("done",S)},e.prototype.partialFlush=function(S){this.trigger("partialdone",S)},e.prototype.endTimeline=function(S){this.trigger("endedtimeline",S)},e.prototype.reset=function(S){this.trigger("reset",S)};var t=e,n=Math.pow(2,32),r=function(S){var Y=new DataView(S.buffer,S.byteOffset,S.byteLength),ie;return Y.getBigUint64?(ie=Y.getBigUint64(0),ie<Number.MAX_SAFE_INTEGER?Number(ie):ie):Y.getUint32(0)*n+Y.getUint32(4)},s={getUint64:r,MAX_UINT32:n},a=s.MAX_UINT32,l,u,d,h,p,m,g,v,_,b,E,A,z,D,P,G,R,I,w,H,V,te,ae,be,_e,le,ue,oe,ee,se,re,fe,pe,Z,ce,Ee;(function(){var S;if(ae={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(S in ae)ae.hasOwnProperty(S)&&(ae[S]=[S.charCodeAt(0),S.charCodeAt(1),S.charCodeAt(2),S.charCodeAt(3)]);be=new Uint8Array([105,115,111,109]),le=new Uint8Array([97,118,99,49]),_e=new Uint8Array([0,0,0,1]),ue=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),oe=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),ee={video:ue,audio:oe},fe=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),re=new Uint8Array([0,0,0,0,0,0,0,0]),pe=new Uint8Array([0,0,0,0,0,0,0,0]),Z=pe,ce=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Ee=pe,se=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),l=function(S){var Y=[],ie=0,ne,he,ge;for(ne=1;ne<arguments.length;ne++)Y.push(arguments[ne]);for(ne=Y.length;ne--;)ie+=Y[ne].byteLength;for(he=new Uint8Array(ie+8),ge=new DataView(he.buffer,he.byteOffset,he.byteLength),ge.setUint32(0,he.byteLength),he.set(S,4),ne=0,ie=8;ne<Y.length;ne++)he.set(Y[ne],ie),ie+=Y[ne].byteLength;return he},u=function(){return l(ae.dinf,l(ae.dref,fe))},d=function(S){return l(ae.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,S.audioobjecttype<<3|S.samplingfrequencyindex>>>1,S.samplingfrequencyindex<<7|S.channelcount<<3,6,1,2]))},h=function(){return l(ae.ftyp,be,_e,be,le)},G=function(S){return l(ae.hdlr,ee[S])},p=function(S){return l(ae.mdat,S)},P=function(S){var Y=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,S.duration>>>24&255,S.duration>>>16&255,S.duration>>>8&255,S.duration&255,85,196,0,0]);return S.samplerate&&(Y[12]=S.samplerate>>>24&255,Y[13]=S.samplerate>>>16&255,Y[14]=S.samplerate>>>8&255,Y[15]=S.samplerate&255),l(ae.mdhd,Y)},D=function(S){return l(ae.mdia,P(S),G(S.type),g(S))},m=function(S){return l(ae.mfhd,new Uint8Array([0,0,0,0,(S&4278190080)>>24,(S&16711680)>>16,(S&65280)>>8,S&255]))},g=function(S){return l(ae.minf,S.type==="video"?l(ae.vmhd,se):l(ae.smhd,re),u(),I(S))},v=function(S,Y){for(var ie=[],ne=Y.length;ne--;)ie[ne]=H(Y[ne]);return l.apply(null,[ae.moof,m(S)].concat(ie))},_=function(S){for(var Y=S.length,ie=[];Y--;)ie[Y]=A(S[Y]);return l.apply(null,[ae.moov,E(4294967295)].concat(ie).concat(b(S)))},b=function(S){for(var Y=S.length,ie=[];Y--;)ie[Y]=V(S[Y]);return l.apply(null,[ae.mvex].concat(ie))},E=function(S){var Y=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(S&4278190080)>>24,(S&16711680)>>16,(S&65280)>>8,S&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return l(ae.mvhd,Y)},R=function(S){var Y=S.samples||[],ie=new Uint8Array(4+Y.length),ne,he;for(he=0;he<Y.length;he++)ne=Y[he].flags,ie[he+4]=ne.dependsOn<<4|ne.isDependedOn<<2|ne.hasRedundancy;return l(ae.sdtp,ie)},I=function(S){return l(ae.stbl,w(S),l(ae.stts,Ee),l(ae.stsc,Z),l(ae.stsz,ce),l(ae.stco,pe))},(function(){var S,Y;w=function(ie){return l(ae.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),ie.type==="video"?S(ie):Y(ie))},S=function(ie){var ne=ie.sps||[],he=ie.pps||[],ge=[],Ie=[],ke,Ne;for(ke=0;ke<ne.length;ke++)ge.push((ne[ke].byteLength&65280)>>>8),ge.push(ne[ke].byteLength&255),ge=ge.concat(Array.prototype.slice.call(ne[ke]));for(ke=0;ke<he.length;ke++)Ie.push((he[ke].byteLength&65280)>>>8),Ie.push(he[ke].byteLength&255),Ie=Ie.concat(Array.prototype.slice.call(he[ke]));if(Ne=[ae.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(ie.width&65280)>>8,ie.width&255,(ie.height&65280)>>8,ie.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l(ae.avcC,new Uint8Array([1,ie.profileIdc,ie.profileCompatibility,ie.levelIdc,255].concat([ne.length],ge,[he.length],Ie))),l(ae.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],ie.sarRatio){var Ve=ie.sarRatio[0],et=ie.sarRatio[1];Ne.push(l(ae.pasp,new Uint8Array([(Ve&4278190080)>>24,(Ve&16711680)>>16,(Ve&65280)>>8,Ve&255,(et&4278190080)>>24,(et&16711680)>>16,(et&65280)>>8,et&255])))}return l.apply(null,Ne)},Y=function(ie){return l(ae.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(ie.channelcount&65280)>>8,ie.channelcount&255,(ie.samplesize&65280)>>8,ie.samplesize&255,0,0,0,0,(ie.samplerate&65280)>>8,ie.samplerate&255,0,0]),d(ie))}})(),z=function(S){var Y=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(S.id&4278190080)>>24,(S.id&16711680)>>16,(S.id&65280)>>8,S.id&255,0,0,0,0,(S.duration&4278190080)>>24,(S.duration&16711680)>>16,(S.duration&65280)>>8,S.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(S.width&65280)>>8,S.width&255,0,0,(S.height&65280)>>8,S.height&255,0,0]);return l(ae.tkhd,Y)},H=function(S){var Y,ie,ne,he,ge,Ie,ke;return Y=l(ae.tfhd,new Uint8Array([0,0,0,58,(S.id&4278190080)>>24,(S.id&16711680)>>16,(S.id&65280)>>8,S.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),Ie=Math.floor(S.baseMediaDecodeTime/a),ke=Math.floor(S.baseMediaDecodeTime%a),ie=l(ae.tfdt,new Uint8Array([1,0,0,0,Ie>>>24&255,Ie>>>16&255,Ie>>>8&255,Ie&255,ke>>>24&255,ke>>>16&255,ke>>>8&255,ke&255])),ge=92,S.type==="audio"?(ne=te(S,ge),l(ae.traf,Y,ie,ne)):(he=R(S),ne=te(S,he.length+ge),l(ae.traf,Y,ie,ne,he))},A=function(S){return S.duration=S.duration||4294967295,l(ae.trak,z(S),D(S))},V=function(S){var Y=new Uint8Array([0,0,0,0,(S.id&4278190080)>>24,(S.id&16711680)>>16,(S.id&65280)>>8,S.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return S.type!=="video"&&(Y[Y.length-1]=0),l(ae.trex,Y)},(function(){var S,Y,ie;ie=function(ne,he){var ge=0,Ie=0,ke=0,Ne=0;return ne.length&&(ne[0].duration!==void 0&&(ge=1),ne[0].size!==void 0&&(Ie=2),ne[0].flags!==void 0&&(ke=4),ne[0].compositionTimeOffset!==void 0&&(Ne=8)),[0,0,ge|Ie|ke|Ne,1,(ne.length&4278190080)>>>24,(ne.length&16711680)>>>16,(ne.length&65280)>>>8,ne.length&255,(he&4278190080)>>>24,(he&16711680)>>>16,(he&65280)>>>8,he&255]},Y=function(ne,he){var ge,Ie,ke,Ne,Ve,et;for(Ne=ne.samples||[],he+=20+16*Ne.length,ke=ie(Ne,he),Ie=new Uint8Array(ke.length+Ne.length*16),Ie.set(ke),ge=ke.length,et=0;et<Ne.length;et++)Ve=Ne[et],Ie[ge++]=(Ve.duration&4278190080)>>>24,Ie[ge++]=(Ve.duration&16711680)>>>16,Ie[ge++]=(Ve.duration&65280)>>>8,Ie[ge++]=Ve.duration&255,Ie[ge++]=(Ve.size&4278190080)>>>24,Ie[ge++]=(Ve.size&16711680)>>>16,Ie[ge++]=(Ve.size&65280)>>>8,Ie[ge++]=Ve.size&255,Ie[ge++]=Ve.flags.isLeading<<2|Ve.flags.dependsOn,Ie[ge++]=Ve.flags.isDependedOn<<6|Ve.flags.hasRedundancy<<4|Ve.flags.paddingValue<<1|Ve.flags.isNonSyncSample,Ie[ge++]=Ve.flags.degradationPriority&61440,Ie[ge++]=Ve.flags.degradationPriority&15,Ie[ge++]=(Ve.compositionTimeOffset&4278190080)>>>24,Ie[ge++]=(Ve.compositionTimeOffset&16711680)>>>16,Ie[ge++]=(Ve.compositionTimeOffset&65280)>>>8,Ie[ge++]=Ve.compositionTimeOffset&255;return l(ae.trun,Ie)},S=function(ne,he){var ge,Ie,ke,Ne,Ve,et;for(Ne=ne.samples||[],he+=20+8*Ne.length,ke=ie(Ne,he),ge=new Uint8Array(ke.length+Ne.length*8),ge.set(ke),Ie=ke.length,et=0;et<Ne.length;et++)Ve=Ne[et],ge[Ie++]=(Ve.duration&4278190080)>>>24,ge[Ie++]=(Ve.duration&16711680)>>>16,ge[Ie++]=(Ve.duration&65280)>>>8,ge[Ie++]=Ve.duration&255,ge[Ie++]=(Ve.size&4278190080)>>>24,ge[Ie++]=(Ve.size&16711680)>>>16,ge[Ie++]=(Ve.size&65280)>>>8,ge[Ie++]=Ve.size&255;return l(ae.trun,ge)},te=function(ne,he){return ne.type==="audio"?S(ne,he):Y(ne,he)}})();var Te={ftyp:h,mdat:p,moof:v,moov:_,initSegment:function(S){var Y=h(),ie=_(S),ne;return ne=new Uint8Array(Y.byteLength+ie.byteLength),ne.set(Y),ne.set(ie,Y.byteLength),ne}},Ae=function(S){var Y,ie,ne=[],he=[];for(he.byteLength=0,he.nalCount=0,he.duration=0,ne.byteLength=0,Y=0;Y<S.length;Y++)ie=S[Y],ie.nalUnitType==="access_unit_delimiter_rbsp"?(ne.length&&(ne.duration=ie.dts-ne.dts,he.byteLength+=ne.byteLength,he.nalCount+=ne.length,he.duration+=ne.duration,he.push(ne)),ne=[ie],ne.byteLength=ie.data.byteLength,ne.pts=ie.pts,ne.dts=ie.dts):(ie.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(ne.keyFrame=!0),ne.duration=ie.dts-ne.dts,ne.byteLength+=ie.data.byteLength,ne.push(ie));return he.length&&(!ne.duration||ne.duration<=0)&&(ne.duration=he[he.length-1].duration),he.byteLength+=ne.byteLength,he.nalCount+=ne.length,he.duration+=ne.duration,he.push(ne),he},Pe=function(S){var Y,ie,ne=[],he=[];for(ne.byteLength=0,ne.nalCount=0,ne.duration=0,ne.pts=S[0].pts,ne.dts=S[0].dts,he.byteLength=0,he.nalCount=0,he.duration=0,he.pts=S[0].pts,he.dts=S[0].dts,Y=0;Y<S.length;Y++)ie=S[Y],ie.keyFrame?(ne.length&&(he.push(ne),he.byteLength+=ne.byteLength,he.nalCount+=ne.nalCount,he.duration+=ne.duration),ne=[ie],ne.nalCount=ie.length,ne.byteLength=ie.byteLength,ne.pts=ie.pts,ne.dts=ie.dts,ne.duration=ie.duration):(ne.duration+=ie.duration,ne.nalCount+=ie.length,ne.byteLength+=ie.byteLength,ne.push(ie));return he.length&&ne.duration<=0&&(ne.duration=he[he.length-1].duration),he.byteLength+=ne.byteLength,he.nalCount+=ne.nalCount,he.duration+=ne.duration,he.push(ne),he},Me=function(S){var Y;return!S[0][0].keyFrame&&S.length>1&&(Y=S.shift(),S.byteLength-=Y.byteLength,S.nalCount-=Y.nalCount,S[0][0].dts=Y.dts,S[0][0].pts=Y.pts,S[0][0].duration+=Y.duration),S},We=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},qe=function(S,Y){var ie=We();return ie.dataOffset=Y,ie.compositionTimeOffset=S.pts-S.dts,ie.duration=S.duration,ie.size=4*S.length,ie.size+=S.byteLength,S.keyFrame&&(ie.flags.dependsOn=2,ie.flags.isNonSyncSample=0),ie},Je=function(S,Y){var ie,ne,he,ge,Ie,ke=Y||0,Ne=[];for(ie=0;ie<S.length;ie++)for(ge=S[ie],ne=0;ne<ge.length;ne++)Ie=ge[ne],he=qe(Ie,ke),ke+=he.size,Ne.push(he);return Ne},wt=function(S){var Y,ie,ne,he,ge,Ie,ke=0,Ne=S.byteLength,Ve=S.nalCount,et=Ne+4*Ve,jt=new Uint8Array(et),Rn=new DataView(jt.buffer);for(Y=0;Y<S.length;Y++)for(he=S[Y],ie=0;ie<he.length;ie++)for(ge=he[ie],ne=0;ne<ge.length;ne++)Ie=ge[ne],Rn.setUint32(ke,Ie.data.byteLength),ke+=4,jt.set(Ie.data,ke),ke+=Ie.data.byteLength;return jt},rt=function(S,Y){var ie,ne=Y||0,he=[];return ie=qe(S,ne),he.push(ie),he},Lt=function(S){var Y,ie,ne=0,he=S.byteLength,ge=S.length,Ie=he+4*ge,ke=new Uint8Array(Ie),Ne=new DataView(ke.buffer);for(Y=0;Y<S.length;Y++)ie=S[Y],Ne.setUint32(ne,ie.data.byteLength),ne+=4,ke.set(ie.data,ne),ne+=ie.data.byteLength;return ke},ln={groupNalsIntoFrames:Ae,groupFramesIntoGops:Pe,extendFirstKeyFrame:Me,generateSampleTable:Je,concatenateNalData:wt,generateSampleTableForFrame:rt,concatenateNalDataForFrame:Lt},dt=[33,16,5,32,164,27],st=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],nt=function(S){for(var Y=[];S--;)Y.push(0);return Y},dn=function(S){return Object.keys(S).reduce(function(Y,ie){return Y[ie]=new Uint8Array(S[ie].reduce(function(ne,he){return ne.concat(he)},[])),Y},{})},pn,An=function(){if(!pn){var S={96e3:[dt,[227,64],nt(154),[56]],88200:[dt,[231],nt(170),[56]],64e3:[dt,[248,192],nt(240),[56]],48e3:[dt,[255,192],nt(268),[55,148,128],nt(54),[112]],44100:[dt,[255,192],nt(268),[55,163,128],nt(84),[112]],32e3:[dt,[255,192],nt(268),[55,234],nt(226),[112]],24e3:[dt,[255,192],nt(268),[55,255,128],nt(268),[111,112],nt(126),[224]],16e3:[dt,[255,192],nt(268),[55,255,128],nt(268),[111,255],nt(269),[223,108],nt(195),[1,192]],12e3:[st,nt(268),[3,127,248],nt(268),[6,255,240],nt(268),[13,255,224],nt(268),[27,253,128],nt(259),[56]],11025:[st,nt(268),[3,127,248],nt(268),[6,255,240],nt(268),[13,255,224],nt(268),[27,255,192],nt(268),[55,175,128],nt(108),[112]],8e3:[st,nt(268),[3,121,16],nt(47),[7]]};pn=dn(S)}return pn},In=9e4,Jn,ri,Wn,hi,ai,Zn,Ft;Jn=function(S){return S*In},ri=function(S,Y){return S*Y},Wn=function(S){return S/In},hi=function(S,Y){return S/Y},ai=function(S,Y){return Jn(hi(S,Y))},Zn=function(S,Y){return ri(Wn(S),Y)},Ft=function(S,Y,ie){return Wn(ie?S:S-Y)};var Xe={ONE_SECOND_IN_TS:In,secondsToVideoTs:Jn,secondsToAudioTs:ri,videoTsToSeconds:Wn,audioTsToSeconds:hi,audioTsToVideoTs:ai,videoTsToAudioTs:Zn,metadataTsToSeconds:Ft},Ye=An,xn=Xe,Vn=function(S){var Y,ie,ne=0;for(Y=0;Y<S.length;Y++)ie=S[Y],ne+=ie.data.byteLength;return ne},Bn=function(S,Y,ie,ne){var he,ge=0,Ie=0,ke=0,Ne=0,Ve,et,jt;if(Y.length&&(he=xn.audioTsToVideoTs(S.baseMediaDecodeTime,S.samplerate),ge=Math.ceil(xn.ONE_SECOND_IN_TS/(S.samplerate/1024)),ie&&ne&&(Ie=he-Math.max(ie,ne),ke=Math.floor(Ie/ge),Ne=ke*ge),!(ke<1||Ne>xn.ONE_SECOND_IN_TS/2))){for(Ve=Ye()[S.samplerate],Ve||(Ve=Y[0].data),et=0;et<ke;et++)jt=Y[0],Y.splice(0,0,{data:Ve,dts:jt.dts-ge,pts:jt.pts-ge});return S.baseMediaDecodeTime-=Math.floor(xn.videoTsToAudioTs(Ne,S.samplerate)),Ne}},si=function(S,Y,ie){return Y.minSegmentDts>=ie?S:(Y.minSegmentDts=1/0,S.filter(function(ne){return ne.dts>=ie?(Y.minSegmentDts=Math.min(Y.minSegmentDts,ne.dts),Y.minSegmentPts=Y.minSegmentDts,!0):!1}))},Yi=function(S){var Y,ie,ne=[];for(Y=0;Y<S.length;Y++)ie=S[Y],ne.push({size:ie.data.byteLength,duration:1024});return ne},ei=function(S){var Y,ie,ne=0,he=new Uint8Array(Vn(S));for(Y=0;Y<S.length;Y++)ie=S[Y],he.set(ie.data,ne),ne+=ie.data.byteLength;return he},oi={prefixWithSilence:Bn,trimAdtsFramesByEarliestDts:si,generateSampleTable:Yi,concatenateFrameData:ei},Li=Xe.ONE_SECOND_IN_TS,xe=function(S,Y){typeof Y.pts=="number"&&(S.timelineStartInfo.pts===void 0&&(S.timelineStartInfo.pts=Y.pts),S.minSegmentPts===void 0?S.minSegmentPts=Y.pts:S.minSegmentPts=Math.min(S.minSegmentPts,Y.pts),S.maxSegmentPts===void 0?S.maxSegmentPts=Y.pts:S.maxSegmentPts=Math.max(S.maxSegmentPts,Y.pts)),typeof Y.dts=="number"&&(S.timelineStartInfo.dts===void 0&&(S.timelineStartInfo.dts=Y.dts),S.minSegmentDts===void 0?S.minSegmentDts=Y.dts:S.minSegmentDts=Math.min(S.minSegmentDts,Y.dts),S.maxSegmentDts===void 0?S.maxSegmentDts=Y.dts:S.maxSegmentDts=Math.max(S.maxSegmentDts,Y.dts))},Ce=function(S){delete S.minSegmentDts,delete S.maxSegmentDts,delete S.minSegmentPts,delete S.maxSegmentPts},Fe=function(S,Y){var ie,ne,he=S.minSegmentDts;return Y||(he-=S.timelineStartInfo.dts),ie=S.timelineStartInfo.baseMediaDecodeTime,ie+=he,ie=Math.max(0,ie),S.type==="audio"&&(ne=S.samplerate/Li,ie*=ne,ie=Math.floor(ie)),ie},tt={clearDtsInfo:Ce,calculateTrackBaseMediaDecodeTime:Fe,collectDtsInfo:xe},Tn=4,jn=128,li=function(S){for(var Y=0,ie={payloadType:-1,payloadSize:0},ne=0,he=0;Y<S.byteLength&&S[Y]!==jn;){for(;S[Y]===255;)ne+=255,Y++;for(ne+=S[Y++];S[Y]===255;)he+=255,Y++;if(he+=S[Y++],!ie.payload&&ne===Tn){var ge=String.fromCharCode(S[Y+3],S[Y+4],S[Y+5],S[Y+6]);if(ge==="GA94"){ie.payloadType=ne,ie.payloadSize=he,ie.payload=S.subarray(Y,Y+he);break}else ie.payload=void 0}Y+=he,ne=0,he=0}return ie},Fi=function(S){return S.payload[0]!==181||(S.payload[1]<<8|S.payload[2])!==49||String.fromCharCode(S.payload[3],S.payload[4],S.payload[5],S.payload[6])!=="GA94"||S.payload[7]!==3?null:S.payload.subarray(8,S.payload.length-1)},Qi=function(S,Y){var ie=[],ne,he,ge,Ie;if(!(Y[0]&64))return ie;for(he=Y[0]&31,ne=0;ne<he;ne++)ge=ne*3,Ie={type:Y[ge+2]&3,pts:S},Y[ge+2]&4&&(Ie.ccData=Y[ge+3]<<8|Y[ge+4],ie.push(Ie));return ie},Di=function(S){for(var Y=S.byteLength,ie=[],ne=1,he,ge;ne<Y-2;)S[ne]===0&&S[ne+1]===0&&S[ne+2]===3?(ie.push(ne+2),ne+=2):ne++;if(ie.length===0)return S;he=Y-ie.length,ge=new Uint8Array(he);var Ie=0;for(ne=0;ne<he;Ie++,ne++)Ie===ie[0]&&(Ie++,ie.shift()),ge[ne]=S[Ie];return ge},nr={parseSei:li,parseUserData:Fi,parseCaptionPackets:Qi,discardEmulationPreventionBytes:Di,USER_DATA_REGISTERED_ITU_T_T35:Tn},gr=t,br=nr,Vi=function(S){S=S||{},Vi.prototype.init.call(this),this.parse708captions_=typeof S.parse708captions=="boolean"?S.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new Ui(0,0),new Ui(0,1),new Ui(1,0),new Ui(1,1)],this.parse708captions_&&(this.cc708Stream_=new fi({captionServices:S.captionServices})),this.reset(),this.ccStreams_.forEach(function(Y){Y.on("data",this.trigger.bind(this,"data")),Y.on("partialdone",this.trigger.bind(this,"partialdone")),Y.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};Vi.prototype=new gr,Vi.prototype.push=function(S){var Y,ie,ne;if(S.nalUnitType==="sei_rbsp"&&(Y=br.parseSei(S.escapedRBSP),!!Y.payload&&Y.payloadType===br.USER_DATA_REGISTERED_ITU_T_T35&&(ie=br.parseUserData(Y),!!ie))){if(S.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(S.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}ne=br.parseCaptionPackets(S.pts,ie),this.captionPackets_=this.captionPackets_.concat(ne),this.latestDts_!==S.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=S.dts}},Vi.prototype.flushCCStreams=function(S){this.ccStreams_.forEach(function(Y){return S==="flush"?Y.flush():Y.partialFlush()},this)},Vi.prototype.flushStream=function(S){if(!this.captionPackets_.length){this.flushCCStreams(S);return}this.captionPackets_.forEach(function(Y,ie){Y.presortIndex=ie}),this.captionPackets_.sort(function(Y,ie){return Y.pts===ie.pts?Y.presortIndex-ie.presortIndex:Y.pts-ie.pts}),this.captionPackets_.forEach(function(Y){Y.type<2?this.dispatchCea608Packet(Y):this.dispatchCea708Packet(Y)},this),this.captionPackets_.length=0,this.flushCCStreams(S)},Vi.prototype.flush=function(){return this.flushStream("flush")},Vi.prototype.partialFlush=function(){return this.flushStream("partialFlush")},Vi.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(S){S.reset()})},Vi.prototype.dispatchCea608Packet=function(S){this.setsTextOrXDSActive(S)?this.activeCea608Channel_[S.type]=null:this.setsChannel1Active(S)?this.activeCea608Channel_[S.type]=0:this.setsChannel2Active(S)&&(this.activeCea608Channel_[S.type]=1),this.activeCea608Channel_[S.type]!==null&&this.ccStreams_[(S.type<<1)+this.activeCea608Channel_[S.type]].push(S)},Vi.prototype.setsChannel1Active=function(S){return(S.ccData&30720)===4096},Vi.prototype.setsChannel2Active=function(S){return(S.ccData&30720)===6144},Vi.prototype.setsTextOrXDSActive=function(S){return(S.ccData&28928)===256||(S.ccData&30974)===4138||(S.ccData&30974)===6186},Vi.prototype.dispatchCea708Packet=function(S){this.parse708captions_&&this.cc708Stream_.push(S)};var $r={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},wr=function(S){var Y=$r[S]||S;return S&4096&&S===Y?"":String.fromCharCode(Y)},Er=function(S){return 32<=S&&S<=127||160<=S&&S<=255},ci=function(S){this.windowNum=S,this.reset()};ci.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},ci.prototype.getText=function(){return this.rows.join(`
`)},ci.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},ci.prototype.newLine=function(S){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(S),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},ci.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},ci.prototype.addText=function(S){this.rows[this.rowIdx]+=S},ci.prototype.backspace=function(){if(!this.isEmpty()){var S=this.rows[this.rowIdx];this.rows[this.rowIdx]=S.substr(0,S.length-1)}};var ir=function(S,Y,ie){this.serviceNum=S,this.text="",this.currentWindow=new ci(-1),this.windows=[],this.stream=ie,typeof Y=="string"&&this.createTextDecoder(Y)};ir.prototype.init=function(S,Y){this.startPts=S;for(var ie=0;ie<8;ie++)this.windows[ie]=new ci(ie),typeof Y=="function"&&(this.windows[ie].beforeRowOverflow=Y)},ir.prototype.setCurrentWindow=function(S){this.currentWindow=this.windows[S]},ir.prototype.createTextDecoder=function(S){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(S)}catch(Y){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+S+" encoding. "+Y})}};var fi=function(S){S=S||{},fi.prototype.init.call(this);var Y=this,ie=S.captionServices||{},ne={},he;Object.keys(ie).forEach(ge=>{he=ie[ge],/^SERVICE/.test(ge)&&(ne[ge]=he.encoding)}),this.serviceEncodings=ne,this.current708Packet=null,this.services={},this.push=function(ge){ge.type===3?(Y.new708Packet(),Y.add708Bytes(ge)):(Y.current708Packet===null&&Y.new708Packet(),Y.add708Bytes(ge))}};fi.prototype=new gr,fi.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},fi.prototype.add708Bytes=function(S){var Y=S.ccData,ie=Y>>>8,ne=Y&255;this.current708Packet.ptsVals.push(S.pts),this.current708Packet.data.push(ie),this.current708Packet.data.push(ne)},fi.prototype.push708Packet=function(){var S=this.current708Packet,Y=S.data,ie=null,ne=null,he=0,ge=Y[he++];for(S.seq=ge>>6,S.sizeCode=ge&63;he<Y.length;he++)ge=Y[he++],ie=ge>>5,ne=ge&31,ie===7&&ne>0&&(ge=Y[he++],ie=ge),this.pushServiceBlock(ie,he,ne),ne>0&&(he+=ne-1)},fi.prototype.pushServiceBlock=function(S,Y,ie){var ne,he=Y,ge=this.current708Packet.data,Ie=this.services[S];for(Ie||(Ie=this.initService(S,he));he<Y+ie&&he<ge.length;he++)ne=ge[he],Er(ne)?he=this.handleText(he,Ie):ne===24?he=this.multiByteCharacter(he,Ie):ne===16?he=this.extendedCommands(he,Ie):128<=ne&&ne<=135?he=this.setCurrentWindow(he,Ie):152<=ne&&ne<=159?he=this.defineWindow(he,Ie):ne===136?he=this.clearWindows(he,Ie):ne===140?he=this.deleteWindows(he,Ie):ne===137?he=this.displayWindows(he,Ie):ne===138?he=this.hideWindows(he,Ie):ne===139?he=this.toggleWindows(he,Ie):ne===151?he=this.setWindowAttributes(he,Ie):ne===144?he=this.setPenAttributes(he,Ie):ne===145?he=this.setPenColor(he,Ie):ne===146?he=this.setPenLocation(he,Ie):ne===143?Ie=this.reset(he,Ie):ne===8?Ie.currentWindow.backspace():ne===12?Ie.currentWindow.clearText():ne===13?Ie.currentWindow.pendingNewLine=!0:ne===14?Ie.currentWindow.clearText():ne===141&&he++},fi.prototype.extendedCommands=function(S,Y){var ie=this.current708Packet.data,ne=ie[++S];return Er(ne)&&(S=this.handleText(S,Y,{isExtended:!0})),S},fi.prototype.getPts=function(S){return this.current708Packet.ptsVals[Math.floor(S/2)]},fi.prototype.initService=function(S,Y){var ne="SERVICE"+S,ie=this,ne,he;return ne in this.serviceEncodings&&(he=this.serviceEncodings[ne]),this.services[S]=new ir(S,he,ie),this.services[S].init(this.getPts(Y),function(ge){ie.flushDisplayed(ge,ie.services[S])}),this.services[S]},fi.prototype.handleText=function(S,Y,ie){var ne=ie&&ie.isExtended,he=ie&&ie.isMultiByte,ge=this.current708Packet.data,Ie=ne?4096:0,ke=ge[S],Ne=ge[S+1],Ve=Y.currentWindow,et,jt;function Rn(Wt){return Wt.map(Mn=>("0"+(Mn&255).toString(16)).slice(-2)).join("")}if(he?(jt=[ke,Ne],S++):jt=[ke],Y.textDecoder_&&!ne)et=Y.textDecoder_.decode(new Uint8Array(jt));else if(he){const Wt=Rn(jt);et=String.fromCharCode(parseInt(Wt,16))}else et=wr(Ie|ke);return Ve.pendingNewLine&&!Ve.isEmpty()&&Ve.newLine(this.getPts(S)),Ve.pendingNewLine=!1,Ve.addText(et),S},fi.prototype.multiByteCharacter=function(S,Y){var ie=this.current708Packet.data,ne=ie[S+1],he=ie[S+2];return Er(ne)&&Er(he)&&(S=this.handleText(++S,Y,{isMultiByte:!0})),S},fi.prototype.setCurrentWindow=function(S,Y){var ie=this.current708Packet.data,ne=ie[S],he=ne&7;return Y.setCurrentWindow(he),S},fi.prototype.defineWindow=function(S,Y){var ie=this.current708Packet.data,ne=ie[S],he=ne&7;Y.setCurrentWindow(he);var ge=Y.currentWindow;return ne=ie[++S],ge.visible=(ne&32)>>5,ge.rowLock=(ne&16)>>4,ge.columnLock=(ne&8)>>3,ge.priority=ne&7,ne=ie[++S],ge.relativePositioning=(ne&128)>>7,ge.anchorVertical=ne&127,ne=ie[++S],ge.anchorHorizontal=ne,ne=ie[++S],ge.anchorPoint=(ne&240)>>4,ge.rowCount=ne&15,ne=ie[++S],ge.columnCount=ne&63,ne=ie[++S],ge.windowStyle=(ne&56)>>3,ge.penStyle=ne&7,ge.virtualRowCount=ge.rowCount+1,S},fi.prototype.setWindowAttributes=function(S,Y){var ie=this.current708Packet.data,ne=ie[S],he=Y.currentWindow.winAttr;return ne=ie[++S],he.fillOpacity=(ne&192)>>6,he.fillRed=(ne&48)>>4,he.fillGreen=(ne&12)>>2,he.fillBlue=ne&3,ne=ie[++S],he.borderType=(ne&192)>>6,he.borderRed=(ne&48)>>4,he.borderGreen=(ne&12)>>2,he.borderBlue=ne&3,ne=ie[++S],he.borderType+=(ne&128)>>5,he.wordWrap=(ne&64)>>6,he.printDirection=(ne&48)>>4,he.scrollDirection=(ne&12)>>2,he.justify=ne&3,ne=ie[++S],he.effectSpeed=(ne&240)>>4,he.effectDirection=(ne&12)>>2,he.displayEffect=ne&3,S},fi.prototype.flushDisplayed=function(S,Y){for(var ie=[],ne=0;ne<8;ne++)Y.windows[ne].visible&&!Y.windows[ne].isEmpty()&&ie.push(Y.windows[ne].getText());Y.endPts=S,Y.text=ie.join(`

`),this.pushCaption(Y),Y.startPts=S},fi.prototype.pushCaption=function(S){S.text!==""&&(this.trigger("data",{startPts:S.startPts,endPts:S.endPts,text:S.text,stream:"cc708_"+S.serviceNum}),S.text="",S.startPts=S.endPts)},fi.prototype.displayWindows=function(S,Y){var ie=this.current708Packet.data,ne=ie[++S],he=this.getPts(S);this.flushDisplayed(he,Y);for(var ge=0;ge<8;ge++)ne&1<<ge&&(Y.windows[ge].visible=1);return S},fi.prototype.hideWindows=function(S,Y){var ie=this.current708Packet.data,ne=ie[++S],he=this.getPts(S);this.flushDisplayed(he,Y);for(var ge=0;ge<8;ge++)ne&1<<ge&&(Y.windows[ge].visible=0);return S},fi.prototype.toggleWindows=function(S,Y){var ie=this.current708Packet.data,ne=ie[++S],he=this.getPts(S);this.flushDisplayed(he,Y);for(var ge=0;ge<8;ge++)ne&1<<ge&&(Y.windows[ge].visible^=1);return S},fi.prototype.clearWindows=function(S,Y){var ie=this.current708Packet.data,ne=ie[++S],he=this.getPts(S);this.flushDisplayed(he,Y);for(var ge=0;ge<8;ge++)ne&1<<ge&&Y.windows[ge].clearText();return S},fi.prototype.deleteWindows=function(S,Y){var ie=this.current708Packet.data,ne=ie[++S],he=this.getPts(S);this.flushDisplayed(he,Y);for(var ge=0;ge<8;ge++)ne&1<<ge&&Y.windows[ge].reset();return S},fi.prototype.setPenAttributes=function(S,Y){var ie=this.current708Packet.data,ne=ie[S],he=Y.currentWindow.penAttr;return ne=ie[++S],he.textTag=(ne&240)>>4,he.offset=(ne&12)>>2,he.penSize=ne&3,ne=ie[++S],he.italics=(ne&128)>>7,he.underline=(ne&64)>>6,he.edgeType=(ne&56)>>3,he.fontStyle=ne&7,S},fi.prototype.setPenColor=function(S,Y){var ie=this.current708Packet.data,ne=ie[S],he=Y.currentWindow.penColor;return ne=ie[++S],he.fgOpacity=(ne&192)>>6,he.fgRed=(ne&48)>>4,he.fgGreen=(ne&12)>>2,he.fgBlue=ne&3,ne=ie[++S],he.bgOpacity=(ne&192)>>6,he.bgRed=(ne&48)>>4,he.bgGreen=(ne&12)>>2,he.bgBlue=ne&3,ne=ie[++S],he.edgeRed=(ne&48)>>4,he.edgeGreen=(ne&12)>>2,he.edgeBlue=ne&3,S},fi.prototype.setPenLocation=function(S,Y){var ie=this.current708Packet.data,ne=ie[S],he=Y.currentWindow.penLoc;return Y.currentWindow.pendingNewLine=!0,ne=ie[++S],he.row=ne&15,ne=ie[++S],he.column=ne&63,S},fi.prototype.reset=function(S,Y){var ie=this.getPts(S);return this.flushDisplayed(ie,Y),this.initService(Y.serviceNum,S)};var Bs={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},Ra=function(S){return S===null?"":(S=Bs[S]||S,String.fromCharCode(S))},ua=14,yo=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Vr=function(){for(var S=[],Y=ua+1;Y--;)S.push({text:"",indent:0,offset:0});return S},Ui=function(S,Y){Ui.prototype.init.call(this),this.field_=S||0,this.dataChannel_=Y||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(ie){var ne,he,ge,Ie,ke;if(ne=ie.ccData&32639,ne===this.lastControlCode_){this.lastControlCode_=null;return}if((ne&61440)===4096?this.lastControlCode_=ne:ne!==this.PADDING_&&(this.lastControlCode_=null),ge=ne>>>8,Ie=ne&255,ne!==this.PADDING_)if(ne===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(ne===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(ie.pts),this.flushDisplayed(ie.pts),he=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=he,this.startPts_=ie.pts;else if(ne===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(ie.pts);else if(ne===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(ie.pts);else if(ne===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(ie.pts);else if(ne===this.CARRIAGE_RETURN_)this.clearFormatting(ie.pts),this.flushDisplayed(ie.pts),this.shiftRowsUp_(),this.startPts_=ie.pts;else if(ne===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1);else if(ne===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(ie.pts),this.displayed_=Vr();else if(ne===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Vr();else if(ne===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(ie.pts),this.displayed_=Vr()),this.mode_="paintOn",this.startPts_=ie.pts;else if(this.isSpecialCharacter(ge,Ie))ge=(ge&3)<<8,ke=Ra(ge|Ie),this[this.mode_](ie.pts,ke),this.column_++;else if(this.isExtCharacter(ge,Ie))this.mode_==="popOn"?this.nonDisplayed_[this.row_].text=this.nonDisplayed_[this.row_].text.slice(0,-1):this.displayed_[this.row_].text=this.displayed_[this.row_].text.slice(0,-1),ge=(ge&3)<<8,ke=Ra(ge|Ie),this[this.mode_](ie.pts,ke),this.column_++;else if(this.isMidRowCode(ge,Ie))this.clearFormatting(ie.pts),this[this.mode_](ie.pts," "),this.column_++,(Ie&14)===14&&this.addFormatting(ie.pts,["i"]),(Ie&1)===1&&this.addFormatting(ie.pts,["u"]);else if(this.isOffsetControlCode(ge,Ie)){const Ve=Ie&3;this.nonDisplayed_[this.row_].offset=Ve,this.column_+=Ve}else if(this.isPAC(ge,Ie)){var Ne=yo.indexOf(ne&7968);if(this.mode_==="rollUp"&&(Ne-this.rollUpRows_+1<0&&(Ne=this.rollUpRows_-1),this.setRollUp(ie.pts,Ne)),Ne!==this.row_&&Ne>=0&&Ne<=14&&(this.clearFormatting(ie.pts),this.row_=Ne),Ie&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(ie.pts,["u"]),(ne&16)===16){const Ve=(ne&14)>>1;this.column_=Ve*4,this.nonDisplayed_[this.row_].indent+=Ve}this.isColorPAC(Ie)&&(Ie&14)===14&&this.addFormatting(ie.pts,["i"])}else this.isNormalChar(ge)&&(Ie===0&&(Ie=null),ke=Ra(ge),ke+=Ra(Ie),this[this.mode_](ie.pts,ke),this.column_+=ke.length)}};Ui.prototype=new gr,Ui.prototype.flushDisplayed=function(S){const Y=ne=>{this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+ne+"."})},ie=[];this.displayed_.forEach((ne,he)=>{if(ne&&ne.text&&ne.text.length){try{ne.text=ne.text.trim()}catch{Y(he)}ne.text.length&&ie.push({text:ne.text,line:he+1,position:10+Math.min(70,ne.indent*10)+ne.offset*2.5})}else ne==null&&Y(he)}),ie.length&&this.trigger("data",{startPts:this.startPts_,endPts:S,content:ie,stream:this.name_})},Ui.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Vr(),this.nonDisplayed_=Vr(),this.lastControlCode_=null,this.column_=0,this.row_=ua,this.rollUpRows_=2,this.formatting_=[]},Ui.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},Ui.prototype.isSpecialCharacter=function(S,Y){return S===this.EXT_&&Y>=48&&Y<=63},Ui.prototype.isExtCharacter=function(S,Y){return(S===this.EXT_+1||S===this.EXT_+2)&&Y>=32&&Y<=63},Ui.prototype.isMidRowCode=function(S,Y){return S===this.EXT_&&Y>=32&&Y<=47},Ui.prototype.isOffsetControlCode=function(S,Y){return S===this.OFFSET_&&Y>=33&&Y<=35},Ui.prototype.isPAC=function(S,Y){return S>=this.BASE_&&S<this.BASE_+8&&Y>=64&&Y<=127},Ui.prototype.isColorPAC=function(S){return S>=64&&S<=79||S>=96&&S<=127},Ui.prototype.isNormalChar=function(S){return S>=32&&S<=127},Ui.prototype.setRollUp=function(S,Y){if(this.mode_!=="rollUp"&&(this.row_=ua,this.mode_="rollUp",this.flushDisplayed(S),this.nonDisplayed_=Vr(),this.displayed_=Vr()),Y!==void 0&&Y!==this.row_)for(var ie=0;ie<this.rollUpRows_;ie++)this.displayed_[Y-ie]=this.displayed_[this.row_-ie],this.displayed_[this.row_-ie]={text:"",indent:0,offset:0};Y===void 0&&(Y=this.row_),this.topRow_=Y-this.rollUpRows_+1},Ui.prototype.addFormatting=function(S,Y){this.formatting_=this.formatting_.concat(Y);var ie=Y.reduce(function(ne,he){return ne+"<"+he+">"},"");this[this.mode_](S,ie)},Ui.prototype.clearFormatting=function(S){if(this.formatting_.length){var Y=this.formatting_.reverse().reduce(function(ie,ne){return ie+"</"+ne+">"},"");this.formatting_=[],this[this.mode_](S,Y)}},Ui.prototype.popOn=function(S,Y){var ie=this.nonDisplayed_[this.row_].text;ie+=Y,this.nonDisplayed_[this.row_].text=ie},Ui.prototype.rollUp=function(S,Y){var ie=this.displayed_[this.row_].text;ie+=Y,this.displayed_[this.row_].text=ie},Ui.prototype.shiftRowsUp_=function(){var S;for(S=0;S<this.topRow_;S++)this.displayed_[S]={text:"",indent:0,offset:0};for(S=this.row_+1;S<ua+1;S++)this.displayed_[S]={text:"",indent:0,offset:0};for(S=this.topRow_;S<this.row_;S++)this.displayed_[S]=this.displayed_[S+1];this.displayed_[this.row_]={text:"",indent:0,offset:0}},Ui.prototype.paintOn=function(S,Y){var ie=this.displayed_[this.row_].text;ie+=Y,this.displayed_[this.row_].text=ie};var fs={CaptionStream:Vi,Cea608Stream:Ui,Cea708Stream:fi},Gr={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},ts=t,Ts=8589934592,lr=4294967296,Pa="shared",da=function(S,Y){var ie=1;for(S>Y&&(ie=-1);Math.abs(Y-S)>lr;)S+=ie*Ts;return S},os=function(S){var Y,ie;os.prototype.init.call(this),this.type_=S||Pa,this.push=function(ne){if(ne.type==="metadata"){this.trigger("data",ne);return}this.type_!==Pa&&ne.type!==this.type_||(ie===void 0&&(ie=ne.dts),ne.dts=da(ne.dts,ie),ne.pts=da(ne.pts,ie),Y=ne.dts,this.trigger("data",ne))},this.flush=function(){ie=Y,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){ie=void 0,Y=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};os.prototype=new ts;var ps={TimestampRolloverStream:os,handleRollover:da},Ya=(S,Y,ie)=>{if(!S)return-1;for(var ne=ie;ne<S.length;ne++)if(S[ne]===Y)return ne;return-1},Qa={typedArrayIndexOf:Ya},ms=Qa.typedArrayIndexOf,ea={Utf8:3},ta=function(S,Y,ie){var ne,he="";for(ne=Y;ne<ie;ne++)he+="%"+("00"+S[ne].toString(16)).slice(-2);return he},Nr=function(S,Y,ie){return decodeURIComponent(ta(S,Y,ie))},qi=function(S,Y,ie){return unescape(ta(S,Y,ie))},fr=function(S){return S[0]<<21|S[1]<<14|S[2]<<7|S[3]},ls={APIC:function(S){var Y=1,ie,ne,he="-->";S.data[0]===ea.Utf8&&(ie=ms(S.data,0,Y),!(ie<0)&&(S.mimeType=qi(S.data,Y,ie),Y=ie+1,S.pictureType=S.data[Y],Y++,ne=ms(S.data,0,Y),!(ne<0)&&(S.description=Nr(S.data,Y,ne),Y=ne+1,S.mimeType===he?S.url=qi(S.data,Y,S.data.length):S.pictureData=S.data.subarray(Y,S.data.length))))},"T*":function(S){S.data[0]===ea.Utf8&&(S.value=Nr(S.data,1,S.data.length).replace(/\0*$/,""),S.values=S.value.split("\0"))},TXXX:function(S){var Y;S.data[0]===ea.Utf8&&(Y=ms(S.data,0,1),Y!==-1&&(S.description=Nr(S.data,1,Y),S.value=Nr(S.data,Y+1,S.data.length).replace(/\0*$/,""),S.data=S.value))},"W*":function(S){S.url=qi(S.data,0,S.data.length).replace(/\0.*$/,"")},WXXX:function(S){var Y;S.data[0]===ea.Utf8&&(Y=ms(S.data,0,1),Y!==-1&&(S.description=Nr(S.data,1,Y),S.url=qi(S.data,Y+1,S.data.length).replace(/\0.*$/,"")))},PRIV:function(S){var Y;for(Y=0;Y<S.data.length;Y++)if(S.data[Y]===0){S.owner=qi(S.data,0,Y);break}S.privateData=S.data.subarray(Y+1),S.data=S.privateData}},Ja=function(S){var Y,ie,ne=10,he=0,ge=[];if(!(S.length<10||S[0]!==73||S[1]!==68||S[2]!==51)){he=fr(S.subarray(6,10)),he+=10;var Ie=S[5]&64;Ie&&(ne+=4,ne+=fr(S.subarray(10,14)),he-=fr(S.subarray(16,20)));do{if(Y=fr(S.subarray(ne+4,ne+8)),Y<1)break;ie=String.fromCharCode(S[ne],S[ne+1],S[ne+2],S[ne+3]);var ke={id:ie,data:S.subarray(ne+10,ne+Y+10)};ke.key=ke.id,ls[ke.id]?ls[ke.id](ke):ke.id[0]==="T"?ls["T*"](ke):ke.id[0]==="W"&&ls["W*"](ke),ge.push(ke),ne+=10,ne+=Y}while(ne<he);return ge}},ki={parseId3Frames:Ja,parseSyncSafeInteger:fr,frameParsers:ls},ha=t,xs=Gr,Wr=ki,Cr;Cr=function(S){var Y={descriptor:S&&S.descriptor},ie=0,ne=[],he=0,ge;if(Cr.prototype.init.call(this),this.dispatchType=xs.METADATA_STREAM_TYPE.toString(16),Y.descriptor)for(ge=0;ge<Y.descriptor.length;ge++)this.dispatchType+=("00"+Y.descriptor[ge].toString(16)).slice(-2);this.push=function(Ie){var ke,Ne,Ve,et,jt,Rn;if(Ie.type==="timed-metadata"){if(Ie.dataAlignmentIndicator&&(he=0,ne.length=0),ne.length===0&&(Ie.data.length<10||Ie.data[0]!==73||Ie.data[1]!==68||Ie.data[2]!==51)){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(ne.push(Ie),he+=Ie.data.byteLength,ne.length===1&&(ie=Wr.parseSyncSafeInteger(Ie.data.subarray(6,10)),ie+=10),!(he<ie)){for(ke={data:new Uint8Array(ie),frames:[],pts:ne[0].pts,dts:ne[0].dts},jt=0;jt<ie;)ke.data.set(ne[0].data.subarray(0,ie-jt),jt),jt+=ne[0].data.byteLength,he-=ne[0].data.byteLength,ne.shift();Ne=10,ke.data[5]&64&&(Ne+=4,Ne+=Wr.parseSyncSafeInteger(ke.data.subarray(10,14)),ie-=Wr.parseSyncSafeInteger(ke.data.subarray(16,20)));do{if(Ve=Wr.parseSyncSafeInteger(ke.data.subarray(Ne+4,Ne+8)),Ve<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(Rn=String.fromCharCode(ke.data[Ne],ke.data[Ne+1],ke.data[Ne+2],ke.data[Ne+3]),et={id:Rn,data:ke.data.subarray(Ne+10,Ne+Ve+10)},et.key=et.id,Wr.frameParsers[et.id]?Wr.frameParsers[et.id](et):et.id[0]==="T"?Wr.frameParsers["T*"](et):et.id[0]==="W"&&Wr.frameParsers["W*"](et),et.owner==="com.apple.streaming.transportStreamTimestamp"){var Wt=et.data,Mn=(Wt[3]&1)<<30|Wt[4]<<22|Wt[5]<<14|Wt[6]<<6|Wt[7]>>>2;Mn*=4,Mn+=Wt[7]&3,et.timeStamp=Mn,ke.pts===void 0&&ke.dts===void 0&&(ke.pts=et.timeStamp,ke.dts=et.timeStamp),this.trigger("timestamp",et)}ke.frames.push(et),Ne+=10,Ne+=Ve}while(Ne<ie);this.trigger("data",ke)}}}},Cr.prototype=new ha;var Ia=Cr,Da=t,js=fs,Rr=Gr,Za=ps.TimestampRolloverStream,cs,Pr,Us,Ss=188,fa=71;cs=function(){var S=new Uint8Array(Ss),Y=0;cs.prototype.init.call(this),this.push=function(ie){var ne=0,he=Ss,ge;for(Y?(ge=new Uint8Array(ie.byteLength+Y),ge.set(S.subarray(0,Y)),ge.set(ie,Y),Y=0):ge=ie;he<ge.byteLength;){if(ge[ne]===fa&&ge[he]===fa){this.trigger("data",ge.subarray(ne,he)),ne+=Ss,he+=Ss;continue}ne++,he++}ne<ge.byteLength&&(S.set(ge.subarray(ne),0),Y=ge.byteLength-ne)},this.flush=function(){Y===Ss&&S[0]===fa&&(this.trigger("data",S),Y=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){Y=0,this.trigger("reset")}},cs.prototype=new Da,Pr=function(){var S,Y,ie,ne;Pr.prototype.init.call(this),ne=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,S=function(he,ge){var Ie=0;ge.payloadUnitStartIndicator&&(Ie+=he[Ie]+1),ge.type==="pat"?Y(he.subarray(Ie),ge):ie(he.subarray(Ie),ge)},Y=function(he,ge){ge.section_number=he[7],ge.last_section_number=he[8],ne.pmtPid=(he[10]&31)<<8|he[11],ge.pmtPid=ne.pmtPid},ie=function(he,ge){var Ie,ke,Ne,Ve;if(he[5]&1){for(ne.programMapTable={video:null,audio:null,"timed-metadata":{}},Ie=(he[1]&15)<<8|he[2],ke=3+Ie-4,Ne=(he[10]&15)<<8|he[11],Ve=12+Ne;Ve<ke;){var et=he[Ve],jt=(he[Ve+1]&31)<<8|he[Ve+2];et===Rr.H264_STREAM_TYPE&&ne.programMapTable.video===null?ne.programMapTable.video=jt:et===Rr.ADTS_STREAM_TYPE&&ne.programMapTable.audio===null?ne.programMapTable.audio=jt:et===Rr.METADATA_STREAM_TYPE&&(ne.programMapTable["timed-metadata"][jt]=et),Ve+=((he[Ve+3]&15)<<8|he[Ve+4])+5}ge.programMapTable=ne.programMapTable}},this.push=function(he){var ge={},Ie=4;if(ge.payloadUnitStartIndicator=!!(he[1]&64),ge.pid=he[1]&31,ge.pid<<=8,ge.pid|=he[2],(he[3]&48)>>>4>1&&(Ie+=he[Ie]+1),ge.pid===0)ge.type="pat",S(he.subarray(Ie),ge),this.trigger("data",ge);else if(ge.pid===this.pmtPid)for(ge.type="pmt",S(he.subarray(Ie),ge),this.trigger("data",ge);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([he,Ie,ge]):this.processPes_(he,Ie,ge)},this.processPes_=function(he,ge,Ie){Ie.pid===this.programMapTable.video?Ie.streamType=Rr.H264_STREAM_TYPE:Ie.pid===this.programMapTable.audio?Ie.streamType=Rr.ADTS_STREAM_TYPE:Ie.streamType=this.programMapTable["timed-metadata"][Ie.pid],Ie.type="pes",Ie.data=he.subarray(ge),this.trigger("data",Ie)}},Pr.prototype=new Da,Pr.STREAM_TYPES={h264:27,adts:15},Us=function(){var S=this,Y=!1,ie={data:[],size:0},ne={data:[],size:0},he={data:[],size:0},ge,Ie=function(Ne,Ve){var et;const jt=Ne[0]<<16|Ne[1]<<8|Ne[2];Ve.data=new Uint8Array,jt===1&&(Ve.packetLength=6+(Ne[4]<<8|Ne[5]),Ve.dataAlignmentIndicator=(Ne[6]&4)!==0,et=Ne[7],et&192&&(Ve.pts=(Ne[9]&14)<<27|(Ne[10]&255)<<20|(Ne[11]&254)<<12|(Ne[12]&255)<<5|(Ne[13]&254)>>>3,Ve.pts*=4,Ve.pts+=(Ne[13]&6)>>>1,Ve.dts=Ve.pts,et&64&&(Ve.dts=(Ne[14]&14)<<27|(Ne[15]&255)<<20|(Ne[16]&254)<<12|(Ne[17]&255)<<5|(Ne[18]&254)>>>3,Ve.dts*=4,Ve.dts+=(Ne[18]&6)>>>1)),Ve.data=Ne.subarray(9+Ne[8]))},ke=function(Ne,Ve,et){var jt=new Uint8Array(Ne.size),Rn={type:Ve},Wt=0,Mn=0,yi=!1,Lr;if(!(!Ne.data.length||Ne.size<9)){for(Rn.trackId=Ne.data[0].pid,Wt=0;Wt<Ne.data.length;Wt++)Lr=Ne.data[Wt],jt.set(Lr.data,Mn),Mn+=Lr.data.byteLength;Ie(jt,Rn),yi=Ve==="video"||Rn.packetLength<=Ne.size,(et||yi)&&(Ne.size=0,Ne.data.length=0),yi&&S.trigger("data",Rn)}};Us.prototype.init.call(this),this.push=function(Ne){({pat:function(){},pes:function(){var Ve,et;switch(Ne.streamType){case Rr.H264_STREAM_TYPE:Ve=ie,et="video";break;case Rr.ADTS_STREAM_TYPE:Ve=ne,et="audio";break;case Rr.METADATA_STREAM_TYPE:Ve=he,et="timed-metadata";break;default:return}Ne.payloadUnitStartIndicator&&ke(Ve,et,!0),Ve.data.push(Ne),Ve.size+=Ne.data.byteLength},pmt:function(){var Ve={type:"metadata",tracks:[]};ge=Ne.programMapTable,ge.video!==null&&Ve.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+ge.video,codec:"avc",type:"video"}),ge.audio!==null&&Ve.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+ge.audio,codec:"adts",type:"audio"}),Y=!0,S.trigger("data",Ve)}})[Ne.type]()},this.reset=function(){ie.size=0,ie.data.length=0,ne.size=0,ne.data.length=0,this.trigger("reset")},this.flushStreams_=function(){ke(ie,"video"),ke(ne,"audio"),ke(he,"timed-metadata")},this.flush=function(){if(!Y&&ge){var Ne={type:"metadata",tracks:[]};ge.video!==null&&Ne.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+ge.video,codec:"avc",type:"video"}),ge.audio!==null&&Ne.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+ge.audio,codec:"adts",type:"audio"}),S.trigger("data",Ne)}Y=!1,this.flushStreams_(),this.trigger("done")}},Us.prototype=new Da;var us={PAT_PID:0,MP2T_PACKET_LENGTH:Ss,TransportPacketStream:cs,TransportParseStream:Pr,ElementaryStream:Us,TimestampRolloverStream:Za,CaptionStream:js.CaptionStream,Cea608Stream:js.Cea608Stream,Cea708Stream:js.Cea708Stream,MetadataStream:Ia};for(var ka in Rr)Rr.hasOwnProperty(ka)&&(us[ka]=Rr[ka]);var Hs=us,Ma=t,Qr=Xe.ONE_SECOND_IN_TS,As,ns=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];As=function(S){var Y,ie=0;As.prototype.init.call(this),this.skipWarn_=function(ne,he){this.trigger("log",{level:"warn",message:`adts skiping bytes ${ne} to ${he} in frame ${ie} outside syncword`})},this.push=function(ne){var he=0,ge,Ie,ke,Ne,Ve;if(S||(ie=0),ne.type==="audio"){Y&&Y.length?(ke=Y,Y=new Uint8Array(ke.byteLength+ne.data.byteLength),Y.set(ke),Y.set(ne.data,ke.byteLength)):Y=ne.data;for(var et;he+7<Y.length;){if(Y[he]!==255||(Y[he+1]&246)!==240){typeof et!="number"&&(et=he),he++;continue}if(typeof et=="number"&&(this.skipWarn_(et,he),et=null),Ie=(~Y[he+1]&1)*2,ge=(Y[he+3]&3)<<11|Y[he+4]<<3|(Y[he+5]&224)>>5,Ne=((Y[he+6]&3)+1)*1024,Ve=Ne*Qr/ns[(Y[he+2]&60)>>>2],Y.byteLength-he<ge)break;this.trigger("data",{pts:ne.pts+ie*Ve,dts:ne.dts+ie*Ve,sampleCount:Ne,audioobjecttype:(Y[he+2]>>>6&3)+1,channelcount:(Y[he+2]&1)<<2|(Y[he+3]&192)>>>6,samplerate:ns[(Y[he+2]&60)>>>2],samplingfrequencyindex:(Y[he+2]&60)>>>2,samplesize:16,data:Y.subarray(he+7+Ie,he+ge)}),ie++,he+=ge}typeof et=="number"&&(this.skipWarn_(et,he),et=null),Y=Y.subarray(he)}},this.flush=function(){ie=0,this.trigger("done")},this.reset=function(){Y=void 0,this.trigger("reset")},this.endTimeline=function(){Y=void 0,this.trigger("endedtimeline")}},As.prototype=new Ma;var qs=As,ds;ds=function(S){var Y=S.byteLength,ie=0,ne=0;this.length=function(){return 8*Y},this.bitsAvailable=function(){return 8*Y+ne},this.loadWord=function(){var he=S.byteLength-Y,ge=new Uint8Array(4),Ie=Math.min(4,Y);if(Ie===0)throw new Error("no bytes available");ge.set(S.subarray(he,he+Ie)),ie=new DataView(ge.buffer).getUint32(0),ne=Ie*8,Y-=Ie},this.skipBits=function(he){var ge;ne>he?(ie<<=he,ne-=he):(he-=ne,ge=Math.floor(he/8),he-=ge*8,Y-=ge,this.loadWord(),ie<<=he,ne-=he)},this.readBits=function(he){var ge=Math.min(ne,he),Ie=ie>>>32-ge;return ne-=ge,ne>0?ie<<=ge:Y>0&&this.loadWord(),ge=he-ge,ge>0?Ie<<ge|this.readBits(ge):Ie},this.skipLeadingZeros=function(){var he;for(he=0;he<ne;++he)if((ie&2147483648>>>he)!==0)return ie<<=he,ne-=he,he;return this.loadWord(),he+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var he=this.skipLeadingZeros();return this.readBits(he+1)-1},this.readExpGolomb=function(){var he=this.readUnsignedExpGolomb();return 1&he?1+he>>>1:-1*(he>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var zs=ds,pa=t,na=zs,Jr,me,Se;me=function(){var S=0,Y,ie;me.prototype.init.call(this),this.push=function(ne){var he;ie?(he=new Uint8Array(ie.byteLength+ne.data.byteLength),he.set(ie),he.set(ne.data,ie.byteLength),ie=he):ie=ne.data;for(var ge=ie.byteLength;S<ge-3;S++)if(ie[S+2]===1){Y=S+5;break}for(;Y<ge;)switch(ie[Y]){case 0:if(ie[Y-1]!==0){Y+=2;break}else if(ie[Y-2]!==0){Y++;break}S+3!==Y-2&&this.trigger("data",ie.subarray(S+3,Y-2));do Y++;while(ie[Y]!==1&&Y<ge);S=Y-2,Y+=3;break;case 1:if(ie[Y-1]!==0||ie[Y-2]!==0){Y+=3;break}this.trigger("data",ie.subarray(S+3,Y-2)),S=Y-2,Y+=3;break;default:Y+=3;break}ie=ie.subarray(S),Y-=S,S=0},this.reset=function(){ie=null,S=0,this.trigger("reset")},this.flush=function(){ie&&ie.byteLength>3&&this.trigger("data",ie.subarray(S+3)),ie=null,S=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},me.prototype=new pa,Se={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},Jr=function(){var S=new me,Y,ie,ne,he,ge,Ie,ke;Jr.prototype.init.call(this),Y=this,this.push=function(Ne){Ne.type==="video"&&(ie=Ne.trackId,ne=Ne.pts,he=Ne.dts,S.push(Ne))},S.on("data",function(Ne){var Ve={trackId:ie,pts:ne,dts:he,data:Ne,nalUnitTypeCode:Ne[0]&31};switch(Ve.nalUnitTypeCode){case 5:Ve.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:Ve.nalUnitType="sei_rbsp",Ve.escapedRBSP=ge(Ne.subarray(1));break;case 7:Ve.nalUnitType="seq_parameter_set_rbsp",Ve.escapedRBSP=ge(Ne.subarray(1)),Ve.config=Ie(Ve.escapedRBSP);break;case 8:Ve.nalUnitType="pic_parameter_set_rbsp";break;case 9:Ve.nalUnitType="access_unit_delimiter_rbsp";break}Y.trigger("data",Ve)}),S.on("done",function(){Y.trigger("done")}),S.on("partialdone",function(){Y.trigger("partialdone")}),S.on("reset",function(){Y.trigger("reset")}),S.on("endedtimeline",function(){Y.trigger("endedtimeline")}),this.flush=function(){S.flush()},this.partialFlush=function(){S.partialFlush()},this.reset=function(){S.reset()},this.endTimeline=function(){S.endTimeline()},ke=function(Ne,Ve){var et=8,jt=8,Rn,Wt;for(Rn=0;Rn<Ne;Rn++)jt!==0&&(Wt=Ve.readExpGolomb(),jt=(et+Wt+256)%256),et=jt===0?et:jt},ge=function(Ne){for(var Ve=Ne.byteLength,et=[],jt=1,Rn,Wt;jt<Ve-2;)Ne[jt]===0&&Ne[jt+1]===0&&Ne[jt+2]===3?(et.push(jt+2),jt+=2):jt++;if(et.length===0)return Ne;Rn=Ve-et.length,Wt=new Uint8Array(Rn);var Mn=0;for(jt=0;jt<Rn;Mn++,jt++)Mn===et[0]&&(Mn++,et.shift()),Wt[jt]=Ne[Mn];return Wt},Ie=function(Ne){var Ve=0,et=0,jt=0,Rn=0,Wt,Mn,yi,Lr,vs,za,Xo,mr,ro,Sa,$a,Zi=[1,1],aa,Zr;if(Wt=new na(Ne),Mn=Wt.readUnsignedByte(),Lr=Wt.readUnsignedByte(),yi=Wt.readUnsignedByte(),Wt.skipUnsignedExpGolomb(),Se[Mn]&&(vs=Wt.readUnsignedExpGolomb(),vs===3&&Wt.skipBits(1),Wt.skipUnsignedExpGolomb(),Wt.skipUnsignedExpGolomb(),Wt.skipBits(1),Wt.readBoolean()))for($a=vs!==3?8:12,Zr=0;Zr<$a;Zr++)Wt.readBoolean()&&(Zr<6?ke(16,Wt):ke(64,Wt));if(Wt.skipUnsignedExpGolomb(),za=Wt.readUnsignedExpGolomb(),za===0)Wt.readUnsignedExpGolomb();else if(za===1)for(Wt.skipBits(1),Wt.skipExpGolomb(),Wt.skipExpGolomb(),Xo=Wt.readUnsignedExpGolomb(),Zr=0;Zr<Xo;Zr++)Wt.skipExpGolomb();if(Wt.skipUnsignedExpGolomb(),Wt.skipBits(1),mr=Wt.readUnsignedExpGolomb(),ro=Wt.readUnsignedExpGolomb(),Sa=Wt.readBits(1),Sa===0&&Wt.skipBits(1),Wt.skipBits(1),Wt.readBoolean()&&(Ve=Wt.readUnsignedExpGolomb(),et=Wt.readUnsignedExpGolomb(),jt=Wt.readUnsignedExpGolomb(),Rn=Wt.readUnsignedExpGolomb()),Wt.readBoolean()&&Wt.readBoolean()){switch(aa=Wt.readUnsignedByte(),aa){case 1:Zi=[1,1];break;case 2:Zi=[12,11];break;case 3:Zi=[10,11];break;case 4:Zi=[16,11];break;case 5:Zi=[40,33];break;case 6:Zi=[24,11];break;case 7:Zi=[20,11];break;case 8:Zi=[32,11];break;case 9:Zi=[80,33];break;case 10:Zi=[18,11];break;case 11:Zi=[15,11];break;case 12:Zi=[64,33];break;case 13:Zi=[160,99];break;case 14:Zi=[4,3];break;case 15:Zi=[3,2];break;case 16:Zi=[2,1];break;case 255:{Zi=[Wt.readUnsignedByte()<<8|Wt.readUnsignedByte(),Wt.readUnsignedByte()<<8|Wt.readUnsignedByte()];break}}Zi&&Zi[0]/Zi[1]}return{profileIdc:Mn,levelIdc:yi,profileCompatibility:Lr,width:(mr+1)*16-Ve*2-et*2,height:(2-Sa)*(ro+1)*16-jt*2-Rn*2,sarRatio:Zi}}},Jr.prototype=new pa;var De={H264Stream:Jr},Le=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Be=function(S,Y){var ie=S[Y+6]<<21|S[Y+7]<<14|S[Y+8]<<7|S[Y+9],ne=S[Y+5],he=(ne&16)>>4;return ie=ie>=0?ie:0,he?ie+20:ie+10},je=function(S,Y){return S.length-Y<10||S[Y]!==73||S[Y+1]!==68||S[Y+2]!==51?Y:(Y+=Be(S,Y),je(S,Y))},Ze=function(S){var Y=je(S,0);return S.length>=Y+2&&(S[Y]&255)===255&&(S[Y+1]&240)===240&&(S[Y+1]&22)===16},Ge=function(S){return S[0]<<21|S[1]<<14|S[2]<<7|S[3]},Oe=function(S,Y,ie){var ne,he="";for(ne=Y;ne<ie;ne++)he+="%"+("00"+S[ne].toString(16)).slice(-2);return he},Ke=function(S,Y,ie){return unescape(Oe(S,Y,ie))},$e=function(S,Y){var ie=(S[Y+5]&224)>>5,ne=S[Y+4]<<3,he=S[Y+3]&6144;return he|ne|ie},Gt=function(S,Y){return S[Y]===73&&S[Y+1]===68&&S[Y+2]===51?"timed-metadata":S[Y]&!0&&(S[Y+1]&240)===240?"audio":null},zt=function(S){for(var Y=0;Y+5<S.length;){if(S[Y]!==255||(S[Y+1]&246)!==240){Y++;continue}return Le[(S[Y+2]&60)>>>2]}return null},qt=function(S){var Y,ie,ne,he;Y=10,S[5]&64&&(Y+=4,Y+=Ge(S.subarray(10,14)));do{if(ie=Ge(S.subarray(Y+4,Y+8)),ie<1)return null;if(he=String.fromCharCode(S[Y],S[Y+1],S[Y+2],S[Y+3]),he==="PRIV"){ne=S.subarray(Y+10,Y+ie+10);for(var ge=0;ge<ne.byteLength;ge++)if(ne[ge]===0){var Ie=Ke(ne,0,ge);if(Ie==="com.apple.streaming.transportStreamTimestamp"){var ke=ne.subarray(ge+1),Ne=(ke[3]&1)<<30|ke[4]<<22|ke[5]<<14|ke[6]<<6|ke[7]>>>2;return Ne*=4,Ne+=ke[7]&3,Ne}break}}Y+=10,Y+=ie}while(Y<S.byteLength);return null},En={isLikelyAacData:Ze,parseId3TagSize:Be,parseAdtsSize:$e,parseType:Gt,parseSampleRate:zt,parseAacTimestamp:qt},vn=t,mn=En,qn;qn=function(){var S=new Uint8Array,Y=0;qn.prototype.init.call(this),this.setTimestamp=function(ie){Y=ie},this.push=function(ie){var ne=0,he=0,ge,Ie,ke,Ne;for(S.length?(Ne=S.length,S=new Uint8Array(ie.byteLength+Ne),S.set(S.subarray(0,Ne)),S.set(ie,Ne)):S=ie;S.length-he>=3;){if(S[he]===73&&S[he+1]===68&&S[he+2]===51){if(S.length-he<10||(ne=mn.parseId3TagSize(S,he),he+ne>S.length))break;Ie={type:"timed-metadata",data:S.subarray(he,he+ne)},this.trigger("data",Ie),he+=ne;continue}else if((S[he]&255)===255&&(S[he+1]&240)===240){if(S.length-he<7||(ne=mn.parseAdtsSize(S,he),he+ne>S.length))break;ke={type:"audio",data:S.subarray(he,he+ne),pts:Y,dts:Y},this.trigger("data",ke),he+=ne;continue}he++}ge=S.length-he,ge>0?S=S.subarray(he):S=new Uint8Array},this.reset=function(){S=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){S=new Uint8Array,this.trigger("endedtimeline")}},qn.prototype=new vn;var Nn=qn,On=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Un=On,Dn=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Gn=Dn,Ln=t,pi=Te,ui=ln,mi=oi,ni=tt,di=Hs,Ci=Xe,Oi=qs,rr=De.H264Stream,Wi=Nn,Xi=En.isLikelyAacData,Bi=Xe.ONE_SECOND_IN_TS,vi=Un,_r=Gn,Br,cr,T,de,ve=function(S,Y){Y.stream=S,this.trigger("log",Y)},we=function(S,Y){for(var ie=Object.keys(Y),ne=0;ne<ie.length;ne++){var he=ie[ne];he==="headOfPipeline"||!Y[he].on||Y[he].on("log",ve.bind(S,he))}},Ue=function(S,Y){var ie;if(S.length!==Y.length)return!1;for(ie=0;ie<S.length;ie++)if(S[ie]!==Y[ie])return!1;return!0},ze=function(S,Y,ie,ne,he,ge){var Ie=ie-Y,ke=ne-Y,Ne=he-ie;return{start:{dts:S,pts:S+Ie},end:{dts:S+ke,pts:S+Ne},prependedContentDuration:ge,baseMediaDecodeTime:S}};cr=function(S,Y){var ie=[],ne,he=0,ge=0,Ie=1/0;Y=Y||{},ne=Y.firstSequenceNumber||0,cr.prototype.init.call(this),this.push=function(ke){ni.collectDtsInfo(S,ke),S&&vi.forEach(function(Ne){S[Ne]=ke[Ne]}),ie.push(ke)},this.setEarliestDts=function(ke){he=ke},this.setVideoBaseMediaDecodeTime=function(ke){Ie=ke},this.setAudioAppendStart=function(ke){ge=ke},this.flush=function(){var ke,Ne,Ve,et,jt,Rn,Wt;if(ie.length===0){this.trigger("done","AudioSegmentStream");return}ke=mi.trimAdtsFramesByEarliestDts(ie,S,he),S.baseMediaDecodeTime=ni.calculateTrackBaseMediaDecodeTime(S,Y.keepOriginalTimestamps),Wt=mi.prefixWithSilence(S,ke,ge,Ie),S.samples=mi.generateSampleTable(ke),Ve=pi.mdat(mi.concatenateFrameData(ke)),ie=[],Ne=pi.moof(ne,[S]),et=new Uint8Array(Ne.byteLength+Ve.byteLength),ne++,et.set(Ne),et.set(Ve,Ne.byteLength),ni.clearDtsInfo(S),jt=Math.ceil(Bi*1024/S.samplerate),ke.length&&(Rn=ke.length*jt,this.trigger("segmentTimingInfo",ze(Ci.audioTsToVideoTs(S.baseMediaDecodeTime,S.samplerate),ke[0].dts,ke[0].pts,ke[0].dts+Rn,ke[0].pts+Rn,Wt||0)),this.trigger("timingInfo",{start:ke[0].pts,end:ke[0].pts+Rn})),this.trigger("data",{track:S,boxes:et}),this.trigger("done","AudioSegmentStream")},this.reset=function(){ni.clearDtsInfo(S),ie=[],this.trigger("reset")}},cr.prototype=new Ln,Br=function(S,Y){var ie,ne=[],he=[],ge,Ie;Y=Y||{},ie=Y.firstSequenceNumber||0,Br.prototype.init.call(this),delete S.minPTS,this.gopCache_=[],this.push=function(ke){ni.collectDtsInfo(S,ke),ke.nalUnitType==="seq_parameter_set_rbsp"&&!ge&&(ge=ke.config,S.sps=[ke.data],_r.forEach(function(Ne){S[Ne]=ge[Ne]},this)),ke.nalUnitType==="pic_parameter_set_rbsp"&&!Ie&&(Ie=ke.data,S.pps=[ke.data]),ne.push(ke)},this.flush=function(){for(var ke,Ne,Ve,et,jt,Rn,Wt=0,Mn,yi;ne.length&&ne[0].nalUnitType!=="access_unit_delimiter_rbsp";)ne.shift();if(ne.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(ke=ui.groupNalsIntoFrames(ne),Ve=ui.groupFramesIntoGops(ke),Ve[0][0].keyFrame||(Ne=this.getGopForFusion_(ne[0],S),Ne?(Wt=Ne.duration,Ve.unshift(Ne),Ve.byteLength+=Ne.byteLength,Ve.nalCount+=Ne.nalCount,Ve.pts=Ne.pts,Ve.dts=Ne.dts,Ve.duration+=Ne.duration):Ve=ui.extendFirstKeyFrame(Ve)),he.length){var Lr;if(Y.alignGopsAtEnd?Lr=this.alignGopsAtEnd_(Ve):Lr=this.alignGopsAtStart_(Ve),!Lr){this.gopCache_.unshift({gop:Ve.pop(),pps:S.pps,sps:S.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),ne=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}ni.clearDtsInfo(S),Ve=Lr}ni.collectDtsInfo(S,Ve),S.samples=ui.generateSampleTable(Ve),jt=pi.mdat(ui.concatenateNalData(Ve)),S.baseMediaDecodeTime=ni.calculateTrackBaseMediaDecodeTime(S,Y.keepOriginalTimestamps),this.trigger("processedGopsInfo",Ve.map(function(vs){return{pts:vs.pts,dts:vs.dts,byteLength:vs.byteLength}})),Mn=Ve[0],yi=Ve[Ve.length-1],this.trigger("segmentTimingInfo",ze(S.baseMediaDecodeTime,Mn.dts,Mn.pts,yi.dts+yi.duration,yi.pts+yi.duration,Wt)),this.trigger("timingInfo",{start:Ve[0].pts,end:Ve[Ve.length-1].pts+Ve[Ve.length-1].duration}),this.gopCache_.unshift({gop:Ve.pop(),pps:S.pps,sps:S.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),ne=[],this.trigger("baseMediaDecodeTime",S.baseMediaDecodeTime),this.trigger("timelineStartInfo",S.timelineStartInfo),et=pi.moof(ie,[S]),Rn=new Uint8Array(et.byteLength+jt.byteLength),ie++,Rn.set(et),Rn.set(jt,et.byteLength),this.trigger("data",{track:S,boxes:Rn}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),ne=[],this.gopCache_.length=0,he.length=0,this.trigger("reset")},this.resetStream_=function(){ni.clearDtsInfo(S),ge=void 0,Ie=void 0},this.getGopForFusion_=function(ke){var Ne=45e3,Ve=1/0,et,jt,Rn,Wt,Mn;for(Mn=0;Mn<this.gopCache_.length;Mn++)Wt=this.gopCache_[Mn],Rn=Wt.gop,!(!(S.pps&&Ue(S.pps[0],Wt.pps[0]))||!(S.sps&&Ue(S.sps[0],Wt.sps[0])))&&(Rn.dts<S.timelineStartInfo.dts||(et=ke.dts-Rn.dts-Rn.duration,et>=-1e4&&et<=Ne&&(!jt||Ve>et)&&(jt=Wt,Ve=et)));return jt?jt.gop:null},this.alignGopsAtStart_=function(ke){var Ne,Ve,et,jt,Rn,Wt,Mn,yi;for(Rn=ke.byteLength,Wt=ke.nalCount,Mn=ke.duration,Ne=Ve=0;Ne<he.length&&Ve<ke.length&&(et=he[Ne],jt=ke[Ve],et.pts!==jt.pts);){if(jt.pts>et.pts){Ne++;continue}Ve++,Rn-=jt.byteLength,Wt-=jt.nalCount,Mn-=jt.duration}return Ve===0?ke:Ve===ke.length?null:(yi=ke.slice(Ve),yi.byteLength=Rn,yi.duration=Mn,yi.nalCount=Wt,yi.pts=yi[0].pts,yi.dts=yi[0].dts,yi)},this.alignGopsAtEnd_=function(ke){var Ne,Ve,et,jt,Rn,Wt;for(Ne=he.length-1,Ve=ke.length-1,Rn=null,Wt=!1;Ne>=0&&Ve>=0;){if(et=he[Ne],jt=ke[Ve],et.pts===jt.pts){Wt=!0;break}if(et.pts>jt.pts){Ne--;continue}Ne===he.length-1&&(Rn=Ve),Ve--}if(!Wt&&Rn===null)return null;var Mn;if(Wt?Mn=Ve:Mn=Rn,Mn===0)return ke;var yi=ke.slice(Mn),Lr=yi.reduce(function(vs,za){return vs.byteLength+=za.byteLength,vs.duration+=za.duration,vs.nalCount+=za.nalCount,vs},{byteLength:0,duration:0,nalCount:0});return yi.byteLength=Lr.byteLength,yi.duration=Lr.duration,yi.nalCount=Lr.nalCount,yi.pts=yi[0].pts,yi.dts=yi[0].dts,yi},this.alignGopsWith=function(ke){he=ke}},Br.prototype=new Ln,de=function(S,Y){this.numberOfTracks=0,this.metadataStream=Y,S=S||{},typeof S.remux<"u"?this.remuxTracks=!!S.remux:this.remuxTracks=!0,typeof S.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=S.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,de.prototype.init.call(this),this.push=function(ie){if(ie.content||ie.text)return this.pendingCaptions.push(ie);if(ie.frames)return this.pendingMetadata.push(ie);this.pendingTracks.push(ie.track),this.pendingBytes+=ie.boxes.byteLength,ie.track.type==="video"&&(this.videoTrack=ie.track,this.pendingBoxes.push(ie.boxes)),ie.track.type==="audio"&&(this.audioTrack=ie.track,this.pendingBoxes.unshift(ie.boxes))}},de.prototype=new Ln,de.prototype.flush=function(S){var Y=0,ie={captions:[],captionStreams:{},metadata:[],info:{}},ne,he,ge,Ie=0,ke;if(this.pendingTracks.length<this.numberOfTracks){if(S!=="VideoSegmentStream"&&S!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(Ie=this.videoTrack.timelineStartInfo.pts,_r.forEach(function(Ne){ie.info[Ne]=this.videoTrack[Ne]},this)):this.audioTrack&&(Ie=this.audioTrack.timelineStartInfo.pts,vi.forEach(function(Ne){ie.info[Ne]=this.audioTrack[Ne]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?ie.type=this.pendingTracks[0].type:ie.type="combined",this.emittedTracks+=this.pendingTracks.length,ge=pi.initSegment(this.pendingTracks),ie.initSegment=new Uint8Array(ge.byteLength),ie.initSegment.set(ge),ie.data=new Uint8Array(this.pendingBytes),ke=0;ke<this.pendingBoxes.length;ke++)ie.data.set(this.pendingBoxes[ke],Y),Y+=this.pendingBoxes[ke].byteLength;for(ke=0;ke<this.pendingCaptions.length;ke++)ne=this.pendingCaptions[ke],ne.startTime=Ci.metadataTsToSeconds(ne.startPts,Ie,this.keepOriginalTimestamps),ne.endTime=Ci.metadataTsToSeconds(ne.endPts,Ie,this.keepOriginalTimestamps),ie.captionStreams[ne.stream]=!0,ie.captions.push(ne);for(ke=0;ke<this.pendingMetadata.length;ke++)he=this.pendingMetadata[ke],he.cueTime=Ci.metadataTsToSeconds(he.pts,Ie,this.keepOriginalTimestamps),ie.metadata.push(he);for(ie.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",ie),ke=0;ke<ie.captions.length;ke++)ne=ie.captions[ke],this.trigger("caption",ne);for(ke=0;ke<ie.metadata.length;ke++)he=ie.metadata[ke],this.trigger("id3Frame",he)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},de.prototype.setRemux=function(S){this.remuxTracks=S},T=function(S){var Y=this,ie=!0,ne,he;T.prototype.init.call(this),S=S||{},this.baseMediaDecodeTime=S.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var ge={};this.transmuxPipeline_=ge,ge.type="aac",ge.metadataStream=new di.MetadataStream,ge.aacStream=new Wi,ge.audioTimestampRolloverStream=new di.TimestampRolloverStream("audio"),ge.timedMetadataTimestampRolloverStream=new di.TimestampRolloverStream("timed-metadata"),ge.adtsStream=new Oi,ge.coalesceStream=new de(S,ge.metadataStream),ge.headOfPipeline=ge.aacStream,ge.aacStream.pipe(ge.audioTimestampRolloverStream).pipe(ge.adtsStream),ge.aacStream.pipe(ge.timedMetadataTimestampRolloverStream).pipe(ge.metadataStream).pipe(ge.coalesceStream),ge.metadataStream.on("timestamp",function(Ie){ge.aacStream.setTimestamp(Ie.timeStamp)}),ge.aacStream.on("data",function(Ie){Ie.type!=="timed-metadata"&&Ie.type!=="audio"||ge.audioSegmentStream||(he=he||{timelineStartInfo:{baseMediaDecodeTime:Y.baseMediaDecodeTime},codec:"adts",type:"audio"},ge.coalesceStream.numberOfTracks++,ge.audioSegmentStream=new cr(he,S),ge.audioSegmentStream.on("log",Y.getLogTrigger_("audioSegmentStream")),ge.audioSegmentStream.on("timingInfo",Y.trigger.bind(Y,"audioTimingInfo")),ge.adtsStream.pipe(ge.audioSegmentStream).pipe(ge.coalesceStream),Y.trigger("trackinfo",{hasAudio:!!he,hasVideo:!!ne}))}),ge.coalesceStream.on("data",this.trigger.bind(this,"data")),ge.coalesceStream.on("done",this.trigger.bind(this,"done")),we(this,ge)},this.setupTsPipeline=function(){var ge={};this.transmuxPipeline_=ge,ge.type="ts",ge.metadataStream=new di.MetadataStream,ge.packetStream=new di.TransportPacketStream,ge.parseStream=new di.TransportParseStream,ge.elementaryStream=new di.ElementaryStream,ge.timestampRolloverStream=new di.TimestampRolloverStream,ge.adtsStream=new Oi,ge.h264Stream=new rr,ge.captionStream=new di.CaptionStream(S),ge.coalesceStream=new de(S,ge.metadataStream),ge.headOfPipeline=ge.packetStream,ge.packetStream.pipe(ge.parseStream).pipe(ge.elementaryStream).pipe(ge.timestampRolloverStream),ge.timestampRolloverStream.pipe(ge.h264Stream),ge.timestampRolloverStream.pipe(ge.adtsStream),ge.timestampRolloverStream.pipe(ge.metadataStream).pipe(ge.coalesceStream),ge.h264Stream.pipe(ge.captionStream).pipe(ge.coalesceStream),ge.elementaryStream.on("data",function(Ie){var ke;if(Ie.type==="metadata"){for(ke=Ie.tracks.length;ke--;)!ne&&Ie.tracks[ke].type==="video"?(ne=Ie.tracks[ke],ne.timelineStartInfo.baseMediaDecodeTime=Y.baseMediaDecodeTime):!he&&Ie.tracks[ke].type==="audio"&&(he=Ie.tracks[ke],he.timelineStartInfo.baseMediaDecodeTime=Y.baseMediaDecodeTime);ne&&!ge.videoSegmentStream&&(ge.coalesceStream.numberOfTracks++,ge.videoSegmentStream=new Br(ne,S),ge.videoSegmentStream.on("log",Y.getLogTrigger_("videoSegmentStream")),ge.videoSegmentStream.on("timelineStartInfo",function(Ne){he&&!S.keepOriginalTimestamps&&(he.timelineStartInfo=Ne,ge.audioSegmentStream.setEarliestDts(Ne.dts-Y.baseMediaDecodeTime))}),ge.videoSegmentStream.on("processedGopsInfo",Y.trigger.bind(Y,"gopInfo")),ge.videoSegmentStream.on("segmentTimingInfo",Y.trigger.bind(Y,"videoSegmentTimingInfo")),ge.videoSegmentStream.on("baseMediaDecodeTime",function(Ne){he&&ge.audioSegmentStream.setVideoBaseMediaDecodeTime(Ne)}),ge.videoSegmentStream.on("timingInfo",Y.trigger.bind(Y,"videoTimingInfo")),ge.h264Stream.pipe(ge.videoSegmentStream).pipe(ge.coalesceStream)),he&&!ge.audioSegmentStream&&(ge.coalesceStream.numberOfTracks++,ge.audioSegmentStream=new cr(he,S),ge.audioSegmentStream.on("log",Y.getLogTrigger_("audioSegmentStream")),ge.audioSegmentStream.on("timingInfo",Y.trigger.bind(Y,"audioTimingInfo")),ge.audioSegmentStream.on("segmentTimingInfo",Y.trigger.bind(Y,"audioSegmentTimingInfo")),ge.adtsStream.pipe(ge.audioSegmentStream).pipe(ge.coalesceStream)),Y.trigger("trackinfo",{hasAudio:!!he,hasVideo:!!ne})}}),ge.coalesceStream.on("data",this.trigger.bind(this,"data")),ge.coalesceStream.on("id3Frame",function(Ie){Ie.dispatchType=ge.metadataStream.dispatchType,Y.trigger("id3Frame",Ie)}),ge.coalesceStream.on("caption",this.trigger.bind(this,"caption")),ge.coalesceStream.on("done",this.trigger.bind(this,"done")),we(this,ge)},this.setBaseMediaDecodeTime=function(ge){var Ie=this.transmuxPipeline_;S.keepOriginalTimestamps||(this.baseMediaDecodeTime=ge),he&&(he.timelineStartInfo.dts=void 0,he.timelineStartInfo.pts=void 0,ni.clearDtsInfo(he),Ie.audioTimestampRolloverStream&&Ie.audioTimestampRolloverStream.discontinuity()),ne&&(Ie.videoSegmentStream&&(Ie.videoSegmentStream.gopCache_=[]),ne.timelineStartInfo.dts=void 0,ne.timelineStartInfo.pts=void 0,ni.clearDtsInfo(ne),Ie.captionStream.reset()),Ie.timestampRolloverStream&&Ie.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(ge){he&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(ge)},this.setRemux=function(ge){var Ie=this.transmuxPipeline_;S.remux=ge,Ie&&Ie.coalesceStream&&Ie.coalesceStream.setRemux(ge)},this.alignGopsWith=function(ge){ne&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(ge)},this.getLogTrigger_=function(ge){var Ie=this;return function(ke){ke.stream=ge,Ie.trigger("log",ke)}},this.push=function(ge){if(ie){var Ie=Xi(ge);Ie&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!Ie&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),ie=!1}this.transmuxPipeline_.headOfPipeline.push(ge)},this.flush=function(){ie=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},T.prototype=new Ln;var Mt={Transmuxer:T},yn=function(S){return S>>>0},kn=function(S){return("00"+S.toString(16)).slice(-2)},Cn={toUnsigned:yn,toHexString:kn},wn=function(S){var Y="";return Y+=String.fromCharCode(S[0]),Y+=String.fromCharCode(S[1]),Y+=String.fromCharCode(S[2]),Y+=String.fromCharCode(S[3]),Y},Sn=wn,zn=Cn.toUnsigned,Kn=Sn,bi=function(S,Y){var ie=[],ne,he,ge,Ie,ke;if(!Y.length)return null;for(ne=0;ne<S.byteLength;)he=zn(S[ne]<<24|S[ne+1]<<16|S[ne+2]<<8|S[ne+3]),ge=Kn(S.subarray(ne+4,ne+8)),Ie=he>1?ne+he:S.byteLength,ge===Y[0]&&(Y.length===1?ie.push(S.subarray(ne+8,Ie)):(ke=bi(S.subarray(ne+8,Ie),Y.slice(1)),ke.length&&(ie=ie.concat(ke)))),ne=Ie;return ie},Ti=bi,ur=Cn.toUnsigned,Ir=s.getUint64,ti=function(S){var Y={version:S[0],flags:new Uint8Array(S.subarray(1,4))};return Y.version===1?Y.baseMediaDecodeTime=Ir(S.subarray(4)):Y.baseMediaDecodeTime=ur(S[4]<<24|S[5]<<16|S[6]<<8|S[7]),Y},Tr=ti,zi=function(S){var Y=new DataView(S.buffer,S.byteOffset,S.byteLength),ie={version:S[0],flags:new Uint8Array(S.subarray(1,4)),trackId:Y.getUint32(4)},ne=ie.flags[2]&1,he=ie.flags[2]&2,ge=ie.flags[2]&8,Ie=ie.flags[2]&16,ke=ie.flags[2]&32,Ne=ie.flags[0]&65536,Ve=ie.flags[0]&131072,et;return et=8,ne&&(et+=4,ie.baseDataOffset=Y.getUint32(12),et+=4),he&&(ie.sampleDescriptionIndex=Y.getUint32(et),et+=4),ge&&(ie.defaultSampleDuration=Y.getUint32(et),et+=4),Ie&&(ie.defaultSampleSize=Y.getUint32(et),et+=4),ke&&(ie.defaultSampleFlags=Y.getUint32(et)),Ne&&(ie.durationIsEmpty=!0),!ne&&Ve&&(ie.baseDataOffsetIsMoof=!0),ie},Hi=zi,yr=function(S){return{isLeading:(S[0]&12)>>>2,dependsOn:S[0]&3,isDependedOn:(S[1]&192)>>>6,hasRedundancy:(S[1]&48)>>>4,paddingValue:(S[1]&14)>>>1,isNonSyncSample:S[1]&1,degradationPriority:S[2]<<8|S[3]}},Ai=yr,is=Ai,Na=function(S){var Y={version:S[0],flags:new Uint8Array(S.subarray(1,4)),samples:[]},ie=new DataView(S.buffer,S.byteOffset,S.byteLength),ne=Y.flags[2]&1,he=Y.flags[2]&4,ge=Y.flags[1]&1,Ie=Y.flags[1]&2,ke=Y.flags[1]&4,Ne=Y.flags[1]&8,Ve=ie.getUint32(4),et=8,jt;for(ne&&(Y.dataOffset=ie.getInt32(et),et+=4),he&&Ve&&(jt={flags:is(S.subarray(et,et+4))},et+=4,ge&&(jt.duration=ie.getUint32(et),et+=4),Ie&&(jt.size=ie.getUint32(et),et+=4),Ne&&(Y.version===1?jt.compositionTimeOffset=ie.getInt32(et):jt.compositionTimeOffset=ie.getUint32(et),et+=4),Y.samples.push(jt),Ve--);Ve--;)jt={},ge&&(jt.duration=ie.getUint32(et),et+=4),Ie&&(jt.size=ie.getUint32(et),et+=4),ke&&(jt.flags=is(S.subarray(et,et+4)),et+=4),Ne&&(Y.version===1?jt.compositionTimeOffset=ie.getInt32(et):jt.compositionTimeOffset=ie.getUint32(et),et+=4),Y.samples.push(jt);return Y},ia=Na,$s={tfdt:Tr,trun:ia},ma={parseTfdt:$s.tfdt,parseTrun:$s.trun},Ho=function(S){for(var Y=0,ie=String.fromCharCode(S[Y]),ne="";ie!=="\0";)ne+=ie,Y++,ie=String.fromCharCode(S[Y]);return ne+=ie,ne},Kr={uint8ToCString:Ho},La=Kr.uint8ToCString,ol=s.getUint64,ji=function(S){var Y=4,ie=S[0],ne,he,ge,Ie,ke,Ne,Ve,et;if(ie===0){ne=La(S.subarray(Y)),Y+=ne.length,he=La(S.subarray(Y)),Y+=he.length;var jt=new DataView(S.buffer);ge=jt.getUint32(Y),Y+=4,ke=jt.getUint32(Y),Y+=4,Ne=jt.getUint32(Y),Y+=4,Ve=jt.getUint32(Y),Y+=4}else if(ie===1){var jt=new DataView(S.buffer);ge=jt.getUint32(Y),Y+=4,Ie=ol(S.subarray(Y)),Y+=8,Ne=jt.getUint32(Y),Y+=4,Ve=jt.getUint32(Y),Y+=4,ne=La(S.subarray(Y)),Y+=ne.length,he=La(S.subarray(Y)),Y+=he.length}et=new Uint8Array(S.subarray(Y,S.byteLength));var Rn={scheme_id_uri:ne,value:he,timescale:ge||1,presentation_time:Ie,presentation_time_delta:ke,event_duration:Ne,id:Ve,message_data:et};return ra(ie,Rn)?Rn:void 0},Ml=function(S,Y,ie,ne){return S||S===0?S/Y:ne+ie/Y},ra=function(S,Y){var ie=Y.scheme_id_uri!=="\0",ne=S===0&&ll(Y.presentation_time_delta)&&ie,he=S===1&&ll(Y.presentation_time)&&ie;return!(S>1)&&ne||he},ll=function(S){return S!==void 0||S!==null},Nl={parseEmsgBox:ji,scaleTime:Ml},eo;typeof window<"u"?eo=window:typeof i<"u"?eo=i:typeof self<"u"?eo=self:eo={};var jr=eo,Gs=Cn.toUnsigned,Oa=Cn.toHexString,pr=Ti,ga=Sn,gs=Nl,qo=Hi,cl=ia,_a=Tr,to=s.getUint64,ya,no,Ws,sa,va,ba,io,_s=jr,zo=ki.parseId3Frames;ya=function(S){var Y={},ie=pr(S,["moov","trak"]);return ie.reduce(function(ne,he){var ge,Ie,ke,Ne,Ve;return ge=pr(he,["tkhd"])[0],!ge||(Ie=ge[0],ke=Ie===0?12:20,Ne=Gs(ge[ke]<<24|ge[ke+1]<<16|ge[ke+2]<<8|ge[ke+3]),Ve=pr(he,["mdia","mdhd"])[0],!Ve)?null:(Ie=Ve[0],ke=Ie===0?12:20,ne[Ne]=Gs(Ve[ke]<<24|Ve[ke+1]<<16|Ve[ke+2]<<8|Ve[ke+3]),ne)},Y)},no=function(S,Y){var ie;ie=pr(Y,["moof","traf"]);var ne=ie.reduce(function(he,ge){var Ie=pr(ge,["tfhd"])[0],ke=Gs(Ie[4]<<24|Ie[5]<<16|Ie[6]<<8|Ie[7]),Ne=S[ke]||9e4,Ve=pr(ge,["tfdt"])[0],et=new DataView(Ve.buffer,Ve.byteOffset,Ve.byteLength),jt;Ve[0]===1?jt=to(Ve.subarray(4,12)):jt=et.getUint32(4);let Rn;return typeof jt=="bigint"?Rn=jt/_s.BigInt(Ne):typeof jt=="number"&&!isNaN(jt)&&(Rn=jt/Ne),Rn<Number.MAX_SAFE_INTEGER&&(Rn=Number(Rn)),Rn<he&&(he=Rn),he},1/0);return typeof ne=="bigint"||isFinite(ne)?ne:0},Ws=function(S,Y){var ie=pr(Y,["moof","traf"]),ne=0,he=0,ge;if(ie&&ie.length){var Ie=pr(ie[0],["tfhd"])[0],ke=pr(ie[0],["trun"])[0],Ne=pr(ie[0],["tfdt"])[0];if(Ie){var Ve=qo(Ie);ge=Ve.trackId}if(Ne){var et=_a(Ne);ne=et.baseMediaDecodeTime}if(ke){var jt=cl(ke);jt.samples&&jt.samples.length&&(he=jt.samples[0].compositionTimeOffset||0)}}var Rn=S[ge]||9e4;typeof ne=="bigint"&&(he=_s.BigInt(he),Rn=_s.BigInt(Rn));var Wt=(ne+he)/Rn;return typeof Wt=="bigint"&&Wt<Number.MAX_SAFE_INTEGER&&(Wt=Number(Wt)),Wt},sa=function(S){var Y=pr(S,["moov","trak"]),ie=[];return Y.forEach(function(ne){var he=pr(ne,["mdia","hdlr"]),ge=pr(ne,["tkhd"]);he.forEach(function(Ie,ke){var Ne=ga(Ie.subarray(8,12)),Ve=ge[ke],et,jt,Rn;Ne==="vide"&&(et=new DataView(Ve.buffer,Ve.byteOffset,Ve.byteLength),jt=et.getUint8(0),Rn=jt===0?et.getUint32(12):et.getUint32(20),ie.push(Rn))})}),ie},ba=function(S){var Y=S[0],ie=Y===0?12:20;return Gs(S[ie]<<24|S[ie+1]<<16|S[ie+2]<<8|S[ie+3])},va=function(S){var Y=pr(S,["moov","trak"]),ie=[];return Y.forEach(function(ne){var he={},ge=pr(ne,["tkhd"])[0],Ie,ke;ge&&(Ie=new DataView(ge.buffer,ge.byteOffset,ge.byteLength),ke=Ie.getUint8(0),he.id=ke===0?Ie.getUint32(12):Ie.getUint32(20));var Ne=pr(ne,["mdia","hdlr"])[0];if(Ne){var Ve=ga(Ne.subarray(8,12));Ve==="vide"?he.type="video":Ve==="soun"?he.type="audio":he.type=Ve}var et=pr(ne,["mdia","minf","stbl","stsd"])[0];if(et){var jt=et.subarray(8);he.codec=ga(jt.subarray(4,8));var Rn=pr(jt,[he.codec])[0],Wt,Mn;Rn&&(/^[asm]vc[1-9]$/i.test(he.codec)?(Wt=Rn.subarray(78),Mn=ga(Wt.subarray(4,8)),Mn==="avcC"&&Wt.length>11?(he.codec+=".",he.codec+=Oa(Wt[9]),he.codec+=Oa(Wt[10]),he.codec+=Oa(Wt[11])):he.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(he.codec)?(Wt=Rn.subarray(28),Mn=ga(Wt.subarray(4,8)),Mn==="esds"&&Wt.length>20&&Wt[19]!==0?(he.codec+="."+Oa(Wt[19]),he.codec+="."+Oa(Wt[20]>>>2&63).replace(/^0/,"")):he.codec="mp4a.40.2"):he.codec=he.codec.toLowerCase())}var yi=pr(ne,["mdia","mdhd"])[0];yi&&(he.timescale=ba(yi)),ie.push(he)}),ie},io=function(S,Y=0){var ie=pr(S,["emsg"]);return ie.map(ne=>{var he=gs.parseEmsgBox(new Uint8Array(ne)),ge=zo(he.message_data);return{cueTime:gs.scaleTime(he.presentation_time,he.timescale,he.presentation_time_delta,Y),duration:gs.scaleTime(he.event_duration,he.timescale),frames:ge}})};var Fa={findBox:pr,parseType:ga,timescale:ya,startTime:no,compositionStartTime:Ws,videoTrackIds:sa,tracks:va,getTimescaleFromMediaHeader:ba,getEmsgID3:io};const{parseTrun:vo}=ma,{findBox:ul}=Fa;var dl=jr,hl=function(S){var Y=ul(S,["moof","traf"]),ie=ul(S,["mdat"]),ne=[];return ie.forEach(function(he,ge){var Ie=Y[ge];ne.push({mdat:he,traf:Ie})}),ne},bn=function(S,Y,ie){var ne=Y,he=ie.defaultSampleDuration||0,ge=ie.defaultSampleSize||0,Ie=ie.trackId,ke=[];return S.forEach(function(Ne){var Ve=vo(Ne),et=Ve.samples;et.forEach(function(jt){jt.duration===void 0&&(jt.duration=he),jt.size===void 0&&(jt.size=ge),jt.trackId=Ie,jt.dts=ne,jt.compositionTimeOffset===void 0&&(jt.compositionTimeOffset=0),typeof ne=="bigint"?(jt.pts=ne+dl.BigInt(jt.compositionTimeOffset),ne+=dl.BigInt(jt.duration)):(jt.pts=ne+jt.compositionTimeOffset,ne+=jt.duration)}),ke=ke.concat(et)}),ke},Xn={getMdatTrafPairs:hl,parseSamples:bn},_i=nr.discardEmulationPreventionBytes,gi=fs.CaptionStream,Ei=Ti,Yn=Tr,Ji=Hi,{getMdatTrafPairs:ws,parseSamples:Va}=Xn,Ea=function(S,Y){for(var ie=S,ne=0;ne<Y.length;ne++){var he=Y[ne];if(ie<he.size)return he;ie-=he.size}return null},Cs=function(S,Y,ie){var ne=new DataView(S.buffer,S.byteOffset,S.byteLength),he={logs:[],seiNals:[]},ge,Ie,ke,Ne;for(Ie=0;Ie+4<S.length;Ie+=ke)if(ke=ne.getUint32(Ie),Ie+=4,!(ke<=0))switch(S[Ie]&31){case 6:var Ve=S.subarray(Ie+1,Ie+1+ke),et=Ea(Ie,Y);if(ge={nalUnitType:"sei_rbsp",size:ke,data:Ve,escapedRBSP:_i(Ve),trackId:ie},et)ge.pts=et.pts,ge.dts=et.dts,Ne=et;else if(Ne)ge.pts=Ne.pts,ge.dts=Ne.dts;else{he.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+Ie+" for trackId "+ie+". See mux.js#223."});break}he.seiNals.push(ge);break}return he},Rs=function(S,Y){var ie={},ne=ws(S);return ne.forEach(function(he){var ge=he.mdat,Ie=he.traf,ke=Ei(Ie,["tfhd"]),Ne=Ji(ke[0]),Ve=Ne.trackId,et=Ei(Ie,["tfdt"]),jt=et.length>0?Yn(et[0]).baseMediaDecodeTime:0,Rn=Ei(Ie,["trun"]),Wt,Mn;Y===Ve&&Rn.length>0&&(Wt=Va(Rn,jt,Ne),Mn=Cs(ge,Wt,Ve),ie[Ve]||(ie[Ve]={seiNals:[],logs:[]}),ie[Ve].seiNals=ie[Ve].seiNals.concat(Mn.seiNals),ie[Ve].logs=ie[Ve].logs.concat(Mn.logs))}),ie},$o=function(S,Y,ie){var ne;if(Y===null)return null;ne=Rs(S,Y);var he=ne[Y]||{};return{seiNals:he.seiNals,logs:he.logs,timescale:ie}},Ta=function(){var S=!1,Y,ie,ne,he,ge,Ie;this.isInitialized=function(){return S},this.init=function(ke){Y=new gi,S=!0,Ie=ke?ke.isPartial:!1,Y.on("data",function(Ne){Ne.startTime=Ne.startPts/he,Ne.endTime=Ne.endPts/he,ge.captions.push(Ne),ge.captionStreams[Ne.stream]=!0}),Y.on("log",function(Ne){ge.logs.push(Ne)})},this.isNewInit=function(ke,Ne){return ke&&ke.length===0||Ne&&typeof Ne=="object"&&Object.keys(Ne).length===0?!1:ne!==ke[0]||he!==Ne[ne]},this.parse=function(ke,Ne,Ve){var et;if(this.isInitialized()){if(!Ne||!Ve)return null;if(this.isNewInit(Ne,Ve))ne=Ne[0],he=Ve[ne];else if(ne===null||!he)return ie.push(ke),null}else return null;for(;ie.length>0;){var jt=ie.shift();this.parse(jt,Ne,Ve)}return et=$o(ke,ne,he),et&&et.logs&&(ge.logs=ge.logs.concat(et.logs)),et===null||!et.seiNals?ge.logs.length?{logs:ge.logs,captions:[],captionStreams:[]}:null:(this.pushNals(et.seiNals),this.flushStream(),ge)},this.pushNals=function(ke){if(!this.isInitialized()||!ke||ke.length===0)return null;ke.forEach(function(Ne){Y.push(Ne)})},this.flushStream=function(){if(!this.isInitialized())return null;Ie?Y.partialFlush():Y.flush()},this.clearParsedCaptions=function(){ge.captions=[],ge.captionStreams={},ge.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;Y.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){ie=[],ne=null,he=null,ge?this.clearParsedCaptions():ge={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},ys=Ta;const{parseTfdt:mu}=ma,Dr=Ti,{getTimescaleFromMediaHeader:Ll}=Fa,{parseSamples:xa,getMdatTrafPairs:mc}=Xn;var Ba=function(){let S=9e4;this.init=function(Y){const ie=Dr(Y,["moov","trak","mdia","mdhd"])[0];ie&&(S=Ll(ie))},this.parseSegment=function(Y){const ie=[],ne=mc(Y);let he=0;return ne.forEach(function(ge){const Ie=ge.mdat,ke=ge.traf,Ne=Dr(ke,["tfdt"])[0],Ve=Dr(ke,["tfhd"])[0],et=Dr(ke,["trun"]);if(Ne&&(he=mu(Ne).baseMediaDecodeTime),et.length&&Ve){const jt=xa(et,he,Ve);let Rn=0;jt.forEach(function(Wt){const Mn="utf-8",yi=new TextDecoder(Mn),Lr=Ie.slice(Rn,Rn+Wt.size);if(Dr(Lr,["vtte"])[0]){Rn+=Wt.size;return}Dr(Lr,["vttc"]).forEach(function(Xo){const mr=Dr(Xo,["payl"])[0],ro=Dr(Xo,["sttg"])[0],Sa=Wt.pts/S,$a=(Wt.pts+Wt.duration)/S;let Zi,aa;if(mr)try{Zi=yi.decode(mr)}catch(Zr){console.error(Zr)}if(ro)try{aa=yi.decode(ro)}catch(Zr){console.error(Zr)}Wt.duration&&Zi&&ie.push({cueText:Zi,start:Sa,end:$a,settings:aa})}),Rn+=Wt.size})}}),ie}},Go=Gr,Fl=function(S){var Y=S[1]&31;return Y<<=8,Y|=S[2],Y},bo=function(S){return!!(S[1]&64)},Wo=function(S){var Y=0;return(S[3]&48)>>>4>1&&(Y+=S[4]+1),Y},Ps=function(S,Y){var ie=Fl(S);return ie===0?"pat":ie===Y?"pmt":Y?"pes":null},Eo=function(S){var Y=bo(S),ie=4+Wo(S);return Y&&(ie+=S[ie]+1),(S[ie+10]&31)<<8|S[ie+11]},To=function(S){var Y={},ie=bo(S),ne=4+Wo(S);if(ie&&(ne+=S[ne]+1),!!(S[ne+5]&1)){var he,ge,Ie;he=(S[ne+1]&15)<<8|S[ne+2],ge=3+he-4,Ie=(S[ne+10]&15)<<8|S[ne+11];for(var ke=12+Ie;ke<ge;){var Ne=ne+ke;Y[(S[Ne+1]&31)<<8|S[Ne+2]]=S[Ne],ke+=((S[Ne+3]&15)<<8|S[Ne+4])+5}return Y}},fl=function(S,Y){var ie=Fl(S),ne=Y[ie];switch(ne){case Go.H264_STREAM_TYPE:return"video";case Go.ADTS_STREAM_TYPE:return"audio";case Go.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},Ko=function(S){var Y=bo(S);if(!Y)return null;var ie=4+Wo(S);if(ie>=S.byteLength)return null;var ne=null,he;return he=S[ie+7],he&192&&(ne={},ne.pts=(S[ie+9]&14)<<27|(S[ie+10]&255)<<20|(S[ie+11]&254)<<12|(S[ie+12]&255)<<5|(S[ie+13]&254)>>>3,ne.pts*=4,ne.pts+=(S[ie+13]&6)>>>1,ne.dts=ne.pts,he&64&&(ne.dts=(S[ie+14]&14)<<27|(S[ie+15]&255)<<20|(S[ie+16]&254)<<12|(S[ie+17]&255)<<5|(S[ie+18]&254)>>>3,ne.dts*=4,ne.dts+=(S[ie+18]&6)>>>1)),ne},hs=function(S){switch(S){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},Is=function(S){for(var Y=4+Wo(S),ie=S.subarray(Y),ne=0,he=0,ge=!1,Ie;he<ie.byteLength-3;he++)if(ie[he+2]===1){ne=he+5;break}for(;ne<ie.byteLength;)switch(ie[ne]){case 0:if(ie[ne-1]!==0){ne+=2;break}else if(ie[ne-2]!==0){ne++;break}he+3!==ne-2&&(Ie=hs(ie[he+3]&31),Ie==="slice_layer_without_partitioning_rbsp_idr"&&(ge=!0));do ne++;while(ie[ne]!==1&&ne<ie.length);he=ne-2,ne+=3;break;case 1:if(ie[ne-1]!==0||ie[ne-2]!==0){ne+=3;break}Ie=hs(ie[he+3]&31),Ie==="slice_layer_without_partitioning_rbsp_idr"&&(ge=!0),he=ne-2,ne+=3;break;default:ne+=3;break}return ie=ie.subarray(he),ne-=he,he=0,ie&&ie.byteLength>3&&(Ie=hs(ie[he+3]&31),Ie==="slice_layer_without_partitioning_rbsp_idr"&&(ge=!0)),ge},ja={parseType:Ps,parsePat:Eo,parsePmt:To,parsePayloadUnitStartIndicator:bo,parsePesType:fl,parsePesTime:Ko,videoPacketContainsKeyFrame:Is},Ks=Gr,rs=ps.handleRollover,wi={};wi.ts=ja,wi.aac=En;var Ua=Xe.ONE_SECOND_IN_TS,Xr=188,Ds=71,gc=function(S,Y){for(var ie=0,ne=Xr,he,ge;ne<S.byteLength;){if(S[ie]===Ds&&S[ne]===Ds){switch(he=S.subarray(ie,ne),ge=wi.ts.parseType(he,Y.pid),ge){case"pat":Y.pid=wi.ts.parsePat(he);break;case"pmt":var Ie=wi.ts.parsePmt(he);Y.table=Y.table||{},Object.keys(Ie).forEach(function(ke){Y.table[ke]=Ie[ke]});break}ie+=Xr,ne+=Xr;continue}ie++,ne++}},Ur=function(S,Y,ie){for(var ne=0,he=Xr,ge,Ie,ke,Ne,Ve,et=!1;he<=S.byteLength;){if(S[ne]===Ds&&(S[he]===Ds||he===S.byteLength)){if(ge=S.subarray(ne,he),Ie=wi.ts.parseType(ge,Y.pid),Ie==="pes"&&(ke=wi.ts.parsePesType(ge,Y.table),Ne=wi.ts.parsePayloadUnitStartIndicator(ge),ke==="audio"&&Ne&&(Ve=wi.ts.parsePesTime(ge),Ve&&(Ve.type="audio",ie.audio.push(Ve),et=!0))),et)break;ne+=Xr,he+=Xr;continue}ne++,he++}for(he=S.byteLength,ne=he-Xr,et=!1;ne>=0;){if(S[ne]===Ds&&(S[he]===Ds||he===S.byteLength)){if(ge=S.subarray(ne,he),Ie=wi.ts.parseType(ge,Y.pid),Ie==="pes"&&(ke=wi.ts.parsePesType(ge,Y.table),Ne=wi.ts.parsePayloadUnitStartIndicator(ge),ke==="audio"&&Ne&&(Ve=wi.ts.parsePesTime(ge),Ve&&(Ve.type="audio",ie.audio.push(Ve),et=!0))),et)break;ne-=Xr,he-=Xr;continue}ne--,he--}},dr=function(S,Y,ie){for(var ne=0,he=Xr,ge,Ie,ke,Ne,Ve,et,jt,Rn,Wt=!1,Mn={data:[],size:0};he<S.byteLength;){if(S[ne]===Ds&&S[he]===Ds){switch(ge=S.subarray(ne,he),Ie=wi.ts.parseType(ge,Y.pid),Ie){case"pes":if(ke=wi.ts.parsePesType(ge,Y.table),Ne=wi.ts.parsePayloadUnitStartIndicator(ge),ke==="video"&&(Ne&&!Wt&&(Ve=wi.ts.parsePesTime(ge),Ve&&(Ve.type="video",ie.video.push(Ve),Wt=!0)),!ie.firstKeyFrame)){if(Ne&&Mn.size!==0){for(et=new Uint8Array(Mn.size),jt=0;Mn.data.length;)Rn=Mn.data.shift(),et.set(Rn,jt),jt+=Rn.byteLength;if(wi.ts.videoPacketContainsKeyFrame(et)){var yi=wi.ts.parsePesTime(et);yi?(ie.firstKeyFrame=yi,ie.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}Mn.size=0}Mn.data.push(ge),Mn.size+=ge.byteLength}break}if(Wt&&ie.firstKeyFrame)break;ne+=Xr,he+=Xr;continue}ne++,he++}for(he=S.byteLength,ne=he-Xr,Wt=!1;ne>=0;){if(S[ne]===Ds&&S[he]===Ds){if(ge=S.subarray(ne,he),Ie=wi.ts.parseType(ge,Y.pid),Ie==="pes"&&(ke=wi.ts.parsePesType(ge,Y.table),Ne=wi.ts.parsePayloadUnitStartIndicator(ge),ke==="video"&&Ne&&(Ve=wi.ts.parsePesTime(ge),Ve&&(Ve.type="video",ie.video.push(Ve),Wt=!0))),Wt)break;ne-=Xr,he-=Xr;continue}ne--,he--}},Ri=function(S,Y){if(S.audio&&S.audio.length){var ie=Y;(typeof ie>"u"||isNaN(ie))&&(ie=S.audio[0].dts),S.audio.forEach(function(ge){ge.dts=rs(ge.dts,ie),ge.pts=rs(ge.pts,ie),ge.dtsTime=ge.dts/Ua,ge.ptsTime=ge.pts/Ua})}if(S.video&&S.video.length){var ne=Y;if((typeof ne>"u"||isNaN(ne))&&(ne=S.video[0].dts),S.video.forEach(function(ge){ge.dts=rs(ge.dts,ne),ge.pts=rs(ge.pts,ne),ge.dtsTime=ge.dts/Ua,ge.ptsTime=ge.pts/Ua}),S.firstKeyFrame){var he=S.firstKeyFrame;he.dts=rs(he.dts,ne),he.pts=rs(he.pts,ne),he.dtsTime=he.dts/Ua,he.ptsTime=he.pts/Ua}}},Ha=function(S){for(var Y=!1,ie=0,ne=null,he=null,ge=0,Ie=0,ke;S.length-Ie>=3;){var Ne=wi.aac.parseType(S,Ie);switch(Ne){case"timed-metadata":if(S.length-Ie<10){Y=!0;break}if(ge=wi.aac.parseId3TagSize(S,Ie),ge>S.length){Y=!0;break}he===null&&(ke=S.subarray(Ie,Ie+ge),he=wi.aac.parseAacTimestamp(ke)),Ie+=ge;break;case"audio":if(S.length-Ie<7){Y=!0;break}if(ge=wi.aac.parseAdtsSize(S,Ie),ge>S.length){Y=!0;break}ne===null&&(ke=S.subarray(Ie,Ie+ge),ne=wi.aac.parseSampleRate(ke)),ie++,Ie+=ge;break;default:Ie++;break}if(Y)return null}if(ne===null||he===null)return null;var Ve=Ua/ne,et={audio:[{type:"audio",dts:he,pts:he},{type:"audio",dts:he+ie*1024*Ve,pts:he+ie*1024*Ve}]};return et},ks=function(S){var Y={pid:null,table:null},ie={};gc(S,Y);for(var ne in Y.table)if(Y.table.hasOwnProperty(ne)){var he=Y.table[ne];switch(he){case Ks.H264_STREAM_TYPE:ie.video=[],dr(S,Y,ie),ie.video.length===0&&delete ie.video;break;case Ks.ADTS_STREAM_TYPE:ie.audio=[],Ur(S,Y,ie),ie.audio.length===0&&delete ie.audio;break}}return ie},Vl=function(S,Y){var ie=wi.aac.isLikelyAacData(S),ne;return ie?ne=Ha(S):ne=ks(S),!ne||!ne.audio&&!ne.video?null:(Ri(ne,Y),ne)},qa={inspect:Vl,parseAudioPes_:Ur};const _c=function(S,Y){Y.on("data",function(ie){const ne=ie.initSegment;ie.initSegment={data:ne.buffer,byteOffset:ne.byteOffset,byteLength:ne.byteLength};const he=ie.data;ie.data=he.buffer,S.postMessage({action:"data",segment:ie,byteOffset:he.byteOffset,byteLength:he.byteLength},[ie.data])}),Y.on("done",function(ie){S.postMessage({action:"done"})}),Y.on("gopInfo",function(ie){S.postMessage({action:"gopInfo",gopInfo:ie})}),Y.on("videoSegmentTimingInfo",function(ie){const ne={start:{decode:Xe.videoTsToSeconds(ie.start.dts),presentation:Xe.videoTsToSeconds(ie.start.pts)},end:{decode:Xe.videoTsToSeconds(ie.end.dts),presentation:Xe.videoTsToSeconds(ie.end.pts)},baseMediaDecodeTime:Xe.videoTsToSeconds(ie.baseMediaDecodeTime)};ie.prependedContentDuration&&(ne.prependedContentDuration=Xe.videoTsToSeconds(ie.prependedContentDuration)),S.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:ne})}),Y.on("audioSegmentTimingInfo",function(ie){const ne={start:{decode:Xe.videoTsToSeconds(ie.start.dts),presentation:Xe.videoTsToSeconds(ie.start.pts)},end:{decode:Xe.videoTsToSeconds(ie.end.dts),presentation:Xe.videoTsToSeconds(ie.end.pts)},baseMediaDecodeTime:Xe.videoTsToSeconds(ie.baseMediaDecodeTime)};ie.prependedContentDuration&&(ne.prependedContentDuration=Xe.videoTsToSeconds(ie.prependedContentDuration)),S.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:ne})}),Y.on("id3Frame",function(ie){S.postMessage({action:"id3Frame",id3Frame:ie})}),Y.on("caption",function(ie){S.postMessage({action:"caption",caption:ie})}),Y.on("trackinfo",function(ie){S.postMessage({action:"trackinfo",trackInfo:ie})}),Y.on("audioTimingInfo",function(ie){S.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:Xe.videoTsToSeconds(ie.start),end:Xe.videoTsToSeconds(ie.end)}})}),Y.on("videoTimingInfo",function(ie){S.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:Xe.videoTsToSeconds(ie.start),end:Xe.videoTsToSeconds(ie.end)}})}),Y.on("log",function(ie){S.postMessage({action:"log",log:ie})})};class Bl{constructor(Y,ie){this.options=ie||{},this.self=Y,this.init()}init(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new Mt.Transmuxer(this.options),_c(this.self,this.transmuxer)}pushMp4Captions(Y){this.captionParser||(this.captionParser=new ys,this.captionParser.init());const ie=new Uint8Array(Y.data,Y.byteOffset,Y.byteLength),ne=this.captionParser.parse(ie,Y.trackIds,Y.timescales);this.self.postMessage({action:"mp4Captions",captions:ne&&ne.captions||[],logs:ne&&ne.logs||[],data:ie.buffer},[ie.buffer])}initMp4WebVttParser(Y){this.webVttParser||(this.webVttParser=new Ba);const ie=new Uint8Array(Y.data,Y.byteOffset,Y.byteLength);this.webVttParser.init(ie)}getMp4WebVttText(Y){this.webVttParser||(this.webVttParser=new Ba);const ie=new Uint8Array(Y.data,Y.byteOffset,Y.byteLength),ne=this.webVttParser.parseSegment(ie);this.self.postMessage({action:"getMp4WebVttText",mp4VttCues:ne||[],data:ie.buffer},[ie.buffer])}probeMp4StartTime({timescales:Y,data:ie}){const ne=Fa.startTime(Y,ie);this.self.postMessage({action:"probeMp4StartTime",startTime:ne,data:ie},[ie.buffer])}probeMp4Tracks({data:Y}){const ie=Fa.tracks(Y);this.self.postMessage({action:"probeMp4Tracks",tracks:ie,data:Y},[Y.buffer])}probeEmsgID3({data:Y,offset:ie}){const ne=Fa.getEmsgID3(Y,ie);this.self.postMessage({action:"probeEmsgID3",id3Frames:ne,emsgData:Y},[Y.buffer])}probeTs({data:Y,baseStartTime:ie}){const ne=typeof ie=="number"&&!isNaN(ie)?ie*Xe.ONE_SECOND_IN_TS:void 0,he=qa.inspect(Y,ne);let ge=null;he&&(ge={hasVideo:he.video&&he.video.length===2||!1,hasAudio:he.audio&&he.audio.length===2||!1},ge.hasVideo&&(ge.videoStart=he.video[0].ptsTime),ge.hasAudio&&(ge.audioStart=he.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:ge,data:Y},[Y.buffer])}clearAllMp4Captions(){this.captionParser&&this.captionParser.clearAllCaptions()}clearParsedMp4Captions(){this.captionParser&&this.captionParser.clearParsedCaptions()}push(Y){const ie=new Uint8Array(Y.data,Y.byteOffset,Y.byteLength);this.transmuxer.push(ie)}reset(){this.transmuxer.reset()}setTimestampOffset(Y){const ie=Y.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(Xe.secondsToVideoTs(ie)))}setAudioAppendStart(Y){this.transmuxer.setAudioAppendStart(Math.ceil(Xe.secondsToVideoTs(Y.appendStart)))}setRemux(Y){this.transmuxer.setRemux(Y.remux)}flush(Y){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})}endTimeline(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})}alignGopsWith(Y){this.transmuxer.alignGopsWith(Y.gopsToAlignWith.slice())}}self.onmessage=function(S){if(S.data.action==="init"&&S.data.options){this.messageHandlers=new Bl(self,S.data.options);return}this.messageHandlers||(this.messageHandlers=new Bl(self)),S.data&&S.data.action&&S.data.action!=="init"&&this.messageHandlers[S.data.action]&&this.messageHandlers[S.data.action](S.data)}}));var TransmuxWorker=factory(workerCode$1);const handleData_=(i,e,t)=>{const{type:n,initSegment:r,captions:s,captionStreams:a,metadata:l,videoFrameDtsTime:u,videoFramePtsTime:d}=i.data.segment;e.buffer.push({captions:s,captionStreams:a,metadata:l});const h=i.data.segment.boxes||{data:i.data.segment.data},p={type:n,data:new Uint8Array(h.data,h.data.byteOffset,h.data.byteLength),initSegment:new Uint8Array(r.data,r.byteOffset,r.byteLength)};typeof u<"u"&&(p.videoFrameDtsTime=u),typeof d<"u"&&(p.videoFramePtsTime=d),t(p)},handleDone_=({transmuxedData:i,callback:e})=>{i.buffer=[],e(i)},handleGopInfo_=(i,e)=>{e.gopInfo=i.data.gopInfo},processTransmux=i=>{const{transmuxer:e,bytes:t,audioAppendStart:n,gopsToAlignWith:r,remux:s,onData:a,onTrackInfo:l,onAudioTimingInfo:u,onVideoTimingInfo:d,onVideoSegmentTimingInfo:h,onAudioSegmentTimingInfo:p,onId3:m,onCaptions:g,onDone:v,onEndedTimeline:_,onTransmuxerLog:b,isEndOfTimeline:E,segment:A,triggerSegmentEventFn:z}=i,D={buffer:[]};let P=E;const G=I=>{e.currentTransmux===i&&(I.data.action==="data"&&handleData_(I,D,a),I.data.action==="trackinfo"&&l(I.data.trackInfo),I.data.action==="gopInfo"&&handleGopInfo_(I,D),I.data.action==="audioTimingInfo"&&u(I.data.audioTimingInfo),I.data.action==="videoTimingInfo"&&d(I.data.videoTimingInfo),I.data.action==="videoSegmentTimingInfo"&&h(I.data.videoSegmentTimingInfo),I.data.action==="audioSegmentTimingInfo"&&p(I.data.audioSegmentTimingInfo),I.data.action==="id3Frame"&&m([I.data.id3Frame],I.data.id3Frame.dispatchType),I.data.action==="caption"&&g(I.data.caption),I.data.action==="endedtimeline"&&(P=!1,_()),I.data.action==="log"&&b(I.data.log),I.data.type==="transmuxed"&&(P||(e.onmessage=null,handleDone_({transmuxedData:D,callback:v}),dequeue(e))))},R=()=>{const I={message:"Received an error message from the transmuxer worker",metadata:{errorType:videojs.Error.StreamingFailedToTransmuxSegment,segmentInfo:segmentInfoPayload({segment:A})}};v(null,I)};if(e.onmessage=G,e.onerror=R,n&&e.postMessage({action:"setAudioAppendStart",appendStart:n}),Array.isArray(r)&&e.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),typeof s<"u"&&e.postMessage({action:"setRemux",remux:s}),t.byteLength){const I=t instanceof ArrayBuffer?t:t.buffer,w=t instanceof ArrayBuffer?0:t.byteOffset;z({type:"segmenttransmuxingstart",segment:A}),e.postMessage({action:"push",data:I,byteOffset:w,byteLength:t.byteLength},[I])}E&&e.postMessage({action:"endTimeline"}),e.postMessage({action:"flush"})},dequeue=i=>{i.currentTransmux=null,i.transmuxQueue.length&&(i.currentTransmux=i.transmuxQueue.shift(),typeof i.currentTransmux=="function"?i.currentTransmux():processTransmux(i.currentTransmux))},processAction=(i,e)=>{i.postMessage({action:e}),dequeue(i)},enqueueAction=(i,e)=>{if(!e.currentTransmux){e.currentTransmux=i,processAction(e,i);return}e.transmuxQueue.push(processAction.bind(null,e,i))},reset=i=>{enqueueAction("reset",i)},endTimeline=i=>{enqueueAction("endTimeline",i)},transmux=i=>{if(!i.transmuxer.currentTransmux){i.transmuxer.currentTransmux=i,processTransmux(i);return}i.transmuxer.transmuxQueue.push(i)},createTransmuxer=i=>{const e=new TransmuxWorker;e.currentTransmux=null,e.transmuxQueue=[];const t=e.terminate;return e.terminate=()=>(e.currentTransmux=null,e.transmuxQueue.length=0,t.call(e)),e.postMessage({action:"init",options:i}),e};var segmentTransmuxer={reset,endTimeline,transmux,createTransmuxer};const workerCallback=function(i){const e=i.transmuxer,t=i.endAction||i.action,n=i.callback,r=_extends({},i,{endAction:null,transmuxer:null,callback:null}),s=a=>{a.data.action===t&&(e.removeEventListener("message",s),a.data.data&&(a.data.data=new Uint8Array(a.data.data,i.byteOffset||0,i.byteLength||a.data.data.byteLength),i.data&&(i.data=a.data.data)),n(a.data))};if(e.addEventListener("message",s),i.data){const a=i.data instanceof ArrayBuffer;r.byteOffset=a?0:i.data.byteOffset,r.byteLength=i.data.byteLength;const l=[a?i.data:i.data.buffer];e.postMessage(r,l)}else e.postMessage(r)},REQUEST_ERRORS={FAILURE:2,TIMEOUT:-101,ABORTED:-102},WEB_VTT_CODEC="wvtt",abortAll=i=>{i.forEach(e=>{e.abort()})},getRequestStats=i=>({bandwidth:i.bandwidth,bytesReceived:i.bytesReceived||0,roundTripTime:i.roundTripTime||0}),getProgressStats=i=>{const e=i.target,n={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-e.requestTime||0};return n.bytesReceived=i.loaded,n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3),n},handleErrors=(i,e)=>{const{requestType:t}=e,n=getStreamingNetworkErrorMetadata({requestType:t,request:e,error:i});return e.timedout?{status:e.status,message:"HLS request timed-out at URL: "+e.uri,code:REQUEST_ERRORS.TIMEOUT,xhr:e,metadata:n}:e.aborted?{status:e.status,message:"HLS request aborted at URL: "+e.uri,code:REQUEST_ERRORS.ABORTED,xhr:e,metadata:n}:i?{status:e.status,message:"HLS request errored at URL: "+e.uri,code:REQUEST_ERRORS.FAILURE,xhr:e,metadata:n}:e.responseType==="arraybuffer"&&e.response.byteLength===0?{status:e.status,message:"Empty HLS response at URL: "+e.uri,code:REQUEST_ERRORS.FAILURE,xhr:e,metadata:n}:null},handleKeyResponse=(i,e,t,n)=>(r,s)=>{const a=s.response,l=handleErrors(r,s);if(l)return t(l,i);if(a.byteLength!==16)return t({status:s.status,message:"Invalid HLS key at URL: "+s.uri,code:REQUEST_ERRORS.FAILURE,xhr:s},i);const u=new DataView(a),d=new Uint32Array([u.getUint32(0),u.getUint32(4),u.getUint32(8),u.getUint32(12)]);for(let p=0;p<e.length;p++)e[p].bytes=d;const h={uri:s.uri};return n({type:"segmentkeyloadcomplete",segment:i,keyInfo:h}),t(null,i)},initMp4Text=(i,e)=>{e===WEB_VTT_CODEC&&i.transmuxer.postMessage({action:"initMp4WebVttParser",data:i.map.bytes})},parseMp4TextSegment=(i,e,t)=>{e===WEB_VTT_CODEC&&workerCallback({action:"getMp4WebVttText",data:i.bytes,transmuxer:i.transmuxer,callback:({data:n,mp4VttCues:r})=>{i.bytes=n,t(null,i,{mp4VttCues:r})}})},parseInitSegment=(i,e)=>{const t=detectContainerForBytes(i.map.bytes);if(t!=="mp4"){const n=i.map.resolvedUri||i.map.uri,r=t||"unknown";return e({internal:!0,message:`Found unsupported ${r} container for initialization segment at URL: ${n}`,code:REQUEST_ERRORS.FAILURE,metadata:{mediaType:r}})}workerCallback({action:"probeMp4Tracks",data:i.map.bytes,transmuxer:i.transmuxer,callback:({tracks:n,data:r})=>(i.map.bytes=r,n.forEach(function(s){i.map.tracks=i.map.tracks||{},!i.map.tracks[s.type]&&(i.map.tracks[s.type]=s,typeof s.id=="number"&&s.timescale&&(i.map.timescales=i.map.timescales||{},i.map.timescales[s.id]=s.timescale),s.type==="text"&&initMp4Text(i,s.codec))}),e(null))})},handleInitSegmentResponse=({segment:i,finishProcessingFn:e,triggerSegmentEventFn:t})=>(n,r)=>{const s=handleErrors(n,r);if(s)return e(s,i);const a=new Uint8Array(r.response);if(t({type:"segmentloaded",segment:i}),i.map.key)return i.map.encryptedBytes=a,e(null,i);i.map.bytes=a,parseInitSegment(i,function(l){if(l)return l.xhr=r,l.status=r.status,e(l,i);e(null,i)})},handleSegmentResponse=({segment:i,finishProcessingFn:e,responseType:t,triggerSegmentEventFn:n})=>(r,s)=>{const a=handleErrors(r,s);if(a)return e(a,i);n({type:"segmentloaded",segment:i});const l=t==="arraybuffer"||!s.responseText?s.response:stringToArrayBuffer(s.responseText.substring(i.lastReachedChar||0));return i.stats=getRequestStats(s),i.key?i.encryptedBytes=new Uint8Array(l):i.bytes=new Uint8Array(l),e(null,i)},transmuxAndNotify=({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:h,doneFn:p,onTransmuxerLog:m,triggerSegmentEventFn:g})=>{const v=i.map&&i.map.tracks||{},_=!!(v.audio&&v.video);let b=n.bind(null,i,"audio","start");const E=n.bind(null,i,"audio","end");let A=n.bind(null,i,"video","start");const z=n.bind(null,i,"video","end"),D=()=>transmux({bytes:e,transmuxer:i.transmuxer,audioAppendStart:i.audioAppendStart,gopsToAlignWith:i.gopsToAlignWith,remux:_,onData:P=>{P.type=P.type==="combined"?"video":P.type,h(i,P)},onTrackInfo:P=>{t&&(_&&(P.isMuxed=!0),t(i,P))},onAudioTimingInfo:P=>{b&&typeof P.start<"u"&&(b(P.start),b=null),E&&typeof P.end<"u"&&E(P.end)},onVideoTimingInfo:P=>{A&&typeof P.start<"u"&&(A(P.start),A=null),z&&typeof P.end<"u"&&z(P.end)},onVideoSegmentTimingInfo:P=>{const G={pts:{start:P.start.presentation,end:P.end.presentation},dts:{start:P.start.decode,end:P.end.decode}};g({type:"segmenttransmuxingtiminginfoavailable",segment:i,timingInfo:G}),r(P)},onAudioSegmentTimingInfo:P=>{const G={pts:{start:P.start.pts,end:P.end.pts},dts:{start:P.start.dts,end:P.end.dts}};g({type:"segmenttransmuxingtiminginfoavailable",segment:i,timingInfo:G}),s(P)},onId3:(P,G)=>{a(i,P,G)},onCaptions:P=>{l(i,[P])},isEndOfTimeline:u,onEndedTimeline:()=>{d()},onTransmuxerLog:m,onDone:(P,G)=>{p&&(P.type=P.type==="combined"?"video":P.type,g({type:"segmenttransmuxingcomplete",segment:i}),p(G,i,P))},segment:i,triggerSegmentEventFn:g});workerCallback({action:"probeTs",transmuxer:i.transmuxer,data:e,baseStartTime:i.baseStartTime,callback:P=>{i.bytes=e=P.data;const G=P.result;G&&(t(i,{hasAudio:G.hasAudio,hasVideo:G.hasVideo,isMuxed:_}),t=null),D()}})},handleSegmentBytes=({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:h,doneFn:p,onTransmuxerLog:m,triggerSegmentEventFn:g})=>{let v=new Uint8Array(e);if(isLikelyFmp4MediaSegment(v)){i.isFmp4=!0;const{tracks:_}=i.map;if(_.text&&(!_.audio||!_.video)){h(i,{data:v,type:"text"}),parseMp4TextSegment(i,_.text.codec,p);return}const E={isFmp4:!0,hasVideo:!!_.video,hasAudio:!!_.audio};_.audio&&_.audio.codec&&_.audio.codec!=="enca"&&(E.audioCodec=_.audio.codec),_.video&&_.video.codec&&_.video.codec!=="encv"&&(E.videoCodec=_.video.codec),_.video&&_.audio&&(E.isMuxed=!0),t(i,E);const A=(z,D)=>{h(i,{data:v,type:E.hasAudio&&!E.isMuxed?"audio":"video"}),D&&D.length&&a(i,D),z&&z.length&&l(i,z),p(null,i,{})};workerCallback({action:"probeMp4StartTime",timescales:i.map.timescales,data:v,transmuxer:i.transmuxer,callback:({data:z,startTime:D})=>{e=z.buffer,i.bytes=v=z,E.hasAudio&&!E.isMuxed&&n(i,"audio","start",D),E.hasVideo&&n(i,"video","start",D),workerCallback({action:"probeEmsgID3",data:v,transmuxer:i.transmuxer,offset:D,callback:({emsgData:P,id3Frames:G})=>{if(e=P.buffer,i.bytes=v=P,!_.video||!P.byteLength||!i.transmuxer){A(void 0,G);return}workerCallback({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:i.transmuxer,data:v,timescales:i.map.timescales,trackIds:[_.video.id],callback:R=>{e=R.data.buffer,i.bytes=v=R.data,R.logs.forEach(function(I){m(merge(I,{stream:"mp4CaptionParser"}))}),A(R.captions,G)}})}})}});return}if(!i.transmuxer){p(null,i,{});return}if(typeof i.container>"u"&&(i.container=detectContainerForBytes(v)),i.container!=="ts"&&i.container!=="aac"){t(i,{hasAudio:!1,hasVideo:!1}),p(null,i,{});return}transmuxAndNotify({segment:i,bytes:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:h,doneFn:p,onTransmuxerLog:m,triggerSegmentEventFn:g})},decrypt=function({id:i,key:e,encryptedBytes:t,decryptionWorker:n,segment:r,doneFn:s},a){const l=d=>{if(d.data.source===i){n.removeEventListener("message",l);const h=d.data.decrypted;a(new Uint8Array(h.bytes,h.byteOffset,h.byteLength))}};n.onerror=()=>{const d="An error occurred in the decryption worker",h=segmentInfoPayload({segment:r}),p={message:d,metadata:{error:new Error(d),errorType:videojs.Error.StreamingFailedToDecryptSegment,segmentInfo:h,keyInfo:{uri:r.key.resolvedUri||r.map.key.resolvedUri}}};s(p,r)},n.addEventListener("message",l);let u;e.bytes.slice?u=e.bytes.slice():u=new Uint32Array(Array.prototype.slice.call(e.bytes)),n.postMessage(createTransferableMessage({source:i,encrypted:t,key:u,iv:e.iv}),[t.buffer,u.buffer])},decryptSegment=({decryptionWorker:i,segment:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:h,doneFn:p,onTransmuxerLog:m,triggerSegmentEventFn:g})=>{g({type:"segmentdecryptionstart"}),decrypt({id:e.requestId,key:e.key,encryptedBytes:e.encryptedBytes,decryptionWorker:i,segment:e,doneFn:p},v=>{e.bytes=v,g({type:"segmentdecryptioncomplete",segment:e}),handleSegmentBytes({segment:e,bytes:e.bytes,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:h,doneFn:p,onTransmuxerLog:m,triggerSegmentEventFn:g})})},waitForCompletion=({activeXhrs:i,decryptionWorker:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:h,doneFn:p,onTransmuxerLog:m,triggerSegmentEventFn:g})=>{let v=0,_=!1;return(b,E)=>{if(!_){if(b)return _=!0,abortAll(i),p(b,E);if(v+=1,v===i.length){const A=function(){if(E.encryptedBytes)return decryptSegment({decryptionWorker:e,segment:E,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:h,doneFn:p,onTransmuxerLog:m,triggerSegmentEventFn:g});handleSegmentBytes({segment:E,bytes:E.bytes,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:h,doneFn:p,onTransmuxerLog:m,triggerSegmentEventFn:g})};if(E.endOfAllRequests=Date.now(),E.map&&E.map.encryptedBytes&&!E.map.bytes)return g({type:"segmentdecryptionstart",segment:E}),decrypt({decryptionWorker:e,id:E.requestId+"-init",encryptedBytes:E.map.encryptedBytes,key:E.map.key,segment:E,doneFn:p},z=>{E.map.bytes=z,g({type:"segmentdecryptioncomplete",segment:E}),parseInitSegment(E,D=>{if(D)return abortAll(i),p(D,E);A()})});A()}}}},handleLoadEnd=({loadendState:i,abortFn:e})=>t=>{t.target.aborted&&e&&!i.calledAbortFn&&(e(),i.calledAbortFn=!0)},handleProgress=({segment:i,progressFn:e,trackInfoFn:t,timingInfoFn:n,videoSegmentTimingInfoFn:r,audioSegmentTimingInfoFn:s,id3Fn:a,captionsFn:l,isEndOfTimeline:u,endedTimelineFn:d,dataFn:h})=>p=>{if(!p.target.aborted)return i.stats=merge(i.stats,getProgressStats(p)),!i.stats.firstBytesReceivedAt&&i.stats.bytesReceived&&(i.stats.firstBytesReceivedAt=Date.now()),e(p,i)},mediaSegmentRequest=({xhr:i,xhrOptions:e,decryptionWorker:t,segment:n,abortFn:r,progressFn:s,trackInfoFn:a,timingInfoFn:l,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:d,id3Fn:h,captionsFn:p,isEndOfTimeline:m,endedTimelineFn:g,dataFn:v,doneFn:_,onTransmuxerLog:b,triggerSegmentEventFn:E})=>{const A=[],z=waitForCompletion({activeXhrs:A,decryptionWorker:t,trackInfoFn:a,timingInfoFn:l,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:d,id3Fn:h,captionsFn:p,isEndOfTimeline:m,endedTimelineFn:g,dataFn:v,doneFn:_,onTransmuxerLog:b,triggerSegmentEventFn:E});if(n.key&&!n.key.bytes){const I=[n.key];n.map&&!n.map.bytes&&n.map.key&&n.map.key.resolvedUri===n.key.resolvedUri&&I.push(n.map.key);const w=merge(e,{uri:n.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),H=handleKeyResponse(n,I,z,E),V={uri:n.key.resolvedUri};E({type:"segmentkeyloadstart",segment:n,keyInfo:V});const te=i(w,H);A.push(te)}if(n.map&&!n.map.bytes){if(n.map.key&&(!n.key||n.key.resolvedUri!==n.map.key.resolvedUri)){const te=merge(e,{uri:n.map.key.resolvedUri,responseType:"arraybuffer",requestType:"segment-key"}),ae=handleKeyResponse(n,[n.map.key],z,E),be={uri:n.map.key.resolvedUri};E({type:"segmentkeyloadstart",segment:n,keyInfo:be});const _e=i(te,ae);A.push(_e)}const w=merge(e,{uri:n.map.resolvedUri,responseType:"arraybuffer",headers:segmentXhrHeaders(n.map),requestType:"segment-media-initialization"}),H=handleInitSegmentResponse({segment:n,finishProcessingFn:z,triggerSegmentEventFn:E});E({type:"segmentloadstart",segment:n});const V=i(w,H);A.push(V)}const D=merge(e,{uri:n.part&&n.part.resolvedUri||n.resolvedUri,responseType:"arraybuffer",headers:segmentXhrHeaders(n),requestType:"segment"}),P=handleSegmentResponse({segment:n,finishProcessingFn:z,responseType:D.responseType,triggerSegmentEventFn:E});E({type:"segmentloadstart",segment:n});const G=i(D,P);G.addEventListener("progress",handleProgress({segment:n,progressFn:s,trackInfoFn:a,timingInfoFn:l,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:d,id3Fn:h,captionsFn:p,isEndOfTimeline:m,endedTimelineFn:g,dataFn:v})),A.push(G);const R={};return A.forEach(I=>{I.addEventListener("loadend",handleLoadEnd({loadendState:R,abortFn:r}))}),()=>abortAll(A)},logFn=logger("PlaylistSelector"),representationToString=function(i){if(!i||!i.playlist)return;const e=i.playlist;return JSON.stringify({id:e.id,bandwidth:i.bandwidth,width:i.width,height:i.height,codecs:e.attributes&&e.attributes.CODECS||""})},safeGetComputedStyle=function(i,e){if(!i)return"";const t=window$1.getComputedStyle(i);return t?t[e]:""},stableSort=function(i,e){const t=i.slice();i.sort(function(n,r){const s=e(n,r);return s===0?t.indexOf(n)-t.indexOf(r):s})},comparePlaylistBandwidth=function(i,e){let t,n;return i.attributes.BANDWIDTH&&(t=i.attributes.BANDWIDTH),t=t||window$1.Number.MAX_VALUE,e.attributes.BANDWIDTH&&(n=e.attributes.BANDWIDTH),n=n||window$1.Number.MAX_VALUE,t-n},comparePlaylistResolution=function(i,e){let t,n;return i.attributes.RESOLUTION&&i.attributes.RESOLUTION.width&&(t=i.attributes.RESOLUTION.width),t=t||window$1.Number.MAX_VALUE,e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(n=e.attributes.RESOLUTION.width),n=n||window$1.Number.MAX_VALUE,t===n&&i.attributes.BANDWIDTH&&e.attributes.BANDWIDTH?i.attributes.BANDWIDTH-e.attributes.BANDWIDTH:t-n};let simpleSelector=function(i){const{main:e,bandwidth:t,playerWidth:n,playerHeight:r,playerObjectFit:s,limitRenditionByPlayerDimensions:a,playlistController:l}=i;if(!e)return;const u={bandwidth:t,width:n,height:r,limitRenditionByPlayerDimensions:a};let d=e.playlists;Playlist.isAudioOnly(e)&&(d=l.getAudioTrackPlaylists_(),u.audioOnly=!0);let h=d.map(R=>{let I;const w=R.attributes&&R.attributes.RESOLUTION&&R.attributes.RESOLUTION.width,H=R.attributes&&R.attributes.RESOLUTION&&R.attributes.RESOLUTION.height;return I=R.attributes&&R.attributes.BANDWIDTH,I=I||window$1.Number.MAX_VALUE,{bandwidth:I,width:w,height:H,playlist:R}});stableSort(h,(R,I)=>R.bandwidth-I.bandwidth),h=h.filter(R=>!Playlist.isIncompatible(R.playlist));let p=h.filter(R=>Playlist.isEnabled(R.playlist));p.length||(p=h.filter(R=>!Playlist.isDisabled(R.playlist)));const m=p.filter(R=>R.bandwidth*Config.BANDWIDTH_VARIANCE<t);let g=m[m.length-1];const v=m.filter(R=>R.bandwidth===g.bandwidth)[0];if(a===!1){const R=v||p[0]||h[0];if(R&&R.playlist){let I="sortedPlaylistReps";return v&&(I="bandwidthBestRep"),p[0]&&(I="enabledPlaylistReps"),logFn(`choosing ${representationToString(R)} using ${I} with options`,u),R.playlist}return logFn("could not choose a playlist with options",u),null}const _=m.filter(R=>R.width&&R.height);stableSort(_,(R,I)=>R.width-I.width);const b=_.filter(R=>R.width===n&&R.height===r);g=b[b.length-1];const E=b.filter(R=>R.bandwidth===g.bandwidth)[0];let A,z,D;E||(A=_.filter(R=>s==="cover"?R.width>n&&R.height>r:R.width>n||R.height>r),z=A.filter(R=>R.width===A[0].width&&R.height===A[0].height),g=z[z.length-1],D=z.filter(R=>R.bandwidth===g.bandwidth)[0]);let P;if(l.leastPixelDiffSelector){const R=_.map(I=>(I.pixelDiff=Math.abs(I.width-n)+Math.abs(I.height-r),I));stableSort(R,(I,w)=>I.pixelDiff===w.pixelDiff?w.bandwidth-I.bandwidth:I.pixelDiff-w.pixelDiff),P=R[0]}const G=P||D||E||v||p[0]||h[0];if(G&&G.playlist){let R="sortedPlaylistReps";return P?R="leastPixelDiffRep":D?R="resolutionPlusOneRep":E?R="resolutionBestRep":v?R="bandwidthBestRep":p[0]&&(R="enabledPlaylistReps"),logFn(`choosing ${representationToString(G)} using ${R} with options`,u),G.playlist}return logFn("could not choose a playlist with options",u),null};const lastBandwidthSelector=function(){let i=this.useDevicePixelRatio&&window$1.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(i=this.customPixelRatio),simpleSelector({main:this.playlists.main,bandwidth:this.systemBandwidth,playerWidth:parseInt(safeGetComputedStyle(this.tech_.el(),"width"),10)*i,playerHeight:parseInt(safeGetComputedStyle(this.tech_.el(),"height"),10)*i,playerObjectFit:this.usePlayerObjectFit?safeGetComputedStyle(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})},movingAverageBandwidthSelector=function(i){let e=-1,t=-1;if(i<0||i>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){let n=this.useDevicePixelRatio&&window$1.devicePixelRatio||1;return isNaN(this.customPixelRatio)||(n=this.customPixelRatio),e<0&&(e=this.systemBandwidth,t=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==t&&(e=i*this.systemBandwidth+(1-i)*e,t=this.systemBandwidth),simpleSelector({main:this.playlists.main,bandwidth:e,playerWidth:parseInt(safeGetComputedStyle(this.tech_.el(),"width"),10)*n,playerHeight:parseInt(safeGetComputedStyle(this.tech_.el(),"height"),10)*n,playerObjectFit:this.usePlayerObjectFit?safeGetComputedStyle(this.tech_.el(),"objectFit"):"",limitRenditionByPlayerDimensions:this.limitRenditionByPlayerDimensions,playlistController:this.playlistController_})}},minRebufferMaxBandwidthSelector=function(i){const{main:e,currentTime:t,bandwidth:n,duration:r,segmentDuration:s,timeUntilRebuffer:a,currentTimeline:l,syncController:u}=i,d=e.playlists.filter(v=>!Playlist.isIncompatible(v));let h=d.filter(Playlist.isEnabled);h.length||(h=d.filter(v=>!Playlist.isDisabled(v)));const m=h.filter(Playlist.hasAttribute.bind(null,"BANDWIDTH")).map(v=>{const b=u.getSyncPoint(v,r,l,t)?1:2,A=Playlist.estimateSegmentRequestTime(s,n,v)*b-a;return{playlist:v,rebufferingImpact:A}}),g=m.filter(v=>v.rebufferingImpact<=0);return stableSort(g,(v,_)=>comparePlaylistBandwidth(_.playlist,v.playlist)),g.length?g[0]:(stableSort(m,(v,_)=>v.rebufferingImpact-_.rebufferingImpact),m[0]||null)},lowestBitrateCompatibleVariantSelector=function(){const i=this.playlists.main.playlists.filter(Playlist.isEnabled);return stableSort(i,(t,n)=>comparePlaylistBandwidth(t,n)),i.filter(t=>!!codecsForPlaylist(this.playlists.main,t).video)[0]||null},concatSegments=i=>{let e=0,t;return i.bytes&&(t=new Uint8Array(i.bytes),i.segments.forEach(n=>{t.set(n,e),e+=n.byteLength})),t};function compactSegmentUrlDescription(i){try{return new URL(i).pathname.split("/").slice(-2).join("/")}catch{return""}}const createCaptionsTrackIfNotExists=function(i,e,t){if(!i[t]){e.trigger({type:"usage",name:"vhs-608"});let n=t;/^cc708_/.test(t)&&(n="SERVICE"+t.split("_")[1]);const r=e.textTracks().getTrackById(n);if(r)i[t]=r;else{const s=e.options_.vhs&&e.options_.vhs.captionServices||{};let a=t,l=t,u=!1;const d=s[n];d&&(a=d.label,l=d.language,u=d.default),i[t]=e.addRemoteTextTrack({kind:"captions",id:n,default:u,label:a,language:l},!1).track}}},addCaptionData=function({inbandTextTracks:i,captionArray:e,timestampOffset:t}){if(!e)return;const n=window$1.WebKitDataCue||window$1.VTTCue;e.forEach(r=>{const s=r.stream;r.content?r.content.forEach(a=>{const l=new n(r.startTime+t,r.endTime+t,a.text);l.line=a.line,l.align="left",l.position=a.position,l.positionAlign="line-left",i[s].addCue(l)}):i[s].addCue(new n(r.startTime+t,r.endTime+t,r.text))})},deprecateOldCue=function(i){Object.defineProperties(i.frame,{id:{get(){return videojs.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),i.value.key}},value:{get(){return videojs.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),i.value.data}},privateData:{get(){return videojs.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),i.value.data}}})},addMetadata=({inbandTextTracks:i,metadataArray:e,timestampOffset:t,videoDuration:n})=>{if(!e)return;const r=window$1.WebKitDataCue||window$1.VTTCue,s=i.metadataTrack_;if(!s||(e.forEach(h=>{const p=h.cueTime+t;typeof p!="number"||window$1.isNaN(p)||p<0||!(p<1/0)||!h.frames||!h.frames.length||h.frames.forEach(m=>{const g=new r(p,p,m.value||m.url||m.data||"");g.frame=m,g.value=m,deprecateOldCue(g),s.addCue(g)})}),!s.cues||!s.cues.length))return;const a=s.cues,l=[];for(let h=0;h<a.length;h++)a[h]&&l.push(a[h]);const u=l.reduce((h,p)=>{const m=h[p.startTime]||[];return m.push(p),h[p.startTime]=m,h},{}),d=Object.keys(u).sort((h,p)=>Number(h)-Number(p));d.forEach((h,p)=>{const m=u[h],g=isFinite(n)?n:h,v=Number(d[p+1])||g;m.forEach(_=>{_.endTime=v})})},dateRangeAttr={id:"ID",class:"CLASS",startDate:"START-DATE",duration:"DURATION",endDate:"END-DATE",endOnNext:"END-ON-NEXT",plannedDuration:"PLANNED-DURATION",scte35Out:"SCTE35-OUT",scte35In:"SCTE35-IN"},dateRangeKeysToOmit=new Set(["id","class","startDate","duration","endDate","endOnNext","startTime","endTime","processDateRange"]),addDateRangeMetadata=({inbandTextTracks:i,dateRanges:e})=>{const t=i.metadataTrack_;if(!t)return;const n=window$1.WebKitDataCue||window$1.VTTCue;e.forEach(r=>{for(const s of Object.keys(r)){if(dateRangeKeysToOmit.has(s))continue;const a=new n(r.startTime,r.endTime,"");a.id=r.id,a.type="com.apple.quicktime.HLS",a.value={key:dateRangeAttr[s],data:r[s]},(s==="scte35Out"||s==="scte35In")&&(a.value.data=new Uint8Array(a.value.data.match(/[\da-f]{2}/gi)).buffer),t.addCue(a)}r.processDateRange()})},createMetadataTrackIfNotExists=(i,e,t)=>{i.metadataTrack_||(i.metadataTrack_=t.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,videojs.browser.IS_ANY_SAFARI||(i.metadataTrack_.inBandMetadataTrackDispatchType=e))},removeCuesFromTrack=function(i,e,t){let n,r;if(t&&t.cues)for(n=t.cues.length;n--;)r=t.cues[n],r.startTime>=i&&r.endTime<=e&&t.removeCue(r)},removeDuplicateCuesFromTrack=function(i){const e=i.cues;if(!e)return;const t={};for(let n=e.length-1;n>=0;n--){const r=e[n],s=`${r.startTime}-${r.endTime}-${r.text}`;t[s]?i.removeCue(r):t[s]=r}},gopsSafeToAlignWith=(i,e,t)=>{if(typeof e>"u"||e===null||!i.length)return[];const n=Math.ceil((e-t+3)*clockExports.ONE_SECOND_IN_TS);let r;for(r=0;r<i.length&&!(i[r].pts>n);r++);return i.slice(r)},updateGopBuffer=(i,e,t)=>{if(!e.length)return i;if(t)return e.slice();const n=e[0].pts;let r=0;for(r;r<i.length&&!(i[r].pts>=n);r++);return i.slice(0,r).concat(e)},removeGopBuffer=(i,e,t,n)=>{const r=Math.ceil((e-n)*clockExports.ONE_SECOND_IN_TS),s=Math.ceil((t-n)*clockExports.ONE_SECOND_IN_TS),a=i.slice();let l=i.length;for(;l--&&!(i[l].pts<=s););if(l===-1)return a;let u=l+1;for(;u--&&!(i[u].pts<=r););return u=Math.max(u,0),a.splice(u,l-u+1),a},shallowEqual=function(i,e){if(!i&&!e||!i&&e||i&&!e)return!1;if(i===e)return!0;const t=Object.keys(i).sort(),n=Object.keys(e).sort();if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++){const s=t[r];if(s!==n[r]||i[s]!==e[s])return!1}return!0},getSyncSegmentCandidate=function(i,e,t){e=e||[];const n=[];let r=0;for(let s=0;s<e.length;s++){const a=e[s];if(i===a.timeline&&(n.push(s),r+=a.duration,r>t))return s}return n.length===0?0:n[n.length-1]},MIN_BACK_BUFFER=1,CHECK_BUFFER_DELAY=500,finite=i=>typeof i=="number"&&isFinite(i),MIN_SEGMENT_DURATION_TO_SAVE_STATS=1/60,illegalMediaSwitch=(i,e,t)=>i!=="main"||!e||!t?null:!t.hasAudio&&!t.hasVideo?"Neither audio nor video found in segment.":e.hasVideo&&!t.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!e.hasVideo&&t.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null,safeBackBufferTrimTime=(i,e,t)=>{let n=e-Config.BACK_BUFFER_LENGTH;i.length&&(n=Math.max(n,i.start(0)));const r=e-t;return Math.min(r,n)},segmentInfoString=i=>{const{startOfSegment:e,duration:t,segment:n,part:r,playlist:{mediaSequence:s,id:a,segments:l=[]},mediaIndex:u,partIndex:d,timeline:h}=i,p=l.length-1;let m="mediaIndex/partIndex increment";i.getMediaInfoForTime?m=`getMediaInfoForTime (${i.getMediaInfoForTime})`:i.isSyncRequest&&(m="getSyncSegmentCandidate (isSyncRequest)"),i.independent&&(m+=` with independent ${i.independent}`);const g=typeof d=="number",v=i.segment.uri?"segment":"pre-segment",_=g?getKnownPartCount({preloadSegment:n})-1:0;return`${v} [${s+u}/${s+p}]`+(g?` part [${d}/${_}]`:"")+` segment start/end [${n.start} => ${n.end}]`+(g?` part start/end [${r.start} => ${r.end}]`:"")+` startOfSegment [${e}] duration [${t}] timeline [${h}] selected by [${m}] playlist [${a}]`},timingInfoPropertyForMedia=i=>`${i}TimingInfo`,timestampOffsetForSegment=({segmentTimeline:i,currentTimeline:e,startOfSegment:t,buffered:n,overrideCheck:r})=>!r&&i===e?null:i<e?t:n.length?n.end(n.length-1):t,shouldWaitForTimelineChange=({timelineChangeController:i,currentTimeline:e,segmentTimeline:t,loaderType:n,audioDisabled:r})=>{if(e===t)return!1;if(n==="audio"){const s=i.lastTimelineChange({type:"main"});return!s||s.to!==t}if(n==="main"&&r){const s=i.pendingTimelineChange({type:"audio"});return!(s&&s.to===t)}return!1},shouldFixBadTimelineChanges=i=>{if(!i)return!1;const e=i.pendingTimelineChange({type:"audio"}),t=i.pendingTimelineChange({type:"main"}),n=e&&t,r=n&&e.to!==t.to;return!!(n&&e.from!==-1&&t.from!==-1&&r)},isAudioTimelineBehind=i=>{const e=i.timelineChangeController_.pendingTimelineChange({type:"audio"}),t=i.timelineChangeController_.pendingTimelineChange({type:"main"});return e&&t&&e.to<t.to},checkAndFixTimelines=i=>{const e=i.pendingSegment_;if(!e)return;if(shouldWaitForTimelineChange({timelineChangeController:i.timelineChangeController_,currentTimeline:i.currentTimeline_,segmentTimeline:e.timeline,loaderType:i.loaderType_,audioDisabled:i.audioDisabled_})&&shouldFixBadTimelineChanges(i.timelineChangeController_)){if(isAudioTimelineBehind(i)){i.timelineChangeController_.trigger("audioTimelineBehind");return}i.timelineChangeController_.trigger("fixBadTimelineChange")}},mediaDuration=i=>{let e=0;return["video","audio"].forEach(function(t){const n=i[`${t}TimingInfo`];if(!n)return;const{start:r,end:s}=n;let a;typeof r=="bigint"||typeof s=="bigint"?a=window$1.BigInt(s)-window$1.BigInt(r):typeof r=="number"&&typeof s=="number"&&(a=s-r),typeof a<"u"&&a>e&&(e=a)}),typeof e=="bigint"&&e<Number.MAX_SAFE_INTEGER&&(e=Number(e)),e},segmentTooLong=({segmentDuration:i,maxDuration:e})=>i?Math.round(i)>e+TIME_FUDGE_FACTOR:!1,getTroublesomeSegmentDurationMessage=(i,e)=>{if(e!=="hls")return null;const t=mediaDuration({audioTimingInfo:i.audioTimingInfo,videoTimingInfo:i.videoTimingInfo});if(!t)return null;const n=i.playlist.targetDuration,r=segmentTooLong({segmentDuration:t,maxDuration:n*2}),s=segmentTooLong({segmentDuration:t,maxDuration:n}),a=`Segment with index ${i.mediaIndex} from playlist ${i.playlist.id} has a duration of ${t} when the reported duration is ${i.duration} and the target duration is ${n}. For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1`;return r||s?{severity:r?"warn":"info",message:a}:null},segmentInfoPayload=({type:i,segment:e})=>{if(!e)return;const t=!!(e.key||e.map&&e.map.ke),n=!!(e.map&&!e.map.bytes),r=e.startOfSegment===void 0?e.start:e.startOfSegment;return{type:i||e.type,uri:e.resolvedUri||e.uri,start:r,duration:e.duration,isEncrypted:t,isMediaInitialization:n}};class SegmentLoader extends videojs.EventTarget{constructor(e,t={}){if(super(),!e)throw new TypeError("Initialization settings are required");if(typeof e.currentTime!="function")throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");this.bandwidth=e.bandwidth,this.throughput={rate:0,count:0},this.roundTrip=NaN,this.resetStats_(),this.mediaIndex=null,this.partIndex=null,this.hasPlayed_=e.hasPlayed,this.currentTime_=e.currentTime,this.seekable_=e.seekable,this.seeking_=e.seeking,this.duration_=e.duration,this.mediaSource_=e.mediaSource,this.vhs_=e.vhs,this.loaderType_=e.loaderType,this.currentMediaInfo_=void 0,this.startingMediaInfo_=void 0,this.segmentMetadataTrack_=e.segmentMetadataTrack,this.goalBufferLength_=e.goalBufferLength,this.sourceType_=e.sourceType,this.sourceUpdater_=e.sourceUpdater,this.inbandTextTracks_=e.inbandTextTracks,this.state_="INIT",this.timelineChangeController_=e.timelineChangeController,this.shouldSaveSegmentTimingInfo_=!0,this.parse708captions_=e.parse708captions,this.useDtsForTimestampOffset_=e.useDtsForTimestampOffset,this.captionServices_=e.captionServices,this.exactManifestTimings=e.exactManifestTimings,this.addMetadataToTextTrack=e.addMetadataToTextTrack,this.checkBufferTimeout_=null,this.error_=void 0,this.currentTimeline_=-1,this.shouldForceTimestampOffsetAfterResync_=!1,this.pendingSegment_=null,this.xhrOptions_=null,this.pendingSegments_=[],this.audioDisabled_=!1,this.isPendingTimestampOffset_=!1,this.gopBuffer_=[],this.timeMapping_=0,this.safeAppend_=!1,this.appendInitSegment_={audio:!0,video:!0},this.playlistOfLastInitSegment_={audio:null,video:null},this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_={id3:[],caption:[]},this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=null,this.activeInitSegmentId_=null,this.initSegments_={},this.cacheEncryptionKeys_=e.cacheEncryptionKeys,this.keyCache_={},this.decrypter_=e.decrypter,this.syncController_=e.syncController,this.syncPoint_={segmentIndex:0,time:0},this.transmuxer_=this.createTransmuxer_(),this.triggerSyncInfoUpdate_=()=>this.trigger("syncinfoupdate"),this.syncController_.on("syncinfoupdate",this.triggerSyncInfoUpdate_),this.mediaSource_.addEventListener("sourceopen",()=>{this.isEndOfStream_()||(this.ended_=!1)}),this.fetchAtBuffer_=!1,this.logger_=logger(`SegmentLoader[${this.loaderType_}]`),Object.defineProperty(this,"state",{get(){return this.state_},set(n){n!==this.state_&&(this.logger_(`${this.state_} -> ${n}`),this.state_=n,this.trigger("statechange"))}}),this.sourceUpdater_.on("ready",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():checkAndFixTimelines(this)}),this.sourceUpdater_.on("codecschange",n=>{this.trigger(_extends({type:"codecschange"},n))}),this.loaderType_==="main"&&this.timelineChangeController_.on("pendingtimelinechange",()=>{this.hasEnoughInfoToAppend_()?this.processCallQueue_():checkAndFixTimelines(this)}),this.loaderType_==="audio"&&this.timelineChangeController_.on("timelinechange",n=>{this.trigger(_extends({type:"timelinechange"},n)),this.hasEnoughInfoToLoad_()?this.processLoadQueue_():checkAndFixTimelines(this),this.hasEnoughInfoToAppend_()?this.processCallQueue_():checkAndFixTimelines(this)})}get mediaSequenceSync_(){return this.syncController_.getMediaSequenceSync(this.loaderType_)}createTransmuxer_(){return segmentTransmuxer.createTransmuxer({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})}resetStats_(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0}dispose(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&window$1.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()}setAudio(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())}abort(){if(this.state!=="WAITING"){this.pendingSegment_&&(this.pendingSegment_=null),this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_);return}this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()}abort_(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,window$1.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null}checkForAbort_(e){return this.state==="APPENDING"&&!this.pendingSegment_?(this.state="READY",!0):!this.pendingSegment_||this.pendingSegment_.requestId!==e}error(e){return typeof e<"u"&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_}endOfStream(){this.ended_=!0,this.transmuxer_&&segmentTransmuxer.reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")}buffered_(){const e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return createTimeRanges();if(this.loaderType_==="main"){const{hasAudio:t,hasVideo:n,isMuxed:r}=e;if(n&&t&&!this.audioDisabled_&&!r)return this.sourceUpdater_.buffered();if(n)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()}initSegmentForMap(e,t=!1){if(!e)return null;const n=initSegmentId(e);let r=this.initSegments_[n];return t&&!r&&e.bytes&&(this.initSegments_[n]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),r||e}segmentKey(e,t=!1){if(!e)return null;const n=segmentKeyId(e);let r=this.keyCache_[n];this.cacheEncryptionKeys_&&t&&!r&&e.bytes&&(this.keyCache_[n]=r={resolvedUri:e.resolvedUri,bytes:e.bytes});const s={resolvedUri:(r||e).resolvedUri};return r&&(s.bytes=r.bytes),s}couldBeginLoading_(){return this.playlist_&&!this.paused()}load(){if(this.monitorBuffer_(),!!this.playlist_){if(this.state==="INIT"&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||this.state!=="READY"&&this.state!=="INIT"||(this.state="READY")}}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}playlist(e,t={}){if(!e||this.playlist_&&this.playlist_.endList&&e.endList&&this.playlist_.uri===e.uri)return;const n=this.playlist_,r=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,this.state==="INIT"&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},this.loaderType_==="main"&&this.syncController_.setDateTimeMappingForStart(e));let s=null;if(n&&(n.id?s=n.id:n.uri&&(s=n.uri)),this.logger_(`playlist update [${s} => ${e.id||e.uri}]`),this.mediaSequenceSync_&&(this.mediaSequenceSync_.update(e,this.currentTime_()),this.logger_(`Playlist update:
currentTime: ${this.currentTime_()}
bufferedEnd: ${lastBufferedEnd(this.buffered_())}
`,this.mediaSequenceSync_.diagnostics)),this.trigger("syncinfoupdate"),this.state==="INIT"&&this.couldBeginLoading_())return this.init_();if(!n||n.uri!==e.uri){this.mediaIndex!==null&&(!e.endList&&typeof e.partTargetDuration=="number"?this.resetLoader():this.resyncLoader()),this.currentMediaInfo_=void 0,this.trigger("playlistupdate");return}const a=e.mediaSequence-n.mediaSequence;if(this.logger_(`live window shift [${a}]`),this.mediaIndex!==null)if(this.mediaIndex-=a,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{const l=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!l.parts||!l.parts.length||!l.parts[this.partIndex])){const u=this.mediaIndex;this.logger_(`currently processing part (index ${this.partIndex}) no longer exists.`),this.resetLoader(),this.mediaIndex=u}}r&&(r.mediaIndex-=a,r.mediaIndex<0?(r.mediaIndex=null,r.partIndex=null):(r.mediaIndex>=0&&(r.segment=e.segments[r.mediaIndex]),r.partIndex>=0&&r.segment.parts&&(r.part=r.segment.parts[r.partIndex]))),this.syncController_.saveExpiredSegmentInfo(n,e)}pause(){this.checkBufferTimeout_&&(window$1.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}paused(){return this.checkBufferTimeout_===null}resetEverything(e){this.ended_=!1,this.activeInitSegmentId_=null,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))}resetLoader(){this.fetchAtBuffer_=!1,this.mediaSequenceSync_&&this.mediaSequenceSync_.resetAppendedStatus(),this.resyncLoader()}resyncLoader(){this.transmuxer_&&segmentTransmuxer.reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1;const e=this.currentMediaInfo_&&this.currentMediaInfo_.isFmp4;this.sourceType_==="hls"&&!e&&(this.shouldForceTimestampOffsetAfterResync_=!0),this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}remove(e,t,n=()=>{},r=!1){if(t===1/0&&(t=this.duration_()),t<=e){this.logger_("skipping remove because end ${end} is <= start ${start}");return}if(!this.sourceUpdater_||!this.getMediaInfo_()){this.logger_("skipping remove because no source updater or starting media info");return}let s=1;const a=()=>{s--,s===0&&n()};(r||!this.audioDisabled_)&&(s++,this.sourceUpdater_.removeAudio(e,t,a)),(r||this.loaderType_==="main")&&(this.gopBuffer_=removeGopBuffer(this.gopBuffer_,e,t,this.timeMapping_),s++,this.sourceUpdater_.removeVideo(e,t,a));for(const l in this.inbandTextTracks_)removeCuesFromTrack(e,t,this.inbandTextTracks_[l]);removeCuesFromTrack(e,t,this.segmentMetadataTrack_),a()}monitorBuffer_(){this.checkBufferTimeout_&&window$1.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=window$1.setTimeout(this.monitorBufferTick_.bind(this),1)}monitorBufferTick_(){this.state==="READY"&&this.fillBuffer_(),this.checkBufferTimeout_&&window$1.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=window$1.setTimeout(this.monitorBufferTick_.bind(this),CHECK_BUFFER_DELAY)}fillBuffer_(){if(this.sourceUpdater_.updating())return;const e=this.chooseNextRequest_();if(!e)return;const t={segmentInfo:segmentInfoPayload({type:this.loaderType_,segment:e})};this.trigger({type:"segmentselected",metadata:t}),typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e)}isEndOfStream_(e=this.mediaIndex,t=this.playlist_,n=this.partIndex){if(!t||!this.mediaSource_)return!1;const r=typeof e=="number"&&t.segments[e],s=e+1===t.segments.length,a=!r||!r.parts||n+1===r.parts.length;return t.endList&&this.mediaSource_.readyState==="open"&&s&&a}chooseNextRequest_(){const e=this.buffered_(),t=lastBufferedEnd(e)||0,n=timeAheadOf(e,this.currentTime_()),r=!this.hasPlayed_()&&n>=1,s=n>=this.goalBufferLength_(),a=this.playlist_.segments;if(!a.length||r||s)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_(),this.loaderType_);const l={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:!this.syncPoint_};if(l.isSyncRequest)l.mediaIndex=getSyncSegmentCandidate(this.currentTimeline_,a,t),this.logger_(`choose next request. Can not find sync point. Fallback to media Index: ${l.mediaIndex}`);else if(this.mediaIndex!==null){const m=a[this.mediaIndex],g=typeof this.partIndex=="number"?this.partIndex:-1;l.startOfSegment=m.end?m.end:t,m.parts&&m.parts[g+1]?(l.mediaIndex=this.mediaIndex,l.partIndex=g+1):l.mediaIndex=this.mediaIndex+1}else{let m,g,v;const _=this.fetchAtBuffer_?t:this.currentTime_();if(this.mediaSequenceSync_&&this.logger_(`chooseNextRequest_ request after Quality Switch:
For TargetTime: ${_}.
CurrentTime: ${this.currentTime_()}
BufferedEnd: ${t}
Fetch At Buffer: ${this.fetchAtBuffer_}
`,this.mediaSequenceSync_.diagnostics),this.mediaSequenceSync_&&this.mediaSequenceSync_.isReliable){const b=this.getSyncInfoFromMediaSequenceSync_(_);if(!b){const E="No sync info found while using media sequence sync";return this.error({message:E,metadata:{errorType:videojs.Error.StreamingFailedToSelectNextSegment,error:new Error(E)}}),this.logger_("chooseNextRequest_ - no sync info found using media sequence sync"),null}this.logger_(`chooseNextRequest_ mediaSequence syncInfo (${b.start} --> ${b.end})`),m=b.segmentIndex,g=b.partIndex,v=b.start}else{this.logger_("chooseNextRequest_ - fallback to a regular segment selection algorithm, based on a syncPoint.");const b=Playlist.getMediaInfoForTime({exactManifestTimings:this.exactManifestTimings,playlist:this.playlist_,currentTime:_,startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time});m=b.segmentIndex,g=b.partIndex,v=b.startTime}l.getMediaInfoForTime=this.fetchAtBuffer_?`bufferedEnd ${_}`:`currentTime ${_}`,l.mediaIndex=m,l.startOfSegment=v,l.partIndex=g,this.logger_(`choose next request. Playlist switched and we have a sync point. Media Index: ${l.mediaIndex} `)}const u=a[l.mediaIndex];let d=u&&typeof l.partIndex=="number"&&u.parts&&u.parts[l.partIndex];if(!u||typeof l.partIndex=="number"&&!d)return null;typeof l.partIndex!="number"&&u.parts&&(l.partIndex=0,d=u.parts[0]);const h=this.vhs_.playlists&&this.vhs_.playlists.main&&this.vhs_.playlists.main.independentSegments||this.playlist_.independentSegments;if(!n&&d&&!h&&!d.independent)if(l.partIndex===0){const m=a[l.mediaIndex-1],g=m.parts&&m.parts.length&&m.parts[m.parts.length-1];g&&g.independent&&(l.mediaIndex-=1,l.partIndex=m.parts.length-1,l.independent="previous segment")}else u.parts[l.partIndex-1].independent&&(l.partIndex-=1,l.independent="previous part");const p=this.mediaSource_&&this.mediaSource_.readyState==="ended";return l.mediaIndex>=a.length-1&&p&&!this.seeking_()?null:(this.shouldForceTimestampOffsetAfterResync_&&(this.shouldForceTimestampOffsetAfterResync_=!1,l.forceTimestampOffset=!0,this.logger_("choose next request. Force timestamp offset after loader resync")),this.generateSegmentInfo_(l))}getSyncInfoFromMediaSequenceSync_(e){if(!this.mediaSequenceSync_)return null;const t=Math.max(e,this.mediaSequenceSync_.start);e!==t&&this.logger_(`getSyncInfoFromMediaSequenceSync_. Pulled target time from ${e} to ${t}`);const n=this.mediaSequenceSync_.getSyncInfoForTime(t);if(!n)return null;if(!n.isAppended)return n;const r=this.mediaSequenceSync_.getSyncInfoForTime(n.end);return r?(r.isAppended&&this.logger_("getSyncInfoFromMediaSequenceSync_: We encounter unexpected scenario where next media sequence sync info is also appended!"),r):null}generateSegmentInfo_(e){const{independent:t,playlist:n,mediaIndex:r,startOfSegment:s,isSyncRequest:a,partIndex:l,forceTimestampOffset:u,getMediaInfoForTime:d}=e,h=n.segments[r],p=typeof l=="number"&&h.parts[l],m={requestId:"segment-loader-"+Math.random(),uri:p&&p.resolvedUri||h.resolvedUri,mediaIndex:r,partIndex:p?l:null,isSyncRequest:a,startOfSegment:s,playlist:n,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:h.timeline,duration:p&&p.duration||h.duration,segment:h,part:p,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:d,independent:t},g=typeof u<"u"?u:this.isPendingTimestampOffset_;m.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:h.timeline,currentTimeline:this.currentTimeline_,startOfSegment:s,buffered:this.buffered_(),overrideCheck:g});const v=lastBufferedEnd(this.sourceUpdater_.audioBuffered());return typeof v=="number"&&(m.audioAppendStart=v-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(m.gopsToAlignWith=gopsSafeToAlignWith(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),m}timestampOffsetForSegment_(e){return timestampOffsetForSegment(e)}earlyAbortWhenNeeded_(e){if(this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH||Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)return;const t=this.currentTime_(),n=e.bandwidth,r=this.pendingSegment_.duration,s=Playlist.estimateSegmentRequestTime(r,n,this.playlist_,e.bytesReceived),a=timeUntilRebuffer(this.buffered_(),t,this.vhs_.tech_.playbackRate())-1;if(s<=a)return;const l=minRebufferMaxBandwidthSelector({main:this.vhs_.playlists.main,currentTime:t,bandwidth:n,duration:this.duration_(),segmentDuration:r,timeUntilRebuffer:a,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!l)return;const d=s-a-l.rebufferingImpact;let h=.5;a<=TIME_FUDGE_FACTOR&&(h=1),!(!l.playlist||l.playlist.uri===this.playlist_.uri||d<h)&&(this.bandwidth=l.playlist.attributes.BANDWIDTH*Config.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}handleAbort_(e){this.logger_(`Aborting ${segmentInfoString(e)}`),this.mediaRequestsAborted+=1}handleProgress_(e,t){this.earlyAbortWhenNeeded_(t.stats),!this.checkForAbort_(t.requestId)&&this.trigger("progress")}handleTrackInfo_(e,t){const{hasAudio:n,hasVideo:r}=t,s={segmentInfo:segmentInfoPayload({type:this.loaderType_,segment:e}),trackInfo:{hasAudio:n,hasVideo:r}};this.trigger({type:"segmenttransmuxingtrackinfoavailable",metadata:s}),this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)&&(this.checkForIllegalMediaSwitch(t)||(t=t||{},shallowEqual(this.currentMediaInfo_,t)||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=t,this.currentMediaInfo_=t,this.logger_("trackinfo update",t),this.trigger("trackinfo")),!this.checkForAbort_(e.requestId)&&(this.pendingSegment_.trackInfo=t,this.hasEnoughInfoToAppend_()?this.processCallQueue_():checkAndFixTimelines(this))))}handleTimingInfo_(e,t,n,r){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;const s=this.pendingSegment_,a=timingInfoPropertyForMedia(t);s[a]=s[a]||{},s[a][n]=r,this.logger_(`timinginfo: ${t} - ${n} - ${r}`),this.hasEnoughInfoToAppend_()?this.processCallQueue_():checkAndFixTimelines(this)}handleCaptions_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(t.length===0){this.logger_("SegmentLoader received no captions from a caption event");return}if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,t));return}const r=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),s={};t.forEach(a=>{s[a.stream]=s[a.stream]||{startTime:1/0,captions:[],endTime:0};const l=s[a.stream];l.startTime=Math.min(l.startTime,a.startTime+r),l.endTime=Math.max(l.endTime,a.endTime+r),l.captions.push(a)}),Object.keys(s).forEach(a=>{const{startTime:l,endTime:u,captions:d}=s[a],h=this.inbandTextTracks_;this.logger_(`adding cues from ${l} -> ${u} for ${a}`),createCaptionsTrackIfNotExists(h,this.vhs_.tech_,a),removeCuesFromTrack(l,u,h[a]),addCaptionData({captionArray:d,inbandTextTracks:h,timestampOffset:r})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}handleId3_(e,t,n){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(!this.pendingSegment_.hasAppendedData_){this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,t,n));return}this.addMetadataToTextTrack(n,t,this.duration_())}processMetadataQueue_(){this.metadataQueue_.id3.forEach(e=>e()),this.metadataQueue_.caption.forEach(e=>e()),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]}processCallQueue_(){const e=this.callQueue_;this.callQueue_=[],e.forEach(t=>t())}processLoadQueue_(){const e=this.loadQueue_;this.loadQueue_=[],e.forEach(t=>t())}hasEnoughInfoToLoad_(){if(this.loaderType_!=="audio")return!0;const e=this.pendingSegment_;return e?this.getCurrentMediaInfo_()?!shouldWaitForTimelineChange({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}):!0:!1}getCurrentMediaInfo_(e=this.pendingSegment_){return e&&e.trackInfo||this.currentMediaInfo_}getMediaInfo_(e=this.pendingSegment_){return this.getCurrentMediaInfo_(e)||this.startingMediaInfo_}getPendingSegmentPlaylist(){return this.pendingSegment_?this.pendingSegment_.playlist:null}hasEnoughInfoToAppend_(){if(!this.sourceUpdater_.ready()||this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;const e=this.pendingSegment_,t=this.getCurrentMediaInfo_();if(!e||!t)return!1;const{hasAudio:n,hasVideo:r,isMuxed:s}=t;return!(r&&!e.videoTimingInfo||n&&!this.audioDisabled_&&!s&&!e.audioTimingInfo||shouldWaitForTimelineChange({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))}handleData_(e,t){if(this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId))return;if(this.callQueue_.length||!this.hasEnoughInfoToAppend_()){checkAndFixTimelines(this),this.callQueue_.push(this.handleData_.bind(this,e,t));return}const n=this.pendingSegment_;if(this.setTimeMapping_(n.timeline),this.updateMediaSecondsLoaded_(n.part||n.segment),this.mediaSource_.readyState!=="closed"){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),n.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),n.isFmp4=e.isFmp4,n.timingInfo=n.timingInfo||{},n.isFmp4)this.trigger("fmp4"),n.timingInfo.start=n[timingInfoPropertyForMedia(t.type)].start;else{const r=this.getCurrentMediaInfo_(),s=this.loaderType_==="main"&&r&&r.hasVideo;let a;s&&(a=n.videoTimingInfo.start),n.timingInfo.start=this.trueSegmentStart_({currentStart:n.timingInfo.start,playlist:n.playlist,mediaIndex:n.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:s,firstVideoFrameTimeForData:a,videoTimingInfo:n.videoTimingInfo,audioTimingInfo:n.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(n,t.type),this.updateSourceBufferTimestampOffset_(n),n.isSyncRequest){this.updateTimingInfoEnd_(n),this.syncController_.saveSegmentTimingInfo({segmentInfo:n,shouldSaveTimelineMapping:this.loaderType_==="main"});const r=this.chooseNextRequest_();if(r.mediaIndex!==n.mediaIndex||r.partIndex!==n.partIndex){this.logger_("sync segment was incorrect, not appending");return}this.logger_("sync segment was correct, appending")}n.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(n,t)}}updateAppendInitSegmentStatus(e,t){this.loaderType_==="main"&&typeof e.timestampOffset=="number"&&!e.changedTimestampOffset&&(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[t]!==e.playlist&&(this.appendInitSegment_[t]=!0)}getInitSegmentAndUpdateState_({type:e,initSegment:t,map:n,playlist:r}){if(n){const s=initSegmentId(n);if(this.activeInitSegmentId_===s)return null;t=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=s}return t&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=r,this.appendInitSegment_[e]=!1,this.activeInitSegmentId_=null,t):null}handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n},r){const s=this.sourceUpdater_.audioBuffered(),a=this.sourceUpdater_.videoBuffered();s.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+timeRangesToArray(s).join(", ")),a.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+timeRangesToArray(a).join(", "));const l=s.length?s.start(0):0,u=s.length?s.end(s.length-1):0,d=a.length?a.start(0):0,h=a.length?a.end(a.length-1):0;if(u-l<=MIN_BACK_BUFFER&&h-d<=MIN_BACK_BUFFER){this.logger_(`On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: ${n.byteLength}, audio buffer: ${timeRangesToArray(s).join(", ")}, video buffer: ${timeRangesToArray(a).join(", ")}, `),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),this.trigger("error");return}this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:e,type:t,bytes:n}));const m=this.currentTime_()-MIN_BACK_BUFFER;this.logger_(`On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to ${m}`),this.remove(0,m,()=>{this.logger_(`On QUOTA_EXCEEDED_ERR, retrying append in ${MIN_BACK_BUFFER}s`),this.waitingOnRemove_=!1,this.quotaExceededErrorRetryTimeout_=window$1.setTimeout(()=>{this.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),this.quotaExceededErrorRetryTimeout_=null,this.processCallQueue_()},MIN_BACK_BUFFER*1e3)},!0)}handleAppendError_({segmentInfo:e,type:t,bytes:n},r){if(r){if(r.code===QUOTA_EXCEEDED_ERR){this.handleQuotaExceededError_({segmentInfo:e,type:t,bytes:n});return}this.logger_("Received non QUOTA_EXCEEDED_ERR on append",r),this.error({message:`${t} append of ${n.length}b failed for segment #${e.mediaIndex} in playlist ${e.playlist.id}`,metadata:{errorType:videojs.Error.StreamingFailedToAppendSegment}}),this.trigger("appenderror")}}appendToSourceBuffer_({segmentInfo:e,type:t,initSegment:n,data:r,bytes:s}){if(!s){const l=[r];let u=r.byteLength;n&&(l.unshift(n),u+=n.byteLength),s=concatSegments({bytes:u,segments:l})}const a={segmentInfo:segmentInfoPayload({type:this.loaderType_,segment:e})};this.trigger({type:"segmentappendstart",metadata:a}),this.sourceUpdater_.appendBuffer({segmentInfo:e,type:t,bytes:s},this.handleAppendError_.bind(this,{segmentInfo:e,type:t,bytes:s}))}handleSegmentTimingInfo_(e,t,n){if(!this.pendingSegment_||t!==this.pendingSegment_.requestId)return;const r=this.pendingSegment_.segment,s=`${e}TimingInfo`;r[s]||(r[s]={}),r[s].transmuxerPrependedSeconds=n.prependedContentDuration||0,r[s].transmuxedPresentationStart=n.start.presentation,r[s].transmuxedDecodeStart=n.start.decode,r[s].transmuxedPresentationEnd=n.end.presentation,r[s].transmuxedDecodeEnd=n.end.decode,r[s].baseMediaDecodeTime=n.baseMediaDecodeTime}appendData_(e,t){const{type:n,data:r}=t;if(!r||!r.byteLength||n==="audio"&&this.audioDisabled_)return;const s=this.getInitSegmentAndUpdateState_({type:n,initSegment:t.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:n,initSegment:s,data:r})}loadSegment_(e){if(this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),typeof e.timestampOffset=="number"&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),!this.hasEnoughInfoToLoad_()){checkAndFixTimelines(this),this.loadQueue_.push(()=>{const t=_extends({},e,{forceTimestampOffset:!0});_extends(e,this.generateSegmentInfo_(t)),this.isPendingTimestampOffset_=!1,this.updateTransmuxerAndRequestSegment_(e)});return}this.updateTransmuxerAndRequestSegment_(e)}updateTransmuxerAndRequestSegment_(e){this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));const t=this.createSimplifiedSegmentObj_(e),n=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex),r=this.mediaIndex!==null,s=e.timeline!==this.currentTimeline_&&e.timeline>0,a=n||r&&s;this.logger_(`Requesting
${compactSegmentUrlDescription(e.uri)}
${segmentInfoString(e)}`),t.map&&!t.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=mediaSegmentRequest({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:t,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:a,endedTimelineFn:()=>{this.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:({message:l,level:u,stream:d})=>{this.logger_(`${segmentInfoString(e)} logged from transmuxer stream ${d} as a ${u}: ${l}`)},triggerSegmentEventFn:({type:l,segment:u,keyInfo:d,trackInfo:h,timingInfo:p})=>{const g={segmentInfo:segmentInfoPayload({segment:u})};d&&(g.keyInfo=d),h&&(g.trackInfo=h),p&&(g.timingInfo=p),this.trigger({type:l,metadata:g})}})}trimBackBuffer_(e){const t=safeBackBufferTrimTime(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);t>0&&this.remove(0,t)}createSimplifiedSegmentObj_(e){const t=e.segment,n=e.part,r=e.segment.key||e.segment.map&&e.segment.map.key,s=e.segment.map&&!e.segment.map.bytes,a={resolvedUri:n?n.resolvedUri:t.resolvedUri,byterange:n?n.byterange:t.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part,type:this.loaderType_,start:e.startOfSegment,duration:e.duration,isEncrypted:r,isMediaInitialization:s},l=e.playlist.segments[e.mediaIndex-1];if(l&&l.timeline===t.timeline&&(l.videoTimingInfo?a.baseStartTime=l.videoTimingInfo.transmuxedDecodeEnd:l.audioTimingInfo&&(a.baseStartTime=l.audioTimingInfo.transmuxedDecodeEnd)),t.key){const u=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);a.key=this.segmentKey(t.key),a.key.iv=u}return t.map&&(a.map=this.initSegmentForMap(t.map)),a}saveTransferStats_(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)}saveBandwidthRelatedStats_(e,t){if(this.pendingSegment_.byteLength=t.bytesReceived,e<MIN_SEGMENT_DURATION_TO_SAVE_STATS){this.logger_(`Ignoring segment's bandwidth because its duration of ${e} is less than the min to record ${MIN_SEGMENT_DURATION_TO_SAVE_STATS}`);return}const n={bandwidthInfo:{from:this.bandwidth,to:t.bandwidth}};this.trigger({type:"bandwidthupdated",metadata:n}),this.bandwidth=t.bandwidth,this.roundTrip=t.roundTripTime}handleTimeout_(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate"),this.trigger("timeout")}segmentRequestFinished_(e,t,n){if(this.callQueue_.length){this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,t,n));return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_||t.requestId!==this.pendingSegment_.requestId)return;if(e){if(this.pendingSegment_=null,this.state="READY",e.code===REQUEST_ERRORS.ABORTED)return;if(this.pause(),e.code===REQUEST_ERRORS.TIMEOUT){this.handleTimeout_();return}this.mediaRequestsErrored+=1,this.error(e),this.trigger("error");return}const r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,t.stats),r.endOfAllRequests=t.endOfAllRequests,n.gopInfo&&(this.gopBuffer_=updateGopBuffer(this.gopBuffer_,n.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(r)}setTimeMapping_(e){const t=this.syncController_.mappingForTimeline(e);t!==null&&(this.timeMapping_=t)}updateMediaSecondsLoaded_(e){typeof e.start=="number"&&typeof e.end=="number"?this.mediaSecondsLoaded+=e.end-e.start:this.mediaSecondsLoaded+=e.duration}shouldUpdateTransmuxerTimestampOffset_(e){return e===null?!1:this.loaderType_==="main"&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset()}trueSegmentStart_({currentStart:e,playlist:t,mediaIndex:n,firstVideoFrameTimeForData:r,currentVideoTimestampOffset:s,useVideoTimingInfo:a,videoTimingInfo:l,audioTimingInfo:u}){if(typeof e<"u")return e;if(!a)return u.start;const d=t.segments[n-1];return n===0||!d||typeof d.start>"u"||d.end!==r+s?r:l.start}waitForAppendsToComplete_(e){const t=this.getCurrentMediaInfo_(e);if(!t){this.error({message:"No starting media returned, likely due to an unsupported media format.",playlistExclusionDuration:1/0}),this.trigger("error");return}const{hasAudio:n,hasVideo:r,isMuxed:s}=t,a=this.loaderType_==="main"&&r,l=!this.audioDisabled_&&n&&!s;if(e.waitingOnAppends=0,!e.hasAppendedData_){!e.timingInfo&&typeof e.timestampOffset=="number"&&(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),this.checkAppendsDone_(e);return}a&&e.waitingOnAppends++,l&&e.waitingOnAppends++,a&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),l&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))}checkAppendsDone_(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,e.waitingOnAppends===0&&this.handleAppendsDone_())}checkForIllegalMediaSwitch(e){const t=illegalMediaSwitch(this.loaderType_,this.getCurrentMediaInfo_(),e);return t?(this.error({message:t,playlistExclusionDuration:1/0}),this.trigger("error"),!0):!1}updateSourceBufferTimestampOffset_(e){if(e.timestampOffset===null||typeof e.timingInfo.start!="number"||e.changedTimestampOffset||this.loaderType_!=="main")return;let t=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),t=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),t=!0),t&&this.trigger("timestampoffset")}getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e,audioTimingInfo:t,timingInfo:n}){return this.useDtsForTimestampOffset_?e&&typeof e.transmuxedDecodeStart=="number"?e.transmuxedDecodeStart:t&&typeof t.transmuxedDecodeStart=="number"?t.transmuxedDecodeStart:n.start:n.start}updateTimingInfoEnd_(e){e.timingInfo=e.timingInfo||{};const t=this.getMediaInfo_(),r=this.loaderType_==="main"&&t&&t.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;r&&(e.timingInfo.end=typeof r.end=="number"?r.end:r.start+e.duration)}handleAppendsDone_(){if(this.pendingSegment_){const u={segmentInfo:segmentInfoPayload({type:this.loaderType_,segment:this.pendingSegment_})};this.trigger({type:"appendsdone",metadata:u})}if(!this.pendingSegment_){this.state="READY",this.paused()||this.monitorBuffer_();return}const e=this.pendingSegment_;e.part&&e.part.syncInfo?e.part.syncInfo.markAppended():e.segment.syncInfo&&e.segment.syncInfo.markAppended(),this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:this.loaderType_==="main"});const t=getTroublesomeSegmentDurationMessage(e,this.sourceType_);if(t&&(t.severity==="warn"?videojs.log.warn(t.message):this.logger_(t.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",e.isSyncRequest&&(this.trigger("syncinfoupdate"),!e.hasAppendedData_)){this.logger_(`Throwing away un-appended sync request ${segmentInfoString(e)}`);return}this.logger_(`Appended ${segmentInfoString(e)}`),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),this.loaderType_==="main"&&!this.audioDisabled_&&this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");const n=e.segment,r=e.part,s=n.end&&this.currentTime_()-n.end>e.playlist.targetDuration*3,a=r&&r.end&&this.currentTime_()-r.end>e.playlist.partTargetDuration*3;if(s||a){this.logger_(`bad ${s?"segment":"part"} ${segmentInfoString(e)}`),this.resetEverything();return}this.mediaIndex!==null&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}recordThroughput_(e){if(e.duration<MIN_SEGMENT_DURATION_TO_SAVE_STATS){this.logger_(`Ignoring segment's throughput because its duration of ${e.duration} is less than the min to record ${MIN_SEGMENT_DURATION_TO_SAVE_STATS}`);return}const t=this.throughput.rate,n=Date.now()-e.endOfAllRequests+1,r=Math.floor(e.byteLength/n*8*1e3);this.throughput.rate+=(r-t)/++this.throughput.count}addSegmentMetadataCue_(e){if(!this.segmentMetadataTrack_)return;const t=e.segment,n=t.start,r=t.end;if(!finite(n)||!finite(r))return;removeCuesFromTrack(n,r,this.segmentMetadataTrack_);const s=window$1.WebKitDataCue||window$1.VTTCue,a={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,programDateTime:t.programDateTime,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:n,end:r},l=JSON.stringify(a),u=new s(n,r,l);u.value=a,this.segmentMetadataTrack_.addCue(u)}}function noop(){}const toTitleCase=function(i){return typeof i!="string"?i:i.replace(/./,e=>e.toUpperCase())},bufferTypes=["video","audio"],updating=(i,e)=>{const t=e[`${i}Buffer`];return t&&t.updating||e.queuePending[i]},nextQueueIndexOfType=(i,e)=>{for(let t=0;t<e.length;t++){const n=e[t];if(n.type==="mediaSource")return null;if(n.type===i)return t}return null},shiftQueue=(i,e)=>{if(e.queue.length===0)return;let t=0,n=e.queue[t];if(n.type==="mediaSource"){!e.updating()&&e.mediaSource.readyState!=="closed"&&(e.queue.shift(),n.action(e),n.doneFn&&n.doneFn(),shiftQueue("audio",e),shiftQueue("video",e));return}if(i!=="mediaSource"&&!(!e.ready()||e.mediaSource.readyState==="closed"||updating(i,e))){if(n.type!==i){if(t=nextQueueIndexOfType(i,e.queue),t===null)return;n=e.queue[t]}if(e.queue.splice(t,1),e.queuePending[i]=n,n.action(i,e),!n.doneFn){e.queuePending[i]=null,shiftQueue(i,e);return}}},cleanupBuffer=(i,e)=>{const t=e[`${i}Buffer`],n=toTitleCase(i);t&&(t.removeEventListener("updateend",e[`on${n}UpdateEnd_`]),t.removeEventListener("error",e[`on${n}Error_`]),e.codecs[i]=null,e[`${i}Buffer`]=null)},inSourceBuffers=(i,e)=>i&&e&&Array.prototype.indexOf.call(i.sourceBuffers,e)!==-1,actions={appendBuffer:(i,e,t)=>(n,r)=>{const s=r[`${n}Buffer`];if(inSourceBuffers(r.mediaSource,s)){r.logger_(`Appending segment ${e.mediaIndex}'s ${i.length} bytes to ${n}Buffer`);try{s.appendBuffer(i)}catch(a){r.logger_(`Error with code ${a.code} `+(a.code===QUOTA_EXCEEDED_ERR?"(QUOTA_EXCEEDED_ERR) ":"")+`when appending segment ${e.mediaIndex} to ${n}Buffer`),r.queuePending[n]=null,t(a)}}},remove:(i,e)=>(t,n)=>{const r=n[`${t}Buffer`];if(inSourceBuffers(n.mediaSource,r)){n.logger_(`Removing ${i} to ${e} from ${t}Buffer`);try{r.remove(i,e)}catch{n.logger_(`Remove ${i} to ${e} from ${t}Buffer failed`)}}},timestampOffset:i=>(e,t)=>{const n=t[`${e}Buffer`];inSourceBuffers(t.mediaSource,n)&&(t.logger_(`Setting ${e}timestampOffset to ${i}`),n.timestampOffset=i)},callback:i=>(e,t)=>{i()},endOfStream:i=>e=>{if(e.mediaSource.readyState==="open"){e.logger_(`Calling mediaSource endOfStream(${i||""})`);try{e.mediaSource.endOfStream(i)}catch(t){videojs.log.warn("Failed to call media source endOfStream",t)}}},duration:i=>e=>{e.logger_(`Setting mediaSource duration to ${i}`);try{e.mediaSource.duration=i}catch(t){videojs.log.warn("Failed to set media source duration",t)}},abort:()=>(i,e)=>{if(e.mediaSource.readyState!=="open")return;const t=e[`${i}Buffer`];if(inSourceBuffers(e.mediaSource,t)){e.logger_(`calling abort on ${i}Buffer`);try{t.abort()}catch(n){videojs.log.warn(`Failed to abort on ${i}Buffer`,n)}}},addSourceBuffer:(i,e)=>t=>{const n=toTitleCase(i),r=getMimeForCodec(e);t.logger_(`Adding ${i}Buffer with codec ${e} to mediaSource`);const s=t.mediaSource.addSourceBuffer(r);s.addEventListener("updateend",t[`on${n}UpdateEnd_`]),s.addEventListener("error",t[`on${n}Error_`]),t.codecs[i]=e,t[`${i}Buffer`]=s},removeSourceBuffer:i=>e=>{const t=e[`${i}Buffer`];if(cleanupBuffer(i,e),!!inSourceBuffers(e.mediaSource,t)){e.logger_(`Removing ${i}Buffer with codec ${e.codecs[i]} from mediaSource`);try{e.mediaSource.removeSourceBuffer(t)}catch(n){videojs.log.warn(`Failed to removeSourceBuffer ${i}Buffer`,n)}}},changeType:i=>(e,t)=>{const n=t[`${e}Buffer`],r=getMimeForCodec(i);if(!inSourceBuffers(t.mediaSource,n))return;const s=i.substring(0,i.indexOf(".")),a=t.codecs[e];if(a.substring(0,a.indexOf("."))===s)return;const u={codecsChangeInfo:{from:a,to:i}};t.trigger({type:"codecschange",metadata:u}),t.logger_(`changing ${e}Buffer codec from ${a} to ${i}`);try{n.changeType(r),t.codecs[e]=i}catch(d){u.errorType=videojs.Error.StreamingCodecsChangeError,u.error=d,d.metadata=u,t.error_=d,t.trigger("error"),videojs.log.warn(`Failed to changeType on ${e}Buffer`,d)}}},pushQueue=({type:i,sourceUpdater:e,action:t,doneFn:n,name:r})=>{e.queue.push({type:i,action:t,doneFn:n,name:r}),shiftQueue(i,e)},onUpdateend=(i,e)=>t=>{const n=e[`${i}Buffered`](),r=bufferedRangesToString(n);if(e.logger_(`received "updateend" event for ${i} Source Buffer: `,r),e.queuePending[i]){const s=e.queuePending[i].doneFn;e.queuePending[i]=null,s&&s(e[`${i}Error_`])}shiftQueue(i,e)};class SourceUpdater extends videojs.EventTarget{constructor(e){super(),this.mediaSource=e,this.sourceopenListener_=()=>shiftQueue("mediaSource",this),this.mediaSource.addEventListener("sourceopen",this.sourceopenListener_),this.logger_=logger("SourceUpdater"),this.audioTimestampOffset_=0,this.videoTimestampOffset_=0,this.queue=[],this.queuePending={audio:null,video:null},this.delayedAudioAppendQueue_=[],this.videoAppendQueued_=!1,this.codecs={},this.onVideoUpdateEnd_=onUpdateend("video",this),this.onAudioUpdateEnd_=onUpdateend("audio",this),this.onVideoError_=t=>{this.videoError_=t},this.onAudioError_=t=>{this.audioError_=t},this.createdSourceBuffers_=!1,this.initializedEme_=!1,this.triggeredReady_=!1}initializedEme(){this.initializedEme_=!0,this.triggerReady()}hasCreatedSourceBuffers(){return this.createdSourceBuffers_}hasInitializedAnyEme(){return this.initializedEme_}ready(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()}createSourceBuffers(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())}triggerReady(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))}addSourceBuffer(e,t){pushQueue({type:"mediaSource",sourceUpdater:this,action:actions.addSourceBuffer(e,t),name:"addSourceBuffer"})}abort(e){pushQueue({type:e,sourceUpdater:this,action:actions.abort(e),name:"abort"})}removeSourceBuffer(e){if(!this.canRemoveSourceBuffer()){videojs.log.error("removeSourceBuffer is not supported!");return}pushQueue({type:"mediaSource",sourceUpdater:this,action:actions.removeSourceBuffer(e),name:"removeSourceBuffer"})}canRemoveSourceBuffer(){return!videojs.browser.IS_FIREFOX&&window$1.MediaSource&&window$1.MediaSource.prototype&&typeof window$1.MediaSource.prototype.removeSourceBuffer=="function"}static canChangeType(){return window$1.SourceBuffer&&window$1.SourceBuffer.prototype&&typeof window$1.SourceBuffer.prototype.changeType=="function"}canChangeType(){return this.constructor.canChangeType()}changeType(e,t){if(!this.canChangeType()){videojs.log.error("changeType is not supported!");return}pushQueue({type:e,sourceUpdater:this,action:actions.changeType(t),name:"changeType"})}addOrChangeSourceBuffers(e){if(!e||typeof e!="object"||Object.keys(e).length===0)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(t=>{const n=e[t];if(!this.hasCreatedSourceBuffers())return this.addSourceBuffer(t,n);this.canChangeType()&&this.changeType(t,n)})}appendBuffer(e,t){const{segmentInfo:n,type:r,bytes:s}=e;if(this.processedAppend_=!0,r==="audio"&&this.videoBuffer&&!this.videoAppendQueued_){this.delayedAudioAppendQueue_.push([e,t]),this.logger_(`delayed audio append of ${s.length} until video append`);return}const a=t;if(pushQueue({type:r,sourceUpdater:this,action:actions.appendBuffer(s,n||{mediaIndex:-1},a),doneFn:t,name:"appendBuffer"}),r==="video"){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;const l=this.delayedAudioAppendQueue_.slice();this.logger_(`queuing delayed audio ${l.length} appendBuffers`),this.delayedAudioAppendQueue_.length=0,l.forEach(u=>{this.appendBuffer.apply(this,u)})}}audioBuffered(){return inSourceBuffers(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:createTimeRanges()}videoBuffered(){return inSourceBuffers(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:createTimeRanges()}buffered(){const e=inSourceBuffers(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,t=inSourceBuffers(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return t&&!e?this.audioBuffered():e&&!t?this.videoBuffered():bufferIntersection(this.audioBuffered(),this.videoBuffered())}setDuration(e,t=noop){pushQueue({type:"mediaSource",sourceUpdater:this,action:actions.duration(e),name:"duration",doneFn:t})}endOfStream(e=null,t=noop){typeof e!="string"&&(e=void 0),pushQueue({type:"mediaSource",sourceUpdater:this,action:actions.endOfStream(e),name:"endOfStream",doneFn:t})}removeAudio(e,t,n=noop){if(!this.audioBuffered().length||this.audioBuffered().end(0)===0){n();return}pushQueue({type:"audio",sourceUpdater:this,action:actions.remove(e,t),doneFn:n,name:"remove"})}removeVideo(e,t,n=noop){if(!this.videoBuffered().length||this.videoBuffered().end(0)===0){n();return}pushQueue({type:"video",sourceUpdater:this,action:actions.remove(e,t),doneFn:n,name:"remove"})}updating(){return!!(updating("audio",this)||updating("video",this))}audioTimestampOffset(e){return typeof e<"u"&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(pushQueue({type:"audio",sourceUpdater:this,action:actions.timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_}videoTimestampOffset(e){return typeof e<"u"&&this.videoBuffer&&this.videoTimestampOffset_!==e&&(pushQueue({type:"video",sourceUpdater:this,action:actions.timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_}audioQueueCallback(e){this.audioBuffer&&pushQueue({type:"audio",sourceUpdater:this,action:actions.callback(e),name:"callback"})}videoQueueCallback(e){this.videoBuffer&&pushQueue({type:"video",sourceUpdater:this,action:actions.callback(e),name:"callback"})}dispose(){this.trigger("dispose"),bufferTypes.forEach(e=>{this.abort(e),this.canRemoveSourceBuffer()?this.removeSourceBuffer(e):this[`${e}QueueCallback`](()=>cleanupBuffer(e,this))}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()}}const uint8ToUtf8=i=>decodeURIComponent(escape(String.fromCharCode.apply(null,i))),bufferToHexString=i=>{const e=new Uint8Array(i);return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")},VTT_LINE_TERMINATORS=new Uint8Array(`

`.split("").map(i=>i.charCodeAt(0)));class NoVttJsError extends Error{constructor(){super("Trying to parse received VTT cues, but there is no WebVTT. Make sure vtt.js is loaded.")}}class VTTSegmentLoader extends SegmentLoader{constructor(e,t={}){super(e,t),this.mediaSource_=null,this.subtitlesTrack_=null,this.featuresNativeTextTracks_=e.featuresNativeTextTracks,this.loadVttJs=e.loadVttJs,this.shouldSaveSegmentTimingInfo_=!1}buffered_(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return createTimeRanges();const e=this.subtitlesTrack_.cues,t=e[0].startTime,n=e[e.length-1].startTime;return createTimeRanges([[t,n]])}initSegmentForMap(e,t=!1){if(!e)return null;const n=initSegmentId(e);let r=this.initSegments_[n];if(t&&!r&&e.bytes){const s=VTT_LINE_TERMINATORS.byteLength+e.bytes.byteLength,a=new Uint8Array(s);a.set(e.bytes),a.set(VTT_LINE_TERMINATORS,e.bytes.byteLength),this.initSegments_[n]=r={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:a}}return r||e}couldBeginLoading_(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}init_(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}track(e){return typeof e>"u"?this.subtitlesTrack_:(this.subtitlesTrack_=e,this.state==="INIT"&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}remove(e,t){removeCuesFromTrack(e,t,this.subtitlesTrack_)}fillBuffer_(){const e=this.chooseNextRequest_();if(e){if(this.syncController_.timestampOffsetForTimeline(e.timeline)===null){const t=()=>{this.state="READY",this.paused()||this.monitorBuffer_()};this.syncController_.one("timestampoffset",t),this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(e)}}timestampOffsetForSegment_(){return null}chooseNextRequest_(){return this.skipEmptySegments_(super.chooseNextRequest_())}skipEmptySegments_(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e}stopForError(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")}segmentRequestFinished_(e,t,n){if(!this.subtitlesTrack_){this.state="READY";return}if(this.saveTransferStats_(t.stats),!this.pendingSegment_){this.state="READY",this.mediaRequestsAborted+=1;return}if(e){e.code===REQUEST_ERRORS.TIMEOUT&&this.handleTimeout_(),e.code===REQUEST_ERRORS.ABORTED?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,this.stopForError(e);return}const r=this.pendingSegment_,s=n.mp4VttCues&&n.mp4VttCues.length;s&&(r.mp4VttCues=n.mp4VttCues),this.saveBandwidthRelatedStats_(r.duration,t.stats),t.key&&this.segmentKey(t.key,!0),this.state="APPENDING",this.trigger("appending");const a=r.segment;if(a.map&&(a.map.bytes=t.map.bytes),r.bytes=t.bytes,typeof window$1.WebVTT!="function"&&typeof this.loadVttJs=="function"){this.state="WAITING_ON_VTTJS",this.loadVttJs().then(()=>this.segmentRequestFinished_(e,t,n),()=>this.stopForError({message:"Error loading vtt.js"}));return}a.requested=!0;try{this.parseVTTCues_(r)}catch(l){this.stopForError({message:l.message,metadata:{errorType:videojs.Error.StreamingVttParserError,error:l}});return}if(s||this.updateTimeMapping_(r,this.syncController_.timelines[r.timeline],this.playlist_),r.cues.length?r.timingInfo={start:r.cues[0].startTime,end:r.cues[r.cues.length-1].endTime}:r.timingInfo={start:r.startOfSegment,end:r.startOfSegment+r.duration},r.isSyncRequest){this.trigger("syncinfoupdate"),this.pendingSegment_=null,this.state="READY";return}r.byteLength=r.bytes.byteLength,this.mediaSecondsLoaded+=a.duration,r.cues.forEach(l=>{this.subtitlesTrack_.addCue(this.featuresNativeTextTracks_?new window$1.VTTCue(l.startTime,l.endTime,l.text):l)}),removeDuplicateCuesFromTrack(this.subtitlesTrack_),this.handleAppendsDone_()}handleData_(e,t){const n=e&&e.type==="vtt",r=t&&t.type==="text";n&&r&&super.handleData_(e,t)}updateTimingInfoEnd_(){}parseMp4VttCues_(e){const t=this.sourceUpdater_.videoTimestampOffset()===null?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();e.mp4VttCues.forEach(n=>{const r=n.start+t,s=n.end+t,a=new window$1.VTTCue(r,s,n.cueText);n.settings&&n.settings.split(" ").forEach(l=>{const u=l.split(":"),d=u[0],h=u[1];a[d]=isNaN(h)?h:Number(h)}),e.cues.push(a)})}parseVTTCues_(e){let t,n=!1;if(typeof window$1.WebVTT!="function")throw new NoVttJsError;if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},e.mp4VttCues){this.parseMp4VttCues_(e);return}typeof window$1.TextDecoder=="function"?t=new window$1.TextDecoder("utf8"):(t=window$1.WebVTT.StringDecoder(),n=!0);const r=new window$1.WebVTT.Parser(window$1,window$1.vttjs,t);if(r.oncue=e.cues.push.bind(e.cues),r.ontimestampmap=a=>{e.timestampmap=a},r.onparsingerror=a=>{videojs.log.warn("Error encountered when parsing cues: "+a.message)},e.segment.map){let a=e.segment.map.bytes;n&&(a=uint8ToUtf8(a)),r.parse(a)}let s=e.bytes;n&&(s=uint8ToUtf8(s)),r.parse(s),r.flush()}updateTimeMapping_(e,t,n){const r=e.segment;if(!t)return;if(!e.cues.length){r.empty=!0;return}const{MPEGTS:s,LOCAL:a}=e.timestampmap,u=s/clockExports.ONE_SECOND_IN_TS-a+t.mapping;if(e.cues.forEach(d=>{const h=d.endTime-d.startTime,p=this.handleRollover_(d.startTime+u,t.time);d.startTime=Math.max(p,0),d.endTime=Math.max(p+h,0)}),!n.syncInfo){const d=e.cues[0].startTime,h=e.cues[e.cues.length-1].startTime;n.syncInfo={mediaSequence:n.mediaSequence+e.mediaIndex,time:Math.min(d,h-r.duration)}}}handleRollover_(e,t){if(t===null)return e;let n=e*clockExports.ONE_SECOND_IN_TS;const r=t*clockExports.ONE_SECOND_IN_TS;let s;for(r<n?s=-8589934592:s=8589934592;Math.abs(n-r)>4294967296;)n+=s;return n/clockExports.ONE_SECOND_IN_TS}}const findAdCue=function(i,e){const t=i.cues;for(let n=0;n<t.length;n++){const r=t[n];if(e>=r.adStartTime&&e<=r.adEndTime)return r}return null},updateAdCues=function(i,e,t=0){if(!i.segments)return;let n=t,r;for(let s=0;s<i.segments.length;s++){const a=i.segments[s];if(r||(r=findAdCue(e,n+a.duration/2)),r){if("cueIn"in a){r.endTime=n,r.adEndTime=n,n+=a.duration,r=null;continue}if(n<r.endTime){n+=a.duration;continue}r.endTime+=a.duration}else if("cueOut"in a&&(r=new window$1.VTTCue(n,n+a.duration,a.cueOut),r.adStartTime=n,r.adEndTime=n+parseFloat(a.cueOut),e.addCue(r)),"cueOutCont"in a){const[l,u]=a.cueOutCont.split("/").map(parseFloat);r=new window$1.VTTCue(n,n+a.duration,""),r.adStartTime=n-l,r.adEndTime=r.adStartTime+u,e.addCue(r)}n+=a.duration}};class SyncInfo{constructor({start:e,end:t,segmentIndex:n,partIndex:r=null,appended:s=!1}){this.start_=e,this.end_=t,this.segmentIndex_=n,this.partIndex_=r,this.appended_=s}isInRange(e){return e>=this.start&&e<this.end}markAppended(){this.appended_=!0}resetAppendedStatus(){this.appended_=!1}get isAppended(){return this.appended_}get start(){return this.start_}get end(){return this.end_}get segmentIndex(){return this.segmentIndex_}get partIndex(){return this.partIndex_}}class SyncInfoData{constructor(e,t=[]){this.segmentSyncInfo_=e,this.partsSyncInfo_=t}get segmentSyncInfo(){return this.segmentSyncInfo_}get partsSyncInfo(){return this.partsSyncInfo_}get hasPartsSyncInfo(){return this.partsSyncInfo_.length>0}resetAppendStatus(){this.segmentSyncInfo_.resetAppendedStatus(),this.partsSyncInfo_.forEach(e=>e.resetAppendedStatus())}}class MediaSequenceSync{constructor(){this.storage_=new Map,this.diagnostics_="",this.isReliable_=!1,this.start_=-1/0,this.end_=1/0}get start(){return this.start_}get end(){return this.end_}get diagnostics(){return this.diagnostics_}get isReliable(){return this.isReliable_}resetAppendedStatus(){this.storage_.forEach(e=>e.resetAppendStatus())}update(e,t){const{mediaSequence:n,segments:r}=e;if(this.isReliable_=this.isReliablePlaylist_(n,r),!!this.isReliable_)return this.updateStorage_(r,n,this.calculateBaseTime_(n,r,t))}getSyncInfoForTime(e){for(const{segmentSyncInfo:t,partsSyncInfo:n}of this.storage_.values())if(n.length){for(const r of n)if(r.isInRange(e))return r}else if(t.isInRange(e))return t;return null}getSyncInfoForMediaSequence(e){return this.storage_.get(e)}updateStorage_(e,t,n){const r=new Map;let s=`
`,a=n,l=t;this.start_=a,e.forEach((u,d)=>{const h=this.storage_.get(l),p=a,m=p+u.duration,g=!!(h&&h.segmentSyncInfo&&h.segmentSyncInfo.isAppended),v=new SyncInfo({start:p,end:m,appended:g,segmentIndex:d});u.syncInfo=v;let _=a;const b=(u.parts||[]).map((E,A)=>{const z=_,D=_+E.duration,P=!!(h&&h.partsSyncInfo&&h.partsSyncInfo[A]&&h.partsSyncInfo[A].isAppended),G=new SyncInfo({start:z,end:D,appended:P,segmentIndex:d,partIndex:A});return _=D,s+=`Media Sequence: ${l}.${A} | Range: ${z} --> ${D} | Appended: ${P}
`,E.syncInfo=G,G});r.set(l,new SyncInfoData(v,b)),s+=`${compactSegmentUrlDescription(u.resolvedUri)} | Media Sequence: ${l} | Range: ${p} --> ${m} | Appended: ${g}
`,l++,a=m}),this.end_=a,this.storage_=r,this.diagnostics_=s}calculateBaseTime_(e,t,n){if(!this.storage_.size)return 0;if(this.storage_.has(e))return this.storage_.get(e).segmentSyncInfo.start;const r=Math.min(...this.storage_.keys());if(e<r){const s=r-e;let a=this.storage_.get(r).segmentSyncInfo.start;for(let l=0;l<s;l++){const u=t[l];a-=u.duration}return a}return n}isReliablePlaylist_(e,t){return e!=null&&Array.isArray(t)&&t.length}}class DependantMediaSequenceSync extends MediaSequenceSync{constructor(e){super(),this.parent_=e}calculateBaseTime_(e,t,n){if(!this.storage_.size){const r=this.parent_.getSyncInfoForMediaSequence(e);return r?r.segmentSyncInfo.start:0}return super.calculateBaseTime_(e,t,n)}}const MAX_MEDIA_SEQUENCE_DIFF_FOR_SYNC=86400,syncPointStrategies=[{name:"VOD",run:(i,e,t,n,r)=>t!==1/0?{time:0,segmentIndex:0,partIndex:null}:null},{name:"MediaSequence",run:(i,e,t,n,r,s)=>{const a=i.getMediaSequenceSync(s);if(!a||!a.isReliable)return null;const l=a.getSyncInfoForTime(r);return l?{time:l.start,partIndex:l.partIndex,segmentIndex:l.segmentIndex}:null}},{name:"ProgramDateTime",run:(i,e,t,n,r)=>{if(!Object.keys(i.timelineToDatetimeMappings).length)return null;let s=null,a=null;const l=getPartsAndSegments(e);r=r||0;for(let u=0;u<l.length;u++){const d=e.endList||r===0?u:l.length-(u+1),h=l[d],p=h.segment,m=i.timelineToDatetimeMappings[p.timeline];if(!m||!p.dateTimeObject)continue;let v=p.dateTimeObject.getTime()/1e3+m;if(p.parts&&typeof h.partIndex=="number")for(let b=0;b<h.partIndex;b++)v+=p.parts[b].duration;const _=Math.abs(r-v);if(a!==null&&(_===0||a<_))break;a=_,s={time:v,segmentIndex:h.segmentIndex,partIndex:h.partIndex}}return s}},{name:"Segment",run:(i,e,t,n,r)=>{let s=null,a=null;r=r||0;const l=getPartsAndSegments(e);for(let u=0;u<l.length;u++){const d=e.endList||r===0?u:l.length-(u+1),h=l[d],p=h.segment,m=h.part&&h.part.start||p&&p.start;if(p.timeline===n&&typeof m<"u"){const g=Math.abs(r-m);if(a!==null&&a<g)break;(!s||a===null||a>=g)&&(a=g,s={time:m,segmentIndex:h.segmentIndex,partIndex:h.partIndex})}}return s}},{name:"Discontinuity",run:(i,e,t,n,r)=>{let s=null;if(r=r||0,e.discontinuityStarts&&e.discontinuityStarts.length){let a=null;for(let l=0;l<e.discontinuityStarts.length;l++){const u=e.discontinuityStarts[l],d=e.discontinuitySequence+l+1,h=i.discontinuities[d];if(h){const p=Math.abs(r-h.time);if(a!==null&&a<p)break;(!s||a===null||a>=p)&&(a=p,s={time:h.time,segmentIndex:u,partIndex:null})}}}return s}},{name:"Playlist",run:(i,e,t,n,r)=>e.syncInfo?{time:e.syncInfo.time,segmentIndex:e.syncInfo.mediaSequence-e.mediaSequence,partIndex:null}:null}];class SyncController extends videojs.EventTarget{constructor(e={}){super(),this.timelines=[],this.discontinuities=[],this.timelineToDatetimeMappings={};const t=new MediaSequenceSync,n=new DependantMediaSequenceSync(t),r=new DependantMediaSequenceSync(t);this.mediaSequenceStorage_={main:t,audio:n,vtt:r},this.logger_=logger("SyncController")}getMediaSequenceSync(e){return this.mediaSequenceStorage_[e]||null}getSyncPoint(e,t,n,r,s){if(t!==1/0)return syncPointStrategies.find(({name:u})=>u==="VOD").run(this,e,t);const a=this.runStrategies_(e,t,n,r,s);if(!a.length)return null;for(const l of a){const{syncPoint:u,strategy:d}=l,{segmentIndex:h,time:p}=u;if(h<0)continue;const m=e.segments[h],g=p,v=g+m.duration;if(this.logger_(`Strategy: ${d}. Current time: ${r}. selected segment: ${h}. Time: [${g} -> ${v}]}`),r>=g&&r<v)return this.logger_("Found sync point with exact match: ",u),u}return this.selectSyncPoint_(a,{key:"time",value:r})}getExpiredTime(e,t){if(!e||!e.segments)return null;const n=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!n.length)return null;const r=this.selectSyncPoint_(n,{key:"segmentIndex",value:0});return r.segmentIndex>0&&(r.time*=-1),Math.abs(r.time+sumDurations({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:r.segmentIndex,endIndex:0}))}runStrategies_(e,t,n,r,s){const a=[];for(let l=0;l<syncPointStrategies.length;l++){const u=syncPointStrategies[l],d=u.run(this,e,t,n,r,s);d&&(d.strategy=u.name,a.push({strategy:u.name,syncPoint:d}))}return a}selectSyncPoint_(e,t){let n=e[0].syncPoint,r=Math.abs(e[0].syncPoint[t.key]-t.value),s=e[0].strategy;for(let a=1;a<e.length;a++){const l=Math.abs(e[a].syncPoint[t.key]-t.value);l<r&&(r=l,n=e[a].syncPoint,s=e[a].strategy)}return this.logger_(`syncPoint for [${t.key}: ${t.value}] chosen with strategy [${s}]: [time:${n.time}, segmentIndex:${n.segmentIndex}`+(typeof n.partIndex=="number"?`,partIndex:${n.partIndex}`:"")+"]"),n}saveExpiredSegmentInfo(e,t){const n=t.mediaSequence-e.mediaSequence;if(n>MAX_MEDIA_SEQUENCE_DIFF_FOR_SYNC){videojs.log.warn(`Not saving expired segment info. Media sequence gap ${n} is too large.`);return}for(let r=n-1;r>=0;r--){const s=e.segments[r];if(s&&typeof s.start<"u"){t.syncInfo={mediaSequence:e.mediaSequence+r,time:s.start},this.logger_(`playlist refresh sync: [time:${t.syncInfo.time}, mediaSequence: ${t.syncInfo.mediaSequence}]`),this.trigger("syncinfoupdate");break}}}setDateTimeMappingForStart(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){const t=e.segments[0],n=t.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[t.timeline]=-n}}saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:t}){const n=this.calculateSegmentTimeMapping_(e,e.timingInfo,t),r=e.segment;n&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:r.start}));const s=r.dateTimeObject;r.discontinuity&&t&&s&&(this.timelineToDatetimeMappings[r.timeline]=-(s.getTime()/1e3))}timestampOffsetForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].time}mappingForTimeline(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].mapping}calculateSegmentTimeMapping_(e,t,n){const r=e.segment,s=e.part;let a=this.timelines[e.timeline],l,u;if(typeof e.timestampOffset=="number")a={time:e.startOfSegment,mapping:e.startOfSegment-t.start},n&&(this.timelines[e.timeline]=a,this.trigger("timestampoffset"),this.logger_(`time mapping for timeline ${e.timeline}: [time: ${a.time}] [mapping: ${a.mapping}]`)),l=e.startOfSegment,u=t.end+a.mapping;else if(a)l=t.start+a.mapping,u=t.end+a.mapping;else return!1;return s&&(s.start=l,s.end=u),(!r.start||l<r.start)&&(r.start=l),r.end=u,!0}saveDiscontinuitySyncInfo_(e){const t=e.playlist,n=e.segment;if(n.discontinuity)this.discontinuities[n.timeline]={time:n.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(let r=0;r<t.discontinuityStarts.length;r++){const s=t.discontinuityStarts[r],a=t.discontinuitySequence+r+1,l=s-e.mediaIndex,u=Math.abs(l);if(!this.discontinuities[a]||this.discontinuities[a].accuracy>u){let d;l<0?d=n.start-sumDurations({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex,endIndex:s}):d=n.end+sumDurations({defaultDuration:t.targetDuration,durationList:t.segments,startIndex:e.mediaIndex+1,endIndex:s}),this.discontinuities[a]={time:d,accuracy:u}}}}dispose(){this.trigger("dispose"),this.off()}}class TimelineChangeController extends videojs.EventTarget{constructor(){super(),this.pendingTimelineChanges_={},this.lastTimelineChanges_={}}clearPendingTimelineChange(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")}pendingTimelineChange({type:e,from:t,to:n}){return typeof t=="number"&&typeof n=="number"&&(this.pendingTimelineChanges_[e]={type:e,from:t,to:n},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]}lastTimelineChange({type:e,from:t,to:n}){if(typeof t=="number"&&typeof n=="number"){this.lastTimelineChanges_[e]={type:e,from:t,to:n},delete this.pendingTimelineChanges_[e];const r={timelineChangeInfo:{from:t,to:n}};this.trigger({type:"timelinechange",metadata:r})}return this.lastTimelineChanges_[e]}dispose(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()}}const workerCode=transform(getWorkerString(function(){var i=(function(){function _(){this.listeners={}}var b=_.prototype;return b.on=function(A,z){this.listeners[A]||(this.listeners[A]=[]),this.listeners[A].push(z)},b.off=function(A,z){if(!this.listeners[A])return!1;var D=this.listeners[A].indexOf(z);return this.listeners[A]=this.listeners[A].slice(0),this.listeners[A].splice(D,1),D>-1},b.trigger=function(A){var z=this.listeners[A];if(z)if(arguments.length===2)for(var D=z.length,P=0;P<D;++P)z[P].call(this,arguments[1]);else for(var G=Array.prototype.slice.call(arguments,1),R=z.length,I=0;I<R;++I)z[I].apply(this,G)},b.dispose=function(){this.listeners={}},b.pipe=function(A){this.on("data",function(z){A.push(z)})},_})();function e(_){return _.subarray(0,_.byteLength-_[_.byteLength-1])}const t=function(){const _=[[[],[],[],[],[]],[[],[],[],[],[]]],b=_[0],E=_[1],A=b[4],z=E[4];let D,P,G;const R=[],I=[];let w,H,V,te,ae,be;for(D=0;D<256;D++)I[(R[D]=D<<1^(D>>7)*283)^D]=D;for(P=G=0;!A[P];P^=w||1,G=I[G]||1)for(te=G^G<<1^G<<2^G<<3^G<<4,te=te>>8^te&255^99,A[P]=te,z[te]=P,V=R[H=R[w=R[P]]],be=V*16843009^H*65537^w*257^P*16843008,ae=R[te]*257^te*16843008,D=0;D<4;D++)b[D][P]=ae=ae<<24^ae>>>8,E[D][te]=be=be<<24^be>>>8;for(D=0;D<5;D++)b[D]=b[D].slice(0),E[D]=E[D].slice(0);return _};let n=null;class r{constructor(b){n||(n=t()),this._tables=[[n[0][0].slice(),n[0][1].slice(),n[0][2].slice(),n[0][3].slice(),n[0][4].slice()],[n[1][0].slice(),n[1][1].slice(),n[1][2].slice(),n[1][3].slice(),n[1][4].slice()]];let E,A,z;const D=this._tables[0][4],P=this._tables[1],G=b.length;let R=1;if(G!==4&&G!==6&&G!==8)throw new Error("Invalid aes key size");const I=b.slice(0),w=[];for(this._key=[I,w],E=G;E<4*G+28;E++)z=I[E-1],(E%G===0||G===8&&E%G===4)&&(z=D[z>>>24]<<24^D[z>>16&255]<<16^D[z>>8&255]<<8^D[z&255],E%G===0&&(z=z<<8^z>>>24^R<<24,R=R<<1^(R>>7)*283)),I[E]=I[E-G]^z;for(A=0;E;A++,E--)z=I[A&3?E:E-4],E<=4||A<4?w[A]=z:w[A]=P[0][D[z>>>24]]^P[1][D[z>>16&255]]^P[2][D[z>>8&255]]^P[3][D[z&255]]}decrypt(b,E,A,z,D,P){const G=this._key[1];let R=b^G[0],I=z^G[1],w=A^G[2],H=E^G[3],V,te,ae;const be=G.length/4-2;let _e,le=4;const ue=this._tables[1],oe=ue[0],ee=ue[1],se=ue[2],re=ue[3],fe=ue[4];for(_e=0;_e<be;_e++)V=oe[R>>>24]^ee[I>>16&255]^se[w>>8&255]^re[H&255]^G[le],te=oe[I>>>24]^ee[w>>16&255]^se[H>>8&255]^re[R&255]^G[le+1],ae=oe[w>>>24]^ee[H>>16&255]^se[R>>8&255]^re[I&255]^G[le+2],H=oe[H>>>24]^ee[R>>16&255]^se[I>>8&255]^re[w&255]^G[le+3],le+=4,R=V,I=te,w=ae;for(_e=0;_e<4;_e++)D[(3&-_e)+P]=fe[R>>>24]<<24^fe[I>>16&255]<<16^fe[w>>8&255]<<8^fe[H&255]^G[le++],V=R,R=I,I=w,w=H,H=V}}class s extends i{constructor(){super(i),this.jobs=[],this.delay=1,this.timeout_=null}processJob_(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null}push(b){this.jobs.push(b),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}const a=function(_){return _<<24|(_&65280)<<8|(_&16711680)>>8|_>>>24},l=function(_,b,E){const A=new Int32Array(_.buffer,_.byteOffset,_.byteLength>>2),z=new r(Array.prototype.slice.call(b)),D=new Uint8Array(_.byteLength),P=new Int32Array(D.buffer);let G,R,I,w,H,V,te,ae,be;for(G=E[0],R=E[1],I=E[2],w=E[3],be=0;be<A.length;be+=4)H=a(A[be]),V=a(A[be+1]),te=a(A[be+2]),ae=a(A[be+3]),z.decrypt(H,V,te,ae,P,be),P[be]=a(P[be]^G),P[be+1]=a(P[be+1]^R),P[be+2]=a(P[be+2]^I),P[be+3]=a(P[be+3]^w),G=H,R=V,I=te,w=ae;return D};class u{constructor(b,E,A,z){const D=u.STEP,P=new Int32Array(b.buffer),G=new Uint8Array(b.byteLength);let R=0;for(this.asyncStream_=new s,this.asyncStream_.push(this.decryptChunk_(P.subarray(R,R+D),E,A,G)),R=D;R<P.length;R+=D)A=new Uint32Array([a(P[R-4]),a(P[R-3]),a(P[R-2]),a(P[R-1])]),this.asyncStream_.push(this.decryptChunk_(P.subarray(R,R+D),E,A,G));this.asyncStream_.push(function(){z(null,e(G))})}static get STEP(){return 32e3}decryptChunk_(b,E,A,z){return function(){const D=l(b,E,A);z.set(D,b.byteOffset)}}}var d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},h;typeof window<"u"?h=window:typeof d<"u"?h=d:typeof self<"u"?h=self:h={};var p=h,m=function(b){return ArrayBuffer.isView==="function"?ArrayBuffer.isView(b):b&&b.buffer instanceof ArrayBuffer},g=p.BigInt||Number;g("0x1"),g("0x100"),g("0x10000"),g("0x1000000"),g("0x100000000"),g("0x10000000000"),g("0x1000000000000"),g("0x100000000000000"),g("0x10000000000000000"),(function(){var _=new Uint16Array([65484]),b=new Uint8Array(_.buffer,_.byteOffset,_.byteLength);return b[0]===255?"big":b[0]===204?"little":"unknown"})();const v=function(_){const b={};return Object.keys(_).forEach(E=>{const A=_[E];m(A)?b[E]={bytes:A.buffer,byteOffset:A.byteOffset,byteLength:A.byteLength}:b[E]=A}),b};self.onmessage=function(_){const b=_.data,E=new Uint8Array(b.encrypted.bytes,b.encrypted.byteOffset,b.encrypted.byteLength),A=new Uint32Array(b.key.bytes,b.key.byteOffset,b.key.byteLength/4),z=new Uint32Array(b.iv.bytes,b.iv.byteOffset,b.iv.byteLength/4);new u(E,A,z,function(D,P){self.postMessage(v({source:b.source,decrypted:P}),[P.buffer])})}}));var Decrypter=factory(workerCode);const audioTrackKind_=i=>{let e=i.default?"main":"alternative";return i.characteristics&&i.characteristics.indexOf("public.accessibility.describes-video")>=0&&(e="main-desc"),e},stopLoaders=(i,e)=>{i.abort(),i.pause(),e&&e.activePlaylistLoader&&(e.activePlaylistLoader.pause(),e.activePlaylistLoader=null)},startLoaders=(i,e)=>{e.activePlaylistLoader=i,i.load()},onGroupChanged=(i,e)=>()=>{const{segmentLoaders:{[i]:t,main:n},mediaTypes:{[i]:r}}=e,s=r.activeTrack(),a=r.getActiveGroup(),l=r.activePlaylistLoader,u=r.lastGroup_;if(!(a&&u&&a.id===u.id)&&(r.lastGroup_=a,r.lastTrack_=s,stopLoaders(t,r),!(!a||a.isMainPlaylist))){if(!a.playlistLoader){l&&n.resetEverything();return}t.resyncLoader(),startLoaders(a.playlistLoader,r)}},onGroupChanging=(i,e)=>()=>{const{segmentLoaders:{[i]:t},mediaTypes:{[i]:n}}=e;n.lastGroup_=null,t.abort(),t.pause()},onTrackChanged=(i,e)=>()=>{const{mainPlaylistLoader:t,segmentLoaders:{[i]:n,main:r},mediaTypes:{[i]:s}}=e,a=s.activeTrack(),l=s.getActiveGroup(),u=s.activePlaylistLoader,d=s.lastTrack_;if(!(d&&a&&d.id===a.id)&&(s.lastGroup_=l,s.lastTrack_=a,stopLoaders(n,s),!!l)){if(l.isMainPlaylist){if(!a||!d||a.id===d.id)return;const h=e.vhs.playlistController_,p=h.selectPlaylist();if(h.media()===p)return;s.logger_(`track change. Switching main audio from ${d.id} to ${a.id}`),t.pause(),r.resetEverything(),h.fastQualityChange_(p);return}if(i==="AUDIO"){if(!l.playlistLoader){r.setAudio(!0),r.resetEverything();return}n.setAudio(!0),r.setAudio(!1)}if(u===l.playlistLoader){startLoaders(l.playlistLoader,s);return}n.track&&n.track(a),n.resetEverything(),startLoaders(l.playlistLoader,s)}},onError={AUDIO:(i,e)=>()=>{const{mediaTypes:{[i]:t},excludePlaylist:n}=e,r=t.activeTrack(),s=t.activeGroup(),a=(s.filter(u=>u.default)[0]||s[0]).id,l=t.tracks[a];if(r===l){n({error:{message:"Problem encountered loading the default audio track."}});return}videojs.log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(const u in t.tracks)t.tracks[u].enabled=t.tracks[u]===l;t.onTrackChanged()},SUBTITLES:(i,e)=>()=>{const{mediaTypes:{[i]:t}}=e;videojs.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");const n=t.activeTrack();n&&(n.mode="disabled"),t.onTrackChanged()}},setupListeners={AUDIO:(i,e,t)=>{if(!e)return;const{tech:n,requestOptions:r,segmentLoaders:{[i]:s}}=t;e.on("loadedmetadata",()=>{const a=e.media();s.playlist(a,r),(!n.paused()||a.endList&&n.preload()!=="none")&&s.load()}),e.on("loadedplaylist",()=>{s.playlist(e.media(),r),n.paused()||s.load()}),e.on("error",onError[i](i,t))},SUBTITLES:(i,e,t)=>{const{tech:n,requestOptions:r,segmentLoaders:{[i]:s},mediaTypes:{[i]:a}}=t;e.on("loadedmetadata",()=>{const l=e.media();s.playlist(l,r),s.track(a.activeTrack()),(!n.paused()||l.endList&&n.preload()!=="none")&&s.load()}),e.on("loadedplaylist",()=>{s.playlist(e.media(),r),n.paused()||s.load()}),e.on("error",onError[i](i,t))}},initialize={AUDIO:(i,e)=>{const{vhs:t,sourceType:n,segmentLoaders:{[i]:r},requestOptions:s,main:{mediaGroups:a},mediaTypes:{[i]:{groups:l,tracks:u,logger_:d}},mainPlaylistLoader:h}=e,p=isAudioOnly(h.main);(!a[i]||Object.keys(a[i]).length===0)&&(a[i]={main:{default:{default:!0}}},p&&(a[i].main.default.playlists=h.main.playlists));for(const m in a[i]){l[m]||(l[m]=[]);for(const g in a[i][m]){let v=a[i][m][g],_;if(p?(d(`AUDIO group '${m}' label '${g}' is a main playlist`),v.isMainPlaylist=!0,_=null):n==="vhs-json"&&v.playlists?_=new PlaylistLoader(v.playlists[0],t,s):v.resolvedUri?_=new PlaylistLoader(v.resolvedUri,t,s):v.playlists&&n==="dash"?_=new DashPlaylistLoader(v.playlists[0],t,s,h):_=null,v=merge({id:g,playlistLoader:_},v),setupListeners[i](i,v.playlistLoader,e),l[m].push(v),typeof u[g]>"u"){const b=new videojs.AudioTrack({id:g,kind:audioTrackKind_(v),enabled:!1,language:v.language,default:v.default,label:g});u[g]=b}}}r.on("error",onError[i](i,e))},SUBTITLES:(i,e)=>{const{tech:t,vhs:n,sourceType:r,segmentLoaders:{[i]:s},requestOptions:a,main:{mediaGroups:l},mediaTypes:{[i]:{groups:u,tracks:d}},mainPlaylistLoader:h}=e;for(const p in l[i]){u[p]||(u[p]=[]);for(const m in l[i][p]){if(!n.options_.useForcedSubtitles&&l[i][p][m].forced)continue;let g=l[i][p][m],v;if(r==="hls")v=new PlaylistLoader(g.resolvedUri,n,a);else if(r==="dash"){if(!g.playlists.filter(b=>b.excludeUntil!==1/0).length)return;v=new DashPlaylistLoader(g.playlists[0],n,a,h)}else r==="vhs-json"&&(v=new PlaylistLoader(g.playlists?g.playlists[0]:g.resolvedUri,n,a));if(g=merge({id:m,playlistLoader:v},g),setupListeners[i](i,g.playlistLoader,e),u[p].push(g),typeof d[m]>"u"){const _=t.addRemoteTextTrack({id:m,kind:"subtitles",default:g.default&&g.autoselect,language:g.language,label:m},!1).track;d[m]=_}}}s.on("error",onError[i](i,e))},"CLOSED-CAPTIONS":(i,e)=>{const{tech:t,main:{mediaGroups:n},mediaTypes:{[i]:{groups:r,tracks:s}}}=e;for(const a in n[i]){r[a]||(r[a]=[]);for(const l in n[i][a]){const u=n[i][a][l];if(!/^(?:CC|SERVICE)/.test(u.instreamId))continue;const d=t.options_.vhs&&t.options_.vhs.captionServices||{};let h={label:l,language:u.language,instreamId:u.instreamId,default:u.default&&u.autoselect};if(d[h.instreamId]&&(h=merge(h,d[h.instreamId])),h.default===void 0&&delete h.default,r[a].push(merge({id:l},u)),typeof s[l]>"u"){const p=t.addRemoteTextTrack({id:h.instreamId,kind:"captions",default:h.default,language:h.language,label:h.label},!1).track;s[l]=p}}}}},groupMatch=(i,e)=>{for(let t=0;t<i.length;t++)if(playlistMatch(e,i[t])||i[t].playlists&&groupMatch(i[t].playlists,e))return!0;return!1},activeGroup=(i,e)=>t=>{const{mainPlaylistLoader:n,mediaTypes:{[i]:{groups:r}}}=e,s=n.media();if(!s)return null;let a=null;s.attributes[i]&&(a=r[s.attributes[i]]);const l=Object.keys(r);if(!a)if(i==="AUDIO"&&l.length>1&&isAudioOnly(e.main))for(let u=0;u<l.length;u++){const d=r[l[u]];if(groupMatch(d,s)){a=d;break}}else r.main?a=r.main:l.length===1&&(a=r[l[0]]);return typeof t>"u"?a:t===null||!a?null:a.filter(u=>u.id===t.id)[0]||null},activeTrack={AUDIO:(i,e)=>()=>{const{mediaTypes:{[i]:{tracks:t}}}=e;for(const n in t)if(t[n].enabled)return t[n];return null},SUBTITLES:(i,e)=>()=>{const{mediaTypes:{[i]:{tracks:t}}}=e;for(const n in t)if(t[n].mode==="showing"||t[n].mode==="hidden")return t[n];return null}},getActiveGroup=(i,{mediaTypes:e})=>()=>{const t=e[i].activeTrack();return t?e[i].activeGroup(t):null},setupMediaGroups=i=>{["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(d=>{initialize[d](d,i)});const{mediaTypes:e,mainPlaylistLoader:t,tech:n,vhs:r,segmentLoaders:{["AUDIO"]:s,main:a}}=i;["AUDIO","SUBTITLES"].forEach(d=>{e[d].activeGroup=activeGroup(d,i),e[d].activeTrack=activeTrack[d](d,i),e[d].onGroupChanged=onGroupChanged(d,i),e[d].onGroupChanging=onGroupChanging(d,i),e[d].onTrackChanged=onTrackChanged(d,i),e[d].getActiveGroup=getActiveGroup(d,i)});const l=e.AUDIO.activeGroup();if(l){const d=(l.filter(p=>p.default)[0]||l[0]).id;e.AUDIO.tracks[d].enabled=!0,e.AUDIO.onGroupChanged(),e.AUDIO.onTrackChanged(),e.AUDIO.getActiveGroup().playlistLoader?(a.setAudio(!1),s.setAudio(!0)):a.setAudio(!0)}t.on("mediachange",()=>{["AUDIO","SUBTITLES"].forEach(d=>e[d].onGroupChanged())}),t.on("mediachanging",()=>{["AUDIO","SUBTITLES"].forEach(d=>e[d].onGroupChanging())});const u=()=>{e.AUDIO.onTrackChanged(),n.trigger({type:"usage",name:"vhs-audio-change"})};n.audioTracks().addEventListener("change",u),n.remoteTextTracks().addEventListener("change",e.SUBTITLES.onTrackChanged),r.on("dispose",()=>{n.audioTracks().removeEventListener("change",u),n.remoteTextTracks().removeEventListener("change",e.SUBTITLES.onTrackChanged)}),n.clearTracks("audio");for(const d in e.AUDIO.tracks)n.audioTracks().addTrack(e.AUDIO.tracks[d])},createMediaTypes=()=>{const i={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{i[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:noop,activeTrack:noop,getActiveGroup:noop,onGroupChanged:noop,onTrackChanged:noop,lastTrack_:null,logger_:logger(`MediaGroups[${e}]`)}}),i};class SteeringManifest{constructor(){this.priority_=[],this.pathwayClones_=new Map}set version(e){e===1&&(this.version_=e)}set ttl(e){this.ttl_=e||300}set reloadUri(e){e&&(this.reloadUri_=resolveUrl(this.reloadUri_,e))}set priority(e){e&&e.length&&(this.priority_=e)}set pathwayClones(e){e&&e.length&&(this.pathwayClones_=new Map(e.map(t=>[t.ID,t])))}get version(){return this.version_}get ttl(){return this.ttl_}get reloadUri(){return this.reloadUri_}get priority(){return this.priority_}get pathwayClones(){return this.pathwayClones_}}class ContentSteeringController extends videojs.EventTarget{constructor(e,t){super(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=!1,this.availablePathways_=new Set,this.steeringManifest=new SteeringManifest,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.currentPathwayClones=new Map,this.nextPathwayClones=new Map,this.excludedSteeringManifestURLs=new Set,this.logger_=logger("Content Steering"),this.xhr_=e,this.getBandwidth_=t}assignTagProperties(e,t){this.manifestType_=t.serverUri?"HLS":"DASH";const n=t.serverUri||t.serverURL;if(!n){this.logger_(`steering manifest URL is ${n}, cannot request steering manifest.`),this.trigger("error");return}if(n.startsWith("data:")){this.decodeDataUriManifest_(n.substring(n.indexOf(",")+1));return}this.steeringManifest.reloadUri=resolveUrl(e,n),this.defaultPathway=t.pathwayId||t.defaultServiceLocation,this.queryBeforeStart=t.queryBeforeStart,this.proxyServerUrl_=t.proxyServerURL,this.defaultPathway&&!this.queryBeforeStart&&this.trigger("content-steering")}requestSteeringManifest(e){const t=this.steeringManifest.reloadUri;if(!t)return;const n=e?t:this.getRequestURI(t);if(!n){this.logger_("No valid content steering manifest URIs. Stopping content steering."),this.trigger("error"),this.dispose();return}const r={contentSteeringInfo:{uri:n}};this.trigger({type:"contentsteeringloadstart",metadata:r}),this.request_=this.xhr_({uri:n,requestType:"content-steering-manifest"},(s,a)=>{if(s){if(a.status===410){this.logger_(`manifest request 410 ${s}.`),this.logger_(`There will be no more content steering requests to ${n} this session.`),this.excludedSteeringManifestURLs.add(n);return}if(a.status===429){const d=a.responseHeaders["retry-after"];this.logger_(`manifest request 429 ${s}.`),this.logger_(`content steering will retry in ${d} seconds.`),this.startTTLTimeout_(parseInt(d,10));return}this.logger_(`manifest failed to load ${s}.`),this.startTTLTimeout_();return}this.trigger({type:"contentsteeringloadcomplete",metadata:r});let l;try{l=JSON.parse(this.request_.responseText)}catch(d){const h={errorType:videojs.Error.StreamingContentSteeringParserError,error:d};this.trigger({type:"error",metadata:h})}this.assignSteeringProperties_(l);const u={contentSteeringInfo:r.contentSteeringInfo,contentSteeringManifest:{version:this.steeringManifest.version,reloadUri:this.steeringManifest.reloadUri,priority:this.steeringManifest.priority}};this.trigger({type:"contentsteeringparsed",metadata:u}),this.startTTLTimeout_()})}setProxyServerUrl_(e){const t=new window$1.URL(e),n=new window$1.URL(this.proxyServerUrl_);return n.searchParams.set("url",encodeURI(t.toString())),this.setSteeringParams_(n.toString())}decodeDataUriManifest_(e){const t=JSON.parse(window$1.atob(e));this.assignSteeringProperties_(t)}setSteeringParams_(e){const t=new window$1.URL(e),n=this.getPathway(),r=this.getBandwidth_();if(n){const s=`_${this.manifestType_}_pathway`;t.searchParams.set(s,n)}if(r){const s=`_${this.manifestType_}_throughput`;t.searchParams.set(s,r)}return t.toString()}assignSteeringProperties_(e){if(this.steeringManifest.version=e.VERSION,!this.steeringManifest.version){this.logger_(`manifest version is ${e.VERSION}, which is not supported.`),this.trigger("error");return}this.steeringManifest.ttl=e.TTL,this.steeringManifest.reloadUri=e["RELOAD-URI"],this.steeringManifest.priority=e["PATHWAY-PRIORITY"]||e["SERVICE-LOCATION-PRIORITY"],this.steeringManifest.pathwayClones=e["PATHWAY-CLONES"],this.nextPathwayClones=this.steeringManifest.pathwayClones,this.availablePathways_.size||(this.logger_("There are no available pathways for content steering. Ending content steering."),this.trigger("error"),this.dispose());const n=(r=>{for(const s of r)if(this.availablePathways_.has(s))return s;return[...this.availablePathways_][0]})(this.steeringManifest.priority);this.currentPathway!==n&&(this.currentPathway=n,this.trigger("content-steering"))}getPathway(){return this.currentPathway||this.defaultPathway}getRequestURI(e){if(!e)return null;const t=r=>this.excludedSteeringManifestURLs.has(r);if(this.proxyServerUrl_){const r=this.setProxyServerUrl_(e);if(!t(r))return r}const n=this.setSteeringParams_(e);return t(n)?null:n}startTTLTimeout_(e=this.steeringManifest.ttl){const t=e*1e3;this.ttlTimeout_=window$1.setTimeout(()=>{this.requestSteeringManifest()},t)}clearTTLTimeout_(){window$1.clearTimeout(this.ttlTimeout_),this.ttlTimeout_=null}abort(){this.request_&&this.request_.abort(),this.request_=null}dispose(){this.off("content-steering"),this.off("error"),this.abort(),this.clearTTLTimeout_(),this.currentPathway=null,this.defaultPathway=null,this.queryBeforeStart=null,this.proxyServerUrl_=null,this.manifestType_=null,this.ttlTimeout_=null,this.request_=null,this.excludedSteeringManifestURLs=new Set,this.availablePathways_=new Set,this.steeringManifest=new SteeringManifest}addAvailablePathway(e){e&&this.availablePathways_.add(e)}clearAvailablePathways(){this.availablePathways_.clear()}excludePathway(e){return this.availablePathways_.delete(e)}didDASHTagChange(e,t){return!t&&this.steeringManifest.reloadUri||t&&(resolveUrl(e,t.serverURL)!==this.steeringManifest.reloadUri||t.defaultServiceLocation!==this.defaultPathway||t.queryBeforeStart!==this.queryBeforeStart||t.proxyServerURL!==this.proxyServerUrl_)}getAvailablePathways(){return this.availablePathways_}}const debounce=(i,e)=>{let t=null;return(...n)=>{clearTimeout(t),t=setTimeout(()=>{i.apply(null,n)},e)}},ABORT_EARLY_EXCLUSION_SECONDS=10;let Vhs$1;const loaderStats=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],sumLoaderStat=function(i){return this.audioSegmentLoader_[i]+this.mainSegmentLoader_[i]},shouldSwitchToMedia=function({currentPlaylist:i,buffered:e,currentTime:t,nextPlaylist:n,bufferLowWaterLine:r,bufferHighWaterLine:s,duration:a,bufferBasedABR:l,log:u}){if(!n)return videojs.log.warn("We received no playlist to switch to. Please check your stream."),!1;const d=`allowing switch ${i&&i.id||"null"} -> ${n.id}`;if(!i)return u(`${d} as current playlist is not set`),!0;if(n.id===i.id)return!1;const h=!!findRange(e,t).length;if(!i.endList)return!h&&typeof i.partTargetDuration=="number"?(u(`not ${d} as current playlist is live llhls, but currentTime isn't in buffered.`),!1):(u(`${d} as current playlist is live`),!0);const p=timeAheadOf(e,t),m=l?Config.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:Config.MAX_BUFFER_LOW_WATER_LINE;if(a<m)return u(`${d} as duration < max low water line (${a} < ${m})`),!0;const g=n.attributes.BANDWIDTH,v=i.attributes.BANDWIDTH;if(g<v&&(!l||p<s)){let _=`${d} as next bandwidth < current bandwidth (${g} < ${v})`;return l&&(_+=` and forwardBuffer < bufferHighWaterLine (${p} < ${s})`),u(_),!0}if((!l||g>v)&&p>=r){let _=`${d} as forwardBuffer >= bufferLowWaterLine (${p} >= ${r})`;return l&&(_+=` and next bandwidth > current bandwidth (${g} > ${v})`),u(_),!0}return u(`not ${d} as no switching criteria met`),!1};class PlaylistController extends videojs.EventTarget{constructor(e){super(),this.fastQualityChange_=debounce(this.fastQualityChange_.bind(this),100);const{src:t,withCredentials:n,tech:r,bandwidth:s,externVhs:a,useCueTags:l,playlistExclusionDuration:u,enableLowInitialPlaylist:d,sourceType:h,cacheEncryptionKeys:p,bufferBasedABR:m,leastPixelDiffSelector:g,captionServices:v,experimentalUseMMS:_}=e;if(!t)throw new Error("A non-empty playlist URL or JSON manifest string is required");let{maxPlaylistRetries:b}=e;(b===null||typeof b>"u")&&(b=1/0),Vhs$1=a,this.bufferBasedABR=!!m,this.leastPixelDiffSelector=!!g,this.withCredentials=n,this.tech_=r,this.vhs_=r.vhs,this.player_=e.player_,this.sourceType_=h,this.useCueTags_=l,this.playlistExclusionDuration=u,this.maxPlaylistRetries=b,this.enableLowInitialPlaylist=d,this.usingManagedMediaSource_=!1,this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType=""),this.requestOptions_={withCredentials:n,maxPlaylistRetries:b,timeout:null},this.on("error",this.pauseLoading),this.mediaTypes_=createMediaTypes(),_&&window$1.ManagedMediaSource?(this.tech_.el_.disableRemotePlayback=!0,this.mediaSource=new window$1.ManagedMediaSource,this.usingManagedMediaSource_=!0,videojs.log("Using ManagedMediaSource")):window$1.MediaSource&&(this.mediaSource=new window$1.MediaSource),this.handleDurationChange_=this.handleDurationChange_.bind(this),this.handleSourceOpen_=this.handleSourceOpen_.bind(this),this.handleSourceEnded_=this.handleSourceEnded_.bind(this),this.load=this.load.bind(this),this.pause=this.pause.bind(this),this.mediaSource.addEventListener("durationchange",this.handleDurationChange_),this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.addEventListener("sourceended",this.handleSourceEnded_),this.mediaSource.addEventListener("startstreaming",this.load),this.mediaSource.addEventListener("endstreaming",this.pause),this.seekable_=createTimeRanges(),this.hasPlayed_=!1,this.syncController_=new SyncController(e),this.segmentMetadataTrack_=r.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,this.segmentMetadataTrack_.mode="hidden",this.decrypter_=new Decrypter,this.sourceUpdater_=new SourceUpdater(this.mediaSource),this.inbandTextTracks_={},this.timelineChangeController_=new TimelineChangeController,this.keyStatusMap_=new Map;const E={vhs:this.vhs_,parse708captions:e.parse708captions,useDtsForTimestampOffset:e.useDtsForTimestampOffset,captionServices:v,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:()=>this.seekable(),seeking:()=>this.tech_.seeking(),duration:()=>this.duration(),hasPlayed:()=>this.hasPlayed_,goalBufferLength:()=>this.goalBufferLength(),bandwidth:s,syncController:this.syncController_,decrypter:this.decrypter_,sourceType:this.sourceType_,inbandTextTracks:this.inbandTextTracks_,cacheEncryptionKeys:p,sourceUpdater:this.sourceUpdater_,timelineChangeController:this.timelineChangeController_,exactManifestTimings:e.exactManifestTimings,addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)};this.mainPlaylistLoader_=this.sourceType_==="dash"?new DashPlaylistLoader(t,this.vhs_,merge(this.requestOptions_,{addMetadataToTextTrack:this.addMetadataToTextTrack.bind(this)})):new PlaylistLoader(t,this.vhs_,merge(this.requestOptions_,{addDateRangesToTextTrack:this.addDateRangesToTextTrack_.bind(this)})),this.setupMainPlaylistLoaderListeners_(),this.mainSegmentLoader_=new SegmentLoader(merge(E,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e),this.audioSegmentLoader_=new SegmentLoader(merge(E,{loaderType:"audio"}),e),this.subtitleSegmentLoader_=new VTTSegmentLoader(merge(E,{loaderType:"vtt",featuresNativeTextTracks:this.tech_.featuresNativeTextTracks,loadVttJs:()=>new Promise((D,P)=>{function G(){r.off("vttjserror",R),D()}function R(){r.off("vttjsloaded",G),P()}r.one("vttjsloaded",G),r.one("vttjserror",R),r.addWebVttScript_()})}),e);const A=()=>this.mainSegmentLoader_.bandwidth;this.contentSteeringController_=new ContentSteeringController(this.vhs_.xhr,A),this.setupSegmentLoaderListeners_(),this.bufferBasedABR&&(this.mainPlaylistLoader_.one("loadedplaylist",()=>this.startABRTimer_()),this.tech_.on("pause",()=>this.stopABRTimer_()),this.tech_.on("play",()=>this.startABRTimer_())),loaderStats.forEach(D=>{this[D+"_"]=sumLoaderStat.bind(this,D)}),this.logger_=logger("pc"),this.triggeredFmp4Usage=!1,this.tech_.preload()==="none"?(this.loadOnPlay_=()=>{this.loadOnPlay_=null,this.mainPlaylistLoader_.load()},this.tech_.one("play",this.loadOnPlay_)):this.mainPlaylistLoader_.load(),this.timeToLoadedData__=-1,this.mainAppendsToLoadedData__=-1,this.audioAppendsToLoadedData__=-1;const z=this.tech_.preload()==="none"?"play":"loadstart";this.tech_.one(z,()=>{const D=Date.now();this.tech_.one("loadeddata",()=>{this.timeToLoadedData__=Date.now()-D,this.mainAppendsToLoadedData__=this.mainSegmentLoader_.mediaAppends,this.audioAppendsToLoadedData__=this.audioSegmentLoader_.mediaAppends})})}mainAppendsToLoadedData_(){return this.mainAppendsToLoadedData__}audioAppendsToLoadedData_(){return this.audioAppendsToLoadedData__}appendsToLoadedData_(){const e=this.mainAppendsToLoadedData_(),t=this.audioAppendsToLoadedData_();return e===-1||t===-1?-1:e+t}timeToLoadedData_(){return this.timeToLoadedData__}checkABR_(e="abr"){const t=this.selectPlaylist();t&&this.shouldSwitchToMedia_(t)&&this.switchMedia_(t,e)}switchMedia_(e,t,n){const r=this.media(),s=r&&(r.id||r.uri),a=e&&(e.id||e.uri);if(s&&s!==a){this.logger_(`switch media ${s} -> ${a} from ${t}`);const l={renditionInfo:{id:a,bandwidth:e.attributes.BANDWIDTH,resolution:e.attributes.RESOLUTION,codecs:e.attributes.CODECS},cause:t};this.trigger({type:"renditionselected",metadata:l}),this.tech_.trigger({type:"usage",name:`vhs-rendition-change-${t}`})}this.mainPlaylistLoader_.media(e,n)}switchMediaForDASHContentSteering_(){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(e=>{const t=this.mediaTypes_[e],n=t?t.activeGroup():null,r=this.contentSteeringController_.getPathway();if(n&&r){const a=(n.length?n[0].playlists:n.playlists).filter(l=>l.attributes.serviceLocation===r);a.length&&this.mediaTypes_[e].activePlaylistLoader.media(a[0])}})}startABRTimer_(){this.stopABRTimer_(),this.abrTimer_=window$1.setInterval(()=>this.checkABR_(),250)}stopABRTimer_(){this.tech_.scrubbing&&this.tech_.scrubbing()||(window$1.clearInterval(this.abrTimer_),this.abrTimer_=null)}getAudioTrackPlaylists_(){const e=this.main(),t=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return t;const n=e.mediaGroups.AUDIO,r=Object.keys(n);let s;if(Object.keys(this.mediaTypes_.AUDIO.groups).length)s=this.mediaTypes_.AUDIO.activeTrack();else{const l=n.main||r.length&&n[r[0]];for(const u in l)if(l[u].default){s={label:u};break}}if(!s)return t;const a=[];for(const l in n)if(n[l][s.label]){const u=n[l][s.label];if(u.playlists&&u.playlists.length)a.push.apply(a,u.playlists);else if(u.uri)a.push(u);else if(e.playlists.length)for(let d=0;d<e.playlists.length;d++){const h=e.playlists[d];h.attributes&&h.attributes.AUDIO&&h.attributes.AUDIO===l&&a.push(h)}}return a.length?a:t}setupMainPlaylistLoaderListeners_(){this.mainPlaylistLoader_.on("loadedmetadata",()=>{const t=this.mainPlaylistLoader_.media(),n=t.targetDuration*1.5*1e3;isLowestEnabledRendition(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=n,t.endList&&this.tech_.preload()!=="none"&&(this.mainSegmentLoader_.playlist(t,this.requestOptions_),this.mainSegmentLoader_.load()),setupMediaGroups({sourceType:this.sourceType_,segmentLoaders:{AUDIO:this.audioSegmentLoader_,SUBTITLES:this.subtitleSegmentLoader_,main:this.mainSegmentLoader_},tech:this.tech_,requestOptions:this.requestOptions_,mainPlaylistLoader:this.mainPlaylistLoader_,vhs:this.vhs_,main:this.main(),mediaTypes:this.mediaTypes_,excludePlaylist:this.excludePlaylist.bind(this)}),this.triggerPresenceUsage_(this.main(),t),this.setupFirstPlay(),!this.mediaTypes_.AUDIO.activePlaylistLoader||this.mediaTypes_.AUDIO.activePlaylistLoader.media()?this.trigger("selectedinitialmedia"):this.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",()=>{this.trigger("selectedinitialmedia")})}),this.mainPlaylistLoader_.on("loadedplaylist",()=>{this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_);let t=this.mainPlaylistLoader_.media();if(!t){this.attachContentSteeringListeners_(),this.initContentSteeringController_(),this.excludeUnsupportedVariants_();let n;if(this.enableLowInitialPlaylist&&(n=this.selectInitialPlaylist()),n||(n=this.selectPlaylist()),!n||!this.shouldSwitchToMedia_(n)||(this.initialMedia_=n,this.switchMedia_(this.initialMedia_,"initial"),!(this.sourceType_==="vhs-json"&&this.initialMedia_.segments)))return;t=this.initialMedia_}this.handleUpdatedMediaPlaylist(t)}),this.mainPlaylistLoader_.on("error",()=>{const t=this.mainPlaylistLoader_.error;this.excludePlaylist({playlistToExclude:t.playlist,error:t})}),this.mainPlaylistLoader_.on("mediachanging",()=>{this.mainSegmentLoader_.abort(),this.mainSegmentLoader_.pause()}),this.mainPlaylistLoader_.on("mediachange",()=>{const t=this.mainPlaylistLoader_.media(),n=t.targetDuration*1.5*1e3;isLowestEnabledRendition(this.mainPlaylistLoader_.main,this.mainPlaylistLoader_.media())?this.requestOptions_.timeout=0:this.requestOptions_.timeout=n,this.sourceType_==="dash"&&this.mainPlaylistLoader_.isPaused&&this.mainPlaylistLoader_.load(),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(t,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_?this.runFastQualitySwitch_():this.mainSegmentLoader_.load(),this.tech_.trigger({type:"mediachange",bubbles:!0})}),this.mainPlaylistLoader_.on("playlistunchanged",()=>{const t=this.mainPlaylistLoader_.media();if(t.lastExcludeReason_==="playlist-unchanged")return;this.stuckAtPlaylistEnd_(t)&&(this.excludePlaylist({error:{message:"Playlist no longer updating.",reason:"playlist-unchanged"}}),this.tech_.trigger("playliststuck"))}),this.mainPlaylistLoader_.on("renditiondisabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"})}),this.mainPlaylistLoader_.on("renditionenabled",()=>{this.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"})}),["manifestrequeststart","manifestrequestcomplete","manifestparsestart","manifestparsecomplete","playlistrequeststart","playlistrequestcomplete","playlistparsestart","playlistparsecomplete","renditiondisabled","renditionenabled"].forEach(t=>{this.mainPlaylistLoader_.on(t,n=>{this.player_.trigger(_extends({},n))})})}handleUpdatedMediaPlaylist(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.waitingForFastQualityPlaylistReceived_&&this.runFastQualitySwitch_(),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())}triggerPresenceUsage_(e,t){const n=e.mediaGroups||{};let r=!0;const s=Object.keys(n.AUDIO);for(const a in n.AUDIO)for(const l in n.AUDIO[a])n.AUDIO[a][l].uri||(r=!1);r&&this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),Object.keys(n.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),Vhs$1.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"vhs-aes"}),s.length&&Object.keys(n.AUDIO[s[0]]).length>1&&this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"})}shouldSwitchToMedia_(e){const t=this.mainPlaylistLoader_.media()||this.mainPlaylistLoader_.pendingMedia_,n=this.tech_.currentTime(),r=this.bufferLowWaterLine(),s=this.bufferHighWaterLine(),a=this.tech_.buffered();return shouldSwitchToMedia({buffered:a,currentTime:n,currentPlaylist:t,nextPlaylist:e,bufferLowWaterLine:r,bufferHighWaterLine:s,duration:this.duration(),bufferBasedABR:this.bufferBasedABR,log:this.logger_})}setupSegmentLoaderListeners_(){this.mainSegmentLoader_.on("bandwidthupdate",()=>{this.checkABR_("bandwidthupdate"),this.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("timeout",()=>{this.bufferBasedABR&&this.mainSegmentLoader_.load()}),this.bufferBasedABR||this.mainSegmentLoader_.on("progress",()=>{this.trigger("progress")}),this.mainSegmentLoader_.on("error",()=>{const n=this.mainSegmentLoader_.error();this.excludePlaylist({playlistToExclude:n.playlist,error:n})}),this.mainSegmentLoader_.on("appenderror",()=>{this.error=this.mainSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",()=>{this.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",()=>{this.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",()=>{this.error=this.audioSegmentLoader_.error_,this.trigger("error")}),this.mainSegmentLoader_.on("ended",()=>{this.logger_("main segment loader ended"),this.onEndOfStream()}),this.timelineChangeController_.on("audioTimelineBehind",()=>{const n=this.audioSegmentLoader_.pendingSegment_;if(!n||!n.segment||!n.segment.syncInfo)return;const r=n.segment.syncInfo.end+.01;this.tech_.setCurrentTime(r)}),this.timelineChangeController_.on("fixBadTimelineChange",()=>{this.logger_("Fix bad timeline change. Restarting al segment loaders..."),this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}),this.mainSegmentLoader_.on("earlyabort",n=>{this.bufferBasedABR||(this.delegateLoaders_("all",["abort"]),this.excludePlaylist({error:{message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},playlistExclusionDuration:ABORT_EARLY_EXCLUSION_SECONDS}))});const e=()=>{if(!this.sourceUpdater_.hasCreatedSourceBuffers())return this.tryToCreateSourceBuffers_();const n=this.getCodecsOrExclude_();n&&this.sourceUpdater_.addOrChangeSourceBuffers(n)};this.mainSegmentLoader_.on("trackinfo",e),this.audioSegmentLoader_.on("trackinfo",e),this.mainSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",()=>{this.triggeredFmp4Usage||(this.tech_.trigger({type:"usage",name:"vhs-fmp4"}),this.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",()=>{this.logger_("audioSegmentLoader ended"),this.onEndOfStream()}),["segmentselected","segmentloadstart","segmentloaded","segmentkeyloadstart","segmentkeyloadcomplete","segmentdecryptionstart","segmentdecryptioncomplete","segmenttransmuxingstart","segmenttransmuxingcomplete","segmenttransmuxingtrackinfoavailable","segmenttransmuxingtiminginfoavailable","segmentappendstart","appendsdone","bandwidthupdated","timelinechange","codecschange"].forEach(n=>{this.mainSegmentLoader_.on(n,r=>{this.player_.trigger(_extends({},r))}),this.audioSegmentLoader_.on(n,r=>{this.player_.trigger(_extends({},r))}),this.subtitleSegmentLoader_.on(n,r=>{this.player_.trigger(_extends({},r))})})}mediaSecondsLoaded_(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}load(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}pause(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}fastQualityChange_(e=this.selectPlaylist()){if(e&&e===this.mainPlaylistLoader_.media()){this.logger_("skipping fastQualityChange because new media is same as old");return}this.switchMedia_(e,"fast-quality"),this.waitingForFastQualityPlaylistReceived_=!0}runFastQualitySwitch_(){this.waitingForFastQualityPlaylistReceived_=!1,this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}play(){if(this.setupFirstPlay())return;this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();const e=this.tech_.seekable();if(this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0))return this.tech_.setCurrentTime(e.end(e.length-1))}setupFirstPlay(){const e=this.mainPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList||e.start){const t=this.seekable();if(!t.length)return!1;const n=t.end(0);let r=n;if(e.start){const s=e.start.timeOffset;s<0?r=Math.max(n+s,t.start(0)):r=Math.min(n,s)}this.trigger("firstplay"),this.tech_.setCurrentTime(r)}return this.hasPlayed_=!0,this.load(),!0}handleSourceOpen_(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){const e=this.tech_.play();typeof e<"u"&&typeof e.then=="function"&&e.then(null,t=>{})}this.trigger("sourceopen")}handleSourceEnded_(){if(!this.inbandTextTracks_.metadataTrack_)return;const e=this.inbandTextTracks_.metadataTrack_.cues;if(!e||!e.length)return;const t=this.duration();e[e.length-1].endTime=isNaN(t)||Math.abs(t)===1/0?Number.MAX_VALUE:t}handleDurationChange_(){this.tech_.trigger("durationchange")}onEndOfStream(){let e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){const t=this.mainSegmentLoader_.getCurrentMediaInfo_();!t||t.hasVideo?e=e&&this.audioSegmentLoader_.ended_:e=this.audioSegmentLoader_.ended_}e&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())}stuckAtPlaylistEnd_(e){if(!this.seekable().length)return!1;const n=this.syncController_.getExpiredTime(e,this.duration());if(n===null)return!1;const r=Vhs$1.Playlist.playlistEnd(e,n),s=this.tech_.currentTime(),a=this.tech_.buffered();if(!a.length)return r-s<=SAFE_TIME_DELTA;const l=a.end(a.length-1);return l-s<=SAFE_TIME_DELTA&&r-l<=SAFE_TIME_DELTA}excludePlaylist({playlistToExclude:e=this.mainPlaylistLoader_.media(),error:t={},playlistExclusionDuration:n}){if(e=e||this.mainPlaylistLoader_.media(),n=n||t.playlistExclusionDuration||this.playlistExclusionDuration,!e){this.error=t,this.mediaSource.readyState!=="open"?this.trigger("error"):this.sourceUpdater_.endOfStream("network");return}e.playlistErrors_++;const r=this.mainPlaylistLoader_.main.playlists,s=r.filter(isEnabled),a=s.length===1&&s[0]===e;if(r.length===1&&n!==1/0)return videojs.log.warn(`Problem encountered with playlist ${e.id}. Trying again since it is the only playlist.`),this.tech_.trigger("retryplaylist"),this.mainPlaylistLoader_.load(a);if(a){if(this.main().contentSteering){const v=this.pathwayAttribute_(e),_=this.contentSteeringController_.steeringManifest.ttl*1e3;this.contentSteeringController_.excludePathway(v),this.excludeThenChangePathway_(),setTimeout(()=>{this.contentSteeringController_.addAvailablePathway(v)},_);return}let g=!1;r.forEach(v=>{if(v===e)return;const _=v.excludeUntil;typeof _<"u"&&_!==1/0&&(g=!0,delete v.excludeUntil)}),g&&(videojs.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}let l;e.playlistErrors_>this.maxPlaylistRetries?l=1/0:l=Date.now()+n*1e3,e.excludeUntil=l,t.reason&&(e.lastExcludeReason_=t.reason),this.tech_.trigger("excludeplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-excluded"});const u=this.selectPlaylist();if(!u){this.error="Playback cannot continue. No available working or supported playlists.",this.trigger("error");return}const d=t.internal?this.logger_:videojs.log.warn,h=t.message?" "+t.message:"";d(`${t.internal?"Internal problem":"Problem"} encountered with playlist ${e.id}.${h} Switching to playlist ${u.id}.`),u.attributes.AUDIO!==e.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),u.attributes.SUBTITLES!==e.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);const p=u.targetDuration/2*1e3||5*1e3,m=typeof u.lastRequest=="number"&&Date.now()-u.lastRequest<=p;return this.switchMedia_(u,"exclude",a||m)}pauseLoading(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()}delegateLoaders_(e,t){const n=[],r=e==="all";(r||e==="main")&&n.push(this.mainPlaylistLoader_);const s=[];(r||e==="audio")&&s.push("AUDIO"),(r||e==="subtitle")&&(s.push("CLOSED-CAPTIONS"),s.push("SUBTITLES")),s.forEach(a=>{const l=this.mediaTypes_[a]&&this.mediaTypes_[a].activePlaylistLoader;l&&n.push(l)}),["main","audio","subtitle"].forEach(a=>{const l=this[`${a}SegmentLoader_`];l&&(e===a||e==="all")&&n.push(l)}),n.forEach(a=>t.forEach(l=>{typeof a[l]=="function"&&a[l]()}))}setCurrentTime(e){const t=findRange(this.tech_.buffered(),e);if(!(this.mainPlaylistLoader_&&this.mainPlaylistLoader_.media())||!this.mainPlaylistLoader_.media().segments)return 0;if(t&&t.length)return e;this.mainSegmentLoader_.pause(),this.mainSegmentLoader_.resetEverything(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.pause(),this.audioSegmentLoader_.resetEverything()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.pause(),this.subtitleSegmentLoader_.resetEverything()),this.load()}duration(){if(!this.mainPlaylistLoader_)return 0;const e=this.mainPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:Vhs$1.Playlist.duration(e):1/0:0}seekable(){return this.seekable_}getSeekableRange_(e,t){const n=e.media();if(!n)return null;const r=this.syncController_.getMediaSequenceSync(t);if(r&&r.isReliable){const l=r.start,u=r.end;if(!isFinite(l)||!isFinite(u))return null;const d=Vhs$1.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,n),h=Math.max(l,u-d);return createTimeRanges([[l,h]])}const s=this.syncController_.getExpiredTime(n,this.duration());if(s===null)return null;const a=Vhs$1.Playlist.seekable(n,s,Vhs$1.Playlist.liveEdgeDelay(this.mainPlaylistLoader_.main,n));return a.length?a:null}computeFinalSeekable_(e,t){if(!t)return e;const n=e.start(0),r=e.end(0),s=t.start(0),a=t.end(0);return s>r||n>a?e:createTimeRanges([[Math.max(n,s),Math.min(r,a)]])}onSyncInfoUpdate_(){if(!this.mainPlaylistLoader_)return;const e=this.getSeekableRange_(this.mainPlaylistLoader_,"main");if(!e)return;let t;if(this.mediaTypes_.AUDIO.activePlaylistLoader&&(t=this.getSeekableRange_(this.mediaTypes_.AUDIO.activePlaylistLoader,"audio"),!t))return;const n=this.seekable_;if(this.seekable_=this.computeFinalSeekable_(e,t),!this.seekable_||n&&n.length&&this.seekable_.length&&n.start(0)===this.seekable_.start(0)&&n.end(0)===this.seekable_.end(0))return;this.logger_(`seekable updated [${printableRange(this.seekable_)}]`);const r={seekableRanges:this.seekable_};this.trigger({type:"seekablerangeschanged",metadata:r}),this.tech_.trigger("seekablechanged")}updateDuration(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),this.mediaSource.readyState!=="open"){this.updateDuration_=this.updateDuration.bind(this,e),this.mediaSource.addEventListener("sourceopen",this.updateDuration_);return}if(e){const r=this.seekable();if(!r.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<r.end(r.length-1))&&this.sourceUpdater_.setDuration(r.end(r.length-1));return}const t=this.tech_.buffered();let n=Vhs$1.Playlist.duration(this.mainPlaylistLoader_.media());t.length>0&&(n=Math.max(n,t.end(t.length-1))),this.mediaSource.duration!==n&&this.sourceUpdater_.setDuration(n)}dispose(){this.trigger("dispose"),this.decrypter_.terminate(),this.mainPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.contentSteeringController_.dispose(),this.keyStatusMap_.clear(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(e=>{const t=this.mediaTypes_[e].groups;for(const n in t)t[n].forEach(r=>{r.playlistLoader&&r.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()}main(){return this.mainPlaylistLoader_.main}media(){return this.mainPlaylistLoader_.media()||this.initialMedia_}areMediaTypesKnown_(){const e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,t=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),n=e?!!this.audioSegmentLoader_.getCurrentMediaInfo_():!0;return!(!t||!n)}getCodecsOrExclude_(){const e={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}},t=this.mainSegmentLoader_.getPendingSegmentPlaylist()||this.media();e.video=e.main;const n=codecsForPlaylist(this.main(),t),r={},s=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(e.main.hasVideo&&(r.video=n.video||e.main.videoCodec||DEFAULT_VIDEO_CODEC),e.main.isMuxed&&(r.video+=`,${n.audio||e.main.audioCodec||DEFAULT_AUDIO_CODEC}`),(e.main.hasAudio&&!e.main.isMuxed||e.audio.hasAudio||s)&&(r.audio=n.audio||e.main.audioCodec||e.audio.audioCodec||DEFAULT_AUDIO_CODEC,e.audio.isFmp4=e.main.hasAudio&&!e.main.isMuxed?e.main.isFmp4:e.audio.isFmp4),!r.audio&&!r.video){this.excludePlaylist({playlistToExclude:t,error:{message:"Could not determine codecs for playlist."},playlistExclusionDuration:1/0});return}const a=(d,h)=>d?browserSupportsCodec(h,this.usingManagedMediaSource_):muxerSupportsCodec(h),l={};let u;if(["video","audio"].forEach(function(d){if(r.hasOwnProperty(d)&&!a(e[d].isFmp4,r[d])){const h=e[d].isFmp4?"browser":"muxer";l[h]=l[h]||[],l[h].push(r[d]),d==="audio"&&(u=h)}}),s&&u&&t.attributes.AUDIO){const d=t.attributes.AUDIO;this.main().playlists.forEach(h=>{(h.attributes&&h.attributes.AUDIO)===d&&h!==t&&(h.excludeUntil=1/0)}),this.logger_(`excluding audio group ${d} as ${u} does not support codec(s): "${r.audio}"`)}if(Object.keys(l).length){const d=Object.keys(l).reduce((h,p)=>(h&&(h+=", "),h+=`${p} does not support codec(s): "${l[p].join(",")}"`,h),"")+".";this.excludePlaylist({playlistToExclude:t,error:{internal:!0,message:d},playlistExclusionDuration:1/0});return}if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){const d=[];if(["video","audio"].forEach(h=>{const p=(parseCodecs(this.sourceUpdater_.codecs[h]||"")[0]||{}).type,m=(parseCodecs(r[h]||"")[0]||{}).type;p&&m&&p.toLowerCase()!==m.toLowerCase()&&d.push(`"${this.sourceUpdater_.codecs[h]}" -> "${r[h]}"`)}),d.length){this.excludePlaylist({playlistToExclude:t,error:{message:`Codec switching not supported: ${d.join(", ")}.`,internal:!0},playlistExclusionDuration:1/0});return}}return r}tryToCreateSourceBuffers_(){if(this.mediaSource.readyState!=="open"||this.sourceUpdater_.hasCreatedSourceBuffers()||!this.areMediaTypesKnown_())return;const e=this.getCodecsOrExclude_();if(!e)return;this.sourceUpdater_.createSourceBuffers(e);const t=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(t)}excludeUnsupportedVariants_(){const e=this.main().playlists,t=[];Object.keys(e).forEach(n=>{const r=e[n];if(t.indexOf(r.id)!==-1)return;t.push(r.id);const s=codecsForPlaylist(this.main,r),a=[];s.audio&&!muxerSupportsCodec(s.audio)&&!browserSupportsCodec(s.audio,this.usingManagedMediaSource_)&&a.push(`audio codec ${s.audio}`),s.video&&!muxerSupportsCodec(s.video)&&!browserSupportsCodec(s.video,this.usingManagedMediaSource_)&&a.push(`video codec ${s.video}`),s.text&&s.text==="stpp.ttml.im1t"&&a.push(`text codec ${s.text}`),a.length&&(r.excludeUntil=1/0,this.logger_(`excluding ${r.id} for unsupported: ${a.join(", ")}`))})}excludeIncompatibleVariants_(e){const t=[],n=this.main().playlists,r=unwrapCodecList(parseCodecs(e)),s=codecCount(r),a=r.video&&parseCodecs(r.video)[0]||null,l=r.audio&&parseCodecs(r.audio)[0]||null;Object.keys(n).forEach(u=>{const d=n[u];if(t.indexOf(d.id)!==-1||d.excludeUntil===1/0)return;t.push(d.id);const h=[],p=codecsForPlaylist(this.mainPlaylistLoader_.main,d),m=codecCount(p);if(!(!p.audio&&!p.video)){if(m!==s&&h.push(`codec count "${m}" !== "${s}"`),!this.sourceUpdater_.canChangeType()){const g=p.video&&parseCodecs(p.video)[0]||null,v=p.audio&&parseCodecs(p.audio)[0]||null;g&&a&&g.type.toLowerCase()!==a.type.toLowerCase()&&h.push(`video codec "${g.type}" !== "${a.type}"`),v&&l&&v.type.toLowerCase()!==l.type.toLowerCase()&&h.push(`audio codec "${v.type}" !== "${l.type}"`)}h.length&&(d.excludeUntil=1/0,this.logger_(`excluding ${d.id}: ${h.join(" && ")}`))}})}updateAdCues_(e){let t=0;const n=this.seekable();n.length&&(t=n.start(0)),updateAdCues(e,this.cueTagsTrack_,t)}goalBufferLength(){const e=this.tech_.currentTime(),t=Config.GOAL_BUFFER_LENGTH,n=Config.GOAL_BUFFER_LENGTH_RATE,r=Math.max(t,Config.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*n,r)}bufferLowWaterLine(){const e=this.tech_.currentTime(),t=Config.BUFFER_LOW_WATER_LINE,n=Config.BUFFER_LOW_WATER_LINE_RATE,r=Math.max(t,Config.MAX_BUFFER_LOW_WATER_LINE),s=Math.max(t,Config.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*n,this.bufferBasedABR?s:r)}bufferHighWaterLine(){return Config.BUFFER_HIGH_WATER_LINE}addDateRangesToTextTrack_(e){createMetadataTrackIfNotExists(this.inbandTextTracks_,"com.apple.streaming",this.tech_),addDateRangeMetadata({inbandTextTracks:this.inbandTextTracks_,dateRanges:e})}addMetadataToTextTrack(e,t,n){const r=this.sourceUpdater_.videoBuffer?this.sourceUpdater_.videoTimestampOffset():this.sourceUpdater_.audioTimestampOffset();createMetadataTrackIfNotExists(this.inbandTextTracks_,e,this.tech_),addMetadata({inbandTextTracks:this.inbandTextTracks_,metadataArray:t,timestampOffset:r,videoDuration:n})}pathwayAttribute_(e){return e.attributes["PATHWAY-ID"]||e.attributes.serviceLocation}initContentSteeringController_(){const e=this.main();if(e.contentSteering){for(const t of e.playlists)this.contentSteeringController_.addAvailablePathway(this.pathwayAttribute_(t));if(this.contentSteeringController_.assignTagProperties(e.uri,e.contentSteering),this.contentSteeringController_.queryBeforeStart){this.contentSteeringController_.requestSteeringManifest(!0);return}this.tech_.one("canplay",()=>{this.contentSteeringController_.requestSteeringManifest()})}}resetContentSteeringController_(){this.contentSteeringController_.clearAvailablePathways(),this.contentSteeringController_.dispose(),this.initContentSteeringController_()}attachContentSteeringListeners_(){this.contentSteeringController_.on("content-steering",this.excludeThenChangePathway_.bind(this)),["contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"].forEach(t=>{this.contentSteeringController_.on(t,n=>{this.trigger(_extends({},n))})}),this.sourceType_==="dash"&&this.mainPlaylistLoader_.on("loadedplaylist",()=>{const t=this.main();(this.contentSteeringController_.didDASHTagChange(t.uri,t.contentSteering)||(()=>{const s=this.contentSteeringController_.getAvailablePathways(),a=[];for(const l of t.playlists){const u=l.attributes.serviceLocation;if(u&&(a.push(u),!s.has(u)))return!0}return!!(!a.length&&s.size)})())&&this.resetContentSteeringController_()})}excludeThenChangePathway_(){const e=this.contentSteeringController_.getPathway();if(!e)return;this.handlePathwayClones_();const n=this.main().playlists,r=new Set;let s=!1;Object.keys(n).forEach(a=>{const l=n[a],u=this.pathwayAttribute_(l),d=u&&e!==u;l.excludeUntil===1/0&&l.lastExcludeReason_==="content-steering"&&!d&&(delete l.excludeUntil,delete l.lastExcludeReason_,s=!0);const p=!l.excludeUntil&&l.excludeUntil!==1/0;!r.has(l.id)&&d&&p&&(r.add(l.id),l.excludeUntil=1/0,l.lastExcludeReason_="content-steering",this.logger_(`excluding ${l.id} for ${l.lastExcludeReason_}`))}),this.contentSteeringController_.manifestType_==="DASH"&&Object.keys(this.mediaTypes_).forEach(a=>{const l=this.mediaTypes_[a];if(l.activePlaylistLoader){const u=l.activePlaylistLoader.media_;u&&u.attributes.serviceLocation!==e&&(s=!0)}}),s&&this.changeSegmentPathway_()}handlePathwayClones_(){const t=this.main().playlists,n=this.contentSteeringController_.currentPathwayClones,r=this.contentSteeringController_.nextPathwayClones;if(n&&n.size||r&&r.size){for(const[a,l]of n.entries())r.get(a)||(this.mainPlaylistLoader_.updateOrDeleteClone(l),this.contentSteeringController_.excludePathway(a));for(const[a,l]of r.entries()){const u=n.get(a);if(!u){t.filter(h=>h.attributes["PATHWAY-ID"]===l["BASE-ID"]).forEach(h=>{this.mainPlaylistLoader_.addClonePathway(l,h)}),this.contentSteeringController_.addAvailablePathway(a);continue}this.equalPathwayClones_(u,l)||(this.mainPlaylistLoader_.updateOrDeleteClone(l,!0),this.contentSteeringController_.addAvailablePathway(a))}this.contentSteeringController_.currentPathwayClones=new Map(JSON.parse(JSON.stringify([...r])))}}equalPathwayClones_(e,t){if(e["BASE-ID"]!==t["BASE-ID"]||e.ID!==t.ID||e["URI-REPLACEMENT"].HOST!==t["URI-REPLACEMENT"].HOST)return!1;const n=e["URI-REPLACEMENT"].PARAMS,r=t["URI-REPLACEMENT"].PARAMS;for(const s in n)if(n[s]!==r[s])return!1;for(const s in r)if(n[s]!==r[s])return!1;return!0}changeSegmentPathway_(){const e=this.selectPlaylist();this.pauseLoading(),this.contentSteeringController_.manifestType_==="DASH"&&this.switchMediaForDASHContentSteering_(),this.switchMedia_(e,"content-steering")}excludeNonUsablePlaylistsByKeyId_(){if(!this.mainPlaylistLoader_||!this.mainPlaylistLoader_.main)return;let e=0;const t="non-usable";this.mainPlaylistLoader_.main.playlists.forEach(n=>{const r=this.mainPlaylistLoader_.getKeyIdSet(n);!r||!r.size||r.forEach(s=>{const a="usable",l=this.keyStatusMap_.has(s)&&this.keyStatusMap_.get(s)===a,u=n.lastExcludeReason_===t&&n.excludeUntil===1/0;l?l&&u&&(delete n.excludeUntil,delete n.lastExcludeReason_,this.logger_(`enabling playlist ${n.id} because key ID ${s} is ${a}`)):(n.excludeUntil!==1/0&&n.lastExcludeReason_!==t&&(n.excludeUntil=1/0,n.lastExcludeReason_=t,this.logger_(`excluding playlist ${n.id} because the key ID ${s} doesn't exist in the keyStatusMap or is not ${a}`)),e++)})}),e>=this.mainPlaylistLoader_.main.playlists.length&&this.mainPlaylistLoader_.main.playlists.forEach(n=>{const r=n&&n.attributes&&n.attributes.RESOLUTION&&n.attributes.RESOLUTION.height<720,s=n.excludeUntil===1/0&&n.lastExcludeReason_===t;r&&s&&(delete n.excludeUntil,videojs.log.warn(`enabling non-HD playlist ${n.id} because all playlists were excluded due to ${t} key IDs`))})}addKeyStatus_(e,t){const s=(typeof e=="string"?e:bufferToHexString(e)).slice(0,32).toLowerCase();this.logger_(`KeyStatus '${t}' with key ID ${s} added to the keyStatusMap`),this.keyStatusMap_.set(s,t)}updatePlaylistByKeyStatus(e,t){this.addKeyStatus_(e,t),this.waitingForFastQualityPlaylistReceived_||this.excludeNonUsableThenChangePlaylist_(),this.mainPlaylistLoader_.off("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this)),this.mainPlaylistLoader_.on("loadedplaylist",this.excludeNonUsableThenChangePlaylist_.bind(this))}excludeNonUsableThenChangePlaylist_(){this.excludeNonUsablePlaylistsByKeyId_(),this.fastQualityChange_()}}const enableFunction=(i,e,t)=>n=>{const r=i.main.playlists[e],s=isIncompatible(r),a=isEnabled(r);if(typeof n>"u")return a;n?delete r.disabled:r.disabled=!0;const l={renditionInfo:{id:e,bandwidth:r.attributes.BANDWIDTH,resolution:r.attributes.RESOLUTION,codecs:r.attributes.CODECS},cause:"fast-quality"};return n!==a&&!s&&(n?(t(r),i.trigger({type:"renditionenabled",metadata:l})):i.trigger({type:"renditiondisabled",metadata:l})),n};class Representation{constructor(e,t,n){const{playlistController_:r}=e,s=r.fastQualityChange_.bind(r);if(t.attributes){const a=t.attributes.RESOLUTION;this.width=a&&a.width,this.height=a&&a.height,this.bandwidth=t.attributes.BANDWIDTH,this.frameRate=t.attributes["FRAME-RATE"]}this.codecs=codecsForPlaylist(r.main(),t),this.playlist=t,this.id=n,this.enabled=enableFunction(e.playlists,t.id,s)}}const renditionSelectionMixin=function(i){i.representations=()=>{const e=i.playlistController_.main(),t=isAudioOnly(e)?i.playlistController_.getAudioTrackPlaylists_():e.playlists;return t?t.filter(n=>!isIncompatible(n)).map((n,r)=>new Representation(i,n,n.id)):[]}},timerCancelEvents=["seeking","seeked","pause","playing","error"];class PlaybackWatcher extends videojs.EventTarget{constructor(e){super(),this.playlistController_=e.playlistController,this.tech_=e.tech,this.seekable=e.seekable,this.allowSeeksWithinUnsafeLiveWindow=e.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=e.liveRangeSafeTimeDelta,this.media=e.media,this.playedRanges_=[],this.consecutiveUpdates=0,this.lastRecordedTime=null,this.checkCurrentTimeTimeout_=null,this.logger_=logger("PlaybackWatcher"),this.logger_("initialize");const t=()=>this.monitorCurrentTime_(),n=()=>this.monitorCurrentTime_(),r=()=>this.techWaiting_(),s=()=>this.resetTimeUpdate_(),a=this.playlistController_,l=["main","subtitle","audio"],u={};l.forEach(h=>{u[h]={reset:()=>this.resetSegmentDownloads_(h),updateend:()=>this.checkSegmentDownloads_(h)},a[`${h}SegmentLoader_`].on("appendsdone",u[h].updateend),a[`${h}SegmentLoader_`].on("playlistupdate",u[h].reset),this.tech_.on(["seeked","seeking"],u[h].reset)});const d=h=>{["main","audio"].forEach(p=>{a[`${p}SegmentLoader_`][h]("appended",this.seekingAppendCheck_)})};this.seekingAppendCheck_=()=>{this.fixesBadSeeks_()&&(this.consecutiveUpdates=0,this.lastRecordedTime=this.tech_.currentTime(),d("off"))},this.clearSeekingAppendCheck_=()=>d("off"),this.watchForBadSeeking_=()=>{this.clearSeekingAppendCheck_(),d("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",r),this.tech_.on(timerCancelEvents,s),this.tech_.on("canplay",n),this.tech_.one("play",t),this.dispose=()=>{this.clearSeekingAppendCheck_(),this.logger_("dispose"),this.tech_.off("waiting",r),this.tech_.off(timerCancelEvents,s),this.tech_.off("canplay",n),this.tech_.off("play",t),this.tech_.off("seeking",this.watchForBadSeeking_),this.tech_.off("seeked",this.clearSeekingAppendCheck_),l.forEach(h=>{a[`${h}SegmentLoader_`].off("appendsdone",u[h].updateend),a[`${h}SegmentLoader_`].off("playlistupdate",u[h].reset),this.tech_.off(["seeked","seeking"],u[h].reset)}),this.checkCurrentTimeTimeout_&&window$1.clearTimeout(this.checkCurrentTimeTimeout_),this.resetTimeUpdate_()}}monitorCurrentTime_(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&window$1.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=window$1.setTimeout(this.monitorCurrentTime_.bind(this),250)}resetSegmentDownloads_(e){const t=this.playlistController_[`${e}SegmentLoader_`];this[`${e}StalledDownloads_`]>0&&this.logger_(`resetting possible stalled download count for ${e} loader`),this[`${e}StalledDownloads_`]=0,this[`${e}Buffered_`]=t.buffered_()}checkSegmentDownloads_(e){const t=this.playlistController_,n=t[`${e}SegmentLoader_`],r=n.buffered_(),s=isRangeDifferent(this[`${e}Buffered_`],r);if(this[`${e}Buffered_`]=r,s){const a={bufferedRanges:r};t.trigger({type:"bufferedrangeschanged",metadata:a}),this.resetSegmentDownloads_(e);return}this[`${e}StalledDownloads_`]++,this.logger_(`found #${this[`${e}StalledDownloads_`]} ${e} appends that did not increase buffer (possible stalled download)`,{playlistId:n.playlist_&&n.playlist_.id,buffered:timeRangesToArray(r)}),!(this[`${e}StalledDownloads_`]<10)&&(this.logger_(`${e} loader stalled download exclusion`),this.resetSegmentDownloads_(e),this.tech_.trigger({type:"usage",name:`vhs-${e}-download-exclusion`}),e!=="subtitle"&&t.excludePlaylist({error:{message:`Excessive ${e} segment downloading detected.`},playlistExclusionDuration:1/0}))}checkCurrentTime_(){if(this.tech_.paused()||this.tech_.seeking())return;const e=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===e&&(!t.length||e+SAFE_TIME_DELTA>=t.end(t.length-1)))return this.techWaiting_();if(this.consecutiveUpdates>=5&&e===this.lastRecordedTime)this.consecutiveUpdates++,this.waiting_();else if(e===this.lastRecordedTime)this.consecutiveUpdates++;else{this.playedRanges_.push(createTimeRanges([this.lastRecordedTime,e]));const n={playedRanges:this.playedRanges_};this.playlistController_.trigger({type:"playedrangeschanged",metadata:n}),this.consecutiveUpdates=0,this.lastRecordedTime=e}}resetTimeUpdate_(){this.consecutiveUpdates=0}fixesBadSeeks_(){if(!this.tech_.seeking())return!1;const t=this.seekable(),n=this.tech_.currentTime(),r=this.afterSeekableWindow_(t,n,this.media(),this.allowSeeksWithinUnsafeLiveWindow);let s;if(r&&(s=t.end(t.length-1)),this.beforeSeekableWindow_(t,n)){const v=t.start(0);s=v+(v===t.end(0)?0:SAFE_TIME_DELTA)}if(typeof s<"u")return this.logger_(`Trying to seek outside of seekable at time ${n} with seekable range ${printableRange(t)}. Seeking to ${s}.`),this.tech_.setCurrentTime(s),!0;const a=this.playlistController_.sourceUpdater_,l=this.tech_.buffered(),u=a.audioBuffer?a.audioBuffered():null,d=a.videoBuffer?a.videoBuffered():null,h=this.media(),p=h.partTargetDuration?h.partTargetDuration:(h.targetDuration-TIME_FUDGE_FACTOR)*2,m=[u,d];for(let v=0;v<m.length;v++){if(!m[v])continue;if(timeAheadOf(m[v],n)<p)return!1}const g=findNextRange(l,n);return g.length===0?!1:(s=g.start(0)+SAFE_TIME_DELTA,this.logger_(`Buffered region starts (${g.start(0)})  just beyond seek point (${n}). Seeking to ${s}.`),this.tech_.setCurrentTime(s),!0)}waiting_(){if(this.techWaiting_())return;const e=this.tech_.currentTime(),t=this.tech_.buffered(),n=findRange(t,e);if(n.length&&e+3<=n.end(0)){this.resetTimeUpdate_(),this.tech_.setCurrentTime(e),this.logger_(`Stopped at ${e} while inside a buffered region [${n.start(0)} -> ${n.end(0)}]. Attempting to resume playback by seeking to the current time.`),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"});return}}techWaiting_(){const e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking())return!0;if(this.beforeSeekableWindow_(e,t)){const l=e.end(e.length-1);return this.logger_(`Fell out of live window at time ${t}. Seeking to live point (seekable end) ${l}`),this.resetTimeUpdate_(),this.tech_.setCurrentTime(l),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),!0}const n=this.tech_.vhs.playlistController_.sourceUpdater_,r=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:n.audioBuffered(),videoBuffered:n.videoBuffered(),currentTime:t}))return this.resetTimeUpdate_(),this.tech_.setCurrentTime(t),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),!0;const a=findNextRange(r,t);return a.length>0?(this.logger_(`Stopped at ${t} and seeking to ${a.start(0)}`),this.resetTimeUpdate_(),this.skipTheGap_(t),!0):!1}afterSeekableWindow_(e,t,n,r=!1){if(!e.length)return!1;let s=e.end(e.length-1)+SAFE_TIME_DELTA;const a=!n.endList,l=typeof n.partTargetDuration=="number";return a&&(l||r)&&(s=e.end(e.length-1)+n.targetDuration*3),t>s}beforeSeekableWindow_(e,t){return!!(e.length&&e.start(0)>0&&t<e.start(0)-this.liveRangeSafeTimeDelta)}videoUnderflow_({videoBuffered:e,audioBuffered:t,currentTime:n}){if(!e)return;let r;if(e.length&&t.length){const s=findRange(e,n-3),a=findRange(e,n),l=findRange(t,n);l.length&&!a.length&&s.length&&(r={start:s.end(0),end:l.end(0)})}else findNextRange(e,n).length||(r=this.gapFromVideoUnderflow_(e,n));return r?(this.logger_(`Encountered a gap in video from ${r.start} to ${r.end}. Seeking to current time ${n}`),!0):!1}skipTheGap_(e){const t=this.tech_.buffered(),n=this.tech_.currentTime(),r=findNextRange(t,n);if(this.resetTimeUpdate_(),r.length===0||n!==e)return;this.logger_("skipTheGap_:","currentTime:",n,"scheduled currentTime:",e,"nextRange start:",r.start(0)),this.tech_.setCurrentTime(r.start(0)+TIME_FUDGE_FACTOR);const s={gapInfo:{from:n,to:r.start(0)}};this.playlistController_.trigger({type:"gapjumped",metadata:s}),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"})}gapFromVideoUnderflow_(e,t){const n=findGaps(e);for(let r=0;r<n.length;r++){const s=n.start(r),a=n.end(r);if(t-s<4&&t-s>2)return{start:s,end:a}}return null}}const defaultOptions={errorInterval:30,getSource(i){const t=this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource();return i(t)}},initPlugin=function(i,e){let t=0,n=0;const r=merge(defaultOptions,e);i.ready(()=>{i.trigger({type:"usage",name:"vhs-error-reload-initialized"})});const s=function(){n&&i.currentTime(n)},a=function(h){h!=null&&(n=i.duration()!==1/0&&i.currentTime()||0,i.one("loadedmetadata",s),i.src(h),i.trigger({type:"usage",name:"vhs-error-reload"}),i.play())},l=function(){if(Date.now()-t<r.errorInterval*1e3){i.trigger({type:"usage",name:"vhs-error-reload-canceled"});return}if(!r.getSource||typeof r.getSource!="function"){videojs.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}return t=Date.now(),r.getSource.call(i,a)},u=function(){i.off("loadedmetadata",s),i.off("error",l),i.off("dispose",u)},d=function(h){u(),initPlugin(i,h)};i.on("error",l),i.on("dispose",u),i.reloadSourceOnError=d},reloadSourceOnError=function(i){initPlugin(this,i)};var version$4="3.17.2",version$3="7.1.0",version$2="1.3.1",version$1="7.2.0",version$7="4.0.2";const Vhs={PlaylistLoader,Playlist,utils,STANDARD_PLAYLIST_SELECTOR:lastBandwidthSelector,INITIAL_PLAYLIST_SELECTOR:lowestBitrateCompatibleVariantSelector,lastBandwidthSelector,movingAverageBandwidthSelector,comparePlaylistBandwidth,comparePlaylistResolution,xhr:xhrFactory()};Object.keys(Config).forEach(i=>{Object.defineProperty(Vhs,i,{get(){return videojs.log.warn(`using Vhs.${i} is UNSAFE be sure you know what you are doing`),Config[i]},set(e){if(videojs.log.warn(`using Vhs.${i} is UNSAFE be sure you know what you are doing`),typeof e!="number"||e<0){videojs.log.warn(`value of Vhs.${i} must be greater than or equal to 0`);return}Config[i]=e}})});const LOCAL_STORAGE_KEY="videojs-vhs",handleVhsMediaChange=function(i,e){const t=e.media();let n=-1;for(let r=0;r<i.length;r++)if(i[r].id===t.id){n=r;break}i.selectedIndex_=n,i.trigger({selectedIndex:n,type:"change"})},handleVhsLoadedMetadata=function(i,e){e.representations().forEach(t=>{i.addQualityLevel(t)}),handleVhsMediaChange(i,e.playlists)};Vhs.canPlaySource=function(){return videojs.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};const emeKeySystems=(i,e,t)=>{if(!i)return i;let n={};e&&e.attributes&&e.attributes.CODECS&&(n=unwrapCodecList(parseCodecs(e.attributes.CODECS))),t&&t.attributes&&t.attributes.CODECS&&(n.audio=t.attributes.CODECS);const r=getMimeForCodec(n.video),s=getMimeForCodec(n.audio),a={};for(const l in i)a[l]={},s&&(a[l].audioContentType=s),r&&(a[l].videoContentType=r),e.contentProtection&&e.contentProtection[l]&&e.contentProtection[l].pssh&&(a[l].pssh=e.contentProtection[l].pssh),typeof i[l]=="string"&&(a[l].url=i[l]);return merge(i,a)},getAllPsshKeySystemsOptions=(i,e)=>i.reduce((t,n)=>{if(!n.contentProtection)return t;const r=e.reduce((s,a)=>{const l=n.contentProtection[a];return l&&l.pssh&&(s[a]={pssh:l.pssh}),s},{});return Object.keys(r).length&&t.push(r),t},[]),waitForKeySessionCreation=({player:i,sourceKeySystems:e,audioMedia:t,mainPlaylists:n})=>{if(!i.eme.initializeMediaKeys)return Promise.resolve();const r=t?n.concat([t]):n,s=getAllPsshKeySystemsOptions(r,Object.keys(e)),a=[],l=[];return s.forEach(u=>{l.push(new Promise((d,h)=>{i.tech_.one("keysessioncreated",d)})),a.push(new Promise((d,h)=>{i.eme.initializeMediaKeys({keySystems:u},p=>{if(p){h(p);return}d()})}))}),Promise.race([Promise.all(a),Promise.race(l)])},setupEmeOptions=({player:i,sourceKeySystems:e,media:t,audioMedia:n})=>{const r=emeKeySystems(e,t,n);return r?(i.currentSource().keySystems=r,r&&!i.eme?(videojs.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),!1):!0):!1},getVhsLocalStorage=()=>{if(!window$1.localStorage)return null;const i=window$1.localStorage.getItem(LOCAL_STORAGE_KEY);if(!i)return null;try{return JSON.parse(i)}catch{return null}},updateVhsLocalStorage=i=>{if(!window$1.localStorage)return!1;let e=getVhsLocalStorage();e=e?merge(e,i):i;try{window$1.localStorage.setItem(LOCAL_STORAGE_KEY,JSON.stringify(e))}catch{return!1}return e},expandDataUri=i=>i.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")===0?JSON.parse(i.substring(i.indexOf(",")+1)):i,addOnRequestHook=(i,e)=>{i._requestCallbackSet||(i._requestCallbackSet=new Set),i._requestCallbackSet.add(e)},addOnResponseHook=(i,e)=>{i._responseCallbackSet||(i._responseCallbackSet=new Set),i._responseCallbackSet.add(e)},removeOnRequestHook=(i,e)=>{i._requestCallbackSet&&(i._requestCallbackSet.delete(e),i._requestCallbackSet.size||delete i._requestCallbackSet)},removeOnResponseHook=(i,e)=>{i._responseCallbackSet&&(i._responseCallbackSet.delete(e),i._responseCallbackSet.size||delete i._responseCallbackSet)};Vhs.supportsNativeHls=(function(){if(!document$1||!document$1.createElement)return!1;const i=document$1.createElement("video");return videojs.getTech("Html5").isSupported()?["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(i.canPlayType(t))}):!1})();Vhs.supportsNativeDash=(function(){return!document$1||!document$1.createElement||!videojs.getTech("Html5").isSupported()?!1:/maybe|probably/i.test(document$1.createElement("video").canPlayType("application/dash+xml"))})();Vhs.supportsTypeNatively=i=>i==="hls"?Vhs.supportsNativeHls:i==="dash"?Vhs.supportsNativeDash:!1;Vhs.isSupported=function(){return videojs.log.warn("VHS is no longer a tech. Please remove it from your player's techOrder.")};Vhs.xhr.onRequest=function(i){addOnRequestHook(Vhs.xhr,i)};Vhs.xhr.onResponse=function(i){addOnResponseHook(Vhs.xhr,i)};Vhs.xhr.offRequest=function(i){removeOnRequestHook(Vhs.xhr,i)};Vhs.xhr.offResponse=function(i){removeOnResponseHook(Vhs.xhr,i)};const Component=videojs.getComponent("Component");class VhsHandler extends Component{constructor(e,t,n){if(super(t,n.vhs),typeof n.initialBandwidth=="number"&&(this.options_.bandwidth=n.initialBandwidth),this.logger_=logger("VhsHandler"),t.options_&&t.options_.playerId){const r=videojs.getPlayer(t.options_.playerId);this.player_=r}if(this.tech_=t,this.source_=e,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&t.overrideNativeAudioTracks&&t.overrideNativeVideoTracks)t.overrideNativeAudioTracks(!0),t.overrideNativeVideoTracks(!0);else if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks))throw new Error("Overriding native VHS requires emulated tracks. See https://git.io/vMpjB");this.on(document$1,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],r=>{const s=document$1.fullscreenElement||document$1.webkitFullscreenElement||document$1.mozFullScreenElement||document$1.msFullscreenElement;s&&s.contains(this.tech_.el())?this.playlistController_.fastQualityChange_():this.playlistController_.checkABR_()}),this.on(this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=!1;return}this.setCurrentTime(this.tech_.currentTime())}),this.on(this.tech_,"error",function(){this.tech_.error()&&this.playlistController_&&this.playlistController_.pauseLoading()}),this.on(this.tech_,"play",this.play)}setOptions_(e={}){if(this.options_=merge(this.options_,e),this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions!==!1,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.usePlayerObjectFit=this.options_.usePlayerObjectFit||!1,this.options_.useBandwidthFromLocalStorage=typeof this.source_.useBandwidthFromLocalStorage<"u"?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useForcedSubtitles=this.options_.useForcedSubtitles||!1,this.options_.useNetworkInformationApi=typeof this.options_.useNetworkInformationApi<"u"?this.options_.useNetworkInformationApi:!0,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.llhls=this.options_.llhls!==!1,this.options_.bufferBasedABR=this.options_.bufferBasedABR||!1,typeof this.options_.playlistExclusionDuration!="number"&&(this.options_.playlistExclusionDuration=60),typeof this.options_.bandwidth!="number"&&this.options_.useBandwidthFromLocalStorage){const n=getVhsLocalStorage();n&&n.bandwidth&&(this.options_.bandwidth=n.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"})),n&&n.throughput&&(this.options_.throughput=n.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}))}typeof this.options_.bandwidth!="number"&&(this.options_.bandwidth=Config.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===Config.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","usePlayerObjectFit","customPixelRatio","limitRenditionByPlayerDimensions","bandwidth","customTagParsers","customTagMappers","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","bufferBasedABR","liveRangeSafeTimeDelta","llhls","useForcedSubtitles","useNetworkInformationApi","useDtsForTimestampOffset","exactManifestTimings","leastPixelDiffSelector"].forEach(n=>{typeof this.source_[n]<"u"&&(this.options_[n]=this.source_[n])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio,this.usePlayerObjectFit=this.options_.usePlayerObjectFit;const t=this.options_.customPixelRatio;typeof t=="number"&&t>=0&&(this.customPixelRatio=t)}setOptions(e={}){this.setOptions_(e)}src(e,t){if(!e)return;this.setOptions_(),this.options_.src=expandDataUri(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=Vhs,this.options_.sourceType=simpleTypeFromSourceType(t),this.options_.seekTo=s=>{this.tech_.setCurrentTime(s)},this.options_.player_=this.player_,this.playlistController_=new PlaylistController(this.options_);const n=merge({liveRangeSafeTimeDelta:SAFE_TIME_DELTA},this.options_,{seekable:()=>this.seekable(),media:()=>this.playlistController_.media(),playlistController:this.playlistController_});this.playbackWatcher_=new PlaybackWatcher(n),this.attachStreamingEventListeners_(),this.playlistController_.on("error",()=>{const s=videojs.players[this.tech_.options_.playerId];let a=this.playlistController_.error;typeof a=="object"&&!a.code?a.code=3:typeof a=="string"&&(a={message:a,code:3}),s.error(a)});const r=this.options_.bufferBasedABR?Vhs.movingAverageBandwidthSelector(.55):Vhs.STANDARD_PLAYLIST_SELECTOR;this.playlistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):r.bind(this),this.playlistController_.selectInitialPlaylist=Vhs.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.playlistController_.mainPlaylistLoader_,this.mediaSource=this.playlistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get(){return this.playlistController_.selectPlaylist},set(s){this.playlistController_.selectPlaylist=s.bind(this)}},throughput:{get(){return this.playlistController_.mainSegmentLoader_.throughput.rate},set(s){this.playlistController_.mainSegmentLoader_.throughput.rate=s,this.playlistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get(){let s=this.playlistController_.mainSegmentLoader_.bandwidth;const a=window$1.navigator.connection||window$1.navigator.mozConnection||window$1.navigator.webkitConnection,l=1e7;if(this.options_.useNetworkInformationApi&&a){const u=a.downlink*1e3*1e3;u>=l&&s>=l?s=Math.max(s,u):s=u}return s},set(s){this.playlistController_.mainSegmentLoader_.bandwidth=s,this.playlistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get(){const s=1/(this.bandwidth||1);let a;return this.throughput>0?a=1/this.throughput:a=0,Math.floor(1/(s+a))},set(){videojs.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:()=>this.bandwidth||0,enumerable:!0},mediaRequests:{get:()=>this.playlistController_.mediaRequests_()||0,enumerable:!0},mediaRequestsAborted:{get:()=>this.playlistController_.mediaRequestsAborted_()||0,enumerable:!0},mediaRequestsTimedout:{get:()=>this.playlistController_.mediaRequestsTimedout_()||0,enumerable:!0},mediaRequestsErrored:{get:()=>this.playlistController_.mediaRequestsErrored_()||0,enumerable:!0},mediaTransferDuration:{get:()=>this.playlistController_.mediaTransferDuration_()||0,enumerable:!0},mediaBytesTransferred:{get:()=>this.playlistController_.mediaBytesTransferred_()||0,enumerable:!0},mediaSecondsLoaded:{get:()=>this.playlistController_.mediaSecondsLoaded_()||0,enumerable:!0},mediaAppends:{get:()=>this.playlistController_.mediaAppends_()||0,enumerable:!0},mainAppendsToLoadedData:{get:()=>this.playlistController_.mainAppendsToLoadedData_()||0,enumerable:!0},audioAppendsToLoadedData:{get:()=>this.playlistController_.audioAppendsToLoadedData_()||0,enumerable:!0},appendsToLoadedData:{get:()=>this.playlistController_.appendsToLoadedData_()||0,enumerable:!0},timeToLoadedData:{get:()=>this.playlistController_.timeToLoadedData_()||0,enumerable:!0},buffered:{get:()=>timeRangesToArray(this.tech_.buffered()),enumerable:!0},currentTime:{get:()=>this.tech_.currentTime(),enumerable:!0},currentSource:{get:()=>this.tech_.currentSource_,enumerable:!0},currentTech:{get:()=>this.tech_.name_,enumerable:!0},duration:{get:()=>this.tech_.duration(),enumerable:!0},main:{get:()=>this.playlists.main,enumerable:!0},playerDimensions:{get:()=>this.tech_.currentDimensions(),enumerable:!0},seekable:{get:()=>timeRangesToArray(this.tech_.seekable()),enumerable:!0},timestamp:{get:()=>Date.now(),enumerable:!0},videoPlaybackQuality:{get:()=>this.tech_.getVideoPlaybackQuality(),enumerable:!0}}),this.tech_.one("canplay",this.playlistController_.setupFirstPlay.bind(this.playlistController_)),this.tech_.on("bandwidthupdate",()=>{this.options_.useBandwidthFromLocalStorage&&updateVhsLocalStorage({bandwidth:this.bandwidth,throughput:Math.round(this.throughput)})}),this.playlistController_.on("selectedinitialmedia",()=>{renditionSelectionMixin(this)}),this.playlistController_.sourceUpdater_.on("createdsourcebuffers",()=>{this.setupEme_()}),this.on(this.playlistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.playlistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=window$1.URL.createObjectURL(this.playlistController_.mediaSource),(videojs.browser.IS_ANY_SAFARI||videojs.browser.IS_IOS)&&this.options_.overrideNative&&this.options_.sourceType==="hls"&&typeof this.tech_.addSourceElement=="function"?(this.tech_.addSourceElement(this.mediaSourceUrl_),this.tech_.addSourceElement(this.source_.src)):this.tech_.src(this.mediaSourceUrl_))}createKeySessions_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),waitForKeySessionCreation({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:e&&e.media(),mainPlaylists:this.playlists.main.playlists}).then(()=>{this.logger_("created EME key session"),this.playlistController_.sourceUpdater_.initializedEme()}).catch(t=>{this.logger_("error while creating EME key session",t),this.player_.error({message:"Failed to initialize media keys for EME",code:3})})}handleWaitingForKey_(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()}setupEme_(){const e=this.playlistController_.mediaTypes_.AUDIO.activePlaylistLoader,t=setupEmeOptions({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:e&&e.media()});if(this.player_.tech_.on("keystatuschange",n=>{this.playlistController_.updatePlaylistByKeyStatus(n.keyId,n.status)}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),!t){this.playlistController_.sourceUpdater_.initializedEme();return}this.createKeySessions_()}setupQualityLevels_(){const e=videojs.players[this.tech_.options_.playerId];!e||!e.qualityLevels||this.qualityLevels_||(this.qualityLevels_=e.qualityLevels(),this.playlistController_.on("selectedinitialmedia",()=>{handleVhsLoadedMetadata(this.qualityLevels_,this)}),this.playlists.on("mediachange",()=>{handleVhsMediaChange(this.qualityLevels_,this.playlists)}))}static version(){return{"@videojs/http-streaming":version$4,"mux.js":version$3,"mpd-parser":version$2,"m3u8-parser":version$1,"aes-decrypter":version$7}}version(){return this.constructor.version()}canChangeType(){return SourceUpdater.canChangeType()}play(){this.playlistController_.play()}setCurrentTime(e){this.playlistController_.setCurrentTime(e)}duration(){return this.playlistController_.duration()}seekable(){return this.playlistController_.seekable()}dispose(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.playlistController_&&this.playlistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.mediaSourceUrl_&&window$1.URL.revokeObjectURL&&(window$1.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),super.dispose()}convertToProgramTime(e,t){return getProgramTime({playlist:this.playlistController_.media(),time:e,callback:t})}seekToProgramTime(e,t,n=!0,r=2){return seekToProgramTime({programTime:e,playlist:this.playlistController_.media(),retryCount:r,pauseAfterSeek:n,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}setupXhrHooks_(){this.xhr.onRequest=e=>{addOnRequestHook(this.xhr,e)},this.xhr.onResponse=e=>{addOnResponseHook(this.xhr,e)},this.xhr.offRequest=e=>{removeOnRequestHook(this.xhr,e)},this.xhr.offResponse=e=>{removeOnResponseHook(this.xhr,e)},this.player_.trigger("xhr-hooks-ready")}attachStreamingEventListeners_(){const e=["seekablerangeschanged","bufferedrangeschanged","contentsteeringloadstart","contentsteeringloadcomplete","contentsteeringparsed"],t=["gapjumped","playedrangeschanged"];e.forEach(n=>{this.playlistController_.on(n,r=>{this.player_.trigger(_extends({},r))})}),t.forEach(n=>{this.playbackWatcher_.on(n,r=>{this.player_.trigger(_extends({},r))})})}}const VhsSourceHandler={name:"videojs-http-streaming",VERSION:version$4,canHandleSource(i,e={}){const t=merge(videojs.options,e);return!t.vhs.experimentalUseMMS&&!browserSupportsCodec("avc1.4d400d,mp4a.40.2",!1)?!1:VhsSourceHandler.canPlayType(i.type,t)},handleSource(i,e,t={}){const n=merge(videojs.options,t);return e.vhs=new VhsHandler(i,e,n),e.vhs.xhr=xhrFactory(),e.vhs.setupXhrHooks_(),e.vhs.src(i.src,i.type),e.vhs},canPlayType(i,e){const t=simpleTypeFromSourceType(i);if(!t)return"";const n=VhsSourceHandler.getOverrideNative(e);return!Vhs.supportsTypeNatively(t)||n?"maybe":""},getOverrideNative(i={}){const{vhs:e={}}=i,t=!(videojs.browser.IS_ANY_SAFARI||videojs.browser.IS_IOS),{overrideNative:n=t}=e;return n}},supportsNativeMediaSources=()=>browserSupportsCodec("avc1.4d400d,mp4a.40.2",!0);supportsNativeMediaSources()&&videojs.getTech("Html5").registerSourceHandler(VhsSourceHandler,0);videojs.VhsHandler=VhsHandler;videojs.VhsSourceHandler=VhsSourceHandler;videojs.Vhs=Vhs;videojs.use||videojs.registerComponent("Vhs",Vhs);videojs.options.vhs=videojs.options.vhs||{};(!videojs.getPlugin||!videojs.getPlugin("reloadSourceOnError"))&&videojs.registerPlugin("reloadSourceOnError",reloadSourceOnError);const video_es=Object.freeze(Object.defineProperty({__proto__:null,default:videojs},Symbol.toStringTag,{value:"Module"}));var Youtube$1={exports:{}};const require$$0=getAugmentedNamespace(video_es);var Youtube=Youtube$1.exports,hasRequiredYoutube;function requireYoutube(){return hasRequiredYoutube||(hasRequiredYoutube=1,(function(i,e){(function(t,n){{var r=require$$0;i.exports=n(r.default||r)}})(Youtube,function(t){var n=t.browser.IS_IOS||t.browser.IS_NATIVE_ANDROID,r=t.getTech("Tech");class s extends r{constructor(h,p){super(h,p),this.setPoster(h.poster),this.setSrc(this.options_.source,!0),this.setTimeout((function(){this.el_&&(this.el_.parentNode.className+=" vjs-youtube",n&&(this.el_.parentNode.className+=" vjs-youtube-mobile"),s.isApiReady?this.initYTPlayer():s.apiReadyQueue.push(this))}).bind(this))}dispose(){if(this.ytPlayer)this.ytPlayer.stopVideo&&this.ytPlayer.stopVideo(),this.ytPlayer.destroy&&this.ytPlayer.destroy();else{var h=s.apiReadyQueue.indexOf(this);h!==-1&&s.apiReadyQueue.splice(h,1)}this.ytPlayer=null,this.el_.parentNode.className=this.el_.parentNode.className.replace(" vjs-youtube","").replace(" vjs-youtube-mobile",""),this.el_.parentNode.removeChild(this.el_),r.prototype.dispose.call(this)}createEl(){var h=document.createElement("div");h.setAttribute("id",this.options_.techId),h.setAttribute("style","width:100%;height:100%;top:0;left:0;position:absolute"),h.setAttribute("class","vjs-tech");var p=document.createElement("div");if(p.appendChild(h),!n&&!this.options_.ytControls){var m=document.createElement("div");m.setAttribute("class","vjs-iframe-blocker"),m.setAttribute("style","position:absolute;top:0;left:0;width:100%;height:100%"),m.onclick=(function(){this.pause()}).bind(this),p.appendChild(m)}return p}initYTPlayer(){var h={controls:0,modestbranding:1,rel:0,showinfo:0,loop:this.options_.loop?1:0};if(typeof this.options_.autohide<"u"&&(h.autohide=this.options_.autohide),typeof this.options_.cc_load_policy<"u"&&(h.cc_load_policy=this.options_.cc_load_policy),typeof this.options_.ytControls<"u"&&(h.controls=this.options_.ytControls),typeof this.options_.disablekb<"u"&&(h.disablekb=this.options_.disablekb),typeof this.options_.color<"u"&&(h.color=this.options_.color),h.controls?typeof this.options_.fs<"u"&&(h.fs=this.options_.fs):h.fs=0,this.options_.source.src.indexOf("end=")!==-1){var p=this.options_.source.src.match(/end=([0-9]*)/);this.options_.end=parseInt(p[1])}if(typeof this.options_.end<"u"&&(h.end=this.options_.end),typeof this.options_.hl<"u"?h.hl=this.options_.hl:typeof this.options_.language<"u"&&(h.hl=this.options_.language.substr(0,2)),typeof this.options_.iv_load_policy<"u"&&(h.iv_load_policy=this.options_.iv_load_policy),typeof this.options_.list<"u"?h.list=this.options_.list:this.url&&typeof this.url.listId<"u"&&(h.list=this.url.listId),typeof this.options_.listType<"u"&&(h.listType=this.options_.listType),typeof this.options_.modestbranding<"u"&&(h.modestbranding=this.options_.modestbranding),typeof this.options_.playlist<"u"&&(h.playlist=this.options_.playlist),typeof this.options_.playsinline<"u"&&(h.playsinline=this.options_.playsinline),typeof this.options_.rel<"u"&&(h.rel=this.options_.rel),typeof this.options_.showinfo<"u"&&(h.showinfo=this.options_.showinfo),this.options_.source.src.indexOf("start=")!==-1){var m=this.options_.source.src.match(/start=([0-9]*)/);this.options_.start=parseInt(m[1])}if(typeof this.options_.start<"u"&&(h.start=this.options_.start),typeof this.options_.theme<"u"&&(h.theme=this.options_.theme),typeof this.options_.customVars<"u"){var g=this.options_.customVars;Object.keys(g).forEach(function(_){h[_]=g[_]})}this.activeVideoId=this.url?this.url.videoId:null,this.activeList=h.list;var v={videoId:this.activeVideoId,playerVars:h,events:{onReady:this.onPlayerReady.bind(this),onPlaybackQualityChange:this.onPlayerPlaybackQualityChange.bind(this),onPlaybackRateChange:this.onPlayerPlaybackRateChange.bind(this),onStateChange:this.onPlayerStateChange.bind(this),onVolumeChange:this.onPlayerVolumeChange.bind(this),onError:this.onPlayerError.bind(this)}};typeof this.options_.enablePrivacyEnhancedMode<"u"&&this.options_.enablePrivacyEnhancedMode&&(v.host="https://www.youtube-nocookie.com"),this.ytPlayer=new YT.Player(this.options_.techId,v)}onPlayerReady(){this.options_.muted&&this.ytPlayer.mute();var h=this.ytPlayer.getAvailablePlaybackRates();h.length>1&&(this.featuresPlaybackRate=!0),this.playerReady_=!0,this.triggerReady(),this.playOnReady?this.play():this.cueOnReady&&(this.cueVideoById_(this.url.videoId),this.activeVideoId=this.url.videoId)}onPlayerPlaybackQualityChange(){}onPlayerPlaybackRateChange(){this.trigger("ratechange")}onPlayerStateChange(h){var p=h.data;if(!(p===this.lastState||this.errorNumber))switch(this.lastState=p,p){case-1:this.trigger("loadstart"),this.trigger("loadedmetadata"),this.trigger("durationchange"),this.trigger("ratechange");break;case YT.PlayerState.ENDED:this.trigger("ended");break;case YT.PlayerState.PLAYING:this.trigger("timeupdate"),this.trigger("durationchange"),this.trigger("playing"),this.trigger("play"),this.isSeeking&&this.onSeeked();break;case YT.PlayerState.PAUSED:this.trigger("canplay"),this.isSeeking?this.onSeeked():this.trigger("pause");break;case YT.PlayerState.BUFFERING:this.player_.trigger("timeupdate"),this.player_.trigger("waiting");break}}onPlayerVolumeChange(){this.trigger("volumechange")}onPlayerError(h){this.errorNumber=h.data,this.trigger("pause"),this.trigger("error")}error(){var h=1e3+this.errorNumber;switch(this.errorNumber){case 5:return{code:h,message:"Error while trying to play the video"};case 2:case 100:return{code:h,message:"Unable to find the video"};case 101:case 150:return{code:h,message:"Playback on other Websites has been disabled by the video owner."}}return{code:h,message:"YouTube unknown error ("+this.errorNumber+")"}}loadVideoById_(h){var p={videoId:h};this.options_.start&&(p.startSeconds=this.options_.start),this.options_.end&&(p.endSeconds=this.options_.end),this.ytPlayer.loadVideoById(p)}cueVideoById_(h){var p={videoId:h};this.options_.start&&(p.startSeconds=this.options_.start),this.options_.end&&(p.endSeconds=this.options_.end),this.ytPlayer.cueVideoById(p)}src(h){return h&&this.setSrc({src:h}),this.source}poster(){return n?null:this.poster_}setPoster(h){this.poster_=h}setSrc(h){!h||!h.src||(delete this.errorNumber,this.source=h,this.url=s.parseUrl(h.src),this.options_.poster||this.url.videoId&&(this.poster_="https://img.youtube.com/vi/"+this.url.videoId+"/0.jpg",this.trigger("posterchange"),this.checkHighResPoster()),this.options_.autoplay&&!n?this.isReady_?this.play():this.playOnReady=!0:this.activeVideoId!==this.url.videoId&&(this.isReady_?(this.cueVideoById_(this.url.videoId),this.activeVideoId=this.url.videoId):this.cueOnReady=!0))}autoplay(){return this.options_.autoplay}setAutoplay(h){this.options_.autoplay=h}loop(){return this.options_.loop}setLoop(h){this.options_.loop=h}play(){!this.url||!this.url.videoId||(this.wasPausedBeforeSeek=!1,this.isReady_?(this.url.listId&&(this.activeList===this.url.listId?this.ytPlayer.playVideo():(this.ytPlayer.loadPlaylist(this.url.listId),this.activeList=this.url.listId)),this.activeVideoId===this.url.videoId?this.ytPlayer.playVideo():(this.loadVideoById_(this.url.videoId),this.activeVideoId=this.url.videoId)):(this.trigger("waiting"),this.playOnReady=!0))}pause(){this.ytPlayer&&this.ytPlayer.pauseVideo()}paused(){return this.ytPlayer?this.lastState!==YT.PlayerState.PLAYING&&this.lastState!==YT.PlayerState.BUFFERING:!0}currentTime(){return this.ytPlayer?this.ytPlayer.getCurrentTime():0}setCurrentTime(h){this.lastState===YT.PlayerState.PAUSED&&(this.timeBeforeSeek=this.currentTime()),this.isSeeking||(this.wasPausedBeforeSeek=this.paused()),this.ytPlayer.seekTo(h,!0),this.trigger("timeupdate"),this.trigger("seeking"),this.isSeeking=!0,this.lastState===YT.PlayerState.PAUSED&&this.timeBeforeSeek!==h&&(clearInterval(this.checkSeekedInPauseInterval),this.checkSeekedInPauseInterval=setInterval((function(){this.lastState!==YT.PlayerState.PAUSED||!this.isSeeking?clearInterval(this.checkSeekedInPauseInterval):this.currentTime()!==this.timeBeforeSeek&&(this.trigger("timeupdate"),this.onSeeked())}).bind(this),250))}seeking(){return this.isSeeking}seekable(){return this.ytPlayer?t.createTimeRange(0,this.ytPlayer.getDuration()):t.createTimeRange()}onSeeked(){clearInterval(this.checkSeekedInPauseInterval),this.isSeeking=!1,this.wasPausedBeforeSeek&&this.pause(),this.trigger("seeked")}playbackRate(){return this.ytPlayer?this.ytPlayer.getPlaybackRate():1}setPlaybackRate(h){this.ytPlayer&&this.ytPlayer.setPlaybackRate(h)}duration(){return this.ytPlayer?this.ytPlayer.getDuration():0}currentSrc(){return this.source&&this.source.src}ended(){return this.ytPlayer?this.lastState===YT.PlayerState.ENDED:!1}volume(){return this.ytPlayer?this.ytPlayer.getVolume()/100:1}setVolume(h){this.ytPlayer&&this.ytPlayer.setVolume(h*100)}muted(){return this.ytPlayer?this.ytPlayer.isMuted():!1}setMuted(h){if(this.ytPlayer)this.muted(!0);else return;h?this.ytPlayer.mute():this.ytPlayer.unMute(),this.setTimeout(function(){this.trigger("volumechange")},50)}buffered(){if(!this.ytPlayer||!this.ytPlayer.getVideoLoadedFraction)return t.createTimeRange();var h=this.ytPlayer.getVideoLoadedFraction()*this.ytPlayer.getDuration();return t.createTimeRange(0,h)}preload(){}load(){}reset(){}networkState(){if(!this.ytPlayer)return 0;switch(this.ytPlayer.getPlayerState()){case-1:return 0;case 3:return 2;default:return 1}}readyState(){if(!this.ytPlayer)return 0;switch(this.ytPlayer.getPlayerState()){case-1:return 0;case 5:return 1;case 3:return 2;default:return 4}}supportsFullScreen(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled}checkHighResPoster(){var h="https://img.youtube.com/vi/"+this.url.videoId+"/maxresdefault.jpg";try{var p=new Image;p.onload=(function(){if("naturalHeight"in p){if(p.naturalHeight<=90||p.naturalWidth<=120)return}else if(p.height<=90||p.width<=120)return;this.poster_=h,this.trigger("posterchange")}).bind(this),p.onerror=function(){},p.src=h}catch{}}}s.isSupported=function(){return!0},s.canPlaySource=function(d){return s.canPlayType(d.type)},s.canPlayType=function(d){return d==="video/youtube"},s.parseUrl=function(d){var h={videoId:null},p=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,m=d.match(p);m&&m[2].length===11&&(h.videoId=m[2]);var g=/[?&]list=([^#\&\?]+)/;return m=d.match(g),m&&m[1]&&(h.listId=m[1]),h};function a(){YT.ready(function(){s.isApiReady=!0;for(var d=0;d<s.apiReadyQueue.length;++d)s.apiReadyQueue[d].initYTPlayer()})}function l(d,h){var p=!1,m=document.createElement("script"),g=document.getElementsByTagName("script")[0];g&&(g.parentNode.insertBefore(m,g),m.onload=function(){p||(p=!0,h())},m.onreadystatechange=function(){!p&&(this.readyState==="complete"||this.readyState==="loaded")&&(p=!0,h())},m.src=d)}function u(){var d=".vjs-youtube .vjs-iframe-blocker { display: none; }.vjs-youtube.vjs-user-inactive .vjs-iframe-blocker { display: block; }.vjs-youtube .vjs-poster { background-size: cover; }.vjs-youtube-mobile .vjs-big-play-button { display: none; }",h=document.head||document.getElementsByTagName("head")[0],p=document.createElement("style");p.type="text/css",p.styleSheet?p.styleSheet.cssText=d:p.appendChild(document.createTextNode(d)),h.appendChild(p)}s.apiReadyQueue=[],typeof document<"u"&&(l("https://www.youtube.com/iframe_api",a),u()),typeof t.registerTech<"u"?t.registerTech("Youtube",s):t.registerComponent("Youtube",s)})})(Youtube$1)),Youtube$1.exports}requireYoutube();const MyVideoPlayer=({videoUrl:i})=>{const e=reactExports.useRef(null),t=reactExports.useRef(null),n=reactExports.useRef(0),r=reactExports.useRef(null);return reactExports.useEffect(()=>{if(t.current)t.current.src({type:"video/youtube",src:i});else{const s=document.createElement("video-js");s.classList.add("vjs-big-play-centered"),e.current.appendChild(s);const a=t.current=videojs(s,{autoplay:!1,controls:!0,responsive:!0,fluid:!0,techOrder:["youtube"],sources:[{type:"video/youtube",src:i}],playbackRates:[.5,.75,1,1.25,1.5,2],controlBar:{children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","customControlSpacer","playbackRateMenuButton","fullscreenToggle"]},youtube:{ytControls:0,modestbranding:1,iv_load_policy:3,disablekb:1,rel:0}});a.ready(()=>{const l=document.createElement("div");l.className="vjs-custom-overlay";const u=document.createElement("div");u.className="tap-anim left-anim",u.innerHTML='<div class="anim-icon"> 10s</div>';const d=document.createElement("div");d.className="tap-anim right-anim",d.innerHTML='<div class="anim-icon">10s </div>',a.el().appendChild(l),a.el().appendChild(u),a.el().appendChild(d),l.addEventListener("touchstart",h),l.addEventListener("click",h);function h(m){m.type==="touchstart"&&m.preventDefault();const g=new Date().getTime(),v=g-n.current;if(v<300&&v>0){clearTimeout(r.current);const _=l.getBoundingClientRect();(m.touches?m.touches[0].clientX:m.clientX)-_.left>_.width/2?(a.currentTime(a.currentTime()+10),d.classList.add("show"),setTimeout(()=>d.classList.remove("show"),500)):(a.currentTime(a.currentTime()-10),u.classList.add("show"),setTimeout(()=>u.classList.remove("show"),500))}else r.current=setTimeout(()=>{a.paused()?a.play():a.pause()},300);n.current=g}const p=m=>{if(!["INPUT","TEXTAREA"].includes(document.activeElement.tagName))switch(m.key.toLowerCase()){case" ":case"k":m.preventDefault(),a.paused()?a.play():a.pause();break;case"arrowright":case"l":m.preventDefault(),a.currentTime(a.currentTime()+10),d.classList.add("show"),setTimeout(()=>d.classList.remove("show"),500);break;case"arrowleft":case"j":m.preventDefault(),a.currentTime(a.currentTime()-10),u.classList.add("show"),setTimeout(()=>u.classList.remove("show"),500);break;case"f":m.preventDefault(),a.isFullscreen()?a.exitFullscreen():a.requestFullscreen();break;case"m":m.preventDefault(),a.muted(!a.muted());break}};window.addEventListener("keydown",p),a.on("dispose",()=>window.removeEventListener("keydown",p))})}},[i]),reactExports.useEffect(()=>{const s=t.current;return()=>{s&&!s.isDisposed()&&(s.dispose(),t.current=null)}},[]),jsxRuntimeExports.jsx("div",{ref:e,style:{width:"100%",position:"relative"},onContextMenu:s=>s.preventDefault()})},WatchVideo=()=>{const i=useLocation(),e=useNavigate(),{video:t}=i.state||{},n=auth.currentUser,[r,s]=reactExports.useState("comments"),[a,l]=reactExports.useState(""),[u,d]=reactExports.useState([]);reactExports.useEffect(()=>{if(!t)return;const p=query(collection(db,"interactions"),where("videoId","==",t.id),where("type","==",r),orderBy("createdAt","desc")),m=onSnapshot(p,g=>{d(g.docs.map(v=>({id:v.id,...v.data()})))});return()=>m()},[t,r]);const h=async p=>{if(p.preventDefault(),!(!a.trim()||!n))try{await addDoc(collection(db,"interactions"),{videoId:t.id,userId:n.uid,userName:n.displayName||"Student",text:a,type:r,createdAt:serverTimestamp(),status:r==="doubts"?"pending":"active"}),l("")}catch(m){console.error("Error sending message:",m)}};return t?jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-slate-50 flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 border-b flex items-center gap-4 sticky top-0 z-20 shadow-sm",children:[jsxRuntimeExports.jsx("button",{onClick:()=>e(-1),className:"p-2 hover:bg-gray-100 rounded-full transition",children:jsxRuntimeExports.jsx(ArrowLeft,{size:24,className:"text-gray-700"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-bold text-lg text-gray-800 line-clamp-1",children:t.title}),jsxRuntimeExports.jsxs("p",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-wider",children:[t.subject,"  ",t.chapter]})]})]}),jsxRuntimeExports.jsx("div",{className:"w-full bg-black flex justify-center sticky top-[73px] z-10 md:static",children:jsxRuntimeExports.jsx("div",{className:"w-full max-w-5xl aspect-video",children:jsxRuntimeExports.jsx(MyVideoPlayer,{videoUrl:t.url})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 max-w-5xl mx-auto w-full p-4 md:p-6",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-800",children:t.title}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-2 leading-relaxed",children:t.description||`Learning ${t.chapter} in depth. Ask your queries below.`})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border overflow-hidden flex flex-col h-[500px]",children:[jsxRuntimeExports.jsxs("div",{className:"flex border-b",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>s("comments"),className:`flex-1 py-4 flex items-center justify-center gap-2 font-bold text-sm transition ${r==="comments"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50/50":"text-gray-500 hover:bg-gray-50"}`,children:[jsxRuntimeExports.jsx(MessageCircle,{size:18})," Comments"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>s("doubts"),className:`flex-1 py-4 flex items-center justify-center gap-2 font-bold text-sm transition ${r==="doubts"?"text-purple-600 border-b-2 border-purple-600 bg-purple-50/50":"text-gray-500 hover:bg-gray-50"}`,children:[jsxRuntimeExports.jsx(CircleQuestionMark,{size:18})," Ask Doubt"]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50/30",children:u.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-16 text-gray-400",children:jsxRuntimeExports.jsxs("p",{className:"text-sm italic",children:["No ",r," yet. Start the discussion!"]})}):u.map(p=>jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 shrink-0 font-bold text-xs",children:p.userName?.charAt(0)}),jsxRuntimeExports.jsx("div",{className:"flex-1",children:jsxRuntimeExports.jsxs("div",{className:"bg-white p-3 rounded-2xl border shadow-sm inline-block min-w-[120px] max-w-full",children:[jsxRuntimeExports.jsx("p",{className:"text-[10px] font-bold text-gray-500 mb-1",children:p.userName}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-800 leading-snug",children:p.text}),p.reply&&jsxRuntimeExports.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-100 bg-purple-50/30 -mx-1 px-1 rounded",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[jsxRuntimeExports.jsx(CircleCheckBig,{size:10,className:"text-purple-600"}),jsxRuntimeExports.jsx("p",{className:"text-[9px] font-bold text-purple-600 uppercase",children:"Teacher's Reply"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-600 italic leading-relaxed",children:p.reply})]})]})})]},p.id))}),jsxRuntimeExports.jsx("form",{onSubmit:h,className:"p-4 border-t bg-white",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2 items-center bg-gray-100 rounded-xl px-4 py-1 border focus-within:ring-2 ring-blue-500 transition",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:r==="comments"?"Write a comment...":"Describe your doubt clearly...",className:"bg-transparent flex-1 outline-none text-sm text-gray-800 py-3",value:a,onChange:p=>l(p.target.value)}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:!a.trim(),className:`p-2 rounded-lg transition ${a.trim()?(r==="comments"?"bg-blue-600":"bg-purple-600")+" text-white shadow-md":"text-gray-400"}`,children:jsxRuntimeExports.jsx(Send,{size:18})})]})})]})]})]}):jsxRuntimeExports.jsx("div",{className:"p-10 text-center",children:"Video details not found."})},AdminDoubts=()=>{const[i,e]=reactExports.useState([]),[t,n]=reactExports.useState({}),[r,s]=reactExports.useState(!0),a=async()=>{try{const u=query(collection(db,"interactions"),where("type","==","doubts"),orderBy("createdAt","desc")),d=await getDocs(u);e(d.docs.map(h=>({id:h.id,...h.data()})))}catch(u){console.error("Error fetching doubts:",u)}s(!1)};reactExports.useEffect(()=>{a()},[]);const l=async u=>{const d=t[u];if(d?.trim())try{const h=doc(db,"interactions",u);await updateDoc(h,{reply:d,repliedAt:new Date,status:"solved"}),alert("Reply Sent! "),n({...t,[u]:""}),a()}catch(h){console.error(h),alert("Failed to send reply.")}};return r?jsxRuntimeExports.jsx("div",{className:"p-10",children:"Loading Doubts..."}):jsxRuntimeExports.jsxs("div",{className:"p-6 bg-slate-50 min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[jsxRuntimeExports.jsx(CircleQuestionMark,{className:"text-purple-600"})," Student Doubt Solver"]}),jsxRuntimeExports.jsx("p",{className:"text-gray-500 text-sm",children:"Reply to student queries from all batches."})]}),jsxRuntimeExports.jsx("div",{className:"space-y-4 max-w-4xl",children:i.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-20 bg-white rounded-xl border border-dashed text-gray-400",children:"All doubts are cleared! "}):i.map(u=>jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl border shadow-sm overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 bg-purple-50/50 border-b flex justify-between items-start",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[jsxRuntimeExports.jsx("span",{className:"font-bold text-gray-800",children:u.userName}),jsxRuntimeExports.jsx("span",{className:"text-[10px] bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full font-bold",children:"STUDENT"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-700 font-medium",children:u.text})]}),u.status==="solved"&&jsxRuntimeExports.jsxs("span",{className:"bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded flex items-center gap-1",children:[jsxRuntimeExports.jsx(CircleCheckBig,{size:12})," SOLVED"]})]}),jsxRuntimeExports.jsx("div",{className:"p-4 bg-white",children:u.reply?jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg border-l-4 border-l-blue-500",children:[jsxRuntimeExports.jsx("p",{className:"text-[10px] font-bold text-blue-600 mb-1",children:"YOUR REPLY"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:u.reply})]}):jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("textarea",{placeholder:"Type your answer here...",className:"w-full border rounded-lg p-2 text-sm focus:ring-2 ring-purple-500 outline-none h-20",value:t[u.id]||"",onChange:d=>n({...t,[u.id]:d.target.value})}),jsxRuntimeExports.jsx("button",{onClick:()=>l(u.id),className:"bg-purple-600 text-white px-4 rounded-lg hover:bg-purple-700 transition flex items-center justify-center",children:jsxRuntimeExports.jsx(Send,{size:20})})]})})]},u.id))})]})};var lib$h={exports:{}},core_min={};function commonjsRequire(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}},hasRequiredPdf;function requirePdf(){return hasRequiredPdf||(hasRequiredPdf=1,(function(module,exports$1){(function(e,t){module.exports=t()})(globalThis,()=>(()=>{var __webpack_modules__=[,((i,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VerbosityLevel=e.Util=e.UnknownErrorException=e.UnexpectedResponseException=e.UNSUPPORTED_FEATURES=e.TextRenderingMode=e.RenderingIntentFlag=e.PermissionFlag=e.PasswordResponses=e.PasswordException=e.PageActionEventType=e.OPS=e.MissingPDFException=e.LINE_FACTOR=e.LINE_DESCENT_FACTOR=e.InvalidPDFException=e.ImageKind=e.IDENTITY_MATRIX=e.FormatError=e.FeatureTest=e.FONT_IDENTITY_MATRIX=e.DocumentActionEventType=e.CMapCompressionType=e.BaseException=e.BASELINE_FACTOR=e.AnnotationType=e.AnnotationStateModelType=e.AnnotationReviewState=e.AnnotationReplyType=e.AnnotationMode=e.AnnotationMarkedState=e.AnnotationFlag=e.AnnotationFieldFlag=e.AnnotationEditorType=e.AnnotationEditorPrefix=e.AnnotationEditorParamsType=e.AnnotationBorderStyleType=e.AnnotationActionEventType=e.AbortException=void 0,e.assert=re,e.bytesToString=Je,e.createPromiseCapability=Zn,e.createValidAbsoluteUrl=pe,e.getModificationDate=ai,e.getVerbosityLevel=ue,e.info=oe,e.isArrayBuffer=Wn,e.isArrayEqual=hi,e.objectFromMap=ln,e.objectSize=Lt,e.setVerbosityLevel=le,e.shadow=Z,e.string32=rt,e.stringToBytes=wt,e.stringToPDFString=In,e.stringToUTF8String=Jn,e.unreachable=se,e.utf8StringToString=ri,e.warn=ee;const t=[1,0,0,1,0,0];e.IDENTITY_MATRIX=t;const n=[.001,0,0,.001,0,0];e.FONT_IDENTITY_MATRIX=n;const r=1.35;e.LINE_FACTOR=r;const s=.35;e.LINE_DESCENT_FACTOR=s;const a=s/r;e.BASELINE_FACTOR=a;const l={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};e.RenderingIntentFlag=l;const u={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};e.AnnotationMode=u;const d="pdfjs_internal_editor_";e.AnnotationEditorPrefix=d;const h={DISABLE:-1,NONE:0,FREETEXT:3,INK:15};e.AnnotationEditorType=h;const p={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};e.AnnotationEditorParamsType=p;const m={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};e.PermissionFlag=m;const g={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};e.TextRenderingMode=g;const v={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};e.ImageKind=v;const _={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};e.AnnotationType=_;const b={MARKED:"Marked",REVIEW:"Review"};e.AnnotationStateModelType=b;const E={MARKED:"Marked",UNMARKED:"Unmarked"};e.AnnotationMarkedState=E;const A={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};e.AnnotationReviewState=A;const z={GROUP:"Group",REPLY:"R"};e.AnnotationReplyType=z;const D={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};e.AnnotationFlag=D;const P={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};e.AnnotationFieldFlag=P;const G={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};e.AnnotationBorderStyleType=G;const R={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};e.AnnotationActionEventType=R;const I={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};e.DocumentActionEventType=I;const w={O:"PageOpen",C:"PageClose"};e.PageActionEventType=w;const H={ERRORS:0,WARNINGS:1,INFOS:5};e.VerbosityLevel=H;const V={NONE:0,BINARY:1};e.CMapCompressionType=V;const te={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};e.OPS=te;const ae={forms:"forms",javaScript:"javaScript",signatures:"signatures",smask:"smask",shadingPattern:"shadingPattern",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontBuildPath:"errorFontBuildPath",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent",errorContentSubStream:"errorContentSubStream"};e.UNSUPPORTED_FEATURES=ae;const be={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};e.PasswordResponses=be;let _e=H.WARNINGS;function le(Ft){Number.isInteger(Ft)&&(_e=Ft)}function ue(){return _e}function oe(Ft){_e>=H.INFOS&&console.log(`Info: ${Ft}`)}function ee(Ft){_e>=H.WARNINGS&&console.log(`Warning: ${Ft}`)}function se(Ft){throw new Error(Ft)}function re(Ft,Xe){Ft||se(Xe)}function fe(Ft){if(!Ft)return!1;switch(Ft.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function pe(Ft,Xe=null,Ye=null){if(!Ft)return null;try{if(Ye&&typeof Ft=="string"){if(Ye.addDefaultProtocol&&Ft.startsWith("www.")){const Vn=Ft.match(/\./g);Vn&&Vn.length>=2&&(Ft=`http://${Ft}`)}if(Ye.tryConvertEncoding)try{Ft=Jn(Ft)}catch{}}const xn=Xe?new URL(Ft,Xe):new URL(Ft);if(fe(xn))return xn}catch{}return null}function Z(Ft,Xe,Ye,xn=!1){return Object.defineProperty(Ft,Xe,{value:Ye,enumerable:!xn,configurable:!0,writable:!1}),Ye}const ce=(function(){function Xe(Ye,xn){this.constructor===Xe&&se("Cannot initialize BaseException."),this.message=Ye,this.name=xn}return Xe.prototype=new Error,Xe.constructor=Xe,Xe})();e.BaseException=ce;class Ee extends ce{constructor(Xe,Ye){super(Xe,"PasswordException"),this.code=Ye}}e.PasswordException=Ee;class Te extends ce{constructor(Xe,Ye){super(Xe,"UnknownErrorException"),this.details=Ye}}e.UnknownErrorException=Te;class Ae extends ce{constructor(Xe){super(Xe,"InvalidPDFException")}}e.InvalidPDFException=Ae;class Pe extends ce{constructor(Xe){super(Xe,"MissingPDFException")}}e.MissingPDFException=Pe;class Me extends ce{constructor(Xe,Ye){super(Xe,"UnexpectedResponseException"),this.status=Ye}}e.UnexpectedResponseException=Me;class We extends ce{constructor(Xe){super(Xe,"FormatError")}}e.FormatError=We;class qe extends ce{constructor(Xe){super(Xe,"AbortException")}}e.AbortException=qe;function Je(Ft){(typeof Ft!="object"||Ft===null||Ft.length===void 0)&&se("Invalid argument for bytesToString");const Xe=Ft.length,Ye=8192;if(Xe<Ye)return String.fromCharCode.apply(null,Ft);const xn=[];for(let Vn=0;Vn<Xe;Vn+=Ye){const Bn=Math.min(Vn+Ye,Xe),si=Ft.subarray(Vn,Bn);xn.push(String.fromCharCode.apply(null,si))}return xn.join("")}function wt(Ft){typeof Ft!="string"&&se("Invalid argument for stringToBytes");const Xe=Ft.length,Ye=new Uint8Array(Xe);for(let xn=0;xn<Xe;++xn)Ye[xn]=Ft.charCodeAt(xn)&255;return Ye}function rt(Ft){return String.fromCharCode(Ft>>24&255,Ft>>16&255,Ft>>8&255,Ft&255)}function Lt(Ft){return Object.keys(Ft).length}function ln(Ft){const Xe=Object.create(null);for(const[Ye,xn]of Ft)Xe[Ye]=xn;return Xe}function dt(){const Ft=new Uint8Array(4);return Ft[0]=1,new Uint32Array(Ft.buffer,0,1)[0]===1}function st(){try{return new Function(""),!0}catch{return!1}}class nt{static get isLittleEndian(){return Z(this,"isLittleEndian",dt())}static get isEvalSupported(){return Z(this,"isEvalSupported",st())}static get isOffscreenCanvasSupported(){return Z(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?Z(this,"platform",{isWin:!1,isMac:!1}):Z(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}}e.FeatureTest=nt;const dn=[...Array(256).keys()].map(Ft=>Ft.toString(16).padStart(2,"0"));class pn{static makeHexColor(Xe,Ye,xn){return`#${dn[Xe]}${dn[Ye]}${dn[xn]}`}static scaleMinMax(Xe,Ye){let xn;Xe[0]?(Xe[0]<0&&(xn=Ye[0],Ye[0]=Ye[1],Ye[1]=xn),Ye[0]*=Xe[0],Ye[1]*=Xe[0],Xe[3]<0&&(xn=Ye[2],Ye[2]=Ye[3],Ye[3]=xn),Ye[2]*=Xe[3],Ye[3]*=Xe[3]):(xn=Ye[0],Ye[0]=Ye[2],Ye[2]=xn,xn=Ye[1],Ye[1]=Ye[3],Ye[3]=xn,Xe[1]<0&&(xn=Ye[2],Ye[2]=Ye[3],Ye[3]=xn),Ye[2]*=Xe[1],Ye[3]*=Xe[1],Xe[2]<0&&(xn=Ye[0],Ye[0]=Ye[1],Ye[1]=xn),Ye[0]*=Xe[2],Ye[1]*=Xe[2]),Ye[0]+=Xe[4],Ye[1]+=Xe[4],Ye[2]+=Xe[5],Ye[3]+=Xe[5]}static transform(Xe,Ye){return[Xe[0]*Ye[0]+Xe[2]*Ye[1],Xe[1]*Ye[0]+Xe[3]*Ye[1],Xe[0]*Ye[2]+Xe[2]*Ye[3],Xe[1]*Ye[2]+Xe[3]*Ye[3],Xe[0]*Ye[4]+Xe[2]*Ye[5]+Xe[4],Xe[1]*Ye[4]+Xe[3]*Ye[5]+Xe[5]]}static applyTransform(Xe,Ye){const xn=Xe[0]*Ye[0]+Xe[1]*Ye[2]+Ye[4],Vn=Xe[0]*Ye[1]+Xe[1]*Ye[3]+Ye[5];return[xn,Vn]}static applyInverseTransform(Xe,Ye){const xn=Ye[0]*Ye[3]-Ye[1]*Ye[2],Vn=(Xe[0]*Ye[3]-Xe[1]*Ye[2]+Ye[2]*Ye[5]-Ye[4]*Ye[3])/xn,Bn=(-Xe[0]*Ye[1]+Xe[1]*Ye[0]+Ye[4]*Ye[1]-Ye[5]*Ye[0])/xn;return[Vn,Bn]}static getAxialAlignedBoundingBox(Xe,Ye){const xn=pn.applyTransform(Xe,Ye),Vn=pn.applyTransform(Xe.slice(2,4),Ye),Bn=pn.applyTransform([Xe[0],Xe[3]],Ye),si=pn.applyTransform([Xe[2],Xe[1]],Ye);return[Math.min(xn[0],Vn[0],Bn[0],si[0]),Math.min(xn[1],Vn[1],Bn[1],si[1]),Math.max(xn[0],Vn[0],Bn[0],si[0]),Math.max(xn[1],Vn[1],Bn[1],si[1])]}static inverseTransform(Xe){const Ye=Xe[0]*Xe[3]-Xe[1]*Xe[2];return[Xe[3]/Ye,-Xe[1]/Ye,-Xe[2]/Ye,Xe[0]/Ye,(Xe[2]*Xe[5]-Xe[4]*Xe[3])/Ye,(Xe[4]*Xe[1]-Xe[5]*Xe[0])/Ye]}static singularValueDecompose2dScale(Xe){const Ye=[Xe[0],Xe[2],Xe[1],Xe[3]],xn=Xe[0]*Ye[0]+Xe[1]*Ye[2],Vn=Xe[0]*Ye[1]+Xe[1]*Ye[3],Bn=Xe[2]*Ye[0]+Xe[3]*Ye[2],si=Xe[2]*Ye[1]+Xe[3]*Ye[3],Yi=(xn+si)/2,ei=Math.sqrt((xn+si)**2-4*(xn*si-Bn*Vn))/2,oi=Yi+ei||1,Li=Yi-ei||1;return[Math.sqrt(oi),Math.sqrt(Li)]}static normalizeRect(Xe){const Ye=Xe.slice(0);return Xe[0]>Xe[2]&&(Ye[0]=Xe[2],Ye[2]=Xe[0]),Xe[1]>Xe[3]&&(Ye[1]=Xe[3],Ye[3]=Xe[1]),Ye}static intersect(Xe,Ye){const xn=Math.max(Math.min(Xe[0],Xe[2]),Math.min(Ye[0],Ye[2])),Vn=Math.min(Math.max(Xe[0],Xe[2]),Math.max(Ye[0],Ye[2]));if(xn>Vn)return null;const Bn=Math.max(Math.min(Xe[1],Xe[3]),Math.min(Ye[1],Ye[3])),si=Math.min(Math.max(Xe[1],Xe[3]),Math.max(Ye[1],Ye[3]));return Bn>si?null:[xn,Bn,Vn,si]}static bezierBoundingBox(Xe,Ye,xn,Vn,Bn,si,Yi,ei){const oi=[],Li=[[],[]];let xe,Ce,Fe,tt,Tn,jn,li,Fi;for(let gr=0;gr<2;++gr){if(gr===0?(Ce=6*Xe-12*xn+6*Bn,xe=-3*Xe+9*xn-9*Bn+3*Yi,Fe=3*xn-3*Xe):(Ce=6*Ye-12*Vn+6*si,xe=-3*Ye+9*Vn-9*si+3*ei,Fe=3*Vn-3*Ye),Math.abs(xe)<1e-12){if(Math.abs(Ce)<1e-12)continue;tt=-Fe/Ce,0<tt&&tt<1&&oi.push(tt);continue}li=Ce*Ce-4*Fe*xe,Fi=Math.sqrt(li),!(li<0)&&(Tn=(-Ce+Fi)/(2*xe),0<Tn&&Tn<1&&oi.push(Tn),jn=(-Ce-Fi)/(2*xe),0<jn&&jn<1&&oi.push(jn))}let Qi=oi.length,Di;const nr=Qi;for(;Qi--;)tt=oi[Qi],Di=1-tt,Li[0][Qi]=Di*Di*Di*Xe+3*Di*Di*tt*xn+3*Di*tt*tt*Bn+tt*tt*tt*Yi,Li[1][Qi]=Di*Di*Di*Ye+3*Di*Di*tt*Vn+3*Di*tt*tt*si+tt*tt*tt*ei;return Li[0][nr]=Xe,Li[1][nr]=Ye,Li[0][nr+1]=Yi,Li[1][nr+1]=ei,Li[0].length=Li[1].length=nr+2,[Math.min(...Li[0]),Math.min(...Li[1]),Math.max(...Li[0]),Math.max(...Li[1])]}}e.Util=pn;const An=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function In(Ft){if(Ft[0]>=""){let Ye;if(Ft[0]===""&&Ft[1]===""?Ye="utf-16be":Ft[0]===""&&Ft[1]===""?Ye="utf-16le":Ft[0]===""&&Ft[1]===""&&Ft[2]===""&&(Ye="utf-8"),Ye)try{const xn=new TextDecoder(Ye,{fatal:!0}),Vn=wt(Ft);return xn.decode(Vn)}catch(xn){ee(`stringToPDFString: "${xn}".`)}}const Xe=[];for(let Ye=0,xn=Ft.length;Ye<xn;Ye++){const Vn=An[Ft.charCodeAt(Ye)];Xe.push(Vn?String.fromCharCode(Vn):Ft.charAt(Ye))}return Xe.join("")}function Jn(Ft){return decodeURIComponent(escape(Ft))}function ri(Ft){return unescape(encodeURIComponent(Ft))}function Wn(Ft){return typeof Ft=="object"&&Ft!==null&&Ft.byteLength!==void 0}function hi(Ft,Xe){if(Ft.length!==Xe.length)return!1;for(let Ye=0,xn=Ft.length;Ye<xn;Ye++)if(Ft[Ye]!==Xe[Ye])return!1;return!0}function ai(Ft=new Date){return[Ft.getUTCFullYear().toString(),(Ft.getUTCMonth()+1).toString().padStart(2,"0"),Ft.getUTCDate().toString().padStart(2,"0"),Ft.getUTCHours().toString().padStart(2,"0"),Ft.getUTCMinutes().toString().padStart(2,"0"),Ft.getUTCSeconds().toString().padStart(2,"0")].join("")}function Zn(){const Ft=Object.create(null);let Xe=!1;return Object.defineProperty(Ft,"settled",{get(){return Xe}}),Ft.promise=new Promise(function(Ye,xn){Ft.resolve=function(Vn){Xe=!0,Ye(Vn)},Ft.reject=function(Vn){Xe=!0,xn(Vn)}}),Ft}}),((__unused_webpack_module,exports$1,__w_pdfjs_require__)=>{Object.defineProperty(exports$1,"__esModule",{value:!0}),exports$1.build=exports$1.RenderTask=exports$1.PDFWorkerUtil=exports$1.PDFWorker=exports$1.PDFPageProxy=exports$1.PDFDocumentProxy=exports$1.PDFDocumentLoadingTask=exports$1.PDFDataRangeTransport=exports$1.LoopbackPort=exports$1.DefaultStandardFontDataFactory=exports$1.DefaultCanvasFactory=exports$1.DefaultCMapReaderFactory=void 0,exports$1.getDocument=getDocument,exports$1.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_is_node=__w_pdfjs_require__(10),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_xfa_text=__w_pdfjs_require__(19);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100;let DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports$1.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports$1.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory;if(exports$1.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){const{NodeCanvasFactory:i,NodeCMapReaderFactory:e,NodeStandardFontDataFactory:t}=__w_pdfjs_require__(20);exports$1.DefaultCanvasFactory=DefaultCanvasFactory=i,exports$1.DefaultCMapReaderFactory=DefaultCMapReaderFactory=e,exports$1.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=t}let createPDFNetworkStream;if(_is_node.isNodeJS){const{PDFNodeStream:i}=__w_pdfjs_require__(21);createPDFNetworkStream=e=>new i(e)}else{const{PDFNetworkStream:i}=__w_pdfjs_require__(24),{PDFFetchStream:e}=__w_pdfjs_require__(25);createPDFNetworkStream=t=>(0,_display_utils.isValidFetchUrl)(t.url)?new e(t):new i(t)}function getDocument(i){if(typeof i=="string"||i instanceof URL)i={url:i};else if((0,_util.isArrayBuffer)(i))i={data:i};else if(i instanceof PDFDataRangeTransport)(0,_display_utils.deprecated)("`PDFDataRangeTransport`-instance, please use a parameter object with `range`-property instead."),i={range:i};else if(typeof i!="object")throw new Error("Invalid parameter in getDocument, need either string, URL, TypedArray, or parameter object.");if(!i.url&&!i.data&&!i.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const e=new PDFDocumentLoadingTask,t=i.url?getUrlProp(i.url):null,n=i.data?getDataProp(i.data):null,r=i.httpHeaders||null,s=i.withCredentials===!0,a=i.password??null,l=i.range instanceof PDFDataRangeTransport?i.range:null,u=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let d=i.worker instanceof PDFWorker?i.worker:null;const h=i.verbosity,p=typeof i.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(i.docBaseUrl)?i.docBaseUrl:null,m=typeof i.cMapUrl=="string"?i.cMapUrl:null,g=i.cMapPacked!==!1,v=i.CMapReaderFactory||DefaultCMapReaderFactory,_=typeof i.standardFontDataUrl=="string"?i.standardFontDataUrl:null,b=i.StandardFontDataFactory||DefaultStandardFontDataFactory,E=i.stopAtErrors!==!0,A=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,z=i.isEvalSupported!==!1,D=typeof i.isOffscreenCanvasSupported=="boolean"?i.isOffscreenCanvasSupported:!_is_node.isNodeJS,P=typeof i.disableFontFace=="boolean"?i.disableFontFace:_is_node.isNodeJS,G=i.fontExtraProperties===!0,R=i.enableXfa===!0,I=i.ownerDocument||globalThis.document,w=i.disableRange===!0,H=i.disableStream===!0,V=i.disableAutoFetch===!0,te=i.pdfBug===!0,ae=l?l.length:i.length??NaN,be=typeof i.useSystemFonts=="boolean"?i.useSystemFonts:!_is_node.isNodeJS&&!P,_e=typeof i.useWorkerFetch=="boolean"?i.useWorkerFetch:v===_display_utils.DOMCMapReaderFactory&&b===_display_utils.DOMStandardFontDataFactory&&(0,_display_utils.isValidFetchUrl)(m,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(_,document.baseURI),le=null;(0,_util.setVerbosityLevel)(h);const ue=_e?null:{cMapReaderFactory:new v({baseUrl:m,isCompressed:g}),standardFontDataFactory:new b({baseUrl:_})};if(!d){const re={verbosity:h,port:_worker_options.GlobalWorkerOptions.workerPort};d=re.port?PDFWorker.fromPort(re):new PDFWorker(re),e._worker=d}const oe=e.docId,ee={docId:oe,apiVersion:"3.4.120",data:n,password:a,disableAutoFetch:V,rangeChunkSize:u,length:ae,docBaseUrl:p,enableXfa:R,evaluatorOptions:{maxImageSize:A,disableFontFace:P,ignoreErrors:E,isEvalSupported:z,isOffscreenCanvasSupported:D,fontExtraProperties:G,useSystemFonts:be,cMapUrl:_e?m:null,standardFontDataUrl:_e?_:null}},se={ignoreErrors:E,isEvalSupported:z,disableFontFace:P,fontExtraProperties:G,enableXfa:R,ownerDocument:I,disableAutoFetch:V,pdfBug:te,styleElement:le};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");const re=_fetchDocument(d,ee),fe=new Promise(function(pe){let Z;l?Z=new _transport_stream.PDFDataTransportStream({length:ae,initialData:l.initialData,progressiveDone:l.progressiveDone,contentDispositionFilename:l.contentDispositionFilename,disableRange:w,disableStream:H},l):n||(Z=createPDFNetworkStream({url:t,length:ae,httpHeaders:r,withCredentials:s,rangeChunkSize:u,disableRange:w,disableStream:H})),pe(Z)});return Promise.all([re,fe]).then(function([pe,Z]){if(e.destroyed)throw new Error("Loading aborted");const ce=new _message_handler.MessageHandler(oe,pe,d.port),Ee=new WorkerTransport(ce,e,Z,se,ue);e._transport=Ee,ce.send("Ready",null)})}).catch(e._capability.reject),e}async function _fetchDocument(i,e){if(i.destroyed)throw new Error("Worker was destroyed");const t=await i.messageHandler.sendWithPromise("GetDocRequest",e,e.data?[e.data.buffer]:null);if(i.destroyed)throw new Error("Worker was destroyed");return t}function getUrlProp(i){if(i instanceof URL)return i.href;try{return new URL(i,window.location).href}catch{if(_is_node.isNodeJS&&typeof i=="string")return i}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(i){if(_is_node.isNodeJS&&typeof Buffer<"u"&&i instanceof Buffer)return(0,_display_utils.deprecated)("Please provide binary data as `Uint8Array`, rather than `Buffer`."),new Uint8Array(i);if(i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength)return i;if(typeof i=="string")return(0,_util.stringToBytes)(i);if(typeof i=="object"&&!isNaN(i?.length)||(0,_util.isArrayBuffer)(i))return new Uint8Array(i);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}class PDFDocumentLoadingTask{static#e=0;#t=null;constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId=`d${PDFDocumentLoadingTask.#e++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get onUnsupportedFeature(){return this.#t}set onUnsupportedFeature(e){(0,_display_utils.deprecated)("The PDFDocumentLoadingTask onUnsupportedFeature property will be removed in the future."),this.#t=e}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0,await this._transport?.destroy(),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}exports$1.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(e,t,n=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const n of this._progressListeners)n(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports$1.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports$1.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,t,n,r,s=!1){this._pageIndex=e,this._pageInfo=t,this._ownerDocument=r,this._transport=n,this._stats=s?new _display_utils.StatTimer:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new PDFObjects,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:s=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:s})}getAnnotations({intent:e="display"}={}){const t=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:r=_util.AnnotationMode.ENABLE,transform:s=null,canvasFactory:a=null,background:l=null,optionalContentConfigPromise:u=null,annotationCanvasMap:d=null,pageColors:h=null,printAnnotationStorage:p=null}){this._stats?.time("Overall");const m=this._transport.getRenderingIntent(n,r,p);this.pendingCleanup=!1,u||(u=this._transport.getOptionalContentConfig());let g=this._intentStates.get(m.cacheKey);g||(g=Object.create(null),this._intentStates.set(m.cacheKey,g)),g.streamReaderCancelTimeout&&(clearTimeout(g.streamReaderCancelTimeout),g.streamReaderCancelTimeout=null);const v=a||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),_=!!(m.renderingIntent&_util.RenderingIntentFlag.PRINT);g.displayReadyCapability||(g.displayReadyCapability=(0,_util.createPromiseCapability)(),g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(m));const b=z=>{g.renderTasks.delete(E),(this.cleanupAfterRender||_)&&(this.pendingCleanup=!0),this._tryCleanup(),z?(E.capability.reject(z),this._abortOperatorList({intentState:g,reason:z instanceof Error?z:new Error(z)})):E.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},E=new InternalRenderTask({callback:b,params:{canvasContext:e,viewport:t,transform:s,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:d,operatorList:g.operatorList,pageIndex:this._pageIndex,canvasFactory:v,useRequestAnimationFrame:!_,pdfBug:this._pdfBug,pageColors:h});(g.renderTasks||=new Set).add(E);const A=E.task;return Promise.all([g.displayReadyCapability.promise,u]).then(([z,D])=>{if(this.pendingCleanup){b();return}this._stats?.time("Rendering"),E.initializeGraphics({transparency:z,optionalContentConfig:D}),E.operatorListChanged()}).catch(b),A}getOperatorList({intent:e="display",annotationMode:t=_util.AnnotationMode.ENABLE,printAnnotationStorage:n=null}={}){function r(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const s=this._transport.getRenderingIntent(e,t,n,!0);let a=this._intentStates.get(s.cacheKey);a||(a=Object.create(null),this._intentStates.set(s.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=r,a.opListReadCapability=(0,_util.createPromiseCapability)(),(a.renderTasks||=new Set).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(s)),a.opListReadCapability.promise}streamTextContent({disableCombineTextItems:e=!1,includeMarkedContent:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,combineTextItems:e!==!0,includeMarkedContent:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>_xfa_text.XfaText.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,r){function s(){a.read().then(function({value:u,done:d}){if(d){n(l);return}Object.assign(l.styles,u.styles),l.items.push(...u.items),s()},r)}const a=t.getReader(),l={items:[],styles:Object.create(null)};s()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),this.pendingCleanup=!1,Promise.all(e)}cleanup(e=!1){return this.pendingCleanup=!0,this._tryCleanup(e)}_tryCleanup(e=!1){if(!this.pendingCleanup)return!1;for(const{renderTasks:t,operatorList:n}of this._intentStates.values())if(t.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),e&&this._stats&&(this._stats=new _display_utils.StatTimer),this.pendingCleanup=!1,!0}_startRenderPage(e,t){const n=this._intentStates.get(t);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&this._tryCleanup()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageMap:n}){const s=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n}).getReader(),a=this._intentStates.get(t);a.streamReader=s;const l=()=>{s.read().then(({value:u,done:d})=>{if(d){a.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,a),l())},u=>{if(a.streamReader=null,!this._transport.destroyed){if(a.operatorList){a.operatorList.lastChunk=!0;for(const d of a.renderTasks)d.operatorListChanged();this._tryCleanup()}if(a.displayReadyCapability)a.displayReadyCapability.reject(u);else if(a.opListReadCapability)a.opListReadCapability.reject(u);else throw u}})};l()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof _display_utils.RenderingCancelledException){let r=RENDERING_CANCELLED_TIMEOUT;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new _util.AbortException(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,s]of this._intentStates)if(s===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}exports$1.PDFPageProxy=PDFPageProxy;class LoopbackPort{#e=new Set;#t=Promise.resolve();postMessage(e,t){const n={data:structuredClone(e,t)};this.#t.then(()=>{for(const r of this.#e)r.call(this,n)})}addEventListener(e,t){this.#e.add(t)}removeEventListener(e,t){this.#e.delete(t)}terminate(){this.#e.clear()}}exports$1.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports$1.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const i=document?.currentScript?.src;i&&(PDFWorkerUtil.fallbackWorkerSrc=i.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(i,e){let t;try{if(t=new URL(i),!t.origin||t.origin==="null")return!1}catch{return!1}const n=new URL(e,t);return t.origin===n.origin},PDFWorkerUtil.createCDNWrapper=function(i){const e=`importScripts("${i}");`;return URL.createObjectURL(new Blob([e]))}}class PDFWorker{static#workerPorts=new WeakMap;constructor({name:i=null,port:e=null,verbosity:t=(0,_util.getVerbosityLevel)()}={}){if(e&&PDFWorker.#workerPorts.has(e))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=i,this.destroyed=!1,this.verbosity=t,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,e){PDFWorker.#workerPorts.set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(i){this._port=i,this._messageHandler=new _message_handler.MessageHandler("main","worker",i),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:i}=PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,i)||(i=PDFWorkerUtil.createCDNWrapper(new URL(i,window.location).href));const e=new Worker(i),t=new _message_handler.MessageHandler("main","worker",e),n=()=>{e.removeEventListener("error",r),t.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=()=>{this._webWorker||n()};e.addEventListener("error",r),t.on("test",a=>{if(e.removeEventListener("error",r),this.destroyed){n();return}a?(this._messageHandler=t,this._port=e,this._webWorker=e,this._readyCapability.resolve(),t.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),t.destroy(),e.terminate())}),t.on("ready",a=>{if(e.removeEventListener("error",r),this.destroyed){n();return}try{s()}catch{this._setupFakeWorker()}});const s=()=>{const a=new Uint8Array;t.send("test",a,[a.buffer])};s();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then(i=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const e=new LoopbackPort;this._port=e;const t=`fake${PDFWorkerUtil.fakeWorkerId++}`,n=new _message_handler.MessageHandler(t+"_worker",t,e);i.setup(n,e);const r=new _message_handler.MessageHandler(t,t+"_worker",e);this._messageHandler=r,this._readyCapability.resolve(),r.send("configure",{verbosity:this.verbosity})}).catch(i=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${i.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#workerPorts.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(i){if(!i?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return this.#workerPorts.has(i.port)?this.#workerPorts.get(i.port):new PDFWorker(i)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports$1.PDFWorker=PDFWorker;class WorkerTransport{#e=new Map;#t=new Map;#i=new Map;constructor(e,t,n,r,s){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this._params=r,this.cMapReaderFactory=s?.cMapReaderFactory,this.standardFontDataFactory=s?.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}#n(e,t=null){const n=this.#e.get(e);if(n)return n;const r=this.messageHandler.sendWithPromise(e,t);return this.#e.set(e,r),r}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(e,t=_util.AnnotationMode.ENABLE,n=null,r=!1){let s=_util.RenderingIntentFlag.DISPLAY,a=null;switch(e){case"any":s=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":s=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${e}`)}switch(t){case _util.AnnotationMode.DISABLE:s+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:s+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:s+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,a=(s&_util.RenderingIntentFlag.PRINT&&n instanceof _annotation_storage.PrintAnnotationStorage?n:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${t}`)}return r&&(s+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:s,cacheKey:`${s}_${_annotation_storage.AnnotationStorage.getHash(a)}`,annotationStorageMap:a}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const n of this.#t.values())e.push(n._destroy());this.#t.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,r)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},r.onPull=()=>{this._fullReader.read().then(function({value:s,done:a}){if(a){r.close();return}(0,_util.assert)(s instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{r.error(s)})},r.onCancel=s=>{this._fullReader.cancel(s),r.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",n=>{const r=(0,_util.createPromiseCapability)(),s=this._fullReader;return s.headersReady.then(()=>{(!s.isStreamingSupported||!s.isRangeSupported)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),s.onProgress=a=>{t.onProgress?.({loaded:a.loaded,total:a.total})}),r.resolve({isStreamingSupported:s.isStreamingSupported,isRangeSupported:s.isRangeSupported,contentLength:s.contentLength})},r.reject),r.promise}),e.on("GetRangeReader",(n,r)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(n.begin,n.end);if(!s){r.close();return}r.onPull=()=>{s.read().then(function({value:a,done:l}){if(l){r.close();return}(0,_util.assert)(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{r.error(a)})},r.onCancel=a=>{s.cancel(a),r.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new PDFDocumentProxy(n,this))}),e.on("DocException",function(n){let r;switch(n.name){case"PasswordException":r=new _util.PasswordException(n.message,n.code);break;case"InvalidPDFException":r=new _util.InvalidPDFException(n.message);break;case"MissingPDFException":r=new _util.MissingPDFException(n.message);break;case"UnexpectedResponseException":r=new _util.UnexpectedResponseException(n.message,n.status);break;case"UnknownErrorException":r=new _util.UnknownErrorException(n.message,n.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}t._capability.reject(r)}),e.on("PasswordRequest",n=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),t.onPassword){const r=s=>{s instanceof Error?this._passwordCapability.reject(s):this._passwordCapability.resolve({password:s})};try{t.onPassword(r,n.code)}catch(s){this._passwordCapability.reject(s)}}else this._passwordCapability.reject(new _util.PasswordException(n.message,n.code));return this._passwordCapability.promise}),e.on("DataLoaded",n=>{t.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;this.#t.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,r,s])=>{if(!this.destroyed&&!this.commonObjs.has(n))switch(r){case"Font":const a=this._params;if("error"in s){const d=s.error;(0,_util.warn)(`Error during font loading: ${d}`),this.commonObjs.resolve(n,d);break}let l=null;a.pdfBug&&globalThis.FontInspector?.enabled&&(l={registerFont(d,h){globalThis.FontInspector.fontAdded(d,h)}});const u=new _font_loader.FontFaceObject(s,{isEvalSupported:a.isEvalSupported,disableFontFace:a.disableFontFace,ignoreErrors:a.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:l});this.fontLoader.bind(u).catch(d=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!a.fontExtraProperties&&u.data&&(u.data=null),this.commonObjs.resolve(n,u)});break;case"FontPath":case"Image":this.commonObjs.resolve(n,s);break;default:throw new Error(`Got unknown common object type ${r}`)}}),e.on("obj",([n,r,s,a])=>{if(this.destroyed)return;const l=this.#t.get(r);if(!l.objs.has(n))switch(s){case"Image":l.objs.resolve(n,a);const u=8e6;if(a){let d;if(a.bitmap){const{width:h,height:p}=a;d=h*p*4}else d=a.data?.length||0;d>u&&(l.cleanupAfterRender=!0)}break;case"Pattern":l.objs.resolve(n,a);break;default:throw new Error(`Got unknown object type ${s}`)}}),e.on("DocProgress",n=>{this.destroyed||t.onProgress?.({loaded:n.loaded,total:n.total})}),e.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),e.on("FetchBuiltInCMap",n=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(n):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),e.on("FetchStandardFontData",n=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(n):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}_onUnsupportedFeature({featureId:e}){this.destroyed||this.loadingTask.onUnsupportedFeature?.(e)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){return this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:this._fullReader?.filename??null}).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=this.#i.get(t);if(n)return n;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");const a=new PDFPageProxy(t,s,this,this._params.ownerDocument,this._params.pdfBug);return this.#t.set(t,a),a});return this.#i.set(t,r),r}getPageIndex(e){return typeof e!="object"||e===null||!Number.isInteger(e.num)||e.num<0||!Number.isInteger(e.gen)||e.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen})}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#n("GetFieldObjects")}hasJSActions(){return this.#n("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(e=>new _optional_content_config.OptionalContentConfig(e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#e.get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(r=>({info:r[0],metadata:r[1]?new _metadata.Metadata(r[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#e.clear()}}get loadingParams(){const{disableAutoFetch:e,enableXfa:t}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e,enableXfa:t})}}class PDFObjects{#e=Object.create(null);#t(e){const t=this.#e[e];return t||(this.#e[e]={capability:(0,_util.createPromiseCapability)(),data:null})}get(e,t=null){if(t){const r=this.#t(e);return r.capability.promise.then(()=>t(r.data)),null}const n=this.#e[e];if(!n?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){return this.#e[e]?.capability.settled||!1}resolve(e,t=null){const n=this.#t(e);n.data=t,n.capability.resolve()}clear(){for(const e in this.#e){const{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}}class RenderTask{#e=null;constructor(e){this.#e=e,this.onContinue=null}get promise(){return this.#e.capability.promise}cancel(e=0){this.#e.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}exports$1.RenderTask=RenderTask;class InternalRenderTask{static#e=new WeakSet;constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:s,operatorList:a,pageIndex:l,canvasFactory:u,useRequestAnimationFrame:d=!1,pdfBug:h=!1,pageColors:p=null}){this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=l,this.canvasFactory=u,this._pdfBug=h,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:n,viewport:r,transform:s,background:a}=this.params;this.gfx=new _canvas.CanvasGraphics(n,this.commonObjs,this.objs,this.canvasFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:r,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this._canvas&&InternalRenderTask.#e.delete(this._canvas),this.callback(e||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas",t))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&InternalRenderTask.#e.delete(this._canvas),this.callback())))}}const version="3.4.120";exports$1.version=version;const build="af6414988";exports$1.build=build}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PrintAnnotationStorage=e.AnnotationStorage=void 0;var n=t(1),r=t(4),s=t(8);class a{#e=!1;#t=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(d,h){const p=this.#t.get(d);return p===void 0?h:Object.assign(h,p)}getRawValue(d){return this.#t.get(d)}remove(d){if(this.#t.delete(d),this.#t.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const h of this.#t.values())if(h instanceof r.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(d,h){const p=this.#t.get(d);let m=!1;if(p!==void 0)for(const[g,v]of Object.entries(h))p[g]!==v&&(m=!0,p[g]=v);else m=!0,this.#t.set(d,h);m&&this.#i(),h instanceof r.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(h.constructor._type)}has(d){return this.#t.has(d)}getAll(){return this.#t.size>0?(0,n.objectFromMap)(this.#t):null}setAll(d){for(const[h,p]of Object.entries(d))this.setValue(h,p)}get size(){return this.#t.size}#i(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new l(this)}get serializable(){if(this.#t.size===0)return null;const d=new Map;for(const[h,p]of this.#t){const m=p instanceof r.AnnotationEditor?p.serialize():p;m&&d.set(h,m)}return d}static getHash(d){if(!d)return"";const h=new s.MurmurHash3_64;for(const[p,m]of d)h.update(`${p}:${JSON.stringify(m)}`);return h.hexdigest()}}e.AnnotationStorage=a;class l extends a{#e=null;constructor(d){super(),this.#e=structuredClone(d.serializable)}get print(){(0,n.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}}e.PrintAnnotationStorage=l}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditor=void 0;var n=t(5),r=t(1);class s{#e=this.focusin.bind(this);#t=this.focusout.bind(this);#i=!1;#n=!1;#r=!1;_uiManager=null;#a=s._zIndex++;static _colorManager=new n.ColorManager;static _zIndex=1;constructor(l){this.constructor===s&&(0,r.unreachable)("Cannot initialize AnnotationEditor."),this.parent=l.parent,this.id=l.id,this.width=this.height=null,this.pageIndex=l.parent.pageIndex,this.name=l.name,this.div=null,this._uiManager=l.uiManager;const{rotation:u,rawDims:{pageWidth:d,pageHeight:h,pageX:p,pageY:m}}=this.parent.viewport;this.rotation=u,this.pageDimensions=[d,h],this.pageTranslation=[p,m];const[g,v]=this.parentDimensions;this.x=l.x/g,this.y=l.y/v,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,r.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}addCommands(l){this._uiManager.addCommands(l)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#a}setParent(l){l!==null&&(this.pageIndex=l.pageIndex,this.pageDimensions=l.pageDimensions),this.parent=l}focusin(l){this.#i?this.#i=!1:this.parent.setSelected(this)}focusout(l){!this.isAttachedToDOM||l.relatedTarget?.closest(`#${this.id}`)||(l.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}dragstart(l){const u=this.parent.div.getBoundingClientRect();this.startX=l.clientX-u.x,this.startY=l.clientY-u.y,l.dataTransfer.setData("text/plain",this.id),l.dataTransfer.effectAllowed="move"}setAt(l,u,d,h){const[p,m]=this.parentDimensions;[d,h]=this.screenToPageTranslation(d,h),this.x=(l+d)/p,this.y=(u+h)/m,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(l,u){const[d,h]=this.parentDimensions;[l,u]=this.screenToPageTranslation(l,u),this.x+=l/d,this.y+=u/h,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(l,u){switch(this.parentRotation){case 90:return[u,-l];case 180:return[-l,-u];case 270:return[-u,l];default:return[l,u]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return this._uiManager.viewParameters.rotation}get parentDimensions(){const{realScale:l}=this._uiManager.viewParameters,[u,d]=this.pageDimensions;return[u*l,d*l]}setDims(l,u){const[d,h]=this.parentDimensions;this.div.style.width=`${100*l/d}%`,this.div.style.height=`${100*u/h}%`}fixDims(){const{style:l}=this.div,{height:u,width:d}=l,h=d.endsWith("%"),p=u.endsWith("%");if(h&&p)return;const[m,g]=this.parentDimensions;h||(l.width=`${100*parseFloat(d)/m}%`),p||(l.height=`${100*parseFloat(u)/g}%`)}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#e),this.div.addEventListener("focusout",this.#t);const[l,u]=this.getInitialTranslation();return this.translate(l,u),(0,n.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(l){const{isMac:u}=r.FeatureTest.platform;if(l.button!==0||l.ctrlKey&&u){l.preventDefault();return}l.ctrlKey&&!u||l.shiftKey||l.metaKey&&u?this.parent.toggleSelected(this):this.parent.setSelected(this),this.#i=!0}getRect(l,u){const d=this.parentScale,[h,p]=this.pageDimensions,[m,g]=this.pageTranslation,v=l/d,_=u/d,b=this.x*h,E=this.y*p,A=this.width*h,z=this.height*p;switch(this.rotation){case 0:return[b+v+m,p-E-_-z+g,b+v+A+m,p-E-_+g];case 90:return[b+_+m,p-E+v+g,b+_+z+m,p-E+v+A+g];case 180:return[b-v-A+m,p-E+_+g,b-v+m,p-E+_+z+g];case 270:return[b-_-z+m,p-E-v-A+g,b-_+m,p-E-v+g];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(l,u){const[d,h,p,m]=l,g=p-d,v=m-h;switch(this.rotation){case 0:return[d,u-m,g,v];case 90:return[d,u-h,v,g];case 180:return[p,u-h,g,v];case 270:return[p,u-m,v,g];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#r=!0}disableEditMode(){this.#r=!1}isInEditMode(){return this.#r}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#e)}serialize(){(0,r.unreachable)("An editor must be serializable")}static deserialize(l,u,d){const h=new this.prototype.constructor({parent:u,id:u.getNextId(),uiManager:d});h.rotation=l.rotation;const[p,m]=h.pageDimensions,[g,v,_,b]=h.getRectInCurrentCoords(l.rect,m);return h.x=g/p,h.y=v/m,h.width=_/p,h.height=b/m,h}remove(){this.div.removeEventListener("focusin",this.#e),this.div.removeEventListener("focusout",this.#t),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){this.div?.classList.add("selectedEditor")}unselect(){this.div?.classList.remove("selectedEditor")}updateParams(l,u){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return this.#n}set isEditing(l){this.#n=l,l?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}}e.AnnotationEditor=s}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KeyboardManager=e.CommandManager=e.ColorManager=e.AnnotationEditorUIManager=void 0,e.bindEvents=s,e.opacityToHex=a;var n=t(1),r=t(6);function s(m,g,v){for(const _ of v)g.addEventListener(_,m[_].bind(m))}function a(m){return Math.round(Math.min(255,Math.max(1,255*m))).toString(16).padStart(2,"0")}class l{#e=0;getId(){return`${n.AnnotationEditorPrefix}${this.#e++}`}}class u{#e=[];#t=!1;#i;#n=-1;constructor(g=128){this.#i=g}add({cmd:g,undo:v,mustExec:_,type:b=NaN,overwriteIfSameType:E=!1,keepUndo:A=!1}){if(_&&g(),this.#t)return;const z={cmd:g,undo:v,type:b};if(this.#n===-1){this.#e.length>0&&(this.#e.length=0),this.#n=0,this.#e.push(z);return}if(E&&this.#e[this.#n].type===b){A&&(z.undo=this.#e[this.#n].undo),this.#e[this.#n]=z;return}const D=this.#n+1;D===this.#i?this.#e.splice(0,1):(this.#n=D,D<this.#e.length&&this.#e.splice(D)),this.#e.push(z)}undo(){this.#n!==-1&&(this.#t=!0,this.#e[this.#n].undo(),this.#t=!1,this.#n-=1)}redo(){this.#n<this.#e.length-1&&(this.#n+=1,this.#t=!0,this.#e[this.#n].cmd(),this.#t=!1)}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#e.length-1}destroy(){this.#e=null}}e.CommandManager=u;class d{constructor(g){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:v}=n.FeatureTest.platform;for(const[_,b]of g)for(const E of _){const A=E.startsWith("mac+");v&&A?(this.callbacks.set(E.slice(4),b),this.allKeys.add(E.split("+").at(-1))):!v&&!A&&(this.callbacks.set(E,b),this.allKeys.add(E.split("+").at(-1)))}}#e(g){g.altKey&&this.buffer.push("alt"),g.ctrlKey&&this.buffer.push("ctrl"),g.metaKey&&this.buffer.push("meta"),g.shiftKey&&this.buffer.push("shift"),this.buffer.push(g.key);const v=this.buffer.join("+");return this.buffer.length=0,v}exec(g,v){if(!this.allKeys.has(v.key))return;const _=this.callbacks.get(this.#e(v));_&&(_.bind(g)(),v.stopPropagation(),v.preventDefault())}}e.KeyboardManager=d;class h{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const g=new Map([["CanvasText",null],["Canvas",null]]);return(0,r.getColorValues)(g),(0,n.shadow)(this,"_colors",g)}convert(g){const v=(0,r.getRGB)(g);if(!window.matchMedia("(forced-colors: active)").matches)return v;for(const[_,b]of this._colors)if(b.every((E,A)=>E===v[A]))return h._colorsMapping.get(_);return v}getHexCode(g){const v=this._colors.get(g);return v?n.Util.makeHexColor(...v):g}}e.ColorManager=h;class p{#e=null;#t=new Map;#i=new Map;#n=null;#r=new u;#a=0;#o=null;#s=new Set;#l=null;#c=new l;#h=!1;#d=n.AnnotationEditorType.NONE;#f=new Set;#g=this.copy.bind(this);#p=this.cut.bind(this);#u=this.paste.bind(this);#m=this.keydown.bind(this);#y=this.onEditingAction.bind(this);#b=this.onPageChanging.bind(this);#v=this.onScaleChanging.bind(this);#w=this.onRotationChanging.bind(this);#x={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#_=null;static _keyboardManager=new d([[["ctrl+a","mac+meta+a"],p.prototype.selectAll],[["ctrl+z","mac+meta+z"],p.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],p.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],p.prototype.delete],[["Escape","mac+Escape"],p.prototype.unselectAll]]);constructor(g,v,_){this.#_=g,this.#l=v,this.#l._on("editingaction",this.#y),this.#l._on("pagechanging",this.#b),this.#l._on("scalechanging",this.#v),this.#l._on("rotationchanging",this.#w),this.#n=_,this.viewParameters={realScale:r.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){this.#E(),this.#l._off("editingaction",this.#y),this.#l._off("pagechanging",this.#b),this.#l._off("scalechanging",this.#v),this.#l._off("rotationchanging",this.#w);for(const g of this.#i.values())g.destroy();this.#i.clear(),this.#t.clear(),this.#s.clear(),this.#e=null,this.#f.clear(),this.#r.destroy()}onPageChanging({pageNumber:g}){this.#a=g-1}focusMainContainer(){this.#_.focus()}addShouldRescale(g){this.#s.add(g)}removeShouldRescale(g){this.#s.delete(g)}onScaleChanging({scale:g}){this.commitOrRemove(),this.viewParameters.realScale=g*r.PixelsPerInch.PDF_TO_CSS_UNITS;for(const v of this.#s)v.onScaleChanging()}onRotationChanging({pagesRotation:g}){this.commitOrRemove(),this.viewParameters.rotation=g}addToAnnotationStorage(g){!g.isEmpty()&&this.#n&&!this.#n.has(g.id)&&this.#n.setValue(g.id,g)}#P(){this.#_.addEventListener("keydown",this.#m)}#E(){this.#_.removeEventListener("keydown",this.#m)}#A(){document.addEventListener("copy",this.#g),document.addEventListener("cut",this.#p),document.addEventListener("paste",this.#u)}#I(){document.removeEventListener("copy",this.#g),document.removeEventListener("cut",this.#p),document.removeEventListener("paste",this.#u)}copy(g){if(g.preventDefault(),this.#e&&this.#e.commitOrRemove(),!this.hasSelection)return;const v=[];for(const _ of this.#f)_.isEmpty()||v.push(_.serialize());v.length!==0&&g.clipboardData.setData("application/pdfjs",JSON.stringify(v))}cut(g){this.copy(g),this.delete()}paste(g){g.preventDefault();let v=g.clipboardData.getData("application/pdfjs");if(!v)return;try{v=JSON.parse(v)}catch(b){(0,n.warn)(`paste: "${b.message}".`);return}if(!Array.isArray(v))return;this.unselectAll();const _=this.#i.get(this.#a);try{const b=[];for(const z of v){const D=_.deserialize(z);if(!D)return;b.push(D)}const E=()=>{for(const z of b)this.#N(z);this.#k(b)},A=()=>{for(const z of b)z.remove()};this.addCommands({cmd:E,undo:A,mustExec:!0})}catch(b){(0,n.warn)(`paste: "${b.message}".`)}}keydown(g){this.getActive()?.shouldGetKeyboardEvents()||p._keyboardManager.exec(this,g)}onEditingAction(g){["undo","redo","delete","selectAll"].includes(g.name)&&this[g.name]()}#S(g){Object.entries(g).some(([_,b])=>this.#x[_]!==b)&&this.#l.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#x,g)})}#R(g){this.#l.dispatch("annotationeditorparamschanged",{source:this,details:g})}setEditingState(g){g?(this.#P(),this.#A(),this.#S({isEditing:this.#d!==n.AnnotationEditorType.NONE,isEmpty:this.#D(),hasSomethingToUndo:this.#r.hasSomethingToUndo(),hasSomethingToRedo:this.#r.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#E(),this.#I(),this.#S({isEditing:!1}))}registerEditorTypes(g){if(!this.#o){this.#o=g;for(const v of this.#o)this.#R(v.defaultPropertiesToUpdate)}}getId(){return this.#c.getId()}get currentLayer(){return this.#i.get(this.#a)}get currentPageIndex(){return this.#a}addLayer(g){this.#i.set(g.pageIndex,g),this.#h?g.enable():g.disable()}removeLayer(g){this.#i.delete(g.pageIndex)}updateMode(g){if(this.#d=g,g===n.AnnotationEditorType.NONE)this.setEditingState(!1),this.#M();else{this.setEditingState(!0),this.#L();for(const v of this.#i.values())v.updateMode(g)}}updateToolbar(g){g!==this.#d&&this.#l.dispatch("switchannotationeditormode",{source:this,mode:g})}updateParams(g,v){if(this.#o){for(const _ of this.#f)_.updateParams(g,v);for(const _ of this.#o)_.updateDefaultParams(g,v)}}#L(){if(!this.#h){this.#h=!0;for(const g of this.#i.values())g.enable()}}#M(){if(this.unselectAll(),this.#h){this.#h=!1;for(const g of this.#i.values())g.disable()}}getEditors(g){const v=[];for(const _ of this.#t.values())_.pageIndex===g&&v.push(_);return v}getEditor(g){return this.#t.get(g)}addEditor(g){this.#t.set(g.id,g)}removeEditor(g){this.#t.delete(g.id),this.unselect(g),this.#n?.remove(g.id)}#N(g){const v=this.#i.get(g.pageIndex);v?v.addOrRebuild(g):this.addEditor(g)}setActiveEditor(g){this.#e!==g&&(this.#e=g,g&&this.#R(g.propertiesToUpdate))}toggleSelected(g){if(this.#f.has(g)){this.#f.delete(g),g.unselect(),this.#S({hasSelectedEditor:this.hasSelection});return}this.#f.add(g),g.select(),this.#R(g.propertiesToUpdate),this.#S({hasSelectedEditor:!0})}setSelected(g){for(const v of this.#f)v!==g&&v.unselect();this.#f.clear(),this.#f.add(g),g.select(),this.#R(g.propertiesToUpdate),this.#S({hasSelectedEditor:!0})}isSelected(g){return this.#f.has(g)}unselect(g){g.unselect(),this.#f.delete(g),this.#S({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#f.size!==0}undo(){this.#r.undo(),this.#S({hasSomethingToUndo:this.#r.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#D()})}redo(){this.#r.redo(),this.#S({hasSomethingToUndo:!0,hasSomethingToRedo:this.#r.hasSomethingToRedo(),isEmpty:this.#D()})}addCommands(g){this.#r.add(g),this.#S({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#D()})}#D(){if(this.#t.size===0)return!0;if(this.#t.size===1)for(const g of this.#t.values())return g.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const g=[...this.#f],v=()=>{for(const b of g)b.remove()},_=()=>{for(const b of g)this.#N(b)};this.addCommands({cmd:v,undo:_,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}#k(g){this.#f.clear();for(const v of g)v.isEmpty()||(this.#f.add(v),v.select());this.#S({hasSelectedEditor:!0})}selectAll(){for(const g of this.#f)g.commit();this.#k(this.#t.values())}unselectAll(){if(this.#e){this.#e.commitOrRemove();return}if(this.#f.size!==0){for(const g of this.#f)g.unselect();this.#f.clear(),this.#S({hasSelectedEditor:!1})}}isActive(g){return this.#e===g}getActive(){return this.#e}getMode(){return this.#d}}e.AnnotationEditorUIManager=p}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StatTimer=e.RenderingCancelledException=e.PixelsPerInch=e.PageViewport=e.PDFDateString=e.DOMStandardFontDataFactory=e.DOMSVGFactory=e.DOMCanvasFactory=e.DOMCMapReaderFactory=e.AnnotationPrefix=void 0,e.deprecated=G,e.getColorValues=V,e.getCurrentTransform=te,e.getCurrentTransformInverse=ae,e.getFilenameFromUrl=E,e.getPdfFilenameFromUrl=A,e.getRGB=H,e.getXfaPageViewport=w,e.isDataScheme=_,e.isPdfFile=b,e.isValidFetchUrl=D,e.loadScript=P,e.setLayerDimensions=be;var n=t(7),r=t(1);const s="http://www.w3.org/2000/svg",a="pdfjs_internal_id_";e.AnnotationPrefix=a;class l{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}e.PixelsPerInch=l;class u extends n.BaseCanvasFactory{constructor({ownerDocument:le=globalThis.document}={}){super(),this._document=le}_createCanvas(le,ue){const oe=this._document.createElement("canvas");return oe.width=le,oe.height=ue,oe}}e.DOMCanvasFactory=u;async function d(_e,le=!1){if(D(_e,document.baseURI)){const ue=await fetch(_e);if(!ue.ok)throw new Error(ue.statusText);return le?new Uint8Array(await ue.arrayBuffer()):(0,r.stringToBytes)(await ue.text())}return new Promise((ue,oe)=>{const ee=new XMLHttpRequest;ee.open("GET",_e,!0),le&&(ee.responseType="arraybuffer"),ee.onreadystatechange=()=>{if(ee.readyState===XMLHttpRequest.DONE){if(ee.status===200||ee.status===0){let se;if(le&&ee.response?se=new Uint8Array(ee.response):!le&&ee.responseText&&(se=(0,r.stringToBytes)(ee.responseText)),se){ue(se);return}}oe(new Error(ee.statusText))}},ee.send(null)})}class h extends n.BaseCMapReaderFactory{_fetchData(le,ue){return d(le,this.isCompressed).then(oe=>({cMapData:oe,compressionType:ue}))}}e.DOMCMapReaderFactory=h;class p extends n.BaseStandardFontDataFactory{_fetchData(le){return d(le,!0)}}e.DOMStandardFontDataFactory=p;class m extends n.BaseSVGFactory{_createSVG(le){return document.createElementNS(s,le)}}e.DOMSVGFactory=m;class g{constructor({viewBox:le,scale:ue,rotation:oe,offsetX:ee=0,offsetY:se=0,dontFlip:re=!1}){this.viewBox=le,this.scale=ue,this.rotation=oe,this.offsetX=ee,this.offsetY=se;const fe=(le[2]+le[0])/2,pe=(le[3]+le[1])/2;let Z,ce,Ee,Te;switch(oe%=360,oe<0&&(oe+=360),oe){case 180:Z=-1,ce=0,Ee=0,Te=1;break;case 90:Z=0,ce=1,Ee=1,Te=0;break;case 270:Z=0,ce=-1,Ee=-1,Te=0;break;case 0:Z=1,ce=0,Ee=0,Te=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}re&&(Ee=-Ee,Te=-Te);let Ae,Pe,Me,We;Z===0?(Ae=Math.abs(pe-le[1])*ue+ee,Pe=Math.abs(fe-le[0])*ue+se,Me=(le[3]-le[1])*ue,We=(le[2]-le[0])*ue):(Ae=Math.abs(fe-le[0])*ue+ee,Pe=Math.abs(pe-le[1])*ue+se,Me=(le[2]-le[0])*ue,We=(le[3]-le[1])*ue),this.transform=[Z*ue,ce*ue,Ee*ue,Te*ue,Ae-Z*ue*fe-Ee*ue*pe,Pe-ce*ue*fe-Te*ue*pe],this.width=Me,this.height=We}get rawDims(){const{viewBox:le}=this;return(0,r.shadow)(this,"rawDims",{pageWidth:le[2]-le[0],pageHeight:le[3]-le[1],pageX:le[0],pageY:le[1]})}clone({scale:le=this.scale,rotation:ue=this.rotation,offsetX:oe=this.offsetX,offsetY:ee=this.offsetY,dontFlip:se=!1}={}){return new g({viewBox:this.viewBox.slice(),scale:le,rotation:ue,offsetX:oe,offsetY:ee,dontFlip:se})}convertToViewportPoint(le,ue){return r.Util.applyTransform([le,ue],this.transform)}convertToViewportRectangle(le){const ue=r.Util.applyTransform([le[0],le[1]],this.transform),oe=r.Util.applyTransform([le[2],le[3]],this.transform);return[ue[0],ue[1],oe[0],oe[1]]}convertToPdfPoint(le,ue){return r.Util.applyInverseTransform([le,ue],this.transform)}}e.PageViewport=g;class v extends r.BaseException{constructor(le,ue,oe=0){super(le,"RenderingCancelledException"),this.type=ue,this.extraDelay=oe}}e.RenderingCancelledException=v;function _(_e){const le=_e.length;let ue=0;for(;ue<le&&_e[ue].trim()==="";)ue++;return _e.substring(ue,ue+5).toLowerCase()==="data:"}function b(_e){return typeof _e=="string"&&/\.pdf$/i.test(_e)}function E(_e,le=!1){return le||([_e]=_e.split(/[#?]/,1)),_e.substring(_e.lastIndexOf("/")+1)}function A(_e,le="document.pdf"){if(typeof _e!="string")return le;if(_(_e))return(0,r.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),le;const ue=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,oe=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,ee=ue.exec(_e);let se=oe.exec(ee[1])||oe.exec(ee[2])||oe.exec(ee[3]);if(se&&(se=se[0],se.includes("%")))try{se=oe.exec(decodeURIComponent(se))[0]}catch{}return se||le}class z{started=Object.create(null);times=[];time(le){le in this.started&&(0,r.warn)(`Timer is already running for ${le}`),this.started[le]=Date.now()}timeEnd(le){le in this.started||(0,r.warn)(`Timer has not been started for ${le}`),this.times.push({name:le,start:this.started[le],end:Date.now()}),delete this.started[le]}toString(){const le=[];let ue=0;for(const{name:oe}of this.times)ue=Math.max(oe.length,ue);for(const{name:oe,start:ee,end:se}of this.times)le.push(`${oe.padEnd(ue)} ${se-ee}ms
`);return le.join("")}}e.StatTimer=z;function D(_e,le){try{const{protocol:ue}=le?new URL(_e,le):new URL(_e);return ue==="http:"||ue==="https:"}catch{return!1}}function P(_e,le=!1){return new Promise((ue,oe)=>{const ee=document.createElement("script");ee.src=_e,ee.onload=function(se){le&&ee.remove(),ue(se)},ee.onerror=function(){oe(new Error(`Cannot load script at: ${ee.src}`))},(document.head||document.documentElement).append(ee)})}function G(_e){console.log("Deprecated API usage: "+_e)}let R;class I{static toDateObject(le){if(!le||typeof le!="string")return null;R||(R=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const ue=R.exec(le);if(!ue)return null;const oe=parseInt(ue[1],10);let ee=parseInt(ue[2],10);ee=ee>=1&&ee<=12?ee-1:0;let se=parseInt(ue[3],10);se=se>=1&&se<=31?se:1;let re=parseInt(ue[4],10);re=re>=0&&re<=23?re:0;let fe=parseInt(ue[5],10);fe=fe>=0&&fe<=59?fe:0;let pe=parseInt(ue[6],10);pe=pe>=0&&pe<=59?pe:0;const Z=ue[7]||"Z";let ce=parseInt(ue[8],10);ce=ce>=0&&ce<=23?ce:0;let Ee=parseInt(ue[9],10)||0;return Ee=Ee>=0&&Ee<=59?Ee:0,Z==="-"?(re+=ce,fe+=Ee):Z==="+"&&(re-=ce,fe-=Ee),new Date(Date.UTC(oe,ee,se,re,fe,pe))}}e.PDFDateString=I;function w(_e,{scale:le=1,rotation:ue=0}){const{width:oe,height:ee}=_e.attributes.style,se=[0,0,parseInt(oe),parseInt(ee)];return new g({viewBox:se,scale:le,rotation:ue})}function H(_e){if(_e.startsWith("#")){const le=parseInt(_e.slice(1),16);return[(le&16711680)>>16,(le&65280)>>8,le&255]}return _e.startsWith("rgb(")?_e.slice(4,-1).split(",").map(le=>parseInt(le)):_e.startsWith("rgba(")?_e.slice(5,-1).split(",").map(le=>parseInt(le)).slice(0,3):((0,r.warn)(`Not a valid color format: "${_e}"`),[0,0,0])}function V(_e){const le=document.createElement("span");le.style.visibility="hidden",document.body.append(le);for(const ue of _e.keys()){le.style.color=ue;const oe=window.getComputedStyle(le).color;_e.set(ue,H(oe))}le.remove()}function te(_e){const{a:le,b:ue,c:oe,d:ee,e:se,f:re}=_e.getTransform();return[le,ue,oe,ee,se,re]}function ae(_e){const{a:le,b:ue,c:oe,d:ee,e:se,f:re}=_e.getTransform().invertSelf();return[le,ue,oe,ee,se,re]}function be(_e,le,ue=!1,oe=!0){if(le instanceof g){const{pageWidth:ee,pageHeight:se}=le.rawDims,{style:re}=_e,fe=`calc(var(--scale-factor) * ${ee}px)`,pe=`calc(var(--scale-factor) * ${se}px)`;!ue||le.rotation%180===0?(re.width=fe,re.height=pe):(re.width=pe,re.height=fe)}oe&&_e.setAttribute("data-main-rotation",le.rotation)}}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseStandardFontDataFactory=e.BaseSVGFactory=e.BaseCanvasFactory=e.BaseCMapReaderFactory=void 0;var n=t(1);class r{constructor(){this.constructor===r&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(d,h){if(d<=0||h<=0)throw new Error("Invalid canvas size");const p=this._createCanvas(d,h);return{canvas:p,context:p.getContext("2d")}}reset(d,h,p){if(!d.canvas)throw new Error("Canvas is not specified");if(h<=0||p<=0)throw new Error("Invalid canvas size");d.canvas.width=h,d.canvas.height=p}destroy(d){if(!d.canvas)throw new Error("Canvas is not specified");d.canvas.width=0,d.canvas.height=0,d.canvas=null,d.context=null}_createCanvas(d,h){(0,n.unreachable)("Abstract method `_createCanvas` called.")}}e.BaseCanvasFactory=r;class s{constructor({baseUrl:d=null,isCompressed:h=!0}){this.constructor===s&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=d,this.isCompressed=h}async fetch({name:d}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!d)throw new Error("CMap name must be specified.");const h=this.baseUrl+d+(this.isCompressed?".bcmap":""),p=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(h,p).catch(m=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${h}`)})}_fetchData(d,h){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseCMapReaderFactory=s;class a{constructor({baseUrl:d=null}){this.constructor===a&&(0,n.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=d}async fetch({filename:d}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!d)throw new Error("Font filename must be specified.");const h=`${this.baseUrl}${d}`;return this._fetchData(h).catch(p=>{throw new Error(`Unable to load font data at: ${h}`)})}_fetchData(d){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseStandardFontDataFactory=a;class l{constructor(){this.constructor===l&&(0,n.unreachable)("Cannot initialize BaseSVGFactory.")}create(d,h,p=!1){if(d<=0||h<=0)throw new Error("Invalid SVG dimensions");const m=this._createSVG("svg:svg");return m.setAttribute("version","1.1"),p||(m.setAttribute("width",`${d}px`),m.setAttribute("height",`${h}px`)),m.setAttribute("preserveAspectRatio","none"),m.setAttribute("viewBox",`0 0 ${d} ${h}`),m}createElement(d){if(typeof d!="string")throw new Error("Invalid SVG element type");return this._createSVG(d)}_createSVG(d){(0,n.unreachable)("Abstract method `_createSVG` called.")}}e.BaseSVGFactory=l}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MurmurHash3_64=void 0;var n=t(1);const r=3285377520,s=4294901760,a=65535;class l{constructor(d){this.h1=d?d&4294967295:r,this.h2=d?d&4294967295:r}update(d){let h,p;if(typeof d=="string"){h=new Uint8Array(d.length*2),p=0;for(let R=0,I=d.length;R<I;R++){const w=d.charCodeAt(R);w<=255?h[p++]=w:(h[p++]=w>>>8,h[p++]=w&255)}}else if((0,n.isArrayBuffer)(d))h=d.slice(),p=h.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const m=p>>2,g=p-m*4,v=new Uint32Array(h.buffer,0,m);let _=0,b=0,E=this.h1,A=this.h2;const z=3432918353,D=461845907,P=z&a,G=D&a;for(let R=0;R<m;R++)R&1?(_=v[R],_=_*z&s|_*P&a,_=_<<15|_>>>17,_=_*D&s|_*G&a,E^=_,E=E<<13|E>>>19,E=E*5+3864292196):(b=v[R],b=b*z&s|b*P&a,b=b<<15|b>>>17,b=b*D&s|b*G&a,A^=b,A=A<<13|A>>>19,A=A*5+3864292196);switch(_=0,g){case 3:_^=h[m*4+2]<<16;case 2:_^=h[m*4+1]<<8;case 1:_^=h[m*4],_=_*z&s|_*P&a,_=_<<15|_>>>17,_=_*D&s|_*G&a,m&1?E^=_:A^=_}this.h1=E,this.h2=A}hexdigest(){let d=this.h1,h=this.h2;return d^=h>>>1,d=d*3981806797&s|d*36045&a,h=h*4283543511&s|((h<<16|d>>>16)*2950163797&s)>>>16,d^=h>>>1,d=d*444984403&s|d*60499&a,h=h*3301882366&s|((h<<16|d>>>16)*3120437893&s)>>>16,d^=h>>>1,(d>>>0).toString(16).padStart(8,"0")+(h>>>0).toString(16).padStart(8,"0")}}e.MurmurHash3_64=l}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FontLoader=e.FontFaceObject=void 0;var n=t(1),r=t(10);class s{constructor({onUnsupportedFeature:u,ownerDocument:d=globalThis.document,styleElement:h=null}){this._onUnsupportedFeature=u,this._document=d,this.nativeFontFaces=[],this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(u){this.nativeFontFaces.push(u),this._document.fonts.add(u)}insertRule(u){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const d=this.styleElement.sheet;d.insertRule(u,d.cssRules.length)}clear(){for(const u of this.nativeFontFaces)this._document.fonts.delete(u);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(u){if(u.attached||u.missingFile)return;if(u.attached=!0,this.isFontLoadingAPISupported){const h=u.createNativeFontFace();if(h){this.addNativeFontFace(h);try{await h.loaded}catch(p){throw this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,n.warn)(`Failed to load font '${h.family}': '${p}'.`),u.disableFontFace=!0,p}}return}const d=u.createFontFaceRule();if(d){if(this.insertRule(d),this.isSyncFontLoadingSupported)return;await new Promise(h=>{const p=this._queueLoadingCallback(h);this._prepareFontLoadEvent(u,p)})}}get isFontLoadingAPISupported(){const u=!!this._document?.fonts;return(0,n.shadow)(this,"isFontLoadingAPISupported",u)}get isSyncFontLoadingSupported(){let u=!1;return(r.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(u=!0),(0,n.shadow)(this,"isSyncFontLoadingSupported",u)}_queueLoadingCallback(u){function d(){for((0,n.assert)(!p.done,"completeRequest() cannot be called twice."),p.done=!0;h.length>0&&h[0].done;){const m=h.shift();setTimeout(m.callback,0)}}const{loadingRequests:h}=this,p={done:!1,complete:d,callback:u};return h.push(p),p}get _loadTestFont(){const u=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,n.shadow)(this,"_loadTestFont",u)}_prepareFontLoadEvent(u,d){function h(V,te){return V.charCodeAt(te)<<24|V.charCodeAt(te+1)<<16|V.charCodeAt(te+2)<<8|V.charCodeAt(te+3)&255}function p(V,te,ae,be){const _e=V.substring(0,te),le=V.substring(te+ae);return _e+be+le}let m,g;const v=this._document.createElement("canvas");v.width=1,v.height=1;const _=v.getContext("2d");let b=0;function E(V,te){if(++b>30){(0,n.warn)("Load test font never loaded."),te();return}if(_.font="30px "+V,_.fillText(".",0,20),_.getImageData(0,0,1,1).data[3]>0){te();return}setTimeout(E.bind(null,V,te))}const A=`lt${Date.now()}${this.loadTestFontId++}`;let z=this._loadTestFont;z=p(z,976,A.length,A);const P=16,G=1482184792;let R=h(z,P);for(m=0,g=A.length-3;m<g;m+=4)R=R-G+h(A,m)|0;m<A.length&&(R=R-G+h(A+"XXX",m)|0),z=p(z,P,4,(0,n.string32)(R));const I=`url(data:font/opentype;base64,${btoa(z)});`,w=`@font-face {font-family:"${A}";src:${I}}`;this.insertRule(w);const H=this._document.createElement("div");H.style.visibility="hidden",H.style.width=H.style.height="10px",H.style.position="absolute",H.style.top=H.style.left="0px";for(const V of[u.loadedName,A]){const te=this._document.createElement("span");te.textContent="Hi",te.style.fontFamily=V,H.append(te)}this._document.body.append(H),E(A,()=>{H.remove(),d.complete()})}}e.FontLoader=s;class a{constructor(u,{isEvalSupported:d=!0,disableFontFace:h=!1,ignoreErrors:p=!1,onUnsupportedFeature:m,fontRegistry:g=null}){this.compiledGlyphs=Object.create(null);for(const v in u)this[v]=u[v];this.isEvalSupported=d!==!1,this.disableFontFace=h===!0,this.ignoreErrors=p===!0,this._onUnsupportedFeature=m,this.fontRegistry=g}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let u;if(!this.cssFontInfo)u=new FontFace(this.loadedName,this.data,{});else{const d={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(d.style=`oblique ${this.cssFontInfo.italicAngle}deg`),u=new FontFace(this.cssFontInfo.fontFamily,this.data,d)}return this.fontRegistry?.registerFont(this),u}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const u=(0,n.bytesToString)(this.data),d=`url(data:${this.mimetype};base64,${btoa(u)});`;let h;if(!this.cssFontInfo)h=`@font-face {font-family:"${this.loadedName}";src:${d}}`;else{let p=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(p+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),h=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${p}src:${d}}`}return this.fontRegistry?.registerFont(this,d),h}getPathGenerator(u,d){if(this.compiledGlyphs[d]!==void 0)return this.compiledGlyphs[d];let h;try{h=u.get(this.loadedName+"_path_"+d)}catch(p){if(!this.ignoreErrors)throw p;return this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,n.warn)(`getPathGenerator - ignoring character: "${p}".`),this.compiledGlyphs[d]=function(m,g){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){const p=[];for(const m of h){const g=m.args!==void 0?m.args.join(","):"";p.push("c.",m.cmd,"(",g,`);
`)}return this.compiledGlyphs[d]=new Function("c","size",p.join(""))}return this.compiledGlyphs[d]=function(p,m){for(const g of h)g.cmd==="scale"&&(g.args=[m,-m]),p[g.cmd].apply(p,g.args)}}}e.FontFaceObject=a}),((i,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isNodeJS=void 0;const t=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");e.isNodeJS=t}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasGraphics=void 0;var n=t(1),r=t(6),s=t(12),a=t(13);const l=16,u=100,d=4096,h=15,p=10,m=1e3,g=16;function v(oe,ee){if(oe._removeMirroring)throw new Error("Context is already forwarding operations.");oe.__originalSave=oe.save,oe.__originalRestore=oe.restore,oe.__originalRotate=oe.rotate,oe.__originalScale=oe.scale,oe.__originalTranslate=oe.translate,oe.__originalTransform=oe.transform,oe.__originalSetTransform=oe.setTransform,oe.__originalResetTransform=oe.resetTransform,oe.__originalClip=oe.clip,oe.__originalMoveTo=oe.moveTo,oe.__originalLineTo=oe.lineTo,oe.__originalBezierCurveTo=oe.bezierCurveTo,oe.__originalRect=oe.rect,oe.__originalClosePath=oe.closePath,oe.__originalBeginPath=oe.beginPath,oe._removeMirroring=()=>{oe.save=oe.__originalSave,oe.restore=oe.__originalRestore,oe.rotate=oe.__originalRotate,oe.scale=oe.__originalScale,oe.translate=oe.__originalTranslate,oe.transform=oe.__originalTransform,oe.setTransform=oe.__originalSetTransform,oe.resetTransform=oe.__originalResetTransform,oe.clip=oe.__originalClip,oe.moveTo=oe.__originalMoveTo,oe.lineTo=oe.__originalLineTo,oe.bezierCurveTo=oe.__originalBezierCurveTo,oe.rect=oe.__originalRect,oe.closePath=oe.__originalClosePath,oe.beginPath=oe.__originalBeginPath,delete oe._removeMirroring},oe.save=function(){ee.save(),this.__originalSave()},oe.restore=function(){ee.restore(),this.__originalRestore()},oe.translate=function(re,fe){ee.translate(re,fe),this.__originalTranslate(re,fe)},oe.scale=function(re,fe){ee.scale(re,fe),this.__originalScale(re,fe)},oe.transform=function(re,fe,pe,Z,ce,Ee){ee.transform(re,fe,pe,Z,ce,Ee),this.__originalTransform(re,fe,pe,Z,ce,Ee)},oe.setTransform=function(re,fe,pe,Z,ce,Ee){ee.setTransform(re,fe,pe,Z,ce,Ee),this.__originalSetTransform(re,fe,pe,Z,ce,Ee)},oe.resetTransform=function(){ee.resetTransform(),this.__originalResetTransform()},oe.rotate=function(re){ee.rotate(re),this.__originalRotate(re)},oe.clip=function(re){ee.clip(re),this.__originalClip(re)},oe.moveTo=function(se,re){ee.moveTo(se,re),this.__originalMoveTo(se,re)},oe.lineTo=function(se,re){ee.lineTo(se,re),this.__originalLineTo(se,re)},oe.bezierCurveTo=function(se,re,fe,pe,Z,ce){ee.bezierCurveTo(se,re,fe,pe,Z,ce),this.__originalBezierCurveTo(se,re,fe,pe,Z,ce)},oe.rect=function(se,re,fe,pe){ee.rect(se,re,fe,pe),this.__originalRect(se,re,fe,pe)},oe.closePath=function(){ee.closePath(),this.__originalClosePath()},oe.beginPath=function(){ee.beginPath(),this.__originalBeginPath()}}class _{constructor(ee){this.canvasFactory=ee,this.cache=Object.create(null)}getCanvas(ee,se,re){let fe;return this.cache[ee]!==void 0?(fe=this.cache[ee],this.canvasFactory.reset(fe,se,re)):(fe=this.canvasFactory.create(se,re),this.cache[ee]=fe),fe}delete(ee){delete this.cache[ee]}clear(){for(const ee in this.cache){const se=this.cache[ee];this.canvasFactory.destroy(se),delete this.cache[ee]}}}function b(oe,ee,se,re,fe,pe,Z,ce,Ee,Te){const[Ae,Pe,Me,We,qe,Je]=(0,r.getCurrentTransform)(oe);if(Pe===0&&Me===0){const Lt=Z*Ae+qe,ln=Math.round(Lt),dt=ce*We+Je,st=Math.round(dt),nt=(Z+Ee)*Ae+qe,dn=Math.abs(Math.round(nt)-ln)||1,pn=(ce+Te)*We+Je,An=Math.abs(Math.round(pn)-st)||1;return oe.setTransform(Math.sign(Ae),0,0,Math.sign(We),ln,st),oe.drawImage(ee,se,re,fe,pe,0,0,dn,An),oe.setTransform(Ae,Pe,Me,We,qe,Je),[dn,An]}if(Ae===0&&We===0){const Lt=ce*Me+qe,ln=Math.round(Lt),dt=Z*Pe+Je,st=Math.round(dt),nt=(ce+Te)*Me+qe,dn=Math.abs(Math.round(nt)-ln)||1,pn=(Z+Ee)*Pe+Je,An=Math.abs(Math.round(pn)-st)||1;return oe.setTransform(0,Math.sign(Pe),Math.sign(Me),0,ln,st),oe.drawImage(ee,se,re,fe,pe,0,0,An,dn),oe.setTransform(Ae,Pe,Me,We,qe,Je),[An,dn]}oe.drawImage(ee,se,re,fe,pe,Z,ce,Ee,Te);const wt=Math.hypot(Ae,Pe),rt=Math.hypot(Me,We);return[wt*Ee,rt*Te]}function E(oe){const{width:ee,height:se}=oe;if(ee>m||se>m)return null;const re=1e3,fe=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),pe=ee+1;let Z=new Uint8Array(pe*(se+1)),ce,Ee,Te;const Ae=ee+7&-8;let Pe=new Uint8Array(Ae*se),Me=0;for(const rt of oe.data){let Lt=128;for(;Lt>0;)Pe[Me++]=rt&Lt?0:255,Lt>>=1}let We=0;for(Me=0,Pe[Me]!==0&&(Z[0]=1,++We),Ee=1;Ee<ee;Ee++)Pe[Me]!==Pe[Me+1]&&(Z[Ee]=Pe[Me]?2:1,++We),Me++;for(Pe[Me]!==0&&(Z[Ee]=2,++We),ce=1;ce<se;ce++){Me=ce*Ae,Te=ce*pe,Pe[Me-Ae]!==Pe[Me]&&(Z[Te]=Pe[Me]?1:8,++We);let rt=(Pe[Me]?4:0)+(Pe[Me-Ae]?8:0);for(Ee=1;Ee<ee;Ee++)rt=(rt>>2)+(Pe[Me+1]?4:0)+(Pe[Me-Ae+1]?8:0),fe[rt]&&(Z[Te+Ee]=fe[rt],++We),Me++;if(Pe[Me-Ae]!==Pe[Me]&&(Z[Te+Ee]=Pe[Me]?2:4,++We),We>re)return null}for(Me=Ae*(se-1),Te=ce*pe,Pe[Me]!==0&&(Z[Te]=8,++We),Ee=1;Ee<ee;Ee++)Pe[Me]!==Pe[Me+1]&&(Z[Te+Ee]=Pe[Me]?4:8,++We),Me++;if(Pe[Me]!==0&&(Z[Te+Ee]=4,++We),We>re)return null;const qe=new Int32Array([0,pe,-1,0,-pe,0,0,0,1]),Je=new Path2D;for(ce=0;We&&ce<=se;ce++){let rt=ce*pe;const Lt=rt+ee;for(;rt<Lt&&!Z[rt];)rt++;if(rt===Lt)continue;Je.moveTo(rt%pe,ce);const ln=rt;let dt=Z[rt];do{const st=qe[dt];do rt+=st;while(!Z[rt]);const nt=Z[rt];nt!==5&&nt!==10?(dt=nt,Z[rt]=0):(dt=nt&51*dt>>4,Z[rt]&=dt>>2|dt<<2),Je.lineTo(rt%pe,rt/pe|0),Z[rt]||--We}while(ln!==rt);--ce}return Pe=null,Z=null,function(rt){rt.save(),rt.scale(1/ee,-1/se),rt.translate(0,-se),rt.fill(Je),rt.beginPath(),rt.restore()}}class A{constructor(ee,se){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=n.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=n.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps=null,this.startNewPathAndClipBox([0,0,ee,se])}clone(){const ee=Object.create(this);return ee.clipBox=this.clipBox.slice(),ee}setCurrentPoint(ee,se){this.x=ee,this.y=se}updatePathMinMax(ee,se,re){[se,re]=n.Util.applyTransform([se,re],ee),this.minX=Math.min(this.minX,se),this.minY=Math.min(this.minY,re),this.maxX=Math.max(this.maxX,se),this.maxY=Math.max(this.maxY,re)}updateRectMinMax(ee,se){const re=n.Util.applyTransform(se,ee),fe=n.Util.applyTransform(se.slice(2),ee);this.minX=Math.min(this.minX,re[0],fe[0]),this.minY=Math.min(this.minY,re[1],fe[1]),this.maxX=Math.max(this.maxX,re[0],fe[0]),this.maxY=Math.max(this.maxY,re[1],fe[1])}updateScalingPathMinMax(ee,se){n.Util.scaleMinMax(ee,se),this.minX=Math.min(this.minX,se[0]),this.maxX=Math.max(this.maxX,se[1]),this.minY=Math.min(this.minY,se[2]),this.maxY=Math.max(this.maxY,se[3])}updateCurvePathMinMax(ee,se,re,fe,pe,Z,ce,Ee,Te,Ae){const Pe=n.Util.bezierBoundingBox(se,re,fe,pe,Z,ce,Ee,Te);if(Ae){Ae[0]=Math.min(Ae[0],Pe[0],Pe[2]),Ae[1]=Math.max(Ae[1],Pe[0],Pe[2]),Ae[2]=Math.min(Ae[2],Pe[1],Pe[3]),Ae[3]=Math.max(Ae[3],Pe[1],Pe[3]);return}this.updateRectMinMax(ee,Pe)}getPathBoundingBox(ee=s.PathType.FILL,se=null){const re=[this.minX,this.minY,this.maxX,this.maxY];if(ee===s.PathType.STROKE){se||(0,n.unreachable)("Stroke bounding box must include transform.");const fe=n.Util.singularValueDecompose2dScale(se),pe=fe[0]*this.lineWidth/2,Z=fe[1]*this.lineWidth/2;re[0]-=pe,re[1]-=Z,re[2]+=pe,re[3]+=Z}return re}updateClipFromPath(){const ee=n.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(ee||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(ee){this.clipBox=ee,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(ee=s.PathType.FILL,se=null){return n.Util.intersect(this.clipBox,this.getPathBoundingBox(ee,se))}}function z(oe,ee,se=null){if(typeof ImageData<"u"&&ee instanceof ImageData){oe.putImageData(ee,0,0);return}const re=ee.height,fe=ee.width,pe=re%g,Z=(re-pe)/g,ce=pe===0?Z:Z+1,Ee=oe.createImageData(fe,g);let Te=0,Ae;const Pe=ee.data,Me=Ee.data;let We,qe,Je,wt,rt,Lt,ln,dt;if(se)switch(se.length){case 1:rt=se[0],Lt=se[0],ln=se[0],dt=se[0];break;case 4:rt=se[0],Lt=se[1],ln=se[2],dt=se[3];break}if(ee.kind===n.ImageKind.GRAYSCALE_1BPP){const st=Pe.byteLength,nt=new Uint32Array(Me.buffer,0,Me.byteLength>>2),dn=nt.length,pn=fe+7>>3;let An=4294967295,In=n.FeatureTest.isLittleEndian?4278190080:255;for(dt&&dt[0]===255&&dt[255]===0&&([An,In]=[In,An]),We=0;We<ce;We++){for(Je=We<Z?g:pe,Ae=0,qe=0;qe<Je;qe++){const Jn=st-Te;let ri=0;const Wn=Jn>pn?fe:Jn*8-7,hi=Wn&-8;let ai=0,Zn=0;for(;ri<hi;ri+=8)Zn=Pe[Te++],nt[Ae++]=Zn&128?An:In,nt[Ae++]=Zn&64?An:In,nt[Ae++]=Zn&32?An:In,nt[Ae++]=Zn&16?An:In,nt[Ae++]=Zn&8?An:In,nt[Ae++]=Zn&4?An:In,nt[Ae++]=Zn&2?An:In,nt[Ae++]=Zn&1?An:In;for(;ri<Wn;ri++)ai===0&&(Zn=Pe[Te++],ai=128),nt[Ae++]=Zn&ai?An:In,ai>>=1}for(;Ae<dn;)nt[Ae++]=0;oe.putImageData(Ee,0,We*g)}}else if(ee.kind===n.ImageKind.RGBA_32BPP){const st=!!(rt||Lt||ln);for(qe=0,wt=fe*g*4,We=0;We<Z;We++){if(Me.set(Pe.subarray(Te,Te+wt)),Te+=wt,st)for(let nt=0;nt<wt;nt+=4)rt&&(Me[nt+0]=rt[Me[nt+0]]),Lt&&(Me[nt+1]=Lt[Me[nt+1]]),ln&&(Me[nt+2]=ln[Me[nt+2]]);oe.putImageData(Ee,0,qe),qe+=g}if(We<ce){if(wt=fe*pe*4,Me.set(Pe.subarray(Te,Te+wt)),st)for(let nt=0;nt<wt;nt+=4)rt&&(Me[nt+0]=rt[Me[nt+0]]),Lt&&(Me[nt+1]=Lt[Me[nt+1]]),ln&&(Me[nt+2]=ln[Me[nt+2]]);oe.putImageData(Ee,0,qe)}}else if(ee.kind===n.ImageKind.RGB_24BPP){const st=!!(rt||Lt||ln);for(Je=g,wt=fe*Je,We=0;We<ce;We++){for(We>=Z&&(Je=pe,wt=fe*Je),Ae=0,qe=wt;qe--;)Me[Ae++]=Pe[Te++],Me[Ae++]=Pe[Te++],Me[Ae++]=Pe[Te++],Me[Ae++]=255;if(st)for(let nt=0;nt<Ae;nt+=4)rt&&(Me[nt+0]=rt[Me[nt+0]]),Lt&&(Me[nt+1]=Lt[Me[nt+1]]),ln&&(Me[nt+2]=ln[Me[nt+2]]);oe.putImageData(Ee,0,We*g)}}else throw new Error(`bad image kind: ${ee.kind}`)}function D(oe,ee){if(ee.bitmap){oe.drawImage(ee.bitmap,0,0);return}const se=ee.height,re=ee.width,fe=se%g,pe=(se-fe)/g,Z=fe===0?pe:pe+1,ce=oe.createImageData(re,g);let Ee=0;const Te=ee.data,Ae=ce.data;for(let Pe=0;Pe<Z;Pe++){const Me=Pe<pe?g:fe;({srcPos:Ee}=(0,a.applyMaskImageData)({src:Te,srcPos:Ee,dest:Ae,width:re,height:Me})),oe.putImageData(ce,0,Pe*g)}}function P(oe,ee){const se=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(const re of se)oe[re]!==void 0&&(ee[re]=oe[re]);oe.setLineDash!==void 0&&(ee.setLineDash(oe.getLineDash()),ee.lineDashOffset=oe.lineDashOffset)}function G(oe,ee){oe.strokeStyle=oe.fillStyle=ee||"#000000",oe.fillRule="nonzero",oe.globalAlpha=1,oe.lineWidth=1,oe.lineCap="butt",oe.lineJoin="miter",oe.miterLimit=10,oe.globalCompositeOperation="source-over",oe.font="10px sans-serif",oe.setLineDash!==void 0&&(oe.setLineDash([]),oe.lineDashOffset=0)}function R(oe,ee,se,re){const fe=oe.length;for(let pe=3;pe<fe;pe+=4){const Z=oe[pe];if(Z===0)oe[pe-3]=ee,oe[pe-2]=se,oe[pe-1]=re;else if(Z<255){const ce=255-Z;oe[pe-3]=oe[pe-3]*Z+ee*ce>>8,oe[pe-2]=oe[pe-2]*Z+se*ce>>8,oe[pe-1]=oe[pe-1]*Z+re*ce>>8}}}function I(oe,ee,se){const re=oe.length,fe=1/255;for(let pe=3;pe<re;pe+=4){const Z=se?se[oe[pe]]:oe[pe];ee[pe]=ee[pe]*Z*fe|0}}function w(oe,ee,se){const re=oe.length;for(let fe=3;fe<re;fe+=4){const pe=oe[fe-3]*77+oe[fe-2]*152+oe[fe-1]*28;ee[fe]=se?ee[fe]*se[pe>>8]>>8:ee[fe]*pe>>16}}function H(oe,ee,se,re,fe,pe,Z,ce,Ee,Te,Ae){const Pe=!!pe,Me=Pe?pe[0]:0,We=Pe?pe[1]:0,qe=Pe?pe[2]:0;let Je;fe==="Luminosity"?Je=w:Je=I;const rt=Math.min(re,Math.ceil(1048576/se));for(let Lt=0;Lt<re;Lt+=rt){const ln=Math.min(rt,re-Lt),dt=oe.getImageData(ce-Te,Lt+(Ee-Ae),se,ln),st=ee.getImageData(ce,Lt+Ee,se,ln);Pe&&R(dt.data,Me,We,qe),Je(dt.data,st.data,Z),ee.putImageData(st,ce,Lt+Ee)}}function V(oe,ee,se,re){const fe=re[0],pe=re[1],Z=re[2]-fe,ce=re[3]-pe;Z===0||ce===0||(H(ee.context,se,Z,ce,ee.subtype,ee.backdrop,ee.transferMap,fe,pe,ee.offsetX,ee.offsetY),oe.save(),oe.globalAlpha=1,oe.globalCompositeOperation="source-over",oe.setTransform(1,0,0,1,0,0),oe.drawImage(se.canvas,0,0),oe.restore())}function te(oe,ee){const se=n.Util.singularValueDecompose2dScale(oe);se[0]=Math.fround(se[0]),se[1]=Math.fround(se[1]);const re=Math.fround((globalThis.devicePixelRatio||1)*r.PixelsPerInch.PDF_TO_CSS_UNITS);return ee!==void 0?ee:se[0]<=re||se[1]<=re}const ae=["butt","round","square"],be=["miter","round","bevel"],_e={},le={};class ue{constructor(ee,se,re,fe,{optionalContentConfig:pe,markedContentStack:Z=null},ce,Ee){this.ctx=ee,this.current=new A(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=se,this.objs=re,this.canvasFactory=fe,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=Z||[],this.optionalContentConfig=pe,this.cachedCanvases=new _(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=ce,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.backgroundColor=Ee?.background||null,this.foregroundColor=Ee?.foreground||null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(ee,se=null){return typeof ee=="string"?ee.startsWith("g_")?this.commonObjs.get(ee):this.objs.get(ee):se}beginDrawing({transform:ee,viewport:se,transparency:re=!1,background:fe=null}){const pe=this.ctx.canvas.width,Z=this.ctx.canvas.height,ce=fe||"#ffffff";if(this.ctx.save(),this.foregroundColor&&this.backgroundColor){this.ctx.fillStyle=this.foregroundColor;const Ee=this.foregroundColor=this.ctx.fillStyle;this.ctx.fillStyle=this.backgroundColor;const Te=this.backgroundColor=this.ctx.fillStyle;let Ae=!0,Pe=ce;if(this.ctx.fillStyle=ce,Pe=this.ctx.fillStyle,Ae=typeof Pe=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Pe),Ee==="#000000"&&Te==="#ffffff"||Ee===Te||!Ae)this.foregroundColor=this.backgroundColor=null;else{const[Me,We,qe]=(0,r.getRGB)(Pe),Je=rt=>(rt/=255,rt<=.03928?rt/12.92:((rt+.055)/1.055)**2.4),wt=Math.round(.2126*Je(Me)+.7152*Je(We)+.0722*Je(qe));this.selectColor=(rt,Lt,ln)=>{const dt=.2126*Je(rt)+.7152*Je(Lt)+.0722*Je(ln);return Math.round(dt)===wt?Te:Ee}}}if(this.ctx.fillStyle=this.backgroundColor||ce,this.ctx.fillRect(0,0,pe,Z),this.ctx.restore(),re){const Ee=this.cachedCanvases.getCanvas("transparent",pe,Z);this.compositeCtx=this.ctx,this.transparentCanvas=Ee.canvas,this.ctx=Ee.context,this.ctx.save(),this.ctx.transform(...(0,r.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),G(this.ctx,this.foregroundColor),ee&&(this.ctx.transform(...ee),this.outputScaleX=ee[0],this.outputScaleY=ee[0]),this.ctx.transform(...se.transform),this.viewportScale=se.scale,this.baseTransform=(0,r.getCurrentTransform)(this.ctx)}executeOperatorList(ee,se,re,fe){const pe=ee.argsArray,Z=ee.fnArray;let ce=se||0;const Ee=pe.length;if(Ee===ce)return ce;const Te=Ee-ce>p&&typeof re=="function",Ae=Te?Date.now()+h:0;let Pe=0;const Me=this.commonObjs,We=this.objs;let qe;for(;;){if(fe!==void 0&&ce===fe.nextBreakPoint)return fe.breakIt(ce,re),ce;if(qe=Z[ce],qe!==n.OPS.dependency)this[qe].apply(this,pe[ce]);else for(const Je of pe[ce]){const wt=Je.startsWith("g_")?Me:We;if(!wt.has(Je))return wt.get(Je,re),ce}if(ce++,ce===Ee)return ce;if(Te&&++Pe>p){if(Date.now()>Ae)return re(),ce;Pe=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const ee of this._cachedBitmapsMap.values()){for(const se of ee.values())typeof HTMLCanvasElement<"u"&&se instanceof HTMLCanvasElement&&(se.width=se.height=0);ee.clear()}this._cachedBitmapsMap.clear()}_scaleImage(ee,se){const re=ee.width,fe=ee.height;let pe=Math.max(Math.hypot(se[0],se[1]),1),Z=Math.max(Math.hypot(se[2],se[3]),1),ce=re,Ee=fe,Te="prescale1",Ae,Pe;for(;pe>2&&ce>1||Z>2&&Ee>1;){let Me=ce,We=Ee;pe>2&&ce>1&&(Me=Math.ceil(ce/2),pe/=ce/Me),Z>2&&Ee>1&&(We=Math.ceil(Ee/2),Z/=Ee/We),Ae=this.cachedCanvases.getCanvas(Te,Me,We),Pe=Ae.context,Pe.clearRect(0,0,Me,We),Pe.drawImage(ee,0,0,ce,Ee,0,0,Me,We),ee=Ae.canvas,ce=Me,Ee=We,Te=Te==="prescale1"?"prescale2":"prescale1"}return{img:ee,paintWidth:ce,paintHeight:Ee}}_createMaskCanvas(ee){const se=this.ctx,{width:re,height:fe}=ee,pe=this.current.fillColor,Z=this.current.patternFill,ce=(0,r.getCurrentTransform)(se);let Ee,Te,Ae,Pe;if((ee.bitmap||ee.data)&&ee.count>1){const dn=ee.bitmap||ee.data.buffer;Te=JSON.stringify(Z?ce:[ce.slice(0,4),pe]),Ee=this._cachedBitmapsMap.get(dn),Ee||(Ee=new Map,this._cachedBitmapsMap.set(dn,Ee));const pn=Ee.get(Te);if(pn&&!Z){const An=Math.round(Math.min(ce[0],ce[2])+ce[4]),In=Math.round(Math.min(ce[1],ce[3])+ce[5]);return{canvas:pn,offsetX:An,offsetY:In}}Ae=pn}Ae||(Pe=this.cachedCanvases.getCanvas("maskCanvas",re,fe),D(Pe.context,ee));let Me=n.Util.transform(ce,[1/re,0,0,-1/fe,0,0]);Me=n.Util.transform(Me,[1,0,0,1,0,-fe]);const We=n.Util.applyTransform([0,0],Me),qe=n.Util.applyTransform([re,fe],Me),Je=n.Util.normalizeRect([We[0],We[1],qe[0],qe[1]]),wt=Math.round(Je[2]-Je[0])||1,rt=Math.round(Je[3]-Je[1])||1,Lt=this.cachedCanvases.getCanvas("fillCanvas",wt,rt),ln=Lt.context,dt=Math.min(We[0],qe[0]),st=Math.min(We[1],qe[1]);ln.translate(-dt,-st),ln.transform(...Me),Ae||(Ae=this._scaleImage(Pe.canvas,(0,r.getCurrentTransformInverse)(ln)),Ae=Ae.img,Ee&&Z&&Ee.set(Te,Ae)),ln.imageSmoothingEnabled=te((0,r.getCurrentTransform)(ln),ee.interpolate),b(ln,Ae,0,0,Ae.width,Ae.height,0,0,re,fe),ln.globalCompositeOperation="source-in";const nt=n.Util.transform((0,r.getCurrentTransformInverse)(ln),[1,0,0,1,-dt,-st]);return ln.fillStyle=Z?pe.getPattern(se,this,nt,s.PathType.FILL):pe,ln.fillRect(0,0,re,fe),Ee&&!Z&&(this.cachedCanvases.delete("fillCanvas"),Ee.set(Te,Lt.canvas)),{canvas:Lt.canvas,offsetX:Math.round(dt),offsetY:Math.round(st)}}setLineWidth(ee){ee!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=ee,this.ctx.lineWidth=ee}setLineCap(ee){this.ctx.lineCap=ae[ee]}setLineJoin(ee){this.ctx.lineJoin=be[ee]}setMiterLimit(ee){this.ctx.miterLimit=ee}setDash(ee,se){const re=this.ctx;re.setLineDash!==void 0&&(re.setLineDash(ee),re.lineDashOffset=se)}setRenderingIntent(ee){}setFlatness(ee){}setGState(ee){for(const[se,re]of ee)switch(se){case"LW":this.setLineWidth(re);break;case"LC":this.setLineCap(re);break;case"LJ":this.setLineJoin(re);break;case"ML":this.setMiterLimit(re);break;case"D":this.setDash(re[0],re[1]);break;case"RI":this.setRenderingIntent(re);break;case"FL":this.setFlatness(re);break;case"Font":this.setFont(re[0],re[1]);break;case"CA":this.current.strokeAlpha=re;break;case"ca":this.current.fillAlpha=re,this.ctx.globalAlpha=re;break;case"BM":this.ctx.globalCompositeOperation=re;break;case"SMask":this.current.activeSMask=re?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.current.transferMaps=re}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const ee=this.inSMaskMode;this.current.activeSMask&&!ee?this.beginSMaskMode():!this.current.activeSMask&&ee&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const ee=this.ctx.canvas.width,se=this.ctx.canvas.height,re="smaskGroupAt"+this.groupLevel,fe=this.cachedCanvases.getCanvas(re,ee,se);this.suspendedCtx=this.ctx,this.ctx=fe.context;const pe=this.ctx;pe.setTransform(...(0,r.getCurrentTransform)(this.suspendedCtx)),P(this.suspendedCtx,pe),v(pe,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),P(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(ee){if(!this.current.activeSMask)return;ee?(ee[0]=Math.floor(ee[0]),ee[1]=Math.floor(ee[1]),ee[2]=Math.ceil(ee[2]),ee[3]=Math.ceil(ee[3])):ee=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const se=this.current.activeSMask,re=this.suspendedCtx;V(re,se,this.ctx,ee),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(P(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const ee=this.current;this.stateStack.push(ee),this.current=ee.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),P(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(ee,se,re,fe,pe,Z){this.ctx.transform(ee,se,re,fe,pe,Z),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(ee,se,re){const fe=this.ctx,pe=this.current;let Z=pe.x,ce=pe.y,Ee,Te;const Ae=(0,r.getCurrentTransform)(fe),Pe=Ae[0]===0&&Ae[3]===0||Ae[1]===0&&Ae[2]===0,Me=Pe?re.slice(0):null;for(let We=0,qe=0,Je=ee.length;We<Je;We++)switch(ee[We]|0){case n.OPS.rectangle:Z=se[qe++],ce=se[qe++];const wt=se[qe++],rt=se[qe++],Lt=Z+wt,ln=ce+rt;fe.moveTo(Z,ce),wt===0||rt===0?fe.lineTo(Lt,ln):(fe.lineTo(Lt,ce),fe.lineTo(Lt,ln),fe.lineTo(Z,ln)),Pe||pe.updateRectMinMax(Ae,[Z,ce,Lt,ln]),fe.closePath();break;case n.OPS.moveTo:Z=se[qe++],ce=se[qe++],fe.moveTo(Z,ce),Pe||pe.updatePathMinMax(Ae,Z,ce);break;case n.OPS.lineTo:Z=se[qe++],ce=se[qe++],fe.lineTo(Z,ce),Pe||pe.updatePathMinMax(Ae,Z,ce);break;case n.OPS.curveTo:Ee=Z,Te=ce,Z=se[qe+4],ce=se[qe+5],fe.bezierCurveTo(se[qe],se[qe+1],se[qe+2],se[qe+3],Z,ce),pe.updateCurvePathMinMax(Ae,Ee,Te,se[qe],se[qe+1],se[qe+2],se[qe+3],Z,ce,Me),qe+=6;break;case n.OPS.curveTo2:Ee=Z,Te=ce,fe.bezierCurveTo(Z,ce,se[qe],se[qe+1],se[qe+2],se[qe+3]),pe.updateCurvePathMinMax(Ae,Ee,Te,Z,ce,se[qe],se[qe+1],se[qe+2],se[qe+3],Me),Z=se[qe+2],ce=se[qe+3],qe+=4;break;case n.OPS.curveTo3:Ee=Z,Te=ce,Z=se[qe+2],ce=se[qe+3],fe.bezierCurveTo(se[qe],se[qe+1],Z,ce,Z,ce),pe.updateCurvePathMinMax(Ae,Ee,Te,se[qe],se[qe+1],Z,ce,Z,ce,Me),qe+=4;break;case n.OPS.closePath:fe.closePath();break}Pe&&pe.updateScalingPathMinMax(Ae,Me),pe.setCurrentPoint(Z,ce)}closePath(){this.ctx.closePath()}stroke(ee=!0){const se=this.ctx,re=this.current.strokeColor;se.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof re=="object"&&re?.getPattern?(se.save(),se.strokeStyle=re.getPattern(se,this,(0,r.getCurrentTransformInverse)(se),s.PathType.STROKE),this.rescaleAndStroke(!1),se.restore()):this.rescaleAndStroke(!0)),ee&&this.consumePath(this.current.getClippedPathBoundingBox()),se.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(ee=!0){const se=this.ctx,re=this.current.fillColor,fe=this.current.patternFill;let pe=!1;fe&&(se.save(),se.fillStyle=re.getPattern(se,this,(0,r.getCurrentTransformInverse)(se),s.PathType.FILL),pe=!0);const Z=this.current.getClippedPathBoundingBox();this.contentVisible&&Z!==null&&(this.pendingEOFill?(se.fill("evenodd"),this.pendingEOFill=!1):se.fill()),pe&&se.restore(),ee&&this.consumePath(Z)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=_e}eoClip(){this.pendingClip=le}beginText(){this.current.textMatrix=n.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const ee=this.pendingTextPaths,se=this.ctx;if(ee===void 0){se.beginPath();return}se.save(),se.beginPath();for(const re of ee)se.setTransform(...re.transform),se.translate(re.x,re.y),re.addToPath(se,re.fontSize);se.restore(),se.clip(),se.beginPath(),delete this.pendingTextPaths}setCharSpacing(ee){this.current.charSpacing=ee}setWordSpacing(ee){this.current.wordSpacing=ee}setHScale(ee){this.current.textHScale=ee/100}setLeading(ee){this.current.leading=-ee}setFont(ee,se){const re=this.commonObjs.get(ee),fe=this.current;if(!re)throw new Error(`Can't find font for ${ee}`);if(fe.fontMatrix=re.fontMatrix||n.FONT_IDENTITY_MATRIX,(fe.fontMatrix[0]===0||fe.fontMatrix[3]===0)&&(0,n.warn)("Invalid font matrix for font "+ee),se<0?(se=-se,fe.fontDirection=-1):fe.fontDirection=1,this.current.font=re,this.current.fontSize=se,re.isType3Font)return;const pe=re.loadedName||"sans-serif";let Z="normal";re.black?Z="900":re.bold&&(Z="bold");const ce=re.italic?"italic":"normal",Ee=`"${pe}", ${re.fallbackName}`;let Te=se;se<l?Te=l:se>u&&(Te=u),this.current.fontSizeScale=se/Te,this.ctx.font=`${ce} ${Z} ${Te}px ${Ee}`}setTextRenderingMode(ee){this.current.textRenderingMode=ee}setTextRise(ee){this.current.textRise=ee}moveText(ee,se){this.current.x=this.current.lineX+=ee,this.current.y=this.current.lineY+=se}setLeadingMoveText(ee,se){this.setLeading(-se),this.moveText(ee,se)}setTextMatrix(ee,se,re,fe,pe,Z){this.current.textMatrix=[ee,se,re,fe,pe,Z],this.current.textMatrixScale=Math.hypot(ee,se),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(ee,se,re,fe){const pe=this.ctx,Z=this.current,ce=Z.font,Ee=Z.textRenderingMode,Te=Z.fontSize/Z.fontSizeScale,Ae=Ee&n.TextRenderingMode.FILL_STROKE_MASK,Pe=!!(Ee&n.TextRenderingMode.ADD_TO_PATH_FLAG),Me=Z.patternFill&&!ce.missingFile;let We;(ce.disableFontFace||Pe||Me)&&(We=ce.getPathGenerator(this.commonObjs,ee)),ce.disableFontFace||Me?(pe.save(),pe.translate(se,re),pe.beginPath(),We(pe,Te),fe&&pe.setTransform(...fe),(Ae===n.TextRenderingMode.FILL||Ae===n.TextRenderingMode.FILL_STROKE)&&pe.fill(),(Ae===n.TextRenderingMode.STROKE||Ae===n.TextRenderingMode.FILL_STROKE)&&pe.stroke(),pe.restore()):((Ae===n.TextRenderingMode.FILL||Ae===n.TextRenderingMode.FILL_STROKE)&&pe.fillText(ee,se,re),(Ae===n.TextRenderingMode.STROKE||Ae===n.TextRenderingMode.FILL_STROKE)&&pe.strokeText(ee,se,re)),Pe&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,r.getCurrentTransform)(pe),x:se,y:re,fontSize:Te,addToPath:We})}get isFontSubpixelAAEnabled(){const{context:ee}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);ee.scale(1.5,1),ee.fillText("I",0,10);const se=ee.getImageData(0,0,10,10).data;let re=!1;for(let fe=3;fe<se.length;fe+=4)if(se[fe]>0&&se[fe]<255){re=!0;break}return(0,n.shadow)(this,"isFontSubpixelAAEnabled",re)}showText(ee){const se=this.current,re=se.font;if(re.isType3Font)return this.showType3Text(ee);const fe=se.fontSize;if(fe===0)return;const pe=this.ctx,Z=se.fontSizeScale,ce=se.charSpacing,Ee=se.wordSpacing,Te=se.fontDirection,Ae=se.textHScale*Te,Pe=ee.length,Me=re.vertical,We=Me?1:-1,qe=re.defaultVMetrics,Je=fe*se.fontMatrix[0],wt=se.textRenderingMode===n.TextRenderingMode.FILL&&!re.disableFontFace&&!se.patternFill;pe.save(),pe.transform(...se.textMatrix),pe.translate(se.x,se.y+se.textRise),Te>0?pe.scale(Ae,-1):pe.scale(Ae,1);let rt;if(se.patternFill){pe.save();const nt=se.fillColor.getPattern(pe,this,(0,r.getCurrentTransformInverse)(pe),s.PathType.FILL);rt=(0,r.getCurrentTransform)(pe),pe.restore(),pe.fillStyle=nt}let Lt=se.lineWidth;const ln=se.textMatrixScale;if(ln===0||Lt===0){const nt=se.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;(nt===n.TextRenderingMode.STROKE||nt===n.TextRenderingMode.FILL_STROKE)&&(Lt=this.getSinglePixelWidth())}else Lt/=ln;if(Z!==1&&(pe.scale(Z,Z),Lt/=Z),pe.lineWidth=Lt,re.isInvalidPDFjsFont){const nt=[];let dn=0;for(const pn of ee)nt.push(pn.unicode),dn+=pn.width;pe.fillText(nt.join(""),0,0),se.x+=dn*Je*Ae,pe.restore(),this.compose();return}let dt=0,st;for(st=0;st<Pe;++st){const nt=ee[st];if(typeof nt=="number"){dt+=We*nt*fe/1e3;continue}let dn=!1;const pn=(nt.isSpace?Ee:0)+ce,An=nt.fontChar,In=nt.accent;let Jn,ri,Wn=nt.width;if(Me){const ai=nt.vmetric||qe,Zn=-(nt.vmetric?ai[1]:Wn*.5)*Je,Ft=ai[2]*Je;Wn=ai?-ai[0]:Wn,Jn=Zn/Z,ri=(dt+Ft)/Z}else Jn=dt/Z,ri=0;if(re.remeasure&&Wn>0){const ai=pe.measureText(An).width*1e3/fe*Z;if(Wn<ai&&this.isFontSubpixelAAEnabled){const Zn=Wn/ai;dn=!0,pe.save(),pe.scale(Zn,1),Jn/=Zn}else Wn!==ai&&(Jn+=(Wn-ai)/2e3*fe/Z)}if(this.contentVisible&&(nt.isInFont||re.missingFile)){if(wt&&!In)pe.fillText(An,Jn,ri);else if(this.paintChar(An,Jn,ri,rt),In){const ai=Jn+fe*In.offset.x/Z,Zn=ri-fe*In.offset.y/Z;this.paintChar(In.fontChar,ai,Zn,rt)}}let hi;Me?hi=Wn*Je-pn*Te:hi=Wn*Je+pn*Te,dt+=hi,dn&&pe.restore()}Me?se.y-=dt:se.x+=dt*Ae,pe.restore(),this.compose()}showType3Text(ee){const se=this.ctx,re=this.current,fe=re.font,pe=re.fontSize,Z=re.fontDirection,ce=fe.vertical?1:-1,Ee=re.charSpacing,Te=re.wordSpacing,Ae=re.textHScale*Z,Pe=re.fontMatrix||n.FONT_IDENTITY_MATRIX,Me=ee.length,We=re.textRenderingMode===n.TextRenderingMode.INVISIBLE;let qe,Je,wt,rt;if(!(We||pe===0)){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,se.save(),se.transform(...re.textMatrix),se.translate(re.x,re.y),se.scale(Ae,Z),qe=0;qe<Me;++qe){if(Je=ee[qe],typeof Je=="number"){rt=ce*Je*pe/1e3,this.ctx.translate(rt,0),re.x+=rt*Ae;continue}const Lt=(Je.isSpace?Te:0)+Ee,ln=fe.charProcOperatorList[Je.operatorListId];if(!ln){(0,n.warn)(`Type3 character "${Je.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Je,this.save(),se.scale(pe,pe),se.transform(...Pe),this.executeOperatorList(ln),this.restore()),wt=n.Util.applyTransform([Je.width,0],Pe)[0]*pe+Lt,se.translate(wt,0),re.x+=wt*Ae}se.restore(),this.processingType3=null}}setCharWidth(ee,se){}setCharWidthAndBounds(ee,se,re,fe,pe,Z){this.ctx.rect(re,fe,pe-re,Z-fe),this.ctx.clip(),this.endPath()}getColorN_Pattern(ee){let se;if(ee[0]==="TilingPattern"){const re=ee[1],fe=this.baseTransform||(0,r.getCurrentTransform)(this.ctx),pe={createCanvasGraphics:Z=>new ue(Z,this.commonObjs,this.objs,this.canvasFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};se=new s.TilingPattern(ee,re,this.ctx,pe,fe)}else se=this._getPattern(ee[1],ee[2]);return se}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(ee,se,re){const fe=this.selectColor?.(ee,se,re)||n.Util.makeHexColor(ee,se,re);this.ctx.strokeStyle=fe,this.current.strokeColor=fe}setFillRGBColor(ee,se,re){const fe=this.selectColor?.(ee,se,re)||n.Util.makeHexColor(ee,se,re);this.ctx.fillStyle=fe,this.current.fillColor=fe,this.current.patternFill=!1}_getPattern(ee,se=null){let re;return this.cachedPatterns.has(ee)?re=this.cachedPatterns.get(ee):(re=(0,s.getShadingPattern)(this.objs.get(ee)),this.cachedPatterns.set(ee,re)),se&&(re.matrix=se),re}shadingFill(ee){if(!this.contentVisible)return;const se=this.ctx;this.save();const re=this._getPattern(ee);se.fillStyle=re.getPattern(se,this,(0,r.getCurrentTransformInverse)(se),s.PathType.SHADING);const fe=(0,r.getCurrentTransformInverse)(se);if(fe){const pe=se.canvas,Z=pe.width,ce=pe.height,Ee=n.Util.applyTransform([0,0],fe),Te=n.Util.applyTransform([0,ce],fe),Ae=n.Util.applyTransform([Z,0],fe),Pe=n.Util.applyTransform([Z,ce],fe),Me=Math.min(Ee[0],Te[0],Ae[0],Pe[0]),We=Math.min(Ee[1],Te[1],Ae[1],Pe[1]),qe=Math.max(Ee[0],Te[0],Ae[0],Pe[0]),Je=Math.max(Ee[1],Te[1],Ae[1],Pe[1]);this.ctx.fillRect(Me,We,qe-Me,Je-We)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,n.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,n.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(ee,se){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(ee)&&ee.length===6&&this.transform(...ee),this.baseTransform=(0,r.getCurrentTransform)(this.ctx),se)){const re=se[2]-se[0],fe=se[3]-se[1];this.ctx.rect(se[0],se[1],re,fe),this.current.updateRectMinMax((0,r.getCurrentTransform)(this.ctx),se),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(ee){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const se=this.ctx;ee.isolated||(0,n.info)("TODO: Support non-isolated groups."),ee.knockout&&(0,n.warn)("Knockout groups not supported.");const re=(0,r.getCurrentTransform)(se);if(ee.matrix&&se.transform(...ee.matrix),!ee.bbox)throw new Error("Bounding box is required.");let fe=n.Util.getAxialAlignedBoundingBox(ee.bbox,(0,r.getCurrentTransform)(se));const pe=[0,0,se.canvas.width,se.canvas.height];fe=n.Util.intersect(fe,pe)||[0,0,0,0];const Z=Math.floor(fe[0]),ce=Math.floor(fe[1]);let Ee=Math.max(Math.ceil(fe[2])-Z,1),Te=Math.max(Math.ceil(fe[3])-ce,1),Ae=1,Pe=1;Ee>d&&(Ae=Ee/d,Ee=d),Te>d&&(Pe=Te/d,Te=d),this.current.startNewPathAndClipBox([0,0,Ee,Te]);let Me="groupAt"+this.groupLevel;ee.smask&&(Me+="_smask_"+this.smaskCounter++%2);const We=this.cachedCanvases.getCanvas(Me,Ee,Te),qe=We.context;qe.scale(1/Ae,1/Pe),qe.translate(-Z,-ce),qe.transform(...re),ee.smask?this.smaskStack.push({canvas:We.canvas,context:qe,offsetX:Z,offsetY:ce,scaleX:Ae,scaleY:Pe,subtype:ee.smask.subtype,backdrop:ee.smask.backdrop,transferMap:ee.smask.transferMap||null,startTransformInverse:null}):(se.setTransform(1,0,0,1,0,0),se.translate(Z,ce),se.scale(Ae,Pe),se.save()),P(se,qe),this.ctx=qe,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(se),this.groupLevel++}endGroup(ee){if(!this.contentVisible)return;this.groupLevel--;const se=this.ctx,re=this.groupStack.pop();if(this.ctx=re,this.ctx.imageSmoothingEnabled=!1,ee.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const fe=(0,r.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...fe);const pe=n.Util.getAxialAlignedBoundingBox([0,0,se.canvas.width,se.canvas.height],fe);this.ctx.drawImage(se.canvas,0,0),this.ctx.restore(),this.compose(pe)}}beginAnnotation(ee,se,re,fe,pe){if(this.#e(),G(this.ctx,this.foregroundColor),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(se)&&se.length===4){const Z=se[2]-se[0],ce=se[3]-se[1];if(pe&&this.annotationCanvasMap){re=re.slice(),re[4]-=se[0],re[5]-=se[1],se=se.slice(),se[0]=se[1]=0,se[2]=Z,se[3]=ce;const[Ee,Te]=n.Util.singularValueDecompose2dScale((0,r.getCurrentTransform)(this.ctx)),{viewportScale:Ae}=this,Pe=Math.ceil(Z*this.outputScaleX*Ae),Me=Math.ceil(ce*this.outputScaleY*Ae);this.annotationCanvas=this.canvasFactory.create(Pe,Me);const{canvas:We,context:qe}=this.annotationCanvas;this.annotationCanvasMap.set(ee,We),this.annotationCanvas.savedCtx=this.ctx,this.ctx=qe,this.ctx.setTransform(Ee,0,0,-Te,0,ce*Te),G(this.ctx,this.foregroundColor)}else G(this.ctx,this.foregroundColor),this.ctx.rect(se[0],se[1],Z,ce),this.ctx.clip(),this.endPath()}this.current=new A(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...re),this.transform(...fe)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(ee){if(!this.contentVisible)return;const se=ee.count;ee=this.getObject(ee.data,ee),ee.count=se;const re=this.ctx,fe=this.processingType3;if(fe&&(fe.compiled===void 0&&(fe.compiled=E(ee)),fe.compiled)){fe.compiled(re);return}const pe=this._createMaskCanvas(ee),Z=pe.canvas;re.save(),re.setTransform(1,0,0,1,0,0),re.drawImage(Z,pe.offsetX,pe.offsetY),re.restore(),this.compose()}paintImageMaskXObjectRepeat(ee,se,re=0,fe=0,pe,Z){if(!this.contentVisible)return;ee=this.getObject(ee.data,ee);const ce=this.ctx;ce.save();const Ee=(0,r.getCurrentTransform)(ce);ce.transform(se,re,fe,pe,0,0);const Te=this._createMaskCanvas(ee);ce.setTransform(1,0,0,1,Te.offsetX-Ee[4],Te.offsetY-Ee[5]);for(let Ae=0,Pe=Z.length;Ae<Pe;Ae+=2){const Me=n.Util.transform(Ee,[se,re,fe,pe,Z[Ae],Z[Ae+1]]),[We,qe]=n.Util.applyTransform([0,0],Me);ce.drawImage(Te.canvas,We,qe)}ce.restore(),this.compose()}paintImageMaskXObjectGroup(ee){if(!this.contentVisible)return;const se=this.ctx,re=this.current.fillColor,fe=this.current.patternFill;for(const pe of ee){const{data:Z,width:ce,height:Ee,transform:Te}=pe,Ae=this.cachedCanvases.getCanvas("maskCanvas",ce,Ee),Pe=Ae.context;Pe.save();const Me=this.getObject(Z,pe);D(Pe,Me),Pe.globalCompositeOperation="source-in",Pe.fillStyle=fe?re.getPattern(Pe,this,(0,r.getCurrentTransformInverse)(se),s.PathType.FILL):re,Pe.fillRect(0,0,ce,Ee),Pe.restore(),se.save(),se.transform(...Te),se.scale(1,-1),b(se,Ae.canvas,0,0,ce,Ee,0,-1,1,1),se.restore()}this.compose()}paintImageXObject(ee){if(!this.contentVisible)return;const se=this.getObject(ee);if(!se){(0,n.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(se)}paintImageXObjectRepeat(ee,se,re,fe){if(!this.contentVisible)return;const pe=this.getObject(ee);if(!pe){(0,n.warn)("Dependent image isn't ready yet");return}const Z=pe.width,ce=pe.height,Ee=[];for(let Te=0,Ae=fe.length;Te<Ae;Te+=2)Ee.push({transform:[se,0,0,re,fe[Te],fe[Te+1]],x:0,y:0,w:Z,h:ce});this.paintInlineImageXObjectGroup(pe,Ee)}paintInlineImageXObject(ee){if(!this.contentVisible)return;const se=ee.width,re=ee.height,fe=this.ctx;this.save(),fe.scale(1/se,-1/re);let pe;if(typeof HTMLElement=="function"&&ee instanceof HTMLElement||!ee.data)pe=ee;else{const ce=this.cachedCanvases.getCanvas("inlineImage",se,re),Ee=ce.context;z(Ee,ee,this.current.transferMaps),pe=ce.canvas}const Z=this._scaleImage(pe,(0,r.getCurrentTransformInverse)(fe));fe.imageSmoothingEnabled=te((0,r.getCurrentTransform)(fe),ee.interpolate),b(fe,Z.img,0,0,Z.paintWidth,Z.paintHeight,0,-re,se,re),this.compose(),this.restore()}paintInlineImageXObjectGroup(ee,se){if(!this.contentVisible)return;const re=this.ctx,fe=ee.width,pe=ee.height,Z=this.cachedCanvases.getCanvas("inlineImage",fe,pe),ce=Z.context;z(ce,ee,this.current.transferMaps);for(const Ee of se)re.save(),re.transform(...Ee.transform),re.scale(1,-1),b(re,Z.canvas,Ee.x,Ee.y,Ee.w,Ee.h,0,-1,1,1),re.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(ee){}markPointProps(ee,se){}beginMarkedContent(ee){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(ee,se){ee==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(se)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(ee){const se=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(ee);const re=this.ctx;this.pendingClip&&(se||(this.pendingClip===le?re.clip("evenodd"):re.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),re.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const ee=(0,r.getCurrentTransform)(this.ctx);if(ee[1]===0&&ee[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(ee[0]),Math.abs(ee[3]));else{const se=Math.abs(ee[0]*ee[3]-ee[2]*ee[1]),re=Math.hypot(ee[0],ee[2]),fe=Math.hypot(ee[1],ee[3]);this._cachedGetSinglePixelWidth=Math.max(re,fe)/se}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){const{lineWidth:ee}=this.current,se=(0,r.getCurrentTransform)(this.ctx);let re,fe;if(se[1]===0&&se[2]===0){const pe=Math.abs(se[0]),Z=Math.abs(se[3]);if(ee===0)re=1/pe,fe=1/Z;else{const ce=pe*ee,Ee=Z*ee;re=ce<1?1/ce:1,fe=Ee<1?1/Ee:1}}else{const pe=Math.abs(se[0]*se[3]-se[2]*se[1]),Z=Math.hypot(se[0],se[1]),ce=Math.hypot(se[2],se[3]);if(ee===0)re=ce/pe,fe=Z/pe;else{const Ee=ee*pe;re=ce>Ee?ce/Ee:1,fe=Z>Ee?Z/Ee:1}}this._cachedScaleForStroking=[re,fe]}return this._cachedScaleForStroking}rescaleAndStroke(ee){const{ctx:se}=this,{lineWidth:re}=this.current,[fe,pe]=this.getScaleForStroking();if(se.lineWidth=re||1,fe===1&&pe===1){se.stroke();return}let Z,ce,Ee;ee&&(Z=(0,r.getCurrentTransform)(se),ce=se.getLineDash().slice(),Ee=se.lineDashOffset),se.scale(fe,pe);const Te=Math.max(fe,pe);se.setLineDash(se.getLineDash().map(Ae=>Ae/Te)),se.lineDashOffset/=Te,se.stroke(),ee&&(se.setTransform(...Z),se.setLineDash(ce),se.lineDashOffset=Ee)}isContentVisible(){for(let ee=this.markedContentStack.length-1;ee>=0;ee--)if(!this.markedContentStack[ee].visible)return!1;return!0}}e.CanvasGraphics=ue;for(const oe in n.OPS)ue.prototype[oe]!==void 0&&(ue.prototype[n.OPS[oe]]=ue.prototype[oe])}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TilingPattern=e.PathType=void 0,e.getShadingPattern=g;var n=t(1),r=t(6);const s={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};e.PathType=s;function a(b,E){if(!E)return;const A=E[2]-E[0],z=E[3]-E[1],D=new Path2D;D.rect(E[0],E[1],A,z),b.clip(D)}class l{constructor(){this.constructor===l&&(0,n.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,n.unreachable)("Abstract method `getPattern` called.")}}class u extends l{constructor(E){super(),this._type=E[1],this._bbox=E[2],this._colorStops=E[3],this._p0=E[4],this._p1=E[5],this._r0=E[6],this._r1=E[7],this.matrix=null}_createGradient(E){let A;this._type==="axial"?A=E.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(A=E.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const z of this._colorStops)A.addColorStop(z[0],z[1]);return A}getPattern(E,A,z,D){let P;if(D===s.STROKE||D===s.FILL){const G=A.current.getClippedPathBoundingBox(D,(0,r.getCurrentTransform)(E))||[0,0,0,0],R=Math.ceil(G[2]-G[0])||1,I=Math.ceil(G[3]-G[1])||1,w=A.cachedCanvases.getCanvas("pattern",R,I,!0),H=w.context;H.clearRect(0,0,H.canvas.width,H.canvas.height),H.beginPath(),H.rect(0,0,H.canvas.width,H.canvas.height),H.translate(-G[0],-G[1]),z=n.Util.transform(z,[1,0,0,1,G[0],G[1]]),H.transform(...A.baseTransform),this.matrix&&H.transform(...this.matrix),a(H,this._bbox),H.fillStyle=this._createGradient(H),H.fill(),P=E.createPattern(w.canvas,"no-repeat");const V=new DOMMatrix(z);P.setTransform(V)}else a(E,this._bbox),P=this._createGradient(E);return P}}function d(b,E,A,z,D,P,G,R){const I=E.coords,w=E.colors,H=b.data,V=b.width*4;let te;I[A+1]>I[z+1]&&(te=A,A=z,z=te,te=P,P=G,G=te),I[z+1]>I[D+1]&&(te=z,z=D,D=te,te=G,G=R,R=te),I[A+1]>I[z+1]&&(te=A,A=z,z=te,te=P,P=G,G=te);const ae=(I[A]+E.offsetX)*E.scaleX,be=(I[A+1]+E.offsetY)*E.scaleY,_e=(I[z]+E.offsetX)*E.scaleX,le=(I[z+1]+E.offsetY)*E.scaleY,ue=(I[D]+E.offsetX)*E.scaleX,oe=(I[D+1]+E.offsetY)*E.scaleY;if(be>=oe)return;const ee=w[P],se=w[P+1],re=w[P+2],fe=w[G],pe=w[G+1],Z=w[G+2],ce=w[R],Ee=w[R+1],Te=w[R+2],Ae=Math.round(be),Pe=Math.round(oe);let Me,We,qe,Je,wt,rt,Lt,ln;for(let dt=Ae;dt<=Pe;dt++){if(dt<le){let An;dt<be?An=0:An=(be-dt)/(be-le),Me=ae-(ae-_e)*An,We=ee-(ee-fe)*An,qe=se-(se-pe)*An,Je=re-(re-Z)*An}else{let An;dt>oe?An=1:le===oe?An=0:An=(le-dt)/(le-oe),Me=_e-(_e-ue)*An,We=fe-(fe-ce)*An,qe=pe-(pe-Ee)*An,Je=Z-(Z-Te)*An}let st;dt<be?st=0:dt>oe?st=1:st=(be-dt)/(be-oe),wt=ae-(ae-ue)*st,rt=ee-(ee-ce)*st,Lt=se-(se-Ee)*st,ln=re-(re-Te)*st;const nt=Math.round(Math.min(Me,wt)),dn=Math.round(Math.max(Me,wt));let pn=V*dt+nt*4;for(let An=nt;An<=dn;An++)st=(Me-An)/(Me-wt),st<0?st=0:st>1&&(st=1),H[pn++]=We-(We-rt)*st|0,H[pn++]=qe-(qe-Lt)*st|0,H[pn++]=Je-(Je-ln)*st|0,H[pn++]=255}}function h(b,E,A){const z=E.coords,D=E.colors;let P,G;switch(E.type){case"lattice":const R=E.verticesPerRow,I=Math.floor(z.length/R)-1,w=R-1;for(P=0;P<I;P++){let H=P*R;for(let V=0;V<w;V++,H++)d(b,A,z[H],z[H+1],z[H+R],D[H],D[H+1],D[H+R]),d(b,A,z[H+R+1],z[H+1],z[H+R],D[H+R+1],D[H+1],D[H+R])}break;case"triangles":for(P=0,G=z.length;P<G;P+=3)d(b,A,z[P],z[P+1],z[P+2],D[P],D[P+1],D[P+2]);break;default:throw new Error("illegal figure")}}class p extends l{constructor(E){super(),this._coords=E[2],this._colors=E[3],this._figures=E[4],this._bounds=E[5],this._bbox=E[7],this._background=E[8],this.matrix=null}_createMeshCanvas(E,A,z){const R=Math.floor(this._bounds[0]),I=Math.floor(this._bounds[1]),w=Math.ceil(this._bounds[2])-R,H=Math.ceil(this._bounds[3])-I,V=Math.min(Math.ceil(Math.abs(w*E[0]*1.1)),3e3),te=Math.min(Math.ceil(Math.abs(H*E[1]*1.1)),3e3),ae=w/V,be=H/te,_e={coords:this._coords,colors:this._colors,offsetX:-R,offsetY:-I,scaleX:1/ae,scaleY:1/be},le=V+4,ue=te+4,oe=z.getCanvas("mesh",le,ue,!1),ee=oe.context,se=ee.createImageData(V,te);if(A){const fe=se.data;for(let pe=0,Z=fe.length;pe<Z;pe+=4)fe[pe]=A[0],fe[pe+1]=A[1],fe[pe+2]=A[2],fe[pe+3]=255}for(const fe of this._figures)h(se,fe,_e);return ee.putImageData(se,2,2),{canvas:oe.canvas,offsetX:R-2*ae,offsetY:I-2*be,scaleX:ae,scaleY:be}}getPattern(E,A,z,D){a(E,this._bbox);let P;if(D===s.SHADING)P=n.Util.singularValueDecompose2dScale((0,r.getCurrentTransform)(E));else if(P=n.Util.singularValueDecompose2dScale(A.baseTransform),this.matrix){const R=n.Util.singularValueDecompose2dScale(this.matrix);P=[P[0]*R[0],P[1]*R[1]]}const G=this._createMeshCanvas(P,D===s.SHADING?null:this._background,A.cachedCanvases);return D!==s.SHADING&&(E.setTransform(...A.baseTransform),this.matrix&&E.transform(...this.matrix)),E.translate(G.offsetX,G.offsetY),E.scale(G.scaleX,G.scaleY),E.createPattern(G.canvas,"no-repeat")}}class m extends l{getPattern(){return"hotpink"}}function g(b){switch(b[0]){case"RadialAxial":return new u(b);case"Mesh":return new p(b);case"Dummy":return new m}throw new Error(`Unknown IR type: ${b[0]}`)}const v={COLORED:1,UNCOLORED:2};class _{static get MAX_PATTERN_SIZE(){return(0,n.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(E,A,z,D,P){this.operatorList=E[2],this.matrix=E[3]||[1,0,0,1,0,0],this.bbox=E[4],this.xstep=E[5],this.ystep=E[6],this.paintType=E[7],this.tilingType=E[8],this.color=A,this.ctx=z,this.canvasGraphicsFactory=D,this.baseTransform=P}createPatternCanvas(E){const A=this.operatorList,z=this.bbox,D=this.xstep,P=this.ystep,G=this.paintType,R=this.tilingType,I=this.color,w=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+R);const H=z[0],V=z[1],te=z[2],ae=z[3],be=n.Util.singularValueDecompose2dScale(this.matrix),_e=n.Util.singularValueDecompose2dScale(this.baseTransform),le=[be[0]*_e[0],be[1]*_e[1]],ue=this.getSizeAndScale(D,this.ctx.canvas.width,le[0]),oe=this.getSizeAndScale(P,this.ctx.canvas.height,le[1]),ee=E.cachedCanvases.getCanvas("pattern",ue.size,oe.size,!0),se=ee.context,re=w.createCanvasGraphics(se);re.groupLevel=E.groupLevel,this.setFillAndStrokeStyleToContext(re,G,I);let fe=H,pe=V,Z=te,ce=ae;return H<0&&(fe=0,Z+=Math.abs(H)),V<0&&(pe=0,ce+=Math.abs(V)),se.translate(-(ue.scale*fe),-(oe.scale*pe)),re.transform(ue.scale,0,0,oe.scale,0,0),se.save(),this.clipBbox(re,fe,pe,Z,ce),re.baseTransform=(0,r.getCurrentTransform)(re.ctx),re.executeOperatorList(A),re.endDrawing(),{canvas:ee.canvas,scaleX:ue.scale,scaleY:oe.scale,offsetX:fe,offsetY:pe}}getSizeAndScale(E,A,z){E=Math.abs(E);const D=Math.max(_.MAX_PATTERN_SIZE,A);let P=Math.ceil(E*z);return P>=D?P=D:z=P/E,{scale:z,size:P}}clipBbox(E,A,z,D,P){const G=D-A,R=P-z;E.ctx.rect(A,z,G,R),E.current.updateRectMinMax((0,r.getCurrentTransform)(E.ctx),[A,z,D,P]),E.clip(),E.endPath()}setFillAndStrokeStyleToContext(E,A,z){const D=E.ctx,P=E.current;switch(A){case v.COLORED:const G=this.ctx;D.fillStyle=G.fillStyle,D.strokeStyle=G.strokeStyle,P.fillColor=G.fillStyle,P.strokeColor=G.strokeStyle;break;case v.UNCOLORED:const R=n.Util.makeHexColor(z[0],z[1],z[2]);D.fillStyle=R,D.strokeStyle=R,P.fillColor=R,P.strokeColor=R;break;default:throw new n.FormatError(`Unsupported paint type: ${A}`)}}getPattern(E,A,z,D){let P=z;D!==s.SHADING&&(P=n.Util.transform(P,A.baseTransform),this.matrix&&(P=n.Util.transform(P,this.matrix)));const G=this.createPatternCanvas(A);let R=new DOMMatrix(P);R=R.translate(G.offsetX,G.offsetY),R=R.scale(1/G.scaleX,1/G.scaleY);const I=E.createPattern(G.canvas,"repeat");return I.setTransform(R),I}}e.TilingPattern=_}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.applyMaskImageData=r;var n=t(1);function r({src:s,srcPos:a=0,dest:l,destPos:u=0,width:d,height:h,inverseDecode:p=!1}){const m=n.FeatureTest.isLittleEndian?4278190080:255,[g,v]=p?[0,m]:[m,0],_=d>>3,b=d&7,E=s.length;l=new Uint32Array(l.buffer);for(let A=0;A<h;A++){for(const D=a+_;a<D;a++){const P=a<E?s[a]:255;l[u++]=P&128?v:g,l[u++]=P&64?v:g,l[u++]=P&32?v:g,l[u++]=P&16?v:g,l[u++]=P&8?v:g,l[u++]=P&4?v:g,l[u++]=P&2?v:g,l[u++]=P&1?v:g}if(b===0)continue;const z=a<E?s[a++]:255;for(let D=0;D<b;D++)l[u++]=z&1<<7-D?v:g}return{srcPos:a,destPos:u}}}),((i,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalWorkerOptions=void 0;const t=Object.create(null);e.GlobalWorkerOptions=t,t.workerPort=null,t.workerSrc=""}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MessageHandler=void 0;var n=t(1);const r={DATA:1,ERROR:2},s={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function a(u){switch(u instanceof Error||typeof u=="object"&&u!==null||(0,n.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),u.name){case"AbortException":return new n.AbortException(u.message);case"MissingPDFException":return new n.MissingPDFException(u.message);case"PasswordException":return new n.PasswordException(u.message,u.code);case"UnexpectedResponseException":return new n.UnexpectedResponseException(u.message,u.status);case"UnknownErrorException":return new n.UnknownErrorException(u.message,u.details);default:return new n.UnknownErrorException(u.message,u.toString())}}class l{constructor(d,h,p){this.sourceName=d,this.targetName=h,this.comObj=p,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=m=>{const g=m.data;if(g.targetName!==this.sourceName)return;if(g.stream){this._processStreamMessage(g);return}if(g.callback){const _=g.callbackId,b=this.callbackCapabilities[_];if(!b)throw new Error(`Cannot resolve callback ${_}`);if(delete this.callbackCapabilities[_],g.callback===r.DATA)b.resolve(g.data);else if(g.callback===r.ERROR)b.reject(a(g.reason));else throw new Error("Unexpected callback case");return}const v=this.actionHandler[g.action];if(!v)throw new Error(`Unknown action from worker: ${g.action}`);if(g.callbackId){const _=this.sourceName,b=g.sourceName;new Promise(function(E){E(v(g.data))}).then(function(E){p.postMessage({sourceName:_,targetName:b,callback:r.DATA,callbackId:g.callbackId,data:E})},function(E){p.postMessage({sourceName:_,targetName:b,callback:r.ERROR,callbackId:g.callbackId,reason:a(E)})});return}if(g.streamId){this._createStreamSink(g);return}v(g.data)},p.addEventListener("message",this._onComObjOnMessage)}on(d,h){const p=this.actionHandler;if(p[d])throw new Error(`There is already an actionName called "${d}"`);p[d]=h}send(d,h,p){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:d,data:h},p)}sendWithPromise(d,h,p){const m=this.callbackId++,g=(0,n.createPromiseCapability)();this.callbackCapabilities[m]=g;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:d,callbackId:m,data:h},p)}catch(v){g.reject(v)}return g.promise}sendWithStream(d,h,p,m){const g=this.streamId++,v=this.sourceName,_=this.targetName,b=this.comObj;return new ReadableStream({start:E=>{const A=(0,n.createPromiseCapability)();return this.streamControllers[g]={controller:E,startCall:A,pullCall:null,cancelCall:null,isClosed:!1},b.postMessage({sourceName:v,targetName:_,action:d,streamId:g,data:h,desiredSize:E.desiredSize},m),A.promise},pull:E=>{const A=(0,n.createPromiseCapability)();return this.streamControllers[g].pullCall=A,b.postMessage({sourceName:v,targetName:_,stream:s.PULL,streamId:g,desiredSize:E.desiredSize}),A.promise},cancel:E=>{(0,n.assert)(E instanceof Error,"cancel must have a valid reason");const A=(0,n.createPromiseCapability)();return this.streamControllers[g].cancelCall=A,this.streamControllers[g].isClosed=!0,b.postMessage({sourceName:v,targetName:_,stream:s.CANCEL,streamId:g,reason:a(E)}),A.promise}},p)}_createStreamSink(d){const h=d.streamId,p=this.sourceName,m=d.sourceName,g=this.comObj,v=this,_=this.actionHandler[d.action],b={enqueue(E,A=1,z){if(this.isCancelled)return;const D=this.desiredSize;this.desiredSize-=A,D>0&&this.desiredSize<=0&&(this.sinkCapability=(0,n.createPromiseCapability)(),this.ready=this.sinkCapability.promise),g.postMessage({sourceName:p,targetName:m,stream:s.ENQUEUE,streamId:h,chunk:E},z)},close(){this.isCancelled||(this.isCancelled=!0,g.postMessage({sourceName:p,targetName:m,stream:s.CLOSE,streamId:h}),delete v.streamSinks[h])},error(E){(0,n.assert)(E instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,g.postMessage({sourceName:p,targetName:m,stream:s.ERROR,streamId:h,reason:a(E)}))},sinkCapability:(0,n.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:d.desiredSize,ready:null};b.sinkCapability.resolve(),b.ready=b.sinkCapability.promise,this.streamSinks[h]=b,new Promise(function(E){E(_(d.data,b))}).then(function(){g.postMessage({sourceName:p,targetName:m,stream:s.START_COMPLETE,streamId:h,success:!0})},function(E){g.postMessage({sourceName:p,targetName:m,stream:s.START_COMPLETE,streamId:h,reason:a(E)})})}_processStreamMessage(d){const h=d.streamId,p=this.sourceName,m=d.sourceName,g=this.comObj,v=this.streamControllers[h],_=this.streamSinks[h];switch(d.stream){case s.START_COMPLETE:d.success?v.startCall.resolve():v.startCall.reject(a(d.reason));break;case s.PULL_COMPLETE:d.success?v.pullCall.resolve():v.pullCall.reject(a(d.reason));break;case s.PULL:if(!_){g.postMessage({sourceName:p,targetName:m,stream:s.PULL_COMPLETE,streamId:h,success:!0});break}_.desiredSize<=0&&d.desiredSize>0&&_.sinkCapability.resolve(),_.desiredSize=d.desiredSize,new Promise(function(b){b(_.onPull&&_.onPull())}).then(function(){g.postMessage({sourceName:p,targetName:m,stream:s.PULL_COMPLETE,streamId:h,success:!0})},function(b){g.postMessage({sourceName:p,targetName:m,stream:s.PULL_COMPLETE,streamId:h,reason:a(b)})});break;case s.ENQUEUE:if((0,n.assert)(v,"enqueue should have stream controller"),v.isClosed)break;v.controller.enqueue(d.chunk);break;case s.CLOSE:if((0,n.assert)(v,"close should have stream controller"),v.isClosed)break;v.isClosed=!0,v.controller.close(),this._deleteStreamController(v,h);break;case s.ERROR:(0,n.assert)(v,"error should have stream controller"),v.controller.error(a(d.reason)),this._deleteStreamController(v,h);break;case s.CANCEL_COMPLETE:d.success?v.cancelCall.resolve():v.cancelCall.reject(a(d.reason)),this._deleteStreamController(v,h);break;case s.CANCEL:if(!_)break;new Promise(function(b){b(_.onCancel&&_.onCancel(a(d.reason)))}).then(function(){g.postMessage({sourceName:p,targetName:m,stream:s.CANCEL_COMPLETE,streamId:h,success:!0})},function(b){g.postMessage({sourceName:p,targetName:m,stream:s.CANCEL_COMPLETE,streamId:h,reason:a(b)})}),_.sinkCapability.reject(a(d.reason)),_.isCancelled=!0,delete this.streamSinks[h];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(d,h){await Promise.allSettled([d.startCall&&d.startCall.promise,d.pullCall&&d.pullCall.promise,d.cancelCall&&d.cancelCall.promise]),delete this.streamControllers[h]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}e.MessageHandler=l}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var n=t(1);class r{#e;#t;constructor({parsedData:a,rawData:l}){this.#e=a,this.#t=l}getRaw(){return this.#t}get(a){return this.#e.get(a)??null}getAll(){return(0,n.objectFromMap)(this.#e)}has(a){return this.#e.has(a)}}e.Metadata=r}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OptionalContentConfig=void 0;var n=t(1),r=t(8);const s=Symbol("INTERNAL");class a{#e=!0;constructor(d,h){this.name=d,this.intent=h}get visible(){return this.#e}_setVisible(d,h){d!==s&&(0,n.unreachable)("Internal method `_setVisible` called."),this.#e=h}}class l{#e=null;#t=new Map;#i=null;#n=null;constructor(d){if(this.name=null,this.creator=null,d!==null){this.name=d.name,this.creator=d.creator,this.#n=d.order;for(const h of d.groups)this.#t.set(h.id,new a(h.name,h.intent));if(d.baseState==="OFF")for(const h of this.#t.values())h._setVisible(s,!1);for(const h of d.on)this.#t.get(h)._setVisible(s,!0);for(const h of d.off)this.#t.get(h)._setVisible(s,!1);this.#i=this.getHash()}}#r(d){const h=d.length;if(h<2)return!0;const p=d[0];for(let m=1;m<h;m++){const g=d[m];let v;if(Array.isArray(g))v=this.#r(g);else if(this.#t.has(g))v=this.#t.get(g).visible;else return(0,n.warn)(`Optional content group not found: ${g}`),!0;switch(p){case"And":if(!v)return!1;break;case"Or":if(v)return!0;break;case"Not":return!v;default:return!0}}return p==="And"}isVisible(d){if(this.#t.size===0)return!0;if(!d)return(0,n.warn)("Optional content group not defined."),!0;if(d.type==="OCG")return this.#t.has(d.id)?this.#t.get(d.id).visible:((0,n.warn)(`Optional content group not found: ${d.id}`),!0);if(d.type==="OCMD"){if(d.expression)return this.#r(d.expression);if(!d.policy||d.policy==="AnyOn"){for(const h of d.ids){if(!this.#t.has(h))return(0,n.warn)(`Optional content group not found: ${h}`),!0;if(this.#t.get(h).visible)return!0}return!1}else if(d.policy==="AllOn"){for(const h of d.ids){if(!this.#t.has(h))return(0,n.warn)(`Optional content group not found: ${h}`),!0;if(!this.#t.get(h).visible)return!1}return!0}else if(d.policy==="AnyOff"){for(const h of d.ids){if(!this.#t.has(h))return(0,n.warn)(`Optional content group not found: ${h}`),!0;if(!this.#t.get(h).visible)return!0}return!1}else if(d.policy==="AllOff"){for(const h of d.ids){if(!this.#t.has(h))return(0,n.warn)(`Optional content group not found: ${h}`),!0;if(this.#t.get(h).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${d.policy}.`),!0}return(0,n.warn)(`Unknown group type ${d.type}.`),!0}setVisibility(d,h=!0){if(!this.#t.has(d)){(0,n.warn)(`Optional content group not found: ${d}`);return}this.#t.get(d)._setVisible(s,!!h),this.#e=null}get hasInitialVisibility(){return this.getHash()===this.#i}getOrder(){return this.#t.size?this.#n?this.#n.slice():[...this.#t.keys()]:null}getGroups(){return this.#t.size>0?(0,n.objectFromMap)(this.#t):null}getGroup(d){return this.#t.get(d)||null}getHash(){if(this.#e!==null)return this.#e;const d=new r.MurmurHash3_64;for(const[h,p]of this.#t)d.update(`${h}:${p.visible}`);return this.#e=d.hexdigest()}}e.OptionalContentConfig=l}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFDataTransportStream=void 0;var n=t(1),r=t(6);class s{constructor({length:d,initialData:h,progressiveDone:p=!1,contentDispositionFilename:m=null,disableRange:g=!1,disableStream:v=!1},_){if((0,n.assert)(_,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=p,this._contentDispositionFilename=m,h?.length>0){const b=h instanceof Uint8Array&&h.byteLength===h.buffer.byteLength?h.buffer:new Uint8Array(h).buffer;this._queuedChunks.push(b)}this._pdfDataRangeTransport=_,this._isStreamingSupported=!v,this._isRangeSupported=!g,this._contentLength=d,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((b,E)=>{this._onReceiveData({begin:b,chunk:E})}),this._pdfDataRangeTransport.addProgressListener((b,E)=>{this._onProgress({loaded:b,total:E})}),this._pdfDataRangeTransport.addProgressiveReadListener(b=>{this._onReceiveData({chunk:b})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:d,chunk:h}){const p=h instanceof Uint8Array&&h.byteLength===h.buffer.byteLength?h.buffer:new Uint8Array(h).buffer;if(d===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(p):this._queuedChunks.push(p);else{const m=this._rangeReaders.some(function(g){return g._begin!==d?!1:(g._enqueue(p),!0)});(0,n.assert)(m,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(d){d.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:d.loaded}):this._fullRequestReader?.onProgress?.({loaded:d.loaded,total:d.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(d){const h=this._rangeReaders.indexOf(d);h>=0&&this._rangeReaders.splice(h,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const d=this._queuedChunks;return this._queuedChunks=null,new a(this,d,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(d,h){if(h<=this._progressiveDataLength)return null;const p=new l(this,d,h);return this._pdfDataRangeTransport.requestDataRange(d,h),this._rangeReaders.push(p),p}cancelAllRequests(d){this._fullRequestReader?.cancel(d);for(const h of this._rangeReaders.slice(0))h.cancel(d);this._pdfDataRangeTransport.abort()}}e.PDFDataTransportStream=s;class a{constructor(d,h,p=!1,m=null){this._stream=d,this._done=p||!1,this._filename=(0,r.isPdfFile)(m)?m:null,this._queuedChunks=h||[],this._loaded=0;for(const g of this._queuedChunks)this._loaded+=g.byteLength;this._requests=[],this._headersReady=Promise.resolve(),d._fullRequestReader=this,this.onProgress=null}_enqueue(d){this._done||(this._requests.length>0?this._requests.shift().resolve({value:d,done:!1}):this._queuedChunks.push(d),this._loaded+=d.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const d=(0,n.createPromiseCapability)();return this._requests.push(d),d.promise}cancel(d){this._done=!0;for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class l{constructor(d,h,p){this._stream=d,this._begin=h,this._end=p,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(d){if(!this._done){if(this._requests.length===0)this._queuedChunk=d;else{this._requests.shift().resolve({value:d,done:!1});for(const p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const h=this._queuedChunk;return this._queuedChunk=null,{value:h,done:!1}}if(this._done)return{value:void 0,done:!0};const d=(0,n.createPromiseCapability)();return this._requests.push(d),d.promise}cancel(d){this._done=!0;for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}}),((i,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaText=void 0;class t{static textContent(r){const s=[],a={items:s,styles:Object.create(null)};function l(u){if(!u)return;let d=null;const h=u.name;if(h==="#text")d=u.value;else if(t.shouldBuildText(h))u?.attributes?.textContent?d=u.attributes.textContent:u.value&&(d=u.value);else return;if(d!==null&&s.push({str:d}),!!u.children)for(const p of u.children)l(p)}return l(r),a}static shouldBuildText(r){return!(r==="textarea"||r==="input"||r==="option"||r==="select")}}e.XfaText=t}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NodeStandardFontDataFactory=e.NodeCanvasFactory=e.NodeCMapReaderFactory=void 0;var n=t(7);const r=function(u){return new Promise((d,h)=>{require$$5.readFile(u,(m,g)=>{if(m||!g){h(new Error(m));return}d(new Uint8Array(g))})})};class s extends n.BaseCanvasFactory{_createCanvas(d,h){return require$$5.createCanvas(d,h)}}e.NodeCanvasFactory=s;class a extends n.BaseCMapReaderFactory{_fetchData(d,h){return r(d).then(p=>({cMapData:p,compressionType:h}))}}e.NodeCMapReaderFactory=a;class l extends n.BaseStandardFontDataFactory{_fetchData(d){return r(d)}}e.NodeStandardFontDataFactory=l}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNodeStream=void 0;var n=t(1),r=t(22);const s=require$$5,a=require$$5,l=require$$5,u=require$$5,d=/^file:\/\/\/[a-zA-Z]:\//;function h(z){const D=u.parse(z);return D.protocol==="file:"||D.host?D:/^[a-z]:[/\\]/i.test(z)?u.parse(`file:///${z}`):(D.host||(D.protocol="file:"),D)}class p{constructor(D){this.source=D,this.url=h(D.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&D.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new E(this):new _(this),this._fullRequestReader}getRangeReader(D,P){if(P<=this._progressiveDataLength)return null;const G=this.isFsUrl?new A(this,D,P):new b(this,D,P);return this._rangeRequestReaders.push(G),G}cancelAllRequests(D){this._fullRequestReader?.cancel(D);for(const P of this._rangeRequestReaders.slice(0))P.cancel(D)}}e.PDFNodeStream=p;class m{constructor(D){this._url=D.url,this._done=!1,this._storedError=null,this.onProgress=null;const P=D.source;this._contentLength=P.length,this._loaded=0,this._filename=null,this._disableRange=P.disableRange||!1,this._rangeChunkSize=P.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!P.disableStream,this._isRangeSupported=!P.disableRange,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)(),this._headersCapability=(0,n.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const D=this._readableStream.read();return D===null?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=D.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(D).buffer,done:!1})}cancel(D){if(!this._readableStream){this._error(D);return}this._readableStream.destroy(D)}_error(D){this._storedError=D,this._readCapability.resolve()}_setReadableStream(D){this._readableStream=D,D.on("readable",()=>{this._readCapability.resolve()}),D.on("end",()=>{D.destroy(),this._done=!0,this._readCapability.resolve()}),D.on("error",P=>{this._error(P)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class g{constructor(D){this._url=D.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)();const P=D.source;this._isStreamingSupported=!P.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const D=this._readableStream.read();return D===null?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=D.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(D).buffer,done:!1})}cancel(D){if(!this._readableStream){this._error(D);return}this._readableStream.destroy(D)}_error(D){this._storedError=D,this._readCapability.resolve()}_setReadableStream(D){this._readableStream=D,D.on("readable",()=>{this._readCapability.resolve()}),D.on("end",()=>{D.destroy(),this._done=!0,this._readCapability.resolve()}),D.on("error",P=>{this._error(P)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function v(z,D){return{protocol:z.protocol,auth:z.auth,host:z.hostname,port:z.port,path:z.path,method:"GET",headers:D}}class _ extends m{constructor(D){super(D);const P=G=>{if(G.statusCode===404){const H=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=H,this._headersCapability.reject(H);return}this._headersCapability.resolve(),this._setReadableStream(G);const R=H=>this._readableStream.headers[H.toLowerCase()],{allowRangeRequests:I,suggestedLength:w}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:R,isHttp:D.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=I,this._contentLength=w||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(R)};this._request=null,this._url.protocol==="http:"?this._request=a.request(v(this._url,D.httpHeaders),P):this._request=l.request(v(this._url,D.httpHeaders),P),this._request.on("error",G=>{this._storedError=G,this._headersCapability.reject(G)}),this._request.end()}}class b extends g{constructor(D,P,G){super(D),this._httpHeaders={};for(const I in D.httpHeaders){const w=D.httpHeaders[I];w!==void 0&&(this._httpHeaders[I]=w)}this._httpHeaders.Range=`bytes=${P}-${G-1}`;const R=I=>{if(I.statusCode===404){const w=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=w;return}this._setReadableStream(I)};this._request=null,this._url.protocol==="http:"?this._request=a.request(v(this._url,this._httpHeaders),R):this._request=l.request(v(this._url,this._httpHeaders),R),this._request.on("error",I=>{this._storedError=I}),this._request.end()}}class E extends m{constructor(D){super(D);let P=decodeURIComponent(this._url.path);d.test(this._url.href)&&(P=P.replace(/^\//,"")),s.lstat(P,(G,R)=>{if(G){G.code==="ENOENT"&&(G=new n.MissingPDFException(`Missing PDF "${P}".`)),this._storedError=G,this._headersCapability.reject(G);return}this._contentLength=R.size,this._setReadableStream(s.createReadStream(P)),this._headersCapability.resolve()})}}class A extends g{constructor(D,P,G){super(D);let R=decodeURIComponent(this._url.path);d.test(this._url.href)&&(R=R.replace(/^\//,"")),this._setReadableStream(s.createReadStream(R,{start:P,end:G-1}))}}}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createResponseStatusError=u,e.extractFilenameFromHeader=l,e.validateRangeRequestCapabilities=a,e.validateResponseStatus=d;var n=t(1),r=t(23),s=t(6);function a({getResponseHeader:h,isHttp:p,rangeChunkSize:m,disableRange:g}){const v={allowRangeRequests:!1,suggestedLength:void 0},_=parseInt(h("Content-Length"),10);return!Number.isInteger(_)||(v.suggestedLength=_,_<=2*m)||g||!p||h("Accept-Ranges")!=="bytes"||(h("Content-Encoding")||"identity")!=="identity"||(v.allowRangeRequests=!0),v}function l(h){const p=h("Content-Disposition");if(p){let m=(0,r.getFilenameFromContentDispositionHeader)(p);if(m.includes("%"))try{m=decodeURIComponent(m)}catch{}if((0,s.isPdfFile)(m))return m}return null}function u(h,p){return h===404||h===0&&p.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+p+'".'):new n.UnexpectedResponseException(`Unexpected server response (${h}) while retrieving PDF "${p}".`,h)}function d(h){return h===200||h===206}}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFilenameFromContentDispositionHeader=r;var n=t(1);function r(s){let a=!0,l=u("filename\\*","i").exec(s);if(l){l=l[1];let _=m(l);return _=unescape(_),_=g(_),_=v(_),h(_)}if(l=p(s),l){const _=v(l);return h(_)}if(l=u("filename","i").exec(s),l){l=l[1];let _=m(l);return _=v(_),h(_)}function u(_,b){return new RegExp("(?:^|;)\\s*"+_+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',b)}function d(_,b){if(_){if(!/^[\x00-\xFF]+$/.test(b))return b;try{const E=new TextDecoder(_,{fatal:!0}),A=(0,n.stringToBytes)(b);b=E.decode(A),a=!1}catch{}}return b}function h(_){return a&&/[\x80-\xff]/.test(_)&&(_=d("utf-8",_),a&&(_=d("iso-8859-1",_))),_}function p(_){const b=[];let E;const A=u("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(E=A.exec(_))!==null;){let[,D,P,G]=E;if(D=parseInt(D,10),D in b){if(D===0)break;continue}b[D]=[P,G]}const z=[];for(let D=0;D<b.length&&D in b;++D){let[P,G]=b[D];G=m(G),P&&(G=unescape(G),D===0&&(G=g(G))),z.push(G)}return z.join("")}function m(_){if(_.startsWith('"')){const b=_.slice(1).split('\\"');for(let E=0;E<b.length;++E){const A=b[E].indexOf('"');A!==-1&&(b[E]=b[E].slice(0,A),b.length=E+1),b[E]=b[E].replace(/\\(.)/g,"$1")}_=b.join('"')}return _}function g(_){const b=_.indexOf("'");if(b===-1)return _;const E=_.slice(0,b),z=_.slice(b+1).replace(/^[^']*'/,"");return d(E,z)}function v(_){return!_.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(_)?_:_.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(b,E,A,z){if(A==="q"||A==="Q")return z=z.replace(/_/g," "),z=z.replace(/=([0-9a-fA-F]{2})/g,function(D,P){return String.fromCharCode(parseInt(P,16))}),d(E,z);try{z=atob(z)}catch{}return d(E,z)})}return""}}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNetworkStream=void 0;var n=t(1),r=t(22);const s=200,a=206;function l(m){const g=m.response;return typeof g!="string"?g:(0,n.stringToBytes)(g).buffer}class u{constructor(g,v={}){this.url=g,this.isHttp=/^https?:/i.test(g),this.httpHeaders=this.isHttp&&v.httpHeaders||Object.create(null),this.withCredentials=v.withCredentials||!1,this.getXhr=v.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(g,v,_){const b={begin:g,end:v};for(const E in _)b[E]=_[E];return this.request(b)}requestFull(g){return this.request(g)}request(g){const v=this.getXhr(),_=this.currXhrId++,b=this.pendingRequests[_]={xhr:v};v.open("GET",this.url),v.withCredentials=this.withCredentials;for(const E in this.httpHeaders){const A=this.httpHeaders[E];A!==void 0&&v.setRequestHeader(E,A)}return this.isHttp&&"begin"in g&&"end"in g?(v.setRequestHeader("Range",`bytes=${g.begin}-${g.end-1}`),b.expectedStatus=a):b.expectedStatus=s,v.responseType="arraybuffer",g.onError&&(v.onerror=function(E){g.onError(v.status)}),v.onreadystatechange=this.onStateChange.bind(this,_),v.onprogress=this.onProgress.bind(this,_),b.onHeadersReceived=g.onHeadersReceived,b.onDone=g.onDone,b.onError=g.onError,b.onProgress=g.onProgress,v.send(null),_}onProgress(g,v){const _=this.pendingRequests[g];_&&_.onProgress?.(v)}onStateChange(g,v){const _=this.pendingRequests[g];if(!_)return;const b=_.xhr;if(b.readyState>=2&&_.onHeadersReceived&&(_.onHeadersReceived(),delete _.onHeadersReceived),b.readyState!==4||!(g in this.pendingRequests))return;if(delete this.pendingRequests[g],b.status===0&&this.isHttp){_.onError?.(b.status);return}const E=b.status||s;if(!(E===s&&_.expectedStatus===a)&&E!==_.expectedStatus){_.onError?.(b.status);return}const z=l(b);if(E===a){const D=b.getResponseHeader("Content-Range"),P=/bytes (\d+)-(\d+)\/(\d+)/.exec(D);_.onDone({begin:parseInt(P[1],10),chunk:z})}else z?_.onDone({begin:0,chunk:z}):_.onError?.(b.status)}getRequestXhr(g){return this.pendingRequests[g].xhr}isPendingRequest(g){return g in this.pendingRequests}abortRequest(g){const v=this.pendingRequests[g].xhr;delete this.pendingRequests[g],v.abort()}}class d{constructor(g){this._source=g,this._manager=new u(g.url,{httpHeaders:g.httpHeaders,withCredentials:g.withCredentials}),this._rangeChunkSize=g.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(g){const v=this._rangeRequestReaders.indexOf(g);v>=0&&this._rangeRequestReaders.splice(v,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new h(this._manager,this._source),this._fullRequestReader}getRangeReader(g,v){const _=new p(this._manager,g,v);return _.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(_),_}cancelAllRequests(g){this._fullRequestReader?.cancel(g);for(const v of this._rangeRequestReaders.slice(0))v.cancel(g)}}e.PDFNetworkStream=d;class h{constructor(g,v){this._manager=g;const _={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=v.url,this._fullRequestId=g.requestFull(_),this._headersReceivedCapability=(0,n.createPromiseCapability)(),this._disableRange=v.disableRange||!1,this._contentLength=v.length,this._rangeChunkSize=v.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const g=this._fullRequestId,v=this._manager.getRequestXhr(g),_=A=>v.getResponseHeader(A),{allowRangeRequests:b,suggestedLength:E}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:_,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});b&&(this._isRangeSupported=!0),this._contentLength=E||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(_),this._isRangeSupported&&this._manager.abortRequest(g),this._headersReceivedCapability.resolve()}_onDone(g){if(g&&(this._requests.length>0?this._requests.shift().resolve({value:g.chunk,done:!1}):this._cachedChunks.push(g.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const v of this._requests)v.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(g){this._storedError=(0,r.createResponseStatusError)(g,this._url),this._headersReceivedCapability.reject(this._storedError);for(const v of this._requests)v.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(g){this.onProgress?.({loaded:g.loaded,total:g.lengthComputable?g.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const g=(0,n.createPromiseCapability)();return this._requests.push(g),g.promise}cancel(g){this._done=!0,this._headersReceivedCapability.reject(g);for(const v of this._requests)v.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class p{constructor(g,v,_){this._manager=g;const b={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=g.url,this._requestId=g.requestRange(v,_,b),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(g){const v=g.chunk;this._requests.length>0?this._requests.shift().resolve({value:v,done:!1}):this._queuedChunk=v,this._done=!0;for(const _ of this._requests)_.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(g){this._storedError=(0,r.createResponseStatusError)(g,this._url);for(const v of this._requests)v.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(g){this.isStreamingSupported||this.onProgress?.({loaded:g.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const v=this._queuedChunk;return this._queuedChunk=null,{value:v,done:!1}}if(this._done)return{value:void 0,done:!0};const g=(0,n.createPromiseCapability)();return this._requests.push(g),g.promise}cancel(g){this._done=!0;for(const v of this._requests)v.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFFetchStream=void 0;var n=t(1),r=t(22);function s(p,m,g){return{method:"GET",headers:p,signal:g.signal,mode:"cors",credentials:m?"include":"same-origin",redirect:"follow"}}function a(p){const m=new Headers;for(const g in p){const v=p[g];v!==void 0&&m.append(g,v)}return m}function l(p){return p instanceof Uint8Array?p.buffer:p instanceof ArrayBuffer?p:((0,n.warn)(`getArrayBuffer - unexpected data format: ${p}`),new Uint8Array(p).buffer)}class u{constructor(m){this.source=m,this.isHttp=/^https?:/i.test(m.url),this.httpHeaders=this.isHttp&&m.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new d(this),this._fullRequestReader}getRangeReader(m,g){if(g<=this._progressiveDataLength)return null;const v=new h(this,m,g);return this._rangeRequestReaders.push(v),v}cancelAllRequests(m){this._fullRequestReader?.cancel(m);for(const g of this._rangeRequestReaders.slice(0))g.cancel(m)}}e.PDFFetchStream=u;class d{constructor(m){this._stream=m,this._reader=null,this._loaded=0,this._filename=null;const g=m.source;this._withCredentials=g.withCredentials||!1,this._contentLength=g.length,this._headersCapability=(0,n.createPromiseCapability)(),this._disableRange=g.disableRange||!1,this._rangeChunkSize=g.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!g.disableStream,this._isRangeSupported=!g.disableRange,this._headers=a(this._stream.httpHeaders);const v=g.url;fetch(v,s(this._headers,this._withCredentials,this._abortController)).then(_=>{if(!(0,r.validateResponseStatus)(_.status))throw(0,r.createResponseStatusError)(_.status,v);this._reader=_.body.getReader(),this._headersCapability.resolve();const b=z=>_.headers.get(z),{allowRangeRequests:E,suggestedLength:A}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:b,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=E,this._contentLength=A||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(b),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:m,done:g}=await this._reader.read();return g?{value:m,done:g}:(this._loaded+=m.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:l(m),done:!1})}cancel(m){this._reader?.cancel(m),this._abortController.abort()}}class h{constructor(m,g,v){this._stream=m,this._reader=null,this._loaded=0;const _=m.source;this._withCredentials=_.withCredentials||!1,this._readCapability=(0,n.createPromiseCapability)(),this._isStreamingSupported=!_.disableStream,this._abortController=new AbortController,this._headers=a(this._stream.httpHeaders),this._headers.append("Range",`bytes=${g}-${v-1}`);const b=_.url;fetch(b,s(this._headers,this._withCredentials,this._abortController)).then(E=>{if(!(0,r.validateResponseStatus)(E.status))throw(0,r.createResponseStatusError)(E.status,b);this._readCapability.resolve(),this._reader=E.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:m,done:g}=await this._reader.read();return g?{value:m,done:g}:(this._loaded+=m.byteLength,this.onProgress?.({loaded:this._loaded}),{value:l(m),done:!1})}cancel(m){this._reader?.cancel(m),this._abortController.abort()}}}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextLayerRenderTask=void 0,e.renderTextLayer=_,e.updateTextLayer=b;var n=t(1),r=t(6);const s=1e5,a=30,l=.8,u=new Map;function d(E,A){let z;if(A&&n.FeatureTest.isOffscreenCanvasSupported)z=new OffscreenCanvas(E,E).getContext("2d",{alpha:!1});else{const D=document.createElement("canvas");D.width=D.height=E,z=D.getContext("2d",{alpha:!1})}return z}function h(E,A){const z=u.get(E);if(z)return z;const D=d(a,A);D.font=`${a}px ${E}`;const P=D.measureText("");let G=P.fontBoundingBoxAscent,R=Math.abs(P.fontBoundingBoxDescent);if(G){const w=G/(G+R);return u.set(E,w),D.canvas.width=D.canvas.height=0,w}D.strokeStyle="red",D.clearRect(0,0,a,a),D.strokeText("g",0,0);let I=D.getImageData(0,0,a,a).data;R=0;for(let w=I.length-1-3;w>=0;w-=4)if(I[w]>0){R=Math.ceil(w/4/a);break}D.clearRect(0,0,a,a),D.strokeText("A",0,a),I=D.getImageData(0,0,a,a).data,G=0;for(let w=0,H=I.length;w<H;w+=4)if(I[w]>0){G=a-Math.floor(w/4/a);break}if(D.canvas.width=D.canvas.height=0,G){const w=G/(G+R);return u.set(E,w),w}return u.set(E,l),l}function p(E,A,z){const D=document.createElement("span"),P={angle:0,canvasWidth:0,hasText:A.str!=="",hasEOL:A.hasEOL,fontSize:0};E._textDivs.push(D);const G=n.Util.transform(E._transform,A.transform);let R=Math.atan2(G[1],G[0]);const I=z[A.fontName];I.vertical&&(R+=Math.PI/2);const w=Math.hypot(G[2],G[3]),H=w*h(I.fontFamily,E._isOffscreenCanvasSupported);let V,te;R===0?(V=G[4],te=G[5]-H):(V=G[4]+H*Math.sin(R),te=G[5]-H*Math.cos(R));const ae="calc(var(--scale-factor)*",be=D.style;E._container===E._rootContainer?(be.left=`${(100*V/E._pageWidth).toFixed(2)}%`,be.top=`${(100*te/E._pageHeight).toFixed(2)}%`):(be.left=`${ae}${V.toFixed(2)}px)`,be.top=`${ae}${te.toFixed(2)}px)`),be.fontSize=`${ae}${w.toFixed(2)}px)`,be.fontFamily=I.fontFamily,P.fontSize=w,D.setAttribute("role","presentation"),D.textContent=A.str,D.dir=A.dir,E._fontInspectorEnabled&&(D.dataset.fontName=A.fontName),R!==0&&(P.angle=R*(180/Math.PI));let _e=!1;if(A.str.length>1)_e=!0;else if(A.str!==" "&&A.transform[0]!==A.transform[3]){const le=Math.abs(A.transform[0]),ue=Math.abs(A.transform[3]);le!==ue&&Math.max(le,ue)/Math.min(le,ue)>1.5&&(_e=!0)}_e&&(P.canvasWidth=I.vertical?A.height:A.width),E._textDivProperties.set(D,P),E._isReadableStream&&E._layoutText(D)}function m(E){const{div:A,scale:z,properties:D,ctx:P,prevFontSize:G,prevFontFamily:R}=E,{style:I}=A;let w="";if(D.canvasWidth!==0&&D.hasText){const{fontFamily:H}=I,{canvasWidth:V,fontSize:te}=D;(G!==te||R!==H)&&(P.font=`${te*z}px ${H}`,E.prevFontSize=te,E.prevFontFamily=H);const{width:ae}=P.measureText(A.textContent);ae>0&&(w=`scaleX(${V*z/ae})`)}D.angle!==0&&(w=`rotate(${D.angle}deg) ${w}`),w.length>0&&(I.transform=w)}function g(E){if(E._canceled)return;const A=E._textDivs,z=E._capability;if(A.length>s){z.resolve();return}if(!E._isReadableStream)for(const P of A)E._layoutText(P);z.resolve()}class v{constructor({textContentSource:A,container:z,viewport:D,textDivs:P,textDivProperties:G,textContentItemsStr:R,isOffscreenCanvasSupported:I}){this._textContentSource=A,this._isReadableStream=A instanceof ReadableStream,this._container=this._rootContainer=z,this._textDivs=P||[],this._textContentItemsStr=R||[],this._isOffscreenCanvasSupported=I,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=G||new WeakMap,this._canceled=!1,this._capability=(0,n.createPromiseCapability)(),this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:D.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:d(0,I)};const{pageWidth:w,pageHeight:H,pageX:V,pageY:te}=D.rawDims;this._transform=[1,0,0,-1,-V,te+H],this._pageWidth=w,this._pageHeight=H,(0,r.setLayerDimensions)(z,D),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new n.AbortException("TextLayer task cancelled."))}_processItems(A,z){for(const D of A){if(D.str===void 0){if(D.type==="beginMarkedContentProps"||D.type==="beginMarkedContent"){const P=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),D.id!==null&&this._container.setAttribute("id",`${D.id}`),P.append(this._container)}else D.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(D.str),p(this,D,z)}}_layoutText(A){const z=this._layoutTextParams.properties=this._textDivProperties.get(A);if(this._layoutTextParams.div=A,m(this._layoutTextParams),z.hasText&&this._container.append(A),z.hasEOL){const D=document.createElement("br");D.setAttribute("role","presentation"),this._container.append(D)}}_render(){const A=(0,n.createPromiseCapability)();let z=Object.create(null);if(this._isReadableStream){const D=()=>{this._reader.read().then(({value:P,done:G})=>{if(G){A.resolve();return}Object.assign(z,P.styles),this._processItems(P.items,z),D()},A.reject)};this._reader=this._textContentSource.getReader(),D()}else if(this._textContentSource){const{items:D,styles:P}=this._textContentSource;this._processItems(D,P),A.resolve()}else throw new Error('No "textContentSource" parameter specified.');A.promise.then(()=>{z=null,g(this)},this._capability.reject)}}e.TextLayerRenderTask=v;function _(E){!E.textContentSource&&(E.textContent||E.textContentStream)&&((0,r.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),E.textContentSource=E.textContent||E.textContentStream);const A=new v(E);return A._render(),A}function b({container:E,viewport:A,textDivs:z,textDivProperties:D,isOffscreenCanvasSupported:P,mustRotate:G=!0,mustRescale:R=!0}){if(G&&(0,r.setLayerDimensions)(E,{rotation:A.rotation}),R){const I=d(0,P),H={prevFontSize:null,prevFontFamily:null,div:null,scale:A.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:I};for(const V of z)H.properties=D.get(V),H.div=V,m(H)}}}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditorLayer=void 0;var n=t(1),r=t(5),s=t(28),a=t(29),l=t(6);class u{#e;#t=!1;#i=this.pointerup.bind(this);#n=this.pointerdown.bind(this);#r=new Map;#a=!1;#o=!1;#s;static _initialized=!1;constructor(h){u._initialized||(u._initialized=!0,s.FreeTextEditor.initialize(h.l10n),a.InkEditor.initialize(h.l10n)),h.uiManager.registerEditorTypes([s.FreeTextEditor,a.InkEditor]),this.#s=h.uiManager,this.pageIndex=h.pageIndex,this.div=h.div,this.#e=h.accessibilityManager,this.#s.addLayer(this)}get isEmpty(){return this.#r.size===0}updateToolbar(h){this.#s.updateToolbar(h)}updateMode(h=this.#s.getMode()){this.#d(),h===n.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),this.#s.unselectAll(),h!==n.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",h===n.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",h===n.AnnotationEditorType.INK),this.div.hidden=!1)}addInkEditorIfNeeded(h){if(!h&&this.#s.getMode()!==n.AnnotationEditorType.INK)return;if(!h){for(const m of this.#r.values())if(m.isEmpty()){m.setInBackground();return}}this.#h({offsetX:0,offsetY:0}).setInBackground()}setEditingState(h){this.#s.setEditingState(h)}addCommands(h){this.#s.addCommands(h)}enable(){this.div.style.pointerEvents="auto";for(const h of this.#r.values())h.enableEditing()}disable(){this.div.style.pointerEvents="none";for(const h of this.#r.values())h.disableEditing();this.#d(),this.isEmpty&&(this.div.hidden=!0)}setActiveEditor(h){this.#s.getActive()!==h&&this.#s.setActiveEditor(h)}enableClick(){this.div.addEventListener("pointerdown",this.#n),this.div.addEventListener("pointerup",this.#i)}disableClick(){this.div.removeEventListener("pointerdown",this.#n),this.div.removeEventListener("pointerup",this.#i)}attach(h){this.#r.set(h.id,h)}detach(h){this.#r.delete(h.id),this.#e?.removePointerInTextLayer(h.contentDiv)}remove(h){this.#s.removeEditor(h),this.detach(h),h.div.style.display="none",setTimeout(()=>{h.div.style.display="",h.div.remove(),h.isAttachedToDOM=!1,document.activeElement===document.body&&this.#s.focusMainContainer()},0),this.#o||this.addInkEditorIfNeeded(!1)}#l(h){h.parent!==this&&(this.attach(h),h.parent?.detach(h),h.setParent(this),h.div&&h.isAttachedToDOM&&(h.div.remove(),this.div.append(h.div)))}add(h){if(this.#l(h),this.#s.addEditor(h),this.attach(h),!h.isAttachedToDOM){const p=h.render();this.div.append(p),h.isAttachedToDOM=!0}this.moveEditorInDOM(h),h.onceAdded(),this.#s.addToAnnotationStorage(h)}moveEditorInDOM(h){this.#e?.moveElementInDOM(this.div,h.div,h.contentDiv,!0)}addOrRebuild(h){h.needsToBeRebuilt()?h.rebuild():this.add(h)}addANewEditor(h){const p=()=>{this.addOrRebuild(h)},m=()=>{h.remove()};this.addCommands({cmd:p,undo:m,mustExec:!0})}addUndoableEditor(h){const p=()=>{this.addOrRebuild(h)},m=()=>{h.remove()};this.addCommands({cmd:p,undo:m,mustExec:!1})}getNextId(){return this.#s.getId()}#c(h){switch(this.#s.getMode()){case n.AnnotationEditorType.FREETEXT:return new s.FreeTextEditor(h);case n.AnnotationEditorType.INK:return new a.InkEditor(h)}return null}deserialize(h){switch(h.annotationType){case n.AnnotationEditorType.FREETEXT:return s.FreeTextEditor.deserialize(h,this,this.#s);case n.AnnotationEditorType.INK:return a.InkEditor.deserialize(h,this,this.#s)}return null}#h(h){const p=this.getNextId(),m=this.#c({parent:this,id:p,x:h.offsetX,y:h.offsetY,uiManager:this.#s});return m&&this.add(m),m}setSelected(h){this.#s.setSelected(h)}toggleSelected(h){this.#s.toggleSelected(h)}isSelected(h){return this.#s.isSelected(h)}unselect(h){this.#s.unselect(h)}pointerup(h){const{isMac:p}=n.FeatureTest.platform;if(!(h.button!==0||h.ctrlKey&&p)&&h.target===this.div&&this.#a){if(this.#a=!1,!this.#t){this.#t=!0;return}this.#h(h)}}pointerdown(h){const{isMac:p}=n.FeatureTest.platform;if(h.button!==0||h.ctrlKey&&p||h.target!==this.div)return;this.#a=!0;const m=this.#s.getActive();this.#t=!m||m.isEmpty()}drop(h){const p=h.dataTransfer.getData("text/plain"),m=this.#s.getEditor(p);if(!m)return;h.preventDefault(),h.dataTransfer.dropEffect="move",this.#l(m);const g=this.div.getBoundingClientRect(),v=h.clientX-g.x,_=h.clientY-g.y;m.translate(v-m.startX,_-m.startY),this.moveEditorInDOM(m),m.div.focus()}dragover(h){h.preventDefault()}destroy(){this.#s.getActive()?.parent===this&&this.#s.setActiveEditor(null);for(const h of this.#r.values())this.#e?.removePointerInTextLayer(h.contentDiv),h.setParent(null),h.isAttachedToDOM=!1,h.div.remove();this.div=null,this.#r.clear(),this.#s.removeLayer(this)}#d(){this.#o=!0;for(const h of this.#r.values())h.isEmpty()&&h.remove();this.#o=!1}render({viewport:h}){this.viewport=h,(0,l.setLayerDimensions)(this.div,h),(0,r.bindEvents)(this,this.div,["dragover","drop"]);for(const p of this.#s.getEditors(this.pageIndex))this.add(p);this.updateMode()}update({viewport:h}){this.#s.commitOrRemove(),this.viewport=h,(0,l.setLayerDimensions)(this.div,{rotation:h.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:h,pageHeight:p}=this.viewport.rawDims;return[h,p]}}e.AnnotationEditorLayer=u}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FreeTextEditor=void 0;var n=t(1),r=t(5),s=t(4);class a extends s.AnnotationEditor{#e=this.editorDivBlur.bind(this);#t=this.editorDivFocus.bind(this);#i=this.editorDivInput.bind(this);#n=this.editorDivKeydown.bind(this);#r;#a="";#o=`${this.id}-editor`;#s=!1;#l;static _freeTextDefaultContent="";static _l10nPromise;static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static _keyboardManager=new r.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],a.prototype.commitOrRemove]]);static _type="freetext";constructor(u){super({...u,name:"freeTextEditor"}),this.#r=u.color||a._defaultColor||s.AnnotationEditor._defaultLineColor,this.#l=u.fontSize||a._defaultFontSize}static initialize(u){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map(h=>[h,u.get(h)]));const d=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(d.getPropertyValue("--freetext-padding"))}static updateDefaultParams(u,d){switch(u){case n.AnnotationEditorParamsType.FREETEXT_SIZE:a._defaultFontSize=d;break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:a._defaultColor=d;break}}updateParams(u,d){switch(u){case n.AnnotationEditorParamsType.FREETEXT_SIZE:this.#c(d);break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:this.#h(d);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,a._defaultFontSize],[n.AnnotationEditorParamsType.FREETEXT_COLOR,a._defaultColor||s.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,this.#l],[n.AnnotationEditorParamsType.FREETEXT_COLOR,this.#r]]}#c(u){const d=p=>{this.editorDiv.style.fontSize=`calc(${p}px * var(--scale-factor))`,this.translate(0,-(p-this.#l)*this.parentScale),this.#l=p,this.#f()},h=this.#l;this.addCommands({cmd:()=>{d(u)},undo:()=>{d(h)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#h(u){const d=this.#r;this.addCommands({cmd:()=>{this.#r=this.editorDiv.style.color=u},undo:()=>{this.#r=this.editorDiv.style.color=d},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}getInitialTranslation(){const u=this.parentScale;return[-a._internalPadding*u,-(a._internalPadding+this.#l)*u]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(n.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#n),this.editorDiv.addEventListener("focus",this.#t),this.editorDiv.addEventListener("blur",this.#e),this.editorDiv.addEventListener("input",this.#i))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#o),this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",this.#n),this.editorDiv.removeEventListener("focus",this.#t),this.editorDiv.removeEventListener("blur",this.#e),this.editorDiv.removeEventListener("input",this.#i),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(u){super.focusin(u),u.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing"),super.remove()}#d(){const u=this.editorDiv.getElementsByTagName("div");if(u.length===0)return this.editorDiv.innerText;const d=[];for(const h of u)d.push(h.innerText.replace(/\r\n?|\n/,""));return d.join(`
`)}#f(){const[u,d]=this.parentDimensions;let h;if(this.isAttachedToDOM)h=this.div.getBoundingClientRect();else{const{currentLayer:p,div:m}=this,g=m.style.display;m.style.display="hidden",p.div.append(this.div),h=m.getBoundingClientRect(),m.remove(),m.style.display=g}this.width=h.width/u,this.height=h.height/d}commit(){this.isInEditMode()&&(super.commit(),this.#s||(this.#s=!0,this.parent.addUndoableEditor(this)),this.disableEditMode(),this.#a=this.#d().trimEnd(),this.#f())}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(u){this.enableEditMode(),this.editorDiv.focus()}keydown(u){u.target===this.div&&u.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(u){a._keyboardManager.exec(this,u)}editorDivFocus(u){this.isEditing=!0}editorDivBlur(u){this.isEditing=!1}editorDivInput(u){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let u,d;this.width&&(u=this.x,d=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#o),this.enableEditing(),a._l10nPromise.get("editor_free_text2_aria_label").then(p=>this.editorDiv?.setAttribute("aria-label",p)),a._l10nPromise.get("free_text2_default_content").then(p=>this.editorDiv?.setAttribute("default-content",p)),this.editorDiv.contentEditable=!0;const{style:h}=this.editorDiv;if(h.fontSize=`calc(${this.#l}px * var(--scale-factor))`,h.color=this.#r,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,r.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[p,m]=this.parentDimensions;this.setAt(u*p,d*m,this.width*p,this.height*m);for(const g of this.#a.split(`
`)){const v=document.createElement("div");v.append(g?document.createTextNode(g):document.createElement("br")),this.editorDiv.append(v)}this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(u,d,h){const p=super.deserialize(u,d,h);return p.#l=u.fontSize,p.#r=n.Util.makeHexColor(...u.color),p.#a=u.value,p}serialize(){if(this.isEmpty())return null;const u=a._internalPadding*this.parentScale,d=this.getRect(u,u),h=s.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#r);return{annotationType:n.AnnotationEditorType.FREETEXT,color:h,fontSize:this.#l,value:this.#a,pageIndex:this.pageIndex,rect:d,rotation:this.rotation}}}e.FreeTextEditor=a}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InkEditor=void 0,Object.defineProperty(e,"fitCurve",{enumerable:!0,get:function(){return s.fitCurve}});var n=t(1),r=t(4),s=t(30),a=t(5);const l=16,u=100;class d extends r.AnnotationEditor{#e=0;#t=0;#i=0;#n=this.canvasPointermove.bind(this);#r=this.canvasPointerleave.bind(this);#a=this.canvasPointerup.bind(this);#o=this.canvasPointerdown.bind(this);#s=!1;#l=!1;#c=null;#h=null;#d=0;#f=0;#g=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _l10nPromise;static _type="ink";constructor(p){super({...p,name:"inkEditor"}),this.color=p.color||null,this.thickness=p.thickness||null,this.opacity=p.opacity||null,this.paths=[],this.bezierPath2D=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(p){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map(m=>[m,p.get(m)]))}static updateDefaultParams(p,m){switch(p){case n.AnnotationEditorParamsType.INK_THICKNESS:d._defaultThickness=m;break;case n.AnnotationEditorParamsType.INK_COLOR:d._defaultColor=m;break;case n.AnnotationEditorParamsType.INK_OPACITY:d._defaultOpacity=m/100;break}}updateParams(p,m){switch(p){case n.AnnotationEditorParamsType.INK_THICKNESS:this.#p(m);break;case n.AnnotationEditorParamsType.INK_COLOR:this.#u(m);break;case n.AnnotationEditorParamsType.INK_OPACITY:this.#m(m);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,d._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,d._defaultColor||r.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(d._defaultOpacity*100)]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||d._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,this.color||d._defaultColor||r.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??d._defaultOpacity))]]}#p(p){const m=this.thickness;this.addCommands({cmd:()=>{this.thickness=p,this.#C()},undo:()=>{this.thickness=m,this.#C()},mustExec:!0,type:n.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#u(p){const m=this.color;this.addCommands({cmd:()=>{this.color=p,this.#_()},undo:()=>{this.color=m,this.#_()},mustExec:!0,type:n.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#m(p){p/=100;const m=this.opacity;this.addCommands({cmd:()=>{this.opacity=p,this.#_()},undo:()=>{this.opacity=m,this.#_()},mustExec:!0,type:n.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(this.#E(),this.#A()),this.isAttachedToDOM||(this.parent.add(this),this.#I()),this.#C())}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#h.disconnect(),this.#h=null,super.remove())}setParent(p){!this.parent&&p?this._uiManager.removeShouldRescale(this):this.parent&&p===null&&this._uiManager.addShouldRescale(this),super.setParent(p)}onScaleChanging(){const[p,m]=this.parentDimensions,g=this.width*p,v=this.height*m;this.setDimensions(g,v)}enableEditMode(){this.#s||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",this.#o),this.canvas.addEventListener("pointerup",this.#a))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#o),this.canvas.removeEventListener("pointerup",this.#a))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#y(){const{parentRotation:p,parentDimensions:[m,g]}=this;switch(p){case 90:return[0,g,g,m];case 180:return[m,g,m,g];case 270:return[m,0,g,m];default:return[0,0,m,g]}}#b(){const{ctx:p,color:m,opacity:g,thickness:v,parentScale:_,scaleFactor:b}=this;p.lineWidth=v*_/b,p.lineCap="round",p.lineJoin="round",p.miterLimit=10,p.strokeStyle=`${m}${(0,a.opacityToHex)(g)}`}#v(p,m){this.isEditing=!0,this.#l||(this.#l=!0,this.#I(),this.thickness||=d._defaultThickness,this.color||=d._defaultColor||r.AnnotationEditor._defaultLineColor,this.opacity??=d._defaultOpacity),this.currentPath.push([p,m]),this.#c=null,this.#b(),this.ctx.beginPath(),this.ctx.moveTo(p,m),this.#g=()=>{this.#g&&(this.#c&&(this.isEmpty()?(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)):this.#_(),this.ctx.lineTo(...this.#c),this.#c=null,this.ctx.stroke()),window.requestAnimationFrame(this.#g))},window.requestAnimationFrame(this.#g)}#w(p,m){const[g,v]=this.currentPath.at(-1);p===g&&m===v||(this.currentPath.push([p,m]),this.#c=[p,m])}#x(p,m){this.ctx.closePath(),this.#g=null,p=Math.min(Math.max(p,0),this.canvas.width),m=Math.min(Math.max(m,0),this.canvas.height);const[g,v]=this.currentPath.at(-1);(p!==g||m!==v)&&this.currentPath.push([p,m]);let _;if(this.currentPath.length!==1)_=(0,s.fitCurve)(this.currentPath,30,null);else{const z=[p,m];_=[[z,z.slice(),z.slice(),z]]}const b=d.#L(_);this.currentPath.length=0;const E=()=>{this.paths.push(_),this.bezierPath2D.push(b),this.rebuild()},A=()=>{this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#E(),this.#A()),this.#C())};this.addCommands({cmd:E,undo:A,mustExec:!0})}#_(){if(this.isEmpty()){this.#R();return}this.#b();const{canvas:p,ctx:m}=this;m.setTransform(1,0,0,1,0,0),m.clearRect(0,0,p.width,p.height),this.#R();for(const g of this.bezierPath2D)m.stroke(g)}commit(){this.#s||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#s=!0,this.div.classList.add("disabled"),this.#C(!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus({preventScroll:!0}))}focusin(p){super.focusin(p),this.enableEditMode()}canvasPointerdown(p){p.button!==0||!this.isInEditMode()||this.#s||(this.setInForeground(),p.type!=="mouse"&&this.div.focus(),p.stopPropagation(),this.canvas.addEventListener("pointerleave",this.#r),this.canvas.addEventListener("pointermove",this.#n),this.#v(p.offsetX,p.offsetY))}canvasPointermove(p){p.stopPropagation(),this.#w(p.offsetX,p.offsetY)}canvasPointerup(p){p.button===0&&this.isInEditMode()&&this.currentPath.length!==0&&(p.stopPropagation(),this.#P(p),this.setInBackground())}canvasPointerleave(p){this.#P(p),this.setInBackground()}#P(p){this.#x(p.offsetX,p.offsetY),this.canvas.removeEventListener("pointerleave",this.#r),this.canvas.removeEventListener("pointermove",this.#n),this.addToAnnotationStorage()}#E(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",d._l10nPromise.get("editor_ink_canvas_aria_label").then(p=>this.canvas?.setAttribute("aria-label",p)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#A(){let p=null;this.#h=new ResizeObserver(m=>{const g=m[0].contentRect;g.width&&g.height&&(p!==null&&clearTimeout(p),p=setTimeout(()=>{this.fixDims(),p=null},u),this.setDimensions(g.width,g.height))}),this.#h.observe(this.div)}render(){if(this.div)return this.div;let p,m;this.width&&(p=this.x,m=this.y),super.render(),d._l10nPromise.get("editor_ink2_aria_label").then(E=>this.div?.setAttribute("aria-label",E));const[g,v,_,b]=this.#y();if(this.setAt(g,v,0,0),this.setDims(_,b),this.#E(),this.width){const[E,A]=this.parentDimensions;this.setAt(p*E,m*A,this.width*E,this.height*A),this.#l=!0,this.#I(),this.setDims(this.width*E,this.height*A),this.#_(),this.#T(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#A(),this.div}#I(){if(!this.#l)return;const[p,m]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*p),this.canvas.height=Math.ceil(this.height*m),this.#R()}setDimensions(p,m){const g=Math.round(p),v=Math.round(m);if(this.#d===g&&this.#f===v)return;this.#d=g,this.#f=v,this.canvas.style.visibility="hidden",this.#e&&Math.abs(this.#e-p/m)>.01&&(m=Math.ceil(p/this.#e),this.setDims(p,m));const[_,b]=this.parentDimensions;this.width=p/_,this.height=m/b,this.#s&&this.#S(p,m),this.#I(),this.#_(),this.canvas.style.visibility="visible"}#S(p,m){const g=this.#B(),v=(p-g)/this.#i,_=(m-g)/this.#t;this.scaleFactor=Math.min(v,_)}#R(){const p=this.#B()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+p,this.translationY*this.scaleFactor+p)}static#L(p){const m=new Path2D;for(let g=0,v=p.length;g<v;g++){const[_,b,E,A]=p[g];g===0&&m.moveTo(..._),m.bezierCurveTo(b[0],b[1],E[0],E[1],A[0],A[1])}return m}#M(p,m,g,v){const b=[],E=this.thickness/2;let A,z;for(const D of this.paths){A=[],z=[];for(let P=0,G=D.length;P<G;P++){const[R,I,w,H]=D[P],V=p*(R[0]+m)+E,te=v-p*(R[1]+g)-E,ae=p*(I[0]+m)+E,be=v-p*(I[1]+g)-E,_e=p*(w[0]+m)+E,le=v-p*(w[1]+g)-E,ue=p*(H[0]+m)+E,oe=v-p*(H[1]+g)-E;P===0&&(A.push(V,te),z.push(V,te)),A.push(ae,be,_e,le,ue,oe),this.#N(V,te,ae,be,_e,le,ue,oe,4,z)}b.push({bezier:A,points:z})}return b}#N(p,m,g,v,_,b,E,A,z,D){if(this.#D(p,m,g,v,_,b,E,A)){D.push(E,A);return}for(let P=1;P<z-1;P++){const G=P/z,R=1-G;let I=G*p+R*g,w=G*m+R*v,H=G*g+R*_,V=G*v+R*b;const te=G*_+R*E,ae=G*b+R*A;I=G*I+R*H,w=G*w+R*V,H=G*H+R*te,V=G*V+R*ae,I=G*I+R*H,w=G*w+R*V,D.push(I,w)}D.push(E,A)}#D(p,m,g,v,_,b,E,A){const D=(3*g-2*p-E)**2,P=(3*v-2*m-A)**2,G=(3*_-p-2*E)**2,R=(3*b-m-2*A)**2;return Math.max(D,G)+Math.max(P,R)<=10}#k(){let p=1/0,m=-1/0,g=1/0,v=-1/0;for(const _ of this.paths)for(const[b,E,A,z]of _){const D=n.Util.bezierBoundingBox(...b,...E,...A,...z);p=Math.min(p,D[0]),g=Math.min(g,D[1]),m=Math.max(m,D[2]),v=Math.max(v,D[3])}return[p,g,m,v]}#B(){return this.#s?Math.ceil(this.thickness*this.parentScale):0}#C(p=!1){if(this.isEmpty())return;if(!this.#s){this.#_();return}const m=this.#k(),g=this.#B();this.#i=Math.max(l,m[2]-m[0]),this.#t=Math.max(l,m[3]-m[1]);const v=Math.ceil(g+this.#i*this.scaleFactor),_=Math.ceil(g+this.#t*this.scaleFactor),[b,E]=this.parentDimensions;this.width=v/b,this.height=_/E,this.#e=v/_,this.#T();const A=this.translationX,z=this.translationY;this.translationX=-m[0],this.translationY=-m[1],this.#I(),this.#_(),this.#d=v,this.#f=_,this.setDims(v,_);const D=p?g/this.scaleFactor/2:0;this.translate(A-this.translationX-D,z-this.translationY-D)}#T(){const{style:p}=this.div;this.#e>=1?(p.minHeight=`${l}px`,p.minWidth=`${Math.round(this.#e*l)}px`):(p.minWidth=`${l}px`,p.minHeight=`${Math.round(l/this.#e)}px`)}static deserialize(p,m,g){const v=super.deserialize(p,m,g);v.thickness=p.thickness,v.color=n.Util.makeHexColor(...p.color),v.opacity=p.opacity;const[_,b]=v.pageDimensions,E=v.width*_,A=v.height*b,z=v.parentScale,D=p.thickness/2;v.#e=E/A,v.#s=!0,v.#d=Math.round(E),v.#f=Math.round(A);for(const{bezier:G}of p.paths){const R=[];v.paths.push(R);let I=z*(G[0]-D),w=z*(A-G[1]-D);for(let V=2,te=G.length;V<te;V+=6){const ae=z*(G[V]-D),be=z*(A-G[V+1]-D),_e=z*(G[V+2]-D),le=z*(A-G[V+3]-D),ue=z*(G[V+4]-D),oe=z*(A-G[V+5]-D);R.push([[I,w],[ae,be],[_e,le],[ue,oe]]),I=ue,w=oe}const H=this.#L(R);v.bezierPath2D.push(H)}const P=v.#k();return v.#i=Math.max(l,P[2]-P[0]),v.#t=Math.max(l,P[3]-P[1]),v.#S(E,A),v}serialize(){if(this.isEmpty())return null;const p=this.getRect(0,0),m=this.rotation%180===0?p[3]-p[1]:p[2]-p[0],g=r.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:n.AnnotationEditorType.INK,color:g,thickness:this.thickness,opacity:this.opacity,paths:this.#M(this.scaleFactor/this.parentScale,this.translationX,this.translationY,m),pageIndex:this.pageIndex,rect:p,rotation:this.rotation}}}e.InkEditor=d}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.fitCurve=void 0;const n=t(31);e.fitCurve=n}),(i=>{function e(v,_,b){if(!Array.isArray(v))throw new TypeError("First argument should be an array");if(v.forEach(D=>{if(!Array.isArray(D)||D.some(P=>typeof P!="number")||D.length!==v[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),v=v.filter((D,P)=>P===0||!D.every((G,R)=>G===v[P-1][R])),v.length<2)return[];const E=v.length,A=p(v[1],v[0]),z=p(v[E-2],v[E-1]);return t(v,A,z,_,b)}function t(v,_,b,E,A){var D,P,G,R,I,w,H,V,te,ae,be,_e,le;if(v.length===2)return _e=m.vectorLen(m.subtract(v[0],v[1]))/3,D=[v[0],m.addArrays(v[0],m.mulItems(_,_e)),m.addArrays(v[1],m.mulItems(b,_e)),v[1]],[D];if(P=l(v),[D,R,w]=n(v,P,P,_,b,A),R===0||R<E)return[D];if(R<E*E)for(G=P,I=R,H=w,le=0;le<20;le++){if(G=s(D,v,G),[D,R,w]=n(v,P,G,_,b,A),R<E)return[D];if(w===H){let ue=R/I;if(ue>.9999&&ue<1.0001)break}I=R,H=w}return be=[],V=m.subtract(v[w-1],v[w+1]),V.every(ue=>ue===0)&&(V=m.subtract(v[w-1],v[w]),[V[0],V[1]]=[-V[1],V[0]]),te=m.normalize(V),ae=m.mulItems(te,-1),be=be.concat(t(v.slice(0,w+1),_,te,E,A)),be=be.concat(t(v.slice(w),ae,b,E,A)),be}function n(v,_,b,E,A,z){var D,P,G;return D=r(v,b,E,A),[P,G]=u(v,D,_),z&&z({bez:D,points:v,params:_,maxErr:P,maxPoint:G}),[D,P,G]}function r(v,_,b,E){var A,z,D,P,G,R,I,w,H,V,te,ae,be,_e,le,ue,oe,ee=v[0],se=v[v.length-1];for(A=[ee,null,null,se],z=m.zeros_Xx2x2(_.length),be=0,_e=_.length;be<_e;be++)ue=_[be],oe=1-ue,D=z[be],D[0]=m.mulItems(b,3*ue*(oe*oe)),D[1]=m.mulItems(E,3*oe*(ue*ue));for(P=[[0,0],[0,0]],G=[0,0],be=0,_e=v.length;be<_e;be++)ue=_[be],D=z[be],P[0][0]+=m.dot(D[0],D[0]),P[0][1]+=m.dot(D[0],D[1]),P[1][0]+=m.dot(D[0],D[1]),P[1][1]+=m.dot(D[1],D[1]),le=m.subtract(v[be],g.q([ee,ee,se,se],ue)),G[0]+=m.dot(D[0],le),G[1]+=m.dot(D[1],le);return R=P[0][0]*P[1][1]-P[1][0]*P[0][1],I=P[0][0]*G[1]-P[1][0]*G[0],w=G[0]*P[1][1]-G[1]*P[0][1],H=R===0?0:w/R,V=R===0?0:I/R,ae=m.vectorLen(m.subtract(ee,se)),te=1e-6*ae,H<te||V<te?(A[1]=m.addArrays(ee,m.mulItems(b,ae/3)),A[2]=m.addArrays(se,m.mulItems(E,ae/3))):(A[1]=m.addArrays(ee,m.mulItems(b,H)),A[2]=m.addArrays(se,m.mulItems(E,V))),A}function s(v,_,b){return b.map((E,A)=>a(v,_[A],E))}function a(v,_,b){var E=m.subtract(g.q(v,b),_),A=g.qprime(v,b),z=m.mulMatrix(E,A),D=m.sum(m.squareItems(A))+2*m.mulMatrix(E,g.qprimeprime(v,b));return D===0?b:b-z/D}function l(v){var _=[],b,E,A;return v.forEach((z,D)=>{b=D?E+m.vectorLen(m.subtract(z,A)):0,_.push(b),E=b,A=z}),_=_.map(z=>z/E),_}function u(v,_,b){var E,A,z,D,P,G,R,I;A=0,z=Math.floor(v.length/2);const w=d(_,10);for(P=0,G=v.length;P<G;P++)R=v[P],I=h(_,b[P],w,10),D=m.subtract(g.q(_,I),R),E=D[0]*D[0]+D[1]*D[1],E>A&&(A=E,z=P);return[A,z]}var d=function(v,_){for(var b,E=[0],A=v[0],z=0,D=1;D<=_;D++)b=g.q(v,D/_),z+=m.vectorLen(m.subtract(b,A)),E.push(z),A=b;return E=E.map(P=>P/z),E};function h(v,_,b,E){if(_<0)return 0;if(_>1)return 1;for(var A,z,D,P,G,R=1;R<=E;R++)if(_<=b[R]){P=(R-1)/E,D=R/E,z=b[R-1],A=b[R],G=(_-z)/(A-z)*(D-P)+P;break}return G}function p(v,_){return m.normalize(m.subtract(v,_))}class m{static zeros_Xx2x2(_){for(var b=[];_--;)b.push([0,0]);return b}static mulItems(_,b){return _.map(E=>E*b)}static mulMatrix(_,b){return _.reduce((E,A,z)=>E+A*b[z],0)}static subtract(_,b){return _.map((E,A)=>E-b[A])}static addArrays(_,b){return _.map((E,A)=>E+b[A])}static addItems(_,b){return _.map(E=>E+b)}static sum(_){return _.reduce((b,E)=>b+E)}static dot(_,b){return m.mulMatrix(_,b)}static vectorLen(_){return Math.hypot(..._)}static divItems(_,b){return _.map(E=>E/b)}static squareItems(_){return _.map(b=>b*b)}static normalize(_){return this.divItems(_,this.vectorLen(_))}}class g{static q(_,b){var E=1-b,A=m.mulItems(_[0],E*E*E),z=m.mulItems(_[1],3*E*E*b),D=m.mulItems(_[2],3*E*b*b),P=m.mulItems(_[3],b*b*b);return m.addArrays(m.addArrays(A,z),m.addArrays(D,P))}static qprime(_,b){var E=1-b,A=m.mulItems(m.subtract(_[1],_[0]),3*E*E),z=m.mulItems(m.subtract(_[2],_[1]),6*E*b),D=m.mulItems(m.subtract(_[3],_[2]),3*b*b);return m.addArrays(m.addArrays(A,z),D)}static qprimeprime(_,b){return m.addArrays(m.mulItems(m.addArrays(m.subtract(_[2],m.mulItems(_[1],2)),_[0]),6*(1-b)),m.mulItems(m.addArrays(m.subtract(_[3],m.mulItems(_[2],2)),_[1]),6*b))}}i.exports=e,i.exports.fitCubic=t,i.exports.createTangent=p}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationLayer=void 0;var n=t(1),r=t(6),s=t(3),a=t(33),l=t(34);const u=1e3,d=9,h=new WeakSet;function p(pe){return{width:pe[2]-pe[0],height:pe[3]-pe[1]}}class m{static create(Z){switch(Z.data.annotationType){case n.AnnotationType.LINK:return new v(Z);case n.AnnotationType.TEXT:return new _(Z);case n.AnnotationType.WIDGET:switch(Z.data.fieldType){case"Tx":return new E(Z);case"Btn":return Z.data.radioButton?new z(Z):Z.data.checkBox?new A(Z):new D(Z);case"Ch":return new P(Z)}return new b(Z);case n.AnnotationType.POPUP:return new G(Z);case n.AnnotationType.FREETEXT:return new I(Z);case n.AnnotationType.LINE:return new w(Z);case n.AnnotationType.SQUARE:return new H(Z);case n.AnnotationType.CIRCLE:return new V(Z);case n.AnnotationType.POLYLINE:return new te(Z);case n.AnnotationType.CARET:return new be(Z);case n.AnnotationType.INK:return new _e(Z);case n.AnnotationType.POLYGON:return new ae(Z);case n.AnnotationType.HIGHLIGHT:return new le(Z);case n.AnnotationType.UNDERLINE:return new ue(Z);case n.AnnotationType.SQUIGGLY:return new oe(Z);case n.AnnotationType.STRIKEOUT:return new ee(Z);case n.AnnotationType.STAMP:return new se(Z);case n.AnnotationType.FILEATTACHMENT:return new re(Z);default:return new g(Z)}}}class g{constructor(Z,{isRenderable:ce=!1,ignoreBorder:Ee=!1,createQuadrilaterals:Te=!1}={}){this.isRenderable=ce,this.data=Z.data,this.layer=Z.layer,this.page=Z.page,this.viewport=Z.viewport,this.linkService=Z.linkService,this.downloadManager=Z.downloadManager,this.imageResourcesPath=Z.imageResourcesPath,this.renderForms=Z.renderForms,this.svgFactory=Z.svgFactory,this.annotationStorage=Z.annotationStorage,this.enableScripting=Z.enableScripting,this.hasJSActions=Z.hasJSActions,this._fieldObjects=Z.fieldObjects,ce&&(this.container=this._createContainer(Ee)),Te&&(this.quadrilaterals=this._createQuadrilaterals(Ee))}_createContainer(Z=!1){const{data:ce,page:Ee,viewport:Te}=this,Ae=document.createElement("section");Ae.setAttribute("data-annotation-id",ce.id);const{pageWidth:Pe,pageHeight:Me,pageX:We,pageY:qe}=Te.rawDims,{width:Je,height:wt}=p(ce.rect),rt=n.Util.normalizeRect([ce.rect[0],Ee.view[3]-ce.rect[1]+Ee.view[1],ce.rect[2],Ee.view[3]-ce.rect[3]+Ee.view[1]]);if(!Z&&ce.borderStyle.width>0){Ae.style.borderWidth=`${ce.borderStyle.width}px`;const ln=ce.borderStyle.horizontalCornerRadius,dt=ce.borderStyle.verticalCornerRadius;if(ln>0||dt>0){const nt=`calc(${ln}px * var(--scale-factor)) / calc(${dt}px * var(--scale-factor))`;Ae.style.borderRadius=nt}else if(this instanceof z){const nt=`calc(${Je}px * var(--scale-factor)) / calc(${wt}px * var(--scale-factor))`;Ae.style.borderRadius=nt}switch(ce.borderStyle.style){case n.AnnotationBorderStyleType.SOLID:Ae.style.borderStyle="solid";break;case n.AnnotationBorderStyleType.DASHED:Ae.style.borderStyle="dashed";break;case n.AnnotationBorderStyleType.BEVELED:(0,n.warn)("Unimplemented border style: beveled");break;case n.AnnotationBorderStyleType.INSET:(0,n.warn)("Unimplemented border style: inset");break;case n.AnnotationBorderStyleType.UNDERLINE:Ae.style.borderBottomStyle="solid";break}const st=ce.borderColor||null;st?Ae.style.borderColor=n.Util.makeHexColor(st[0]|0,st[1]|0,st[2]|0):Ae.style.borderWidth=0}Ae.style.left=`${100*(rt[0]-We)/Pe}%`,Ae.style.top=`${100*(rt[1]-qe)/Me}%`;const{rotation:Lt}=ce;return ce.hasOwnCanvas||Lt===0?(Ae.style.width=`${100*Je/Pe}%`,Ae.style.height=`${100*wt/Me}%`):this.setRotation(Lt,Ae),Ae}setRotation(Z,ce=this.container){const{pageWidth:Ee,pageHeight:Te}=this.viewport.rawDims,{width:Ae,height:Pe}=p(this.data.rect);let Me,We;Z%180===0?(Me=100*Ae/Ee,We=100*Pe/Te):(Me=100*Pe/Ee,We=100*Ae/Te),ce.style.width=`${Me}%`,ce.style.height=`${We}%`,ce.setAttribute("data-main-rotation",(360-Z)%360)}get _commonActions(){const Z=(ce,Ee,Te)=>{const Ae=Te.detail[ce];Te.target.style[Ee]=a.ColorConverters[`${Ae[0]}_HTML`](Ae.slice(1))};return(0,n.shadow)(this,"_commonActions",{display:ce=>{const Ee=ce.detail.display%2===1;this.container.style.visibility=Ee?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:Ee,print:ce.detail.display===0||ce.detail.display===3})},print:ce=>{this.annotationStorage.setValue(this.data.id,{print:ce.detail.print})},hidden:ce=>{this.container.style.visibility=ce.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:ce.detail.hidden})},focus:ce=>{setTimeout(()=>ce.target.focus({preventScroll:!1}),0)},userName:ce=>{ce.target.title=ce.detail.userName},readonly:ce=>{ce.detail.readonly?ce.target.setAttribute("readonly",""):ce.target.removeAttribute("readonly")},required:ce=>{this._setRequired(ce.target,ce.detail.required)},bgColor:ce=>{Z("bgColor","backgroundColor",ce)},fillColor:ce=>{Z("fillColor","backgroundColor",ce)},fgColor:ce=>{Z("fgColor","color",ce)},textColor:ce=>{Z("textColor","color",ce)},borderColor:ce=>{Z("borderColor","borderColor",ce)},strokeColor:ce=>{Z("strokeColor","borderColor",ce)},rotation:ce=>{const Ee=ce.detail.rotation;this.setRotation(Ee),this.annotationStorage.setValue(this.data.id,{rotation:Ee})}})}_dispatchEventFromSandbox(Z,ce){const Ee=this._commonActions;for(const Te of Object.keys(ce.detail))(Z[Te]||Ee[Te])?.(ce)}_setDefaultPropertiesFromJS(Z){if(!this.enableScripting)return;const ce=this.annotationStorage.getRawValue(this.data.id);if(!ce)return;const Ee=this._commonActions;for(const[Te,Ae]of Object.entries(ce)){const Pe=Ee[Te];if(Pe){const Me={detail:{[Te]:Ae},target:Z};Pe(Me),delete ce[Te]}}}_createQuadrilaterals(Z=!1){if(!this.data.quadPoints)return null;const ce=[],Ee=this.data.rect;for(const Te of this.data.quadPoints)this.data.rect=[Te[2].x,Te[2].y,Te[1].x,Te[1].y],ce.push(this._createContainer(Z));return this.data.rect=Ee,ce}_createPopup(Z,ce){let Ee=this.container;this.quadrilaterals&&(Z=Z||this.quadrilaterals,Ee=this.quadrilaterals[0]),Z||(Z=document.createElement("div"),Z.className="popupTriggerArea",Ee.append(Z));const Ae=new R({container:Ee,trigger:Z,color:ce.color,titleObj:ce.titleObj,modificationDate:ce.modificationDate,contentsObj:ce.contentsObj,richText:ce.richText,hideWrapper:!0}).render();Ae.style.left="100%",Ee.append(Ae)}_renderQuadrilaterals(Z){for(const ce of this.quadrilaterals)ce.className=Z;return this.quadrilaterals}render(){(0,n.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(Z,ce=null){const Ee=[];if(this._fieldObjects){const Te=this._fieldObjects[Z];if(Te)for(const{page:Ae,id:Pe,exportValues:Me}of Te){if(Ae===-1||Pe===ce)continue;const We=typeof Me=="string"?Me:null,qe=document.querySelector(`[data-element-id="${Pe}"]`);if(qe&&!h.has(qe)){(0,n.warn)(`_getElementsByName - element not allowed: ${Pe}`);continue}Ee.push({id:Pe,exportValue:We,domElement:qe})}return Ee}for(const Te of document.getElementsByName(Z)){const{exportValue:Ae}=Te,Pe=Te.getAttribute("data-element-id");Pe!==ce&&h.has(Te)&&Ee.push({id:Pe,exportValue:Ae,domElement:Te})}return Ee}}class v extends g{constructor(Z,ce=null){super(Z,{isRenderable:!0,ignoreBorder:!!ce?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=Z.data.isTooltipOnly}render(){const{data:Z,linkService:ce}=this,Ee=document.createElement("a");Ee.setAttribute("data-element-id",Z.id);let Te=!1;return Z.url?(ce.addLinkAttributes(Ee,Z.url,Z.newWindow),Te=!0):Z.action?(this._bindNamedAction(Ee,Z.action),Te=!0):Z.attachment?(this._bindAttachment(Ee,Z.attachment),Te=!0):Z.setOCGState?(this.#t(Ee,Z.setOCGState),Te=!0):Z.dest?(this._bindLink(Ee,Z.dest),Te=!0):(Z.actions&&(Z.actions.Action||Z.actions["Mouse Up"]||Z.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(Ee,Z),Te=!0),Z.resetForm?(this._bindResetFormAction(Ee,Z.resetForm),Te=!0):this.isTooltipOnly&&!Te&&(this._bindLink(Ee,""),Te=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((Ae,Pe)=>{const Me=Pe===0?Ee:Ee.cloneNode();return Ae.append(Me),Ae}):(this.container.className="linkAnnotation",Te&&this.container.append(Ee),this.container)}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(Z,ce){Z.href=this.linkService.getDestinationHash(ce),Z.onclick=()=>(ce&&this.linkService.goToDestination(ce),!1),(ce||ce==="")&&this.#e()}_bindNamedAction(Z,ce){Z.href=this.linkService.getAnchorUrl(""),Z.onclick=()=>(this.linkService.executeNamedAction(ce),!1),this.#e()}_bindAttachment(Z,ce){Z.href=this.linkService.getAnchorUrl(""),Z.onclick=()=>(this.downloadManager?.openOrDownloadData(this.container,ce.content,ce.filename),!1),this.#e()}#t(Z,ce){Z.href=this.linkService.getAnchorUrl(""),Z.onclick=()=>(this.linkService.executeSetOCGState(ce),!1),this.#e()}_bindJSAction(Z,ce){Z.href=this.linkService.getAnchorUrl("");const Ee=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const Te of Object.keys(ce.actions)){const Ae=Ee.get(Te);Ae&&(Z[Ae]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ce.id,name:Te}}),!1))}Z.onclick||(Z.onclick=()=>!1),this.#e()}_bindResetFormAction(Z,ce){const Ee=Z.onclick;if(Ee||(Z.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){(0,n.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),Ee||(Z.onclick=()=>!1);return}Z.onclick=()=>{Ee?.();const{fields:Te,refs:Ae,include:Pe}=ce,Me=[];if(Te.length!==0||Ae.length!==0){const Je=new Set(Ae);for(const wt of Te){const rt=this._fieldObjects[wt]||[];for(const{id:Lt}of rt)Je.add(Lt)}for(const wt of Object.values(this._fieldObjects))for(const rt of wt)Je.has(rt.id)===Pe&&Me.push(rt)}else for(const Je of Object.values(this._fieldObjects))Me.push(...Je);const We=this.annotationStorage,qe=[];for(const Je of Me){const{id:wt}=Je;switch(qe.push(wt),Je.type){case"text":{const Lt=Je.defaultValue||"";We.setValue(wt,{value:Lt});break}case"checkbox":case"radiobutton":{const Lt=Je.defaultValue===Je.exportValues;We.setValue(wt,{value:Lt});break}case"combobox":case"listbox":{const Lt=Je.defaultValue||"";We.setValue(wt,{value:Lt});break}default:continue}const rt=document.querySelector(`[data-element-id="${wt}"]`);if(rt){if(!h.has(rt)){(0,n.warn)(`_bindResetFormAction - element not allowed: ${wt}`);continue}}else continue;rt.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:qe,name:"ResetForm"}}),!1}}}class _ extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce})}render(){this.container.className="textAnnotation";const Z=document.createElement("img");return Z.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",Z.alt="[{{type}} Annotation]",Z.dataset.l10nId="text_annotation_type",Z.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(Z,this.data),this.container.append(Z),this.container}}class b extends g{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(Z){const{isWin:ce,isMac:Ee}=n.FeatureTest.platform;return ce&&Z.ctrlKey||Ee&&Z.metaKey}_setEventListener(Z,ce,Ee,Te){ce.includes("mouse")?Z.addEventListener(ce,Ae=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Ee,value:Te(Ae),shift:Ae.shiftKey,modifier:this._getKeyModifier(Ae)}})}):Z.addEventListener(ce,Ae=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:Ee,value:Te(Ae)}})})}_setEventListeners(Z,ce,Ee){for(const[Te,Ae]of ce)(Ae==="Action"||this.data.actions?.[Ae])&&this._setEventListener(Z,Te,Ae,Ee)}_setBackgroundColor(Z){const ce=this.data.backgroundColor||null;Z.style.backgroundColor=ce===null?"transparent":n.Util.makeHexColor(ce[0],ce[1],ce[2])}_setTextStyle(Z){const ce=["left","center","right"],{fontColor:Ee}=this.data.defaultAppearanceData,Te=this.data.defaultAppearanceData.fontSize||d,Ae=Z.style;let Pe;const Me=2,We=qe=>Math.round(10*qe)/10;if(this.data.multiLine){const qe=Math.abs(this.data.rect[3]-this.data.rect[1]-Me),Je=Math.round(qe/(n.LINE_FACTOR*Te))||1,wt=qe/Je;Pe=Math.min(Te,We(wt/n.LINE_FACTOR))}else{const qe=Math.abs(this.data.rect[3]-this.data.rect[1]-Me);Pe=Math.min(Te,We(qe/n.LINE_FACTOR))}Ae.fontSize=`calc(${Pe}px * var(--scale-factor))`,Ae.color=n.Util.makeHexColor(Ee[0],Ee[1],Ee[2]),this.data.textAlignment!==null&&(Ae.textAlign=ce[this.data.textAlignment])}_setRequired(Z,ce){ce?Z.setAttribute("required",!0):Z.removeAttribute("required"),Z.setAttribute("aria-required",ce)}}class E extends b{constructor(Z){const ce=Z.renderForms||!Z.data.hasAppearance&&!!Z.data.fieldValue;super(Z,{isRenderable:ce})}setPropertyOnSiblings(Z,ce,Ee,Te){const Ae=this.annotationStorage;for(const Pe of this._getElementsByName(Z.name,Z.id))Pe.domElement&&(Pe.domElement[ce]=Ee),Ae.setValue(Pe.id,{[Te]:Ee})}render(){const Z=this.annotationStorage,ce=this.data.id;this.container.className="textWidgetAnnotation";let Ee=null;if(this.renderForms){const Te=Z.getValue(ce,{value:this.data.fieldValue});let Ae=Te.formattedValue||Te.value||"";const Pe=Z.getValue(ce,{charLimit:this.data.maxLen}).charLimit;Pe&&Ae.length>Pe&&(Ae=Ae.slice(0,Pe));const Me={userValue:Ae,formattedValue:null,lastCommittedValue:null,commitKey:1};this.data.multiLine?(Ee=document.createElement("textarea"),Ee.textContent=Ae,this.data.doNotScroll&&(Ee.style.overflowY="hidden")):(Ee=document.createElement("input"),Ee.type="text",Ee.setAttribute("value",Ae),this.data.doNotScroll&&(Ee.style.overflowX="hidden")),h.add(Ee),Ee.setAttribute("data-element-id",ce),Ee.disabled=this.data.readOnly,Ee.name=this.data.fieldName,Ee.tabIndex=u,this._setRequired(Ee,this.data.required),Pe&&(Ee.maxLength=Pe),Ee.addEventListener("input",qe=>{Z.setValue(ce,{value:qe.target.value}),this.setPropertyOnSiblings(Ee,"value",qe.target.value,"value")}),Ee.addEventListener("resetform",qe=>{const Je=this.data.defaultFieldValue??"";Ee.value=Me.userValue=Je,Me.formattedValue=null});let We=qe=>{const{formattedValue:Je}=Me;Je!=null&&(qe.target.value=Je),qe.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){Ee.addEventListener("focus",Je=>{const{target:wt}=Je;Me.userValue&&(wt.value=Me.userValue),Me.lastCommittedValue=wt.value,Me.commitKey=1}),Ee.addEventListener("updatefromsandbox",Je=>{const wt={value(rt){Me.userValue=rt.detail.value??"",Z.setValue(ce,{value:Me.userValue.toString()}),rt.target.value=Me.userValue},formattedValue(rt){const{formattedValue:Lt}=rt.detail;Me.formattedValue=Lt,Lt!=null&&rt.target!==document.activeElement&&(rt.target.value=Lt),Z.setValue(ce,{formattedValue:Lt})},selRange(rt){rt.target.setSelectionRange(...rt.detail.selRange)},charLimit:rt=>{const{charLimit:Lt}=rt.detail,{target:ln}=rt;if(Lt===0){ln.removeAttribute("maxLength");return}ln.setAttribute("maxLength",Lt);let dt=Me.userValue;!dt||dt.length<=Lt||(dt=dt.slice(0,Lt),ln.value=Me.userValue=dt,Z.setValue(ce,{value:dt}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ce,name:"Keystroke",value:dt,willCommit:!0,commitKey:1,selStart:ln.selectionStart,selEnd:ln.selectionEnd}}))}};this._dispatchEventFromSandbox(wt,Je)}),Ee.addEventListener("keydown",Je=>{Me.commitKey=1;let wt=-1;if(Je.key==="Escape"?wt=0:Je.key==="Enter"&&!this.data.multiLine?wt=2:Je.key==="Tab"&&(Me.commitKey=3),wt===-1)return;const{value:rt}=Je.target;Me.lastCommittedValue!==rt&&(Me.lastCommittedValue=rt,Me.userValue=rt,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ce,name:"Keystroke",value:rt,willCommit:!0,commitKey:wt,selStart:Je.target.selectionStart,selEnd:Je.target.selectionEnd}}))});const qe=We;We=null,Ee.addEventListener("blur",Je=>{if(!Je.relatedTarget)return;const{value:wt}=Je.target;Me.userValue=wt,Me.lastCommittedValue!==wt&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ce,name:"Keystroke",value:wt,willCommit:!0,commitKey:Me.commitKey,selStart:Je.target.selectionStart,selEnd:Je.target.selectionEnd}}),qe(Je)}),this.data.actions?.Keystroke&&Ee.addEventListener("beforeinput",Je=>{Me.lastCommittedValue=null;const{data:wt,target:rt}=Je,{value:Lt,selectionStart:ln,selectionEnd:dt}=rt;let st=ln,nt=dt;switch(Je.inputType){case"deleteWordBackward":{const dn=Lt.substring(0,ln).match(/\w*[^\w]*$/);dn&&(st-=dn[0].length);break}case"deleteWordForward":{const dn=Lt.substring(ln).match(/^[^\w]*\w*/);dn&&(nt+=dn[0].length);break}case"deleteContentBackward":ln===dt&&(st-=1);break;case"deleteContentForward":ln===dt&&(nt+=1);break}Je.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ce,name:"Keystroke",value:Lt,change:wt||"",willCommit:!1,selStart:st,selEnd:nt}})}),this._setEventListeners(Ee,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Je=>Je.target.value)}if(We&&Ee.addEventListener("blur",We),this.data.comb){const Je=(this.data.rect[2]-this.data.rect[0])/Pe;Ee.classList.add("comb"),Ee.style.letterSpacing=`calc(${Je}px * var(--scale-factor) - 1ch)`}}else Ee=document.createElement("div"),Ee.textContent=this.data.fieldValue,Ee.style.verticalAlign="middle",Ee.style.display="table-cell";return this._setTextStyle(Ee),this._setBackgroundColor(Ee),this._setDefaultPropertiesFromJS(Ee),this.container.append(Ee),this.container}}class A extends b{constructor(Z){super(Z,{isRenderable:Z.renderForms})}render(){const Z=this.annotationStorage,ce=this.data,Ee=ce.id;let Te=Z.getValue(Ee,{value:ce.exportValue===ce.fieldValue}).value;typeof Te=="string"&&(Te=Te!=="Off",Z.setValue(Ee,{value:Te})),this.container.className="buttonWidgetAnnotation checkBox";const Ae=document.createElement("input");return h.add(Ae),Ae.setAttribute("data-element-id",Ee),Ae.disabled=ce.readOnly,this._setRequired(Ae,this.data.required),Ae.type="checkbox",Ae.name=ce.fieldName,Te&&Ae.setAttribute("checked",!0),Ae.setAttribute("exportValue",ce.exportValue),Ae.tabIndex=u,Ae.addEventListener("change",Pe=>{const{name:Me,checked:We}=Pe.target;for(const qe of this._getElementsByName(Me,Ee)){const Je=We&&qe.exportValue===ce.exportValue;qe.domElement&&(qe.domElement.checked=Je),Z.setValue(qe.id,{value:Je})}Z.setValue(Ee,{value:We})}),Ae.addEventListener("resetform",Pe=>{const Me=ce.defaultFieldValue||"Off";Pe.target.checked=Me===ce.exportValue}),this.enableScripting&&this.hasJSActions&&(Ae.addEventListener("updatefromsandbox",Pe=>{const Me={value(We){We.target.checked=We.detail.value!=="Off",Z.setValue(Ee,{value:We.target.checked})}};this._dispatchEventFromSandbox(Me,Pe)}),this._setEventListeners(Ae,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Pe=>Pe.target.checked)),this._setBackgroundColor(Ae),this._setDefaultPropertiesFromJS(Ae),this.container.append(Ae),this.container}}class z extends b{constructor(Z){super(Z,{isRenderable:Z.renderForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";const Z=this.annotationStorage,ce=this.data,Ee=ce.id;let Te=Z.getValue(Ee,{value:ce.fieldValue===ce.buttonValue}).value;typeof Te=="string"&&(Te=Te!==ce.buttonValue,Z.setValue(Ee,{value:Te}));const Ae=document.createElement("input");if(h.add(Ae),Ae.setAttribute("data-element-id",Ee),Ae.disabled=ce.readOnly,this._setRequired(Ae,this.data.required),Ae.type="radio",Ae.name=ce.fieldName,Te&&Ae.setAttribute("checked",!0),Ae.tabIndex=u,Ae.addEventListener("change",Pe=>{const{name:Me,checked:We}=Pe.target;for(const qe of this._getElementsByName(Me,Ee))Z.setValue(qe.id,{value:!1});Z.setValue(Ee,{value:We})}),Ae.addEventListener("resetform",Pe=>{const Me=ce.defaultFieldValue;Pe.target.checked=Me!=null&&Me===ce.buttonValue}),this.enableScripting&&this.hasJSActions){const Pe=ce.buttonValue;Ae.addEventListener("updatefromsandbox",Me=>{const We={value:qe=>{const Je=Pe===qe.detail.value;for(const wt of this._getElementsByName(qe.target.name)){const rt=Je&&wt.id===Ee;wt.domElement&&(wt.domElement.checked=rt),Z.setValue(wt.id,{value:rt})}}};this._dispatchEventFromSandbox(We,Me)}),this._setEventListeners(Ae,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Me=>Me.target.checked)}return this._setBackgroundColor(Ae),this._setDefaultPropertiesFromJS(Ae),this.container.append(Ae),this.container}}class D extends v{constructor(Z){super(Z,{ignoreBorder:Z.data.hasAppearance})}render(){const Z=super.render();Z.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(Z.title=this.data.alternativeText);const ce=Z.lastChild;return this.enableScripting&&this.hasJSActions&&ce&&(this._setDefaultPropertiesFromJS(ce),ce.addEventListener("updatefromsandbox",Ee=>{this._dispatchEventFromSandbox({},Ee)})),Z}}class P extends b{constructor(Z){super(Z,{isRenderable:Z.renderForms})}render(){this.container.className="choiceWidgetAnnotation";const Z=this.annotationStorage,ce=this.data.id,Ee=Z.getValue(ce,{value:this.data.fieldValue}),Te=document.createElement("select");h.add(Te),Te.setAttribute("data-element-id",ce),Te.disabled=this.data.readOnly,this._setRequired(Te,this.data.required),Te.name=this.data.fieldName,Te.tabIndex=u;let Ae=this.data.combo&&this.data.options.length>0;this.data.combo||(Te.size=this.data.options.length,this.data.multiSelect&&(Te.multiple=!0)),Te.addEventListener("resetform",Je=>{const wt=this.data.defaultFieldValue;for(const rt of Te.options)rt.selected=rt.value===wt});for(const Je of this.data.options){const wt=document.createElement("option");wt.textContent=Je.displayValue,wt.value=Je.exportValue,Ee.value.includes(Je.exportValue)&&(wt.setAttribute("selected",!0),Ae=!1),Te.append(wt)}let Pe=null;if(Ae){const Je=document.createElement("option");Je.value=" ",Je.setAttribute("hidden",!0),Je.setAttribute("selected",!0),Te.prepend(Je),Pe=()=>{Je.remove(),Te.removeEventListener("input",Pe),Pe=null},Te.addEventListener("input",Pe)}const Me=Je=>{const wt=Je?"value":"textContent",{options:rt,multiple:Lt}=Te;return Lt?Array.prototype.filter.call(rt,ln=>ln.selected).map(ln=>ln[wt]):rt.selectedIndex===-1?null:rt[rt.selectedIndex][wt]};let We=Me(!1);const qe=Je=>{const wt=Je.target.options;return Array.prototype.map.call(wt,rt=>({displayValue:rt.textContent,exportValue:rt.value}))};return this.enableScripting&&this.hasJSActions?(Te.addEventListener("updatefromsandbox",Je=>{const wt={value(rt){Pe?.();const Lt=rt.detail.value,ln=new Set(Array.isArray(Lt)?Lt:[Lt]);for(const dt of Te.options)dt.selected=ln.has(dt.value);Z.setValue(ce,{value:Me(!0)}),We=Me(!1)},multipleSelection(rt){Te.multiple=!0},remove(rt){const Lt=Te.options,ln=rt.detail.remove;Lt[ln].selected=!1,Te.remove(ln),Lt.length>0&&Array.prototype.findIndex.call(Lt,st=>st.selected)===-1&&(Lt[0].selected=!0),Z.setValue(ce,{value:Me(!0),items:qe(rt)}),We=Me(!1)},clear(rt){for(;Te.length!==0;)Te.remove(0);Z.setValue(ce,{value:null,items:[]}),We=Me(!1)},insert(rt){const{index:Lt,displayValue:ln,exportValue:dt}=rt.detail.insert,st=Te.children[Lt],nt=document.createElement("option");nt.textContent=ln,nt.value=dt,st?st.before(nt):Te.append(nt),Z.setValue(ce,{value:Me(!0),items:qe(rt)}),We=Me(!1)},items(rt){const{items:Lt}=rt.detail;for(;Te.length!==0;)Te.remove(0);for(const ln of Lt){const{displayValue:dt,exportValue:st}=ln,nt=document.createElement("option");nt.textContent=dt,nt.value=st,Te.append(nt)}Te.options.length>0&&(Te.options[0].selected=!0),Z.setValue(ce,{value:Me(!0),items:qe(rt)}),We=Me(!1)},indices(rt){const Lt=new Set(rt.detail.indices);for(const ln of rt.target.options)ln.selected=Lt.has(ln.index);Z.setValue(ce,{value:Me(!0)}),We=Me(!1)},editable(rt){rt.target.disabled=!rt.detail.editable}};this._dispatchEventFromSandbox(wt,Je)}),Te.addEventListener("input",Je=>{const wt=Me(!0);Z.setValue(ce,{value:wt}),Je.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:ce,name:"Keystroke",value:We,changeEx:wt,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(Te,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],Je=>Je.target.value)):Te.addEventListener("input",function(Je){Z.setValue(ce,{value:Me(!0)})}),this.data.combo&&this._setTextStyle(Te),this._setBackgroundColor(Te),this._setDefaultPropertiesFromJS(Te),this.container.append(Te),this.container}}class G extends g{static IGNORE_TYPES=new Set(["Line","Square","Circle","PolyLine","Polygon","Ink"]);constructor(Z){const{data:ce}=Z,Ee=!G.IGNORE_TYPES.has(ce.parentType)&&!!(ce.titleObj?.str||ce.contentsObj?.str||ce.richText?.str);super(Z,{isRenderable:Ee})}render(){this.container.className="popupAnnotation";const Z=this.layer.querySelectorAll(`[data-annotation-id="${this.data.parentId}"]`);if(Z.length===0)return this.container;const ce=new R({container:this.container,trigger:Array.from(Z),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),Ee=this.page,Te=n.Util.normalizeRect([this.data.parentRect[0],Ee.view[3]-this.data.parentRect[1]+Ee.view[1],this.data.parentRect[2],Ee.view[3]-this.data.parentRect[3]+Ee.view[1]]),Ae=Te[0]+this.data.parentRect[2]-this.data.parentRect[0],Pe=Te[1],{pageWidth:Me,pageHeight:We,pageX:qe,pageY:Je}=this.viewport.rawDims;return this.container.style.left=`${100*(Ae-qe)/Me}%`,this.container.style.top=`${100*(Pe-Je)/We}%`,this.container.append(ce.render()),this.container}}class R{constructor(Z){this.container=Z.container,this.trigger=Z.trigger,this.color=Z.color,this.titleObj=Z.titleObj,this.modificationDate=Z.modificationDate,this.contentsObj=Z.contentsObj,this.richText=Z.richText,this.hideWrapper=Z.hideWrapper||!1,this.pinned=!1}render(){const ce=document.createElement("div");ce.className="popupWrapper",this.hideElement=this.hideWrapper?ce:this.container,this.hideElement.hidden=!0;const Ee=document.createElement("div");Ee.className="popup";const Te=this.color;if(Te){const Me=.7*(255-Te[0])+Te[0],We=.7*(255-Te[1])+Te[1],qe=.7*(255-Te[2])+Te[2];Ee.style.backgroundColor=n.Util.makeHexColor(Me|0,We|0,qe|0)}const Ae=document.createElement("h1");Ae.dir=this.titleObj.dir,Ae.textContent=this.titleObj.str,Ee.append(Ae);const Pe=r.PDFDateString.toDateObject(this.modificationDate);if(Pe){const Me=document.createElement("span");Me.className="popupDate",Me.textContent="{{date}}, {{time}}",Me.dataset.l10nId="annotation_date_string",Me.dataset.l10nArgs=JSON.stringify({date:Pe.toLocaleDateString(),time:Pe.toLocaleTimeString()}),Ee.append(Me)}if(this.richText?.str&&(!this.contentsObj?.str||this.contentsObj.str===this.richText.str))l.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:Ee}),Ee.lastChild.className="richText popupContent";else{const Me=this._formatContents(this.contentsObj);Ee.append(Me)}Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(const Me of this.trigger)Me.addEventListener("click",this._toggle.bind(this)),Me.addEventListener("mouseover",this._show.bind(this,!1)),Me.addEventListener("mouseout",this._hide.bind(this,!1));return Ee.addEventListener("click",this._hide.bind(this,!0)),ce.append(Ee),ce}_formatContents({str:Z,dir:ce}){const Ee=document.createElement("p");Ee.className="popupContent",Ee.dir=ce;const Te=Z.split(/(?:\r\n?|\n)/);for(let Ae=0,Pe=Te.length;Ae<Pe;++Ae){const Me=Te[Ae];Ee.append(document.createTextNode(Me)),Ae<Pe-1&&Ee.append(document.createElement("br"))}return Ee}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(Z=!1){Z&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex=parseInt(this.container.style.zIndex)+1e3)}_hide(Z=!0){Z&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex=parseInt(this.container.style.zIndex)-1e3)}}class I extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce,ignoreBorder:!0}),this.textContent=Z.data.textContent}render(){if(this.container.className="freeTextAnnotation",this.textContent){const Z=document.createElement("div");Z.className="annotationTextContent",Z.setAttribute("role","comment");for(const ce of this.textContent){const Ee=document.createElement("span");Ee.textContent=ce,Z.append(Ee)}this.container.append(Z)}return this.data.hasPopup||this._createPopup(null,this.data),this.container}}class w extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce,ignoreBorder:!0})}render(){this.container.className="lineAnnotation";const Z=this.data,{width:ce,height:Ee}=p(Z.rect),Te=this.svgFactory.create(ce,Ee,!0),Ae=this.svgFactory.createElement("svg:line");return Ae.setAttribute("x1",Z.rect[2]-Z.lineCoordinates[0]),Ae.setAttribute("y1",Z.rect[3]-Z.lineCoordinates[1]),Ae.setAttribute("x2",Z.rect[2]-Z.lineCoordinates[2]),Ae.setAttribute("y2",Z.rect[3]-Z.lineCoordinates[3]),Ae.setAttribute("stroke-width",Z.borderStyle.width||1),Ae.setAttribute("stroke","transparent"),Ae.setAttribute("fill","transparent"),Te.append(Ae),this.container.append(Te),this._createPopup(Ae,Z),this.container}}class H extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce,ignoreBorder:!0})}render(){this.container.className="squareAnnotation";const Z=this.data,{width:ce,height:Ee}=p(Z.rect),Te=this.svgFactory.create(ce,Ee,!0),Ae=Z.borderStyle.width,Pe=this.svgFactory.createElement("svg:rect");return Pe.setAttribute("x",Ae/2),Pe.setAttribute("y",Ae/2),Pe.setAttribute("width",ce-Ae),Pe.setAttribute("height",Ee-Ae),Pe.setAttribute("stroke-width",Ae||1),Pe.setAttribute("stroke","transparent"),Pe.setAttribute("fill","transparent"),Te.append(Pe),this.container.append(Te),this._createPopup(Pe,Z),this.container}}class V extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce,ignoreBorder:!0})}render(){this.container.className="circleAnnotation";const Z=this.data,{width:ce,height:Ee}=p(Z.rect),Te=this.svgFactory.create(ce,Ee,!0),Ae=Z.borderStyle.width,Pe=this.svgFactory.createElement("svg:ellipse");return Pe.setAttribute("cx",ce/2),Pe.setAttribute("cy",Ee/2),Pe.setAttribute("rx",ce/2-Ae/2),Pe.setAttribute("ry",Ee/2-Ae/2),Pe.setAttribute("stroke-width",Ae||1),Pe.setAttribute("stroke","transparent"),Pe.setAttribute("fill","transparent"),Te.append(Pe),this.container.append(Te),this._createPopup(Pe,Z),this.container}}class te extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const Z=this.data,{width:ce,height:Ee}=p(Z.rect),Te=this.svgFactory.create(ce,Ee,!0);let Ae=[];for(const Me of Z.vertices){const We=Me.x-Z.rect[0],qe=Z.rect[3]-Me.y;Ae.push(We+","+qe)}Ae=Ae.join(" ");const Pe=this.svgFactory.createElement(this.svgElementName);return Pe.setAttribute("points",Ae),Pe.setAttribute("stroke-width",Z.borderStyle.width||1),Pe.setAttribute("stroke","transparent"),Pe.setAttribute("fill","transparent"),Te.append(Pe),this.container.append(Te),this._createPopup(Pe,Z),this.container}}class ae extends te{constructor(Z){super(Z),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class be extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce,ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class _e extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const Z=this.data,{width:ce,height:Ee}=p(Z.rect),Te=this.svgFactory.create(ce,Ee,!0);for(const Ae of Z.inkLists){let Pe=[];for(const We of Ae){const qe=We.x-Z.rect[0],Je=Z.rect[3]-We.y;Pe.push(`${qe},${Je}`)}Pe=Pe.join(" ");const Me=this.svgFactory.createElement(this.svgElementName);Me.setAttribute("points",Pe),Me.setAttribute("stroke-width",Z.borderStyle.width||1),Me.setAttribute("stroke","transparent"),Me.setAttribute("fill","transparent"),this._createPopup(Me,Z),Te.append(Me)}return this.container.append(Te),this.container}}class le extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class ue extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class oe extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class ee extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class se extends g{constructor(Z){const ce=!!(Z.data.hasPopup||Z.data.titleObj?.str||Z.data.contentsObj?.str||Z.data.richText?.str);super(Z,{isRenderable:ce,ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class re extends g{constructor(Z){super(Z,{isRenderable:!0});const{filename:ce,content:Ee}=this.data.file;this.filename=(0,r.getFilenameFromUrl)(ce,!0),this.content=Ee,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:ce,content:Ee})}render(){this.container.className="fileAttachmentAnnotation";let Z;return this.data.hasAppearance?Z=document.createElement("div"):(Z=document.createElement("img"),Z.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(this.data.name)?"paperclip":"pushpin"}.svg`),Z.className="popupTriggerArea",Z.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&(this.data.titleObj?.str||this.data.contentsObj?.str||this.data.richText)&&this._createPopup(Z,this.data),this.container.append(Z),this.container}_download(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}class fe{static#e(Z,ce,Ee,Te){const Ae=Z.firstChild||Z;Ae.id=`${r.AnnotationPrefix}${ce}`,Ee.append(Z),Te?.moveElementInDOM(Ee,Z,Ae,!1)}static render(Z){const{annotations:ce,div:Ee,viewport:Te,accessibilityManager:Ae}=Z;(0,r.setLayerDimensions)(Ee,Te);const Pe={data:null,layer:Ee,page:Z.page,viewport:Te,linkService:Z.linkService,downloadManager:Z.downloadManager,imageResourcesPath:Z.imageResourcesPath||"",renderForms:Z.renderForms!==!1,svgFactory:new r.DOMSVGFactory,annotationStorage:Z.annotationStorage||new s.AnnotationStorage,enableScripting:Z.enableScripting===!0,hasJSActions:Z.hasJSActions,fieldObjects:Z.fieldObjects};let Me=0;for(const We of ce){if(We.annotationType!==n.AnnotationType.POPUP){const{width:wt,height:rt}=p(We.rect);if(wt<=0||rt<=0)continue}Pe.data=We;const qe=m.create(Pe);if(!qe.isRenderable)continue;const Je=qe.render();if(We.hidden&&(Je.style.visibility="hidden"),Array.isArray(Je))for(const wt of Je)wt.style.zIndex=Me++,fe.#e(wt,We.id,Ee,Ae);else Je.style.zIndex=Me++,qe instanceof G?Ee.prepend(Je):fe.#e(Je,We.id,Ee,Ae)}this.#t(Ee,Z.annotationCanvasMap)}static update(Z){const{annotationCanvasMap:ce,div:Ee,viewport:Te}=Z;(0,r.setLayerDimensions)(Ee,{rotation:Te.rotation}),this.#t(Ee,ce),Ee.hidden=!1}static#t(Z,ce){if(ce){for(const[Ee,Te]of ce){const Ae=Z.querySelector(`[data-annotation-id="${Ee}"]`);if(!Ae)continue;const{firstChild:Pe}=Ae;Pe?Pe.nodeName==="CANVAS"?Pe.replaceWith(Te):Pe.before(Te):Ae.append(Te)}ce.clear()}}}e.AnnotationLayer=fe}),((i,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorConverters=void 0;function t(r){return Math.floor(Math.max(0,Math.min(1,r))*255).toString(16).padStart(2,"0")}class n{static CMYK_G([s,a,l,u]){return["G",1-Math.min(1,.3*s+.59*l+.11*a+u)]}static G_CMYK([s]){return["CMYK",0,0,0,1-s]}static G_RGB([s]){return["RGB",s,s,s]}static G_HTML([s]){const a=t(s);return`#${a}${a}${a}`}static RGB_G([s,a,l]){return["G",.3*s+.59*a+.11*l]}static RGB_HTML([s,a,l]){const u=t(s),d=t(a),h=t(l);return`#${u}${d}${h}`}static T_HTML(){return"#00000000"}static CMYK_RGB([s,a,l,u]){return["RGB",1-Math.min(1,s+u),1-Math.min(1,l+u),1-Math.min(1,a+u)]}static CMYK_HTML(s){const a=this.CMYK_RGB(s).slice(1);return this.RGB_HTML(a)}static RGB_CMYK([s,a,l]){const u=1-s,d=1-a,h=1-l,p=Math.min(u,d,h);return["CMYK",u,d,h,p]}}e.ColorConverters=n}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaLayer=void 0;var n=t(19);class r{static setupStorage(a,l,u,d,h){const p=d.getValue(l,{value:null});switch(u.name){case"textarea":if(p.value!==null&&(a.textContent=p.value),h==="print")break;a.addEventListener("input",m=>{d.setValue(l,{value:m.target.value})});break;case"input":if(u.attributes.type==="radio"||u.attributes.type==="checkbox"){if(p.value===u.attributes.xfaOn?a.setAttribute("checked",!0):p.value===u.attributes.xfaOff&&a.removeAttribute("checked"),h==="print")break;a.addEventListener("change",m=>{d.setValue(l,{value:m.target.checked?m.target.getAttribute("xfaOn"):m.target.getAttribute("xfaOff")})})}else{if(p.value!==null&&a.setAttribute("value",p.value),h==="print")break;a.addEventListener("input",m=>{d.setValue(l,{value:m.target.value})})}break;case"select":if(p.value!==null)for(const m of u.children)m.attributes.value===p.value&&(m.attributes.selected=!0);a.addEventListener("input",m=>{const g=m.target.options,v=g.selectedIndex===-1?"":g[g.selectedIndex].value;d.setValue(l,{value:v})});break}}static setAttributes({html:a,element:l,storage:u=null,intent:d,linkService:h}){const{attributes:p}=l,m=a instanceof HTMLAnchorElement;p.type==="radio"&&(p.name=`${p.name}-${d}`);for(const[g,v]of Object.entries(p))if(v!=null)switch(g){case"class":v.length&&a.setAttribute(g,v.join(" "));break;case"dataId":break;case"id":a.setAttribute("data-element-id",v);break;case"style":Object.assign(a.style,v);break;case"textContent":a.textContent=v;break;default:(!m||g!=="href"&&g!=="newWindow")&&a.setAttribute(g,v)}m&&h.addLinkAttributes(a,p.href,p.newWindow),u&&p.dataId&&this.setupStorage(a,p.dataId,l,u)}static render(a){const l=a.annotationStorage,u=a.linkService,d=a.xfaHtml,h=a.intent||"display",p=document.createElement(d.name);d.attributes&&this.setAttributes({html:p,element:d,intent:h,linkService:u});const m=[[d,-1,p]],g=a.div;if(g.append(p),a.viewport){const _=`matrix(${a.viewport.transform.join(",")})`;g.style.transform=_}h!=="richText"&&g.setAttribute("class","xfaLayer xfaFont");const v=[];for(;m.length>0;){const[_,b,E]=m.at(-1);if(b+1===_.children.length){m.pop();continue}const A=_.children[++m.at(-1)[1]];if(A===null)continue;const{name:z}=A;if(z==="#text"){const P=document.createTextNode(A.value);v.push(P),E.append(P);continue}let D;if(A?.attributes?.xmlns?D=document.createElementNS(A.attributes.xmlns,z):D=document.createElement(z),E.append(D),A.attributes&&this.setAttributes({html:D,element:A,storage:l,intent:h,linkService:u}),A.children&&A.children.length>0)m.push([A,-1,D]);else if(A.value){const P=document.createTextNode(A.value);n.XfaText.shouldBuildText(z)&&v.push(P),D.append(P)}}for(const _ of g.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))_.setAttribute("readOnly",!0);return{textDivs:v}}static update(a){const l=`matrix(${a.viewport.transform.join(",")})`;a.div.style.transform=l,a.div.hidden=!1}}e.XfaLayer=r}),((i,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SVGGraphics=void 0;var n=t(6),r=t(1),s=t(10);let a=class{constructor(){(0,r.unreachable)("Not implemented: SVGGraphics")}};e.SVGGraphics=a;{let _=function(P){let G=[];const R=[];for(const I of P){if(I.fn==="save"){G.push({fnId:92,fn:"group",items:[]}),R.push(G),G=G.at(-1).items;continue}I.fn==="restore"?G=R.pop():G.push(I)}return G},b=function(P){if(Number.isInteger(P))return P.toString();const G=P.toFixed(10);let R=G.length-1;if(G[R]!=="0")return G;do R--;while(G[R]==="0");return G.substring(0,G[R]==="."?R:R+1)},E=function(P){if(P[4]===0&&P[5]===0){if(P[1]===0&&P[2]===0)return P[0]===1&&P[3]===1?"":`scale(${b(P[0])} ${b(P[3])})`;if(P[0]===P[3]&&P[1]===-P[2]){const G=Math.acos(P[0])*180/Math.PI;return`rotate(${b(G)})`}}else if(P[0]===1&&P[1]===0&&P[2]===0&&P[3]===1)return`translate(${b(P[4])} ${b(P[5])})`;return`matrix(${b(P[0])} ${b(P[1])} ${b(P[2])} ${b(P[3])} ${b(P[4])} ${b(P[5])})`};const l={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},u="http://www.w3.org/XML/1998/namespace",d="http://www.w3.org/1999/xlink",h=["butt","round","square"],p=["miter","round","bevel"],m=function(P,G="",R=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!R)return URL.createObjectURL(new Blob([P],{type:G}));const I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let w=`data:${G};base64,`;for(let H=0,V=P.length;H<V;H+=3){const te=P[H]&255,ae=P[H+1]&255,be=P[H+2]&255,_e=te>>2,le=(te&3)<<4|ae>>4,ue=H+1<V?(ae&15)<<2|be>>6:64,oe=H+2<V?be&63:64;w+=I[_e]+I[le]+I[ue]+I[oe]}return w},g=(function(){const P=new Uint8Array([137,80,78,71,13,10,26,10]),G=12,R=new Int32Array(256);for(let be=0;be<256;be++){let _e=be;for(let le=0;le<8;le++)_e&1?_e=3988292384^_e>>1&2147483647:_e=_e>>1&2147483647;R[be]=_e}function I(be,_e,le){let ue=-1;for(let oe=_e;oe<le;oe++){const ee=(ue^be[oe])&255,se=R[ee];ue=ue>>>8^se}return ue^-1}function w(be,_e,le,ue){let oe=ue;const ee=_e.length;le[oe]=ee>>24&255,le[oe+1]=ee>>16&255,le[oe+2]=ee>>8&255,le[oe+3]=ee&255,oe+=4,le[oe]=be.charCodeAt(0)&255,le[oe+1]=be.charCodeAt(1)&255,le[oe+2]=be.charCodeAt(2)&255,le[oe+3]=be.charCodeAt(3)&255,oe+=4,le.set(_e,oe),oe+=_e.length;const se=I(le,ue+4,oe);le[oe]=se>>24&255,le[oe+1]=se>>16&255,le[oe+2]=se>>8&255,le[oe+3]=se&255}function H(be,_e,le){let ue=1,oe=0;for(let ee=_e;ee<le;++ee)ue=(ue+(be[ee]&255))%65521,oe=(oe+ue)%65521;return oe<<16|ue}function V(be){if(!s.isNodeJS)return te(be);try{let _e;parseInt(process.versions.node)>=8?_e=be:_e=Buffer.from(be);const le=require$$5.deflateSync(_e,{level:9});return le instanceof Uint8Array?le:new Uint8Array(le)}catch(_e){(0,r.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+_e)}return te(be)}function te(be){let _e=be.length;const le=65535,ue=Math.ceil(_e/le),oe=new Uint8Array(2+_e+ue*5+4);let ee=0;oe[ee++]=120,oe[ee++]=156;let se=0;for(;_e>le;)oe[ee++]=0,oe[ee++]=255,oe[ee++]=255,oe[ee++]=0,oe[ee++]=0,oe.set(be.subarray(se,se+le),ee),ee+=le,se+=le,_e-=le;oe[ee++]=1,oe[ee++]=_e&255,oe[ee++]=_e>>8&255,oe[ee++]=~_e&65535&255,oe[ee++]=(~_e&65535)>>8&255,oe.set(be.subarray(se),ee),ee+=be.length-se;const re=H(be,0,be.length);return oe[ee++]=re>>24&255,oe[ee++]=re>>16&255,oe[ee++]=re>>8&255,oe[ee++]=re&255,oe}function ae(be,_e,le,ue){const oe=be.width,ee=be.height;let se,re,fe;const pe=be.data;switch(_e){case r.ImageKind.GRAYSCALE_1BPP:re=0,se=1,fe=oe+7>>3;break;case r.ImageKind.RGB_24BPP:re=2,se=8,fe=oe*3;break;case r.ImageKind.RGBA_32BPP:re=6,se=8,fe=oe*4;break;default:throw new Error("invalid format")}const Z=new Uint8Array((1+fe)*ee);let ce=0,Ee=0;for(let qe=0;qe<ee;++qe)Z[ce++]=0,Z.set(pe.subarray(Ee,Ee+fe),ce),Ee+=fe,ce+=fe;if(_e===r.ImageKind.GRAYSCALE_1BPP&&ue){ce=0;for(let qe=0;qe<ee;qe++){ce++;for(let Je=0;Je<fe;Je++)Z[ce++]^=255}}const Te=new Uint8Array([oe>>24&255,oe>>16&255,oe>>8&255,oe&255,ee>>24&255,ee>>16&255,ee>>8&255,ee&255,se,re,0,0,0]),Ae=V(Z),Pe=P.length+G*3+Te.length+Ae.length,Me=new Uint8Array(Pe);let We=0;return Me.set(P,We),We+=P.length,w("IHDR",Te,Me,We),We+=G+Te.length,w("IDATA",Ae,Me,We),We+=G+Ae.length,w("IEND",new Uint8Array(0),Me,We),m(Me,"image/png",le)}return function(_e,le,ue){const oe=_e.kind===void 0?r.ImageKind.GRAYSCALE_1BPP:_e.kind;return ae(_e,oe,le,ue)}})();class v{constructor(){this.fontSizeScale=1,this.fontWeight=l.fontWeight,this.fontSize=0,this.textMatrix=r.IDENTITY_MATRIX,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=r.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=l.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(G,R){this.x=G,this.y=R}}let A=0,z=0,D=0;e.SVGGraphics=a=class{constructor(P,G,R=!1){(0,n.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new n.DOMSVGFactory,this.current=new v,this.transformMatrix=r.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=P,this.objs=G,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!R,this._operatorIdMapping=[];for(const I in r.OPS)this._operatorIdMapping[r.OPS[I]]=I}getObject(P,G=null){return typeof P=="string"?P.startsWith("g_")?this.commonObjs.get(P):this.objs.get(P):G}save(){this.transformStack.push(this.transformMatrix);const P=this.current;this.extraStack.push(P),this.current=P.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(P){this.save(),this.executeOpTree(P),this.restore()}loadDependencies(P){const G=P.fnArray,R=P.argsArray;for(let I=0,w=G.length;I<w;I++)if(G[I]===r.OPS.dependency)for(const H of R[I]){const V=H.startsWith("g_")?this.commonObjs:this.objs,te=new Promise(ae=>{V.get(H,ae)});this.current.dependencies.push(te)}return Promise.all(this.current.dependencies)}transform(P,G,R,I,w,H){const V=[P,G,R,I,w,H];this.transformMatrix=r.Util.transform(this.transformMatrix,V),this.tgrp=null}getSVG(P,G){this.viewport=G;const R=this._initialize(G);return this.loadDependencies(P).then(()=>(this.transformMatrix=r.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(P)),R))}convertOpList(P){const G=this._operatorIdMapping,R=P.argsArray,I=P.fnArray,w=[];for(let H=0,V=I.length;H<V;H++){const te=I[H];w.push({fnId:te,fn:G[te],args:R[H]})}return _(w)}executeOpTree(P){for(const G of P){const R=G.fn,I=G.fnId,w=G.args;switch(I|0){case r.OPS.beginText:this.beginText();break;case r.OPS.dependency:break;case r.OPS.setLeading:this.setLeading(w);break;case r.OPS.setLeadingMoveText:this.setLeadingMoveText(w[0],w[1]);break;case r.OPS.setFont:this.setFont(w);break;case r.OPS.showText:this.showText(w[0]);break;case r.OPS.showSpacedText:this.showText(w[0]);break;case r.OPS.endText:this.endText();break;case r.OPS.moveText:this.moveText(w[0],w[1]);break;case r.OPS.setCharSpacing:this.setCharSpacing(w[0]);break;case r.OPS.setWordSpacing:this.setWordSpacing(w[0]);break;case r.OPS.setHScale:this.setHScale(w[0]);break;case r.OPS.setTextMatrix:this.setTextMatrix(w[0],w[1],w[2],w[3],w[4],w[5]);break;case r.OPS.setTextRise:this.setTextRise(w[0]);break;case r.OPS.setTextRenderingMode:this.setTextRenderingMode(w[0]);break;case r.OPS.setLineWidth:this.setLineWidth(w[0]);break;case r.OPS.setLineJoin:this.setLineJoin(w[0]);break;case r.OPS.setLineCap:this.setLineCap(w[0]);break;case r.OPS.setMiterLimit:this.setMiterLimit(w[0]);break;case r.OPS.setFillRGBColor:this.setFillRGBColor(w[0],w[1],w[2]);break;case r.OPS.setStrokeRGBColor:this.setStrokeRGBColor(w[0],w[1],w[2]);break;case r.OPS.setStrokeColorN:this.setStrokeColorN(w);break;case r.OPS.setFillColorN:this.setFillColorN(w);break;case r.OPS.shadingFill:this.shadingFill(w[0]);break;case r.OPS.setDash:this.setDash(w[0],w[1]);break;case r.OPS.setRenderingIntent:this.setRenderingIntent(w[0]);break;case r.OPS.setFlatness:this.setFlatness(w[0]);break;case r.OPS.setGState:this.setGState(w[0]);break;case r.OPS.fill:this.fill();break;case r.OPS.eoFill:this.eoFill();break;case r.OPS.stroke:this.stroke();break;case r.OPS.fillStroke:this.fillStroke();break;case r.OPS.eoFillStroke:this.eoFillStroke();break;case r.OPS.clip:this.clip("nonzero");break;case r.OPS.eoClip:this.clip("evenodd");break;case r.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case r.OPS.paintImageXObject:this.paintImageXObject(w[0]);break;case r.OPS.paintInlineImageXObject:this.paintInlineImageXObject(w[0]);break;case r.OPS.paintImageMaskXObject:this.paintImageMaskXObject(w[0]);break;case r.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(w[0],w[1]);break;case r.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case r.OPS.closePath:this.closePath();break;case r.OPS.closeStroke:this.closeStroke();break;case r.OPS.closeFillStroke:this.closeFillStroke();break;case r.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case r.OPS.nextLine:this.nextLine();break;case r.OPS.transform:this.transform(w[0],w[1],w[2],w[3],w[4],w[5]);break;case r.OPS.constructPath:this.constructPath(w[0],w[1]);break;case r.OPS.endPath:this.endPath();break;case 92:this.group(G.items);break;default:(0,r.warn)(`Unimplemented operator ${R}`);break}}}setWordSpacing(P){this.current.wordSpacing=P}setCharSpacing(P){this.current.charSpacing=P}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(P,G,R,I,w,H){const V=this.current;V.textMatrix=V.lineMatrix=[P,G,R,I,w,H],V.textMatrixScale=Math.hypot(P,G),V.x=V.lineX=0,V.y=V.lineY=0,V.xcoords=[],V.ycoords=[],V.tspan=this.svgFactory.createElement("svg:tspan"),V.tspan.setAttributeNS(null,"font-family",V.fontFamily),V.tspan.setAttributeNS(null,"font-size",`${b(V.fontSize)}px`),V.tspan.setAttributeNS(null,"y",b(-V.y)),V.txtElement=this.svgFactory.createElement("svg:text"),V.txtElement.append(V.tspan)}beginText(){const P=this.current;P.x=P.lineX=0,P.y=P.lineY=0,P.textMatrix=r.IDENTITY_MATRIX,P.lineMatrix=r.IDENTITY_MATRIX,P.textMatrixScale=1,P.tspan=this.svgFactory.createElement("svg:tspan"),P.txtElement=this.svgFactory.createElement("svg:text"),P.txtgrp=this.svgFactory.createElement("svg:g"),P.xcoords=[],P.ycoords=[]}moveText(P,G){const R=this.current;R.x=R.lineX+=P,R.y=R.lineY+=G,R.xcoords=[],R.ycoords=[],R.tspan=this.svgFactory.createElement("svg:tspan"),R.tspan.setAttributeNS(null,"font-family",R.fontFamily),R.tspan.setAttributeNS(null,"font-size",`${b(R.fontSize)}px`),R.tspan.setAttributeNS(null,"y",b(-R.y))}showText(P){const G=this.current,R=G.font,I=G.fontSize;if(I===0)return;const w=G.fontSizeScale,H=G.charSpacing,V=G.wordSpacing,te=G.fontDirection,ae=G.textHScale*te,be=R.vertical,_e=be?1:-1,le=R.defaultVMetrics,ue=I*G.fontMatrix[0];let oe=0;for(const re of P){if(re===null){oe+=te*V;continue}else if(typeof re=="number"){oe+=_e*re*I/1e3;continue}const fe=(re.isSpace?V:0)+H,pe=re.fontChar;let Z,ce,Ee=re.width;if(be){let Ae;const Pe=re.vmetric||le;Ae=re.vmetric?Pe[1]:Ee*.5,Ae=-Ae*ue;const Me=Pe[2]*ue;Ee=Pe?-Pe[0]:Ee,Z=Ae/w,ce=(oe+Me)/w}else Z=oe/w,ce=0;(re.isInFont||R.missingFile)&&(G.xcoords.push(G.x+Z),be&&G.ycoords.push(-G.y+ce),G.tspan.textContent+=pe);let Te;be?Te=Ee*ue-fe*te:Te=Ee*ue+fe*te,oe+=Te}G.tspan.setAttributeNS(null,"x",G.xcoords.map(b).join(" ")),be?G.tspan.setAttributeNS(null,"y",G.ycoords.map(b).join(" ")):G.tspan.setAttributeNS(null,"y",b(-G.y)),be?G.y-=oe:G.x+=oe*ae,G.tspan.setAttributeNS(null,"font-family",G.fontFamily),G.tspan.setAttributeNS(null,"font-size",`${b(G.fontSize)}px`),G.fontStyle!==l.fontStyle&&G.tspan.setAttributeNS(null,"font-style",G.fontStyle),G.fontWeight!==l.fontWeight&&G.tspan.setAttributeNS(null,"font-weight",G.fontWeight);const ee=G.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;if(ee===r.TextRenderingMode.FILL||ee===r.TextRenderingMode.FILL_STROKE?(G.fillColor!==l.fillColor&&G.tspan.setAttributeNS(null,"fill",G.fillColor),G.fillAlpha<1&&G.tspan.setAttributeNS(null,"fill-opacity",G.fillAlpha)):G.textRenderingMode===r.TextRenderingMode.ADD_TO_PATH?G.tspan.setAttributeNS(null,"fill","transparent"):G.tspan.setAttributeNS(null,"fill","none"),ee===r.TextRenderingMode.STROKE||ee===r.TextRenderingMode.FILL_STROKE){const re=1/(G.textMatrixScale||1);this._setStrokeAttributes(G.tspan,re)}let se=G.textMatrix;G.textRise!==0&&(se=se.slice(),se[5]+=G.textRise),G.txtElement.setAttributeNS(null,"transform",`${E(se)} scale(${b(ae)}, -1)`),G.txtElement.setAttributeNS(u,"xml:space","preserve"),G.txtElement.append(G.tspan),G.txtgrp.append(G.txtElement),this._ensureTransformGroup().append(G.txtElement)}setLeadingMoveText(P,G){this.setLeading(-G),this.moveText(P,G)}addFontStyle(P){if(!P.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const G=m(P.data,P.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${P.loadedName}"; src: url(${G}); }
`}setFont(P){const G=this.current,R=this.commonObjs.get(P[0]);let I=P[1];G.font=R,this.embedFonts&&!R.missingFile&&!this.embeddedFonts[R.loadedName]&&(this.addFontStyle(R),this.embeddedFonts[R.loadedName]=R),G.fontMatrix=R.fontMatrix||r.FONT_IDENTITY_MATRIX;let w="normal";R.black?w="900":R.bold&&(w="bold");const H=R.italic?"italic":"normal";I<0?(I=-I,G.fontDirection=-1):G.fontDirection=1,G.fontSize=I,G.fontFamily=R.loadedName,G.fontWeight=w,G.fontStyle=H,G.tspan=this.svgFactory.createElement("svg:tspan"),G.tspan.setAttributeNS(null,"y",b(-G.y)),G.xcoords=[],G.ycoords=[]}endText(){const P=this.current;P.textRenderingMode&r.TextRenderingMode.ADD_TO_PATH_FLAG&&P.txtElement?.hasChildNodes()&&(P.element=P.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(P){P>0&&(this.current.lineWidth=P)}setLineCap(P){this.current.lineCap=h[P]}setLineJoin(P){this.current.lineJoin=p[P]}setMiterLimit(P){this.current.miterLimit=P}setStrokeAlpha(P){this.current.strokeAlpha=P}setStrokeRGBColor(P,G,R){this.current.strokeColor=r.Util.makeHexColor(P,G,R)}setFillAlpha(P){this.current.fillAlpha=P}setFillRGBColor(P,G,R){this.current.fillColor=r.Util.makeHexColor(P,G,R),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(P){this.current.strokeColor=this._makeColorN_Pattern(P)}setFillColorN(P){this.current.fillColor=this._makeColorN_Pattern(P)}shadingFill(P){const G=this.viewport.width,R=this.viewport.height,I=r.Util.inverseTransform(this.transformMatrix),w=r.Util.applyTransform([0,0],I),H=r.Util.applyTransform([0,R],I),V=r.Util.applyTransform([G,0],I),te=r.Util.applyTransform([G,R],I),ae=Math.min(w[0],H[0],V[0],te[0]),be=Math.min(w[1],H[1],V[1],te[1]),_e=Math.max(w[0],H[0],V[0],te[0]),le=Math.max(w[1],H[1],V[1],te[1]),ue=this.svgFactory.createElement("svg:rect");ue.setAttributeNS(null,"x",ae),ue.setAttributeNS(null,"y",be),ue.setAttributeNS(null,"width",_e-ae),ue.setAttributeNS(null,"height",le-be),ue.setAttributeNS(null,"fill",this._makeShadingPattern(P)),this.current.fillAlpha<1&&ue.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(ue)}_makeColorN_Pattern(P){return P[0]==="TilingPattern"?this._makeTilingPattern(P):this._makeShadingPattern(P)}_makeTilingPattern(P){const G=P[1],R=P[2],I=P[3]||r.IDENTITY_MATRIX,[w,H,V,te]=P[4],ae=P[5],be=P[6],_e=P[7],le=`shading${D++}`,[ue,oe,ee,se]=r.Util.normalizeRect([...r.Util.applyTransform([w,H],I),...r.Util.applyTransform([V,te],I)]),[re,fe]=r.Util.singularValueDecompose2dScale(I),pe=ae*re,Z=be*fe,ce=this.svgFactory.createElement("svg:pattern");ce.setAttributeNS(null,"id",le),ce.setAttributeNS(null,"patternUnits","userSpaceOnUse"),ce.setAttributeNS(null,"width",pe),ce.setAttributeNS(null,"height",Z),ce.setAttributeNS(null,"x",`${ue}`),ce.setAttributeNS(null,"y",`${oe}`);const Ee=this.svg,Te=this.transformMatrix,Ae=this.current.fillColor,Pe=this.current.strokeColor,Me=this.svgFactory.create(ee-ue,se-oe);if(this.svg=Me,this.transformMatrix=I,_e===2){const We=r.Util.makeHexColor(...G);this.current.fillColor=We,this.current.strokeColor=We}return this.executeOpTree(this.convertOpList(R)),this.svg=Ee,this.transformMatrix=Te,this.current.fillColor=Ae,this.current.strokeColor=Pe,ce.append(Me.childNodes[0]),this.defs.append(ce),`url(#${le})`}_makeShadingPattern(P){switch(typeof P=="string"&&(P=this.objs.get(P)),P[0]){case"RadialAxial":const G=`shading${D++}`,R=P[3];let I;switch(P[1]){case"axial":const w=P[4],H=P[5];I=this.svgFactory.createElement("svg:linearGradient"),I.setAttributeNS(null,"id",G),I.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),I.setAttributeNS(null,"x1",w[0]),I.setAttributeNS(null,"y1",w[1]),I.setAttributeNS(null,"x2",H[0]),I.setAttributeNS(null,"y2",H[1]);break;case"radial":const V=P[4],te=P[5],ae=P[6],be=P[7];I=this.svgFactory.createElement("svg:radialGradient"),I.setAttributeNS(null,"id",G),I.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),I.setAttributeNS(null,"cx",te[0]),I.setAttributeNS(null,"cy",te[1]),I.setAttributeNS(null,"r",be),I.setAttributeNS(null,"fx",V[0]),I.setAttributeNS(null,"fy",V[1]),I.setAttributeNS(null,"fr",ae);break;default:throw new Error(`Unknown RadialAxial type: ${P[1]}`)}for(const w of R){const H=this.svgFactory.createElement("svg:stop");H.setAttributeNS(null,"offset",w[0]),H.setAttributeNS(null,"stop-color",w[1]),I.append(H)}return this.defs.append(I),`url(#${G})`;case"Mesh":return(0,r.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${P[0]}`)}}setDash(P,G){this.current.dashArray=P,this.current.dashPhase=G}constructPath(P,G){const R=this.current;let I=R.x,w=R.y,H=[],V=0;for(const te of P)switch(te|0){case r.OPS.rectangle:I=G[V++],w=G[V++];const ae=G[V++],be=G[V++],_e=I+ae,le=w+be;H.push("M",b(I),b(w),"L",b(_e),b(w),"L",b(_e),b(le),"L",b(I),b(le),"Z");break;case r.OPS.moveTo:I=G[V++],w=G[V++],H.push("M",b(I),b(w));break;case r.OPS.lineTo:I=G[V++],w=G[V++],H.push("L",b(I),b(w));break;case r.OPS.curveTo:I=G[V+4],w=G[V+5],H.push("C",b(G[V]),b(G[V+1]),b(G[V+2]),b(G[V+3]),b(I),b(w)),V+=6;break;case r.OPS.curveTo2:H.push("C",b(I),b(w),b(G[V]),b(G[V+1]),b(G[V+2]),b(G[V+3])),I=G[V+2],w=G[V+3],V+=4;break;case r.OPS.curveTo3:I=G[V+2],w=G[V+3],H.push("C",b(G[V]),b(G[V+1]),b(I),b(w),b(I),b(w)),V+=4;break;case r.OPS.closePath:H.push("Z");break}H=H.join(" "),R.path&&P.length>0&&P[0]!==r.OPS.rectangle&&P[0]!==r.OPS.moveTo?H=R.path.getAttributeNS(null,"d")+H:(R.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(R.path)),R.path.setAttributeNS(null,"d",H),R.path.setAttributeNS(null,"fill","none"),R.element=R.path,R.setCurrentPoint(I,w)}endPath(){const P=this.current;if(P.path=null,!this.pendingClip)return;if(!P.element){this.pendingClip=null;return}const G=`clippath${A++}`,R=this.svgFactory.createElement("svg:clipPath");R.setAttributeNS(null,"id",G),R.setAttributeNS(null,"transform",E(this.transformMatrix));const I=P.element.cloneNode(!0);if(this.pendingClip==="evenodd"?I.setAttributeNS(null,"clip-rule","evenodd"):I.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,R.append(I),this.defs.append(R),P.activeClipUrl){P.clipGroup=null;for(const w of this.extraStack)w.clipGroup=null;R.setAttributeNS(null,"clip-path",P.activeClipUrl)}P.activeClipUrl=`url(#${G})`,this.tgrp=null}clip(P){this.pendingClip=P}closePath(){const P=this.current;if(P.path){const G=`${P.path.getAttributeNS(null,"d")}Z`;P.path.setAttributeNS(null,"d",G)}}setLeading(P){this.current.leading=-P}setTextRise(P){this.current.textRise=P}setTextRenderingMode(P){this.current.textRenderingMode=P}setHScale(P){this.current.textHScale=P/100}setRenderingIntent(P){}setFlatness(P){}setGState(P){for(const[G,R]of P)switch(G){case"LW":this.setLineWidth(R);break;case"LC":this.setLineCap(R);break;case"LJ":this.setLineJoin(R);break;case"ML":this.setMiterLimit(R);break;case"D":this.setDash(R[0],R[1]);break;case"RI":this.setRenderingIntent(R);break;case"FL":this.setFlatness(R);break;case"Font":this.setFont(R);break;case"CA":this.setStrokeAlpha(R);break;case"ca":this.setFillAlpha(R);break;default:(0,r.warn)(`Unimplemented graphic state operator ${G}`);break}}fill(){const P=this.current;P.element&&(P.element.setAttributeNS(null,"fill",P.fillColor),P.element.setAttributeNS(null,"fill-opacity",P.fillAlpha),this.endPath())}stroke(){const P=this.current;P.element&&(this._setStrokeAttributes(P.element),P.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(P,G=1){const R=this.current;let I=R.dashArray;G!==1&&I.length>0&&(I=I.map(function(w){return G*w})),P.setAttributeNS(null,"stroke",R.strokeColor),P.setAttributeNS(null,"stroke-opacity",R.strokeAlpha),P.setAttributeNS(null,"stroke-miterlimit",b(R.miterLimit)),P.setAttributeNS(null,"stroke-linecap",R.lineCap),P.setAttributeNS(null,"stroke-linejoin",R.lineJoin),P.setAttributeNS(null,"stroke-width",b(G*R.lineWidth)+"px"),P.setAttributeNS(null,"stroke-dasharray",I.map(b).join(" ")),P.setAttributeNS(null,"stroke-dashoffset",b(G*R.dashPhase)+"px")}eoFill(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element?.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const P=this.svgFactory.createElement("svg:rect");P.setAttributeNS(null,"x","0"),P.setAttributeNS(null,"y","0"),P.setAttributeNS(null,"width","1px"),P.setAttributeNS(null,"height","1px"),P.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(P)}paintImageXObject(P){const G=this.getObject(P);if(!G){(0,r.warn)(`Dependent image with object ID ${P} is not ready yet`);return}this.paintInlineImageXObject(G)}paintInlineImageXObject(P,G){const R=P.width,I=P.height,w=g(P,this.forceDataSchema,!!G),H=this.svgFactory.createElement("svg:rect");H.setAttributeNS(null,"x","0"),H.setAttributeNS(null,"y","0"),H.setAttributeNS(null,"width",b(R)),H.setAttributeNS(null,"height",b(I)),this.current.element=H,this.clip("nonzero");const V=this.svgFactory.createElement("svg:image");V.setAttributeNS(d,"xlink:href",w),V.setAttributeNS(null,"x","0"),V.setAttributeNS(null,"y",b(-I)),V.setAttributeNS(null,"width",b(R)+"px"),V.setAttributeNS(null,"height",b(I)+"px"),V.setAttributeNS(null,"transform",`scale(${b(1/R)} ${b(-1/I)})`),G?G.append(V):this._ensureTransformGroup().append(V)}paintImageMaskXObject(P){const G=this.getObject(P.data,P);if(G.bitmap){(0,r.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const R=this.current,I=G.width,w=G.height,H=R.fillColor;R.maskId=`mask${z++}`;const V=this.svgFactory.createElement("svg:mask");V.setAttributeNS(null,"id",R.maskId);const te=this.svgFactory.createElement("svg:rect");te.setAttributeNS(null,"x","0"),te.setAttributeNS(null,"y","0"),te.setAttributeNS(null,"width",b(I)),te.setAttributeNS(null,"height",b(w)),te.setAttributeNS(null,"fill",H),te.setAttributeNS(null,"mask",`url(#${R.maskId})`),this.defs.append(V),this._ensureTransformGroup().append(te),this.paintInlineImageXObject(G,V)}paintFormXObjectBegin(P,G){if(Array.isArray(P)&&P.length===6&&this.transform(P[0],P[1],P[2],P[3],P[4],P[5]),G){const R=G[2]-G[0],I=G[3]-G[1],w=this.svgFactory.createElement("svg:rect");w.setAttributeNS(null,"x",G[0]),w.setAttributeNS(null,"y",G[1]),w.setAttributeNS(null,"width",b(R)),w.setAttributeNS(null,"height",b(I)),this.current.element=w,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(P){const G=this.svgFactory.create(P.width,P.height),R=this.svgFactory.createElement("svg:defs");G.append(R),this.defs=R;const I=this.svgFactory.createElement("svg:g");return I.setAttributeNS(null,"transform",E(P.transform)),G.append(I),this.svg=I,G}_ensureClipGroup(){if(!this.current.clipGroup){const P=this.svgFactory.createElement("svg:g");P.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(P),this.current.clipGroup=P}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",E(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}})],__webpack_module_cache__={};function __w_pdfjs_require__(i){var e=__webpack_module_cache__[i];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[i]={exports:{}};return __webpack_modules__[i](t,t.exports,__w_pdfjs_require__),t.exports}var __webpack_exports__={};return(()=>{var i=__webpack_exports__;Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"AbortException",{enumerable:!0,get:function(){return e.AbortException}}),Object.defineProperty(i,"AnnotationEditorLayer",{enumerable:!0,get:function(){return s.AnnotationEditorLayer}}),Object.defineProperty(i,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return e.AnnotationEditorParamsType}}),Object.defineProperty(i,"AnnotationEditorType",{enumerable:!0,get:function(){return e.AnnotationEditorType}}),Object.defineProperty(i,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return a.AnnotationEditorUIManager}}),Object.defineProperty(i,"AnnotationLayer",{enumerable:!0,get:function(){return l.AnnotationLayer}}),Object.defineProperty(i,"AnnotationMode",{enumerable:!0,get:function(){return e.AnnotationMode}}),Object.defineProperty(i,"CMapCompressionType",{enumerable:!0,get:function(){return e.CMapCompressionType}}),Object.defineProperty(i,"FeatureTest",{enumerable:!0,get:function(){return e.FeatureTest}}),Object.defineProperty(i,"GlobalWorkerOptions",{enumerable:!0,get:function(){return u.GlobalWorkerOptions}}),Object.defineProperty(i,"InvalidPDFException",{enumerable:!0,get:function(){return e.InvalidPDFException}}),Object.defineProperty(i,"MissingPDFException",{enumerable:!0,get:function(){return e.MissingPDFException}}),Object.defineProperty(i,"OPS",{enumerable:!0,get:function(){return e.OPS}}),Object.defineProperty(i,"PDFDataRangeTransport",{enumerable:!0,get:function(){return t.PDFDataRangeTransport}}),Object.defineProperty(i,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(i,"PDFWorker",{enumerable:!0,get:function(){return t.PDFWorker}}),Object.defineProperty(i,"PasswordResponses",{enumerable:!0,get:function(){return e.PasswordResponses}}),Object.defineProperty(i,"PermissionFlag",{enumerable:!0,get:function(){return e.PermissionFlag}}),Object.defineProperty(i,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(i,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(i,"SVGGraphics",{enumerable:!0,get:function(){return d.SVGGraphics}}),Object.defineProperty(i,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return e.UNSUPPORTED_FEATURES}}),Object.defineProperty(i,"UnexpectedResponseException",{enumerable:!0,get:function(){return e.UnexpectedResponseException}}),Object.defineProperty(i,"Util",{enumerable:!0,get:function(){return e.Util}}),Object.defineProperty(i,"VerbosityLevel",{enumerable:!0,get:function(){return e.VerbosityLevel}}),Object.defineProperty(i,"XfaLayer",{enumerable:!0,get:function(){return h.XfaLayer}}),Object.defineProperty(i,"build",{enumerable:!0,get:function(){return t.build}}),Object.defineProperty(i,"createPromiseCapability",{enumerable:!0,get:function(){return e.createPromiseCapability}}),Object.defineProperty(i,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return e.createValidAbsoluteUrl}}),Object.defineProperty(i,"getDocument",{enumerable:!0,get:function(){return t.getDocument}}),Object.defineProperty(i,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(i,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(i,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(i,"isDataScheme",{enumerable:!0,get:function(){return n.isDataScheme}}),Object.defineProperty(i,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(i,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(i,"renderTextLayer",{enumerable:!0,get:function(){return r.renderTextLayer}}),Object.defineProperty(i,"setLayerDimensions",{enumerable:!0,get:function(){return n.setLayerDimensions}}),Object.defineProperty(i,"shadow",{enumerable:!0,get:function(){return e.shadow}}),Object.defineProperty(i,"updateTextLayer",{enumerable:!0,get:function(){return r.updateTextLayer}}),Object.defineProperty(i,"version",{enumerable:!0,get:function(){return t.version}});var e=__w_pdfjs_require__(1),t=__w_pdfjs_require__(2),n=__w_pdfjs_require__(6),r=__w_pdfjs_require__(26),s=__w_pdfjs_require__(27),a=__w_pdfjs_require__(5),l=__w_pdfjs_require__(32),u=__w_pdfjs_require__(14),d=__w_pdfjs_require__(35),h=__w_pdfjs_require__(34)})(),__webpack_exports__})())})(pdf)),pdf.exports}var hasRequiredCore_min;function requireCore_min(){return hasRequiredCore_min||(hasRequiredCore_min=1,(function(i){var e=requireReact(),t=requirePdf();function n(me){var Se=Object.create(null);return me&&Object.keys(me).forEach((function(De){if(De!=="default"){var Le=Object.getOwnPropertyDescriptor(me,De);Object.defineProperty(Se,De,Le.get?Le:{enumerable:!0,get:function(){return me[De]}})}})),Se.default=me,Object.freeze(Se)}var r,s=n(e),a=n(t);i.AnnotationType=void 0,(r=i.AnnotationType||(i.AnnotationType={}))[r.Text=1]="Text",r[r.Link=2]="Link",r[r.FreeText=3]="FreeText",r[r.Line=4]="Line",r[r.Square=5]="Square",r[r.Circle=6]="Circle",r[r.Polygon=7]="Polygon",r[r.Polyline=8]="Polyline",r[r.Highlight=9]="Highlight",r[r.Underline=10]="Underline",r[r.Squiggly=11]="Squiggly",r[r.StrikeOut=12]="StrikeOut",r[r.Stamp=13]="Stamp",r[r.Caret=14]="Caret",r[r.Ink=15]="Ink",r[r.Popup=16]="Popup",r[r.FileAttachment=17]="FileAttachment";var l=function(me,Se){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(De,Le){De.__proto__=Le}||function(De,Le){for(var Be in Le)Object.prototype.hasOwnProperty.call(Le,Be)&&(De[Be]=Le[Be])},l(me,Se)};function u(me,Se){if(typeof Se!="function"&&Se!==null)throw new TypeError("Class extends value "+String(Se)+" is not a constructor or null");function De(){this.constructor=me}l(me,Se),me.prototype=Se===null?Object.create(Se):(De.prototype=Se.prototype,new De)}var d,h=function(){return h=Object.assign||function(me){for(var Se,De=1,Le=arguments.length;De<Le;De++)for(var Be in Se=arguments[De])Object.prototype.hasOwnProperty.call(Se,Be)&&(me[Be]=Se[Be]);return me},h.apply(this,arguments)};i.TextDirection=void 0,(d=i.TextDirection||(i.TextDirection={})).RightToLeft="RTL",d.LeftToRight="LTR";var p,m=s.createContext({currentTheme:"light",direction:i.TextDirection.LeftToRight,setCurrentTheme:function(){}}),g=function(me){var Se=[];return Object.keys(me).forEach((function(De){De&&me[De]&&Se.push(De)})),Se.join(" ")},v=typeof window<"u"?s.useLayoutEffect:s.useEffect,_=function(me){var Se=s.useRef(null),De=me.once,Le=me.threshold,Be=me.onVisibilityChanged;return v((function(){var je=Se.current;if(je){var Ze=new IntersectionObserver((function(Ge){Ge.forEach((function(Oe){var Ke=Oe.isIntersecting,$e=Oe.intersectionRatio;Be({isVisible:Ke,ratio:$e}),Ke&&De&&(Ze.unobserve(je),Ze.disconnect())}))}),{threshold:Le||0});return Ze.observe(je),function(){Ze.unobserve(je),Ze.disconnect()}}}),[]),Se},b=function(me){var Se=me.children,De=me.ignoreDirection,Le=De!==void 0&&De,Be=me.size,je=Be===void 0?24:Be,Ze=s.useContext(m).direction,Ge=!Le&&Ze===i.TextDirection.RightToLeft,Oe="".concat(je||24,"px");return s.createElement("svg",{"aria-hidden":"true",className:g({"rpv-core__icon":!0,"rpv-core__icon--rtl":Ge}),focusable:"false",height:Oe,viewBox:"0 0 24 24",width:Oe},Se)},E=function(){return s.createElement(b,{size:16},s.createElement("path",{d:"M23.5,0.499l-16.5,23l-6.5-6.5"}))},A=function(me){var Se=me.children,De=me.testId,Le=me.onClick,Be=s.useContext(m).direction===i.TextDirection.RightToLeft,je=De?{"data-testid":De}:{};return s.createElement("button",h({className:g({"rpv-core__primary-button":!0,"rpv-core__primary-button--rtl":Be}),type:"button",onClick:Le},je),Se)},z=function(me){var Se=me.size,De=Se===void 0?"4rem":Se,Le=me.testId,Be=s.useState(!1),je=Be[0],Ze=Be[1],Ge=Le?{"data-testid":Le}:{},Oe=_({onVisibilityChanged:function(Ke){Ze(Ke.isVisible)}});return s.createElement("div",h({},Ge,{className:g({"rpv-core__spinner":!0,"rpv-core__spinner--animating":je}),ref:Oe,style:{height:De,width:De}}))},D=function(me){var Se=me.ariaLabel,De=Se===void 0?"":Se,Le=me.autoFocus,Be=Le!==void 0&&Le,je=me.placeholder,Ze=je===void 0?"":je,Ge=me.testId,Oe=me.type,Ke=Oe===void 0?"text":Oe,$e=me.value,Gt=$e===void 0?"":$e,zt=me.onChange,qt=me.onKeyDown,En=qt===void 0?function(){}:qt,vn=s.useContext(m).direction,mn=s.useRef(),qn=vn===i.TextDirection.RightToLeft,Nn={ref:mn,"data-testid":"","aria-label":De,className:g({"rpv-core__textbox":!0,"rpv-core__textbox--rtl":qn}),placeholder:Ze,value:Gt,onChange:function(On){return zt(On.target.value)},onKeyDown:En};return Ge&&(Nn["data-testid"]=Ge),v((function(){if(Be){var On=mn.current;if(On){var Un=window.scrollX,Dn=window.scrollY;On.focus(),window.scrollTo(Un,Dn)}}}),[]),Ke==="text"?s.createElement("input",h({type:"text"},Nn)):s.createElement("input",h({type:"password"},Nn))};(function(me){me[me.ExitFullScreen=0]="ExitFullScreen",me[me.FullScreenChange=1]="FullScreenChange",me[me.FullScreenElement=2]="FullScreenElement",me[me.FullScreenEnabled=3]="FullScreenEnabled",me[me.RequestFullScreen=4]="RequestFullScreen"})(p||(p={}));var P,G={ExitFullScreen:"exitFullscreen",FullScreenChange:"fullscreenchange",FullScreenElement:"fullscreenElement",FullScreenEnabled:"fullscreenEnabled",RequestFullScreen:"requestFullscreen"},R={ExitFullScreen:"webkitExitFullscreen",FullScreenChange:"webkitfullscreenchange",FullScreenElement:"webkitFullscreenElement",FullScreenEnabled:"webkitFullscreenEnabled",RequestFullScreen:"webkitRequestFullscreen"},I={ExitFullScreen:"msExitFullscreen",FullScreenChange:"msFullscreenChange",FullScreenElement:"msFullscreenElement",FullScreenEnabled:"msFullscreenEnabled",RequestFullScreen:"msRequestFullscreen"},w=typeof window<"u",H=w&&(p.FullScreenEnabled in document&&G||R.FullScreenEnabled in document&&R||I.FullScreenEnabled in document&&I)||G,V=function(){return w&&H.FullScreenEnabled in document&&document[H.FullScreenEnabled]===!0},te=function(me){return w?me[H.ExitFullScreen]():Promise.resolve({})},ae=function(){return w?document[H.FullScreenElement]:null},be=function(me,Se){var De=s.useRef(),Le=function(){De.current&&clearTimeout(De.current)};return s.useEffect((function(){return function(){return Le()}}),[]),s.useCallback((function(){for(var Be=[],je=0;je<arguments.length;je++)Be[je]=arguments[je];Le(),De.current=setTimeout((function(){me.apply(void 0,Be)}),Se)}),[me,Se])},_e=function(){var me=s.useRef(!1);return s.useEffect((function(){return me.current=!0,function(){me.current=!1}}),[]),me},le=function(me){var Se=s.useRef(me);return s.useEffect((function(){Se.current=me}),[me]),Se.current};(function(me){me.NotRenderedYet="NotRenderedYet",me.Rendering="Rendering",me.Rendered="Rendered"})(P||(P={}));var ue,oe=-9999,ee=function(me){var Se=me.doc,De=Se.numPages,Le=Se.loadingTask.docId,Be=s.useMemo((function(){return Array(De).fill(null).map((function(Ge,Oe){return{pageIndex:Oe,renderStatus:P.NotRenderedYet,visibility:oe}}))}),[Le]),je=s.useRef({currentRenderingPage:-1,startRange:0,endRange:De-1,visibilities:Be}),Ze=function(Ge,Oe){je.current.visibilities[Ge].visibility=Oe};return{getHighestPriorityPage:function(){var Ge=je.current.visibilities.slice(je.current.startRange,je.current.endRange+1).filter((function(zt){return zt.visibility>oe}));if(!Ge.length)return-1;for(var Oe=Ge[0].pageIndex,Ke=Ge[Ge.length-1].pageIndex,$e=Ge.length,Gt=0;Gt<$e;Gt++){if(Ge[Gt].renderStatus===P.Rendering)return-1;if(Ge[Gt].renderStatus===P.NotRenderedYet)return Ge[Gt].pageIndex}return Ke+1<De&&je.current.visibilities[Ke+1].renderStatus!==P.Rendered?Ke+1:Oe-1>=0&&je.current.visibilities[Oe-1].renderStatus!==P.Rendered?Oe-1:-1},isInRange:function(Ge){return Ge>=je.current.startRange&&Ge<=je.current.endRange},markNotRendered:function(){for(var Ge=0;Ge<De;Ge++)je.current.visibilities[Ge].renderStatus=P.NotRenderedYet},markRendered:function(Ge){je.current.visibilities[Ge].renderStatus=P.Rendered},markRendering:function(Ge){je.current.currentRenderingPage!==-1&&je.current.currentRenderingPage!==Ge&&je.current.visibilities[je.current.currentRenderingPage].renderStatus===P.Rendering&&(je.current.visibilities[je.current.currentRenderingPage].renderStatus=P.NotRenderedYet),je.current.visibilities[Ge].renderStatus=P.Rendering,je.current.currentRenderingPage=Ge},setOutOfRange:function(Ge){Ze(Ge,oe)},setRange:function(Ge,Oe){je.current.startRange=Ge,je.current.endRange=Oe;for(var Ke=0;Ke<De;Ke++)(Ke<Ge||Ke>Oe)&&(je.current.visibilities[Ke].visibility=oe,je.current.visibilities[Ke].renderStatus=P.NotRenderedYet)},setVisibility:Ze}},se={core:{askingPassword:{requirePasswordToOpen:"This document requires a password to open",submit:"Submit"},wrongPassword:{tryAgain:"The password is wrong. Please try again"},pageLabel:"Page {{pageIndex}}"}},re=s.createContext({l10n:se,setL10n:function(){}}),fe=0,pe=function(){return fe++},Z=function(me,Se,De){var Le=function(Be){var je=Se.current;if(je){var Ze=Be.target;if(Ze instanceof Element&&Ze.shadowRoot){var Ge=Be.composedPath();Ge.length>0&&!je.contains(Ge[0])&&De()}else je.contains(Ze)||De()}};s.useEffect((function(){if(me){var Be={capture:!0};return document.addEventListener("click",Le,Be),function(){document.removeEventListener("click",Le,Be)}}}),[])},ce=function(me){var Se=function(De){De.key==="Escape"&&me()};s.useEffect((function(){return document.addEventListener("keyup",Se),function(){document.removeEventListener("keyup",Se)}}),[])},Ee=function(me){var Se=me.ariaControlsSuffix,De=me.children,Le=me.closeOnClickOutside,Be=me.closeOnEscape,je=me.onToggle,Ze=s.useRef(),Ge=s.useContext(m).direction===i.TextDirection.RightToLeft;return s.useEffect((function(){var Oe=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",function(){document.body.style.overflow=Oe}}),[]),ce((function(){Ze.current&&Be&&je()})),Z(Le,Ze,je),v((function(){var Oe=Ze.current;if(Oe){var Ke=.75*document.body.clientHeight;Oe.getBoundingClientRect().height>=Ke&&(Oe.style.overflow="auto",Oe.style.maxHeight="".concat(Ke,"px"))}}),[]),s.createElement("div",{"aria-modal":"true",className:g({"rpv-core__modal-body":!0,"rpv-core__modal-body--rtl":Ge}),id:"rpv-core__modal-body-".concat(Se),ref:Ze,role:"dialog",tabIndex:-1},De)},Te=function(me){var Se=me.children;return s.createElement("div",{className:"rpv-core__modal-overlay"},Se)};i.ToggleStatus=void 0,(ue=i.ToggleStatus||(i.ToggleStatus={})).Close="Close",ue.Open="Open",ue.Toggle="Toggle";var Ae,Pe=function(me){var Se=s.useState(me),De=Se[0],Le=Se[1];return{opened:De,toggle:function(Be){switch(Be){case i.ToggleStatus.Close:Le(!1);break;case i.ToggleStatus.Open:Le(!0);break;case i.ToggleStatus.Toggle:default:Le((function(je){return!je}))}}}},Me=function(me){var Se=me.content,De=me.isOpened,Le=De!==void 0&&De,Be=me.target,je=Pe(Le),Ze=je.opened,Ge=je.toggle;return s.createElement(s.Fragment,null,Be&&Be(Ge,Ze),Ze&&Se(Ge))};i.Position=void 0,(Ae=i.Position||(i.Position={})).TopLeft="TOP_LEFT",Ae.TopCenter="TOP_CENTER",Ae.TopRight="TOP_RIGHT",Ae.RightTop="RIGHT_TOP",Ae.RightCenter="RIGHT_CENTER",Ae.RightBottom="RIGHT_BOTTOM",Ae.BottomLeft="BOTTOM_LEFT",Ae.BottomCenter="BOTTOM_CENTER",Ae.BottomRight="BOTTOM_RIGHT",Ae.LeftTop="LEFT_TOP",Ae.LeftCenter="LEFT_CENTER",Ae.LeftBottom="LEFT_BOTTOM";var We,qe,Je,wt,rt,Lt,ln,dt,st=function(me,Se,De,Le,Be){v((function(){var je=Se.current,Ze=me.current,Ge=De.current;if(Ze&&je&&Ge){var Oe=Ge.getBoundingClientRect(),Ke=(function(zt,qt,En,vn){var mn=qt.getBoundingClientRect(),qn=zt.getBoundingClientRect(),Nn=qn.height,On=qn.width,Un=0,Dn=0;switch(En){case i.Position.TopLeft:Un=mn.top-Nn,Dn=mn.left;break;case i.Position.TopCenter:Un=mn.top-Nn,Dn=mn.left+mn.width/2-On/2;break;case i.Position.TopRight:Un=mn.top-Nn,Dn=mn.left+mn.width-On;break;case i.Position.RightTop:Un=mn.top,Dn=mn.left+mn.width;break;case i.Position.RightCenter:Un=mn.top+mn.height/2-Nn/2,Dn=mn.left+mn.width;break;case i.Position.RightBottom:Un=mn.top+mn.height-Nn,Dn=mn.left+mn.width;break;case i.Position.BottomLeft:Un=mn.top+mn.height,Dn=mn.left;break;case i.Position.BottomCenter:Un=mn.top+mn.height,Dn=mn.left+mn.width/2-On/2;break;case i.Position.BottomRight:Un=mn.top+mn.height,Dn=mn.left+mn.width-On;break;case i.Position.LeftTop:Un=mn.top,Dn=mn.left-On;break;case i.Position.LeftCenter:Un=mn.top+mn.height/2-Nn/2,Dn=mn.left-On;break;case i.Position.LeftBottom:Un=mn.top+mn.height-Nn,Dn=mn.left-On}return{left:Dn+(vn.left||0),top:Un+(vn.top||0)}})(Ze,je,Le,Be),$e=Ke.top,Gt=Ke.left;Ze.style.top="".concat($e-Oe.top,"px"),Ze.style.left="".concat(Gt-Oe.left,"px")}}),[])},nt=function(me){var Se,De=me.customClassName,Le=me.position;return s.createElement("div",{className:g((Se={"rpv-core__arrow":!0,"rpv-core__arrow--tl":Le===i.Position.TopLeft,"rpv-core__arrow--tc":Le===i.Position.TopCenter,"rpv-core__arrow--tr":Le===i.Position.TopRight,"rpv-core__arrow--rt":Le===i.Position.RightTop,"rpv-core__arrow--rc":Le===i.Position.RightCenter,"rpv-core__arrow--rb":Le===i.Position.RightBottom,"rpv-core__arrow--bl":Le===i.Position.BottomLeft,"rpv-core__arrow--bc":Le===i.Position.BottomCenter,"rpv-core__arrow--br":Le===i.Position.BottomRight,"rpv-core__arrow--lt":Le===i.Position.LeftTop,"rpv-core__arrow--lc":Le===i.Position.LeftCenter,"rpv-core__arrow--lb":Le===i.Position.LeftBottom},Se["".concat(De)]=De!=="",Se))})},dn=function(me){var Se=me.ariaControlsSuffix,De=me.children,Le=me.closeOnClickOutside,Be=me.offset,je=me.position,Ze=me.targetRef,Ge=me.onClose,Oe=s.useRef(),Ke=s.useRef(),$e=s.useRef(),Gt=s.useContext(m).direction===i.TextDirection.RightToLeft;Z(Le,Oe,Ge),st(Oe,Ze,$e,je,Be),v((function(){var qt=Ke.current;if(qt){var En=.75*document.body.clientHeight;qt.getBoundingClientRect().height>=En&&(qt.style.overflow="auto",qt.style.maxHeight="".concat(En,"px"))}}),[]);var zt="rpv-core__popover-body-inner-".concat(Se);return s.createElement(s.Fragment,null,s.createElement("div",{ref:$e,style:{left:0,position:"absolute",top:0}}),s.createElement("div",{"aria-describedby":zt,className:g({"rpv-core__popover-body":!0,"rpv-core__popover-body--rtl":Gt}),id:"rpv-core__popover-body-".concat(Se),ref:Oe,role:"dialog",tabIndex:-1},s.createElement(nt,{customClassName:"rpv-core__popover-body-arrow",position:je}),s.createElement("div",{id:zt,ref:Ke},De)))},pn=function(me){var Se=me.closeOnEscape,De=me.onClose,Le=s.useRef();return ce((function(){Le.current&&Se&&De()})),s.createElement("div",{className:"rpv-core__popover-overlay",ref:Le})},An=function(me){var Se=me.ariaControlsSuffix,De=me.children,Le=me.contentRef,Be=me.offset,je=me.position,Ze=me.targetRef,Ge=s.useRef(),Oe=s.useContext(m).direction===i.TextDirection.RightToLeft;return st(Le,Ze,Ge,je,Be),s.createElement(s.Fragment,null,s.createElement("div",{ref:Ge,style:{left:0,position:"absolute",top:0}}),s.createElement("div",{className:g({"rpv-core__tooltip-body":!0,"rpv-core__tooltip-body--rtl":Oe}),id:"rpv-core__tooltip-body-".concat(Se),ref:Le,role:"tooltip"},s.createElement(nt,{customClassName:"rpv-core__tooltip-body-arrow",position:je}),s.createElement("div",{className:"rpv-core__tooltip-body-content"},De)))};i.FullScreenMode=void 0,(We=i.FullScreenMode||(i.FullScreenMode={})).Normal="Normal",We.Entering="Entering",We.Entered="Entered",We.EnteredCompletely="EnteredCompletely",We.Exitting="Exitting",We.Exited="Exited",i.LayerRenderStatus=void 0,(qe=i.LayerRenderStatus||(i.LayerRenderStatus={}))[qe.PreRender=0]="PreRender",qe[qe.DidRender=1]="DidRender",i.PageMode=void 0,(Je=i.PageMode||(i.PageMode={})).Attachments="UseAttachments",Je.Bookmarks="UseOutlines",Je.ContentGroup="UseOC",Je.Default="UserNone",Je.FullScreen="FullScreen",Je.Thumbnails="UseThumbs",i.PasswordStatus=void 0,(wt=i.PasswordStatus||(i.PasswordStatus={})).RequiredPassword="RequiredPassword",wt.WrongPassword="WrongPassword",i.RotateDirection=void 0,(rt=i.RotateDirection||(i.RotateDirection={})).Backward="Backward",rt.Forward="Forward",i.ScrollMode=void 0,(Lt=i.ScrollMode||(i.ScrollMode={})).Page="Page",Lt.Horizontal="Horizontal",Lt.Vertical="Vertical",Lt.Wrapped="Wrapped",i.SpecialZoomLevel=void 0,(ln=i.SpecialZoomLevel||(i.SpecialZoomLevel={})).ActualSize="ActualSize",ln.PageFit="PageFit",ln.PageWidth="PageWidth",i.ViewMode=void 0,(dt=i.ViewMode||(i.ViewMode={})).DualPage="DualPage",dt.DualPageWithCover="DualPageWithCover",dt.SinglePage="SinglePage";var In,Jn=function(me,Se){return me.reduce((function(De,Le,Be){return Be%Se?De[De.length-1].push(Le):De.push([Le]),De}),[])},ri=function(me,Se){switch(Se[1].name){case"XYZ":return{bottomOffset:function(De,Le){return Se[3]===null?Le:Se[3]},leftOffset:function(De,Le){return Se[2]===null?0:Se[2]},pageIndex:me,scaleTo:Se[4]};case"Fit":case"FitB":return{bottomOffset:0,leftOffset:0,pageIndex:me,scaleTo:i.SpecialZoomLevel.PageFit};case"FitH":case"FitBH":return{bottomOffset:Se[2],leftOffset:0,pageIndex:me,scaleTo:i.SpecialZoomLevel.PageWidth};default:return{bottomOffset:0,leftOffset:0,pageIndex:me,scaleTo:1}}},Wn=new Map,hi=new Map,ai=function(me,Se){return"".concat(me.loadingTask.docId,"___").concat(Se.num,"R").concat(Se.gen===0?"":Se.gen)},Zn=function(me,Se,De){Wn.set(ai(me,Se),De)},Ft=function(me,Se){if(!me)return Promise.reject("The document is not loaded yet");var De="".concat(me.loadingTask.docId,"___").concat(Se),Le=hi.get(De);return Le?Promise.resolve(Le):new Promise((function(Be,je){me.getPage(Se+1).then((function(Ze){hi.set(De,Ze),Ze.ref&&Zn(me,Ze.ref,Se),Be(Ze)}))}))},Xe=function(me,Se){return new Promise((function(De){new Promise((function(Le){typeof Se=="string"?me.getDestination(Se).then((function(Be){Le(Be)})):Le(Se)})).then((function(Le){if(typeof Le[0]=="object"&&Le[0]!==null){var Be=Le[0],je=(function(Ge,Oe){var Ke=ai(Ge,Oe);return Wn.has(Ke)?Wn.get(Ke):null})(me,Be);je===null?me.getPageIndex(Be).then((function(Ge){Zn(me,Be,Ge),Xe(me,Se).then((function(Oe){return De(Oe)}))})):De(ri(je,Le))}else{var Ze=ri(Le[0],Le);De(Ze)}}))}))};(function(me){me[me.Solid=1]="Solid",me[me.Dashed=2]="Dashed",me[me.Beveled=3]="Beveled",me[me.Inset=4]="Inset",me[me.Underline=5]="Underline"})(In||(In={}));var Ye,xn=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"),Vn=function(me,Se,De,Le){var Be=parseInt(me,10);return Be>=Se&&Be<=De?Be:Le},Bn=function(me){return me.contentsObj?me.contentsObj.str:me.contents||""},si=function(me){return me.titleObj?me.titleObj.str:me.title||""},Yi=function(me){var Se=me.annotation,De=s.useContext(m).direction,Le=si(Se),Be=Bn(Se),je=De===i.TextDirection.RightToLeft,Ze=s.useRef(),Ge="";if(Se.modificationDate){var Oe=(function(Ke){var $e=xn.exec(Ke);if(!$e)return null;var Gt=parseInt($e[1],10),zt=Vn($e[2],1,12,1)-1,qt=Vn($e[3],1,31,1),En=Vn($e[4],0,23,0),vn=Vn($e[5],0,59,0),mn=Vn($e[6],0,59,0),qn=$e[7]||"Z",Nn=Vn($e[8],0,23,0),On=Vn($e[9],0,59,0);switch(qn){case"-":En+=Nn,vn+=On;break;case"+":En-=Nn,vn-=On}return new Date(Date.UTC(Gt,zt,qt,En,vn,mn))})(Se.modificationDate);Ge=Oe?"".concat(Oe.toLocaleDateString(),", ").concat(Oe.toLocaleTimeString()):""}return s.useLayoutEffect((function(){if(Ze.current){var Ke=document.querySelector('[data-annotation-id="'.concat(Se.id,'"]'));if(Ke){var $e=Ke;return $e.style.zIndex+=1,function(){$e.style.zIndex="".concat(parseInt($e.style.zIndex,10)-1)}}}}),[]),s.createElement("div",{ref:Ze,className:g({"rpv-core__annotation-popup-wrapper":!0,"rpv-core__annotation-popup-wrapper--rtl":je}),style:{top:Se.annotationType===i.AnnotationType.Popup?"":"100%"}},Le&&s.createElement(s.Fragment,null,s.createElement("div",{className:g({"rpv-core__annotation-popup-title":!0,"rpv-core__annotation-popup-title--ltr":!je,"rpv-core__annotation-popup-title--rtl":je})},Le),s.createElement("div",{className:"rpv-core__annotation-popup-date"},Ge)),Be&&s.createElement("div",{className:"rpv-core__annotation-popup-content"},Be.split(`
`).map((function(Ke,$e){return s.createElement(s.Fragment,{key:$e},Ke,s.createElement("br",null))}))))};(function(me){me.Click="Click",me.Hover="Hover"})(Ye||(Ye={}));var ei,oi=function(me){var Se,De=me.annotation,Le=me.children,Be=me.ignoreBorder,je=me.hasPopup,Ze=me.isRenderable,Ge=me.page,Oe=me.viewport,Ke=De.rect,$e=(function(){var Ln=Pe(!1),pi=Ln.opened,ui=Ln.toggle,mi=s.useState(Ye.Hover),ni=mi[0],di=mi[1];return{opened:pi,closeOnHover:function(){ni===Ye.Hover&&ui(i.ToggleStatus.Close)},openOnHover:function(){ni===Ye.Hover&&ui(i.ToggleStatus.Open)},toggleOnClick:function(){switch(ni){case Ye.Click:pi&&di(Ye.Hover),ui(i.ToggleStatus.Toggle);break;case Ye.Hover:di(Ye.Click),ui(i.ToggleStatus.Open)}}}})(),Gt=$e.closeOnHover,zt=$e.opened,qt=$e.openOnHover,En=$e.toggleOnClick,vn=(Se=[Ke[0],Ge.view[3]+Ge.view[1]-Ke[1],Ke[2],Ge.view[3]+Ge.view[1]-Ke[3]],[Math.min(Se[0],Se[2]),Math.min(Se[1],Se[3]),Math.max(Se[0],Se[2]),Math.max(Se[1],Se[3])]),mn=Ke[2]-Ke[0],qn=Ke[3]-Ke[1],Nn={borderColor:"",borderRadius:"",borderStyle:"",borderWidth:""};if(!Be&&De.borderStyle.width>0){switch(De.borderStyle.style){case In.Dashed:Nn.borderStyle="dashed";break;case In.Solid:Nn.borderStyle="solid";break;case In.Underline:Nn=Object.assign({borderBottomStyle:"solid"},Nn);case In.Beveled:case In.Inset:}var On=De.borderStyle.width;Nn.borderWidth="".concat(On,"px"),De.borderStyle.style!==In.Underline&&(mn-=2*On,qn-=2*On);var Un=De.borderStyle,Dn=Un.horizontalCornerRadius,Gn=Un.verticalCornerRadius;(Dn>0||Gn>0)&&(Nn.borderRadius="".concat(Dn,"px / ").concat(Gn,"px")),De.color?Nn.borderColor="rgb(".concat(0|De.color[0],", ").concat(0|De.color[1],", ").concat(0|De.color[2],")"):Nn.borderWidth="0"}return s.createElement(s.Fragment,null,Ze&&Le({popup:{opened:zt,closeOnHover:Gt,openOnHover:qt,toggleOnClick:En},slot:{attrs:{style:Object.assign({height:"".concat(qn,"px"),left:"".concat(vn[0],"px"),top:"".concat(vn[1],"px"),transform:"matrix(".concat(Oe.transform.join(","),")"),transformOrigin:"-".concat(vn[0],"px -").concat(vn[1],"px"),width:"".concat(mn,"px")},Nn)},children:s.createElement(s.Fragment,null,je&&zt&&s.createElement(Yi,{annotation:De}))}}))},Li=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=Se.hasPopup===!1,je=si(Se),Ze=Bn(Se),Ge=!!(Se.hasPopup||je||Ze);return s.createElement(oi,{annotation:Se,hasPopup:Be,ignoreBorder:!0,isRenderable:Ge,page:De,viewport:Le},(function(Oe){return s.createElement("div",h({},Oe.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--caret","data-annotation-id":Se.id,onClick:Oe.popup.toggleOnClick,onMouseEnter:Oe.popup.openOnHover,onMouseLeave:Oe.popup.closeOnHover}),Oe.slot.children)}))},xe=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=Se.hasPopup===!1,je=si(Se),Ze=Bn(Se),Ge=!!(Se.hasPopup||je||Ze),Oe=Se.rect,Ke=Oe[2]-Oe[0],$e=Oe[3]-Oe[1],Gt=Se.borderStyle.width;return s.createElement(oi,{annotation:Se,hasPopup:Be,ignoreBorder:!0,isRenderable:Ge,page:De,viewport:Le},(function(zt){return s.createElement("div",h({},zt.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--circle","data-annotation-id":Se.id,onClick:zt.popup.toggleOnClick,onMouseEnter:zt.popup.openOnHover,onMouseLeave:zt.popup.closeOnHover}),s.createElement("svg",{height:"".concat($e,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(Ke," ").concat($e),width:"".concat(Ke,"px")},s.createElement("circle",{cy:$e/2,fill:"none",rx:Ke/2-Gt/2,ry:$e/2-Gt/2,stroke:"transparent",strokeWidth:Gt||1})),zt.slot.children)}))},Ce=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=si(Se),je=Bn(Se),Ze=!(Se.hasPopup!==!1||!Be&&!je),Ge=function(){var Oe,Ke,$e,Gt,zt=Se.file;zt&&(Oe=zt.filename,Ke=zt.content,$e=typeof Ke=="string"?"":URL.createObjectURL(new Blob([Ke],{type:""})),(Gt=document.createElement("a")).style.display="none",Gt.href=$e||Oe,Gt.setAttribute("download",(function(qt){var En=qt.split("/").pop();return En?En.split("#")[0].split("?")[0]:qt})(Oe)),document.body.appendChild(Gt),Gt.click(),document.body.removeChild(Gt),$e&&URL.revokeObjectURL($e))};return s.createElement(oi,{annotation:Se,hasPopup:Ze,ignoreBorder:!0,isRenderable:!0,page:De,viewport:Le},(function(Oe){return s.createElement("div",h({},Oe.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--file-attachment","data-annotation-id":Se.id,onClick:Oe.popup.toggleOnClick,onDoubleClick:Ge,onMouseEnter:Oe.popup.openOnHover,onMouseLeave:Oe.popup.closeOnHover}),Oe.slot.children)}))},Fe=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=Se.hasPopup===!1,je=si(Se),Ze=Bn(Se),Ge=!!(Se.hasPopup||je||Ze);return s.createElement(oi,{annotation:Se,hasPopup:Be,ignoreBorder:!0,isRenderable:Ge,page:De,viewport:Le},(function(Oe){return s.createElement("div",h({},Oe.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--free-text","data-annotation-id":Se.id,onClick:Oe.popup.toggleOnClick,onMouseEnter:Oe.popup.openOnHover,onMouseLeave:Oe.popup.closeOnHover}),Oe.slot.children)}))},tt=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=si(Se),je=Bn(Se),Ze=!(!Be&&!je),Ge=!Se.parentType||["Circle","Ink","Line","Polygon","PolyLine","Square"].indexOf(Se.parentType)!==-1;return v((function(){if(Se.parentId){var Oe=document.querySelector('[data-annotation-id="'.concat(Se.parentId,'"]')),Ke=document.querySelector('[data-annotation-id="'.concat(Se.id,'"]'));if(Oe&&Ke){var $e=parseFloat(Oe.style.left),Gt=parseFloat(Oe.style.top)+parseFloat(Oe.style.height);Ke.style.left="".concat($e,"px"),Ke.style.top="".concat(Gt,"px"),Ke.style.transformOrigin="-".concat($e,"px -").concat(Gt,"px")}}}),[]),s.createElement(oi,{annotation:Se,hasPopup:Ge,ignoreBorder:!1,isRenderable:Ze,page:De,viewport:Le},(function(Oe){return s.createElement("div",h({},Oe.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--popup","data-annotation-id":Se.id}),s.createElement(Yi,{annotation:Se}))}))},Tn=function(me){var Se=me.annotation,De=me.childAnnotation,Le=me.page,Be=me.viewport,je=Se.hasPopup===!1,Ze=si(Se),Ge=Bn(Se),Oe=!!(Se.hasPopup||Ze||Ge);if(Se.quadPoints&&Se.quadPoints.length>0){var Ke=Se.quadPoints.map((function($e){return Object.assign({},Se,{rect:[$e[2].x,$e[2].y,$e[1].x,$e[1].y],quadPoints:[]})}));return s.createElement(s.Fragment,null,Ke.map((function($e,Gt){return s.createElement(Tn,{key:Gt,annotation:$e,childAnnotation:De,page:Le,viewport:Be})})))}return s.createElement(oi,{annotation:Se,hasPopup:je,ignoreBorder:!0,isRenderable:Oe,page:Le,viewport:Be},(function($e){return s.createElement(s.Fragment,null,s.createElement("div",h({},$e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--highlight","data-annotation-id":Se.id,onClick:$e.popup.toggleOnClick,onMouseEnter:$e.popup.openOnHover,onMouseLeave:$e.popup.closeOnHover}),$e.slot.children),De&&De.annotationType===i.AnnotationType.Popup&&$e.popup.opened&&s.createElement(tt,{annotation:De,page:Le,viewport:Be}))}))},jn=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=Se.hasPopup===!1,je=si(Se),Ze=Bn(Se),Ge=!!(Se.hasPopup||je||Ze),Oe=Se.rect,Ke=Oe[2]-Oe[0],$e=Oe[3]-Oe[1],Gt=Se.borderStyle.width;return s.createElement(oi,{annotation:Se,hasPopup:Be,ignoreBorder:!0,isRenderable:Ge,page:De,viewport:Le},(function(zt){return s.createElement("div",h({},zt.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--ink","data-annotation-id":Se.id,onClick:zt.popup.toggleOnClick,onMouseEnter:zt.popup.openOnHover,onMouseLeave:zt.popup.closeOnHover}),Se.inkLists&&Se.inkLists.length&&s.createElement("svg",{height:"".concat($e,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(Ke," ").concat($e),width:"".concat(Ke,"px")},Se.inkLists.map((function(qt,En){return s.createElement("polyline",{key:En,fill:"none",stroke:"transparent",strokeWidth:Gt||1,points:qt.map((function(vn){return"".concat(vn.x-Oe[0],",").concat(Oe[3]-vn.y)})).join(" ")})}))),zt.slot.children)}))},li=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=Se.hasPopup===!1,je=si(Se),Ze=Bn(Se),Ge=!!(Se.hasPopup||je||Ze),Oe=Se.rect,Ke=Oe[2]-Oe[0],$e=Oe[3]-Oe[1],Gt=Se.borderStyle.width;return s.createElement(oi,{annotation:Se,hasPopup:Be,ignoreBorder:!0,isRenderable:Ge,page:De,viewport:Le},(function(zt){return s.createElement("div",h({},zt.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--line","data-annotation-id":Se.id,onClick:zt.popup.toggleOnClick,onMouseEnter:zt.popup.openOnHover,onMouseLeave:zt.popup.closeOnHover}),s.createElement("svg",{height:"".concat($e,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(Ke," ").concat($e),width:"".concat(Ke,"px")},s.createElement("line",{stroke:"transparent",strokeWidth:Gt||1,x1:Oe[2]-Se.lineCoordinates[0],x2:Oe[2]-Se.lineCoordinates[2],y1:Oe[3]-Se.lineCoordinates[1],y2:Oe[3]-Se.lineCoordinates[3]})),zt.slot.children)}))},Fi=/^([^\w]*)(javascript|data|vbscript)/im,Qi=/&#(\w+)(^\w|;)?/g,Di=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,nr=/^([^:]+):/gm,gr=function(me,Se){var De,Le=(De=me||"",De.replace(Qi,(function(Ge,Oe){return String.fromCharCode(Oe)}))).replace(Di,"").trim();if(!Le)return Se;var Be=Le[0];if(Be==="."||Be==="/")return Le;var je=Le.match(nr);if(!je)return Le;var Ze=je[0];return Fi.test(Ze)?Se:Le},br=function(me){var Se,De=me.annotation,Le=me.annotationContainerRef,Be=me.doc,je=me.outlines,Ze=me.page,Ge=me.pageIndex,Oe=me.scale,Ke=me.viewport,$e=me.onExecuteNamedAction,Gt=me.onJumpFromLinkAnnotation,zt=me.onJumpToDest,qt=s.useRef(),En=je&&je.length&&De.dest&&typeof De.dest=="string"?(Se=je.find((function(Nn){return Nn.dest===De.dest})))===null||Se===void 0?void 0:Se.title:"",vn=!!(De.url||De.dest||De.action||De.unsafeUrl),mn={};if(De.url||De.unsafeUrl){var qn=gr(De.url||De.unsafeUrl,"");qn?mn={"data-target":"external",href:qn,rel:"noopener noreferrer nofollow",target:De.newWindow?"_blank":"",title:qn}:vn=!1}else mn={href:"","data-annotation-link":De.id,onClick:function(Nn){Nn.preventDefault(),De.action?$e(De.action):Xe(Be,De.dest).then((function(On){var Un=qt.current,Dn=Le.current;if(Un&&Dn){var Gn=Un.getBoundingClientRect();Dn.style.setProperty("height","100%"),Dn.style.setProperty("width","100%");var Ln=Dn.getBoundingClientRect();Dn.style.removeProperty("height"),Dn.style.removeProperty("width");var pi=(Gn.left-Ln.left)/Oe,ui=(Ln.bottom-Gn.bottom+Gn.height)/Oe;Gt({bottomOffset:ui,label:En,leftOffset:pi,pageIndex:Ge})}zt(On)}))}};return En&&(mn=Object.assign({},mn,{title:En,"aria-label":En})),s.createElement(oi,{annotation:De,hasPopup:!1,ignoreBorder:!1,isRenderable:vn,page:Ze,viewport:Ke},(function(Nn){return s.createElement("div",h({},Nn.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--link","data-annotation-id":De.id,"data-testid":"core__annotation--link-".concat(De.id)}),s.createElement("a",h({ref:qt},mn)))}))},Vi=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=Se.hasPopup===!1,je=si(Se),Ze=Bn(Se),Ge=!!(Se.hasPopup||je||Ze),Oe=Se.rect,Ke=Oe[2]-Oe[0],$e=Oe[3]-Oe[1],Gt=Se.borderStyle.width;return s.createElement(oi,{annotation:Se,hasPopup:Be,ignoreBorder:!0,isRenderable:Ge,page:De,viewport:Le},(function(zt){return s.createElement("div",h({},zt.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--polygon","data-annotation-id":Se.id,onClick:zt.popup.toggleOnClick,onMouseEnter:zt.popup.openOnHover,onMouseLeave:zt.popup.closeOnHover}),Se.vertices&&Se.vertices.length&&s.createElement("svg",{height:"".concat($e,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(Ke," ").concat($e),width:"".concat(Ke,"px")},s.createElement("polygon",{fill:"none",stroke:"transparent",strokeWidth:Gt||1,points:Se.vertices.map((function(qt){return"".concat(qt.x-Oe[0],",").concat(Oe[3]-qt.y)})).join(" ")})),zt.slot.children)}))},$r=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=Se.hasPopup===!1,je=si(Se),Ze=Bn(Se),Ge=!!(Se.hasPopup||je||Ze),Oe=Se.rect,Ke=Oe[2]-Oe[0],$e=Oe[3]-Oe[1],Gt=Se.borderStyle.width;return s.createElement(oi,{annotation:Se,hasPopup:Be,ignoreBorder:!0,isRenderable:Ge,page:De,viewport:Le},(function(zt){return s.createElement("div",h({},zt.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--polyline","data-annotation-id":Se.id,onClick:zt.popup.toggleOnClick,onMouseEnter:zt.popup.openOnHover,onMouseLeave:zt.popup.closeOnHover}),Se.vertices&&Se.vertices.length&&s.createElement("svg",{height:"".concat($e,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(Ke," ").concat($e),width:"".concat(Ke,"px")},s.createElement("polyline",{fill:"none",stroke:"transparent",strokeWidth:Gt||1,points:Se.vertices.map((function(qt){return"".concat(qt.x-Oe[0],",").concat(Oe[3]-qt.y)})).join(" ")})),zt.slot.children)}))},wr=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=Se.hasPopup===!1,je=si(Se),Ze=Bn(Se),Ge=!!(Se.hasPopup||je||Ze),Oe=Se.rect,Ke=Oe[2]-Oe[0],$e=Oe[3]-Oe[1],Gt=Se.borderStyle.width;return s.createElement(oi,{annotation:Se,hasPopup:Be,ignoreBorder:!0,isRenderable:Ge,page:De,viewport:Le},(function(zt){return s.createElement("div",h({},zt.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--square","data-annotation-id":Se.id,onClick:zt.popup.toggleOnClick,onMouseEnter:zt.popup.openOnHover,onMouseLeave:zt.popup.closeOnHover}),s.createElement("svg",{height:"".concat($e,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(Ke," ").concat($e),width:"".concat(Ke,"px")},s.createElement("rect",{height:$e-Gt,fill:"none",stroke:"transparent",strokeWidth:Gt||1,x:Gt/2,y:Gt/2,width:Ke-Gt})),zt.slot.children)}))},Er=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=Se.hasPopup===!1,je=si(Se),Ze=Bn(Se),Ge=!!(Se.hasPopup||je||Ze);return s.createElement(oi,{annotation:Se,hasPopup:Be,ignoreBorder:!0,isRenderable:Ge,page:De,viewport:Le},(function(Oe){return s.createElement("div",h({},Oe.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--squiggly","data-annotation-id":Se.id,onClick:Oe.popup.toggleOnClick,onMouseEnter:Oe.popup.openOnHover,onMouseLeave:Oe.popup.closeOnHover}),Oe.slot.children)}))},ci=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=Se.hasPopup===!1,je=si(Se),Ze=Bn(Se),Ge=!!(Se.hasPopup||je||Ze);return s.createElement(oi,{annotation:Se,hasPopup:Be,ignoreBorder:!0,isRenderable:Ge,page:De,viewport:Le},(function(Oe){return s.createElement("div",h({},Oe.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--stamp","data-annotation-id":Se.id,onClick:Oe.popup.toggleOnClick,onMouseEnter:Oe.popup.openOnHover,onMouseLeave:Oe.popup.closeOnHover}),Oe.slot.children)}))},ir=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=Se.hasPopup===!1,je=si(Se),Ze=Bn(Se),Ge=!!(Se.hasPopup||je||Ze);return s.createElement(oi,{annotation:Se,hasPopup:Be,ignoreBorder:!0,isRenderable:Ge,page:De,viewport:Le},(function(Oe){return s.createElement("div",h({},Oe.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--strike-out","data-annotation-id":Se.id,onClick:Oe.popup.toggleOnClick,onMouseEnter:Oe.popup.openOnHover,onMouseLeave:Oe.popup.closeOnHover}),Oe.slot.children)}))},fi=function(){return s.createElement(b,{size:16},s.createElement("path",{d:"M.5,16.5a1,1,0,0,0,1,1h2v4l4-4h15a1,1,0,0,0,1-1V3.5a1,1,0,0,0-1-1H1.5a1,1,0,0,0-1,1Z"}),s.createElement("path",{d:"M7.25,9.75A.25.25,0,1,1,7,10a.25.25,0,0,1,.25-.25"}),s.createElement("path",{d:"M12,9.75a.25.25,0,1,1-.25.25A.25.25,0,0,1,12,9.75"}),s.createElement("path",{d:"M16.75,9.75a.25.25,0,1,1-.25.25.25.25,0,0,1,.25-.25"}))},Bs=function(){return s.createElement(b,{size:16},s.createElement("path",{d:"M0.500 12.001 A11.500 11.500 0 1 0 23.500 12.001 A11.500 11.500 0 1 0 0.500 12.001 Z"}),s.createElement("path",{d:"M6.000 12.001 A6.000 6.000 0 1 0 18.000 12.001 A6.000 6.000 0 1 0 6.000 12.001 Z"}),s.createElement("path",{d:"M21.423 5.406L17.415 9.414"}),s.createElement("path",{d:"M14.587 6.585L18.607 2.565"}),s.createElement("path",{d:"M5.405 21.424L9.413 17.416"}),s.createElement("path",{d:"M6.585 14.588L2.577 18.596"}),s.createElement("path",{d:"M18.602 21.419L14.595 17.412"}),s.createElement("path",{d:"M17.419 14.58L21.428 18.589"}),s.createElement("path",{d:"M2.582 5.399L6.588 9.406"}),s.createElement("path",{d:"M9.421 6.581L5.412 2.572"}))},Ra=function(){return s.createElement(b,{size:16},s.createElement("path",{d:"M4.000 18.500 A1.500 1.500 0 1 0 7.000 18.500 A1.500 1.500 0 1 0 4.000 18.500 Z"}),s.createElement("path",{d:"M20.5.5l-9.782,9.783a7,7,0,1,0,3,3L17,10h1.5V8.5L19,8h1.5V6.5L21,6h1.5V4.5l1-1V.5Z"}))},ua=function(){return s.createElement(b,{size:16},s.createElement("path",{d:"M2.000 2.500 L22.000 2.500 L22.000 23.500 L2.000 23.500 Z"}),s.createElement("path",{d:"M6 4.5L6 0.5"}),s.createElement("path",{d:"M18 4.5L18 0.5"}),s.createElement("path",{d:"M10 4.5L10 0.5"}),s.createElement("path",{d:"M14 4.5L14 0.5"}))},yo=function(){return s.createElement(b,{size:16},s.createElement("path",{d:"M17.5 0.498L17.5 23.498"}),s.createElement("path",{d:"M10.5 0.498L10.5 23.498"}),s.createElement("path",{d:"M23.5.5H6.5a6,6,0,0,0,0,12h4"}))},Vr=function(){return s.createElement(b,{size:16},s.createElement("path",{d:"M2.5 22.995L12 6.005 21.5 22.995 2.5 22.995z"}))},Ui=function(me){var Se=me.annotation,De=me.childAnnotation,Le=me.page,Be=me.viewport,je=Se.hasPopup===!1,Ze=si(Se),Ge=Bn(Se),Oe=!!(Se.hasPopup||Ze||Ge),Ke=Se.name?Se.name.toLowerCase():"";return s.createElement(oi,{annotation:Se,hasPopup:je,ignoreBorder:!1,isRenderable:Oe,page:Le,viewport:Be},(function($e){return s.createElement(s.Fragment,null,s.createElement("div",h({},$e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--text","data-annotation-id":Se.id,onClick:$e.popup.toggleOnClick,onMouseEnter:$e.popup.openOnHover,onMouseLeave:$e.popup.closeOnHover}),Ke&&s.createElement("div",{className:"rpv-core__annotation-text-icon"},Ke==="check"&&s.createElement(E,null),Ke==="comment"&&s.createElement(fi,null),Ke==="help"&&s.createElement(Bs,null),Ke==="insert"&&s.createElement(Vr,null),Ke==="key"&&s.createElement(Ra,null),Ke==="note"&&s.createElement(ua,null),(Ke==="newparagraph"||Ke==="paragraph")&&s.createElement(yo,null)),$e.slot.children),De&&De.annotationType===i.AnnotationType.Popup&&$e.popup.opened&&s.createElement(tt,{annotation:De,page:Le,viewport:Be}))}))},fs=function(me){var Se=me.annotation,De=me.page,Le=me.viewport,Be=Se.hasPopup===!1,je=si(Se),Ze=Bn(Se),Ge=!!(Se.hasPopup||je||Ze);return s.createElement(oi,{annotation:Se,hasPopup:Be,ignoreBorder:!0,isRenderable:Ge,page:De,viewport:Le},(function(Oe){return s.createElement("div",h({},Oe.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--underline","data-annotation-id":Se.id,onClick:Oe.popup.toggleOnClick,onMouseEnter:Oe.popup.openOnHover,onMouseLeave:Oe.popup.closeOnHover}),Oe.slot.children)}))},Gr=function(me){var Se=me.annotations,De=me.doc,Le=me.outlines,Be=me.page,je=me.pageIndex,Ze=me.plugins,Ge=me.rotation,Oe=me.scale,Ke=me.onExecuteNamedAction,$e=me.onJumpFromLinkAnnotation,Gt=me.onJumpToDest,zt=s.useRef(),qt=Be.getViewport({rotation:Ge,scale:Oe}).clone({dontFlip:!0}),En=Se.filter((function(vn){return!vn.parentId}));return v((function(){var vn=zt.current;vn&&Ze.forEach((function(mn){mn.onAnnotationLayerRender&&mn.onAnnotationLayerRender({annotations:En,container:vn,pageIndex:je,rotation:Ge,scale:Oe})}))}),[]),s.createElement("div",{ref:zt,className:"rpv-core__annotation-layer","data-testid":"core__annotation-layer-".concat(je)},En.map((function(vn){var mn=Se.find((function(qn){return qn.parentId===vn.id}));switch(vn.annotationType){case i.AnnotationType.Caret:return s.createElement(Li,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.Circle:return s.createElement(xe,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.FileAttachment:return s.createElement(Ce,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.FreeText:return s.createElement(Fe,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.Highlight:return s.createElement(Tn,{key:vn.id,annotation:vn,childAnnotation:mn,page:Be,viewport:qt});case i.AnnotationType.Ink:return s.createElement(jn,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.Line:return s.createElement(li,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.Link:return s.createElement(br,{key:vn.id,annotation:vn,annotationContainerRef:zt,doc:De,outlines:Le,page:Be,pageIndex:je,scale:Oe,viewport:qt,onExecuteNamedAction:Ke,onJumpFromLinkAnnotation:$e,onJumpToDest:Gt});case i.AnnotationType.Polygon:return s.createElement(Vi,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.Polyline:return s.createElement($r,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.Popup:return s.createElement(tt,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.Square:return s.createElement(wr,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.Squiggly:return s.createElement(Er,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.Stamp:return s.createElement(ci,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.StrikeOut:return s.createElement(ir,{key:vn.id,annotation:vn,page:Be,viewport:qt});case i.AnnotationType.Text:return s.createElement(Ui,{key:vn.id,annotation:vn,childAnnotation:mn,page:Be,viewport:qt});case i.AnnotationType.Underline:return s.createElement(fs,{key:vn.id,annotation:vn,page:Be,viewport:qt});default:return s.createElement(s.Fragment,{key:vn.id})}})))},ts=function(me){var Se=me.page,De=me.renderAnnotations,Le=_e(),Be=s.useState({loading:!0,annotations:[]}),je=Be[0],Ze=Be[1];return s.useEffect((function(){Se.getAnnotations({intent:"display"}).then((function(Ge){Le.current&&Ze({loading:!1,annotations:Ge})}))}),[]),je.loading?s.createElement(s.Fragment,null):De(je.annotations)},Ts=function(me){var Se=me.doc,De=me.outlines,Le=me.page,Be=me.pageIndex,je=me.plugins,Ze=me.rotation,Ge=me.scale,Oe=me.onExecuteNamedAction,Ke=me.onJumpFromLinkAnnotation,$e=me.onJumpToDest;return s.createElement(ts,{page:Le,renderAnnotations:function(Gt){return s.createElement(Gr,{annotations:Gt,doc:Se,outlines:De,page:Le,pageIndex:Be,plugins:je,rotation:Ze,scale:Ge,onExecuteNamedAction:Oe,onJumpFromLinkAnnotation:Ke,onJumpToDest:$e})}})},lr=function(me,Se){var De=me%Se;return De===0?me:Math.floor(me-De)},Pa=function(me){var Se=me.canvasLayerRef,De=me.height,Le=me.page,Be=me.pageIndex,je=me.plugins,Ze=me.rotation,Ge=me.scale,Oe=me.width,Ke=me.onRenderCanvasCompleted,$e=s.useRef();return v((function(){var Gt=$e.current;Gt&&Gt.cancel();var zt=Se.current;zt.removeAttribute("data-testid"),je.forEach((function(Ln){Ln.onCanvasLayerRender&&Ln.onCanvasLayerRender({ele:zt,pageIndex:Be,rotation:Ze,scale:Ge,status:i.LayerRenderStatus.PreRender})}));var qt=Le.getViewport({rotation:Ze,scale:Ge}),En=window.devicePixelRatio||1,vn=Math.sqrt(16777216/(qt.width*qt.height)),mn=En>vn;mn?zt.style.transform="scale(1, 1)":zt.style.removeProperty("transform");var qn=Math.min(vn,En),Nn=(function(Ln,pi){var ui,mi;if(Math.floor(Ln)===Ln)return[Ln,1];var ni=1/Ln;if(ni>pi)return[1,pi];if(Math.floor(ni)===ni)return[1,ni];for(var di=Ln>1?ni:Ln,Ci=0,Oi=1,rr=1,Wi=1;;){var Xi=Ci+rr,Bi=Oi+Wi;if(Bi>pi)break;di<=Xi/Bi?(rr=(ui=[Xi,Bi])[0],Wi=ui[1]):(Ci=(mi=[Xi,Bi])[0],Oi=mi[1])}return di<(Ci/Oi+rr/Wi)/2?di===Ln?[Ci,Oi]:[Oi,Ci]:di===Ln?[rr,Wi]:[Wi,rr]})(qn,8),On=Nn[0],Un=Nn[1];zt.width=lr(qt.width*qn,On),zt.height=lr(qt.height*qn,On),zt.style.width="".concat(lr(qt.width,Un),"px"),zt.style.height="".concat(lr(qt.height,Un),"px"),zt.hidden=!0;var Dn=zt.getContext("2d",{alpha:!1}),Gn=mn||En!==1?[qn,0,0,qn,0,0]:null;return $e.current=Le.render({canvasContext:Dn,transform:Gn,viewport:qt}),$e.current.promise.then((function(){zt.hidden=!1,zt.setAttribute("data-testid","core__canvas-layer-".concat(Be)),je.forEach((function(Ln){Ln.onCanvasLayerRender&&Ln.onCanvasLayerRender({ele:zt,pageIndex:Be,rotation:Ze,scale:Ge,status:i.LayerRenderStatus.DidRender})})),Ke()}),(function(){Ke()})),function(){zt&&(zt.width=0,zt.height=0)}}),[]),s.createElement("div",{className:"rpv-core__canvas-layer",style:{height:"".concat(De,"px"),width:"".concat(Oe,"px")}},s.createElement("canvas",{ref:Se}))},da=function(me){var Se=me.height,De=me.page,Le=me.rotation,Be=me.scale,je=me.width,Ze=s.useRef();return v((function(){var Ge=Ze.current,Oe=De.getViewport({rotation:Le,scale:Be});De.getOperatorList().then((function(Ke){(function(){var $e=Ze.current;$e&&($e.innerHTML="")})(),new a.SVGGraphics(De.commonObjs,De.objs).getSVG(Ke,Oe).then((function($e){$e.style.height="".concat(Se,"px"),$e.style.width="".concat(je,"px"),Ge.appendChild($e)}))}))}),[]),s.createElement("div",{className:"rpv-core__svg-layer",ref:Ze})},os=function(me){var Se=me.containerRef,De=me.page,Le=me.pageIndex,Be=me.plugins,je=me.rotation,Ze=me.scale,Ge=me.onRenderTextCompleted,Oe=s.useRef(),Ke=function(){var $e=Se.current;$e&&([].slice.call($e.querySelectorAll(".rpv-core__text-layer-text")).forEach((function(Gt){return $e.removeChild(Gt)})),[].slice.call($e.querySelectorAll('br[role="presentation"]')).forEach((function(Gt){return $e.removeChild(Gt)})))};return v((function(){var $e=Oe.current;$e&&$e.cancel();var Gt=Se.current;if(Gt){Gt.removeAttribute("data-testid");var zt=De.getViewport({rotation:je,scale:Ze});return Be.forEach((function(qt){qt.onTextLayerRender&&qt.onTextLayerRender({ele:Gt,pageIndex:Le,scale:Ze,status:i.LayerRenderStatus.PreRender})})),De.getTextContent().then((function(qt){Ke(),Oe.current=a.renderTextLayer({container:Gt,textContent:qt,textContentSource:qt,viewport:zt}),Oe.current.promise.then((function(){Gt.setAttribute("data-testid","core__text-layer-".concat(Le)),[].slice.call(Gt.children).forEach((function(En){En.classList.contains("rpv-core__text-layer-text--not")||En.classList.add("rpv-core__text-layer-text")})),Be.forEach((function(En){En.onTextLayerRender&&En.onTextLayerRender({ele:Gt,pageIndex:Le,scale:Ze,status:i.LayerRenderStatus.DidRender})})),Ge()}),(function(){Gt.removeAttribute("data-testid"),Ge()}))})),function(){var qt;Ke(),(qt=Oe.current)===null||qt===void 0||qt.cancel()}}}),[]),s.createElement("div",{className:"rpv-core__text-layer",ref:Se})},ps=function(me){var Se=me.doc,De=me.measureRef,Le=me.outlines,Be=me.pageIndex,je=me.pageRotation,Ze=me.pageSize,Ge=me.plugins,Oe=me.renderPage,Ke=me.renderQueueKey,$e=me.rotation,Gt=me.scale,zt=me.shouldRender,qt=me.viewMode,En=me.onExecuteNamedAction,vn=me.onJumpFromLinkAnnotation,mn=me.onJumpToDest,qn=me.onRenderCompleted,Nn=me.onRotatePage,On=_e(),Un=s.useState(null),Dn=Un[0],Gn=Un[1],Ln=s.useState(!1),pi=Ln[0],ui=Ln[1],mi=s.useState(!1),ni=mi[0],di=mi[1],Ci=s.useRef(),Oi=s.useRef(),rr=Math.abs($e+je)%180==0,Wi=Ze.pageWidth*Gt,Xi=Ze.pageHeight*Gt,Bi=rr?Wi:Xi,vi=rr?Xi:Wi,_r=(Ze.rotation+$e+je)%360,Br=s.useRef(0),cr=Oe||function(T){return s.createElement(s.Fragment,null,T.canvasLayer.children,T.textLayer.children,T.annotationLayer.children)};return s.useEffect((function(){Gn(null),ui(!1),di(!1)}),[je,$e,Gt]),s.useEffect((function(){zt&&On.current&&!Dn&&Ft(Se,Be).then((function(T){On.current&&(Br.current=Ke,Gn(T))}))}),[zt,Dn]),s.useEffect((function(){pi&&ni&&(Ke!==Br.current?(Gn(null),ui(!1),di(!1)):qn(Be))}),[pi,ni]),s.createElement("div",{className:g({"rpv-core__page-layer":!0,"rpv-core__page-layer--dual":qt===i.ViewMode.DualPage,"rpv-core__page-layer--dual-cover":qt===i.ViewMode.DualPageWithCover,"rpv-core__page-layer--single":qt===i.ViewMode.SinglePage}),"data-testid":"core__page-layer-".concat(Be),ref:De,style:{height:"".concat(vi,"px"),width:"".concat(Bi,"px")}},Dn?s.createElement(s.Fragment,null,cr({annotationLayer:{attrs:{},children:s.createElement(Ts,{doc:Se,outlines:Le,page:Dn,pageIndex:Be,plugins:Ge,rotation:_r,scale:Gt,onExecuteNamedAction:En,onJumpFromLinkAnnotation:vn,onJumpToDest:mn})},canvasLayer:{attrs:{},children:s.createElement(Pa,{canvasLayerRef:Ci,height:vi,page:Dn,pageIndex:Be,plugins:Ge,rotation:_r,scale:Gt,width:Bi,onRenderCanvasCompleted:function(){On.current&&ui(!0)}})},canvasLayerRendered:pi,doc:Se,height:vi,pageIndex:Be,rotation:_r,scale:Gt,svgLayer:{attrs:{},children:s.createElement(da,{height:vi,page:Dn,rotation:_r,scale:Gt,width:Bi})},textLayer:{attrs:{},children:s.createElement(os,{containerRef:Oi,page:Dn,pageIndex:Be,plugins:Ge,rotation:_r,scale:Gt,onRenderTextCompleted:function(){On.current&&di(!0)}})},textLayerRendered:ni,width:Bi,markRendered:qn,onRotatePage:function(T){return Nn(Be,T)}}),Ge.map((function(T,de){return T.renderPageLayer?s.createElement(s.Fragment,{key:de},T.renderPageLayer({canvasLayerRef:Ci,canvasLayerRendered:pi,doc:Se,height:vi,pageIndex:Be,rotation:_r,scale:Gt,textLayerRef:Oi,textLayerRendered:ni,width:Bi})):s.createElement(s.Fragment,{key:de})}))):s.createElement(z,{testId:"core__page-layer-loading-".concat(Be)}))},Ya=function(me,Se){var De=Se.rect;return me.height!==De.height||me.width!==De.width?De:me};(function(me){me.Horizontal="Horizontal",me.Vertical="Vertical",me.Both="Both"})(ei||(ei={}));var Qa=function(me){return 1-Math.pow(1-me,4)},ms=1e-4,ea={left:0,top:0},ta={capture:!1,passive:!0},Nr=function(me){var Se=me.elementRef,De=me.enableSmoothScroll,Le=me.isRtl,Be=me.scrollDirection,je=me.onSmoothScroll,Ze=s.useState(ea),Ge=Ze[0],Oe=Ze[1],Ke=s.useState(Se.current),$e=Ke[0],Gt=Ke[1],zt=Le?-1:1,qt=s.useRef(Be);qt.current=Be;var En=s.useRef(ea),vn=s.useRef(!0),mn=s.useCallback((function(){vn.current=!0,De&&Oe(En.current),je(!1)}),[]),qn=s.useCallback((function(){if($e){switch(qt.current){case ei.Horizontal:En.current={left:zt*$e.scrollLeft,top:0};break;case ei.Both:En.current={left:zt*$e.scrollLeft,top:$e.scrollTop};break;case ei.Vertical:default:En.current={left:0,top:$e.scrollTop}}De&&!vn.current||Oe(En.current)}}),[$e]);v((function(){Gt(Se.current)})),v((function(){if($e)return $e.addEventListener("scroll",qn,ta),function(){$e.removeEventListener("scroll",qn,ta)}}),[$e]);var Nn=s.useCallback((function(On,Un){var Dn=Se.current;if(!Dn)return Promise.resolve();var Gn={left:0,top:0};switch(qt.current){case ei.Horizontal:Gn.left=zt*On.left;break;case ei.Both:Gn.left=zt*On.left,Gn.top=On.top;break;case ei.Vertical:default:Gn.top=On.top}return Un?(vn.current=!1,je(!0),new Promise((function(Ln,pi){(function(ui,mi,ni,di,Ci,Oi){Ci===void 0&&(Ci=function(de){return de}),Oi===void 0&&(Oi=function(){});var rr=0,Wi=0,Xi=!1;switch(mi){case ei.Horizontal:Wi=ui.scrollLeft,rr=0;case ei.Both:Wi=ui.scrollLeft,rr=ui.scrollTop;break;case ei.Vertical:default:Wi=0,rr=ui.scrollTop}var Bi=function(){Xi||(Xi=!0,ui.scrollLeft=ni.left,ui.scrollTop=ni.top,Oi())};if(Math.abs(rr-ni.top)<=ms&&mi===ei.Vertical)Bi();else if(Math.abs(Wi-ni.left)<=ms&&mi===ei.Horizontal)Bi();else{var vi,_r=-1,Br=Wi-ni.left,cr=rr-ni.top,T=function(de){_r===-1&&(_r=de);var ve=de-_r,we=Math.min(ve/di,1),Ue=Ci(we),ze={left:Wi-Br*Ue,top:rr-cr*Ue};switch(mi){case ei.Horizontal:ui.scrollLeft=ze.left;break;case ei.Both:ui.scrollLeft=ze.left,ui.scrollTop=ze.top;break;case ei.Vertical:default:ui.scrollTop=ze.top}Math.abs(ze.top-ni.top)<=ms&&Math.abs(ze.left-ni.left)<=ms&&!Xi&&(window.cancelAnimationFrame(vi),Bi()),ve<di?vi=window.requestAnimationFrame(T):window.cancelAnimationFrame(vi)};vi=window.requestAnimationFrame(T)}})(Dn,qt.current,Gn,400,Qa,(function(){mn(),Ln()}))}))):new Promise((function(Ln,pi){switch(qt.current){case ei.Horizontal:Dn.scrollLeft=Gn.left;break;case ei.Both:Dn.scrollLeft=Gn.left,Dn.scrollTop=Gn.top;break;case ei.Vertical:default:Dn.scrollTop=Gn.top}Ln()}))}),[Se]);return{scrollOffset:Ge,scrollTo:Nn}},qi=function(me,Se,De){return Math.max(me,Math.min(De,Se))},fr=function(me,Se){if(Se!==i.ViewMode.DualPageWithCover)return 0;if(!(function(Be){var je=Be.length;if(je===1)return!1;for(var Ze=1;Ze<je;Ze++)if(Be[Ze].height!==Be[0].height||Be[Ze].width!==Be[0].width)return!0;return!1})(me))return 2*me[0].width;var De=Jn(me.slice(1),2).map((function(Be){return Be.length===2?Be[0].width+Be[1].width:Be[0].width})),Le=[me[0].width].concat(De);return Math.max.apply(Math,Le)},ls={left:0,top:0},Ja={left:0,top:0},ki={left:0,top:0},ha={left:0,top:0},xs={height:0,width:0},Wr={left:0,top:0},Cr="data-virtual-index",Ia=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],Da=function(me){var Se=me.enableSmoothScroll,De=me.isRtl,Le=me.numberOfItems,Be=me.parentRef,je=me.setRenderRange,Ze=me.sizes,Ge=me.scrollMode,Oe=me.viewMode,Ke=s.useState(!1),$e=Ke[0],Gt=Ke[1],zt=s.useCallback((function(we){return Gt(we)}),[]),qt=s.useRef(Ge);qt.current=Ge;var En=s.useRef(Oe);En.current=Oe;var vn=Ge===i.ScrollMode.Wrapped||Oe===i.ViewMode.DualPageWithCover||Oe===i.ViewMode.DualPage?ei.Both:Ge===i.ScrollMode.Horizontal?ei.Horizontal:ei.Vertical,mn=Nr({elementRef:Be,enableSmoothScroll:Se,isRtl:De,scrollDirection:vn,onSmoothScroll:zt}),qn=mn.scrollOffset,Nn=mn.scrollTo,On=(function(we){var Ue=we.elementRef,ze=s.useState(Ue.current),Mt=ze[0],yn=ze[1],kn=s.useRef(!1),Cn=s.useReducer(Ya,{height:0,width:0}),wn=Cn[0],Sn=Cn[1];return v((function(){Ue.current!==Mt&&yn(Ue.current)})),v((function(){if(Mt&&!kn.current){kn.current=!0;var zn=Mt.getBoundingClientRect(),Kn=zn.height,bi=zn.width;Sn({rect:{height:Kn,width:bi}})}}),[Mt]),s.useEffect((function(){if(Mt){var zn=new ResizeObserver((function(Kn,bi){Kn.forEach((function(Ti){if(Ti.target===Mt){var ur=Ti.contentRect,Ir=ur.height,ti=ur.width;Sn({rect:{height:Ir,width:ti}})}}))}));return zn.observe(Mt),function(){zn.unobserve(Mt)}}}),[Mt]),wn})({elementRef:Be}),Un=s.useRef({scrollOffset:Wr,measurements:[]});Un.current.scrollOffset=qn;var Dn=s.useMemo((function(){return Array(Le).fill(-1)}),[]),Gn=s.useState(Dn),Ln=Gn[0],pi=Gn[1],ui=s.useMemo((function(){var we=new IntersectionObserver((function(Ue){Ue.forEach((function(ze){var Mt=ze.isIntersecting?ze.intersectionRatio:-1,yn=ze.target.getAttribute(Cr);if(yn){var kn=parseInt(yn,10);0<=kn&&kn<Le&&pi((function(Cn){return Cn[kn]=Mt,(function(wn,Sn,zn){for(var Kn,bi=0,Ti=Sn.length;bi<Ti;bi++)!Kn&&bi in Sn||(Kn||(Kn=Array.prototype.slice.call(Sn,0,bi)),Kn[bi]=Sn[bi]);return wn.concat(Kn||Array.prototype.slice.call(Sn))})([],Cn)}))}}))}),{threshold:Ia});return we}),[]),mi=s.useMemo((function(){return Ge===i.ScrollMode.Page&&Oe===i.ViewMode.SinglePage?(function(we,Ue,ze){for(var Mt=[],yn=0;yn<we;yn++){var kn={height:Math.max(Ue.height,ze[yn].height),width:Math.max(Ue.width,ze[yn].width)},Cn=yn===0?ha:Mt[yn-1].end,wn={left:Cn.left+kn.width,top:Cn.top+kn.height};Mt[yn]={index:yn,start:Cn,size:kn,end:wn,visibility:-1}}return Mt})(Le,On,Ze):Oe===i.ViewMode.DualPageWithCover?(function(we,Ue,ze,Mt){for(var yn=[],kn=0,Cn=0,wn=ki,Sn=0;Sn<we;Sn++){var zn=Sn===0?{height:Mt===i.ScrollMode.Page?Math.max(Ue.height,ze[Sn].height):ze[Sn].height,width:Mt===i.ScrollMode.Page?Math.max(Ue.width,ze[Sn].width):ze[Sn].width}:{height:Mt===i.ScrollMode.Page?Math.max(Ue.height,ze[Sn].height):ze[Sn].height,width:Math.max(Ue.width/2,ze[Sn].width)};Mt===i.ScrollMode.Page?wn=Sn===0?ki:{left:Sn%2==0?zn.width:0,top:Math.floor((Sn-1)/2)*zn.height+yn[0].end.top}:Sn===0?(wn=ki,kn=ze[0].height,Cn=0):Sn%2==1?(wn={left:0,top:kn+=Cn},Cn=Sn===we-1?ze[Sn].height:Math.max(ze[Sn].height,ze[Sn+1].height)):wn={left:yn[Sn-1].end.left,top:kn};var Kn={left:wn.left+zn.width,top:wn.top+zn.height};yn[Sn]={index:Sn,start:wn,size:zn,end:Kn,visibility:-1}}return yn})(Le,On,Ze,Ge):Oe===i.ViewMode.DualPage?(function(we,Ue,ze,Mt){for(var yn=[],kn=0,Cn=0,wn=Ja,Sn=0;Sn<we;Sn++){var zn={height:Mt===i.ScrollMode.Page?Math.max(Ue.height,ze[Sn].height):ze[Sn].height,width:Math.max(Ue.width/2,ze[Sn].width)};Mt===i.ScrollMode.Page?wn={left:Sn%2==0?0:zn.width,top:Math.floor(Sn/2)*zn.height}:Sn%2==0?(wn={left:0,top:kn+=Cn},Cn=Sn===we-1?ze[Sn].height:Math.max(ze[Sn].height,ze[Sn+1].height)):wn={left:yn[Sn-1].end.left,top:kn};var Kn={left:wn.left+zn.width,top:wn.top+zn.height};yn[Sn]={index:Sn,start:wn,size:zn,end:Kn,visibility:-1}}return yn})(Le,On,Ze,Ge):(function(we,Ue,ze,Mt){for(var yn=[],kn=0,Cn={left:0,top:0},wn=0,Sn=ls,zn=0;zn<we;zn++){var Kn=ze[zn];if(zn===0)kn=Kn.width,Cn={left:0,top:0},wn=Kn.height;else switch(Mt){case i.ScrollMode.Wrapped:(kn+=Kn.width)<Ue.width?(Sn={left:yn[zn-1].end.left,top:Cn.top},wn=Math.max(wn,Kn.height)):(kn=Kn.width,Cn={left:(Sn={left:Cn.left,top:Cn.top+wn}).left,top:Sn.top},wn=Kn.height);break;case i.ScrollMode.Horizontal:case i.ScrollMode.Vertical:default:Sn=yn[zn-1].end}var bi={left:Sn.left+Kn.width,top:Sn.top+Kn.height};yn[zn]={index:zn,start:Sn,size:Kn,end:bi,visibility:-1}}return yn})(Le,On,Ze,Ge)}),[Ge,Ze,Oe,On]),ni=mi[Le-1]?{height:mi[Le-1].end.top,width:mi[Le-1].end.left}:xs;Un.current.measurements=mi;var di=s.useMemo((function(){var we=(function(zn,Kn,bi,Ti){var ur=0;switch(zn){case ei.Horizontal:ur=Ti.left;break;case ei.Vertical:default:ur=Ti.top}var Ir=Kn.length-1,ti=(function(Ai,is,Na,ia){for(;Ai<=is;){var $s=(Ai+is)/2|0,ma=ia($s);if(ma<Na)Ai=$s+1;else{if(!(ma>Na))return $s;is=$s-1}}return Ai>0?Ai-1:0})(0,Ir,ur,(function(Ai){switch(zn){case ei.Horizontal:return Kn[Ai].start.left;case ei.Both:case ei.Vertical:default:return Kn[Ai].start.top}}));if(zn===ei.Both)for(var Tr=Kn[ti].start.top;ti-1>=0&&Kn[ti-1].start.top===Tr&&Kn[ti-1].start.left>=Ti.left;)ti--;for(var zi=ti;zi<=Ir;){var Hi={top:Kn[zi].start.top-Ti.top,left:Kn[zi].start.left-Ti.left},yr={height:bi.height-Hi.top,width:bi.width-Hi.left};if(zn===ei.Horizontal&&yr.width<0||zn===ei.Vertical&&yr.height<0||zn===ei.Both&&(yr.width<0||yr.height<0))break;zi++}return{start:ti,end:zi}})(vn,mi,On,qn),Ue=we.start,ze=we.end,Mt=Ln.slice(qi(0,Le,Ue),qi(0,Le,ze)),yn=Ue+Mt.reduce((function(zn,Kn,bi,Ti){return Kn>Ti[zn]?bi:zn}),0),kn=yn=qi(0,Le-1,yn),Cn=je({endPage:ze,numPages:Le,startPage:Ue}),wn=Cn.startPage,Sn=Cn.endPage;switch(wn=Math.max(wn,0),Sn=Math.min(Sn,Le-1),Oe){case i.ViewMode.DualPageWithCover:yn>0&&(kn=yn%2==1?yn:yn-1),wn=wn===0?0:wn%2==1?wn:wn-1,Le-(Sn=Sn%2==1?Sn-1:Sn)<=2&&(Sn=Le-1);break;case i.ViewMode.DualPage:kn=yn%2==0?yn:yn-1,wn=wn%2==0?wn:wn-1,Sn=Sn%2==1?Sn:Sn-1;break;case i.ViewMode.SinglePage:default:kn=yn}return{startPage:wn,endPage:Sn,maxVisbilityIndex:kn}}),[mi,On,qn,Oe,Ln]),Ci=di.startPage,Oi=di.endPage,rr=di.maxVisbilityIndex,Wi=s.useMemo((function(){for(var we=[],Ue=function(Mt){var yn=mi[Mt],kn=h(h({},yn),{visibility:Ln[Mt]!==void 0?Ln[Mt]:-1,measureRef:function(Cn){Cn&&(Cn.setAttribute(Cr,"".concat(Mt)),ui.observe(Cn))}});we.push(kn)},ze=Ci;ze<=Oi;ze++)Ue(ze);return we}),[Ci,Oi,Ln,mi]),Xi=s.useCallback((function(we,Ue){var ze=Un.current.measurements[qi(0,Le-1,we)],Mt=qt.current===i.ScrollMode.Page?Wr:Ue;return ze?Nn({left:Mt.left+ze.start.left,top:Mt.top+ze.start.top},Se):Promise.resolve()}),[Nn,Se]),Bi=s.useCallback((function(we,Ue){var ze=Un.current.measurements,Mt=ze[we].start,yn=ze.find((function(Cn){return Cn.start.top-Mt.top>1e-12}));if(!yn)return Promise.resolve();var kn=yn.index;switch(En.current){case i.ViewMode.DualPage:kn=kn%2==0?kn:kn+1;break;case i.ViewMode.DualPageWithCover:kn=kn%2==1?kn:kn+1}return Xi(kn,Ue)}),[]),vi=s.useCallback((function(we,Ue){for(var ze=Un.current.measurements,Mt=ze[we].start,yn=we,kn=!1,Cn=Le-1;Cn>=0;Cn--)if(Mt.top-ze[Cn].start.top>1e-12){kn=!0,yn=ze[Cn].index;break}if(!kn)return Promise.resolve();switch(En.current){case i.ViewMode.DualPage:yn=yn%2==0?yn:yn-1;break;case i.ViewMode.DualPageWithCover:yn=yn%2==0?yn-1:yn}return yn===we&&(yn=we-1),Xi(yn,Ue)}),[]),_r=s.useCallback((function(we,Ue){if(En.current===i.ViewMode.DualPageWithCover||En.current===i.ViewMode.DualPage)return Bi(we,Ue);switch(qt.current){case i.ScrollMode.Wrapped:return Bi(we,Ue);case i.ScrollMode.Horizontal:case i.ScrollMode.Vertical:default:return Xi(we+1,Ue)}}),[]),Br=s.useCallback((function(we,Ue){if(En.current===i.ViewMode.DualPageWithCover||En.current===i.ViewMode.DualPage)return vi(we,Ue);switch(qt.current){case i.ScrollMode.Wrapped:return vi(we,Ue);case i.ScrollMode.Horizontal:case i.ScrollMode.Vertical:default:return Xi(we-1,Ue)}}),[]),cr=s.useCallback((function(){return(function(we,Ue){switch(Ue){case i.ScrollMode.Horizontal:return{position:"relative",height:"100%",width:"".concat(we.width,"px")};case i.ScrollMode.Vertical:default:return{position:"relative",height:"".concat(we.height,"px"),width:"100%"}}})(ni,qt.current)}),[ni]),T=s.useCallback((function(we){return(function(Ue,ze,Mt){return Mt!==i.ScrollMode.Page?{}:{height:"".concat(ze.height,"px"),width:"100%",position:"absolute",top:0,transform:"translateY(".concat(Ue.start.top,"px)")}})(we,On,qt.current)}),[On]),de=s.useCallback((function(we){return(function(Ue,ze,Mt,yn,kn){var Cn,wn,Sn,zn,Kn,bi,Ti,ur=ze?"right":"left",Ir=ze?-1:1,ti=Mt.length,Tr=Ue.start.left*Ir,zi=Ue.size,Hi=zi.height,yr=zi.width;if(yn===i.ViewMode.DualPageWithCover){var Ai=kn===i.ScrollMode.Page?0:Ue.start.top;return Ue.index===0||ti%2==0&&Ue.index===ti-1?((Cn={height:"".concat(Hi,"px"),minWidth:"".concat(fr(Mt,yn),"px"),width:"100%"})[ur]=0,Cn.position="absolute",Cn.top=0,Cn.transform="translate(".concat(Tr,"px, ").concat(Ai,"px)"),Cn):((wn={height:"".concat(Hi,"px"),width:"".concat(yr,"px")})[ur]=0,wn.position="absolute",wn.top=0,wn.transform="translate(".concat(Tr,"px, ").concat(Ai,"px)"),wn)}if(yn===i.ViewMode.DualPage)return(Sn={height:"".concat(Hi,"px"),width:"".concat(yr,"px")})[ur]=0,Sn.position="absolute",Sn.top=0,Sn.transform="translate(".concat(Tr,"px, ").concat(kn===i.ScrollMode.Page?0:Ue.start.top,"px)"),Sn;switch(kn){case i.ScrollMode.Horizontal:return(zn={height:"100%",width:"".concat(yr,"px")})[ur]=0,zn.position="absolute",zn.top=0,zn.transform="translateX(".concat(Tr,"px)"),zn;case i.ScrollMode.Page:return(Kn={height:"".concat(Hi,"px"),width:"".concat(yr,"px")})[ur]=0,Kn.position="absolute",Kn.top=0,Kn;case i.ScrollMode.Wrapped:return(bi={height:"".concat(Hi,"px"),width:"".concat(yr,"px")})[ur]=0,bi.position="absolute",bi.top=0,bi.transform="translate(".concat(Tr,"px, ").concat(Ue.start.top,"px)"),bi;case i.ScrollMode.Vertical:default:return(Ti={height:"".concat(Hi,"px"),width:"100%"})[ur]=0,Ti.position="absolute",Ti.top=0,Ti.transform="translateY(".concat(Ue.start.top,"px)"),Ti}})(we,De,Ze,En.current,qt.current)}),[De,Ze]),ve=s.useCallback((function(we,Ue){var ze=Un.current,Mt=ze.measurements,yn=ze.scrollOffset,kn=Mt[qi(0,Le-1,Ue)];if(kn){var Cn=qt.current===i.ScrollMode.Page?{left:kn.start.left,top:kn.start.top}:{left:yn.left*we,top:yn.top*we};return Nn(Cn,!1)}return Promise.resolve()}),[]);return s.useEffect((function(){return function(){ui.disconnect()}}),[]),{boundingClientRect:On,isSmoothScrolling:$e,startPage:Ci,endPage:Oi,maxVisbilityIndex:rr,virtualItems:Wi,getContainerStyles:cr,getItemContainerStyles:T,getItemStyles:de,scrollToItem:Xi,scrollToNextItem:_r,scrollToPreviousItem:Br,zoom:ve}},js=function(me,Se,De,Le,Be,je){var Ze=De;switch(!0){case(Be===i.ViewMode.DualPageWithCover&&je>=3):case(Be===i.ViewMode.DualPage&&je>=3):Ze=2*De;break;default:Ze=De}switch(Le){case i.SpecialZoomLevel.ActualSize:return 1;case i.SpecialZoomLevel.PageFit:return Math.min((me.clientWidth-17)/Ze,(me.clientHeight-16)/Se);case i.SpecialZoomLevel.PageWidth:return(me.clientWidth-17)/Ze}},Rr=function(me){var Se,De,Le=me.getCurrentPage,Be=(Se=50,De=s.useRef([]),s.useEffect((function(){return function(){De.current=[]}}),[]),{push:function(Ke){var $e=De.current;$e.length+1>Se&&$e.shift(),$e.push(Ke),De.current=$e},map:function(Ke){return De.current.map((function($e){return Ke($e)}))},pop:function(){var Ke=De.current;if(Ke.length===0)return null;var $e=Ke.pop();return De.current=Ke,$e}}),je=(function(Ke){var $e=s.useRef([]);return s.useEffect((function(){return function(){$e.current=[]}}),[]),{dequeue:function(){var Gt=$e.current;if(Gt.length===0)return null;var zt=Gt.shift();return $e.current=Gt,zt||null},enqueue:function(Gt){var zt=$e.current;zt.length+1>Ke&&zt.pop(),$e.current=[Gt].concat(zt)},map:function(Gt){return $e.current.map((function(zt){return Gt(zt)}))}}})(50),Ze=function(){var Ke=je.dequeue();return Ke&&Be.push(Ke),Ke&&Ke.pageIndex===Le()?Ze():Ke},Ge=function(){var Ke=Be.pop();return Ke&&je.enqueue(Ke),Ke&&Ke.pageIndex===Le()?Ge():Ke},Oe=s.useCallback((function(Ke){Be.push(Ke)}),[]);return{getNextDestination:Ze,getPreviousDestination:Ge,markVisitedDestination:Oe}},Za=function(me){var Se=[];return me.map((function(De){Se=Se.concat(De).concat((function(Le){var Be=[];return Le.items&&Le.items.length>0&&(Be=Be.concat(Za(Le.items))),Be})(De))})),Se},cs={capture:!1,passive:!0},Pr={height:0,width:0},Us={height:0,width:0},Ss=function(me){var Se=me.getCurrentPage,De=me.getCurrentScrollMode,Le=me.jumpToPage,Be=me.targetRef,je=s.useState(i.FullScreenMode.Normal),Ze=je[0],Ge=je[1],Oe=(function(){var Ln=s.useState(Pr),pi=Ln[0],ui=Ln[1],mi=be((function(){ui({height:window.innerHeight,width:window.innerWidth})}),100);return v((function(){return window.addEventListener("resize",mi,cs),function(){window.removeEventListener("resize",mi,cs)}}),[]),pi})(),Ke=s.useState(Us),$e=Ke[0],Gt=Ke[1],zt=s.useRef(Us),qt=s.useRef(Se()),En=s.useRef(Us),vn=s.useState(Be.current),mn=vn[0],qn=vn[1],Nn=s.useRef();v((function(){Be.current!==mn&&qn(Be.current)}),[]),v((function(){if(mn){var Ln=new ResizeObserver((function(pi){pi.forEach((function(ui){var mi=ui.target.getBoundingClientRect(),ni=mi.height,di=mi.width;Gt({height:ni,width:di})}))}));return Ln.observe(mn),function(){Ln.unobserve(mn),Ln.disconnect()}}}),[mn]);var On=s.useCallback((function(Ln){var pi=ae();return pi&&pi!==Ln?(Ge(i.FullScreenMode.Normal),te(pi)):Promise.resolve()}),[]),Un=s.useCallback((function(Ln){Ln&&V()&&(qn(Ln),On(Ln).then((function(){Nn.current=Ln,Ge(i.FullScreenMode.Entering),(function(pi){w&&pi[H.RequestFullScreen]()})(Ln)})))}),[]),Dn=s.useCallback((function(){ae()&&(Ge(i.FullScreenMode.Exitting),te(document))}),[]),Gn=s.useCallback((function(){mn&&ae()!==mn&&Ge(i.FullScreenMode.Exitting)}),[mn]);return s.useEffect((function(){switch(Ze){case i.FullScreenMode.Entering:Nn.current&&(Nn.current.style.backgroundColor="var(--rpv-core__full-screen-target-background-color)"),qt.current=Se(),zt.current={height:window.innerHeight,width:window.innerWidth};break;case i.FullScreenMode.Entered:De()===i.ScrollMode.Page?Le(qt.current).then((function(){Ge(i.FullScreenMode.EnteredCompletely)})):Ge(i.FullScreenMode.EnteredCompletely);break;case i.FullScreenMode.Exitting:Nn.current&&(Nn.current.style.backgroundColor="",Nn.current=null),qt.current=Se();break;case i.FullScreenMode.Exited:Ge(i.FullScreenMode.Normal),De()===i.ScrollMode.Page&&Le(qt.current)}}),[Ze]),s.useEffect((function(){if(Ze!==i.FullScreenMode.Normal)return Ze===i.FullScreenMode.Entering&&Oe.height===$e.height&&Oe.width===$e.width&&Oe.height>0&&Oe.width>0&&(En.current.height===0||Oe.height==En.current.height)?(En.current={height:window.innerHeight,width:window.innerWidth},void Ge(i.FullScreenMode.Entered)):void(Ze===i.FullScreenMode.Exitting&&zt.current.height===Oe.height&&zt.current.width===Oe.width&&Oe.height>0&&Oe.width>0&&Ge(i.FullScreenMode.Exited))}),[Ze,Oe,$e]),s.useEffect((function(){var Ln;return Ln=Gn,w&&document.addEventListener(H.FullScreenChange,Ln),function(){(function(pi){w&&document.removeEventListener(H.FullScreenChange,pi)})(Gn)}}),[mn]),{enterFullScreenMode:Un,exitFullScreenMode:Dn,fullScreenMode:Ze}},fa={buildPageStyles:function(){return{}},transformSize:function(me){return me.size}},us={left:0,top:0},ka=function(me){var Se=me.currentFile,De=me.defaultScale,Le=me.doc,Be=me.enableSmoothScroll,je=me.initialPage,Ze=me.initialRotation,Ge=me.initialScale,Oe=me.pageLayout,Ke=me.pageSizes,$e=me.plugins,Gt=me.renderPage,zt=me.scrollMode,qt=me.setRenderRange,En=me.viewMode,vn=me.viewerState,mn=me.onDocumentLoad,qn=me.onOpenFile,Nn=me.onPageChange,On=me.onRotate,Un=me.onRotatePage,Dn=me.onZoom,Gn=Le.numPages,Ln=Le.loadingTask.docId,pi=s.useContext(re).l10n,ui=s.useContext(m),mi=ui.direction===i.TextDirection.RightToLeft,ni=s.useRef(),di=s.useRef(),Ci=s.useState(je),Oi=Ci[0],rr=Ci[1],Wi=s.useRef(null),Xi=Rr({getCurrentPage:function(){return ti.current.pageIndex}}),Bi=s.useState(Ze),vi=Bi[0],_r=Bi[1],Br=le(vi),cr=s.useState(!1),T=cr[0],de=cr[1],ve=s.useState(new Map),we=ve[0],Ue=ve[1],ze=s.useState(zt),Mt=ze[0],yn=ze[1],kn=le(Mt),Cn=s.useState(En),wn=Cn[0],Sn=Cn[1],zn=le(wn),Kn=(function(bn){var Xn=_e(),_i=s.useState([]),gi=_i[0],Ei=_i[1];return s.useEffect((function(){bn.getOutline().then((function(Yn){if(Xn.current&&Yn!==null){var Ji=Za(Yn);Ei(Ji)}}))}),[]),gi})(Le),bi=s.useState(Ge),Ti=bi[0],ur=bi[1],Ir=le(Ti),ti=s.useRef(vn),Tr=s.useRef(typeof De=="string"?De:null),zi=s.useRef(-1),Hi=s.useRef(-1),yr=s.useRef(je),Ai=Ss({getCurrentPage:function(){return ti.current.pageIndex},getCurrentScrollMode:function(){return ti.current.scrollMode},jumpToPage:function(bn){return gs(bn)},targetRef:di}),is=s.useState(-1),Na=is[0],ia=is[1],$s=s.useState(0),ma=$s[0],Ho=$s[1],Kr=ee({doc:Le});s.useEffect((function(){return function(){Wn.clear(),hi.clear()}}),[Ln]);var La=s.useMemo((function(){return Object.assign({},fa,Oe)}),[]),ol=s.useMemo((function(){return Array(Gn).fill(0).map((function(bn,Xn){var _i=[Ke[Xn].pageHeight,Ke[Xn].pageWidth],gi=Math.abs(vi)%180==0?{height:_i[0],width:_i[1]}:{height:_i[1],width:_i[0]},Ei={height:gi.height*Ti,width:gi.width*Ti};return La.transformSize({numPages:Gn,pageIndex:Xn,size:Ei})}))}),[vi,Ti]),ji=Da({enableSmoothScroll:Be,isRtl:mi,numberOfItems:Gn,parentRef:di,scrollMode:Mt,setRenderRange:qt,sizes:ol,viewMode:wn}),Ml=be((function(){!Tr.current||ti.current.fullScreenMode!==i.FullScreenMode.Normal||je>0&&yr.current===je||Ws(Tr.current)}),200);(function(bn){var Xn=bn.targetRef,_i=bn.onResize;v((function(){var gi=new ResizeObserver((function(Yn){Yn.forEach((function(Ji){_i(Ji.target)}))})),Ei=Xn.current;if(Ei)return gi.observe(Ei),function(){gi.unobserve(Ei)}}),[])})({targetRef:di,onResize:Ml});var ra=function(bn){var Xn=bn;$e.forEach((function(_i){_i.onViewerStateChange&&(Xn=_i.onViewerStateChange(Xn))})),ti.current=Xn},ll=function(){return di.current},Nl=function(){return ti.current},eo=s.useCallback((function(bn){Xi.markVisitedDestination(bn)}),[]),jr=s.useCallback((function(bn){var Xn=bn.pageIndex,_i=bn.bottomOffset,gi=bn.leftOffset,Ei=bn.scaleTo,Yn=di.current,Ji=ti.current;return Yn&&Ji?new Promise((function(ws,Va){Ft(Le,Xn).then((function(Ea){var Cs=Ea.getViewport({scale:1}),Rs=0,$o=(typeof _i=="function"?_i(Cs.width,Cs.height):_i)||0,Ta=(typeof gi=="function"?gi(Cs.width,Cs.height):gi)||0,ys=Ji.scale;switch(Ei){case i.SpecialZoomLevel.PageFit:Rs=0,Ta=0,Ws(i.SpecialZoomLevel.PageFit);break;case i.SpecialZoomLevel.PageWidth:ys=js(Yn,Ke[Xn].pageHeight,Ke[Xn].pageWidth,i.SpecialZoomLevel.PageWidth,En,Gn),Rs=(Cs.height-$o)*ys,Ta*=ys,Ws(ys);break;default:Rs=(Cs.height-$o)*ys,Ta*=ys}switch(Ji.scrollMode){case i.ScrollMode.Horizontal:ji.scrollToItem(Xn,{left:Ta,top:0}).then((function(){ws()}));break;case i.ScrollMode.Vertical:default:ji.scrollToItem(Xn,{left:0,top:Rs}).then((function(){ws()}))}}))})):Promise.resolve()}),[]),Gs=s.useCallback((function(bn){return Xi.markVisitedDestination(bn),jr(bn)}),[]),Oa=s.useCallback((function(){var bn=Xi.getNextDestination();return bn?jr(bn):Promise.resolve()}),[]),pr=s.useCallback((function(){var bn=Xi.getPreviousDestination();return bn?jr(bn):Promise.resolve()}),[]),ga=s.useCallback((function(){return ji.scrollToNextItem(ti.current.pageIndex,us)}),[]),gs=s.useCallback((function(bn){return 0<=bn&&bn<Gn?ji.scrollToItem(bn,us):Promise.resolve()}),[]),qo=s.useCallback((function(){return ji.scrollToPreviousItem(ti.current.pageIndex,us)}),[]),cl=s.useCallback((function(bn){var Xn,_i;(Xn=bn.name,_i=Xn.split(/\./).pop(),_i?_i.toLowerCase():"").toLowerCase()==="pdf"&&new Promise((function(gi){var Ei=new FileReader;Ei.readAsArrayBuffer(bn),Ei.onload=function(){var Yn=new Uint8Array(Ei.result);gi(Yn)}})).then((function(gi){qn(bn.name,gi)}))}),[qn]),_a=s.useCallback((function(bn){var Xn=bn===i.RotateDirection.Backward?-90:90,_i=ti.current.rotation,gi=_i===360||_i===-360?Xn:_i+Xn;Kr.markNotRendered(),_r(gi),ra(h(h({},ti.current),{rotation:gi})),On({direction:bn,doc:Le,rotation:gi})}),[]),to=s.useCallback((function(bn,Xn){var _i=Xn===i.RotateDirection.Backward?-90:90,gi=ti.current.pagesRotation,Ei=(gi.has(bn)?gi.get(bn):Ze)+_i,Yn=gi.set(bn,Ei);Ue(Yn),de((function(Ji){return!Ji})),ra(h(h({},ti.current),{pagesRotation:Yn,rotatedPage:bn})),Un({direction:Xn,doc:Le,pageIndex:bn,rotation:Ei}),Kr.markRendering(bn),ia(bn)}),[]),ya=s.useCallback((function(bn){ra(h(h({},ti.current),{scrollMode:bn})),yn(bn)}),[]),no=s.useCallback((function(bn){ra(h(h({},ti.current),{viewMode:bn})),Sn(bn)}),[]),Ws=s.useCallback((function(bn){var Xn=di.current,_i=ti.current.pageIndex;if(!(_i<0||_i>=Gn)){var gi=Ke[_i].pageHeight,Ei=Ke[_i].pageWidth,Yn=Xn?typeof bn=="string"?js(Xn,gi,Ei,bn,ti.current.viewMode,Gn):bn:1;Tr.current=typeof bn=="string"?bn:null,Yn!==ti.current.scale&&(Ho((function(Ji){return Ji+1})),Kr.markNotRendered(),ur(Yn),Dn({doc:Le,scale:Yn}),ra(h(h({},ti.current),{scale:Yn})))}}),[]),sa=s.useCallback((function(bn){Ai.enterFullScreenMode(bn)}),[]),va=s.useCallback((function(){Ai.exitFullScreenMode()}),[]);s.useEffect((function(){ra(h(h({},ti.current),{fullScreenMode:Ai.fullScreenMode}))}),[Ai.fullScreenMode]),s.useEffect((function(){var bn={enterFullScreenMode:sa,exitFullScreenMode:va,getPagesContainer:ll,getViewerState:Nl,jumpToDestination:Gs,jumpToNextDestination:Oa,jumpToPreviousDestination:pr,jumpToNextPage:ga,jumpToPreviousPage:qo,jumpToPage:gs,openFile:cl,rotate:_a,rotatePage:to,setViewerState:ra,switchScrollMode:ya,switchViewMode:no,zoom:Ws};return $e.forEach((function(Xn){Xn.install&&Xn.install(bn)})),function(){$e.forEach((function(Xn){Xn.uninstall&&Xn.uninstall(bn)}))}}),[Ln]),s.useEffect((function(){mn({doc:Le,file:Se}),$e.forEach((function(bn){bn.onDocumentLoad&&bn.onDocumentLoad({doc:Le,file:Se})}))}),[Ln]);var ba,io,_s,zo=ji.boundingClientRect;ba=function(){je&&gs(je)},io=zo.height>0&&zo.width>0,_s=s.useRef(!1),v((function(){io&&!_s.current&&(_s.current=!0,ba())}),[ba,io]),v((function(){var bn=ti.current.pageIndex;bn>-1&&kn!==Mt&&ji.scrollToItem(bn,us).then((function(){Ai.fullScreenMode===i.FullScreenMode.EnteredCompletely&&(Be||Kr.markNotRendered(),zi.current=-1)}))}),[Mt]),v((function(){var bn=ti.current.pageIndex;bn>-1&&Br!==vi&&ji.scrollToItem(bn,us)}),[vi]),v((function(){Ir!=0&&Ir!=ti.current.scale&&ji.zoom(ti.current.scale/Ir,ti.current.pageIndex).then((function(){Ai.fullScreenMode===i.FullScreenMode.EnteredCompletely&&(Hi.current=-1)}))}),[Ti]),v((function(){if(zn!==ti.current.viewMode){var bn=ji.startPage,Xn=ji.endPage,_i=ji.virtualItems;Kr.markNotRendered(),Kr.setRange(bn,Xn);for(var gi=function(Yn){var Ji=_i.find((function(ws){return ws.index===Yn}));Ji&&Kr.setVisibility(Yn,Ji.visibility)},Ei=bn;Ei<=Xn;Ei++)gi(Ei);vo()}}),[wn]),v((function(){var bn=ti.current.pageIndex;bn>-1&&zn!==wn&&ji.scrollToItem(bn,us)}),[wn]),v((function(){var bn=ti.current.pageIndex;bn>0&&bn===je&&yr.current===je&&Tr.current&&(yr.current=-1,Ws(Tr.current))}),[Oi]),s.useEffect((function(){ji.isSmoothScrolling||Wi.current!==null&&Wi.current===Oi||(Wi.current=Oi,Nn({currentPage:Oi,doc:Le}))}),[Oi,ji.isSmoothScrolling]),s.useEffect((function(){Ai.fullScreenMode===i.FullScreenMode.Entering&&ti.current.scrollMode===i.ScrollMode.Page&&(zi.current=ti.current.pageIndex),Ai.fullScreenMode===i.FullScreenMode.EnteredCompletely&&ti.current.scrollMode===i.ScrollMode.Page&&Be&&(zi.current=-1),Ai.fullScreenMode===i.FullScreenMode.EnteredCompletely&&Tr.current&&(Hi.current=ti.current.pageIndex,Ws(Tr.current))}),[Ai.fullScreenMode]),s.useEffect((function(){if(Ai.fullScreenMode!==i.FullScreenMode.Entering&&Ai.fullScreenMode!==i.FullScreenMode.Exitting&&!ji.isSmoothScrolling){var bn=ji.startPage,Xn=ji.endPage,_i=ji.maxVisbilityIndex,gi=ji.virtualItems,Ei=_i,Yn=Ai.fullScreenMode===i.FullScreenMode.Entered||Ai.fullScreenMode===i.FullScreenMode.EnteredCompletely;if(!(Yn&&Ei!==zi.current&&zi.current>-1||Yn&&Ei!==Hi.current&&Hi.current>-1)){rr(Ei),ra(h(h({},ti.current),{pageIndex:Ei})),Kr.setRange(bn,Xn);for(var Ji=function(Va){var Ea=gi.find((function(Cs){return Cs.index===Va}));Ea&&Kr.setVisibility(Va,Ea.visibility)},ws=bn;ws<=Xn;ws++)Ji(ws);vo()}}}),[ji.startPage,ji.endPage,ji.isSmoothScrolling,ji.maxVisbilityIndex,Ai.fullScreenMode,T,vi,Ti]);var Fa=s.useCallback((function(bn){Kr.markRendered(bn),vo()}),[ma]),vo=function(){var bn=Kr.getHighestPriorityPage();bn>-1&&Kr.isInRange(bn)&&(Kr.markRendering(bn),ia(bn))},ul=function(bn){var Xn=Oi-1,_i=Oi+1;switch(bn){case"FirstPage":gs(0);break;case"LastPage":gs(Gn-1);break;case"NextPage":_i<Gn&&gs(_i);break;case"PrevPage":Xn>=0&&gs(Xn)}},dl=s.useCallback((function(){var bn=ji.virtualItems,Xn=[];switch(wn){case i.ViewMode.DualPage:Xn=Jn(bn,2);break;case i.ViewMode.DualPageWithCover:bn.length&&(Xn=bn[0].index===0?[[bn[0]]].concat(Jn(bn.slice(1),2)):Jn(bn,2));break;case i.ViewMode.SinglePage:default:Xn=Jn(bn,1)}var _i=pi&&pi.core?pi.core.pageLabel:"Page {{pageIndex}}",gi={attrs:{className:"rpv-core__inner-container","data-testid":"core__inner-container",ref:ni,style:{height:"100%"}},children:s.createElement(s.Fragment,null),subSlot:{attrs:{"data-testid":"core__inner-pages",className:g({"rpv-core__inner-pages":!0,"rpv-core__inner-pages--horizontal":Mt===i.ScrollMode.Horizontal,"rpv-core__inner-pages--rtl":mi,"rpv-core__inner-pages--single":Mt===i.ScrollMode.Page,"rpv-core__inner-pages--vertical":Mt===i.ScrollMode.Vertical,"rpv-core__inner-pages--wrapped":Mt===i.ScrollMode.Wrapped}),ref:di,style:{height:"100%",position:"relative"}},children:s.createElement("div",{"data-testid":"core__inner-current-page-".concat(Oi),style:Object.assign({"--scale-factor":Ti},ji.getContainerStyles())},Xn.map((function(Ei){return s.createElement("div",{className:g({"rpv-core__inner-page-container":!0,"rpv-core__inner-page-container--single":Mt===i.ScrollMode.Page}),style:ji.getItemContainerStyles(Ei[0]),key:"".concat(Ei[0].index,"-").concat(wn)},Ei.map((function(Yn){var Ji=wn===i.ViewMode.DualPageWithCover&&(Yn.index===0||Gn%2==0&&Yn.index===Gn-1);return s.createElement("div",{"aria-label":_i.replace("{{pageIndex}}","".concat(Yn.index+1)),className:g({"rpv-core__inner-page":!0,"rpv-core__inner-page--dual-even":wn===i.ViewMode.DualPage&&Yn.index%2==0,"rpv-core__inner-page--dual-odd":wn===i.ViewMode.DualPage&&Yn.index%2==1,"rpv-core__inner-page--dual-cover":Ji,"rpv-core__inner-page--dual-cover-even":wn===i.ViewMode.DualPageWithCover&&!Ji&&Yn.index%2==0,"rpv-core__inner-page--dual-cover-odd":wn===i.ViewMode.DualPageWithCover&&!Ji&&Yn.index%2==1,"rpv-core__inner-page--single":wn===i.ViewMode.SinglePage&&Mt===i.ScrollMode.Page}),role:"region",key:"".concat(Yn.index,"-").concat(wn),style:Object.assign({},ji.getItemStyles(Yn),La.buildPageStyles({numPages:Gn,pageIndex:Yn.index,scrollMode:Mt,viewMode:wn}))},s.createElement(ps,{doc:Le,measureRef:Yn.measureRef,outlines:Kn,pageIndex:Yn.index,pageRotation:we.has(Yn.index)?we.get(Yn.index):0,pageSize:Ke[Yn.index],plugins:$e,renderPage:Gt,renderQueueKey:ma,rotation:vi,scale:Ti,shouldRender:Na===Yn.index,viewMode:wn,onExecuteNamedAction:ul,onJumpFromLinkAnnotation:eo,onJumpToDest:Gs,onRenderCompleted:Fa,onRotatePage:to}))})))})))}};return $e.forEach((function(Ei){Ei.renderViewer&&(gi=Ei.renderViewer({containerRef:ni,doc:Le,pagesContainerRef:di,pagesRotation:we,pageSizes:Ke,rotation:vi,slot:gi,themeContext:ui,jumpToPage:gs,openFile:cl,rotate:_a,rotatePage:to,switchScrollMode:ya,switchViewMode:no,zoom:Ws}))})),gi}),[$e,ji]),hl=s.useCallback((function(bn){return s.createElement("div",h({},bn.attrs,{style:bn.attrs&&bn.attrs.style?bn.attrs.style:{}}),bn.children,bn.subSlot&&hl(bn.subSlot))}),[]);return hl(dl())},Hs=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],Ma=function(me){var Se=me.defaultScale,De=me.doc,Le=me.render,Be=me.scrollMode,je=me.viewMode,Ze=s.useRef(),Ge=s.useState({pageSizes:[],scale:0}),Oe=Ge[0],Ke=Ge[1];return s.useLayoutEffect((function(){var $e=Array(De.numPages).fill(0).map((function(Gt,zt){return new Promise((function(qt,En){Ft(De,zt).then((function(vn){var mn=vn.getViewport({scale:1});qt({pageHeight:mn.height,pageWidth:mn.width,rotation:mn.rotation})}))}))}));Promise.all($e).then((function(Gt){var zt=Ze.current;if(zt&&Gt.length!==0){var qt=Gt[0].pageWidth,En=Gt[0].pageHeight,vn=zt.parentElement,mn=(vn.clientWidth-45)/qt,qn=(vn.clientHeight-45)/En,Nn=mn;switch(Be){case i.ScrollMode.Horizontal:Nn=Math.min(mn,qn);break;case i.ScrollMode.Vertical:default:Nn=mn}var On,Un,Dn=Se?typeof Se=="string"?js(vn,En,qt,Se,je,De.numPages):Se:(On=Nn,(Un=Hs.findIndex((function(Gn){return Gn>=On})))===-1||Un===0?On:Hs[Un-1]);Ke({pageSizes:Gt,scale:Dn})}}))}),[De.loadingTask.docId]),Oe.pageSizes.length===0||Oe.scale===0?s.createElement("div",{className:"rpv-core__page-size-calculator","data-testid":"core__page-size-calculating",ref:Ze},s.createElement(z,null)):Le(Oe.pageSizes,Oe.scale)},Qr=function(){},As=(function(me){function Se(De,Le){var Be=me.call(this)||this;return Be.verifyPassword=De,Be.passwordStatus=Le,Be}return u(Se,me),Se})(Qr),ns=function(me){var Se=me.passwordStatus,De=me.renderProtectedView,Le=me.verifyPassword,Be=me.onDocumentAskPassword,je=s.useContext(re).l10n,Ze=s.useState(""),Ge=Ze[0],Oe=Ze[1],Ke=s.useContext(m).direction===i.TextDirection.RightToLeft,$e=function(){return Le(Ge)};return s.useEffect((function(){Be&&Be({verifyPassword:Le})}),[]),De?De({passwordStatus:Se,verifyPassword:Le}):s.createElement("div",{className:"rpv-core__asking-password-wrapper"},s.createElement("div",{className:g({"rpv-core__asking-password":!0,"rpv-core__asking-password--rtl":Ke})},s.createElement("div",{className:"rpv-core__asking-password-message"},Se===i.PasswordStatus.RequiredPassword&&je.core.askingPassword.requirePasswordToOpen,Se===i.PasswordStatus.WrongPassword&&je.core.wrongPassword.tryAgain),s.createElement("div",{className:"rpv-core__asking-password-body"},s.createElement("div",{className:g({"rpv-core__asking-password-input":!0,"rpv-core__asking-password-input--ltr":!Ke,"rpv-core__asking-password-input--rtl":Ke})},s.createElement(D,{testId:"core__asking-password-input",type:"password",value:Ge,onChange:Oe,onKeyDown:function(Gt){Gt.key==="Enter"&&$e()}})),s.createElement(A,{onClick:$e},je.core.askingPassword.submit))))},qs=(function(me){function Se(De){var Le=me.call(this)||this;return Le.doc=De,Le}return u(Se,me),Se})(Qr),ds=(function(me){function Se(De){var Le=me.call(this)||this;return Le.error=De,Le}return u(Se,me),Se})(Qr),zs=(function(me){function Se(De){var Le=me.call(this)||this;return Le.percentages=De,Le}return u(Se,me),Se})(Qr),pa=function(me){var Se=me.characterMap,De=me.file,Le=me.httpHeaders,Be=me.render,je=me.renderError,Ze=me.renderLoader,Ge=me.renderProtectedView,Oe=me.transformGetDocumentParams,Ke=me.withCredentials,$e=me.onDocumentAskPassword,Gt=s.useContext(m).direction===i.TextDirection.RightToLeft,zt=s.useState(new zs(0)),qt=zt[0],En=zt[1],vn=s.useRef(""),mn=_e();return s.useEffect((function(){vn.current="",En(new zs(0));var qn=new a.PDFWorker({name:"PDFWorker_".concat(Date.now())}),Nn=Object.assign({httpHeaders:Le,withCredentials:Ke,worker:qn},typeof De=="string"?{url:De}:{data:De},Se?{cMapUrl:Se.url,cMapPacked:Se.isCompressed}:{}),On=Oe?Oe(Nn):Nn,Un=a.getDocument(On);return Un.onPassword=function(Dn,Gn){switch(Gn){case a.PasswordResponses.NEED_PASSWORD:mn.current&&En(new As(Dn,i.PasswordStatus.RequiredPassword));break;case a.PasswordResponses.INCORRECT_PASSWORD:mn.current&&En(new As(Dn,i.PasswordStatus.WrongPassword))}},Un.onProgress=function(Dn){var Gn=Dn.total>0?Math.min(100,100*Dn.loaded/Dn.total):100;mn.current&&vn.current===""&&En(new zs(Gn))},Un.promise.then((function(Dn){vn.current=Dn.loadingTask.docId,mn.current&&En(new qs(Dn))}),(function(Dn){return mn.current&&!qn.destroyed&&En(new ds({message:Dn.message||"Cannot load document",name:Dn.name}))})),function(){Un.destroy(),qn.destroy()}}),[De]),qt instanceof As?s.createElement(ns,{passwordStatus:qt.passwordStatus,renderProtectedView:Ge,verifyPassword:qt.verifyPassword,onDocumentAskPassword:$e}):qt instanceof qs?Be(qt.doc):qt instanceof ds?je?je(qt.error):s.createElement("div",{className:g({"rpv-core__doc-error":!0,"rpv-core__doc-error--rtl":Gt})},s.createElement("div",{className:"rpv-core__doc-error-text"},qt.error.message)):s.createElement("div",{"data-testid":"core__doc-loading",className:g({"rpv-core__doc-loading":!0,"rpv-core__doc-loading--rtl":Gt})},Ze?Ze(qt.percentages):s.createElement(z,null))},na=function(me,Se){var De=s.useMemo((function(){return me==="auto"?typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":me}),[]),Le=s.useState(De),Be=Le[0],je=Le[1],Ze=le(Be);return s.useEffect((function(){if(me==="auto"){var Ge=window.matchMedia("(prefers-color-scheme: dark)"),Oe=function(Ke){je(Ke.matches?"dark":"light")};return Ge.addEventListener("change",Oe),function(){return Ge.removeEventListener("change",Oe)}}}),[]),s.useEffect((function(){Be!==Ze&&Se&&Se(Be)}),[Be]),s.useEffect((function(){me!==Be&&je(me)}),[me]),{currentTheme:Be,setCurrentTheme:je}},Jr=function(me){return{startPage:me.startPage-3,endPage:me.endPage+3}};i.Button=function(me){var Se=me.children,De=me.testId,Le=me.onClick,Be=s.useContext(m).direction===i.TextDirection.RightToLeft,je=De?{"data-testid":De}:{};return s.createElement("button",h({className:g({"rpv-core__button":!0,"rpv-core__button--rtl":Be}),type:"button",onClick:Le},je),Se)},i.Icon=b,i.LazyRender=function(me){var Se=me.attrs,De=me.children,Le=me.testId,Be=s.useState(!1),je=Be[0],Ze=Be[1],Ge=Le?h(h({},Se),{"data-testid":Le}):Se,Oe=_({once:!0,onVisibilityChanged:function(Ke){Ke.isVisible&&Ze(!0)}});return s.createElement("div",h({ref:Oe},Ge),je&&De)},i.LocalizationContext=re,i.Menu=function(me){var Se=me.children,De=s.useRef(),Le=s.useRef([]),Be=s.useContext(m).direction===i.TextDirection.RightToLeft,je=function(Ge){if(De.current)switch(Ge.key){case"Tab":Ge.preventDefault();break;case"ArrowDown":Ge.preventDefault(),Ze((function(Oe,Ke){return Ke+1}));break;case"ArrowUp":Ge.preventDefault(),Ze((function(Oe,Ke){return Ke-1}));break;case"End":Ge.preventDefault(),Ze((function(Oe,Ke){return Oe.length-1}));break;case"Home":Ge.preventDefault(),Ze((function(Oe,Ke){return 0}))}},Ze=function(Ge){if(De.current){var Oe=Le.current,Ke=Oe.findIndex((function(Gt){return Gt.getAttribute("tabindex")==="0"})),$e=Math.min(Oe.length-1,Math.max(0,Ge(Oe,Ke)));Ke>=0&&Ke<=Oe.length-1&&Oe[Ke].setAttribute("tabindex","-1"),Oe[$e].setAttribute("tabindex","0"),Oe[$e].focus()}};return v((function(){var Ge=De.current;if(Ge){var Oe=(function(Ke){var $e=[];return Ke.querySelectorAll('.rpv-core__menu-item[role="menuitem"]').forEach((function(Gt){if(Gt instanceof HTMLElement){var zt=Gt.parentElement;(zt===Ke||window.getComputedStyle(zt).display!=="none")&&$e.push(Gt)}})),$e})(Ge);Le.current=Oe}}),[]),v((function(){return document.addEventListener("keydown",je),function(){document.removeEventListener("keydown",je)}}),[]),s.createElement("div",{ref:De,"aria-orientation":"vertical",className:g({"rpv-core__menu":!0,"rpv-core__menu--rtl":Be}),role:"menu",tabIndex:0},Se)},i.MenuDivider=function(){return s.createElement("div",{"aria-orientation":"horizontal",className:"rpv-core__menu-divider",role:"separator"})},i.MenuItem=function(me){var Se=me.checked,De=Se!==void 0&&Se,Le=me.children,Be=me.icon,je=Be===void 0?null:Be,Ze=me.isDisabled,Ge=Ze!==void 0&&Ze,Oe=me.testId,Ke=me.onClick,$e=s.useContext(m).direction===i.TextDirection.RightToLeft,Gt=Oe?{"data-testid":Oe}:{};return s.createElement("button",h({className:g({"rpv-core__menu-item":!0,"rpv-core__menu-item--disabled":Ge,"rpv-core__menu-item--ltr":!$e,"rpv-core__menu-item--rtl":$e}),role:"menuitem",tabIndex:-1,type:"button",onClick:Ke},Gt),s.createElement("div",{className:g({"rpv-core__menu-item-icon":!0,"rpv-core__menu-item-icon--ltr":!$e,"rpv-core__menu-item-icon--rtl":$e})},je),s.createElement("div",{className:g({"rpv-core__menu-item-label":!0,"rpv-core__menu-item-label--ltr":!$e,"rpv-core__menu-item-label--rtl":$e})},Le),s.createElement("div",{className:g({"rpv-core__menu-item-check":!0,"rpv-core__menu-item-check--ltr":!$e,"rpv-core__menu-item-check--rtl":$e})},De&&s.createElement(E,null)))},i.MinimalButton=function(me){var Se=me.ariaLabel,De=Se===void 0?"":Se,Le=me.ariaKeyShortcuts,Be=Le===void 0?"":Le,je=me.children,Ze=me.isDisabled,Ge=Ze!==void 0&&Ze,Oe=me.isSelected,Ke=Oe!==void 0&&Oe,$e=me.testId,Gt=me.onClick,zt=s.useContext(m).direction===i.TextDirection.RightToLeft,qt=$e?{"data-testid":$e}:{};return s.createElement("button",h({"aria-label":De},Be&&{"aria-keyshortcuts":Be},Ge&&{"aria-disabled":!0},{className:g({"rpv-core__minimal-button":!0,"rpv-core__minimal-button--disabled":Ge,"rpv-core__minimal-button--rtl":zt,"rpv-core__minimal-button--selected":Ke}),type:"button",onClick:Gt},qt),je)},i.Modal=function(me){var Se=me.ariaControlsSuffix,De=me.closeOnClickOutside,Le=me.closeOnEscape,Be=me.content,je=me.isOpened,Ze=je!==void 0&&je,Ge=me.target,Oe=Se||"".concat(pe());return s.createElement(Me,{target:Ge?function(Ke,$e){return s.createElement("div",{"aria-expanded":$e?"true":"false","aria-haspopup":"dialog","aria-controls":"rpv-core__modal-body-".concat(Oe)},Ge(Ke,$e))}:null,content:function(Ke){return s.createElement(Te,null,s.createElement(Ee,{ariaControlsSuffix:Oe,closeOnClickOutside:De,closeOnEscape:Le,onToggle:Ke},Be(Ke)))},isOpened:Ze})},i.Popover=function(me){var Se=me.ariaHasPopup,De=Se===void 0?"dialog":Se,Le=me.ariaControlsSuffix,Be=me.closeOnClickOutside,je=me.closeOnEscape,Ze=me.content,Ge=me.lockScroll,Oe=Ge===void 0||Ge,Ke=me.offset,$e=me.position,Gt=me.target,zt=Pe(!1),qt=zt.opened,En=zt.toggle,vn=s.useRef(),mn=s.useMemo((function(){return Le||"".concat(pe())}),[]);return s.createElement("div",{ref:vn,"aria-expanded":qt?"true":"false","aria-haspopup":De,"aria-controls":"rpv-core__popver-body-".concat(mn)},Gt(En,qt),qt&&s.createElement(s.Fragment,null,Oe&&s.createElement(pn,{closeOnEscape:je,onClose:En}),s.createElement(dn,{ariaControlsSuffix:mn,closeOnClickOutside:Be,offset:Ke,position:$e,targetRef:vn,onClose:En},Ze(En))))},i.PrimaryButton=A,i.ProgressBar=function(me){var Se=me.progress,De=s.useContext(m).direction===i.TextDirection.RightToLeft;return s.createElement("div",{className:g({"rpv-core__progress-bar":!0,"rpv-core__progress-bar--rtl":De})},s.createElement("div",{className:"rpv-core__progress-bar-progress",style:{width:"".concat(Se,"%")}},Se,"%"))},i.Separator=function(){return s.createElement("div",{className:"rpv-core__separator"})},i.Spinner=z,i.Splitter=function(me){var Se=me.constrain,De=s.useContext(m).direction===i.TextDirection.RightToLeft,Le=s.useRef(),Be=s.useRef(),je=s.useRef(),Ze=s.useRef(0),Ge=s.useRef(0),Oe=s.useRef(0),Ke=s.useRef(0),$e={capture:!0},Gt=function(qt){var En=Le.current,vn=Be.current,mn=je.current;if(En&&vn&&mn){var qn=Ke.current,Nn=qt.clientX-Ze.current,On=Oe.current+(De?-Nn:Nn),Un=En.parentElement.getBoundingClientRect().width,Dn=100*On/Un;if(En.classList.add("rpv-core__splitter--resizing"),Se){var Gn=Un-On-qn;if(!Se({firstHalfPercentage:Dn,firstHalfSize:On,secondHalfPercentage:100*Gn/Un,secondHalfSize:Gn}))return}vn.style.width="".concat(Dn,"%"),document.body.classList.add("rpv-core__splitter-body--resizing"),vn.classList.add("rpv-core__splitter-sibling--resizing"),mn.classList.add("rpv-core__splitter-sibling--resizing")}},zt=function(qt){var En=Le.current,vn=Be.current,mn=je.current;En&&vn&&mn&&(document.body.classList.remove("rpv-core__splitter-body--resizing"),En.classList.remove("rpv-core__splitter--resizing"),vn.classList.remove("rpv-core__splitter-sibling--resizing"),mn.classList.remove("rpv-core__splitter-sibling--resizing"),document.removeEventListener("mousemove",Gt,$e),document.removeEventListener("mouseup",zt,$e))};return s.useEffect((function(){var qt=Le.current;qt&&(Ke.current=qt.getBoundingClientRect().width,Be.current=qt.previousElementSibling,je.current=qt.nextElementSibling)}),[]),s.createElement("div",{ref:Le,className:"rpv-core__splitter",onMouseDown:function(qt){var En=Be.current;En&&(Ze.current=qt.clientX,Ge.current=qt.clientY,Oe.current=En.getBoundingClientRect().width,document.addEventListener("mousemove",Gt,$e),document.addEventListener("mouseup",zt,$e))}})},i.TextBox=D,i.ThemeContext=m,i.Tooltip=function(me){var Se=me.ariaControlsSuffix,De=me.content,Le=me.offset,Be=me.position,je=me.target,Ze=Pe(!1),Ge=Ze.opened,Oe=Ze.toggle,Ke=s.useRef(),$e=s.useRef(),Gt=s.useMemo((function(){return Se||"".concat(pe())}),[]);ce((function(){Ke.current&&document.activeElement&&Ke.current.contains(document.activeElement)&&qt()}));var zt=function(){Oe(i.ToggleStatus.Open)},qt=function(){Oe(i.ToggleStatus.Close)};return s.createElement(s.Fragment,null,s.createElement("div",{ref:Ke,"aria-describedby":"rpv-core__tooltip-body-".concat(Gt),onBlur:function(En){En.relatedTarget instanceof HTMLElement&&En.currentTarget.parentElement&&En.currentTarget.parentElement.contains(En.relatedTarget)?$e.current&&($e.current.style.display="none"):qt()},onFocus:zt,onMouseEnter:zt,onMouseLeave:qt},je),Ge&&s.createElement(An,{ariaControlsSuffix:Gt,contentRef:$e,offset:Le,position:Be,targetRef:Ke},De()))},i.Viewer=function(me){var Se=me.characterMap,De=me.defaultScale,Le=me.enableSmoothScroll,Be=Le===void 0||Le,je=me.fileUrl,Ze=me.httpHeaders,Ge=Ze===void 0?{}:Ze,Oe=me.initialPage,Ke=Oe===void 0?0:Oe,$e=me.pageLayout,Gt=me.initialRotation,zt=Gt===void 0?0:Gt,qt=me.localization,En=me.plugins,vn=En===void 0?[]:En,mn=me.renderError,qn=me.renderLoader,Nn=me.renderPage,On=me.renderProtectedView,Un=me.scrollMode,Dn=Un===void 0?i.ScrollMode.Vertical:Un,Gn=me.setRenderRange,Ln=Gn===void 0?Jr:Gn,pi=me.transformGetDocumentParams,ui=me.theme,mi=ui===void 0?{direction:i.TextDirection.LeftToRight,theme:"light"}:ui,ni=me.viewMode,di=ni===void 0?i.ViewMode.SinglePage:ni,Ci=me.withCredentials,Oi=Ci!==void 0&&Ci,rr=me.onDocumentAskPassword,Wi=me.onDocumentLoad,Xi=Wi===void 0?function(){}:Wi,Bi=me.onPageChange,vi=Bi===void 0?function(){}:Bi,_r=me.onRotate,Br=_r===void 0?function(){}:_r,cr=me.onRotatePage,T=cr===void 0?function(){}:cr,de=me.onSwitchTheme,ve=de===void 0?function(){}:de,we=me.onZoom,Ue=we===void 0?function(){}:we,ze=s.useState({data:je,name:typeof je=="string"?je:"",shouldLoad:!1}),Mt=ze[0],yn=ze[1],kn=function(zi,Hi){yn({data:Hi,name:zi,shouldLoad:!0})},Cn=s.useState(!1),wn=Cn[0],Sn=Cn[1],zn=le(Mt);s.useEffect((function(){var zi,Hi,yr,Ai;zi=zn.data,Ai=typeof(Hi=je),(yr=typeof zi)=="string"&&Ai==="string"&&zi===Hi||yr==="object"&&Ai==="object"&&zi.length===Hi.length&&zi.every((function(is,Na){return is===Hi[Na]}))||yn({data:je,name:typeof je=="string"?je:"",shouldLoad:wn})}),[je,wn]);var Kn=_({onVisibilityChanged:function(zi){Sn(zi.isVisible),zi.isVisible&&yn((function(Hi){return Object.assign({},Hi,{shouldLoad:!0})}))}}),bi=typeof mi=="string"?{direction:i.TextDirection.LeftToRight,theme:mi}:mi,Ti=s.useState(qt||se),ur=Ti[0],Ir=Ti[1],ti={l10n:ur,setL10n:Ir},Tr=Object.assign({},{direction:bi.direction},na(bi.theme||"light",ve));return s.useEffect((function(){qt&&Ir(qt)}),[qt]),s.createElement(re.Provider,{value:ti},s.createElement(m.Provider,{value:Tr},s.createElement("div",{ref:Kn,className:"rpv-core__viewer rpv-core__viewer--".concat(Tr.currentTheme),"data-testid":"core__viewer",style:{height:"100%",width:"100%"}},Mt.shouldLoad&&s.createElement(pa,{characterMap:Se,file:Mt.data,httpHeaders:Ge,render:function(zi){return s.createElement(Ma,{defaultScale:De,doc:zi,render:function(Hi,yr){return s.createElement(ka,{currentFile:{data:Mt.data,name:Mt.name},defaultScale:De,doc:zi,enableSmoothScroll:Be,initialPage:Ke,initialRotation:zt,initialScale:yr,pageLayout:$e,pageSizes:Hi,plugins:vn,renderPage:Nn,scrollMode:Dn,setRenderRange:Ln,viewMode:di,viewerState:{file:Mt,fullScreenMode:i.FullScreenMode.Normal,pageIndex:-1,pageHeight:Hi[0].pageHeight,pageWidth:Hi[0].pageWidth,pagesRotation:new Map,rotation:zt,scale:yr,scrollMode:Dn,viewMode:di},onDocumentLoad:Xi,onOpenFile:kn,onPageChange:vi,onRotate:Br,onRotatePage:T,onZoom:Ue})},scrollMode:Dn,viewMode:di})},renderError:mn,renderLoader:qn,renderProtectedView:On,transformGetDocumentParams:pi,withCredentials:Oi,onDocumentAskPassword:rr}))))},i.Worker=function(me){var Se=me.children,De=me.workerUrl;return a.GlobalWorkerOptions.workerSrc=De,s.createElement(s.Fragment,null,Se)},i.chunk=Jn,i.classNames=g,i.createStore=function(me){var Se=me||{},De={},Le=function(je,Ze){var Ge;Se=h(h({},Se),((Ge={})[je]=Ze,Ge)),(De[je]||[]).forEach((function(Oe){return Oe(Se[je])}))},Be=function(je){return Se[je]};return{subscribe:function(je,Ze){De[je]=(De[je]||[]).concat(Ze)},unsubscribe:function(je,Ze){De[je]=(De[je]||[]).filter((function(Ge){return Ge!==Ze}))},update:function(je,Ze){Le(je,Ze)},updateCurrentValue:function(je,Ze){var Ge=Be(je);Ge!==void 0&&Le(je,Ze(Ge))},get:function(je){return Be(je)}}},i.getDestination=Xe,i.getPage=Ft,i.isFullScreenEnabled=V,i.isMac=function(){return typeof window<"u"&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)},i.useDebounceCallback=be,i.useIntersectionObserver=_,i.useIsMounted=_e,i.useIsomorphicLayoutEffect=v,i.usePrevious=le,i.useRenderQueue=ee})(core_min)),core_min}var hasRequiredLib$h;function requireLib$h(){if(hasRequiredLib$h)return lib$h.exports;hasRequiredLib$h=1;return lib$h.exports=requireCore_min(),lib$h.exports}var libExports$1=requireLib$h(),lib$g={exports:{}},defaultLayout_min={},lib$f={exports:{}},attachment_min={},hasRequiredAttachment_min;function requireAttachment_min(){if(hasRequiredAttachment_min)return attachment_min;hasRequiredAttachment_min=1;var i=requireLib$h();function e(a){var l=Object.create(null);return a&&Object.keys(a).forEach((function(u){if(u!=="default"){var d=Object.getOwnPropertyDescriptor(a,u);Object.defineProperty(l,u,d.get?d:{enumerable:!0,get:function(){return a[u]}})}})),l.default=a,Object.freeze(l)}var t=e(requireReact()),n=function(a){var l=a.files,u=t.useRef(),d=t.useContext(i.LocalizationContext).l10n,h=t.useContext(i.ThemeContext).direction===i.TextDirection.RightToLeft,p=t.useRef([]),m=d&&d.attachment?d.attachment.clickToDownload:"Click to download",g=function(v){var _=u.current,b=[].slice.call(_.getElementsByClassName("rpv-attachment__item"));if(b.length!==0){b.forEach((function(z){return z.setAttribute("tabindex","-1")}));var E=document.activeElement,A=b[Math.min(b.length-1,Math.max(0,v(b,E)))];A.setAttribute("tabindex","0"),A.focus()}};return i.useIsomorphicLayoutEffect((function(){var v=u.current;if(v){var _=[].slice.call(v.getElementsByClassName("rpv-attachment__item"));if(p.current=_,_.length>0){var b=_[0];b.focus(),b.setAttribute("tabindex","0")}}}),[]),t.createElement("div",{"data-testid":"attachment__list",className:i.classNames({"rpv-attachment__list":!0,"rpv-attachment__list--rtl":h}),ref:u,tabIndex:-1,onKeyDown:function(v){switch(v.key){case"ArrowDown":v.preventDefault(),g((function(_,b){return _.indexOf(b)+1}));break;case"ArrowUp":v.preventDefault(),g((function(_,b){return _.indexOf(b)-1}));break;case"End":v.preventDefault(),g((function(_,b){return _.length-1}));break;case"Home":v.preventDefault(),g((function(_,b){return 0}))}}},l.map((function(v){return t.createElement("button",{className:"rpv-attachment__item",key:v.fileName,tabIndex:-1,title:m,type:"button",onClick:function(){return _=v.fileName,b=v.data,E=typeof b=="string"?"":URL.createObjectURL(new Blob([b],{type:""})),(A=document.createElement("a")).style.display="none",A.href=E||_,A.setAttribute("download",(function(z){var D=z.split("/").pop();return D?D.split("#")[0].split("?")[0]:z})(_)),document.body.appendChild(A),A.click(),document.body.removeChild(A),void(E&&URL.revokeObjectURL(E));var _,b,E,A}},v.fileName)})))},r=function(a){var l=a.doc,u=t.useContext(i.LocalizationContext).l10n,d=t.useContext(i.ThemeContext).direction===i.TextDirection.RightToLeft,h=u&&u.attachment?u.attachment.noAttachment:"There is no attachment",p=t.useState({files:[],isLoaded:!1}),m=p[0],g=p[1];return t.useEffect((function(){l.getAttachments().then((function(v){var _=v?Object.keys(v).map((function(b){return{data:v[b].content,fileName:v[b].filename}})):[];g({files:_,isLoaded:!0})}))}),[l]),m.isLoaded?m.files.length===0?t.createElement("div",{"data-testid":"attachment__empty",className:i.classNames({"rpv-attachment__empty":!0,"rpv-attachment__empty--rtl":d})},h):t.createElement(n,{files:m.files}):t.createElement(i.Spinner,null)},s=function(a){var l=a.store,u=t.useState(l.get("doc")),d=u[0],h=u[1],p=function(m){h(m)};return t.useEffect((function(){return l.subscribe("doc",p),function(){l.unsubscribe("doc",p)}}),[]),d?t.createElement(r,{doc:d}):t.createElement("div",{className:"rpv-attachment__loader"},t.createElement(i.Spinner,null))};return attachment_min.attachmentPlugin=function(){var a=t.useMemo((function(){return i.createStore({})}),[]);return{onDocumentLoad:function(l){a.update("doc",l.doc)},Attachments:function(){return t.createElement(s,{store:a})}}},attachment_min}var hasRequiredLib$g;function requireLib$g(){if(hasRequiredLib$g)return lib$f.exports;hasRequiredLib$g=1;return lib$f.exports=requireAttachment_min(),lib$f.exports}var lib$e={exports:{}},bookmark_min={},hasRequiredBookmark_min;function requireBookmark_min(){if(hasRequiredBookmark_min)return bookmark_min;hasRequiredBookmark_min=1;var i=requireLib$h();function e(m){var g=Object.create(null);return m&&Object.keys(m).forEach((function(v){if(v!=="default"){var _=Object.getOwnPropertyDescriptor(m,v);Object.defineProperty(g,v,_.get?_:{enumerable:!0,get:function(){return m[v]}})}})),g.default=m,Object.freeze(g)}var t,n=e(requireReact()),r=function(){return r=Object.assign||function(m){for(var g,v=1,_=arguments.length;v<_;v++)for(var b in g=arguments[v])Object.prototype.hasOwnProperty.call(g,b)&&(m[b]=g[b]);return m},r.apply(this,arguments)},s=function(){return n.createElement(i.Icon,{size:16},n.createElement("path",{d:"M6.427,8.245A.5.5,0,0,1,6.862,7.5H17.138a.5.5,0,0,1,.435.749l-5.139,9a.5.5,0,0,1-.868,0Z"}))},a=function(){return n.createElement(i.Icon,{size:16},n.createElement("path",{d:"M9.248,17.572a.5.5,0,0,1-.748-.434V6.862a.5.5,0,0,1,.748-.434l8.992,5.138a.5.5,0,0,1,0,.868Z"}))},l=function(m){var g=m.bookmark,v=m.depth,_=m.doc,b=m.index,E=m.isBookmarkExpanded,A=m.numberOfSiblings,z=m.pathFromRoot,D=m.renderBookmarkItem,P=m.store,G=z?"".concat(z,".").concat(b):"".concat(b),R=n.useMemo((function(){return(function(re){var fe=re.count,pe=re.items;if(fe>=0)return!1;var Z=pe.length;if(Z===0)return!1;for(var ce=pe.concat([]);ce.length>0;){var Ee=ce.shift(),Te=Ee.items;Ee.count&&Te&&Ee.count>0&&Te.length>0&&(Z+=Te.length,ce=ce.concat(Te))}return Math.abs(fe)===Z})(g)}),[g]),I=P.get("bookmarkExpandedMap"),w=E?E({bookmark:g,doc:_,depth:v,index:b}):I.has(G)?I.get(G):!R,H=n.useState(w),V=H[0],te=H[1],ae=g.items&&g.items.length>0,be=function(){var re=!V;P.updateCurrentValue("bookmarkExpandedMap",(function(fe){return fe.set(G,re)})),te(re)},_e=function(){var re=g.dest,fe=P.get("jumpToDestination");i.getDestination(_,re).then((function(pe){fe&&fe(r({label:g.title},pe))}))},le=function(){ae&&g.dest&&_e()},ue=function(){!ae&&g.dest&&_e()},oe=function(re,fe){return n.createElement("div",{className:"rpv-bookmark__item",style:{paddingLeft:"".concat(1.25*v,"rem")},onClick:re},fe)},ee=function(re,fe){return ae?n.createElement("span",{className:"rpv-bookmark__toggle","data-testid":"bookmark__toggle-".concat(v,"-").concat(b),onClick:be},V?re:fe):n.createElement("span",{className:"rpv-bookmark__toggle"})},se=function(re){return g.url?n.createElement("a",{className:"rpv-bookmark__title",href:g.url,rel:"noopener noreferrer nofollow",target:g.newWindow?"_blank":""},g.title):n.createElement("div",{className:"rpv-bookmark__title","aria-label":g.title,onClick:re},g.title)};return n.createElement("li",{"aria-expanded":V?"true":"false","aria-label":g.title,"aria-level":v+1,"aria-posinset":b+1,"aria-setsize":A,role:"treeitem",tabIndex:-1},D?D({bookmark:g,depth:v,hasSubItems:ae,index:b,isExpanded:V,path:G,defaultRenderItem:oe,defaultRenderTitle:se,defaultRenderToggle:ee,onClickItem:ue,onClickTitle:le,onToggleSubItems:be}):oe(ue,n.createElement(n.Fragment,null,ee(n.createElement(s,null),n.createElement(a,null)),se(le))),ae&&V&&n.createElement(u,{bookmarks:g.items,depth:v+1,doc:_,isBookmarkExpanded:E,isRoot:!1,pathFromRoot:G,renderBookmarkItem:D,store:P}))},u=function(m){var g=m.bookmarks,v=m.depth,_=v===void 0?0:v,b=m.doc,E=m.isBookmarkExpanded,A=m.isRoot,z=m.pathFromRoot,D=m.renderBookmarkItem,P=m.store;return n.createElement("ul",{className:"rpv-bookmark__list",role:A?"tree":"group",tabIndex:-1},g.map((function(G,R){return n.createElement(l,{bookmark:G,depth:_,doc:b,index:R,isBookmarkExpanded:E,key:R,numberOfSiblings:g.length,pathFromRoot:z,renderBookmarkItem:D,store:P})})))};(function(m){m[m.Collapse=0]="Collapse",m[m.Expand=1]="Expand"})(t||(t={}));var d=function(m){var g=m.bookmarks,v=m.doc,_=m.isBookmarkExpanded,b=m.renderBookmarkItem,E=m.store,A=n.useRef(),z=function(R){var I=A.current;if(I&&R.target instanceof HTMLElement&&I.contains(R.target))switch(R.key){case"ArrowDown":R.preventDefault(),P((function(w,H){return w.indexOf(H)+1}));break;case"ArrowLeft":R.preventDefault(),G(t.Collapse);break;case"ArrowRight":R.preventDefault(),G(t.Expand);break;case"ArrowUp":R.preventDefault,P((function(w,H){return w.indexOf(H)-1}));break;case"End":R.preventDefault(),P((function(w,H){return w.length-1}));break;case" ":case"Enter":case"Space":R.preventDefault(),D();break;case"Home":R.preventDefault(),P((function(w,H){return 0}))}},D=function(){var R=document.activeElement.closest(".rpv-bookmark__item").querySelector(".rpv-bookmark__title");R&&R.click()},P=function(R){var I=A.current,w=[].slice.call(I.getElementsByClassName("rpv-bookmark__item"));if(w.length!==0){var H=document.activeElement,V=w[Math.min(w.length-1,Math.max(0,R(w,H)))];H.setAttribute("tabindex","-1"),V.setAttribute("tabindex","0"),V.focus()}},G=function(R){var I=A.current;if([].slice.call(I.getElementsByClassName("rpv-bookmark__item")).length!==0){var w=document.activeElement.closest(".rpv-bookmark__item"),H=R===t.Collapse?"true":"false";if(w&&w.parentElement.getAttribute("aria-expanded")===H){var V=w.querySelector(".rpv-bookmark__toggle");V&&V.click()}}};return n.useEffect((function(){return document.addEventListener("keydown",z),function(){document.removeEventListener("keydown",z)}}),[]),n.useEffect((function(){var R=A.current;if(R){var I=[].slice.call(R.getElementsByClassName("rpv-bookmark__item"));I.length>0&&(I[0].focus(),I[0].setAttribute("tabindex","0"))}}),[]),n.createElement("div",{ref:A},n.createElement(u,{bookmarks:g,depth:0,doc:v,isBookmarkExpanded:_,isRoot:!0,pathFromRoot:"",renderBookmarkItem:b,store:E}))},h=function(m){var g=m.doc,v=m.isBookmarkExpanded,_=m.renderBookmarkItem,b=m.store,E=n.useContext(i.LocalizationContext).l10n,A=n.useContext(i.ThemeContext).direction===i.TextDirection.RightToLeft,z=n.useState({isLoaded:!1,items:[]}),D=z[0],P=z[1];return n.useEffect((function(){P({isLoaded:!1,items:[]}),g.getOutline().then((function(G){P({isLoaded:!0,items:G||[]})}))}),[g]),D.isLoaded?D.items.length===0?n.createElement("div",{"data-testid":"bookmark__empty",className:i.classNames({"rpv-bookmark__empty":!0,"rpv-bookmark__empty--rtl":A})},E&&E.bookmark?E.bookmark.noBookmark:"There is no bookmark"):n.createElement("div",{"data-testid":"bookmark__container",className:i.classNames({"rpv-bookmark__container":!0,"rpv-bookmark__container--rtl":A})},n.createElement(d,{bookmarks:D.items,doc:g,isBookmarkExpanded:v,renderBookmarkItem:_,store:b})):n.createElement("div",{className:"rpv-bookmark__loader"},n.createElement(i.Spinner,null))},p=function(m){var g=m.isBookmarkExpanded,v=m.renderBookmarkItem,_=m.store,b=n.useState(_.get("doc")),E=b[0],A=b[1],z=function(D){A(D)};return n.useEffect((function(){return _.subscribe("doc",z),function(){_.unsubscribe("doc",z)}}),[]),E?n.createElement(h,{doc:E,isBookmarkExpanded:g,renderBookmarkItem:v,store:_}):n.createElement("div",{className:"rpv-bookmark__loader"},n.createElement(i.Spinner,null))};return bookmark_min.DownArrowIcon=s,bookmark_min.RightArrowIcon=a,bookmark_min.bookmarkPlugin=function(){var m=n.useMemo((function(){return i.createStore({bookmarkExpandedMap:new Map})}),[]);return{install:function(g){m.update("jumpToDestination",g.jumpToDestination)},onDocumentLoad:function(g){m.update("doc",g.doc)},Bookmarks:function(g){return n.createElement(p,{isBookmarkExpanded:g?.isBookmarkExpanded,renderBookmarkItem:g?.renderBookmarkItem,store:m})}}},bookmark_min}var hasRequiredLib$f;function requireLib$f(){if(hasRequiredLib$f)return lib$e.exports;hasRequiredLib$f=1;return lib$e.exports=requireBookmark_min(),lib$e.exports}var lib$d={exports:{}},thumbnail_min={},hasRequiredThumbnail_min;function requireThumbnail_min(){return hasRequiredThumbnail_min||(hasRequiredThumbnail_min=1,(function(i){var e=requireLib$h();function t(_){var b=Object.create(null);return _&&Object.keys(_).forEach((function(E){if(E!=="default"){var A=Object.getOwnPropertyDescriptor(_,E);Object.defineProperty(b,E,A.get?A:{enumerable:!0,get:function(){return _[E]}})}})),b.default=_,Object.freeze(b)}var n,r=t(requireReact());i.ThumbnailDirection=void 0,(n=i.ThumbnailDirection||(i.ThumbnailDirection={})).Horizontal="Horizontal",n.Vertical="Vertical";var s=function(){return s=Object.assign||function(_){for(var b,E=1,A=arguments.length;E<A;E++)for(var z in b=arguments[E])Object.prototype.hasOwnProperty.call(b,z)&&(_[z]=b[z]);return _},s.apply(this,arguments)},a=function(_){var b=_.doc,E=_.getPageIndex,A=_.renderSpinner,z=_.store,D=_.width,P=b.numPages,G=E?E({numPages:P}):0,R=Math.max(0,Math.min(G,P-1)),I=z.get("pagesRotation")||new Map,w=I.has(R)?I.get(R):0,H=r.useState(""),V=H[0],te=H[1],ae=e.useIsMounted(),be=r.useRef(),_e=r.useState(z.get("rotation")||0),le=_e[0],ue=_e[1],oe=r.useState(w),ee=oe[0],se=oe[1],re=r.useState(!1),fe=re[0],pe=re[1],Z=function(Te){var Ae=Te.has(R)?Te.get(R):0;se(Ae)},ce=function(Te){ue(Te)},Ee=e.useIntersectionObserver({onVisibilityChanged:function(Te){pe(Te.isVisible)}});return r.useEffect((function(){if(fe){var Te=Ee.current;Te&&(te(""),e.getPage(b,R).then((function(Ae){var Pe=Ae.getViewport({scale:1}),Me=(Pe.rotation+le+ee)%360,We=Math.abs(le+ee)%180==0,qe=We?Pe.width:Pe.height,Je=We?Pe.height:Pe.width,wt=document.createElement("canvas"),rt=wt.getContext("2d",{alpha:!1}),Lt=Te.clientWidth,ln=Te.clientHeight,dt=D?D/qe:Math.min(Lt/qe,ln/Je),st=dt*qe,nt=dt*Je;wt.height=nt,wt.width=st,wt.style.opacity="0";var dn=Ae.getViewport({rotation:Me,scale:dt});be.current=Ae.render({canvasContext:rt,viewport:dn}),be.current.promise.then((function(){ae.current&&te(wt.toDataURL()),wt.width=0,wt.height=0}),(function(){}))})))}}),[ee,fe]),r.useEffect((function(){return z.subscribe("pagesRotation",Z),z.subscribe("rotation",ce),function(){z.unsubscribe("pagesRotation",Z),z.unsubscribe("rotation",ce)}}),[]),r.useEffect((function(){return function(){var Te;(Te=be.current)===null||Te===void 0||Te.cancel()}}),[]),r.createElement("div",{ref:Ee,className:"rpv-thumbnail__cover-inner","data-testid":"thumbnail__cover-inner"},V?r.createElement("img",{className:"rpv-thumbnail__cover-image","data-testid":"thumbnail__cover-image",src:V}):r.createElement("div",{className:"rpv-thumbnail__cover-loader","data-testid":"thumbnail__cover-loader"},A?A():r.createElement(e.Spinner,null)))},l=function(_){var b=_.getPageIndex,E=_.renderSpinner,A=_.store,z=_.width,D=r.useState(A.get("doc")),P=D[0],G=D[1],R=function(I){G(I)};return r.useEffect((function(){return A.subscribe("doc",R),function(){A.unsubscribe("doc",R)}}),[]),r.createElement("div",{className:"rpv-thumbnail__cover"},P?r.createElement(a,{doc:P,getPageIndex:b,renderSpinner:E,store:A,width:z}):r.createElement("div",{className:"rpv-thumbnail__cover-loader"},E?E():r.createElement(e.Spinner,null)))},u=function(){return r.createElement(e.Spinner,null)},d=r.createContext({renderSpinner:u}),h=function(_){var b=_.children,E=_.doc,A=e.useIsMounted(),z=r.useState({loading:!0,labels:[]}),D=z[0],P=z[1];return r.useEffect((function(){E.getPageLabels().then((function(G){A.current&&P({loading:!1,labels:G||[]})}))}),[E.loadingTask.docId]),D.loading?r.createElement(r.Fragment,null):b(D.labels)},p=function(_){var b=_.page,E=_.pageHeight,A=_.pageIndex,z=_.pageWidth,D=_.rotation,P=_.thumbnailHeight,G=_.thumbnailWidth,R=_.onRenderCompleted,I=r.useContext(e.LocalizationContext).l10n,w=r.useRef(),H=r.useState(""),V=H[0],te=H[1],ae=I&&I.thumbnail?I.thumbnail.thumbnailLabel:"Thumbnail of page {{pageIndex}}";return r.useEffect((function(){var be=w.current;be&&be.cancel();var _e=document.createElement("canvas"),le=_e.getContext("2d",{alpha:!1}),ue=G,oe=ue/(z/E),ee=ue/z;_e.height=oe,_e.width=ue,_e.style.height="".concat(oe,"px"),_e.style.width="".concat(ue,"px");var se=b.getViewport({rotation:D,scale:ee});return w.current=b.render({canvasContext:le,viewport:se}),w.current.promise.then((function(){te(_e.toDataURL()),R(A)}),(function(){R(A)})),function(){var re;(re=w.current)===null||re===void 0||re.cancel()}}),[D]),V?r.createElement("img",{"aria-label":ae.replace("{{pageIndex}}","".concat(A+1)),src:V,height:"".concat(P,"px"),width:"".concat(G,"px")}):r.useContext(d).renderSpinner()},m=function(_){var b=_.doc,E=_.pageHeight,A=_.pageIndex,z=_.pageRotation,D=_.pageWidth,P=_.rotation,G=_.shouldRender,R=_.thumbnailWidth,I=_.onRenderCompleted,w=_.onVisibilityChanged,H=e.useIsMounted(),V=r.useState({height:E,page:null,viewportRotation:0,width:D}),te=V[0],ae=V[1],be=te.page,_e=te.height,le=te.width,ue=le/_e,oe=Math.abs(P+z)%180==0,ee=oe?R:R/ue,se=oe?R/ue:R;r.useEffect((function(){G&&e.getPage(b,A).then((function(pe){var Z=pe.getViewport({scale:1});H.current&&ae({height:Z.height,page:pe,viewportRotation:Z.rotation,width:Z.width})}))}),[G]);var re=(te.viewportRotation+P+z)%360,fe=e.useIntersectionObserver({onVisibilityChanged:function(pe){w(A,pe)}});return r.createElement("div",{className:"rpv-thumbnail__container","data-testid":"thumbnail__container-".concat(A),ref:fe,style:{height:"".concat(se,"px"),width:"".concat(ee,"px")}},be?r.createElement(p,{page:be,pageHeight:oe?_e:le,pageIndex:A,pageWidth:oe?le:_e,rotation:re,thumbnailHeight:se,thumbnailWidth:ee,onRenderCompleted:I}):r.useContext(d).renderSpinner())},g=function(_){var b=_.currentPage,E=_.doc,A=_.labels,z=_.pagesRotation,D=_.pageHeight,P=_.pageWidth,G=_.renderCurrentPageLabel,R=_.renderThumbnailItem,I=_.rotatedPage,w=_.rotation,H=_.thumbnailDirection,V=_.thumbnailWidth,te=_.viewMode,ae=_.onJumpToPage,be=_.onRotatePage,_e=E.numPages,le=E.loadingTask.docId,ue=r.useRef(null),oe=r.useRef([]),ee=r.useState(b),se=ee[0],re=ee[1],fe=r.useContext(e.ThemeContext).direction===e.TextDirection.RightToLeft,pe=r.useState(-1),Z=pe[0],ce=pe[1],Ee=e.useIsMounted(),Te=e.usePrevious(te),Ae=r.useRef(!1),Pe=e.useRenderQueue({doc:E}),Me=r.useMemo((function(){return Array(_e).fill(0).map((function(dt,st){return st}))}),[le]),We=r.useMemo((function(){switch(te){case e.ViewMode.DualPage:return e.chunk(Me,2);case e.ViewMode.DualPageWithCover:return[[Me[0]]].concat(e.chunk(Me.slice(1),2));case e.ViewMode.SinglePage:default:return e.chunk(Me,1)}}),[le,te]),qe=function(){if(ue.current){var dt=oe.current,st=se+1;st<dt.length&&(se>=0&&dt[se].setAttribute("tabindex","-1"),re(st))}},Je=function(){if(ue.current){var dt=oe.current,st=se-1;st>=0&&(se>=0&&dt[se].setAttribute("tabindex","-1"),re(st))}},wt=function(){se>=0&&se<_e&&ae(se)};e.useIsomorphicLayoutEffect((function(){var dt=ue.current;dt&&(oe.current=Array.from(dt.querySelectorAll(".rpv-thumbnail__item")))}),[te]),r.useEffect((function(){var dt=oe.current;if(!(dt.length===0||se<0||se>dt.length)){var st=dt[se];st.setAttribute("tabindex","0"),st.focus()}}),[se]),e.useIsomorphicLayoutEffect((function(){var dt=ue.current,st=oe.current;if(!(!dt||st.length===0||b<0||b>st.length)){var nt=st[b].closest(".rpv-thumbnail__items");nt&&(H===i.ThumbnailDirection.Vertical?(function(dn,pn){var An=dn.getBoundingClientRect().top-pn.getBoundingClientRect().top,In=dn.clientHeight,Jn=pn.clientHeight;An<0?pn.scrollTop+=An:An+In<=Jn||(pn.scrollTop+=An+In-Jn)})(nt,dt):(function(dn,pn){var An=dn.getBoundingClientRect().left-pn.getBoundingClientRect().left,In=dn.clientWidth,Jn=pn.clientWidth;An<0?pn.scrollLeft+=An:An+In<=Jn||(pn.scrollLeft+=An+In-Jn)})(nt,dt))}}),[b,H]);var rt=r.useCallback((function(dt){Ee.current&&(Pe.markRendered(dt),Ae.current=!1,ln())}),[le]),Lt=r.useCallback((function(dt,st){st.isVisible?Pe.setVisibility(dt,st.ratio):Pe.setOutOfRange(dt),ln()}),[le]),ln=r.useCallback((function(){if(!Ae.current){var dt=Pe.getHighestPriorityPage();dt>-1&&(Pe.markRendering(dt),Ae.current=!0,ce(dt))}}),[le]);return r.useEffect((function(){I>=0&&(Pe.markRendering(I),Ae.current=!0,ce(I))}),[le,I]),e.useIsomorphicLayoutEffect((function(){Te!==te&&(Pe.markNotRendered(),ln())}),[te]),r.createElement("div",{ref:ue,"data-testid":"thumbnail__list",className:e.classNames({"rpv-thumbnail__list":!0,"rpv-thumbnail__list--horizontal":H===i.ThumbnailDirection.Horizontal,"rpv-thumbnail__list--rtl":fe,"rpv-thumbnail__list--vertical":H===i.ThumbnailDirection.Vertical}),onKeyDown:function(dt){switch(dt.key){case"ArrowDown":qe();break;case"ArrowUp":Je();break;case"Enter":wt()}}},We.map((function(dt,st){var nt=!1;switch(te){case e.ViewMode.DualPage:nt=b===2*st||b===2*st+1;break;case e.ViewMode.DualPageWithCover:nt=b===0&&st===0||st>0&&b===2*st-1||st>0&&b===2*st;break;case e.ViewMode.SinglePage:default:nt=b===st}return r.createElement("div",{className:e.classNames({"rpv-thumbnail__items":!0,"rpv-thumbnail__items--dual":te===e.ViewMode.DualPage,"rpv-thumbnail__items--dual-cover":te===e.ViewMode.DualPageWithCover,"rpv-thumbnail__items--single":te===e.ViewMode.SinglePage,"rpv-thumbnail__items--selected":nt}),key:"".concat(st,"___").concat(te)},dt.map((function(dn){return(function(pn){var An=te===e.ViewMode.DualPageWithCover&&(pn===0||_e%2==0&&pn===_e-1),In="".concat(E.loadingTask.docId,"___").concat(pn),Jn=A.length===_e?A[pn]:"".concat(pn+1),ri=G?G({currentPage:b,pageIndex:pn,numPages:_e,pageLabel:Jn}):Jn,Wn=z.has(pn)?z.get(pn):0,hi=r.createElement(m,{doc:E,pageHeight:D,pageIndex:pn,pageRotation:Wn,pageWidth:P,rotation:w,shouldRender:Z===pn,thumbnailWidth:V,onRenderCompleted:rt,onVisibilityChanged:Lt});return R?R({currentPage:b,key:In,numPages:_e,pageIndex:pn,renderPageLabel:r.createElement(r.Fragment,null,ri),renderPageThumbnail:hi,onJumpToPage:function(){return ae(pn)},onRotatePage:function(ai){return be(pn,ai)}}):r.createElement("div",{key:In},r.createElement("div",{className:e.classNames({"rpv-thumbnail__item":!0,"rpv-thumbnail__item--dual-even":te===e.ViewMode.DualPage&&pn%2==0,"rpv-thumbnail__item--dual-odd":te===e.ViewMode.DualPage&&pn%2==1,"rpv-thumbnail__item--dual-cover":An,"rpv-thumbnail__item--dual-cover-even":te===e.ViewMode.DualPageWithCover&&!An&&pn%2==0,"rpv-thumbnail__item--dual-cover-odd":te===e.ViewMode.DualPageWithCover&&!An&&pn%2==1,"rpv-thumbnail__item--single":te===e.ViewMode.SinglePage,"rpv-thumbnail__item--selected":b===pn}),role:"button",tabIndex:b===pn?0:-1,onClick:function(){return ae(pn)}},hi),r.createElement("div",{"data-testid":"thumbnail__label-".concat(pn),className:"rpv-thumbnail__label"},ri))})(dn)})))})))},v=function(_){var b=_.renderCurrentPageLabel,E=_.renderThumbnailItem,A=_.store,z=_.thumbnailDirection,D=_.thumbnailWidth,P=r.useState(A.get("doc")),G=P[0],R=P[1],I=r.useState(A.get("currentPage")||0),w=I[0],H=I[1],V=r.useState(A.get("pageHeight")||0),te=V[0],ae=V[1],be=r.useState(A.get("pageWidth")||0),_e=be[0],le=be[1],ue=r.useState(A.get("rotation")||0),oe=ue[0],ee=ue[1],se=r.useState(A.get("pagesRotation")||new Map),re=se[0],fe=se[1],pe=r.useState(A.get("rotatedPage")||-1),Z=pe[0],ce=pe[1],Ee=r.useState(A.get("viewMode")),Te=Ee[0],Ae=Ee[1],Pe=function(st){H(st)},Me=function(st){R(st)},We=function(st){ae(st)},qe=function(st){le(st)},Je=function(st){ee(st)},wt=function(st){fe(st)},rt=function(st){ce(st)},Lt=function(st){Ae(st)},ln=function(st){var nt=A.get("jumpToPage");nt&&nt(st)},dt=function(st,nt){A.get("rotatePage")(st,nt)};return r.useEffect((function(){return A.subscribe("doc",Me),A.subscribe("pageHeight",We),A.subscribe("pageWidth",qe),A.subscribe("rotatedPage",rt),A.subscribe("rotation",Je),A.subscribe("pagesRotation",wt),A.subscribe("viewMode",Lt),function(){A.unsubscribe("doc",Me),A.unsubscribe("pageHeight",We),A.unsubscribe("pageWidth",qe),A.unsubscribe("rotatedPage",rt),A.unsubscribe("rotation",Je),A.unsubscribe("pagesRotation",wt),A.unsubscribe("viewMode",Lt)}}),[]),e.useIsomorphicLayoutEffect((function(){return A.subscribe("currentPage",Pe),function(){A.unsubscribe("currentPage",Pe)}}),[]),G?r.createElement(e.LazyRender,{testId:"thumbnail__list-container",attrs:{className:"rpv-thumbnail__list-container"}},r.createElement(h,{doc:G},(function(st){return r.createElement(g,{currentPage:w,doc:G,labels:st,pagesRotation:re,pageHeight:te,pageWidth:_e,renderCurrentPageLabel:b,renderThumbnailItem:E,rotatedPage:Z,rotation:oe,thumbnailDirection:z,thumbnailWidth:D,viewMode:Te,onJumpToPage:ln,onRotatePage:dt})}))):r.createElement("div",{"data-testid":"thumbnail-list__loader",className:"rpv-thumbnail__loader"},r.useContext(d).renderSpinner())};i.thumbnailPlugin=function(_){var b=r.useMemo((function(){return e.createStore({rotatePage:function(){},viewMode:e.ViewMode.SinglePage})}),[]),E=r.useState(""),A=E[0],z=E[1];return{install:function(D){b.update("jumpToPage",D.jumpToPage),b.update("rotatePage",D.rotatePage)},onDocumentLoad:function(D){z(D.doc.loadingTask.docId),b.update("doc",D.doc)},onViewerStateChange:function(D){return b.update("currentPage",D.pageIndex),b.update("pagesRotation",D.pagesRotation),b.update("pageHeight",D.pageHeight),b.update("pageWidth",D.pageWidth),b.update("rotation",D.rotation),b.update("rotatedPage",D.rotatedPage),b.update("viewMode",D.viewMode),D},Cover:function(D){return r.createElement(l,s({},D,{renderSpinner:_?.renderSpinner,store:b}))},Thumbnails:r.useCallback((function(D){return r.createElement(d.Provider,{value:{renderSpinner:_?.renderSpinner||u}},r.createElement(v,{renderCurrentPageLabel:_?.renderCurrentPageLabel,renderThumbnailItem:D?.renderThumbnailItem,store:b,thumbnailDirection:D?.thumbnailDirection||i.ThumbnailDirection.Vertical,thumbnailWidth:_?.thumbnailWidth||100}))}),[A])}}})(thumbnail_min)),thumbnail_min}var hasRequiredLib$e;function requireLib$e(){if(hasRequiredLib$e)return lib$d.exports;hasRequiredLib$e=1;return lib$d.exports=requireThumbnail_min(),lib$d.exports}var lib$c={exports:{}},toolbar_min={},lib$b={exports:{}},selectionMode_min={},hasRequiredSelectionMode_min;function requireSelectionMode_min(){return hasRequiredSelectionMode_min||(hasRequiredSelectionMode_min=1,(function(i){var e=requireLib$h();function t(v){var _=Object.create(null);return v&&Object.keys(v).forEach((function(b){if(b!=="default"){var E=Object.getOwnPropertyDescriptor(v,b);Object.defineProperty(_,b,E.get?E:{enumerable:!0,get:function(){return v[b]}})}})),_.default=v,Object.freeze(_)}var n,r=t(requireReact()),s=function(){return r.createElement(e.Icon,{size:16},r.createElement("path",{d:`M11.5,5.5v-2C11.5,2.672,12.172,2,13,2s1.5,0.672,1.5,1.5v2 M14.5,11.5v-6C14.5,4.672,15.172,4,16,4
            c0.828,0,1.5,0.672,1.5,1.5v3 M17.5,13V8.5C17.5,7.672,18.172,7,19,7s1.5,0.672,1.5,1.5v10c0,2.761-2.239,5-5,5h-3.335
            c-1.712-0.001-3.305-0.876-4.223-2.321C6.22,18.467,4.083,14,4.083,14c-0.378-0.545-0.242-1.292,0.303-1.67
            c0.446-0.309,1.044-0.281,1.458,0.07L8.5,15.5v-10C8.5,4.672,9.172,4,10,4s1.5,0.672,1.5,1.5v6`}))},a=function(){return a=Object.assign||function(v){for(var _,b=1,E=arguments.length;b<E;b++)for(var A in _=arguments[b])Object.prototype.hasOwnProperty.call(_,A)&&(v[A]=_[A]);return v},a.apply(this,arguments)};i.SelectionMode=void 0,(n=i.SelectionMode||(i.SelectionMode={})).Hand="Hand",n.Text="Text";var l=function(){return r.createElement(e.Icon,{size:16},r.createElement("path",{d:`M13.675,11.671l2.941-2.941c0.195-0.196,0.195-0.512-0.001-0.707C16.563,7.971,16.5,7.931,16.43,7.906
            L4.168,3.527C3.908,3.434,3.622,3.57,3.529,3.83c-0.039,0.109-0.039,0.228,0,0.336l4.379,12.262
            c0.093,0.26,0.379,0.396,0.639,0.303c0.07-0.025,0.133-0.065,0.185-0.117l2.943-2.943l6.146,6.146c0.195,0.195,0.512,0.195,0.707,0
            l1.293-1.293c0.195-0.195,0.195-0.512,0-0.707L13.675,11.671z`}))},u=function(v){var _=v.children,b=v.mode,E=v.onClick,A=r.useContext(e.LocalizationContext).l10n,z="",D=r.createElement(l,null);switch(b){case i.SelectionMode.Hand:z=A&&A.selectionMode?A.selectionMode.handTool:"Hand tool",D=r.createElement(s,null);break;case i.SelectionMode.Text:default:z=A&&A.selectionMode?A.selectionMode.textSelectionTool:"Text selection tool",D=r.createElement(l,null)}return _({icon:D,label:z,onClick:E})},d={left:0,top:8},h=function(v){var _=v.isSelected,b=v.mode,E=v.onClick,A="";switch(b){case i.SelectionMode.Hand:A="selection-mode__hand-button";break;case i.SelectionMode.Text:default:A="selection-mode__text-button"}return r.createElement(u,{mode:b,onClick:E},(function(z){return r.createElement(e.Tooltip,{ariaControlsSuffix:"selection-mode-switch",position:e.Position.BottomCenter,target:r.createElement(e.MinimalButton,{ariaLabel:z.label,isSelected:_,testId:A,onClick:z.onClick},z.icon),content:function(){return z.label},offset:d})}))},p=function(v){var _=v.children,b=v.mode,E=v.store,A=b===E.get("selectionMode");return(_||function(z){return r.createElement(h,{isSelected:A,mode:z.mode,onClick:z.onClick})})({isSelected:A,mode:b,onClick:function(){return E.update("selectionMode",b)}})},m=function(v){var _=v.isSelected,b=v.mode,E=v.onClick,A="";switch(b){case i.SelectionMode.Hand:A="selection-mode__hand-menu";break;case i.SelectionMode.Text:default:A="selection-mode__text-menu"}return r.createElement(u,{mode:b,onClick:E},(function(z){return r.createElement(e.MenuItem,{checked:_,icon:z.icon,testId:A,onClick:z.onClick},z.label)}))},g=function(v){var _=v.store,b=r.useRef(null),E=r.useState(i.SelectionMode.Text),A=E[0],z=E[1],D=r.useRef({top:0,left:0,x:0,y:0}),P=function(H){var V=b.current;V&&(V.scrollTop=D.current.top-(H.clientY-D.current.y),V.scrollLeft=D.current.left-(H.clientX-D.current.x))},G=function(){var H=b.current;H&&(H.classList.add("rpv-selection-mode__grab"),H.classList.remove("rpv-selection-mode__grabbing"),document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",G))},R=function(H){var V=b.current;V&&A!==i.SelectionMode.Text&&(V.classList.remove("rpv-selection-mode__grab"),V.classList.add("rpv-selection-mode__grabbing"),H.preventDefault(),H.stopPropagation(),D.current={left:V.scrollLeft,top:V.scrollTop,x:H.clientX,y:H.clientY},document.addEventListener("mousemove",P),document.addEventListener("mouseup",G))},I=function(H){b.current=H()},w=function(H){z(H)};return r.useEffect((function(){var H=b.current;if(H)return A===i.SelectionMode.Hand?H.classList.add("rpv-selection-mode__grab"):H.classList.remove("rpv-selection-mode__grab"),H.addEventListener("mousedown",R),function(){H.removeEventListener("mousedown",R)}}),[A]),r.useEffect((function(){return _.subscribe("getPagesContainer",I),_.subscribe("selectionMode",w),function(){_.unsubscribe("getPagesContainer",I),_.unsubscribe("selectionMode",w)}}),[]),r.createElement(r.Fragment,null)};i.HandToolIcon=s,i.TextSelectionIcon=l,i.selectionModePlugin=function(v){var _=r.useMemo((function(){return e.createStore()}),[]),b=function(E){return r.createElement(p,a({},E,{store:_}))};return{install:function(E){_.update("selectionMode",v&&v.selectionMode?v.selectionMode:i.SelectionMode.Text),_.update("getPagesContainer",E.getPagesContainer)},renderViewer:function(E){var A=E.slot;return A.subSlot&&A.subSlot.children&&(A.subSlot.children=r.createElement(r.Fragment,null,r.createElement(g,{store:_}),A.subSlot.children)),A},SwitchSelectionMode:b,SwitchSelectionModeButton:function(E){return r.createElement(b,{mode:E.mode},(function(A){return r.createElement(h,{isSelected:A.isSelected,mode:A.mode,onClick:function(){A.onClick()}})}))},SwitchSelectionModeMenuItem:function(E){return r.createElement(b,{mode:E.mode},(function(A){return r.createElement(m,{isSelected:A.isSelected,mode:A.mode,onClick:function(){A.onClick(),E.onClick()}})}))}}}})(selectionMode_min)),selectionMode_min}var hasRequiredLib$d;function requireLib$d(){if(hasRequiredLib$d)return lib$b.exports;hasRequiredLib$d=1;return lib$b.exports=requireSelectionMode_min(),lib$b.exports}var lib$a={exports:{}},fullScreen_min={},hasRequiredFullScreen_min;function requireFullScreen_min(){if(hasRequiredFullScreen_min)return fullScreen_min;hasRequiredFullScreen_min=1;var i=requireLib$h();function e(E){var A=Object.create(null);return E&&Object.keys(E).forEach((function(z){if(z!=="default"){var D=Object.getOwnPropertyDescriptor(E,z);Object.defineProperty(A,z,D.get?D:{enumerable:!0,get:function(){return E[z]}})}})),A.default=E,Object.freeze(A)}var t=e(requireReact()),n=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:"M11.5 23.499L11.5 14.499"}),t.createElement("path",{d:"M7.5 18.499L11.5 14.499 15.5 18.499"}),t.createElement("path",{d:"M11.5 1.499L11.5 10.499"}),t.createElement("path",{d:"M7.5 6.499L11.5 10.499 15.5 6.499"}),t.createElement("path",{d:"M20.5 12.499L1.5 12.499"}))},r=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:"M0.5 12L23.5 12"}),t.createElement("path",{d:"M11.5 1L11.5 23"}),t.createElement("path",{d:"M8.5 4L11.5 1 14.5 4"}),t.createElement("path",{d:"M20.5 9L23.5 12 20.5 15"}),t.createElement("path",{d:"M3.5 15L0.5 12 3.5 9"}),t.createElement("path",{d:"M14.5 20L11.5 23 8.5 20"}))},s=function(){return s=Object.assign||function(E){for(var A,z=1,D=arguments.length;z<D;z++)for(var P in A=arguments[z])Object.prototype.hasOwnProperty.call(A,P)&&(E[P]=A[P]);return E},s.apply(this,arguments)},a={left:0,top:8},l=function(E){var A=E.enableShortcuts,z=E.onClick,D=t.useContext(i.LocalizationContext).l10n,P=D&&D.fullScreen?D.fullScreen.enterFullScreen:"Full screen",G=A?i.isMac()?"Meta+Ctrl+F":"F11":"";return t.createElement(i.Tooltip,{ariaControlsSuffix:"full-screen-enter",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaKeyShortcuts:G,ariaLabel:P,isDisabled:!i.isFullScreenEnabled(),testId:"full-screen__enter-button",onClick:z},t.createElement(r,null)),content:function(){return P},offset:a})},u={left:0,top:8},d=function(E){var A=E.onClick,z=t.useContext(i.LocalizationContext).l10n,D=z&&z.fullScreen?z.fullScreen.exitFullScreen:"Exit full screen";return t.createElement(i.Tooltip,{ariaControlsSuffix:"full-screen-exit",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaKeyShortcuts:"Esc",ariaLabel:D,testId:"full-screen__exit-button-with-tooltip",onClick:A},t.createElement(n,null)),content:function(){return D},offset:u})},h=function(E,A){var z=t.useState(A.get("fullScreenMode")),D=z[0],P=z[1],G=t.useCallback((function(R){P(R)}),[]);return t.useEffect((function(){return A.subscribe("fullScreenMode",G),function(){A.unsubscribe("fullScreenMode",G)}}),[]),{enterFullScreen:function(){var R=A.get("getPagesContainer");if(R){var I=E(R());A.get("enterFullScreenMode")(I)}},exitFullScreen:function(){A.get("exitFullScreenMode")()},isFullScreen:D===i.FullScreenMode.Entering||D===i.FullScreenMode.EnteredCompletely}},p=function(E){var A=E.children,z=E.enableShortcuts,D=E.getFullScreenTarget,P=E.store,G=h(D,P),R=G.enterFullScreen,I=G.exitFullScreen,w=G.isFullScreen;return(A||function(H){return w?t.createElement(d,{onClick:H.onClick}):t.createElement(l,{enableShortcuts:z,onClick:H.onClick})})({onClick:w?I:R})},m=function(E){var A=E.onClick,z=t.useContext(i.LocalizationContext).l10n,D=z&&z.fullScreen?z.fullScreen.enterFullScreen:"Full screen";return t.createElement(i.MenuItem,{icon:t.createElement(r,null),isDisabled:!i.isFullScreenEnabled(),testId:"full-screen__enter-menu",onClick:A},D)},g=function(E){var A=E.onClick,z=t.useContext(i.LocalizationContext).l10n,D=t.useContext(i.ThemeContext).direction===i.TextDirection.RightToLeft,P=z&&z.fullScreen?z.fullScreen.exitFullScreen:"Exit full screen";return t.createElement("div",{className:i.classNames({"rpv-full-screen__exit-button":!0,"rpv-full-screen__exit-button--ltr":!D,"rpv-full-screen__exit-button--rtl":D})},t.createElement(i.MinimalButton,{ariaLabel:P,testId:"full-screen__exit-button",onClick:A},t.createElement(n,null)))},v=function(E){var A=E.children,z=E.getFullScreenTarget,D=E.store,P=h(z,D),G=P.enterFullScreen,R=P.exitFullScreen,I=P.isFullScreen;return I&&(A||function(w){return t.createElement(g,{onClick:w.onClick})})({onClick:I?R:G})},_=function(E){var A=E.store,z=E.onEnterFullScreen,D=E.onExitFullScreen,P=t.useState(A.get("fullScreenMode")),G=P[0],R=P[1],I=t.useCallback((function(w){R(w)}),[]);return t.useEffect((function(){switch(G){case i.FullScreenMode.EnteredCompletely:z(A.get("zoom"));break;case i.FullScreenMode.Exited:D(A.get("zoom"))}}),[G]),t.useEffect((function(){return A.subscribe("fullScreenMode",I),function(){A.unsubscribe("fullScreenMode",I)}}),[]),(G===i.FullScreenMode.Entering||G===i.FullScreenMode.Entered)&&t.createElement("div",{className:"rpv-full-screen__overlay"},t.createElement(i.Spinner,null))},b=function(E){var A=E.containerRef,z=E.getFullScreenTarget,D=E.store,P=h(z,D).enterFullScreen,G=function(R){if(!R.shiftKey&&!R.altKey&&(i.isMac()?R.metaKey&&R.ctrlKey&&R.key==="f":R.key==="F11")){var I=A.current;I&&document.activeElement&&I.contains(document.activeElement)&&(R.preventDefault(),P())}};return t.useEffect((function(){if(A.current)return document.addEventListener("keydown",G),function(){document.removeEventListener("keydown",G)}}),[A.current]),t.createElement(t.Fragment,null)};return fullScreen_min.ExitFullScreenIcon=n,fullScreen_min.FullScreenIcon=r,fullScreen_min.fullScreenPlugin=function(E){var A=E?.getFullScreenTarget||function(R){return R},z=t.useMemo((function(){return Object.assign({},{enableShortcuts:!0,onEnterFullScreen:function(){},onExitFullScreen:function(){}},E)}),[]),D=t.useMemo((function(){return i.createStore({enterFullScreenMode:function(){},exitFullScreenMode:function(){},fullScreenMode:i.FullScreenMode.Normal,zoom:function(){}})}),[]),P=function(R){return t.createElement(p,s({},R,{enableShortcuts:z.enableShortcuts,getFullScreenTarget:A,store:D}))},G=function(){return t.createElement(v,{getFullScreenTarget:A,store:D},E?.renderExitFullScreenButton)};return{install:function(R){D.update("enterFullScreenMode",R.enterFullScreenMode),D.update("exitFullScreenMode",R.exitFullScreenMode),D.update("getPagesContainer",R.getPagesContainer),D.update("zoom",R.zoom)},onViewerStateChange:function(R){return D.update("fullScreenMode",R.fullScreenMode),R},renderViewer:function(R){var I=R.slot;return I.subSlot&&(I.subSlot.children=t.createElement(t.Fragment,null,z.enableShortcuts&&t.createElement(b,{containerRef:R.containerRef,getFullScreenTarget:A,store:D}),t.createElement(_,{store:D,onEnterFullScreen:z.onEnterFullScreen,onExitFullScreen:z.onExitFullScreen}),t.createElement(G,null),I.subSlot.children)),I},EnterFullScreen:P,EnterFullScreenButton:function(){return t.createElement(P,null,(function(R){return t.createElement(l,s({enableShortcuts:z.enableShortcuts},R))}))},EnterFullScreenMenuItem:function(R){return t.createElement(P,null,(function(I){return t.createElement(m,{onClick:function(){I.onClick(),R.onClick()}})}))}}},fullScreen_min}var hasRequiredLib$c;function requireLib$c(){if(hasRequiredLib$c)return lib$a.exports;hasRequiredLib$c=1;return lib$a.exports=requireFullScreen_min(),lib$a.exports}var lib$9={exports:{}},getFile_min={},hasRequiredGetFile_min;function requireGetFile_min(){if(hasRequiredGetFile_min)return getFile_min;hasRequiredGetFile_min=1;var i=requireLib$h();function e(m){var g=Object.create(null);return m&&Object.keys(m).forEach((function(v){if(v!=="default"){var _=Object.getOwnPropertyDescriptor(m,v);Object.defineProperty(g,v,_.get?_:{enumerable:!0,get:function(){return m[v]}})}})),g.default=m,Object.freeze(g)}var t=e(requireReact()),n=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:"M5.5,11.5c-.275,0-.341.159-.146.354l6.292,6.293a.5.5,0,0,0,.709,0l6.311-6.275c.2-.193.13-.353-.145-.355L15.5,11.5V1.5a1,1,0,0,0-1-1h-5a1,1,0,0,0-1,1V11a.5.5,0,0,1-.5.5Z"}),t.createElement("path",{d:"M23.5,18.5v4a1,1,0,0,1-1,1H1.5a1,1,0,0,1-1-1v-4"}))},r=function(){return r=Object.assign||function(m){for(var g,v=1,_=arguments.length;v<_;v++)for(var b in g=arguments[v])Object.prototype.hasOwnProperty.call(g,b)&&(m[b]=g[b]);return m},r.apply(this,arguments)},s={left:0,top:8},a=function(m){var g=m.onClick,v=t.useContext(i.LocalizationContext).l10n,_=v&&v.download?v.download.download:"Download";return t.createElement(i.Tooltip,{ariaControlsSuffix:"get-file",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaLabel:_,testId:"get-file__download-button",onClick:g},t.createElement(n,null)),content:function(){return _},offset:s})},l=function(m,g){var v=document.createElement("a");v.style.display="none",v.href=m,v.setAttribute("download",g),document.body.appendChild(v),v.click(),document.body.removeChild(v)},u=function(m,g,v){var _=URL.createObjectURL(new Blob([m],{type:v}));l(_,g),_&&URL.revokeObjectURL(_)},d=function(m,g){m.getData().then((function(v){/iphone|ipod|ipad/i.test(navigator.userAgent)&&!/CriOS/i.test(navigator.userAgent)?u(v,g,"application/octet-stream"):/iphone|ipod|ipad/i.test(navigator.userAgent)&&/CriOS/i.test(navigator.userAgent)?l("data:application/pdf;base64,".concat((function(_){return btoa(Array(_.length).fill("").map((function(b,E){return String.fromCharCode(_[E])})).join(""))})(v)),g):u(v,g,"application/pdf")}))},h=function(m){var g=m.children,v=m.fileNameGenerator,_=m.store,b=t.useState(_.get("file")),E=b[0],A=b[1],z=t.useState(_.get("doc")),D=z[0],P=z[1],G=function(I){P(I)},R=function(I){A(I)};return t.useEffect((function(){return _.subscribe("doc",G),_.subscribe("file",R),function(){_.subscribe("doc",G),_.unsubscribe("file",R)}}),[]),(g||function(I){return t.createElement(a,{onClick:I.onClick})})({onClick:function(){D&&E&&d(D,v(E))}})},p=function(m){var g=m.onClick,v=t.useContext(i.LocalizationContext).l10n,_=v&&v.download?v.download.download:"Download";return t.createElement(i.MenuItem,{icon:t.createElement(n,null),testId:"get-file__download-menu",onClick:g},_)};return getFile_min.DownloadIcon=n,getFile_min.getFilePlugin=function(m){var g=t.useMemo((function(){return i.createStore({})}),[]),v=function(b){return b.name?(E=b.name,(A=E.split("/").pop())?A.split("#")[0].split("?")[0]:E):"document.pdf";var E,A},_=function(b){return t.createElement(h,r({},b,{fileNameGenerator:m&&m.fileNameGenerator||v,store:g}))};return{onDocumentLoad:function(b){g.update("doc",b.doc),g.update("file",b.file)},Download:_,DownloadButton:function(){return t.createElement(_,null,(function(b){return t.createElement(a,r({},b))}))},DownloadMenuItem:function(b){return t.createElement(_,null,(function(E){return t.createElement(p,{onClick:function(){E.onClick(),b.onClick()}})}))}}},getFile_min}var hasRequiredLib$b;function requireLib$b(){if(hasRequiredLib$b)return lib$9.exports;hasRequiredLib$b=1;return lib$9.exports=requireGetFile_min(),lib$9.exports}var lib$8={exports:{}},open_min={},hasRequiredOpen_min;function requireOpen_min(){if(hasRequiredOpen_min)return open_min;hasRequiredOpen_min=1;var i=requireLib$h();function e(p){var m=Object.create(null);return p&&Object.keys(p).forEach((function(g){if(g!=="default"){var v=Object.getOwnPropertyDescriptor(p,g);Object.defineProperty(m,g,v.get?v:{enumerable:!0,get:function(){return p[g]}})}})),m.default=p,Object.freeze(m)}var t=e(requireReact()),n=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:"M18.5,7.5c.275,0,.341-.159.146-.354L12.354.854a.5.5,0,0,0-.708,0L5.354,7.147c-.2.195-.129.354.146.354h3v10a1,1,0,0,0,1,1h5a1,1,0,0,0,1-1V7.5Z"}),t.createElement("path",{d:"M23.5,18.5v4a1,1,0,0,1-1,1H1.5a1,1,0,0,1-1-1v-4"}))},r=function(){return r=Object.assign||function(p){for(var m,g=1,v=arguments.length;g<v;g++)for(var _ in m=arguments[g])Object.prototype.hasOwnProperty.call(m,_)&&(p[_]=m[_]);return p},r.apply(this,arguments)},s=function(p){var m=t.useRef(),g=function(){var _=m.current;_&&(_.click(),p.get("triggerOpenFile")&&p.update("triggerOpenFile",!1))},v=function(_){_&&g()};return t.useEffect((function(){return p.subscribe("triggerOpenFile",v),function(){p.unsubscribe("triggerOpenFile",v)}}),[]),{inputRef:m,openFile:g}},a={left:0,top:8},l=function(p){var m=p.enableShortcuts,g=p.store,v=p.onClick,_=t.useContext(i.LocalizationContext).l10n,b=_&&_.open?_.open.openFile:"Open file",E=s(g),A=E.inputRef,z=E.openFile,D=m?i.isMac()?"Meta+O":"Ctrl+O":"";return t.createElement(i.Tooltip,{ariaControlsSuffix:"open",position:i.Position.BottomCenter,target:t.createElement("div",{className:"rpv-open__input-wrapper"},t.createElement("input",{accept:".pdf",ref:A,className:"rpv-open__input",multiple:!1,tabIndex:-1,title:"",type:"file",onChange:v}),t.createElement(i.MinimalButton,{ariaKeyShortcuts:D,ariaLabel:b,testId:"open__button",onClick:z},t.createElement(n,null))),content:function(){return b},offset:a})},u=function(p){var m=p.children,g=p.enableShortcuts,v=p.store;return(m||function(_){return t.createElement(l,{enableShortcuts:g,store:v,onClick:_.onClick})})({onClick:function(_){var b=_.target.files;if(b&&b.length){var E=v.get("openFile");E&&E(b[0])}}})},d=function(p){var m=p.store,g=p.onClick,v=t.useContext(i.LocalizationContext).l10n,_=v&&v.open?v.open.openFile:"Open file",b=s(m),E=b.inputRef,A=b.openFile;return t.createElement(i.MenuItem,{icon:t.createElement(n,null),testId:"open__menu",onClick:A},t.createElement("div",{className:"rpv-open__input-wrapper"},t.createElement("input",{accept:".pdf",ref:E,className:"rpv-open__input",multiple:!1,tabIndex:-1,title:"",type:"file",onChange:g}),_))},h=function(p){var m=p.containerRef,g=p.store,v=function(_){if(!_.shiftKey&&!_.altKey&&_.key==="o"&&(i.isMac()?_.metaKey:_.ctrlKey)){var b=m.current;b&&document.activeElement&&b.contains(document.activeElement)&&(_.preventDefault(),g.update("triggerOpenFile",!0))}};return t.useEffect((function(){if(m.current)return document.addEventListener("keydown",v),function(){document.removeEventListener("keydown",v)}}),[m.current]),t.createElement(t.Fragment,null)};return open_min.OpenFileIcon=n,open_min.openPlugin=function(p){var m=t.useMemo((function(){return Object.assign({},{enableShortcuts:!0},p)}),[]),g=t.useMemo((function(){return i.createStore({})}),[]),v=function(_){return t.createElement(u,r({enableShortcuts:m.enableShortcuts},_,{store:g}))};return{install:function(_){g.update("openFile",_.openFile)},renderViewer:function(_){var b=_.slot,E={children:t.createElement(t.Fragment,null,m.enableShortcuts&&t.createElement(h,{containerRef:_.containerRef,store:g}),b.children)};return r(r({},b),E)},Open:v,OpenButton:function(){return t.createElement(v,null)},OpenMenuItem:function(){return t.createElement(v,null,(function(_){return t.createElement(d,{store:g,onClick:_.onClick})}))}}},open_min}var hasRequiredLib$a;function requireLib$a(){if(hasRequiredLib$a)return lib$8.exports;hasRequiredLib$a=1;return lib$8.exports=requireOpen_min(),lib$8.exports}var lib$7={exports:{}},pageNavigation_min={},hasRequiredPageNavigation_min;function requirePageNavigation_min(){if(hasRequiredPageNavigation_min)return pageNavigation_min;hasRequiredPageNavigation_min=1;var i=requireLib$h();function e(_e){var le=Object.create(null);return _e&&Object.keys(_e).forEach((function(ue){if(ue!=="default"){var oe=Object.getOwnPropertyDescriptor(_e,ue);Object.defineProperty(le,ue,oe.get?oe:{enumerable:!0,get:function(){return _e[ue]}})}})),le.default=_e,Object.freeze(le)}var t=e(requireReact()),n=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:`M2.32,2.966h19.452c0.552,0.001,1,0.449,0.999,1.001c0,0.182-0.05,0.36-0.144,0.516L12.9,20.552
            c-0.286,0.472-0.901,0.624-1.373,0.338c-0.138-0.084-0.254-0.2-0.338-0.338L1.465,4.483C1.179,4.01,1.331,3.396,1.804,3.11
            C1.96,3.016,2.138,2.966,2.32,2.966z`}))},r=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:`M0.541,5.627L11.666,18.2c0.183,0.207,0.499,0.226,0.706,0.043c0.015-0.014,0.03-0.028,0.043-0.043
            L23.541,5.627`}))},s=function(){return s=Object.assign||function(_e){for(var le,ue=1,oe=arguments.length;ue<oe;ue++)for(var ee in le=arguments[ue])Object.prototype.hasOwnProperty.call(le,ee)&&(_e[ee]=le[ee]);return _e},s.apply(this,arguments)},a=function(_e){var le=t.useState(_e.get("currentPage")||0),ue=le[0],oe=le[1],ee=function(se){oe(se)};return i.useIsomorphicLayoutEffect((function(){return _e.subscribe("currentPage",ee),function(){_e.unsubscribe("currentPage",ee)}}),[]),{currentPage:ue}},l=function(_e){var le=t.useState(_e.get("numberOfPages")||0),ue=le[0],oe=le[1],ee=function(se){oe(se)};return t.useEffect((function(){return _e.subscribe("numberOfPages",ee),function(){_e.unsubscribe("numberOfPages",ee)}}),[]),{numberOfPages:ue}},u=function(_e){var le=_e.store,ue=t.useContext(i.LocalizationContext).l10n,oe=t.useState("1"),ee=oe[0],se=oe[1],re=a(le).currentPage,fe=l(le).numberOfPages;t.useEffect((function(){return se("".concat(re+1))}),[re]);var pe=function(ce){var Ee=le.get("jumpToPage");Ee&&Ee(ce)},Z=ue&&ue.pageNavigation?ue.pageNavigation.enterPageNumber:"Enter a page number";return t.createElement("span",{className:"rpv-page-navigation__current-page-input"},t.createElement(i.TextBox,{ariaLabel:Z,testId:"page-navigation__current-page-input",type:"text",value:ee,onChange:se,onKeyDown:function(ce){switch(ce.key){case"ArrowUp":(Ae=re-1)>=0&&(se("".concat(Ae+1)),pe(Ae));break;case"ArrowDown":(Te=re+1)<fe&&(se("".concat(Te+1)),pe(Te));break;case"Enter":Ee=parseInt(ee,10),ee===""||Ee<1||Ee>fe?se("".concat(re+1)):pe(Ee-1)}var Ee,Te,Ae}}))},d=function(_e){var le=_e.children,ue=_e.doc,oe=i.useIsMounted(),ee=t.useState({loading:!0,labels:[]}),se=ee[0],re=ee[1];return t.useEffect((function(){ue.getPageLabels().then((function(fe){oe.current&&re({loading:!1,labels:fe||[]})}))}),[ue.loadingTask.docId]),se.loading?t.createElement(t.Fragment,null):le(se.labels)},h=function(_e){var le=_e.children,ue=_e.store,oe=(function(fe){var pe=t.useState(fe.get("doc")),Z=pe[0],ce=pe[1],Ee=function(Te){ce(Te)};return t.useEffect((function(){return fe.subscribe("doc",Ee),function(){fe.unsubscribe("doc",Ee)}}),[]),Z})(ue),ee=a(ue).currentPage,se=l(ue).numberOfPages,re=le||function(fe){return t.createElement(t.Fragment,null,fe.currentPage+1)};return oe?t.createElement(d,{doc:oe},(function(fe){var pe=fe.length===se&&se>0?fe[ee]:"";return re({currentPage:ee,numberOfPages:se,pageLabel:pe})})):t.createElement(t.Fragment,null)},p=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:`M21.783,21.034H2.332c-0.552,0-1-0.448-1-1c0-0.182,0.05-0.361,0.144-0.517L11.2,3.448
            c0.286-0.472,0.901-0.624,1.373-0.338c0.138,0.084,0.254,0.2,0.338,0.338l9.726,16.069c0.286,0.473,0.134,1.087-0.339,1.373
            C22.143,20.984,21.965,21.034,21.783,21.034z`}))},m={left:0,top:8},g=function(_e){var le=_e.isDisabled,ue=_e.onClick,oe=t.useContext(i.LocalizationContext).l10n,ee=oe&&oe.pageNavigation?oe.pageNavigation.goToFirstPage:"First page";return t.createElement(i.Tooltip,{ariaControlsSuffix:"page-navigation-first",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaLabel:ee,isDisabled:le,testId:"page-navigation__first-button",onClick:ue},t.createElement(p,null)),content:function(){return ee},offset:m})},v=function(_e){var le=_e.children,ue=_e.store;return(le||function(oe){return t.createElement(g,{isDisabled:oe.isDisabled,onClick:oe.onClick})})({isDisabled:a(ue).currentPage===0,onClick:function(){var oe=ue.get("jumpToPage");oe&&oe(0)}})},_=function(_e){var le=_e.isDisabled,ue=_e.onClick,oe=t.useContext(i.LocalizationContext).l10n,ee=oe&&oe.pageNavigation?oe.pageNavigation.goToFirstPage:"First page";return t.createElement(i.MenuItem,{icon:t.createElement(p,null),isDisabled:le,testId:"page-navigation__first-menu",onClick:ue},ee)},b={left:0,top:8},E=function(_e){var le=_e.isDisabled,ue=_e.onClick,oe=t.useContext(i.LocalizationContext).l10n,ee=oe&&oe.pageNavigation?oe.pageNavigation.goToLastPage:"Last page";return t.createElement(i.Tooltip,{ariaControlsSuffix:"page-navigation-last",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaLabel:ee,isDisabled:le,testId:"page-navigation__last-button",onClick:ue},t.createElement(n,null)),content:function(){return ee},offset:b})},A=function(_e){var le=_e.children,ue=_e.store,oe=a(ue).currentPage,ee=l(ue).numberOfPages;return(le||function(se){return t.createElement(E,{isDisabled:se.isDisabled,onClick:se.onClick})})({isDisabled:oe+1>=ee,onClick:function(){var se=ue.get("jumpToPage");se&&se(ee-1)}})},z=function(_e){var le=_e.isDisabled,ue=_e.onClick,oe=t.useContext(i.LocalizationContext).l10n,ee=oe&&oe.pageNavigation?oe.pageNavigation.goToLastPage:"Last page";return t.createElement(i.MenuItem,{icon:t.createElement(n,null),isDisabled:le,testId:"page-navigation__last-menu",onClick:ue},ee)},D={left:0,top:8},P=function(_e){var le=_e.isDisabled,ue=_e.onClick,oe=t.useContext(i.LocalizationContext).l10n,ee=oe&&oe.pageNavigation?oe.pageNavigation.goToNextPage:"Next page";return t.createElement(i.Tooltip,{ariaControlsSuffix:"page-navigation-next",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaLabel:ee,isDisabled:le,testId:"page-navigation__next-button",onClick:ue},t.createElement(r,null)),content:function(){return ee},offset:D})},G=function(_e){var le=_e.children,ue=_e.store;return(le||function(oe){return t.createElement(P,{onClick:oe.onClick,isDisabled:oe.isDisabled})})({isDisabled:a(ue).currentPage+1>=l(ue).numberOfPages,onClick:function(){var oe=ue.get("jumpToNextPage");oe&&oe()}})},R=function(_e){var le=_e.isDisabled,ue=_e.onClick,oe=t.useContext(i.LocalizationContext).l10n,ee=oe&&oe.pageNavigation?oe.pageNavigation.goToNextPage:"Next page";return t.createElement(i.MenuItem,{icon:t.createElement(r,null),isDisabled:le,testId:"page-navigation__next-menu",onClick:ue},ee)},I=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:`M23.535,18.373L12.409,5.8c-0.183-0.207-0.499-0.226-0.706-0.043C11.688,5.77,11.674,5.785,11.66,5.8
            L0.535,18.373`}))},w={left:0,top:8},H=function(_e){var le=_e.isDisabled,ue=_e.onClick,oe=t.useContext(i.LocalizationContext).l10n,ee=oe&&oe.pageNavigation?oe.pageNavigation.goToPreviousPage:"Previous page";return t.createElement(i.Tooltip,{ariaControlsSuffix:"page-navigation-previous",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaLabel:ee,isDisabled:le,testId:"page-navigation__previous-button",onClick:ue},t.createElement(I,null)),content:function(){return ee},offset:w})},V=function(_e){var le=_e.store;return(_e.children||function(ue){return t.createElement(H,{isDisabled:ue.isDisabled,onClick:ue.onClick})})({isDisabled:a(le).currentPage<=0,onClick:function(){var ue=le.get("jumpToPreviousPage");ue&&ue()}})},te=function(_e){var le=_e.isDisabled,ue=_e.onClick,oe=t.useContext(i.LocalizationContext).l10n,ee=oe&&oe.pageNavigation?oe.pageNavigation.goToPreviousPage:"Previous page";return t.createElement(i.MenuItem,{icon:t.createElement(I,null),isDisabled:le,testId:"page-navigation__previous-menu",onClick:ue},ee)},ae=function(_e){var le=_e.children,ue=_e.store,oe=l(ue).numberOfPages;return le?le({numberOfPages:oe}):t.createElement(t.Fragment,null,oe)},be=function(_e){var le=_e.containerRef,ue=_e.numPages,oe=_e.store,ee=a(oe).currentPage,se=t.useRef(ee);se.current=ee;var re=t.useRef(!1),fe=function(){re.current=!0},pe=function(){re.current=!1},Z=function(ce){var Ee=le.current,Te=re.current||document.activeElement&&Ee.contains(document.activeElement);if(Ee&&Te){var Ae,Pe,Me=ce.altKey&&ce.key==="ArrowDown"||!ce.shiftKey&&!ce.altKey&&ce.key==="PageDown",We=ce.altKey&&ce.key==="ArrowUp"||!ce.shiftKey&&!ce.altKey&&ce.key==="PageUp";if(Me)return ce.preventDefault(),Ae=oe.get("jumpToPage"),Pe=se.current+1,void(Ae&&Pe<ue&&Ae(Pe));if(We)return ce.preventDefault(),void(function(){var qe=oe.get("jumpToPage"),Je=se.current-1;qe&&Je>=0&&qe(Je)})();if(i.isMac()?ce.metaKey&&!ce.ctrlKey:ce.altKey)switch(ce.key){case"ArrowLeft":ce.preventDefault(),(function(){var qe=oe.get("jumpToPreviousDestination");qe&&qe()})();break;case"ArrowRight":ce.preventDefault(),(function(){var qe=oe.get("jumpToNextDestination");qe&&qe()})()}}};return t.useEffect((function(){var ce=le.current;if(ce)return document.addEventListener("keydown",Z),ce.addEventListener("mouseenter",fe),ce.addEventListener("mouseleave",pe),function(){document.removeEventListener("keydown",Z),ce.removeEventListener("mouseenter",fe),ce.removeEventListener("mouseleave",pe)}}),[le.current]),t.createElement(t.Fragment,null)};return pageNavigation_min.DownArrowIcon=n,pageNavigation_min.NextIcon=r,pageNavigation_min.PreviousIcon=I,pageNavigation_min.UpArrowIcon=p,pageNavigation_min.pageNavigationPlugin=function(_e){var le=t.useMemo((function(){return Object.assign({},{enableShortcuts:!0},_e)}),[]),ue=t.useMemo((function(){return i.createStore()}),[]),oe=function(fe){return t.createElement(v,s({},fe,{store:ue}))},ee=function(fe){return t.createElement(A,s({},fe,{store:ue}))},se=function(fe){return t.createElement(G,s({},fe,{store:ue}))},re=function(fe){return t.createElement(V,s({},fe,{store:ue}))};return{install:function(fe){ue.update("jumpToDestination",fe.jumpToDestination),ue.update("jumpToNextDestination",fe.jumpToNextDestination),ue.update("jumpToNextPage",fe.jumpToNextPage),ue.update("jumpToPage",fe.jumpToPage),ue.update("jumpToPreviousDestination",fe.jumpToPreviousDestination),ue.update("jumpToPreviousPage",fe.jumpToPreviousPage)},renderViewer:function(fe){var pe=fe.slot;if(!le.enableShortcuts)return pe;var Z={children:t.createElement(t.Fragment,null,t.createElement(be,{containerRef:fe.containerRef,numPages:fe.doc.numPages,store:ue}),pe.children)};return s(s({},pe),Z)},onDocumentLoad:function(fe){ue.update("doc",fe.doc),ue.update("numberOfPages",fe.doc.numPages)},onViewerStateChange:function(fe){return ue.update("currentPage",fe.pageIndex),fe},jumpToNextPage:function(){var fe=ue.get("jumpToNextPage");fe&&fe()},jumpToPage:function(fe){var pe=ue.get("jumpToPage");pe&&pe(fe)},jumpToPreviousPage:function(){var fe=ue.get("jumpToPreviousPage");fe&&fe()},CurrentPageInput:function(){return t.createElement(u,{store:ue})},CurrentPageLabel:function(fe){return t.createElement(h,s({},fe,{store:ue}))},GoToFirstPage:oe,GoToFirstPageButton:function(){return t.createElement(oe,null,(function(fe){return t.createElement(g,s({},fe))}))},GoToFirstPageMenuItem:function(fe){return t.createElement(oe,null,(function(pe){return t.createElement(_,{isDisabled:pe.isDisabled,onClick:function(){pe.onClick(),fe.onClick()}})}))},GoToLastPage:ee,GoToLastPageButton:function(){return t.createElement(ee,null,(function(fe){return t.createElement(E,s({},fe))}))},GoToLastPageMenuItem:function(fe){return t.createElement(ee,null,(function(pe){return t.createElement(z,{isDisabled:pe.isDisabled,onClick:function(){pe.onClick(),fe.onClick()}})}))},GoToNextPage:se,GoToNextPageButton:function(){return t.createElement(se,null,(function(fe){return t.createElement(P,s({},fe))}))},GoToNextPageMenuItem:function(fe){return t.createElement(se,null,(function(pe){return t.createElement(R,{isDisabled:pe.isDisabled,onClick:function(){pe.onClick(),fe.onClick()}})}))},GoToPreviousPage:re,GoToPreviousPageButton:function(){return t.createElement(re,null,(function(fe){return t.createElement(H,s({},fe))}))},GoToPreviousPageMenuItem:function(fe){return t.createElement(re,null,(function(pe){return t.createElement(te,{isDisabled:pe.isDisabled,onClick:function(){pe.onClick(),fe.onClick()}})}))},NumberOfPages:function(fe){return t.createElement(ae,s({},fe,{store:ue}))}}},pageNavigation_min}var hasRequiredLib$9;function requireLib$9(){if(hasRequiredLib$9)return lib$7.exports;hasRequiredLib$9=1;return lib$7.exports=requirePageNavigation_min(),lib$7.exports}var lib$6={exports:{}},print_min={},hasRequiredPrint_min;function requirePrint_min(){if(hasRequiredPrint_min)return print_min;hasRequiredPrint_min=1;var i={},e=requireLib$h(),t=requireReact(),n=requireReactDom();function r(D){var P=Object.create(null);return D&&Object.keys(D).forEach((function(G){if(G!=="default"){var R=Object.getOwnPropertyDescriptor(D,G);Object.defineProperty(P,G,R.get?R:{enumerable:!0,get:function(){return D[G]}})}})),P.default=D,Object.freeze(P)}var s,a=r(t),l=function(){return a.createElement(e.Icon,{size:16},a.createElement("path",{d:`M7.5,19.499h9 M7.5,16.499h9 M5.5,16.5h-3c-1.103-0.003-1.997-0.897-2-2v-6c0.003-1.103,0.897-1.997,2-2h19
            c1.103,0.003,1.997,0.897,2,2v6c-0.003,1.103-0.897,1.997-2,2h-3
            M5.5,4.5v-4h9.586c0.265,0,0.52,0.105,0.707,0.293l2.414,2.414
            C18.395,3.394,18.5,3.649,18.5,3.914V4.5
            M18.5,22.5c0,0.552-0.448,1-1,1h-11c-0.552,0-1-0.448-1-1v-9h13V22.5z
            M3.5,8.499
            c0.552,0,1,0.448,1,1s-0.448,1-1,1s-1-0.448-1-1S2.948,8.499,3.5,8.499z
            M14.5,0.499v4h4`}))},u=function(){return u=Object.assign||function(D){for(var P,G=1,R=arguments.length;G<R;G++)for(var I in P=arguments[G])Object.prototype.hasOwnProperty.call(P,I)&&(D[I]=P[I]);return D},u.apply(this,arguments)},d={left:0,top:8},h=function(D){var P=D.enableShortcuts,G=D.onClick,R=a.useContext(e.LocalizationContext).l10n,I=R&&R.print?R.print.print:"Print",w=P?e.isMac()?"Meta+P":"Ctrl+P":"";return a.createElement(e.Tooltip,{ariaControlsSuffix:"print",position:e.Position.BottomCenter,target:a.createElement(e.MinimalButton,{ariaKeyShortcuts:w,ariaLabel:I,testId:"print__button",onClick:G},a.createElement(l,null)),content:function(){return I},offset:d})};(function(D){D.CheckingPermission="CheckingPermission",D.Inactive="Inactive",D.Preparing="Preparing",D.Cancelled="Cancelled",D.Ready="Ready"})(s||(s={}));var p=function(D){var P=D.children,G=D.enableShortcuts,R=D.store;return(P||h)({enableShortcuts:G,onClick:function(){R.update("printStatus",s.CheckingPermission)}})},m=function(D){var P=D.doc,G=D.store,R=a.useContext(e.LocalizationContext).l10n,I=a.useState(!0),w=I[0],H=I[1];return a.useEffect((function(){P.getPermissions().then((function(V){V===null||V.includes(4)||V.includes(2048)?G.update("printStatus",s.Preparing):H(!1)}))}),[]),w?a.createElement(a.Fragment,null):a.createElement(e.Modal,{ariaControlsSuffix:"print-permission",closeOnClickOutside:!1,closeOnEscape:!1,content:function(V){return a.createElement(a.Fragment,null,a.createElement("div",{className:"rpv-print__permission-body"},R&&R.print?R.print.disallowPrint:"The document does not allow to print"),a.createElement("div",{className:"rpv-print__permission-footer"},a.createElement(e.Button,{onClick:function(){V(),G.update("printStatus",s.Cancelled)}},R&&R.print?R.print.close:"Close")))},isOpened:!0})},g=function(D){var P=D.numLoadedPages,G=D.numPages,R=D.onCancel,I=a.useContext(e.LocalizationContext).l10n,w=a.useContext(e.ThemeContext).direction===e.TextDirection.RightToLeft,H=Math.floor(100*P/G);return a.createElement("div",{className:"rpv-print__progress"},a.createElement("div",{className:e.classNames({"rpv-print__progress-body":!0,"rpv-print__progress-body--rtl":w})},a.createElement("div",{className:"rpv-print__progress-message"},I&&I.print?I.print.preparingDocument:"Preparing document ..."),a.createElement("div",{className:"rpv-print__progress-bar"},a.createElement(e.ProgressBar,{progress:H})),a.createElement(e.Button,{onClick:R},I&&I.print?I.print.cancel:"Cancel")))},v=function(D){var P=D.canvas,G=D.page,R=D.pageHeight,I=D.pageIndex,w=D.pageWidth,H=D.rotation,V=D.onLoad,te=e.useIsMounted(),ae=a.useRef(),be=a.useState(""),_e=be[0],le=be[1],ue=a.useMemo((function(){return typeof process<"u"&&i.JEST_WORKER_ID!==void 0}),[]);return a.useEffect((function(){var oe=ae.current;oe&&oe.cancel();var ee=150/72;P.height=Math.floor(R*ee),P.width=Math.floor(w*ee);var se=P.getContext("2d");se.save(),se.fillStyle="rgb(255, 255, 255)",se.fillRect(0,0,P.width,P.height),se.restore();var re=G.getViewport({rotation:H,scale:1});ae.current=G.render({canvasContext:se,intent:"print",transform:[ee,0,0,ee,0,0],viewport:re}),ae.current.promise.then((function(){"toBlob"in P&&"createObjectURL"in URL?P.toBlob((function(fe){te.current&&le(URL.createObjectURL(fe)),ue&&V()})):(te.current&&le(P.toDataURL()),ue&&V())}),(function(){}))}),[]),_e&&a.createElement("div",{className:"rpv-print__page"},a.createElement("img",{"data-testid":"print__thumbnail-".concat(I),src:_e,onLoad:function(){ue||V()}}))},_=function(D){var P=D.canvas,G=D.doc,R=D.pageIndex,I=D.pageRotation,w=D.pageSize,H=D.rotation,V=D.shouldRender,te=D.onLoad,ae=e.useIsMounted(),be=a.useState(null),_e=be[0],le=be[1],ue=Math.abs(H+I)%180==0;a.useEffect((function(){V&&e.getPage(G,R).then((function(ee){ae.current&&le(ee)}))}),[V]);var oe=(w.rotation+H+I)%360;return _e&&a.createElement(v,{canvas:P,page:_e,pageHeight:ue?w.pageHeight:w.pageWidth,pageIndex:R,pageWidth:ue?w.pageWidth:w.pageHeight,rotation:oe,onLoad:te})},b=function(D){var P=D.doc,G=D.numLoadedPages,R=D.pagesRotation,I=D.pageSizes,w=D.printPages,H=D.printStatus,V=D.rotation,te=D.onCancel,ae=D.onLoad,be=a.useMemo((function(){return document.createElement("canvas")}),[]),_e=a.useMemo((function(){var oe=document.querySelector(".rpv-print__zone");if(oe)return oe;var ee=document.createElement("div");return ee.classList.add("rpv-print__zone"),ee.setAttribute("data-testid","print__zone"),document.body.appendChild(ee),ee}),[]);a.useEffect((function(){H===s.Ready&&(document.documentElement.classList.add("rpv-print__html-printing"),document.body.classList.add("rpv-print__body-printing"),window.print());var oe=function(){if(H===s.Ready){document.documentElement.classList.remove("rpv-print__html-printing"),document.body.classList.remove("rpv-print__body-printing");var ee=document.querySelectorAll(".rpv-print__zone");ee&&ee.forEach((function(se){se.parentElement.removeChild(se)})),be.height=0,be.width=0,document.removeEventListener("mousemove",oe),te()}};return document.addEventListener("mousemove",oe),function(){return document.removeEventListener("mousemove",oe)}}),[H]);var le=I[0].pageHeight,ue=I[0].pageWidth;return n.createPortal(a.createElement(a.Fragment,null,w.map((function(oe,ee){return a.createElement(_,{key:oe,canvas:be,doc:P,pageIndex:oe,pageRotation:R.has(oe)?R.get(oe):0,pageSize:I[oe],rotation:V,shouldRender:ee===G,onLoad:ae})})),a.createElement("style",{dangerouslySetInnerHTML:{__html:"@page { size: ".concat(ue,"pt ").concat(le,"pt }")}})),_e)},E=function(D){var P=D.doc,G=D.pagesRotation,R=D.pageSizes,I=D.renderProgressBar,w=D.rotation,H=D.setPages,V=D.store,te=a.useState(s.Inactive),ae=te[0],be=te[1],_e=a.useState(0),le=_e[0],ue=_e[1],oe=a.useMemo((function(){var fe=P.numPages;return H(P).filter((function(pe){return pe>=0&&pe<fe}))}),[P,H]),ee=oe.length,se=function(){ue(0),be(s.Inactive)},re=function(fe){return be(fe)};return a.useEffect((function(){return V.subscribe("printStatus",re),function(){V.unsubscribe("printStatus",re)}}),[]),a.createElement(a.Fragment,null,ae===s.CheckingPermission&&a.createElement(m,{doc:P,store:V}),ae===s.Preparing&&(I?I(le,ee,se):a.createElement(g,{numLoadedPages:le,numPages:ee,onCancel:se})),(ae===s.Preparing||ae===s.Ready)&&le<=ee&&a.createElement(b,{doc:P,numLoadedPages:le,pagesRotation:G,pageSizes:R,printPages:oe,printStatus:ae,rotation:w,onCancel:se,onLoad:function(){var fe=le+1;fe<=ee&&(ue(fe),fe===ee&&be(s.Ready))}}))},A=function(D){var P=D.onClick,G=a.useContext(e.LocalizationContext).l10n,R=G&&G.print?G.print.print:"Print";return a.createElement(e.MenuItem,{icon:a.createElement(l,null),testId:"print__menu",onClick:P},R)},z=function(D){var P=D.containerRef,G=D.store,R=function(I){if(!I.shiftKey&&!I.altKey&&I.key==="p"&&(e.isMac()?I.metaKey:I.ctrlKey)){var w=P.current;w&&document.activeElement&&w.contains(document.activeElement)&&(I.preventDefault(),G.update("printStatus",s.Preparing))}};return a.useEffect((function(){if(P.current)return document.addEventListener("keydown",R),function(){document.removeEventListener("keydown",R)}}),[P.current]),a.createElement(a.Fragment,null)};return print_min.PrintIcon=l,print_min.getAllPagesNumbers=function(D){return Array(D.numPages).fill(0).map((function(P,G){return G}))},print_min.getCustomPagesNumbers=function(D){return function(P){var G,R=[];return D.replace(/\s+/g,"").split(",").forEach((function(I){var w,H,V=I.split("-").map((function(te){return parseInt(te,10)})).filter((function(te){return Number.isInteger(te)}));V.length===1?R.push(V[0]-1):V.length===2&&R.push.apply(R,(w=V[0]-1,H=V[1]-1,Array(H-w+1).fill(0).map((function(te,ae){return w+ae}))))})),(G=R,G.filter((function(I){return G.indexOf(I)===G.lastIndexOf(I)}))).filter((function(I){return I>=0&&I<P.numPages}))}},print_min.getEvenPagesNumbers=function(D){return Array(D.numPages).fill(0).map((function(P,G){return G})).filter((function(P){return(P+1)%2==0}))},print_min.getOddPagesNumbers=function(D){return Array(D.numPages).fill(0).map((function(P,G){return G})).filter((function(P){return(P+1)%2==1}))},print_min.printPlugin=function(D){var P=a.useMemo((function(){return Object.assign({},{enableShortcuts:!0,setPages:function(I){return Array(I.numPages).fill(0).map((function(w,H){return H}))}},D)}),[]),G=a.useMemo((function(){return e.createStore({printStatus:s.Inactive})}),[]),R=function(I){return a.createElement(p,u({enableShortcuts:P.enableShortcuts},I,{store:G}))};return{print:function(){G.update("printStatus",s.CheckingPermission)},renderViewer:function(I){var w=I.slot,H={children:a.createElement(a.Fragment,null,P.enableShortcuts&&a.createElement(z,{containerRef:I.containerRef,store:G}),a.createElement(E,{doc:I.doc,pagesRotation:I.pagesRotation,pageSizes:I.pageSizes,renderProgressBar:D?.renderProgressBar,rotation:I.rotation,setPages:P.setPages,store:G}),w.children)};return u(u({},w),H)},Print:R,PrintButton:function(){return a.createElement(R,null,(function(I){return a.createElement(h,u({},I))}))},PrintMenuItem:function(I){return a.createElement(R,null,(function(w){return a.createElement(A,{onClick:function(){w.onClick(),I.onClick()}})}))},setPages:function(I){P.setPages=I}}},print_min}var hasRequiredLib$8;function requireLib$8(){if(hasRequiredLib$8)return lib$6.exports;hasRequiredLib$8=1;return lib$6.exports=requirePrint_min(),lib$6.exports}var lib$5={exports:{}},properties_min={},hasRequiredProperties_min;function requireProperties_min(){if(hasRequiredProperties_min)return properties_min;hasRequiredProperties_min=1;var i=requireLib$h();function e(v){var _=Object.create(null);return v&&Object.keys(v).forEach((function(b){if(b!=="default"){var E=Object.getOwnPropertyDescriptor(v,b);Object.defineProperty(_,b,E.get?E:{enumerable:!0,get:function(){return v[b]}})}})),_.default=v,Object.freeze(_)}var t=e(requireReact()),n=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:`M12,1.001c6.075,0,11,4.925,11,11s-4.925,11-11,11s-11-4.925-11-11S5.925,1.001,12,1.001z
            M14.5,17.005H13
            c-0.552,0-1-0.448-1-1v-6.5c0-0.276-0.224-0.5-0.5-0.5H10
            M11.745,6.504L11.745,6.504
            M11.745,6.5c-0.138,0-0.25,0.112-0.25,0.25
            S11.607,7,11.745,7s0.25-0.112,0.25-0.25S11.883,6.5,11.745,6.5`}))},r=function(){return r=Object.assign||function(v){for(var _,b=1,E=arguments.length;b<E;b++)for(var A in _=arguments[b])Object.prototype.hasOwnProperty.call(_,A)&&(v[A]=_[A]);return v},r.apply(this,arguments)},s=function(v){var _=v.doc,b=v.render,E=t.useState(),A=E[0],z=E[1];return t.useEffect((function(){_.getMetadata().then((function(D){return Promise.resolve(D)})).then((function(D){return _.getDownloadInfo().then((function(P){return Promise.resolve({fileName:D.contentDispositionFilename||"",info:D.info,length:P.length})}))})).then((function(D){z(D)}))}),[]),A?b(A):t.createElement("div",{className:"rpv-properties__loader"},t.createElement(i.Spinner,null))},a=function(v){var _=v.label,b=v.value,E=t.useContext(i.ThemeContext).direction===i.TextDirection.RightToLeft;return t.createElement("dl",{className:i.classNames({"rpv-properties__item":!0,"rpv-properties__item--rtl":E})},t.createElement("dt",{className:"rpv-properties__item-label"},_,":"),t.createElement("dd",{className:"rpv-properties__item-value"},b||"-"))},l=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"),u=function(v,_,b,E){var A=parseInt(v,10);return A>=_&&A<=b?A:E},d=function(v){var _=v.doc,b=v.fileName,E=v.onToggle,A=t.useContext(i.LocalizationContext).l10n,z=function(D){var P=(function(G){var R=l.exec(G);if(!R)return null;var I=parseInt(R[1],10),w=u(R[2],1,12,1)-1,H=u(R[3],1,31,1),V=u(R[4],0,23,0),te=u(R[5],0,59,0),ae=u(R[6],0,59,0),be=R[7]||"Z",_e=u(R[8],0,23,0),le=u(R[9],0,59,0);switch(be){case"-":V+=_e,te+=le;break;case"+":V-=_e,te-=le}return new Date(Date.UTC(I,w,H,V,te,ae))})(D);return P?"".concat(P.toLocaleDateString(),", ").concat(P.toLocaleTimeString()):""};return t.createElement("div",{className:"rpv-properties__modal"},t.createElement(s,{doc:_,render:function(D){return t.createElement(t.Fragment,null,t.createElement("div",{className:"rpv-properties__modal-section"},t.createElement(a,{label:A&&A.properties?A.properties.fileName:"File name",value:D.fileName||(R=b,I=R.split("/").pop(),I?I.split("#")[0].split("?")[0]:R)}),t.createElement(a,{label:A&&A.properties?A.properties.fileSize:"File size",value:(P=D.length,G=Math.floor(Math.log(P)/Math.log(1024)),"".concat((P/Math.pow(1024,G)).toFixed(2)," ").concat(["B","kB","MB","GB","TB"][G]))})),t.createElement(i.Separator,null),t.createElement("div",{className:"rpv-properties__modal-section"},t.createElement(a,{label:A&&A.properties?A.properties.title:"Title",value:D.info.Title}),t.createElement(a,{label:A&&A.properties?A.properties.author:"Author",value:D.info.Author}),t.createElement(a,{label:A&&A.properties?A.properties.subject:"Subject",value:D.info.Subject}),t.createElement(a,{label:A&&A.properties?A.properties.keywords:"Keywords",value:D.info.Keywords}),t.createElement(a,{label:A&&A.properties?A.properties.creator:"Creator",value:D.info.Creator}),t.createElement(a,{label:A&&A.properties?A.properties.creationDate:"Creation date",value:z(D.info.CreationDate)}),t.createElement(a,{label:A&&A.properties?A.properties.modificationDate:"Modification date",value:z(D.info.ModDate)})),t.createElement(i.Separator,null),t.createElement("div",{className:"rpv-properties__modal-section"},t.createElement(a,{label:A&&A.properties?A.properties.pdfProducer:"PDF producer",value:D.info.Producer}),t.createElement(a,{label:A&&A.properties?A.properties.pdfVersion:"PDF version",value:D.info.PDFFormatVersion}),t.createElement(a,{label:A&&A.properties?A.properties.pageCount:"Page count",value:"".concat(_.numPages)})));var P,G,R,I}}),t.createElement("div",{className:"rpv-properties__modal-footer"},t.createElement(i.Button,{onClick:E},A&&A.properties?A.properties.close:"Close")))},h={left:0,top:8},p=function(v){var _=v.onClick,b=t.useContext(i.LocalizationContext).l10n,E=b&&b.properties?b.properties.showProperties:"Show properties";return t.createElement(i.Tooltip,{ariaControlsSuffix:"properties",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaLabel:E,testId:"properties__button",onClick:_},t.createElement(n,null)),content:function(){return E},offset:h})},m=function(v){var _=v.children,b=v.store,E=(function(D){var P=t.useState(D.get("doc")),G=P[0],R=P[1],I=function(w){R(w)};return t.useEffect((function(){return D.subscribe("doc",I),function(){D.unsubscribe("doc",I)}}),[]),{currentDoc:G}})(b).currentDoc,A=b.get("fileName")||"",z=_||function(D){return t.createElement(p,r({},D))};return E?t.createElement(i.Modal,{ariaControlsSuffix:"properties",target:function(D){return z({onClick:D})},content:function(D){return t.createElement(d,{doc:E,fileName:A,onToggle:D})},closeOnClickOutside:!0,closeOnEscape:!0}):t.createElement(t.Fragment,null)},g=function(v){var _=v.onClick,b=t.useContext(i.LocalizationContext).l10n,E=b&&b.properties?b.properties.showProperties:"Show properties";return t.createElement(i.MenuItem,{icon:t.createElement(n,null),testId:"properties__menu",onClick:_},E)};return properties_min.InfoIcon=n,properties_min.propertiesPlugin=function(){var v=t.useMemo((function(){return i.createStore({fileName:""})}),[]),_=function(b){return t.createElement(m,r({},b,{store:v}))};return{onDocumentLoad:function(b){v.update("doc",b.doc)},onViewerStateChange:function(b){return v.update("fileName",b.file.name),b},ShowProperties:_,ShowPropertiesButton:function(){return t.createElement(m,{store:v})},ShowPropertiesMenuItem:function(b){return t.createElement(_,null,(function(E){return t.createElement(g,r({},E))}))}}},properties_min}var hasRequiredLib$7;function requireLib$7(){if(hasRequiredLib$7)return lib$5.exports;hasRequiredLib$7=1;return lib$5.exports=requireProperties_min(),lib$5.exports}var lib$4={exports:{}},rotate_min={},hasRequiredRotate_min;function requireRotate_min(){if(hasRequiredRotate_min)return rotate_min;hasRequiredRotate_min=1;var i=requireLib$h();function e(p){var m=Object.create(null);return p&&Object.keys(p).forEach((function(g){if(g!=="default"){var v=Object.getOwnPropertyDescriptor(p,g);Object.defineProperty(m,g,v.get?v:{enumerable:!0,get:function(){return p[g]}})}})),m.default=p,Object.freeze(m)}var t=e(requireReact()),n=function(){return t.createElement(i.Icon,{ignoreDirection:!0,size:16},t.createElement("path",{d:`M3.434,10.537c0.141-0.438,0.316-0.864,0.523-1.274
            M3.069,14.425C3.023,14.053,3,13.679,3,13.305 c0-0.291,0.014-0.579,0.041-0.863
            M4.389,18.111c-0.341-0.539-0.623-1.112-0.843-1.711
            M7.163,20.9 c-0.543-0.345-1.048-0.747-1.506-1.2
            M10.98,22.248c-0.65-0.074-1.29-0.218-1.909-0.431
            M10,4.25h2 c4.987,0.015,9.017,4.069,9.003,9.055c-0.013,4.581-3.456,8.426-8.008,8.945
            M13.5,1.75L10,4.25l3.5,2.5`}))},r=function(){return t.createElement(i.Icon,{ignoreDirection:!0,size:16},t.createElement("path",{d:`M20.566,10.537c-0.141-0.438-0.316-0.864-0.523-1.274
            M20.931,14.425C20.977,14.053,21,13.679,21,13.305 c0-0.291-0.014-0.579-0.041-0.863
            M19.611,18.111c0.341-0.539,0.624-1.114,0.843-1.713
            M16.837,20.9 c0.543-0.345,1.048-0.747,1.506-1.2
            M13.02,22.248c0.65-0.074,1.29-0.218,1.909-0.431
            M14,4.25h-2 c-4.987,0.015-9.017,4.069-9.003,9.055c0.013,4.581,3.456,8.426,8.008,8.945
            M10.5,1.75l3.5,2.5l-3.5,2.5`}))},s=function(){return s=Object.assign||function(p){for(var m,g=1,v=arguments.length;g<v;g++)for(var _ in m=arguments[g])Object.prototype.hasOwnProperty.call(m,_)&&(p[_]=m[_]);return p},s.apply(this,arguments)},a={left:0,top:8},l=function(p){var m=p.direction,g=p.onClick,v=t.useContext(i.LocalizationContext).l10n,_=v&&v.rotate?v.rotate.rotateBackward:"Rotate counterclockwise",b=v&&v.rotate?v.rotate.rotateForward:"Rotate clockwise",E=m===i.RotateDirection.Backward?_:b,A=m===i.RotateDirection.Backward?t.createElement(n,null):t.createElement(r,null);return t.createElement(i.Tooltip,{ariaControlsSuffix:"rotate",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaLabel:E,testId:m===i.RotateDirection.Backward?"rotate__backward-button":"rotate__forward-button",onClick:g},A),content:function(){return E},offset:a})},u=function(p){var m=p.children,g=p.direction,v=p.store;return(m||function(_){return t.createElement(l,{direction:_.direction,onClick:_.onClick})})({direction:g,onClick:function(){var _=v.get("rotate");_&&_(g)}})},d=function(p){var m=p.direction,g=p.onClick,v=t.useContext(i.LocalizationContext).l10n,_=v&&v.rotate?v.rotate.rotateBackward:"Rotate counterclockwise",b=v&&v.rotate?v.rotate.rotateForward:"Rotate clockwise",E=m===i.RotateDirection.Backward?_:b,A=m===i.RotateDirection.Backward?t.createElement(n,null):t.createElement(r,null);return t.createElement(i.MenuItem,{icon:A,testId:m===i.RotateDirection.Backward?"rotate__backward-menu":"rotate__forward-menu",onClick:g},E)},h=function(p){var m=p.children,g=p.store;return m({onRotatePage:function(v,_){var b=g.get("rotatePage");b&&b(v,_)}})};return rotate_min.RotateBackwardIcon=n,rotate_min.RotateForwardIcon=r,rotate_min.rotatePlugin=function(){var p=t.useMemo((function(){return i.createStore()}),[]),m=function(g){return t.createElement(u,s({},g,{store:p}))};return{install:function(g){p.update("rotate",g.rotate),p.update("rotatePage",g.rotatePage)},Rotate:m,RotateBackwardButton:function(){return t.createElement(m,{direction:i.RotateDirection.Backward},(function(g){return t.createElement(l,s({},g))}))},RotateBackwardMenuItem:function(g){return t.createElement(m,{direction:i.RotateDirection.Backward},(function(v){return t.createElement(d,{direction:v.direction,onClick:function(){v.onClick(),g.onClick()}})}))},RotateForwardButton:function(){return t.createElement(m,{direction:i.RotateDirection.Forward},(function(g){return t.createElement(l,s({},g))}))},RotateForwardMenuItem:function(g){return t.createElement(m,{direction:i.RotateDirection.Forward},(function(v){return t.createElement(d,{direction:v.direction,onClick:function(){v.onClick(),g.onClick()}})}))},RotatePage:function(g){return t.createElement(h,s({},g,{store:p}))}}},rotate_min}var hasRequiredLib$6;function requireLib$6(){if(hasRequiredLib$6)return lib$4.exports;hasRequiredLib$6=1;return lib$4.exports=requireRotate_min(),lib$4.exports}var lib$3={exports:{}},scrollMode_min={},hasRequiredScrollMode_min;function requireScrollMode_min(){if(hasRequiredScrollMode_min)return scrollMode_min;hasRequiredScrollMode_min=1;var i=requireLib$h();function e(I){var w=Object.create(null);return I&&Object.keys(I).forEach((function(H){if(H!=="default"){var V=Object.getOwnPropertyDescriptor(I,H);Object.defineProperty(w,H,V.get?V:{enumerable:!0,get:function(){return I[H]}})}})),w.default=I,Object.freeze(w)}var t=e(requireReact()),n=function(){return t.createElement(i.Icon,{size:16},t.createElement("rect",{x:"0.5",y:"0.497",width:"22",height:"22",rx:"1",ry:"1"}),t.createElement("line",{x1:"0.5",y1:"6.497",x2:"22.5",y2:"6.497"}),t.createElement("line",{x1:"11.5",y1:"6.497",x2:"11.5",y2:"22.497"}))},r=function(){return t.createElement(i.Icon,{size:16},t.createElement("rect",{x:"0.5",y:"0.497",width:"22",height:"22",rx:"1",ry:"1"}),t.createElement("line",{x1:"11.5",y1:"0.497",x2:"11.5",y2:"22.497"}))},s=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:`M6.5,21.5c0,0.552-0.448,1-1,1h-4c-0.552,0-1-0.448-1-1v-20c0-0.552,0.448-1,1-1h4c0.552,0,1,0.448,1,1V21.5z
            M14.5,21.5c0,0.552-0.448,1-1,1h-4c-0.552,0-1-0.448-1-1v-20c0-0.552,0.448-1,1-1h4c0.552,0,1,0.448,1,1V21.5z
            M22.5,21.5 c0,0.552-0.448,1-1,1h-4c-0.552,0-1-0.448-1-1v-20c0-0.552,0.448-1,1-1h4c0.552,0,1,0.448,1,1V21.5z`}))},a=function(){return t.createElement(i.Icon,{size:16},t.createElement("rect",{x:"0.5",y:"0.497",width:"22",height:"22",rx:"1",ry:"1"}))},l=function(){return l=Object.assign||function(I){for(var w,H=1,V=arguments.length;H<V;H++)for(var te in w=arguments[H])Object.prototype.hasOwnProperty.call(w,te)&&(I[te]=w[te]);return I},l.apply(this,arguments)},u=function(I,w){I.get("switchScrollMode")(w);var H=I.get("viewMode");w!==i.ScrollMode.Horizontal&&w!==i.ScrollMode.Wrapped||H===i.ViewMode.SinglePage||I.get("switchViewMode")(i.ViewMode.SinglePage)},d=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:`M23.5,5.5c0,0.552-0.448,1-1,1h-21c-0.552,0-1-0.448-1-1v-3c0-0.552,0.448-1,1-1h21c0.552,0,1,0.448,1,1V5.5z
            M23.5,13.5c0,0.552-0.448,1-1,1h-21c-0.552,0-1-0.448-1-1v-3c0-0.552,0.448-1,1-1h21c0.552,0,1,0.448,1,1V13.5z
            M23.5,21.5 c0,0.552-0.448,1-1,1h-21c-0.552,0-1-0.448-1-1v-3c0-0.552,0.448-1,1-1h21c0.552,0,1,0.448,1,1V21.5z`}))},h=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:`M10.5,9.5c0,0.552-0.448,1-1,1h-8c-0.552,0-1-0.448-1-1v-8c0-0.552,0.448-1,1-1h8c0.552,0,1,0.448,1,1V9.5z
            M23.5,9.5c0,0.552-0.448,1-1,1h-8c-0.552,0-1-0.448-1-1v-8c0-0.552,0.448-1,1-1h8c0.552,0,1,0.448,1,1V9.5z
            M10.5,22.5 c0,0.552-0.448,1-1,1h-8c-0.552,0-1-0.448-1-1v-8c0-0.552,0.448-1,1-1h8c0.552,0,1,0.448,1,1V22.5z
            M23.5,22.5c0,0.552-0.448,1-1,1 h-8c-0.552,0-1-0.448-1-1v-8c0-0.552,0.448-1,1-1h8c0.552,0,1,0.448,1,1V22.5z`}))},p=function(I){var w=I.children,H=I.mode,V=I.onClick,te=t.useContext(i.LocalizationContext).l10n,ae="",be=t.createElement(d,null);switch(H){case i.ScrollMode.Horizontal:ae=te&&te.scrollMode?te.scrollMode.horizontalScrolling:"Horizontal scrolling",be=t.createElement(s,null);break;case i.ScrollMode.Page:ae=te&&te.scrollMode?te.scrollMode.pageScrolling:"Page scrolling",be=t.createElement(a,null);break;case i.ScrollMode.Wrapped:ae=te&&te.scrollMode?te.scrollMode.wrappedScrolling:"Wrapped scrolling",be=t.createElement(h,null);break;case i.ScrollMode.Vertical:default:ae=te&&te.scrollMode?te.scrollMode.verticalScrolling:"Vertical scrolling",be=t.createElement(d,null)}return w({icon:be,label:ae,onClick:V})},m={left:0,top:8},g=function(I){var w=I.isDisabled,H=I.isSelected,V=I.mode,te=I.onClick,ae="";switch(V){case i.ScrollMode.Horizontal:ae="scroll-mode__horizontal-button";break;case i.ScrollMode.Page:ae="scroll-mode__page-button";break;case i.ScrollMode.Wrapped:ae="scroll-mode__wrapped-button";break;case i.ScrollMode.Vertical:default:ae="scroll-mode__vertical-button"}return t.createElement(p,{mode:V,onClick:te},(function(be){return t.createElement(i.Tooltip,{ariaControlsSuffix:"scroll-mode-switch",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaLabel:be.label,isDisabled:w,isSelected:H,testId:ae,onClick:be.onClick},be.icon),content:function(){return be.label},offset:m})}))},v=function(I){var w=t.useState(I.get("scrollMode")||i.ScrollMode.Vertical),H=w[0],V=w[1],te=function(ae){V(ae)};return t.useEffect((function(){return I.subscribe("scrollMode",te),function(){I.unsubscribe("scrollMode",te)}}),[]),{scrollMode:H}},_=function(I){var w=t.useState(I.get("viewMode")||i.ViewMode.SinglePage),H=w[0],V=w[1],te=function(ae){V(ae)};return t.useEffect((function(){return I.subscribe("viewMode",te),function(){I.unsubscribe("viewMode",te)}}),[]),{viewMode:H}},b=function(I){var w=I.children,H=I.mode,V=I.store,te=_(V).viewMode,ae=v(V).scrollMode===H,be=(H===i.ScrollMode.Horizontal||H===i.ScrollMode.Wrapped)&&te!==i.ViewMode.SinglePage;return(w||function(_e){return t.createElement(g,{isDisabled:be,isSelected:ae,mode:_e.mode,onClick:_e.onClick})})({isDisabled:be,isSelected:ae,mode:H,onClick:function(){u(V,H)}})},E=function(I){var w=I.isDisabled,H=I.isSelected,V=I.mode,te=I.onClick,ae="";switch(V){case i.ScrollMode.Horizontal:ae="scroll-mode__horizontal-menu";break;case i.ScrollMode.Page:ae="scroll-mode__page-menu";break;case i.ScrollMode.Wrapped:ae="scroll-mode__wrapped-menu";break;case i.ScrollMode.Vertical:default:ae="scroll-mode__vertical-menu"}return t.createElement(p,{mode:V,onClick:te},(function(be){return t.createElement(i.MenuItem,{checked:H,icon:be.icon,isDisabled:w,testId:ae,onClick:be.onClick},be.label)}))},A=function(I,w){I.get("switchViewMode")(w);var H=I.get("scrollMode");H!==i.ScrollMode.Horizontal&&H!==i.ScrollMode.Wrapped||w===i.ViewMode.SinglePage||I.get("switchScrollMode")(i.ScrollMode.Vertical)},z=function(I){var w=I.children,H=I.mode,V=I.onClick,te=t.useContext(i.LocalizationContext).l10n,ae="",be=t.createElement(a,null);switch(H){case i.ViewMode.DualPage:ae=te&&te.scrollMode?te.scrollMode.dualPage:"Dual page",be=t.createElement(r,null);break;case i.ViewMode.DualPageWithCover:ae=te&&te.scrollMode?te.scrollMode.dualPageCover:"Dual page with cover",be=t.createElement(n,null);break;case i.ViewMode.SinglePage:default:ae=te&&te.scrollMode?te.scrollMode.singlePage:"Single page",be=t.createElement(a,null)}return w({icon:be,label:ae,onClick:V})},D={left:0,top:8},P=function(I){var w=I.isDisabled,H=I.isSelected,V=I.mode,te=I.onClick,ae="";switch(V){case i.ViewMode.DualPage:ae="view-mode__dual-button";break;case i.ViewMode.DualPageWithCover:ae="view-mode__dual-cover-button";break;case i.ViewMode.SinglePage:default:ae="view-mode__single-button"}return t.createElement(z,{mode:V,onClick:te},(function(be){return t.createElement(i.Tooltip,{ariaControlsSuffix:"view-mode-switch",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaLabel:be.label,isDisabled:w,isSelected:H,testId:ae,onClick:be.onClick},be.icon),content:function(){return be.label},offset:D})}))},G=function(I){var w=I.children,H=I.mode,V=I.store,te=_(V).viewMode,ae=v(V).scrollMode,be=te===H,_e=(ae===i.ScrollMode.Horizontal||ae===i.ScrollMode.Wrapped)&&H!==i.ViewMode.SinglePage;return(w||function(le){return t.createElement(P,{isDisabled:_e,isSelected:be,mode:le.mode,onClick:le.onClick})})({isDisabled:_e,isSelected:be,mode:H,onClick:function(){A(V,H)}})},R=function(I){var w=I.isDisabled,H=I.isSelected,V=I.mode,te=I.onClick,ae="";switch(V){case i.ViewMode.DualPage:ae="view-mode__dual-menu";break;case i.ViewMode.DualPageWithCover:ae="view-mode__dual-cover-menu";break;case i.ViewMode.SinglePage:default:ae="view-mode__single-menu"}return t.createElement(z,{mode:V,onClick:te},(function(be){return t.createElement(i.MenuItem,{checked:H,icon:be.icon,isDisabled:w,testId:ae,onClick:be.onClick},be.label)}))};return scrollMode_min.DualPageCoverViewModeIcon=n,scrollMode_min.DualPageViewModeIcon=r,scrollMode_min.HorizontalScrollingIcon=s,scrollMode_min.PageScrollingIcon=a,scrollMode_min.VerticalScrollingIcon=d,scrollMode_min.WrappedScrollingIcon=h,scrollMode_min.scrollModePlugin=function(){var I=t.useMemo((function(){return i.createStore({scrollMode:i.ScrollMode.Vertical,viewMode:i.ViewMode.SinglePage,switchScrollMode:function(){},switchViewMode:function(){}})}),[]),w=function(V){return t.createElement(b,l({},V,{store:I}))},H=function(V){return t.createElement(G,l({},V,{store:I}))};return{install:function(V){I.update("switchScrollMode",V.switchScrollMode),I.update("switchViewMode",V.switchViewMode)},onViewerStateChange:function(V){return I.update("scrollMode",V.scrollMode),I.update("viewMode",V.viewMode),V},switchScrollMode:function(V){u(I,V)},switchViewMode:function(V){A(I,V)},SwitchScrollMode:w,SwitchScrollModeButton:function(V){return t.createElement(w,{mode:V.mode},(function(te){return t.createElement(g,{isDisabled:te.isDisabled,isSelected:te.isSelected,mode:te.mode,onClick:function(){te.onClick()}})}))},SwitchScrollModeMenuItem:function(V){return t.createElement(w,{mode:V.mode},(function(te){return t.createElement(E,{isDisabled:te.isDisabled,isSelected:te.isSelected,mode:te.mode,onClick:function(){te.onClick(),V.onClick()}})}))},SwitchViewMode:H,SwitchViewModeButton:function(V){return t.createElement(H,{mode:V.mode},(function(te){return t.createElement(P,{isDisabled:te.isDisabled,isSelected:te.isSelected,mode:te.mode,onClick:function(){te.onClick()}})}))},SwitchViewModeMenuItem:function(V){return t.createElement(H,{mode:V.mode},(function(te){return t.createElement(R,{isDisabled:te.isDisabled,isSelected:te.isSelected,mode:te.mode,onClick:function(){te.onClick(),V.onClick()}})}))}}},scrollMode_min}var hasRequiredLib$5;function requireLib$5(){if(hasRequiredLib$5)return lib$3.exports;hasRequiredLib$5=1;return lib$3.exports=requireScrollMode_min(),lib$3.exports}var lib$2={exports:{}},search_min={},hasRequiredSearch_min;function requireSearch_min(){if(hasRequiredSearch_min)return search_min;hasRequiredSearch_min=1;var i=requireLib$h();function e(V){var te=Object.create(null);return V&&Object.keys(V).forEach((function(ae){if(ae!=="default"){var be=Object.getOwnPropertyDescriptor(V,ae);Object.defineProperty(te,ae,be.get?be:{enumerable:!0,get:function(){return V[ae]}})}})),te.default=V,Object.freeze(te)}var t=e(requireReact()),n=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:`M0.541,5.627L11.666,18.2c0.183,0.207,0.499,0.226,0.706,0.043c0.015-0.014,0.03-0.028,0.043-0.043
            L23.541,5.627`}))},r=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:`M23.535,18.373L12.409,5.8c-0.183-0.207-0.499-0.226-0.706-0.043C11.688,5.77,11.674,5.785,11.66,5.8
            L0.535,18.373`}))},s=function(){return t.createElement(i.Icon,{ignoreDirection:!0,size:16},t.createElement("path",{d:`M10.5,0.5c5.523,0,10,4.477,10,10s-4.477,10-10,10s-10-4.477-10-10S4.977,0.5,10.5,0.5z
            M23.5,23.5
            l-5.929-5.929`}))},a=function(){return a=Object.assign||function(V){for(var te,ae=1,be=arguments.length;ae<be;ae++)for(var _e in te=arguments[ae])Object.prototype.hasOwnProperty.call(te,_e)&&(V[_e]=te[_e]);return V},a.apply(this,arguments)},l={keyword:"",regExp:new RegExp(" "),wholeWords:!1},u=function(V){return{left:"".concat(V.left,"%"),top:"".concat(V.top,"%"),height:"".concat(V.height,"%"),width:"".concat(V.width,"%")}},d=function(V){var te=V.index,ae=V.area,be=V.onHighlightKeyword,_e=t.useRef();return i.useIsomorphicLayoutEffect((function(){var le=_e.current;be&&le&&be({highlightEle:le,keyword:ae.keyword})}),[]),t.createElement("div",{className:"rpv-search__highlight","data-index":te,ref:_e,style:u(ae),title:ae.keywordStr.trim()})},h=function(V){var te=V.parentNode;te&&te.removeChild(V)},p=function(V){var te=V.parentNode;if(te){var ae=document.createRange();ae.selectNodeContents(V),(function(be,_e){h(be);var le=_e.parentNode;le&&le.insertBefore(be,_e),h(_e)})(ae.extractContents(),V),te.normalize()}},m=function(V,te){return V.top<te.top?-1:V.top>te.top?1:V.left<te.left?-1:V.left>te.left?1:0},g=function(V){var te=V.numPages,ae=V.pageIndex,be=V.renderHighlights,_e=V.store,le=V.onHighlightKeyword,ue=t.useRef(),oe=t.useCallback((function(dn){return t.createElement(t.Fragment,null,dn.highlightAreas.map((function(pn,An){return t.createElement(d,{index:An,key:An,area:pn,onHighlightKeyword:le})})))}),[]),ee=be||oe,se=t.useState(_e.get("matchPosition")),re=se[0],fe=se[1],pe=t.useState(_e.get("keyword")||[l]),Z=pe[0],ce=pe[1],Ee=t.useState({pageIndex:ae,scale:1,status:i.LayerRenderStatus.PreRender}),Te=Ee[0],Ae=Ee[1],Pe=t.useRef(null),Me=t.useRef([]),We=t.useState([]),qe=We[0],Je=We[1],wt=function(){return!0},rt=t.useCallback((function(){return _e.get("targetPageFilter")||wt}),[_e.get("targetPageFilter")]),Lt=function(dn){var pn=Me.current;if(pn.length===0)return[];var An=[],In=[].slice.call(dn.querySelectorAll(".rpv-core__text-layer-text")),Jn=pn.map((function(ri){return ri.char})).join("");return Z.forEach((function(ri){var Wn=ri.keyword;if(Wn.trim()){for(var hi,ai=ri.regExp.flags.indexOf("g")===-1?new RegExp(ri.regExp,"".concat(ri.regExp.flags,"g")):ri.regExp,Zn=[];(hi=ai.exec(Jn))!==null;)Zn.push({keyword:ai,startIndex:hi.index,endIndex:ai.lastIndex});Zn.map((function(Ft){return{keyword:Ft.keyword,indexes:pn.slice(Ft.startIndex,Ft.endIndex)}})).forEach((function(Ft){var Xe=Ft.indexes.reduce((function(Ye,xn){return Ye[xn.spanIndex]=(Ye[xn.spanIndex]||[]).concat([xn]),Ye}),{});Object.values(Xe).forEach((function(Ye){if(Ye.length!==1||Ye[0].char.trim()!==""){var xn=ri.wholeWords?Ye.slice(1,-1):Ye,Vn=(function(Bn,si,Yi,ei,oi){var Li=document.createRange(),xe=ei.firstChild;if(!xe||xe.nodeType!==Node.TEXT_NODE)return null;var Ce=xe.textContent.length,Fe=oi[0].charIndexInSpan,tt=oi.length===1?Fe:oi[oi.length-1].charIndexInSpan;if(Fe>Ce||tt+1>Ce)return null;Li.setStart(xe,Fe),Li.setEnd(xe,tt+1);var Tn=document.createElement("span");Li.surroundContents(Tn);var jn=Tn.getBoundingClientRect(),li=Yi.getBoundingClientRect(),Fi=li.height,Qi=li.width,Di=100*(jn.left-li.left)/Qi,nr=100*(jn.top-li.top)/Fi,gr=100*jn.height/Fi,br=100*jn.width/Qi;return p(Tn),{keyword:si,keywordStr:Bn,numPages:te,pageIndex:ae,left:Di,top:nr,height:gr,width:br,pageHeight:Fi,pageWidth:Qi}})(Wn,Ft.keyword,dn,In[xn[0].spanIndex],xn);Vn&&An.push(Vn)}}))}))}})),An.sort(m)},ln=function(dn){dn&&dn.length>0&&ce(dn)},dt=function(dn){return fe(dn)},st=function(dn){if(dn.has(ae)){var pn=dn.get(ae);pn&&Ae({ele:pn.ele,pageIndex:ae,scale:pn.scale,status:pn.status})}},nt=function(){return Z.length===0||Z.length===1&&Z[0].keyword.trim()===""};return t.useEffect((function(){if(!nt()&&Te.status===i.LayerRenderStatus.DidRender&&!Me.current.length){var dn=Te.ele,pn=[].slice.call(dn.querySelectorAll(".rpv-core__text-layer-text")).map((function(An){return An.textContent})).reduce((function(An,In,Jn){return An.concat(In.split("").map((function(ri,Wn){return{char:ri,charIndexInSpan:Wn,spanIndex:Jn}})))}),[{char:"",charIndexInSpan:0,spanIndex:0}]).slice(1);Me.current=pn}}),[Z,Te.status]),t.useEffect((function(){if(!nt()&&Te.ele&&Te.status===i.LayerRenderStatus.DidRender&&rt()({pageIndex:ae,numPages:te})){var dn=Te.ele,pn=Lt(dn);Je(pn)}}),[Z,re,Te.status,Me.current]),t.useEffect((function(){nt()&&Te.ele&&Te.status===i.LayerRenderStatus.DidRender&&Je([])}),[Z,Te.status]),t.useEffect((function(){if(qe.length!==0){var dn=ue.current;if(re.pageIndex===ae&&dn&&Te.status===i.LayerRenderStatus.DidRender){var pn=dn.querySelector('.rpv-search__highlight[data-index="'.concat(re.matchIndex,'"]'));if(pn){var An=(function(Wn,hi){for(var ai=Wn.offsetTop,Zn=Wn.offsetLeft,Ft=Wn.parentElement;Ft&&Ft!==hi;)ai+=Ft.offsetTop,Zn+=Ft.offsetLeft,Ft=Ft.parentElement;return{left:Zn,top:ai}})(pn,dn),In=An.left,Jn=An.top,ri=_e.get("jumpToDestination");ri&&(ri({pageIndex:ae,bottomOffset:(dn.getBoundingClientRect().height-Jn)/Te.scale,leftOffset:In/Te.scale,scaleTo:Te.scale}),Pe.current&&Pe.current.classList.remove("rpv-search__highlight--current"),Pe.current=pn,pn.classList.add("rpv-search__highlight--current"))}}}}),[qe,re]),t.useEffect((function(){return _e.subscribe("keyword",ln),_e.subscribe("matchPosition",dt),_e.subscribe("renderStatus",st),function(){_e.unsubscribe("keyword",ln),_e.unsubscribe("matchPosition",dt),_e.unsubscribe("renderStatus",st)}}),[]),t.createElement("div",{className:"rpv-search__highlights","data-testid":"search__highlights-".concat(ae),ref:ue},ee({getCssProperties:u,highlightAreas:qe}))},v=function(V){var te,ae=V.wholeWords?" ".concat(V.keyword," "):V.keyword,be=V.matchCase?"g":"gi";return{keyword:V.keyword,regExp:new RegExp((te=ae,te.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),be),wholeWords:V.wholeWords||!1}},_=function(V,te,ae){return V instanceof RegExp?{keyword:V.source,regExp:V,wholeWords:ae||!1}:typeof V=="string"?V===""?l:v({keyword:V,matchCase:te||!1,wholeWords:ae||!1}):(te!==void 0&&(V.matchCase=te),ae!==void 0&&(V.wholeWords=ae),v(V))},b=function(V){var te,ae=V.get("initialKeyword"),be=t.useMemo((function(){if(ae&&ae.length===1){var dt=_(ae[0]);return{matchCase:dt.regExp.flags.indexOf("i")===-1,wholeWords:dt.wholeWords}}return{matchCase:!1,wholeWords:!1}}),[]),_e=(function(dt){var st=t.useRef(dt.get("doc")),nt=function(dn){st.current=dn};return t.useEffect((function(){return dt.subscribe("doc",nt),function(){dt.unsubscribe("doc",nt)}}),[]),st})(V),le=t.useState(ae),ue=le[0],oe=le[1],ee=t.useState([]),se=ee[0],re=ee[1],fe=t.useState(0),pe=fe[0],Z=fe[1],ce=t.useState(be.matchCase),Ee=ce[0],Te=ce[1],Ae=t.useRef([]),Pe=t.useState(be.wholeWords),Me=Pe[0],We=Pe[1],qe=function(){return!0},Je=t.useCallback((function(){return V.get("targetPageFilter")||qe}),[V.get("targetPageFilter")]),wt=function(dt){var st=se.length;if(ue.length===0||st===0)return null;var nt=dt===st+1?1:Math.max(1,Math.min(st,dt));return Z(nt),Lt(se[nt-1])},rt=function(dt){return oe(dt===""?[]:[dt])},Lt=function(dt){var st=V.get("jumpToPage");return st&&st(dt.pageIndex),V.update("matchPosition",{matchIndex:dt.matchIndex,pageIndex:dt.pageIndex}),dt},ln=function(dt,st,nt){var dn=_e.current;if(!dn)return Promise.resolve([]);var pn=dn.numPages,An=dt.map((function(In){return _(In,st,nt)}));return V.update("keyword",An),Z(0),re([]),new Promise((function(In,Jn){var ri=Ae.current.length===0?(function(){var Wn=_e.current;if(!Wn)return Promise.resolve([]);var hi=Array(Wn.numPages).fill(0).map((function(ai,Zn){return i.getPage(Wn,Zn).then((function(Ft){return Ft.getTextContent()})).then((function(Ft){var Xe=Ft.items.map((function(Ye){return Ye.str||""})).join("");return Promise.resolve({pageContent:Xe,pageIndex:Zn})}))}));return Promise.all(hi).then((function(ai){return ai.sort((function(Zn,Ft){return Zn.pageIndex-Ft.pageIndex})),Promise.resolve(ai.map((function(Zn){return Zn.pageContent})))}))})().then((function(Wn){return Ae.current=Wn,Promise.resolve(Wn)})):Promise.resolve(Ae.current);ri.then((function(Wn){var hi=[];Wn.forEach((function(ai,Zn){Je()({pageIndex:Zn,numPages:pn})&&An.forEach((function(Ft){for(var Xe,Ye=0;(Xe=Ft.regExp.exec(ai))!==null;)hi.push({keyword:Ft.regExp,matchIndex:Ye,pageIndex:Zn,pageText:ai,startIndex:Xe.index,endIndex:Ft.regExp.lastIndex}),Ye++}))})),re(hi),hi.length>0&&(Z(1),Lt(hi[0])),In(hi)}))}))};return t.useEffect((function(){Ae.current=[]}),[_e.current]),{clearKeyword:function(){V.update("keyword",[l]),rt(""),Z(0),re([]),Te(!1),We(!1)},changeMatchCase:function(dt){Te(dt),ue.length>0&&ln(ue,dt,Me)},changeWholeWords:function(dt){We(dt),ue.length>0&&ln(ue,Ee,dt)},currentMatch:pe,jumpToMatch:wt,jumpToNextMatch:function(){return wt(pe+1)},jumpToPreviousMatch:function(){return wt(pe-1)},keywords:ue,matchCase:Ee,numberOfMatches:se.length,wholeWords:Me,search:function(){return ln(ue,Ee,Me)},searchFor:ln,setKeywords:oe,keyword:ue.length===0?"":(te=ue[0],te instanceof RegExp?te.source:typeof te=="string"?te:te.keyword),setKeyword:rt,setTargetPages:function(dt){V.update("targetPageFilter",dt)}}},E=function(V){var te=V.children,ae=V.store,be=b(ae),_e=t.useState(!1),le=_e[0],ue=_e[1],oe=function(ee){return ue(!0)};return t.useEffect((function(){return ae.subscribe("doc",oe),function(){ae.unsubscribe("doc",oe)}}),[]),te(a(a({},be),{isDocumentLoaded:le}))},A=function(V){var te=V.containerRef,ae=V.store,be=t.useRef(!1),_e=function(){be.current=!0},le=function(){be.current=!1},ue=function(oe){var ee=te.current;ee&&(oe.shiftKey||oe.altKey||oe.key!=="f"||(i.isMac()?oe.metaKey&&!oe.ctrlKey:oe.ctrlKey)&&(be.current||document.activeElement&&ee.contains(document.activeElement))&&(oe.preventDefault(),ae.update("areShortcutsPressed",!0)))};return t.useEffect((function(){var oe=te.current;if(oe)return document.addEventListener("keydown",ue),oe.addEventListener("mouseenter",_e),oe.addEventListener("mouseleave",le),function(){document.removeEventListener("keydown",ue),oe.removeEventListener("mouseenter",_e),oe.removeEventListener("mouseleave",le)}}),[te.current]),t.createElement(t.Fragment,null)},z={left:0,top:8},D=function(V){var te=V.store,ae=V.onToggle,be=t.useContext(i.LocalizationContext).l10n,_e=t.useContext(i.ThemeContext).direction,le=t.useState(!1),ue=le[0],oe=le[1],ee=t.useState(!1),se=ee[0],re=ee[1],fe=_e===i.TextDirection.RightToLeft,pe=b(te),Z=pe.clearKeyword,ce=pe.changeMatchCase,Ee=pe.changeWholeWords,Te=pe.currentMatch,Ae=pe.jumpToNextMatch,Pe=pe.jumpToPreviousMatch,Me=pe.keyword,We=pe.matchCase,qe=pe.numberOfMatches,Je=pe.wholeWords,wt=pe.search,rt=pe.setKeyword,Lt=function(dn){oe(!0),wt().then((function(pn){oe(!1),re(!0),dn&&dn()}))};t.useEffect((function(){var dn=te.get("initialKeyword");dn&&dn.length===1&&Me&&Lt((function(){te.update("initialKeyword",[])}))}),[]);var ln=be&&be.search?be.search.enterToSearch:"Enter to search",dt=be&&be.search?be.search.previousMatch:"Previous match",st=be&&be.search?be.search.nextMatch:"Next match",nt=be&&be.search?be.search.close:"Close";return t.createElement("div",{className:"rpv-search__popover"},t.createElement("div",{className:"rpv-search__popover-input-counter"},t.createElement(i.TextBox,{ariaLabel:ln,autoFocus:!0,placeholder:ln,type:"text",value:Me,onChange:function(dn){re(!1),rt(dn)},onKeyDown:function(dn){dn.key==="Enter"&&Me&&(se?Ae():Lt())}}),t.createElement("div",{className:i.classNames({"rpv-search__popover-counter":!0,"rpv-search__popover-counter--ltr":!fe,"rpv-search__popover-counter--rtl":fe})},ue&&t.createElement(i.Spinner,{testId:"search__popover-searching",size:"1rem"}),!ue&&t.createElement("span",{"data-testid":"search__popover-num-matches"},Te,"/",qe))),t.createElement("label",{className:"rpv-search__popover-label"},t.createElement("input",{className:"rpv-search__popover-label-checkbox","data-testid":"search__popover-match-case",checked:We,type:"checkbox",onChange:function(dn){re(!1),ce(dn.target.checked)}})," ",be&&be.search?be.search.matchCase:"Match case"),t.createElement("label",{className:"rpv-search__popover-label"},t.createElement("input",{className:"rpv-search__popover-label-checkbox",checked:Je,"data-testid":"search__popover-whole-words",type:"checkbox",onChange:function(dn){re(!1),Ee(dn.target.checked)}})," ",be&&be.search?be.search.wholeWords:"Whole words"),t.createElement("div",{className:"rpv-search__popover-footer"},t.createElement("div",{className:"rpv-search__popover-footer-item"},t.createElement(i.Tooltip,{ariaControlsSuffix:"search-previous-match",position:fe?i.Position.BottomRight:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaLabel:dt,isDisabled:Te<=1,onClick:Pe},t.createElement(r,null)),content:function(){return dt},offset:z})),t.createElement("div",{className:"rpv-search__popover-footer-item"},t.createElement(i.Tooltip,{ariaControlsSuffix:"search-next-match",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaLabel:st,isDisabled:Te>qe-1,onClick:Ae},t.createElement(n,null)),content:function(){return st},offset:z})),t.createElement("div",{className:i.classNames({"rpv-search__popover-footer-button":!0,"rpv-search__popover-footer-button--ltr":!fe,"rpv-search__popover-footer-button--rtl":fe})},t.createElement(i.Button,{onClick:function(){ae(),Z()}},nt))))},P=function(V){var te=V.children,ae=V.onClick,be=t.useContext(i.LocalizationContext).l10n,_e=be&&be.search?be.search.search:"Search";return te({icon:t.createElement(s,null),label:_e,onClick:ae})},G={left:0,top:8},R=function(V){var te=V.enableShortcuts,ae=V.store,be=V.onClick,_e=te?i.isMac()?"Meta+F":"Ctrl+F":"",le=function(ue){ue&&be()};return t.useEffect((function(){return ae.subscribe("areShortcutsPressed",le),function(){ae.unsubscribe("areShortcutsPressed",le)}}),[]),t.createElement(P,{onClick:be},(function(ue){return t.createElement(i.Tooltip,{ariaControlsSuffix:"search-popover",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaKeyShortcuts:_e,ariaLabel:ue.label,testId:"search__popover-button",onClick:be},ue.icon),content:function(){return ue.label},offset:G})}))},I={left:0,top:8},w=function(V){var te=V.children,ae=V.enableShortcuts,be=V.store,_e=t.useContext(i.ThemeContext).direction===i.TextDirection.RightToLeft?i.Position.BottomRight:i.Position.BottomLeft,le=te||function(ue){return t.createElement(R,a({enableShortcuts:ae,store:be},ue))};return t.createElement(i.Popover,{ariaControlsSuffix:"search",lockScroll:!1,position:_e,target:function(ue){return le({onClick:ue})},content:function(ue){return t.createElement(D,{store:be,onToggle:ue})},offset:I,closeOnClickOutside:!1,closeOnEscape:!0})},H=function(V){return Array.isArray(V)?V.map((function(te){return _(te)})):[_(V)]};return search_min.NextIcon=n,search_min.PreviousIcon=r,search_min.SearchIcon=s,search_min.searchPlugin=function(V){var te=t.useMemo((function(){return Object.assign({},{enableShortcuts:!0,onHighlightKeyword:function(){}},V)}),[]),ae=t.useMemo((function(){return i.createStore({initialKeyword:V&&V.keyword?Array.isArray(V.keyword)?V.keyword:[V.keyword]:[],keyword:V&&V.keyword?H(V.keyword):[l],matchPosition:{matchIndex:-1,pageIndex:-1},renderStatus:new Map})}),[]),be=b(ae),_e=be.clearKeyword,le=be.jumpToMatch,ue=be.jumpToNextMatch,oe=be.jumpToPreviousMatch,ee=be.searchFor,se=be.setKeywords,re=be.setTargetPages,fe=function(pe){return t.createElement(w,a({enableShortcuts:te.enableShortcuts},pe,{store:ae}))};return{install:function(pe){var Z=V&&V.keyword?Array.isArray(V.keyword)?V.keyword:[V.keyword]:[],ce=V&&V.keyword?H(V.keyword):[l];ae.update("initialKeyword",Z),ae.update("jumpToDestination",pe.jumpToDestination),ae.update("jumpToPage",pe.jumpToPage),ae.update("keyword",ce)},renderPageLayer:function(pe){return t.createElement(g,{key:pe.pageIndex,numPages:pe.doc.numPages,pageIndex:pe.pageIndex,renderHighlights:V?.renderHighlights,store:ae,onHighlightKeyword:te.onHighlightKeyword})},renderViewer:function(pe){var Z=pe.slot;return Z.subSlot&&(Z.subSlot.children=t.createElement(t.Fragment,null,te.enableShortcuts&&t.createElement(A,{containerRef:pe.containerRef,store:ae}),Z.subSlot.children)),Z},uninstall:function(pe){var Z=ae.get("renderStatus");Z&&Z.clear()},onDocumentLoad:function(pe){ae.update("doc",pe.doc)},onTextLayerRender:function(pe){var Z=ae.get("renderStatus");Z&&(Z=Z.set(pe.pageIndex,pe),ae.update("renderStatus",Z))},Search:function(pe){return t.createElement(E,a({},pe,{store:ae}))},ShowSearchPopover:fe,ShowSearchPopoverButton:function(){return t.createElement(fe,null,(function(pe){return t.createElement(R,a({enableShortcuts:te.enableShortcuts,store:ae},pe))}))},clearHighlights:function(){_e()},highlight:function(pe){var Z=Array.isArray(pe)?pe:[pe];return se(Z),ee(Z)},jumpToMatch:le,jumpToNextMatch:ue,jumpToPreviousMatch:oe,setTargetPages:re}},search_min}var hasRequiredLib$4;function requireLib$4(){if(hasRequiredLib$4)return lib$2.exports;hasRequiredLib$4=1;return lib$2.exports=requireSearch_min(),lib$2.exports}var lib$1={exports:{}},theme_min={},hasRequiredTheme_min;function requireTheme_min(){if(hasRequiredTheme_min)return theme_min;hasRequiredTheme_min=1;var i=requireLib$h();function e(h){var p=Object.create(null);return h&&Object.keys(h).forEach((function(m){if(m!=="default"){var g=Object.getOwnPropertyDescriptor(h,m);Object.defineProperty(p,m,g.get?g:{enumerable:!0,get:function(){return h[m]}})}})),p.default=h,Object.freeze(p)}var t=e(requireReact()),n=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:"M19.5,15.106l2.4-2.4a1,1,0,0,0,0-1.414l-2.4-2.4V5.5a1,1,0,0,0-1-1H15.106l-2.4-2.4a1,1,0,0,0-1.414,0l-2.4,2.4H5.5a1,1,0,0,0-1,1V8.894l-2.4,2.4a1,1,0,0,0,0,1.414l2.4,2.4V18.5a1,1,0,0,0,1,1H8.894l2.4,2.4a1,1,0,0,0,1.414,0l2.4-2.4H18.5a1,1,0,0,0,1-1Z"}),t.createElement("path",{d:"M10,6.349a6,6,0,0,1,0,11.3,6,6,0,1,0,0-11.3Z"}))},r=function(){return t.createElement(i.Icon,{size:16},t.createElement("path",{d:"M19.491,15.106l2.4-2.4a1,1,0,0,0,0-1.414l-2.4-2.4V5.5a1,1,0,0,0-1-1H15.1L12.7,2.1a1,1,0,0,0-1.414,0l-2.4,2.4H5.491a1,1,0,0,0-1,1V8.894l-2.4,2.4a1,1,0,0,0,0,1.414l2.4,2.4V18.5a1,1,0,0,0,1,1H8.885l2.4,2.4a1,1,0,0,0,1.414,0l2.4-2.4h3.394a1,1,0,0,0,1-1Z"}),t.createElement("path",{d:"M11.491,6c4,0,6,2.686,6,6s-2,6-6,6Z"}))},s=function(){return s=Object.assign||function(h){for(var p,m=1,g=arguments.length;m<g;m++)for(var v in p=arguments[m])Object.prototype.hasOwnProperty.call(p,v)&&(h[v]=p[v]);return h},s.apply(this,arguments)},a={left:0,top:8},l=function(h){var p=h.onClick,m=t.useContext(i.ThemeContext),g=t.useContext(i.LocalizationContext).l10n,v=m.currentTheme==="dark",_=g&&g.theme?v?g.theme.switchLightTheme:g.theme.switchDarkTheme:v?"Switch to the light theme":"Switch to the dark theme";return t.createElement(i.Tooltip,{ariaControlsSuffix:"theme-switch",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaLabel:_,testId:"theme__switch-button",onClick:p},v?t.createElement(r,null):t.createElement(n,null)),content:function(){return _},offset:a})},u=function(h){var p=h.children,m=t.useContext(i.ThemeContext);return(p||function(g){return t.createElement(l,{onClick:g.onClick})})({onClick:function(){return m.setCurrentTheme(m.currentTheme==="dark"?"light":"dark")}})},d=function(h){var p=h.onClick,m=t.useContext(i.ThemeContext),g=t.useContext(i.LocalizationContext).l10n,v=m.currentTheme==="dark",_=g&&g.theme?v?g.theme.switchLightTheme:g.theme.switchDarkTheme:v?"Switch to the light theme":"Switch to the dark theme";return t.createElement(i.MenuItem,{icon:v?t.createElement(r,null):t.createElement(n,null),testId:"theme__switch-menu",onClick:p},_)};return theme_min.DarkIcon=n,theme_min.LightIcon=r,theme_min.themePlugin=function(){var h=function(p){return t.createElement(u,s({},p))};return{SwitchTheme:h,SwitchThemeButton:function(){return t.createElement(h,null,(function(p){return t.createElement(l,s({},p))}))},SwitchThemeMenuItem:function(p){return t.createElement(h,null,(function(m){return t.createElement(d,{onClick:function(){m.onClick(),p.onClick()}})}))}}},theme_min}var hasRequiredLib$3;function requireLib$3(){if(hasRequiredLib$3)return lib$1.exports;hasRequiredLib$3=1;return lib$1.exports=requireTheme_min(),lib$1.exports}var lib={exports:{}},zoom_min={},hasRequiredZoom_min;function requireZoom_min(){if(hasRequiredZoom_min)return zoom_min;hasRequiredZoom_min=1;var i=requireLib$h();function e(V){var te=Object.create(null);return V&&Object.keys(V).forEach((function(ae){if(ae!=="default"){var be=Object.getOwnPropertyDescriptor(V,ae);Object.defineProperty(te,ae,be.get?be:{enumerable:!0,get:function(){return V[ae]}})}})),te.default=V,Object.freeze(te)}var t=e(requireReact()),n=function(){return t.createElement(i.Icon,{ignoreDirection:!0,size:16},t.createElement("path",{d:`M10.5,0.499c5.523,0,10,4.477,10,10s-4.477,10-10,10s-10-4.477-10-10S4.977,0.499,10.5,0.499z
            M23.5,23.499
            l-5.929-5.929
            M5.5,10.499h10
            M10.5,5.499v10`}))},r=function(){return t.createElement(i.Icon,{ignoreDirection:!0,size:16},t.createElement("path",{d:`M10.5,0.499c5.523,0,10,4.477,10,10s-4.477,10-10,10s-10-4.477-10-10S4.977,0.499,10.5,0.499z
            M23.5,23.499
            l-5.929-5.929
            M5.5,10.499h10`}))},s=function(){return s=Object.assign||function(V){for(var te,ae=1,be=arguments.length;ae<be;ae++)for(var _e in te=arguments[ae])Object.prototype.hasOwnProperty.call(te,_e)&&(V[_e]=te[_e]);return V},s.apply(this,arguments)},a=function(V){var te=t.useState(V.get("scale")||0),ae=te[0],be=te[1],_e=function(le){be(le)};return t.useEffect((function(){return V.subscribe("scale",_e),function(){V.unsubscribe("scale",_e)}}),[]),{scale:ae}},l=function(V){var te=V.children,ae=V.store;return(te||function(be){return t.createElement(t.Fragment,null,"".concat(Math.round(100*be.scale),"%"))})({scale:a(ae).scale})},u={passive:!1},d=null,h=function(V){var te=V.pagesContainerRef,ae=V.store,be=i.useDebounceCallback((function(le){var ue=ae.get("zoom");ue&&ue(le)}),40),_e=function(le){if(le.ctrlKey){le.preventDefault();var ue=le.target.getBoundingClientRect(),oe=1-le.deltaY/100,ee=le.clientX-ue.left,se=le.clientY-ue.top,re=ae.get("scale"),fe=(d||(d=document.createElementNS("http://www.w3.org/2000/svg","svg"))).createSVGMatrix().translate(ee,se).scale(oe).translate(-ee,-se).scale(re);be(fe.a)}};return i.useIsomorphicLayoutEffect((function(){var le=te.current;if(le)return le.addEventListener("wheel",_e,u),function(){le.removeEventListener("wheel",_e)}}),[]),t.createElement(t.Fragment,null)},p=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],m=function(V){return p.find((function(te){return te>V}))||V},g=function(V){var te=p.findIndex((function(ae){return ae>=V}));return te===-1||te===0?V:p[te-1]},v=function(V){var te=V.containerRef,ae=V.store,be=function(_e){if(!_e.shiftKey&&!_e.altKey&&(i.isMac()?_e.metaKey:_e.ctrlKey)){var le=te.current;if(le&&document.activeElement&&le.contains(document.activeElement)){var ue=ae.get("zoom");if(ue){var oe=ae.get("scale")||1,ee=1;switch(_e.key){case"-":ee=g(oe);break;case"=":ee=m(oe);break;case"0":ee=1;break;default:ee=oe}ee!==oe&&(_e.preventDefault(),ue(ee))}}}};return t.useEffect((function(){if(te.current)return document.addEventListener("keydown",be),function(){document.removeEventListener("keydown",be)}}),[te.current]),t.createElement(t.Fragment,null)},_=[.5,.75,1,1.25,1.5,2,3,4],b={left:0,top:8},E=function(V){var te=V.levels,ae=te===void 0?_:te,be=V.scale,_e=V.onZoom,le=t.useContext(i.LocalizationContext).l10n,ue=t.useContext(i.ThemeContext).direction===i.TextDirection.RightToLeft,oe=le&&le.zoom?le.zoom.zoomDocument:"Zoom document";return t.createElement(i.Popover,{ariaControlsSuffix:"zoom",ariaHasPopup:"menu",position:i.Position.BottomCenter,target:function(ee){return t.createElement(i.MinimalButton,{ariaLabel:oe,testId:"zoom__popover-target",onClick:function(){ee()}},t.createElement("span",{className:"rpv-zoom__popover-target"},t.createElement("span",{"data-testid":"zoom__popover-target-scale",className:i.classNames({"rpv-zoom__popover-target-scale":!0,"rpv-zoom__popover-target-scale--ltr":!ue,"rpv-zoom__popover-target-scale--rtl":ue})},Math.round(100*be),"%"),t.createElement("span",{className:"rpv-zoom__popover-target-arrow"})))},content:function(ee){return t.createElement(i.Menu,null,Object.keys(i.SpecialZoomLevel).map((function(se){var re=se;return t.createElement(i.MenuItem,{key:re,onClick:function(){ee(),_e(re)}},(function(fe){switch(fe){case i.SpecialZoomLevel.ActualSize:return le&&le.zoom?le.zoom.actualSize:"Actual size";case i.SpecialZoomLevel.PageFit:return le&&le.zoom?le.zoom.pageFit:"Page fit";case i.SpecialZoomLevel.PageWidth:return le&&le.zoom?le.zoom.pageWidth:"Page width"}})(re))})),t.createElement(i.MenuDivider,null),ae.map((function(se){return t.createElement(i.MenuItem,{key:se,onClick:function(){ee(),_e(se)}},"".concat(Math.round(100*se),"%"))})))},offset:b,closeOnClickOutside:!0,closeOnEscape:!0})},A=function(V){var te=V.children,ae=V.levels,be=V.store;return(te||function(_e){return t.createElement(E,{levels:ae,scale:_e.scale,onZoom:_e.onZoom})})({scale:a(be).scale,onZoom:function(_e){var le=be.get("zoom");le&&le(_e)}})},z={left:0,top:8},D=function(V){var te=V.enableShortcuts,ae=V.onClick,be=t.useContext(i.LocalizationContext).l10n,_e=be&&be.zoom?be.zoom.zoomIn:"Zoom in",le=te?i.isMac()?"Meta+=":"Ctrl+=":"";return t.createElement(i.Tooltip,{ariaControlsSuffix:"zoom-in",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaKeyShortcuts:le,ariaLabel:_e,testId:"zoom__in-button",onClick:ae},t.createElement(n,null)),content:function(){return _e},offset:z})},P=function(V){var te=V.children,ae=V.enableShortcuts,be=V.store,_e=a(be).scale;return(te||D)({enableShortcuts:ae,onClick:function(){var le=be.get("zoom");le&&le(m(_e))}})},G=function(V){var te=V.onClick,ae=t.useContext(i.LocalizationContext).l10n,be=ae&&ae.zoom?ae.zoom.zoomIn:"Zoom in";return t.createElement(i.MenuItem,{icon:t.createElement(n,null),testId:"zoom__in-menu",onClick:te},be)},R={left:0,top:8},I=function(V){var te=V.enableShortcuts,ae=V.onClick,be=t.useContext(i.LocalizationContext).l10n,_e=be&&be.zoom?be.zoom.zoomOut:"Zoom out",le=te?i.isMac()?"Meta+-":"Ctrl+-":"";return t.createElement(i.Tooltip,{ariaControlsSuffix:"zoom-out",position:i.Position.BottomCenter,target:t.createElement(i.MinimalButton,{ariaKeyShortcuts:le,ariaLabel:_e,testId:"zoom__out-button",onClick:ae},t.createElement(r,null)),content:function(){return _e},offset:R})},w=function(V){var te=V.children,ae=V.enableShortcuts,be=V.store,_e=a(be).scale;return(te||I)({enableShortcuts:ae,onClick:function(){var le=be.get("zoom");le&&le(g(_e))}})},H=function(V){var te=V.onClick,ae=t.useContext(i.LocalizationContext).l10n,be=ae&&ae.zoom?ae.zoom.zoomOut:"Zoom out";return t.createElement(i.MenuItem,{icon:t.createElement(r,null),testId:"zoom__out-menu",onClick:te},be)};return zoom_min.ZoomInIcon=n,zoom_min.ZoomOutIcon=r,zoom_min.zoomPlugin=function(V){var te=t.useMemo((function(){return Object.assign({},{enableShortcuts:!0},V)}),[]),ae=t.useMemo((function(){return i.createStore({})}),[]),be=function(ue){return t.createElement(P,s({enableShortcuts:te.enableShortcuts},ue,{store:ae}))},_e=function(ue){return t.createElement(w,s({enableShortcuts:te.enableShortcuts},ue,{store:ae}))},le=function(ue){return t.createElement(A,s({},ue,{store:ae}))};return{renderViewer:function(ue){var oe=ue.slot;if(!te.enableShortcuts)return oe;var ee={children:t.createElement(t.Fragment,null,t.createElement(v,{containerRef:ue.containerRef,store:ae}),t.createElement(h,{pagesContainerRef:ue.pagesContainerRef,store:ae}),oe.children)};return s(s({},oe),ee)},install:function(ue){ae.update("zoom",ue.zoom)},onViewerStateChange:function(ue){return ae.update("scale",ue.scale),ue},zoomTo:function(ue){var oe=ae.get("zoom");oe&&oe(ue)},CurrentScale:function(ue){return t.createElement(l,s({},ue,{store:ae}))},ZoomIn:be,ZoomInButton:function(){return t.createElement(be,null,(function(ue){return t.createElement(D,s({},ue))}))},ZoomInMenuItem:function(ue){return t.createElement(be,null,(function(oe){return t.createElement(G,{onClick:function(){oe.onClick(),ue.onClick()}})}))},ZoomOut:_e,ZoomOutButton:function(){return t.createElement(_e,null,(function(ue){return t.createElement(I,s({},ue))}))},ZoomOutMenuItem:function(ue){return t.createElement(_e,null,(function(oe){return t.createElement(H,{onClick:function(){oe.onClick(),ue.onClick()}})}))},Zoom:le,ZoomPopover:function(ue){return t.createElement(le,null,(function(oe){return t.createElement(E,s({levels:ue?.levels},oe))}))}}},zoom_min}var hasRequiredLib$2;function requireLib$2(){if(hasRequiredLib$2)return lib.exports;hasRequiredLib$2=1;return lib.exports=requireZoom_min(),lib.exports}var hasRequiredToolbar_min;function requireToolbar_min(){if(hasRequiredToolbar_min)return toolbar_min;hasRequiredToolbar_min=1;var i=requireLib$h(),e=requireLib$d(),t=requireReact(),n=requireLib$c(),r=requireLib$b(),s=requireLib$a(),a=requireLib$9(),l=requireLib$8(),u=requireLib$7(),d=requireLib$6(),h=requireLib$5(),p=requireLib$4(),m=requireLib$3(),g=requireLib$2();function v(I){var w=Object.create(null);return I&&Object.keys(I).forEach((function(H){if(H!=="default"){var V=Object.getOwnPropertyDescriptor(I,H);Object.defineProperty(w,H,V.get?V:{enumerable:!0,get:function(){return I[H]}})}})),w.default=I,Object.freeze(w)}var _=v(t),b=function(){return _.createElement(i.Icon,{size:16},_.createElement("path",{d:`M12,0.5c1.381,0,2.5,1.119,2.5,2.5S13.381,5.5,12,5.5S9.5,4.381,9.5,3S10.619,0.5,12,0.5z
            M12,9.5
            c1.381,0,2.5,1.119,2.5,2.5s-1.119,2.5-2.5,2.5S9.5,13.381,9.5,12S10.619,9.5,12,9.5z
            M12,18.5c1.381,0,2.5,1.119,2.5,2.5
            s-1.119,2.5-2.5,2.5S9.5,22.381,9.5,21S10.619,18.5,12,18.5z`}))},E={left:0,top:8},A=function(I){var w=I.toolbarSlot,H=_.useContext(i.LocalizationContext).l10n,V=_.useContext(i.ThemeContext).direction===i.TextDirection.RightToLeft?i.Position.BottomLeft:i.Position.BottomRight,te=w.DownloadMenuItem,ae=w.EnterFullScreenMenuItem,be=w.GoToFirstPageMenuItem,_e=w.GoToLastPageMenuItem,le=w.GoToNextPageMenuItem,ue=w.GoToPreviousPageMenuItem,oe=w.OpenMenuItem,ee=w.PrintMenuItem,se=w.RotateBackwardMenuItem,re=w.RotateForwardMenuItem,fe=w.ShowPropertiesMenuItem,pe=w.SwitchScrollModeMenuItem,Z=w.SwitchSelectionModeMenuItem,ce=w.SwitchViewModeMenuItem,Ee=w.SwitchThemeMenuItem;return _.createElement(i.Popover,{ariaControlsSuffix:"toolbar-more-actions",ariaHasPopup:"menu",position:V,target:function(Te,Ae){var Pe=H&&H.toolbar?H.toolbar.moreActions:"More actions";return _.createElement(i.Tooltip,{ariaControlsSuffix:"toolbar-more-actions",position:V,target:_.createElement(i.MinimalButton,{ariaLabel:Pe,isSelected:Ae,testId:"toolbar__more-actions-popover-target",onClick:Te},_.createElement(b,null)),content:function(){return Pe},offset:E})},content:function(Te){return _.createElement(i.Menu,null,_.createElement("div",{className:"rpv-core__display--block rpv-core__display--hidden-medium"},_.createElement(Ee,{onClick:Te})),_.createElement("div",{className:"rpv-core__display--block rpv-core__display--hidden-medium"},_.createElement(ae,{onClick:Te})),_.createElement("div",{className:"rpv-core__display--block rpv-core__display--hidden-medium"},_.createElement(oe,null)),_.createElement("div",{className:"rpv-core__display--block rpv-core__display--hidden-medium"},_.createElement(ee,{onClick:Te})),_.createElement("div",{className:"rpv-core__display--block rpv-core__display--hidden-medium"},_.createElement(te,{onClick:Te})),_.createElement("div",{className:"rpv-core__display--block rpv-core__display--hidden-medium"},_.createElement(i.MenuDivider,null)),_.createElement(be,{onClick:Te}),_.createElement("div",{className:"rpv-core__display--block rpv-core__display--hidden-medium"},_.createElement(ue,{onClick:Te})),_.createElement("div",{className:"rpv-core__display--block rpv-core__display--hidden-medium"},_.createElement(le,{onClick:Te})),_.createElement(_e,{onClick:Te}),_.createElement(i.MenuDivider,null),_.createElement(re,{onClick:Te}),_.createElement(se,{onClick:Te}),_.createElement(i.MenuDivider,null),_.createElement(Z,{mode:e.SelectionMode.Text,onClick:Te}),_.createElement(Z,{mode:e.SelectionMode.Hand,onClick:Te}),_.createElement(i.MenuDivider,null),_.createElement(pe,{mode:i.ScrollMode.Page,onClick:Te}),_.createElement(pe,{mode:i.ScrollMode.Vertical,onClick:Te}),_.createElement(pe,{mode:i.ScrollMode.Horizontal,onClick:Te}),_.createElement(pe,{mode:i.ScrollMode.Wrapped,onClick:Te}),_.createElement(i.MenuDivider,null),_.createElement("div",{className:"rpv-core__display--hidden rpv-core__display--block-small"},_.createElement(ce,{mode:i.ViewMode.SinglePage,onClick:Te})),_.createElement("div",{className:"rpv-core__display--hidden rpv-core__display--block-small"},_.createElement(ce,{mode:i.ViewMode.DualPage,onClick:Te})),_.createElement("div",{className:"rpv-core__display--hidden rpv-core__display--block-small"},_.createElement(ce,{mode:i.ViewMode.DualPageWithCover,onClick:Te})),_.createElement("div",{className:"rpv-core__display--hidden rpv-core__display--block-small"},_.createElement(i.MenuDivider,null)),_.createElement(fe,{onClick:Te}))},offset:E,closeOnClickOutside:!0,closeOnEscape:!0})},z=function(){return z=Object.assign||function(I){for(var w,H=1,V=arguments.length;H<V;H++)for(var te in w=arguments[H])Object.prototype.hasOwnProperty.call(w,te)&&(I[te]=w[te]);return I},z.apply(this,arguments)},D=function(I){return function(w){var H=_.useMemo((function(){return I(w)}),[]),V=_.useContext(i.ThemeContext).direction===i.TextDirection.RightToLeft,te=H.CurrentPageInput,ae=H.Download,be=H.EnterFullScreen,_e=H.GoToNextPage,le=H.GoToPreviousPage,ue=H.NumberOfPages,oe=H.Open,ee=H.Print,se=H.ShowSearchPopover,re=H.SwitchTheme,fe=H.Zoom,pe=H.ZoomIn,Z=H.ZoomOut;return _.createElement("div",{"data-testid":"toolbar",className:i.classNames({"rpv-toolbar":!0,"rpv-toolbar--rtl":V}),role:"toolbar","aria-orientation":"horizontal"},_.createElement("div",{className:"rpv-toolbar__left"},_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(se,null)),_.createElement("div",{className:"rpv-core__display--hidden rpv-core__display--block-small"},_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(le,null))),_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(te,null),_.createElement("span",{className:"rpv-toolbar__label"},_.createElement(ue,null))),_.createElement("div",{className:"rpv-core__display--hidden rpv-core__display--block-small"},_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(_e,null)))),_.createElement("div",{className:"rpv-toolbar__center"},_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(Z,null)),_.createElement("div",{className:"rpv-core__display--hidden rpv-core__display--block-small"},_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(fe,null))),_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(pe,null))),_.createElement("div",{className:"rpv-toolbar__right"},_.createElement("div",{className:"rpv-core__display--hidden rpv-core__display--block-medium"},_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(re,null))),_.createElement("div",{className:"rpv-core__display--hidden rpv-core__display--block-medium"},_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(be,null))),_.createElement("div",{className:"rpv-core__display--hidden rpv-core__display--block-medium"},_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(oe,null))),_.createElement("div",{className:"rpv-core__display--hidden rpv-core__display--block-medium"},_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(ae,null))),_.createElement("div",{className:"rpv-core__display--hidden rpv-core__display--block-medium"},_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(ee,null))),_.createElement("div",{className:"rpv-toolbar__item"},_.createElement(A,{toolbarSlot:H}))))}},P=function(I){var w=I.NumberOfPages;return Object.assign({},I,{NumberOfPages:function(){return _.createElement(_.Fragment,null,"/ ",_.createElement(w,null))}})},G=function(I){return D(P)(I)},R=function(I){var w=I.children,H=I.slot;return(w||G)(H)};return toolbar_min.MoreActionsPopover=A,toolbar_min.MoreIcon=b,toolbar_min.toolbarPlugin=function(I){var w=n.fullScreenPlugin(I?I.fullScreenPlugin:{}),H=r.getFilePlugin(I?I.getFilePlugin:{}),V=s.openPlugin(I?I.openPlugin:{}),te=a.pageNavigationPlugin(I?I.pageNavigationPlugin:{}),ae=l.printPlugin(I?I.printPlugin:{}),be=u.propertiesPlugin(),_e=d.rotatePlugin(),le=h.scrollModePlugin(),ue=p.searchPlugin(I?I.searchPlugin:{}),oe=e.selectionModePlugin(I?I.selectionModePlugin:{}),ee=m.themePlugin(),se=g.zoomPlugin(I?I.zoomPlugin:{}),re=[w,H,V,te,ae,be,_e,le,ue,oe,ee,se],fe=_.useCallback((function(pe){var Z=w.EnterFullScreen,ce=w.EnterFullScreenMenuItem,Ee=H.Download,Te=H.DownloadMenuItem,Ae=V.Open,Pe=V.OpenMenuItem,Me=te.CurrentPageInput,We=te.CurrentPageLabel,qe=te.GoToFirstPage,Je=te.GoToFirstPageMenuItem,wt=te.GoToLastPage,rt=te.GoToLastPageMenuItem,Lt=te.GoToNextPage,ln=te.GoToNextPageMenuItem,dt=te.GoToPreviousPage,st=te.GoToPreviousPageMenuItem,nt=te.NumberOfPages,dn=ae.Print,pn=ae.PrintMenuItem,An=be.ShowProperties,In=be.ShowPropertiesMenuItem,Jn=_e.Rotate,ri=_e.RotateBackwardMenuItem,Wn=_e.RotateForwardMenuItem,hi=le.SwitchScrollMode,ai=le.SwitchScrollModeMenuItem,Zn=le.SwitchViewMode,Ft=le.SwitchViewModeMenuItem,Xe=ue.Search,Ye=ue.ShowSearchPopover,xn=oe.SwitchSelectionMode,Vn=oe.SwitchSelectionModeMenuItem,Bn=ee.SwitchTheme,si=ee.SwitchThemeMenuItem,Yi=se.CurrentScale,ei=se.Zoom,oi=se.ZoomIn,Li=se.ZoomInMenuItem,xe=se.ZoomOut,Ce=se.ZoomOutMenuItem;return _.createElement(R,z({},pe,{slot:{CurrentPageInput:Me,CurrentPageLabel:We,CurrentScale:Yi,Download:Ee,DownloadMenuItem:Te,EnterFullScreen:Z,EnterFullScreenMenuItem:ce,GoToFirstPage:qe,GoToFirstPageMenuItem:Je,GoToLastPage:wt,GoToLastPageMenuItem:rt,GoToNextPage:Lt,GoToNextPageMenuItem:ln,GoToPreviousPage:dt,GoToPreviousPageMenuItem:st,NumberOfPages:nt,Open:Ae,OpenMenuItem:Pe,Print:dn,PrintMenuItem:pn,Rotate:Jn,RotateBackwardMenuItem:ri,RotateForwardMenuItem:Wn,Search:Xe,ShowProperties:An,ShowPropertiesMenuItem:In,ShowSearchPopover:Ye,SwitchScrollMode:hi,SwitchScrollModeMenuItem:ai,SwitchSelectionMode:xn,SwitchSelectionModeMenuItem:Vn,SwitchViewMode:Zn,SwitchViewModeMenuItem:Ft,SwitchTheme:Bn,SwitchThemeMenuItem:si,Zoom:ei,ZoomIn:oi,ZoomInMenuItem:Li,ZoomOut:xe,ZoomOutMenuItem:Ce}}))}),[]);return{fullScreenPluginInstance:w,getFilePluginInstance:H,openPluginInstance:V,pageNavigationPluginInstance:te,printPluginInstance:ae,propertiesPluginInstance:be,rotatePluginInstance:_e,scrollModePluginInstance:le,searchPluginInstance:ue,selectionModePluginInstance:oe,themePluginInstance:ee,zoomPluginInstance:se,install:function(pe){re.forEach((function(Z){Z.install&&Z.install(pe)}))},renderPageLayer:function(pe){return _.createElement(_.Fragment,null,re.map((function(Z,ce){return Z.renderPageLayer?_.createElement(_.Fragment,{key:ce},Z.renderPageLayer(pe)):_.createElement(_.Fragment,{key:ce})})))},renderViewer:function(pe){var Z=pe.slot;return re.forEach((function(ce){ce.renderViewer&&(Z=ce.renderViewer(z(z({},pe),{slot:Z})))})),Z},uninstall:function(pe){re.forEach((function(Z){Z.uninstall&&Z.uninstall(pe)}))},onDocumentLoad:function(pe){re.forEach((function(Z){Z.onDocumentLoad&&Z.onDocumentLoad(pe)}))},onAnnotationLayerRender:function(pe){re.forEach((function(Z){Z.onAnnotationLayerRender&&Z.onAnnotationLayerRender(pe)}))},onTextLayerRender:function(pe){re.forEach((function(Z){Z.onTextLayerRender&&Z.onTextLayerRender(pe)}))},onViewerStateChange:function(pe){var Z=pe;return re.forEach((function(ce){ce.onViewerStateChange&&(Z=ce.onViewerStateChange(Z))})),Z},renderDefaultToolbar:D,Toolbar:fe}},toolbar_min}var hasRequiredLib$1;function requireLib$1(){if(hasRequiredLib$1)return lib$c.exports;hasRequiredLib$1=1;return lib$c.exports=requireToolbar_min(),lib$c.exports}var hasRequiredDefaultLayout_min;function requireDefaultLayout_min(){if(hasRequiredDefaultLayout_min)return defaultLayout_min;hasRequiredDefaultLayout_min=1;var i=requireLib$h(),e=requireReact(),t=requireLib$g(),n=requireLib$f(),r=requireLib$e(),s=requireLib$1();function a(_){var b=Object.create(null);return _&&Object.keys(_).forEach((function(E){if(E!=="default"){var A=Object.getOwnPropertyDescriptor(_,E);Object.defineProperty(b,E,A.get?A:{enumerable:!0,get:function(){return _[E]}})}})),b.default=_,Object.freeze(b)}var l=a(e),u=function(){return l.createElement(i.Icon,{size:16},l.createElement("path",{d:`M11.5,1.5h11c0.552,0,1,0.448,1,1v20c0,0.552-0.448,1-1,1h-21c-0.552,0-1-0.448-1-1v-20c0-0.552,0.448-1,1-1h3
            M11.5,10.5c0,0.55-0.3,0.661-0.659,0.248L8,7.5l-2.844,3.246c-0.363,0.414-0.659,0.3-0.659-0.247v-9c0-0.552,0.448-1,1-1h5
            c0.552,0,1,0.448,1,1L11.5,10.5z
            M14.5,6.499h6
            M14.5,10.499h6
            M3.5,14.499h17
            M3.5,18.499h16.497`}))},d=function(){return d=Object.assign||function(_){for(var b,E=1,A=arguments.length;E<A;E++)for(var z in b=arguments[E])Object.prototype.hasOwnProperty.call(b,z)&&(_[z]=b[z]);return _},d.apply(this,arguments)},h=function(){return l.createElement(i.Icon,{size:16},l.createElement("path",{d:`M7.618,15.345l8.666-8.666c0.78-0.812,2.071-0.838,2.883-0.058s0.838,2.071,0.058,2.883
            c-0.019,0.02-0.038,0.039-0.058,0.058L7.461,21.305c-1.593,1.593-4.175,1.592-5.767,0s-1.592-4.175,0-5.767c0,0,0,0,0,0
            L13.928,3.305c2.189-2.19,5.739-2.19,7.929-0.001s2.19,5.739,0,7.929l0,0L13.192,19.9`}))},p=function(){return l.createElement(i.Icon,{size:16},l.createElement("path",{d:`M10.5,9.5c0,0.552-0.448,1-1,1h-8c-0.552,0-1-0.448-1-1v-8c0-0.552,0.448-1,1-1h8c0.552,0,1,0.448,1,1V9.5z
            M23.5,9.5c0,0.552-0.448,1-1,1h-8c-0.552,0-1-0.448-1-1v-8c0-0.552,0.448-1,1-1h8c0.552,0,1,0.448,1,1V9.5z
            M10.5,22.5 c0,0.552-0.448,1-1,1h-8c-0.552,0-1-0.448-1-1v-8c0-0.552,0.448-1,1-1h8c0.552,0,1,0.448,1,1V22.5z
            M23.5,22.5c0,0.552-0.448,1-1,1 h-8c-0.552,0-1-0.448-1-1v-8c0-0.552,0.448-1,1-1h8c0.552,0,1,0.448,1,1V22.5z`}))},m={left:8,top:0},g={left:-8,top:0},v=function(_){var b=_.attachmentTabContent,E=_.bookmarkTabContent,A=_.store,z=_.thumbnailTabContent,D=_.tabs,P=l.useRef(),G=l.useContext(i.LocalizationContext).l10n,R=l.useState(A.get("isCurrentTabOpened")||!1),I=R[0],w=R[1],H=l.useState(Math.max(A.get("currentTab")||0,0)),V=H[0],te=H[1],ae=l.useContext(i.ThemeContext).direction===i.TextDirection.RightToLeft,be=[{content:z,icon:l.createElement(p,null),title:G&&G.defaultLayout?G.defaultLayout.thumbnail:"Thumbnail"},{content:E,icon:l.createElement(u,null),title:G&&G.defaultLayout?G.defaultLayout.bookmark:"Bookmark"},{content:b,icon:l.createElement(h,null),title:G&&G.defaultLayout?G.defaultLayout.attachment:"Attachment"}],_e=D?D(be):be,le=function(oe){oe>=0&&oe<=_e.length-1&&(A.update("isCurrentTabOpened",!0),te(oe))},ue=function(oe){w(oe)};return l.useEffect((function(){return A.subscribe("currentTab",le),A.subscribe("isCurrentTabOpened",ue),function(){A.unsubscribe("currentTab",le),A.unsubscribe("isCurrentTabOpened",ue)}}),[]),_e.length===0?l.createElement(l.Fragment,null):l.createElement(l.Fragment,null,l.createElement("div",{"data-testid":"default-layout__sidebar",className:i.classNames({"rpv-default-layout__sidebar":!0,"rpv-default-layout__sidebar--opened":I,"rpv-default-layout__sidebar--ltr":!ae,"rpv-default-layout__sidebar--rtl":ae}),ref:P},l.createElement("div",{className:"rpv-default-layout__sidebar-tabs"},l.createElement("div",{className:"rpv-default-layout__sidebar-headers",role:"tablist","aria-orientation":"vertical"},_e.map((function(oe,ee){return l.createElement("div",{"aria-controls":"rpv-default-layout__sidebar-content","aria-selected":V===ee,key:ee,className:"rpv-default-layout__sidebar-header",id:"rpv-default-layout__sidebar-tab-".concat(ee),role:"tab"},l.createElement(i.Tooltip,{ariaControlsSuffix:"default-layout-sidebar-tab-".concat(ee),position:ae?i.Position.LeftCenter:i.Position.RightCenter,target:l.createElement(i.MinimalButton,{ariaLabel:oe.title,isSelected:V===ee,onClick:function(){return(function(se){if(V===se){A.update("isCurrentTabOpened",!A.get("isCurrentTabOpened"));var re=P.current;re&&re.style.width&&re.style.removeProperty("width")}else A.update("currentTab",se)})(ee)}},oe.icon),content:function(){return oe.title},offset:ae?g:m}))}))),l.createElement("div",{"aria-labelledby":"rpv-default-layout__sidebar-tab-".concat(V),id:"rpv-default-layout__sidebar-content",className:i.classNames({"rpv-default-layout__sidebar-content":!0,"rpv-default-layout__sidebar-content--opened":I,"rpv-default-layout__sidebar-content--ltr":!ae,"rpv-default-layout__sidebar-content--rtl":ae}),role:"tabpanel",tabIndex:-1},_e[V].content))),I&&l.createElement(i.Splitter,{constrain:function(oe){return oe.firstHalfPercentage>=20&&oe.firstHalfPercentage<=80}}))};return defaultLayout_min.BookmarkIcon=u,defaultLayout_min.FileIcon=h,defaultLayout_min.ThumbnailIcon=p,defaultLayout_min.defaultLayoutPlugin=function(_){var b=l.useMemo((function(){return i.createStore({isCurrentTabOpened:!1,currentTab:0})}),[]),E=t.attachmentPlugin(),A=n.bookmarkPlugin(),z=r.thumbnailPlugin(_?_.thumbnailPlugin:{}),D=s.toolbarPlugin(_?_.toolbarPlugin:{}),P=E.Attachments,G=A.Bookmarks,R=z.Thumbnails,I=D.Toolbar,w=_?_.sidebarTabs:function(V){return V},H=[E,A,z,D];return{attachmentPluginInstance:E,bookmarkPluginInstance:A,thumbnailPluginInstance:z,toolbarPluginInstance:D,activateTab:function(V){b.update("currentTab",V)},toggleTab:function(V){var te=b.get("currentTab");b.update("isCurrentTabOpened",!b.get("isCurrentTabOpened")),te!==V&&b.update("currentTab",V)},install:function(V){H.forEach((function(te){te.install&&te.install(V)}))},renderPageLayer:function(V){return l.createElement(l.Fragment,null,H.map((function(te,ae){return te.renderPageLayer?l.createElement(l.Fragment,{key:ae},te.renderPageLayer(V)):l.createElement(l.Fragment,{key:ae},l.createElement(l.Fragment,null))})))},renderViewer:function(V){var te=V.slot;H.forEach((function(be){be.renderViewer&&(te=be.renderViewer(d(d({},V),{slot:te})))}));var ae=te.subSlot&&te.subSlot.attrs?{className:te.subSlot.attrs.className,"data-testid":te.subSlot.attrs["data-testid"],ref:te.subSlot.attrs.ref,style:te.subSlot.attrs.style}:{};return te.children=l.createElement("div",{className:"rpv-default-layout__container"},l.createElement("div",{"data-testid":"default-layout__main",className:i.classNames({"rpv-default-layout__main":!0,"rpv-default-layout__main--rtl":V.themeContext.direction===i.TextDirection.RightToLeft})},l.createElement(v,{attachmentTabContent:l.createElement(P,null),bookmarkTabContent:l.createElement(G,null),store:b,thumbnailTabContent:l.createElement(R,null),tabs:w}),l.createElement("div",{className:"rpv-default-layout__body","data-testid":"default-layout__body"},l.createElement("div",{className:"rpv-default-layout__toolbar"},_&&_.renderToolbar?_.renderToolbar(I):l.createElement(I,null)),l.createElement("div",d({},ae),te.subSlot.children))),te.children),te.subSlot.attrs={},te.subSlot.children=l.createElement(l.Fragment,null),te},uninstall:function(V){H.forEach((function(te){te.uninstall&&te.uninstall(V)}))},onDocumentLoad:function(V){H.forEach((function(te){te.onDocumentLoad&&te.onDocumentLoad(V)})),_&&_.setInitialTab&&_.setInitialTab(V.doc).then((function(te){b.update("currentTab",te),b.update("isCurrentTabOpened",!0)}))},onAnnotationLayerRender:function(V){H.forEach((function(te){te.onAnnotationLayerRender&&te.onAnnotationLayerRender(V)}))},onTextLayerRender:function(V){H.forEach((function(te){te.onTextLayerRender&&te.onTextLayerRender(V)}))},onViewerStateChange:function(V){var te=V;return H.forEach((function(ae){ae.onViewerStateChange&&(te=ae.onViewerStateChange(te))})),te}}},defaultLayout_min.setInitialTabFromPageMode=function(_){return new Promise((function(b,E){_.getPageMode().then((function(A){if(A)switch(A){case i.PageMode.Attachments:b(2);break;case i.PageMode.Bookmarks:b(1);break;case i.PageMode.Thumbnails:b(0);break;default:b(-1)}else b(-1)}))}))},defaultLayout_min}var hasRequiredLib;function requireLib(){if(hasRequiredLib)return lib$g.exports;hasRequiredLib=1;return lib$g.exports=requireDefaultLayout_min(),lib$g.exports}var libExports=requireLib();const ViewNotes=()=>{const i=useLocation(),e=useNavigate(),{note:t}=i.state||{},n=libExports.defaultLayoutPlugin();return!t||!t.notesUrl?jsxRuntimeExports.jsxs("div",{className:"p-10 text-center",children:[jsxRuntimeExports.jsx("p",{children:"PDF file not found."}),jsxRuntimeExports.jsx("button",{onClick:()=>e(-1),className:"text-blue-600 underline mt-4",children:"Go Back"})]}):jsxRuntimeExports.jsxs("div",{className:"h-screen bg-slate-100 flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 border-b flex justify-between items-center shadow-sm z-10",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>e(-1),className:"p-2 hover:bg-gray-100 rounded-full transition",children:jsxRuntimeExports.jsx(ArrowLeft,{size:20})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-bold text-sm md:text-lg line-clamp-1",children:t.title}),jsxRuntimeExports.jsx("p",{className:"text-[10px] text-gray-400 font-bold uppercase",children:t.subject})]})]}),jsxRuntimeExports.jsxs("a",{href:t.notesUrl,target:"_blank",rel:"noreferrer",className:"bg-blue-600 text-white p-2 md:px-4 md:py-2 rounded-lg flex items-center gap-2 text-sm font-bold shadow-md hover:bg-blue-700 transition",children:[jsxRuntimeExports.jsx(Download,{size:18})," ",jsxRuntimeExports.jsx("span",{className:"hidden md:inline",children:"Download"})]})]}),jsxRuntimeExports.jsx(libExports$1.Worker,{workerUrl:"https://unpkg.com/pdfjs-dist@3.4.120/build/pdf.worker.min.js",children:jsxRuntimeExports.jsx("div",{className:"h-full flex flex-col items-center justify-center bg-gray-50",children:jsxRuntimeExports.jsx(libExports$1.Viewer,{fileUrl:t.notesUrl,plugins:[n],renderError:r=>jsxRuntimeExports.jsxs("div",{className:"text-center p-10",children:[jsxRuntimeExports.jsx("p",{className:"text-red-500 font-bold mb-4",children:"Cannot display PDF directly due to security restrictions."}),jsxRuntimeExports.jsx("a",{href:t.notesUrl,target:"_blank",className:"bg-blue-600 text-white px-6 py-2 rounded-lg font-bold",children:"Open PDF in New Tab"})]})})})}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-hidden",children:jsxRuntimeExports.jsx(libExports$1.Worker,{workerUrl:"https://unpkg.com/pdfjs-dist@3.4.120/build/pdf.worker.min.js",children:jsxRuntimeExports.jsx(libExports$1.Viewer,{fileUrl:t.notesUrl,plugins:[n]})})})]})},Dashboard=()=>{const[i,e]=reactExports.useState({students:0,batches:0,videos:0,revenue:0}),[t,n]=reactExports.useState(!0);return reactExports.useEffect(()=>{(async()=>{try{const s=await getCountFromServer(collection(db,"users")),a=await getCountFromServer(collection(db,"batches")),l=await getCountFromServer(collection(db,"contents"));e({students:s.data().count,batches:a.data().count,videos:l.data().count,revenue:s.data().count*499})}catch(s){console.error("Error fetching stats:",s)}n(!1)})()},[]),t?jsxRuntimeExports.jsx("div",{className:"p-10",children:"Loading Dashboard..."}):jsxRuntimeExports.jsxs("div",{className:"p-6 space-y-6",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Admin Dashboard"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-blue-100 p-3 rounded-full text-blue-600",children:jsxRuntimeExports.jsx(Users,{size:28})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"Total Students"}),jsxRuntimeExports.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:i.students})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-purple-100 p-3 rounded-full text-purple-600",children:jsxRuntimeExports.jsx(BookOpen,{size:28})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"Active Batches"}),jsxRuntimeExports.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:i.batches})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-red-100 p-3 rounded-full text-red-600",children:jsxRuntimeExports.jsx(Video,{size:28})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"Videos & Notes"}),jsxRuntimeExports.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:i.videos})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-green-100 p-3 rounded-full text-green-600",children:jsxRuntimeExports.jsx(IndianRupee,{size:28})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"Est. Revenue"}),jsxRuntimeExports.jsxs("h3",{className:"text-2xl font-bold text-gray-900",children:["",i.revenue]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border",children:[jsxRuntimeExports.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(TrendingUp,{size:20,className:"text-blue-500"})," Growth"]}),jsxRuntimeExports.jsx("div",{className:"h-40 bg-gray-50 rounded-xl flex items-center justify-center text-gray-400",children:"Chart Placeholder (Recharts Integration)"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-lg mb-4",children:"Quick Actions"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{className:"w-full text-left p-3 hover:bg-gray-50 rounded-lg border flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{children:"Create New Announcement"}),jsxRuntimeExports.jsx("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded",children:"Action"})]}),jsxRuntimeExports.jsxs("button",{className:"w-full text-left p-3 hover:bg-gray-50 rounded-lg border flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{children:"Review New Doubts"}),jsxRuntimeExports.jsx("span",{className:"text-xs bg-red-100 text-red-600 px-2 py-1 rounded",children:"5 Pending"})]})]})]})]})]})},Batches=()=>{const i=useNavigate(),[e,t]=reactExports.useState([]),[n,r]=reactExports.useState(!1),[s,a]=reactExports.useState({name:"",description:"",price:"",thumbnail:"",demoVideo:"",subject:"General"}),l=async()=>{const h=await getDocs(collection(db,"batches"));t(h.docs.map(p=>({id:p.id,...p.data()})))};reactExports.useEffect(()=>{l()},[]);const u=async h=>{if(h.preventDefault(),!s.name||!s.price)return alert("Name and Price are required!");try{await addDoc(collection(db,"batches"),{...s,createdAt:new Date,price:Number(s.price)}),r(!1),a({name:"",description:"",price:"",thumbnail:"",demoVideo:"",subject:"General"}),l()}catch(p){console.error(p),alert("Error creating batch")}},d=async h=>{confirm("Delete this batch? All content will be lost!")&&(await deleteDoc(doc(db,"batches",h)),l())};return jsxRuntimeExports.jsxs("div",{className:"p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-6",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Manage Batches"}),jsxRuntimeExports.jsxs("button",{onClick:()=>r(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700",children:[jsxRuntimeExports.jsx(Plus,{size:20})," Create Batch"]})]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(h=>jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow border overflow-hidden group",children:[jsxRuntimeExports.jsxs("div",{className:"h-32 bg-gray-200 relative",children:[jsxRuntimeExports.jsx("img",{src:h.thumbnail||`https://ui-avatars.com/api/?name=${h.name}`,className:"w-full h-full object-cover"}),jsxRuntimeExports.jsxs("div",{className:"absolute top-2 right-2 bg-white px-2 py-1 rounded text-xs font-bold shadow",children:["",h.price]})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-lg mb-1",children:h.name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 mb-4 line-clamp-2",children:h.description||"No description"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>i(`/admin/batch/${h.id}/content`),className:"flex-1 bg-blue-50 text-blue-600 py-2 rounded-lg text-sm font-bold hover:bg-blue-100",children:"Manage Content"}),jsxRuntimeExports.jsx("button",{onClick:()=>i(`/admin/batch/${h.id}/notices`),className:"p-2 text-orange-500 bg-orange-50 hover:bg-orange-100 rounded-lg",title:"Manage Notices",children:jsxRuntimeExports.jsx(Bell,{size:20})}),jsxRuntimeExports.jsx("button",{onClick:()=>i(`/admin/batch/${h.id}/tests`),className:"p-2 text-purple-500 bg-purple-50 hover:bg-purple-100 rounded-lg",title:"Manage Tests",children:jsxRuntimeExports.jsx(FileText,{size:20})}),jsxRuntimeExports.jsx("button",{onClick:()=>d(h.id),className:"p-2 text-red-500 bg-red-50 hover:bg-red-100 rounded-lg",children:jsxRuntimeExports.jsx(Trash2,{size:20})})]})]})]},h.id))}),n&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white p-6 rounded-xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold mb-4",children:"Create New Batch"}),jsxRuntimeExports.jsxs("form",{onSubmit:u,className:"space-y-4",children:[jsxRuntimeExports.jsx("input",{required:!0,placeholder:"Batch Name",className:"w-full border p-2 rounded",value:s.name,onChange:h=>a({...s,name:h.target.value})}),jsxRuntimeExports.jsx("textarea",{placeholder:"Description",className:"w-full border p-2 rounded",value:s.description,onChange:h=>a({...s,description:h.target.value})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Price ()"}),jsxRuntimeExports.jsx("input",{required:!0,type:"number",className:"w-full border p-2 rounded",value:s.price,onChange:h=>a({...s,price:h.target.value})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("label",{className:"text-xs font-bold text-gray-500",children:"Subject Tag"}),jsxRuntimeExports.jsx("input",{className:"w-full border p-2 rounded",value:s.subject,onChange:h=>a({...s,subject:h.target.value})})]})]}),jsxRuntimeExports.jsx("input",{placeholder:"Thumbnail URL",className:"w-full border p-2 rounded",value:s.thumbnail,onChange:h=>a({...s,thumbnail:h.target.value})}),jsxRuntimeExports.jsx("input",{placeholder:"Demo Video URL (YouTube)",className:"w-full border p-2 rounded",value:s.demoVideo,onChange:h=>a({...s,demoVideo:h.target.value})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3 mt-6",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>r(!1),className:"flex-1 py-2 text-gray-500 font-bold",children:"Cancel"}),jsxRuntimeExports.jsx("button",{className:"flex-1 bg-blue-600 text-white py-2 rounded-lg font-bold",children:"Create Batch"})]})]})]})})]})},StudentAnalytics=()=>{const[i,e]=reactExports.useState([]),[t,n]=reactExports.useState([]),[r,s]=reactExports.useState(""),[a,l]=reactExports.useState(!0),[u,d]=reactExports.useState(null),[h,p]=reactExports.useState(""),m=async()=>{try{const z=(await getDocs(collection(db,"users"))).docs.map(G=>({id:G.id,...G.data()}));e(z);const P=(await getDocs(collection(db,"batches"))).docs.map(G=>({id:G.id,name:G.data().name}));n(P)}catch(A){console.error("Error fetching data:",A)}l(!1)};reactExports.useEffect(()=>{m()},[]);const g=async()=>{if(!(!h||!u))try{const A=doc(db,"users",u.id);await updateDoc(A,{enrolledBatches:arrayUnion(h)}),alert("Batch Assigned Successfully! "),p(""),d(null),m()}catch(A){console.error(A),alert("Failed to assign batch.")}},v=async(A,z)=>{if(confirm("Are you sure you want to remove this course from the student?"))try{const D=doc(db,"users",A);await updateDoc(D,{enrolledBatches:arrayRemove(z)}),alert("Student Unenrolled from Batch! "),d(null),m()}catch(D){console.error(D),alert("Failed to remove batch.")}},_=async A=>{if(confirm(" DANGER: Are you sure you want to DELETE this student permanently?"))try{await deleteDoc(doc(db,"users",A)),alert("Student Deleted Successfully! "),d(null),m()}catch(z){console.error(z),alert("Failed to delete student.")}},b=A=>{const z=t.find(D=>D.id===A);return z?z.name:"Unknown Batch"},E=i.filter(A=>A.name?.toLowerCase().includes(r.toLowerCase())||A.email?.toLowerCase().includes(r.toLowerCase()));return a?jsxRuntimeExports.jsx("div",{className:"p-10",children:"Loading Data..."}):jsxRuntimeExports.jsxs("div",{className:"p-6 min-h-screen bg-slate-50",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Student Management"}),jsxRuntimeExports.jsxs("p",{className:"text-gray-500 text-sm",children:["Total Students: ",i.length]})]}),jsxRuntimeExports.jsxs("div",{className:"relative w-full md:w-80",children:[jsxRuntimeExports.jsx(Search,{className:"absolute left-3 top-3 text-gray-400",size:18}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search student...",className:"w-full pl-10 pr-4 py-2 rounded-xl border focus:outline-none focus:ring-2 focus:ring-blue-500",value:r,onChange:A=>s(A.target.value)})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"w-full text-left border-collapse",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{className:"bg-gray-50 text-gray-600 text-sm uppercase tracking-wider",children:[jsxRuntimeExports.jsx("th",{className:"p-4 font-bold border-b",children:"Student"}),jsxRuntimeExports.jsx("th",{className:"p-4 font-bold border-b text-center",children:"Courses"}),jsxRuntimeExports.jsx("th",{className:"p-4 font-bold border-b text-center",children:"Action"})]})}),jsxRuntimeExports.jsx("tbody",{className:"divide-y divide-gray-100",children:E.length>0?E.map(A=>jsxRuntimeExports.jsxs("tr",{className:"hover:bg-blue-50/50 transition",children:[jsxRuntimeExports.jsx("td",{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold",children:A.name?.charAt(0)||"U"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-gray-800",children:A.name||"Unknown"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:A.email})]})]})}),jsxRuntimeExports.jsx("td",{className:"p-4 text-center",children:jsxRuntimeExports.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${A.enrolledBatches?.length>0?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:[A.enrolledBatches?.length||0," Active"]})}),jsxRuntimeExports.jsx("td",{className:"p-4 text-center",children:jsxRuntimeExports.jsxs("button",{onClick:()=>d(A),className:"bg-blue-50 text-blue-600 px-3 py-1.5 rounded-lg text-sm font-bold hover:bg-blue-100 flex items-center gap-2 mx-auto",children:[jsxRuntimeExports.jsx(Settings,{size:16})," Manage"]})})]},A.id)):jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsx("td",{colSpan:"3",className:"p-8 text-center text-gray-400",children:"No students found."})})})]})})}),u&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white p-6 rounded-xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-6 border-b pb-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Manage Student"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-500",children:[u.name," (",u.email,")"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>d(null),className:"text-gray-400 hover:text-black",children:jsxRuntimeExports.jsx(X,{})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-3",children:"Enrolled Courses"}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:u.enrolledBatches?.length>0?u.enrolledBatches.map(A=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center bg-gray-50 p-3 rounded-lg border",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-700",children:b(A)}),jsxRuntimeExports.jsx("button",{onClick:()=>v(u.id,A),className:"text-red-500 hover:bg-red-50 p-1.5 rounded-full",title:"Remove Course",children:jsxRuntimeExports.jsx(X,{size:18})})]},A)):jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-400 italic",children:"Not enrolled in any course."})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-8",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-3",children:"Assign New Course"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsxs("select",{className:"w-full border p-2 rounded-lg",value:h,onChange:A=>p(A.target.value),children:[jsxRuntimeExports.jsx("option",{value:"",children:"Select a Batch..."}),t.map(A=>!u.enrolledBatches?.includes(A.id)&&jsxRuntimeExports.jsx("option",{value:A.id,children:A.name},A.id))]}),jsxRuntimeExports.jsx("button",{onClick:g,className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700",children:"Assign"})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-red-50 p-4 rounded-xl border border-red-100 mt-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-red-800 font-bold text-sm mb-1",children:"Danger Zone"}),jsxRuntimeExports.jsx("p",{className:"text-red-600 text-xs mb-3",children:"This action cannot be undone. This will permanently delete the student data."}),jsxRuntimeExports.jsxs("button",{onClick:()=>_(u.id),className:"w-full bg-white border border-red-200 text-red-600 py-2 rounded-lg font-bold hover:bg-red-600 hover:text-white transition",children:[jsxRuntimeExports.jsx(Trash2,{size:16,className:"inline mr-2"})," Delete Student"]})]})]})})]})},BatchContent=()=>{const{batchId:i}=useParams(),e=useNavigate(),[t,n]=reactExports.useState([]),[r,s]=reactExports.useState(!1),[a,l]=reactExports.useState({title:"",type:"video",url:"",notesUrl:"",slidesUrl:"",subject:"",chapter:""}),u=async()=>{const p=query(collection(db,"contents"),where("batchId","==",i)),m=await getDocs(p);n(m.docs.map(g=>({id:g.id,...g.data()})))};reactExports.useEffect(()=>{u()},[i]);const d=async p=>{if(p.preventDefault(),!a.subject||!a.chapter)return alert("Subject and Chapter are required for folders!");await addDoc(collection(db,"contents"),{...a,batchId:i,createdAt:new Date}),s(!1),l({title:"",type:"video",url:"",notesUrl:"",slidesUrl:"",subject:"",chapter:""}),u()},h=async p=>{confirm("Delete this content?")&&(await deleteDoc(doc(db,"contents",p)),u())};return jsxRuntimeExports.jsxs("div",{className:"p-6 bg-slate-50 min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between mb-6",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>e(-1),className:"flex items-center gap-2 font-bold",children:[jsxRuntimeExports.jsx(ArrowLeft,{})," Back"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>s(!0),className:"bg-blue-600 text-white px-4 py-2 rounded flex gap-2",children:[jsxRuntimeExports.jsx(Plus,{})," Add Content"]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-4",children:t.map(p=>jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded border flex justify-between items-center",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:`p-3 rounded ${p.type==="video"?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600"}`,children:p.type==="video"?jsxRuntimeExports.jsx(Video,{}):jsxRuntimeExports.jsx(FileText,{})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-bold",children:p.title}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500 font-bold bg-gray-100 inline-block px-2 py-0.5 rounded mt-1",children:[p.subject," > ",p.chapter]})]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>h(p.id),className:"text-red-500 p-2",children:jsxRuntimeExports.jsx(Trash2,{})})]},p.id))}),r&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white p-6 rounded-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[jsxRuntimeExports.jsx("h2",{className:"font-bold text-xl mb-4",children:"Add Content"}),jsxRuntimeExports.jsxs("form",{onSubmit:d,className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[jsxRuntimeExports.jsxs("select",{className:"border p-2 rounded",value:a.type,onChange:p=>l({...a,type:p.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"video",children:"Video"}),jsxRuntimeExports.jsx("option",{value:"note",children:"Note Only"})]}),jsxRuntimeExports.jsx("input",{required:!0,placeholder:"Subject (e.g. Physics)",className:"border p-2 rounded",value:a.subject,onChange:p=>l({...a,subject:p.target.value})})]}),jsxRuntimeExports.jsx("input",{required:!0,placeholder:"Chapter Name (e.g. Thermodynamics)",className:"border p-2 w-full rounded",value:a.chapter,onChange:p=>l({...a,chapter:p.target.value})}),jsxRuntimeExports.jsx("input",{required:!0,placeholder:"Content Title (e.g. Lecture 01)",className:"border p-2 w-full rounded",value:a.title,onChange:p=>l({...a,title:p.target.value})}),a.type==="video"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("input",{required:!0,placeholder:"Video URL (YouTube)",className:"border p-2 w-full rounded",value:a.url,onChange:p=>l({...a,url:p.target.value})}),jsxRuntimeExports.jsx("input",{placeholder:"Notes PDF URL (Optional)",className:"border p-2 w-full rounded text-sm",value:a.notesUrl,onChange:p=>l({...a,notesUrl:p.target.value})})]}),a.type==="note"&&jsxRuntimeExports.jsx("input",{required:!0,placeholder:"PDF URL",className:"border p-2 w-full rounded",value:a.notesUrl,onChange:p=>l({...a,notesUrl:p.target.value})}),jsxRuntimeExports.jsx("button",{className:"bg-blue-600 text-white w-full py-2 rounded mt-4",children:"Add Content"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>s(!1),className:"w-full py-2 text-gray-500",children:"Cancel"})]})]})})]})},StudentHome=()=>{const i=useNavigate(),[e,t]=reactExports.useState([]),n=auth.currentUser?.displayName||"Student";return reactExports.useEffect(()=>{(async()=>{const a=(await getDocs(collection(db,"batches"))).docs.map(l=>({id:l.id,...l.data()}));t(a)})()},[]),jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-6 text-white shadow-lg",children:[jsxRuntimeExports.jsxs("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:["Hello, ",n,"! "]}),jsxRuntimeExports.jsx("p",{className:"opacity-90",children:"Let's start learning today."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Explore Courses"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:e.map(r=>jsxRuntimeExports.jsxs("div",{onClick:()=>i(`/student/course/${r.id}`),className:"bg-white rounded-xl border hover:shadow-xl transition cursor-pointer overflow-hidden group flex flex-col h-full",children:[jsxRuntimeExports.jsxs("div",{className:"h-40 bg-gray-200 relative",children:[jsxRuntimeExports.jsx("img",{src:r.thumbnail||`https://ui-avatars.com/api/?name=${r.name}&background=random&size=400`,alt:r.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}),jsxRuntimeExports.jsxs("div",{className:"absolute top-2 right-2 bg-white/90 backdrop-blur text-black font-bold px-3 py-1 rounded-full text-xs shadow flex items-center gap-1",children:[jsxRuntimeExports.jsx(IndianRupee,{size:12}),r.price?r.price:"Free"]}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/10 group-hover:bg-black/20 transition flex items-center justify-center",children:jsxRuntimeExports.jsx(CirclePlay,{className:"text-white opacity-0 group-hover:opacity-100 transform scale-75 group-hover:scale-100 transition duration-300 drop-shadow-lg",size:48})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 flex flex-col flex-1",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-between items-start mb-2",children:jsxRuntimeExports.jsx("span",{className:"text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded uppercase tracking-wider",children:r.subject||"Course"})}),jsxRuntimeExports.jsx("h3",{className:"font-bold text-lg text-gray-800 line-clamp-1 mb-1",children:r.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 line-clamp-2 mb-4 flex-1",children:r.description||"No description available for this course."}),jsxRuntimeExports.jsxs("div",{className:"border-t pt-3 flex justify-between items-center text-xs text-gray-400",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx(Clock,{size:14})," ",jsxRuntimeExports.jsx("span",{children:"Self Paced"})]}),jsxRuntimeExports.jsx("button",{className:"text-blue-600 font-bold hover:underline",children:"View Course"})]})]})]},r.id))})]})]})},CourseDetail=()=>{const{id:i}=useParams(),e=useNavigate(),t=auth.currentUser,[n,r]=reactExports.useState(null),[s,a]=reactExports.useState([]),[l,u]=reactExports.useState([]),[d,h]=reactExports.useState([]),[p,m]=reactExports.useState("subjects"),[g,v]=reactExports.useState(!1),[_,b]=reactExports.useState(!1),[E,A]=reactExports.useState(!1);reactExports.useEffect(()=>{(async()=>{try{const P=await getDoc(doc(db,"batches",i));P.exists()&&r(P.data());const G=query(collection(db,"contents"),where("batchId","==",i)),I=(await getDocs(G)).docs.map(H=>H.data()),w=[...new Set(I.map(H=>H.subject||"General"))];if(a(w),t){const H=await getDoc(doc(db,"users",t.uid));if(H.exists()){const V=H.data();V.enrolledBatches&&V.enrolledBatches.includes(i)&&b(!0)}}}catch(P){console.error("Error fetching details:",P)}})()},[i,t]),reactExports.useEffect(()=>{(async()=>{if(p==="notices")try{const P=query(collection(db,"notices"),where("batchId","==",i),orderBy("createdAt","desc")),G=await getDocs(P);u(G.docs.map(R=>({id:R.id,...R.data()})))}catch(P){console.error("Notices Error:",P)}else if(p==="tests")try{const P=query(collection(db,"tests"),where("batchId","==",i)),G=await getDocs(P);h(G.docs.map(R=>({id:R.id,...R.data()})))}catch(P){console.error("Tests Error:",P)}})()},[p,i]);const z=async()=>{if(!t)return alert("Please Login first!");if(confirm(`Buy this course for ${n.price}?`)){A(!0);try{const D=doc(db,"users",t.uid);await setDoc(D,{enrolledBatches:arrayUnion(i)},{merge:!0}),b(!0),alert("Enrollment Successful!  You can now access all content.")}catch(D){console.error("Buy Error:",D),alert("Failed to enroll.")}A(!1)}};return n?jsxRuntimeExports.jsxs("div",{className:"max-w-4xl mx-auto min-h-screen pb-20 bg-slate-50",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white shadow-sm border-b mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>e("/student/home"),className:"p-2 hover:bg-gray-100 rounded-full",children:jsxRuntimeExports.jsx(ArrowLeft,{size:20})}),jsxRuntimeExports.jsx("h1",{className:"font-bold text-lg line-clamp-1",children:n.name})]}),jsxRuntimeExports.jsx("div",{className:"w-full aspect-video bg-black relative",children:g?n.demoVideo?jsxRuntimeExports.jsxs("div",{className:"relative w-full h-full",children:[jsxRuntimeExports.jsx(MyVideoPlayer,{videoUrl:n.demoVideo}),jsxRuntimeExports.jsx("button",{onClick:()=>v(!1),className:"absolute top-2 right-2 bg-black/50 text-white p-1 rounded-full z-50 hover:bg-red-600 transition",children:jsxRuntimeExports.jsx(X,{size:20})})]}):jsxRuntimeExports.jsxs("div",{className:"w-full h-full flex items-center justify-center text-white flex-col gap-2",children:[jsxRuntimeExports.jsx("p",{children:"No Demo Video Available"}),jsxRuntimeExports.jsx("button",{onClick:()=>v(!1),className:"text-blue-400 underline",children:"Close"})]}):jsxRuntimeExports.jsxs("div",{className:"w-full h-full relative",children:[jsxRuntimeExports.jsx("img",{src:n.thumbnail||`https://ui-avatars.com/api/?name=${n.name}&size=400`,className:"w-full h-full object-cover opacity-90",alt:"Thumbnail"}),jsxRuntimeExports.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent flex flex-col justify-end p-6",children:[n.demoVideo&&jsxRuntimeExports.jsx("button",{onClick:()=>v(!0),className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white/20 backdrop-blur-md border border-white/50 text-white rounded-full p-4 hover:scale-110 transition animate-pulse",children:jsxRuntimeExports.jsx(CirclePlay,{size:48,fill:"currentColor",className:"text-white"})}),jsxRuntimeExports.jsx("div",{className:"text-white",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-end",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"bg-blue-600 text-xs font-bold px-2 py-1 rounded mb-2 inline-block",children:n.subject||"Course"}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold mb-1",children:n.name})]}),jsxRuntimeExports.jsx("div",{className:"text-right",children:jsxRuntimeExports.jsxs("p",{className:"text-xl font-bold text-green-400",children:["",n.price||"Free"]})})]})})]})]})}),jsxRuntimeExports.jsxs("div",{className:"p-4 bg-white border-t flex justify-between items-center",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Validity: Lifetime"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-bold text-gray-800",children:"Complete Access"})]}),_?jsxRuntimeExports.jsxs("button",{disabled:!0,className:"bg-green-100 text-green-700 px-6 py-2 rounded-lg font-bold flex items-center gap-2 cursor-default",children:[jsxRuntimeExports.jsx(CircleCheckBig,{size:20})," Enrolled"]}):jsxRuntimeExports.jsx("button",{onClick:z,disabled:E,className:"bg-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-blue-700 shadow-lg active:scale-95 transition disabled:opacity-70",children:E?"Processing...":"Buy Now"})]})]}),jsxRuntimeExports.jsx("div",{className:"px-4 sticky top-0 z-10 bg-slate-50 pt-2 pb-4",children:jsxRuntimeExports.jsx("div",{className:"flex bg-white rounded-xl shadow-sm p-1 border",children:["subjects","tests","notices"].map(D=>jsxRuntimeExports.jsx("button",{onClick:()=>m(D),className:`flex-1 py-2 text-sm font-bold rounded-lg capitalize transition ${p===D?"bg-blue-600 text-white shadow":"text-gray-500 hover:bg-gray-50"}`,children:D},D))})}),jsxRuntimeExports.jsxs("div",{className:"px-4",children:[p==="subjects"&&jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:s.length>0?s.map((D,P)=>jsxRuntimeExports.jsxs("div",{onClick:()=>e(`/student/course/${i}/subject/${D}`),className:"bg-white p-5 rounded-xl border hover:shadow-lg transition cursor-pointer flex flex-col items-center gap-3 text-center group",children:[jsxRuntimeExports.jsx("div",{className:"bg-blue-50 p-4 rounded-full text-blue-600 group-hover:bg-blue-600 group-hover:text-white transition duration-300",children:_?jsxRuntimeExports.jsx(Folder,{size:28,fill:"currentColor"}):jsxRuntimeExports.jsx(Lock,{size:28})}),jsxRuntimeExports.jsx("h3",{className:"font-bold text-gray-800",children:D}),jsxRuntimeExports.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"View Chapters"})]},P)):jsxRuntimeExports.jsx("div",{className:"col-span-2 text-center py-10 text-gray-400 border border-dashed rounded-xl bg-white",children:"No subjects uploaded."})}),p==="tests"&&jsxRuntimeExports.jsx("div",{className:"space-y-4",children:d.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-10 text-gray-500 bg-white rounded-xl border border-dashed",children:[jsxRuntimeExports.jsx(FileText,{size:40,className:"mx-auto mb-2 opacity-20"}),jsxRuntimeExports.jsx("p",{children:"No tests available yet."})]}):d.map(D=>jsxRuntimeExports.jsxs("div",{className:"bg-white p-5 rounded-xl border hover:shadow-md transition flex flex-col md:flex-row justify-between items-start md:items-center gap-4 group",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:`p-3 rounded-full shrink-0 ${_?"bg-purple-100 text-purple-600":"bg-gray-100 text-gray-400"}`,children:_?jsxRuntimeExports.jsx(FileText,{size:24}):jsxRuntimeExports.jsx(Lock,{size:24})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:D.title}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 mt-1",children:[jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-1",children:[jsxRuntimeExports.jsx(Clock,{size:12})," ",D.duration," Mins"]}),jsxRuntimeExports.jsx("span",{children:""}),jsxRuntimeExports.jsxs("span",{children:["Marks: ",D.totalMarks]})]})]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{if(!_)return alert(" This test is locked. Please buy the course first.");e(`/student/test/${D.id}`)},className:`w-full md:w-auto px-6 py-2 rounded-lg font-bold text-sm transition ${_?"bg-purple-600 text-white hover:bg-purple-700 shadow-md active:scale-95":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:_?"Start Test":"Locked"})]},D.id))}),p==="notices"&&jsxRuntimeExports.jsx("div",{className:"space-y-4",children:l.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-10 text-gray-500 bg-white rounded-xl border border-dashed",children:[jsxRuntimeExports.jsx(Bell,{size:40,className:"mx-auto mb-2 opacity-20"}),jsxRuntimeExports.jsx("p",{children:"No new announcements."})]}):l.map(D=>jsxRuntimeExports.jsxs("div",{className:"bg-white p-5 rounded-xl border border-l-4 border-l-blue-500 shadow-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:D.title}),jsxRuntimeExports.jsx("span",{className:"text-[10px] text-gray-500 bg-gray-100 px-2 py-1 rounded whitespace-nowrap",children:D.createdAt?.seconds?new Date(D.createdAt.seconds*1e3).toLocaleDateString():"Just now"})]}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm leading-relaxed whitespace-pre-wrap",children:D.message})]},D.id))})]})]}):jsxRuntimeExports.jsx("div",{className:"p-10 text-center",children:"Loading Course..."})},isNodeJS=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0],LINE_FACTOR=1.35,RenderingIntentFlag={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},AnnotationMode={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},AnnotationEditorPrefix="pdfjs_internal_editor_",AnnotationEditorType={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},AnnotationEditorParamsType={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},util_ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},VerbosityLevel={ERRORS:0,WARNINGS:1,INFOS:5},OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},DrawOPS={moveTo:0,lineTo:1,curveTo:2,closePath:3},PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let verbosity=VerbosityLevel.WARNINGS;function setVerbosityLevel(i){Number.isInteger(i)&&(verbosity=i)}function getVerbosityLevel(){return verbosity}function info(i){verbosity>=VerbosityLevel.INFOS&&console.info(`Info: ${i}`)}function warn(i){verbosity>=VerbosityLevel.WARNINGS&&console.warn(`Warning: ${i}`)}function unreachable(i){throw new Error(i)}function assert(i,e){i||unreachable(e)}function _isValidProtocol(i){switch(i?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function createValidAbsoluteUrl(i,e=null,t=null){if(!i)return null;if(t&&typeof i=="string"&&(t.addDefaultProtocol&&i.startsWith("www.")&&i.match(/\./g)?.length>=2&&(i=`http://${i}`),t.tryConvertEncoding))try{i=stringToUTF8String(i)}catch{}const n=e?URL.parse(i,e):URL.parse(i);return _isValidProtocol(n)?n:null}function updateUrlHash(i,e,t=!1){const n=URL.parse(i);return n?(n.hash=e,n.href):t&&createValidAbsoluteUrl(i,"http://example.com")?i.split("#",1)[0]+`${e?`#${e}`:""}`:""}function shadow(i,e,t,n=!1){return Object.defineProperty(i,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}const BaseException=(function i(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e})();class PasswordException extends BaseException{constructor(e,t){super(e,"PasswordException"),this.code=t}}class UnknownErrorException extends BaseException{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class InvalidPDFException extends BaseException{constructor(e){super(e,"InvalidPDFException")}}class ResponseException extends BaseException{constructor(e,t,n){super(e,"ResponseException"),this.status=t,this.missing=n}}class FormatError extends BaseException{constructor(e){super(e,"FormatError")}}class AbortException extends BaseException{constructor(e){super(e,"AbortException")}}function bytesToString(i){(typeof i!="object"||i?.length===void 0)&&unreachable("Invalid argument for bytesToString");const e=i.length,t=8192;if(e<t)return String.fromCharCode.apply(null,i);const n=[];for(let r=0;r<e;r+=t){const s=Math.min(r+t,e),a=i.subarray(r,s);n.push(String.fromCharCode.apply(null,a))}return n.join("")}function stringToBytes(i){typeof i!="string"&&unreachable("Invalid argument for stringToBytes");const e=i.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=i.charCodeAt(n)&255;return t}function string32(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255)}function isLittleEndian(){const i=new Uint8Array(4);return i[0]=1,new Uint32Array(i.buffer,0,1)[0]===1}function isEvalSupported(){try{return new Function(""),!0}catch{return!1}}class util_FeatureTest{static get isLittleEndian(){return shadow(this,"isLittleEndian",isLittleEndian())}static get isEvalSupported(){return shadow(this,"isEvalSupported",isEvalSupported())}static get isOffscreenCanvasSupported(){return shadow(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return shadow(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return shadow(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){return shadow(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const hexNumbers=Array.from(Array(256).keys(),i=>i.toString(16).padStart(2,"0"));class Util{static makeHexColor(e,t,n){return`#${hexNumbers[e]}${hexNumbers[t]}${hexNumbers[n]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,n=0){const r=e[n],s=e[n+1];e[n]=r*t[0]+s*t[2]+t[4],e[n+1]=r*t[1]+s*t[3]+t[5]}static applyTransformToBezier(e,t,n=0){const r=t[0],s=t[1],a=t[2],l=t[3],u=t[4],d=t[5];for(let h=0;h<6;h+=2){const p=e[n+h],m=e[n+h+1];e[n+h]=p*r+m*a+u,e[n+h+1]=p*s+m*l+d}}static applyInverseTransform(e,t){const n=e[0],r=e[1],s=t[0]*t[3]-t[1]*t[2];e[0]=(n*t[3]-r*t[2]+t[2]*t[5]-t[4]*t[3])/s,e[1]=(-n*t[1]+r*t[0]+t[4]*t[1]-t[5]*t[0])/s}static axialAlignedBoundingBox(e,t,n){const r=t[0],s=t[1],a=t[2],l=t[3],u=t[4],d=t[5],h=e[0],p=e[1],m=e[2],g=e[3];let v=r*h+u,_=v,b=r*m+u,E=b,A=l*p+d,z=A,D=l*g+d,P=D;if(s!==0||a!==0){const G=s*h,R=s*m,I=a*p,w=a*g;v+=I,E+=I,b+=w,_+=w,A+=G,P+=G,D+=R,z+=R}n[0]=Math.min(n[0],v,b,_,E),n[1]=Math.min(n[1],A,D,z,P),n[2]=Math.max(n[2],v,b,_,E),n[3]=Math.max(n[3],A,D,z,P)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const n=e[0],r=e[1],s=e[2],a=e[3],l=n**2+r**2,u=n*s+r*a,d=s**2+a**2,h=(l+d)/2,p=Math.sqrt(h**2-(l*d-u**2));t[0]=Math.sqrt(h+p||1),t[1]=Math.sqrt(h-p||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>r)return null;const s=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return s>a?null:[n,s,r,a]}static pointBoundingBox(e,t,n){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}static rectBoundingBox(e,t,n,r,s){s[0]=Math.min(s[0],e,n),s[1]=Math.min(s[1],t,r),s[2]=Math.max(s[2],e,n),s[3]=Math.max(s[3],t,r)}static#e(e,t,n,r,s,a,l,u,d,h){if(d<=0||d>=1)return;const p=1-d,m=d*d,g=m*d,v=p*(p*(p*e+3*d*t)+3*m*n)+g*r,_=p*(p*(p*s+3*d*a)+3*m*l)+g*u;h[0]=Math.min(h[0],v),h[1]=Math.min(h[1],_),h[2]=Math.max(h[2],v),h[3]=Math.max(h[3],_)}static#t(e,t,n,r,s,a,l,u,d,h,p,m){if(Math.abs(d)<1e-12){Math.abs(h)>=1e-12&&this.#e(e,t,n,r,s,a,l,u,-p/h,m);return}const g=h**2-4*p*d;if(g<0)return;const v=Math.sqrt(g),_=2*d;this.#e(e,t,n,r,s,a,l,u,(-h+v)/_,m),this.#e(e,t,n,r,s,a,l,u,(-h-v)/_,m)}static bezierBoundingBox(e,t,n,r,s,a,l,u,d){d[0]=Math.min(d[0],e,l),d[1]=Math.min(d[1],t,u),d[2]=Math.max(d[2],e,l),d[3]=Math.max(d[3],t,u),this.#t(e,n,s,l,t,r,a,u,3*(-e+3*(n-s)+l),6*(e-2*n+s),3*(n-e),d),this.#t(e,n,s,l,t,r,a,u,3*(-t+3*(r-a)+u),6*(t-2*r+a),3*(r-t),d)}}function stringToUTF8String(i){return decodeURIComponent(escape(i))}let NormalizeRegex=null,NormalizationMap=null;function normalizeUnicode(i){return NormalizeRegex||(NormalizeRegex=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,NormalizationMap=new Map([["","t"]])),i.replaceAll(NormalizeRegex,(e,t,n)=>t?t.normalize("NFKC"):NormalizationMap.get(n))}function getUuid(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const i=new Uint8Array(32);return crypto.getRandomValues(i),bytesToString(i)}const AnnotationPrefix="pdfjs_internal_id_";function _isValidExplicitDest(i,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[n,r,...s]=t;if(!i(n)&&!Number.isInteger(n)||!e(r))return!1;const a=s.length;let l=!0;switch(r.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;l=!1;break;default:return!1}for(const u of s)if(!(typeof u=="number"||l&&u===null))return!1;return!0}function MathClamp(i,e,t){return Math.min(Math.max(i,e),t)}function toBase64Util(i){return Uint8Array.prototype.toBase64?i.toBase64():btoa(bytesToString(i))}function fromBase64Util(i){return Uint8Array.fromBase64?Uint8Array.fromBase64(i):stringToBytes(atob(i))}typeof Promise.try!="function"&&(Promise.try=function(i,...e){return new Promise(t=>{t(i(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(i){return i.reduce((e,t)=>e+t,0)});class XfaText{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};function r(s){if(!s)return;let a=null;const l=s.name;if(l==="#text")a=s.value;else if(XfaText.shouldBuildText(l))s?.attributes?.textContent?a=s.attributes.textContent:s.value&&(a=s.value);else return;if(a!==null&&t.push({str:a}),!!s.children)for(const u of s.children)r(u)}return r(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class XfaLayer{static setupStorage(e,t,n,r,s){const a=r.getValue(t,{value:null});switch(n.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),s==="print")break;e.addEventListener("input",l=>{r.setValue(t,{value:l.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(a.value===n.attributes.xfaOn?e.setAttribute("checked",!0):a.value===n.attributes.xfaOff&&e.removeAttribute("checked"),s==="print")break;e.addEventListener("change",l=>{r.setValue(t,{value:l.target.checked?l.target.getAttribute("xfaOn"):l.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),s==="print")break;e.addEventListener("input",l=>{r.setValue(t,{value:l.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const l of n.children)l.attributes.value===a.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}e.addEventListener("input",l=>{const u=l.target.options,d=u.selectedIndex===-1?"":u[u.selectedIndex].value;r.setValue(t,{value:d})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:r,linkService:s}){const{attributes:a}=t,l=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${r}`);for(const[u,d]of Object.entries(a))if(d!=null)switch(u){case"class":d.length&&e.setAttribute(u,d.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",d);break;case"style":Object.assign(e.style,d);break;case"textContent":e.textContent=d;break;default:(!l||u!=="href"&&u!=="newWindow")&&e.setAttribute(u,d)}l&&s.addLinkAttributes(e,a.href,a.newWindow),n&&a.dataId&&this.setupStorage(e,a.dataId,t,n)}static render(e){const t=e.annotationStorage,n=e.linkService,r=e.xfaHtml,s=e.intent||"display",a=document.createElement(r.name);r.attributes&&this.setAttributes({html:a,element:r,intent:s,linkService:n});const l=s!=="richText",u=e.div;if(u.append(a),e.viewport){const p=`matrix(${e.viewport.transform.join(",")})`;u.style.transform=p}l&&u.setAttribute("class","xfaLayer xfaFont");const d=[];if(r.children.length===0){if(r.value){const p=document.createTextNode(r.value);a.append(p),l&&XfaText.shouldBuildText(r.name)&&d.push(p)}return{textDivs:d}}const h=[[r,-1,a]];for(;h.length>0;){const[p,m,g]=h.at(-1);if(m+1===p.children.length){h.pop();continue}const v=p.children[++h.at(-1)[1]];if(v===null)continue;const{name:_}=v;if(_==="#text"){const E=document.createTextNode(v.value);d.push(E),g.append(E);continue}const b=v?.attributes?.xmlns?document.createElementNS(v.attributes.xmlns,_):document.createElement(_);if(g.append(b),v.attributes&&this.setAttributes({html:b,element:v,storage:t,intent:s,linkService:n}),v.children?.length>0)h.push([v,-1,b]);else if(v.value){const E=document.createTextNode(v.value);l&&XfaText.shouldBuildText(_)&&d.push(E),b.append(E)}}for(const p of u.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:d}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const SVG_NS="http://www.w3.org/2000/svg";class PixelsPerInch{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function fetchData(i,e="text"){if(isValidFetchUrl(i,document.baseURI)){const t=await fetch(i);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{const r=new XMLHttpRequest;r.open("GET",i,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}n(new Error(r.statusText))}},r.send(null)})}class PageViewport{constructor({viewBox:e,userUnit:t,scale:n,rotation:r,offsetX:s=0,offsetY:a=0,dontFlip:l=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=r,this.offsetX=s,this.offsetY=a,n*=t;const u=(e[2]+e[0])/2,d=(e[3]+e[1])/2;let h,p,m,g;switch(r%=360,r<0&&(r+=360),r){case 180:h=-1,p=0,m=0,g=1;break;case 90:h=0,p=1,m=1,g=0;break;case 270:h=0,p=-1,m=-1,g=0;break;case 0:h=1,p=0,m=0,g=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}l&&(m=-m,g=-g);let v,_,b,E;h===0?(v=Math.abs(d-e[1])*n+s,_=Math.abs(u-e[0])*n+a,b=(e[3]-e[1])*n,E=(e[2]-e[0])*n):(v=Math.abs(u-e[0])*n+s,_=Math.abs(d-e[1])*n+a,b=(e[2]-e[0])*n,E=(e[3]-e[1])*n),this.transform=[h*n,p*n,m*n,g*n,v-h*n*u-m*n*d,_-p*n*u-g*n*d],this.width=b,this.height=E}get rawDims(){const e=this.viewBox;return shadow(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:r=this.offsetY,dontFlip:s=!1}={}){return new PageViewport({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:s})}convertToViewportPoint(e,t){const n=[e,t];return Util.applyTransform(n,this.transform),n}convertToViewportRectangle(e){const t=[e[0],e[1]];Util.applyTransform(t,this.transform);const n=[e[2],e[3]];return Util.applyTransform(n,this.transform),[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){const n=[e,t];return Util.applyInverseTransform(n,this.transform),n}}class RenderingCancelledException extends BaseException{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function isDataScheme(i){const e=i.length;let t=0;for(;t<e&&i[t].trim()==="";)t++;return i.substring(t,t+5).toLowerCase()==="data:"}function isPdfFile(i){return typeof i=="string"&&/\.pdf$/i.test(i)}function getFilenameFromUrl(i){return[i]=i.split(/[#?]/,1),i.substring(i.lastIndexOf("/")+1)}function getPdfFilenameFromUrl(i,e="document.pdf"){if(typeof i!="string")return e;if(isDataScheme(i))return warn('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const n=(l=>{try{return new URL(l)}catch{try{return new URL(decodeURIComponent(l))}catch{try{return new URL(l,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(l),"https://foo.bar")}catch{return null}}}}})(i);if(!n)return e;const r=l=>{try{let u=decodeURIComponent(l);return u.includes("/")?(u=u.split("/").at(-1),u.test(/^\.pdf$/i)?u:l):u}catch{return l}},s=/\.pdf$/i,a=n.pathname.split("/").at(-1);if(s.test(a))return r(a);if(n.searchParams.size>0){const l=Array.from(n.searchParams.values()).reverse();for(const d of l)if(s.test(d))return r(d);const u=Array.from(n.searchParams.keys()).reverse();for(const d of u)if(s.test(d))return r(d)}if(n.hash){const u=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(u)return r(u[0])}return e}class StatTimer{started=Object.create(null);times=[];time(e){e in this.started&&warn(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||warn(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:r,end:s}of this.times)e.push(`${n.padEnd(t)} ${s-r}ms
`);return e.join("")}}function isValidFetchUrl(i,e){const t=e?URL.parse(i,e):URL.parse(i);return t?.protocol==="http:"||t?.protocol==="https:"}function noContextMenu(i){i.preventDefault()}function stopEvent(i){i.preventDefault(),i.stopPropagation()}function deprecated(i){console.log("Deprecated API usage: "+i)}class PDFDateString{static#e;static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#e.exec(e);if(!t)return null;const n=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let s=parseInt(t[3],10);s=s>=1&&s<=31?s:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let l=parseInt(t[5],10);l=l>=0&&l<=59?l:0;let u=parseInt(t[6],10);u=u>=0&&u<=59?u:0;const d=t[7]||"Z";let h=parseInt(t[8],10);h=h>=0&&h<=23?h:0;let p=parseInt(t[9],10)||0;return p=p>=0&&p<=59?p:0,d==="-"?(a+=h,l+=p):d==="+"&&(a-=h,l-=p),new Date(Date.UTC(n,r,s,a,l,u))}}function getXfaPageViewport(i,{scale:e=1,rotation:t=0}){const{width:n,height:r}=i.attributes.style,s=[0,0,parseInt(n),parseInt(r)];return new PageViewport({viewBox:s,userUnit:1,scale:e,rotation:t})}function getRGB(i){if(i.startsWith("#")){const e=parseInt(i.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return i.startsWith("rgb(")?i.slice(4,-1).split(",").map(e=>parseInt(e)):i.startsWith("rgba(")?i.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(warn(`Not a valid color format: "${i}"`),[0,0,0])}function getColorValues(i){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of i.keys()){e.style.color=t;const n=window.getComputedStyle(e).color;i.set(t,getRGB(n))}e.remove()}function getCurrentTransform(i){const{a:e,b:t,c:n,d:r,e:s,f:a}=i.getTransform();return[e,t,n,r,s,a]}function getCurrentTransformInverse(i){const{a:e,b:t,c:n,d:r,e:s,f:a}=i.getTransform().invertSelf();return[e,t,n,r,s,a]}function setLayerDimensions(i,e,t=!1,n=!0){if(e instanceof PageViewport){const{pageWidth:r,pageHeight:s}=e.rawDims,{style:a}=i,l=util_FeatureTest.isCSSRoundSupported,u=`var(--total-scale-factor) * ${r}px`,d=`var(--total-scale-factor) * ${s}px`,h=l?`round(down, ${u}, var(--scale-round-x))`:`calc(${u})`,p=l?`round(down, ${d}, var(--scale-round-y))`:`calc(${d})`;!t||e.rotation%180===0?(a.width=h,a.height=p):(a.width=p,a.height=h)}n&&i.setAttribute("data-main-rotation",e.rotation)}class OutputScale{constructor(){const{pixelRatio:e}=OutputScale;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,n,r,s=-1){let a=1/0,l=1/0,u=1/0;n=OutputScale.capPixels(n,s),n>0&&(a=Math.sqrt(n/(e*t))),r!==-1&&(l=r/e,u=r/t);const d=Math.min(a,l,u);return this.sx>d||this.sy>d?(this.sx=d,this.sy=d,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,n):n}return e}}const SupportedImageMimeTypes=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class ColorScheme{static get isDarkMode(){return shadow(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class CSSConstants{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:n}=window.getComputedStyle(e);return e.remove(),shadow(this,"commentForegroundColor",getRGB(n))}}function applyOpacity(i,e,t,n){n=Math.min(Math.max(n??1,0),1);const r=255*(1-n);return i=Math.round(i*n+r),e=Math.round(e*n+r),t=Math.round(t*n+r),[i,e,t]}function RGBToHSL(i,e){const t=i[0]/255,n=i[1]/255,r=i[2]/255,s=Math.max(t,n,r),a=Math.min(t,n,r),l=(s+a)/2;if(s===a)e[0]=e[1]=0;else{const u=s-a;switch(e[1]=l<.5?u/(s+a):u/(2-s-a),s){case t:e[0]=((n-r)/u+(n<r?6:0))*60;break;case n:e[0]=((r-t)/u+2)*60;break;case r:e[0]=((t-n)/u+4)*60;break}}e[2]=l}function HSLToRGB(i,e){const t=i[0],n=i[1],r=i[2],s=(1-Math.abs(2*r-1))*n,a=s*(1-Math.abs(t/60%2-1)),l=r-s/2;switch(Math.floor(t/60)){case 0:e[0]=s+l,e[1]=a+l,e[2]=l;break;case 1:e[0]=a+l,e[1]=s+l,e[2]=l;break;case 2:e[0]=l,e[1]=s+l,e[2]=a+l;break;case 3:e[0]=l,e[1]=a+l,e[2]=s+l;break;case 4:e[0]=a+l,e[1]=l,e[2]=s+l;break;case 5:case 6:e[0]=s+l,e[1]=l,e[2]=a+l;break}}function computeLuminance(i){return i<=.03928?i/12.92:((i+.055)/1.055)**2.4}function contrastRatio(i,e,t){HSLToRGB(i,t),t.map(computeLuminance);const n=.2126*t[0]+.7152*t[1]+.0722*t[2];HSLToRGB(e,t),t.map(computeLuminance);const r=.2126*t[0]+.7152*t[1]+.0722*t[2];return n>r?(n+.05)/(r+.05):(r+.05)/(n+.05)}const contrastCache=new Map;function findContrastColor(i,e){const t=i[0]+i[1]*256+i[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let n=contrastCache.get(t);if(n)return n;const r=new Float32Array(9),s=r.subarray(0,3),a=r.subarray(3,6);RGBToHSL(i,a);const l=r.subarray(6,9);RGBToHSL(e,l);const u=l[2]<.5,d=u?12:4.5;if(a[2]=u?Math.sqrt(a[2]):1-Math.sqrt(1-a[2]),contrastRatio(a,l,s)<d){let h,p;u?(h=a[2],p=1):(h=0,p=a[2]);const m=.005;for(;p-h>m;){const g=a[2]=(h+p)/2;u===contrastRatio(a,l,s)<d?h=g:p=g}a[2]=u?p:h}return HSLToRGB(a,s),n=Util.makeHexColor(Math.round(s[0]*255),Math.round(s[1]*255),Math.round(s[2]*255)),contrastCache.set(t,n),n}function renderRichText({html:i,dir:e,className:t},n){const r=document.createDocumentFragment();if(typeof i=="string"){const s=document.createElement("p");s.dir=e||"auto";const a=i.split(/(?:\r\n?|\n)/);for(let l=0,u=a.length;l<u;++l){const d=a[l];s.append(document.createTextNode(d)),l<u-1&&s.append(document.createElement("br"))}r.append(s)}else XfaLayer.render({xfaHtml:i,div:r,intent:"richText"});r.firstChild.classList.add("richText",t),n.append(r)}class EditorToolbar{#e=null;#t=null;#i;#n=null;#r=null;#a=null;#o=null;#s=null;static#l=null;constructor(e){this.#i=e,EditorToolbar.#l||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const e=this.#e=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#i._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",noContextMenu,{signal:t}),e.addEventListener("pointerdown",EditorToolbar.#c,{signal:t}));const n=this.#n=document.createElement("div");n.className="buttons",e.append(n);const r=this.#i.toolbarPosition;if(r){const{style:s}=e,a=this.#i._uiManager.direction==="ltr"?1-r[0]:r[0];s.insetInlineEnd=`${100*a}%`,s.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return this.#e}static#c(e){e.stopPropagation()}#h(e){this.#i._focusEventsAllowed=!1,stopEvent(e)}#d(e){this.#i._focusEventsAllowed=!0,stopEvent(e)}#f(e){const t=this.#i._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",this.#h.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",noContextMenu,{signal:t}),!0)}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#r?.shown(),this.#a?.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=this.#i,n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",EditorToolbar.#l[e]),this.#f(n)&&n.addEventListener("click",r=>{t.delete()},{signal:t._signal}),this.#n.append(n)}get#g(){const e=document.createElement("div");return e.className="divider",e}async addAltText(e){const t=await e.render();this.#f(t),this.#n.append(t,this.#g),this.#r=e}addComment(e,t=null){if(this.#a)return;const n=e.renderForToolbar();if(!n)return;this.#f(n);const r=this.#o=this.#g;t?(this.#n.insertBefore(n,t),this.#n.insertBefore(r,t)):this.#n.append(n,r),this.#a=e,e.toolbar=this}addColorPicker(e){if(this.#t)return;this.#t=e;const t=e.renderButton();this.#f(t),this.#n.append(t,this.#g)}async addEditSignatureButton(e){const t=this.#s=await e.renderEditButton(this.#i);this.#f(t),this.#n.append(t,this.#g)}removeButton(e){e==="comment"&&(this.#a?.removeToolbarCommentButton(),this.#a=null,this.#o?.remove(),this.#o=null)}async addButton(e,t){switch(e){case"colorPicker":this.addColorPicker(t);break;case"altText":await this.addAltText(t);break;case"editSignature":await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(t);break}}async addButtonBefore(e,t,n){const r=this.#n.querySelector(n);r&&e==="comment"&&this.addComment(t,r)}updateEditSignatureButton(e){this.#s&&(this.#s.title=e)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}}class FloatingToolbar{#e=null;#t=null;#i;constructor(e){this.#i=e}#n(){const e=this.#t=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar");const t=this.#i._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",noContextMenu,{signal:t});const n=this.#e=document.createElement("div");return n.className="buttons",e.append(n),this.#i.hasCommentManager()&&this.#a("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#i.commentSelection("floating_button")}),this.#a("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#i.highlightSelection("floating_button")}),e}#r(e,t){let n=0,r=0;for(const s of e){const a=s.y+s.height;if(a<n)continue;const l=s.x+(t?s.width:0);if(a>n){r=l,n=a;continue}t?l>r&&(r=l):l<r&&(r=l)}return[t?1-r:r,n]}show(e,t,n){const[r,s]=this.#r(t,n),{style:a}=this.#t||=this.#n();e.append(this.#t),a.insetInlineEnd=`${100*r}%`,a.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#a(e,t,n,r){const s=document.createElement("button");s.classList.add("basic",e),s.tabIndex=0,s.setAttribute("data-l10n-id",t);const a=document.createElement("span");s.append(a),a.className="visuallyHidden",a.setAttribute("data-l10n-id",n);const l=this.#i._signal;l instanceof AbortSignal&&!l.aborted&&(s.addEventListener("contextmenu",noContextMenu,{signal:l}),s.addEventListener("click",r,{signal:l})),this.#e.append(s)}}function bindEvents(i,e,t){for(const n of t)e.addEventListener(n,i[n].bind(i))}class IdManager{#e=0;get id(){return`${AnnotationEditorPrefix}${this.#e++}`}}class ImageManager{#e=getUuid();#t=0;#i=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const s=r.decode().then(()=>(n.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return shadow(this,"_isSVGFittingCanvas",s)}async#n(e,t){this.#i||=new Map;let n=this.#i.get(e);if(n===null)return null;if(n?.bitmap)return n.refCounter+=1,n;try{n||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let r;if(typeof t=="string"?(n.url=t,r=await fetchData(t,"blob")):t instanceof File?r=n.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const s=ImageManager._isSVGFittingCanvas,a=new FileReader,l=new Image,u=new Promise((d,h)=>{l.onload=()=>{n.bitmap=l,n.isSvg=!0,d()},a.onload=async()=>{const p=n.svgUrl=a.result;l.src=await s?`${p}#svgView(preserveAspectRatio(none))`:p},l.onerror=a.onerror=h});a.readAsDataURL(r),await u}else n.bitmap=await createImageBitmap(r);n.refCounter=1}catch(r){warn(r),n=null}return this.#i.set(e,n),n&&this.#i.set(n.id,n),n}async getFromFile(e){const{lastModified:t,name:n,size:r,type:s}=e;return this.#n(`${t}_${n}_${r}_${s}`,e)}async getFromUrl(e){return this.#n(e,e)}async getFromBlob(e,t){const n=await t;return this.#n(e,n)}async getFromId(e){this.#i||=new Map;const t=this.#i.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#i||=new Map;let n=this.#i.get(e);if(n?.bitmap)return n.refCounter+=1,n;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),n={bitmap:r.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#i.set(e,n),this.#i.set(n.id,n),n}getSvgUrl(e){const t=this.#i.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#i||=new Map;const t=this.#i.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:n}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(n.width,n.height);r.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=r.convertToBlob()}n.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#e}_`)}}class CommandManager{#e=[];#t=!1;#i;#n=-1;constructor(e=128){this.#i=e}add({cmd:e,undo:t,post:n,mustExec:r,type:s=NaN,overwriteIfSameType:a=!1,keepUndo:l=!1}){if(r&&e(),this.#t)return;const u={cmd:e,undo:t,post:n,type:s};if(this.#n===-1){this.#e.length>0&&(this.#e.length=0),this.#n=0,this.#e.push(u);return}if(a&&this.#e[this.#n].type===s){l&&(u.undo=this.#e[this.#n].undo),this.#e[this.#n]=u;return}const d=this.#n+1;d===this.#i?this.#e.splice(0,1):(this.#n=d,d<this.#e.length&&this.#e.splice(d)),this.#e.push(u)}undo(){if(this.#n===-1)return;this.#t=!0;const{undo:e,post:t}=this.#e[this.#n];e(),t?.(),this.#t=!1,this.#n-=1}redo(){if(this.#n<this.#e.length-1){this.#n+=1,this.#t=!0;const{cmd:e,post:t}=this.#e[this.#n];e(),t?.(),this.#t=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#e.length-1}cleanType(e){if(this.#n!==-1){for(let t=this.#n;t>=0;t--)if(this.#e[t].type!==e){this.#e.splice(t+1,this.#n-t),this.#n=t;return}this.#e.length=0,this.#n=-1}}destroy(){this.#e=null}}class KeyboardManager{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=util_FeatureTest.platform;for(const[n,r,s={}]of e)for(const a of n){const l=a.startsWith("mac+");t&&l?(this.callbacks.set(a.slice(4),{callback:r,options:s}),this.allKeys.add(a.split("+").at(-1))):!t&&!l&&(this.callbacks.set(a,{callback:r,options:s}),this.allKeys.add(a.split("+").at(-1)))}}#e(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(this.#e(t));if(!n)return;const{callback:r,options:{bubbles:s=!1,args:a=[],checker:l=null}}=n;l&&!l(e,t)||(r.bind(e,...a,t)(),s||stopEvent(t))}}class ColorManager{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return getColorValues(e),shadow(this,"_colors",e)}convert(e){const t=getRGB(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,r]of this._colors)if(r.every((s,a)=>s===t[a]))return ColorManager._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?Util.makeHexColor(...t):e}}class AnnotationEditorUIManager{#e=new AbortController;#t=null;#i=null;#n=new Map;#r=new Map;#a=null;#o=null;#s=null;#l=new CommandManager;#c=null;#h=null;#d=null;#f=0;#g=new Set;#p=null;#u=null;#m=new Set;_editorUndoBar=null;#y=!1;#b=!1;#v=!1;#w=null;#x=null;#_=null;#P=null;#E=!1;#A=null;#I=new IdManager;#S=!1;#R=!1;#L=!1;#M=null;#N=null;#D=null;#k=null;#B=null;#C=AnnotationEditorType.NONE;#T=new Set;#F=null;#j=null;#H=null;#W=null;#G=null;#K={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#q=[0,0];#V=null;#$=null;#J=null;#Z=null;#U=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=AnnotationEditorUIManager.prototype,t=a=>a.#$.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),n=(a,{target:l})=>{if(l instanceof HTMLInputElement){const{type:u}=l;return u!=="text"&&u!=="number"}return!0},r=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return shadow(this,"_keyboardManager",new KeyboardManager([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:l})=>!(l instanceof HTMLButtonElement)&&a.#$.contains(l)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:l})=>!(l instanceof HTMLButtonElement)&&a.#$.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}]]))}constructor(e,t,n,r,s,a,l,u,d,h,p,m,g,v,_,b){const E=this._signal=this.#e.signal;this.#$=e,this.#J=t,this.#Z=n,this.#a=r,this.#c=s,this.#j=a,this.#G=u,this._eventBus=l,l._on("editingaction",this.onEditingAction.bind(this),{signal:E}),l._on("pagechanging",this.onPageChanging.bind(this),{signal:E}),l._on("scalechanging",this.onScaleChanging.bind(this),{signal:E}),l._on("rotationchanging",this.onRotationChanging.bind(this),{signal:E}),l._on("setpreference",this.onSetPreference.bind(this),{signal:E}),l._on("switchannotationeditorparams",A=>this.updateParams(A.type,A.value),{signal:E}),window.addEventListener("pointerdown",()=>{this.#R=!0},{capture:!0,signal:E}),window.addEventListener("pointerup",()=>{this.#R=!1},{capture:!0,signal:E}),this.#le(),this.#he(),this.#te(),this.#o=u.annotationStorage,this.#w=u.filterFactory,this.#H=d,this.#P=h||null,this.#y=p,this.#b=m,this.#v=g,this.#B=v||null,this.viewParameters={realScale:PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=_||null,this._supportsPinchToZoom=b!==!1,s?.setSidebarUiManager(this)}destroy(){this.#U?.resolve(),this.#U=null,this.#e?.abort(),this.#e=null,this._signal=null;for(const e of this.#r.values())e.destroy();this.#r.clear(),this.#n.clear(),this.#m.clear(),this.#k?.clear(),this.#t=null,this.#T.clear(),this.#l.destroy(),this.#a?.destroy(),this.#c?.destroy(),this.#j?.destroy(),this.#A?.hide(),this.#A=null,this.#D?.destroy(),this.#D=null,this.#i=null,this.#x&&(clearTimeout(this.#x),this.#x=null),this.#V&&(clearTimeout(this.#V),this.#V=null),this._editorUndoBar?.destroy(),this.#G=null}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#B}get useNewAltTextFlow(){return this.#b}get useNewAltTextWhenAddingImage(){return this.#v}get hcmFilter(){return shadow(this,"hcmFilter",this.#H?this.#w.addHCMFilter(this.#H.foreground,this.#H.background):"none")}get direction(){return shadow(this,"direction",getComputedStyle(this.#$).direction)}get _highlightColors(){return shadow(this,"_highlightColors",this.#P?new Map(this.#P.split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return shadow(this,"highlightColors",null);const t=new Map,n=!!this.#H;for(const[r,s]of e){const a=r.endsWith("_HCM");if(n&&a){t.set(r.replace("_HCM",""),s);continue}!n&&!a&&t.set(r,s)}return shadow(this,"highlightColors",t)}get highlightColorNames(){return shadow(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#d=e}setMainHighlightColorPicker(e){this.#D=e}editAltText(e,t=!1){this.#a?.editAltText(this,e,t)}hasCommentManager(){return!!this.#c}editComment(e,t,n,r){this.#c?.showDialog(this,e,t,n,r)}selectComment(e,t){this.#r.get(e)?.getEditorByUID(t)?.toggleComment(!0,!0)}updateComment(e){this.#c?.updateComment(e.getData())}updatePopupColor(e){this.#c?.updatePopupColor(e)}removeComment(e){this.#c?.removeComments([e.uid])}toggleComment(e,t,n=void 0){this.#c?.toggleCommentPopup(e,t,n)}makeCommentColor(e,t){return e&&this.#c?.makeCommentColor(e,t)||null}getCommentDialogElement(){return this.#c?.dialogElement||null}async waitForEditorsRendered(e){if(this.#r.has(e-1))return;const{resolve:t,promise:n}=Promise.withResolvers(),r=s=>{s.pageNumber===e&&(this._eventBus._off("editorsrendered",r),t())};this._eventBus.on("editorsrendered",r),await n}getSignature(e){this.#j?.getSignature({uiManager:this,editor:e})}get signatureManager(){return this.#j}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){e==="enableNewAltTextWhenAddingImage"&&(this.#v=t)}onPageChanging({pageNumber:e}){this.#f=e-1}focusMainContainer(){this.#$.focus()}findParent(e,t){for(const n of this.#r.values()){const{x:r,y:s,width:a,height:l}=n.div.getBoundingClientRect();if(e>=r&&e<=r+a&&t>=s&&t<=s+l)return n}return null}disableUserSelect(e=!1){this.#J.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#m.add(e)}removeShouldRescale(e){this.#m.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*PixelsPerInch.PDF_TO_CSS_UNITS;for(const t of this.#m)t.onScaleChanging();this.#d?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#Q({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#ee(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of this.#r.values())if(n.hasTextLayer(e))return n;return null}highlightSelection(e="",t=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:r,anchorOffset:s,focusNode:a,focusOffset:l}=n,u=n.toString(),h=this.#Q(n).closest(".textLayer"),p=this.getSelectionBoxes(h);if(!p)return;n.empty();const m=this.#ee(h),g=this.#C===AnnotationEditorType.NONE,v=()=>{const _=m?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:p,anchorNode:r,anchorOffset:s,focusNode:a,focusOffset:l,text:u});g&&this.showAllEditors("highlight",!0,!0),t&&_?.editComment()};if(g){this.switchToMode(AnnotationEditorType.HIGHLIGHT,v);return}v()}commentSelection(e=""){this.highlightSelection(e,!0)}#ae(){const e=document.getSelection();if(!e||e.isCollapsed)return;const n=this.#Q(e).closest(".textLayer"),r=this.getSelectionBoxes(n);r&&(this.#A||=new FloatingToolbar(this),this.#A.show(n,r,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(e){if(!this.#o)return null;const t=`${AnnotationEditorPrefix}${e}`,n=this.#o.getRawValue(t);return n&&this.#o.remove(t),n}addToAnnotationStorage(e){!e.isEmpty()&&this.#o&&!this.#o.has(e.id)&&this.#o.setValue(e.id,e)}a11yAlert(e,t=null){const n=this.#Z;n&&(n.setAttribute("data-l10n-id",e),t?n.setAttribute("data-l10n-args",JSON.stringify(t)):n.removeAttribute("data-l10n-args"))}#oe(){const e=document.getSelection();if(!e||e.isCollapsed){this.#F&&(this.#A?.hide(),this.#F=null,this.#O({hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===this.#F)return;const r=this.#Q(e).closest(".textLayer");if(!r){this.#F&&(this.#A?.hide(),this.#F=null,this.#O({hasSelectedText:!1}));return}if(this.#A?.hide(),this.#F=t,this.#O({hasSelectedText:!0}),!(this.#C!==AnnotationEditorType.HIGHLIGHT&&this.#C!==AnnotationEditorType.NONE)&&(this.#C===AnnotationEditorType.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#E=this.isShiftKeyDown,!this.isShiftKeyDown)){const s=this.#C===AnnotationEditorType.HIGHLIGHT?this.#ee(r):null;if(s?.toggleDrawing(),this.#R){const a=new AbortController,l=this.combinedSignal(a),u=d=>{d.type==="pointerup"&&d.button!==0||(a.abort(),s?.toggleDrawing(!0),d.type==="pointerup"&&this.#X("main_toolbar"))};window.addEventListener("pointerup",u,{signal:l}),window.addEventListener("blur",u,{signal:l})}else s?.toggleDrawing(!0),this.#X("main_toolbar")}}#X(e=""){this.#C===AnnotationEditorType.HIGHLIGHT?this.highlightSelection(e):this.#y&&this.#ae()}#le(){document.addEventListener("selectionchange",this.#oe.bind(this),{signal:this._signal})}#ce(){if(this.#_)return;this.#_=new AbortController;const e=this.combinedSignal(this.#_);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#ue(){this.#_?.abort(),this.#_=null}blur(){if(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#X("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#T)if(t.div.contains(e)){this.#N=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#N)return;const[e,t]=this.#N;this.#N=null,t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#te(){if(this.#M)return;this.#M=new AbortController;const e=this.combinedSignal(this.#M);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#de(){this.#M?.abort(),this.#M=null}#ne(){if(this.#h)return;this.#h=new AbortController;const e=this.combinedSignal(this.#h);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#ie(){this.#h?.abort(),this.#h=null}#he(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#te(),this.#ne()}removeEditListeners(){this.#de(),this.#ie()}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of this.#u)if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const n of this.#u)if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const n of this.#T){const r=n.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const s of t.items)for(const a of this.#u)if(a.isHandlingMimeForPasting(s.type)){a.paste(s,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(s){warn(`paste: "${s.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const r=this.currentLayer;try{const s=[];for(const u of n){const d=await r.deserialize(u);if(!d)return;s.push(d)}const a=()=>{for(const u of s)this.#re(u);this.#se(s)},l=()=>{for(const u of s)u.remove()};this.addCommands({cmd:a,undo:l,mustExec:!0})}catch(s){warn(`paste: "${s.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#C!==AnnotationEditorType.NONE&&!this.isEditorHandlingKeyboard&&AnnotationEditorUIManager._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#X("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#O(e){Object.entries(e).some(([n,r])=>this.#K[n]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#K,e)}),this.#C===AnnotationEditorType.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#z([[AnnotationEditorParamsType.HIGHLIGHT_FREE,!0]]))}#z(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#ce(),this.#ne(),this.#O({isEditing:this.#C!==AnnotationEditorType.NONE,isEmpty:this.#Y(),hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:this.#l.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ue(),this.#ie(),this.#O({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#u){this.#u=e;for(const t of this.#u)this.#z(t.defaultPropertiesToUpdate)}}getId(){return this.#I.id}get currentLayer(){return this.#r.get(this.#f)}getLayer(e){return this.#r.get(e)}get currentPageIndex(){return this.#f}addLayer(e){this.#r.set(e.pageIndex,e),this.#S?e.enable():e.disable()}removeLayer(e){this.#r.delete(e.pageIndex)}async updateMode(e,t=null,n=!1,r=!1,s=!1){if(this.#C!==e&&!(this.#U&&(await this.#U.promise,!this.#U))){if(this.#U=Promise.withResolvers(),this.#d?.commitOrRemove(),this.#C===AnnotationEditorType.POPUP&&this.#c?.hideSidebar(),this.#c?.destroyPopup(),this.#C=e,e===AnnotationEditorType.NONE){this.setEditingState(!1),this.#pe();for(const a of this.#n.values())a.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#U.resolve();return}for(const a of this.#n.values())a.addStandaloneCommentButton();e===AnnotationEditorType.SIGNATURE&&await this.#j?.loadSignatures(),this.setEditingState(!0),await this.#fe(),this.unselectAll();for(const a of this.#r.values())a.updateMode(e);if(e===AnnotationEditorType.POPUP){this.#i||=await this.#G.getAnnotationsByType(new Set(this.#u.map(u=>u._editorType)));const a=new Set,l=[];for(const u of this.#n.values()){const{annotationElementId:d,hasComment:h,deleted:p}=u;d&&a.add(d),h&&!p&&l.push(u.getData())}for(const u of this.#i){const{id:d,popupRef:h,contentsObj:p}=u;h&&p?.str&&!a.has(d)&&!this.#g.has(d)&&l.push(u)}this.#c?.showSidebar(l)}if(!t){n&&this.addNewEditorFromKeyboard(),this.#U.resolve();return}for(const a of this.#n.values())a.uid===t?(this.setSelected(a),s?a.editComment():r?a.enterInEditMode():a.focus()):a.unselect();this.#U.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==this.#C&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(this.#u){switch(e){case AnnotationEditorParamsType.CREATE:this.currentLayer.addNewEditor(t);return;case AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#W||=new Map).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const n of this.#T)n.updateParams(e,t);else for(const n of this.#u)n.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){for(const s of this.#n.values())s.editorType===e&&s.show(t);(this.#W?.get(AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#z([[AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(this.#L!==e){this.#L=e;for(const t of this.#r.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}async#fe(){if(!this.#S){this.#S=!0;const e=[];for(const t of this.#r.values())e.push(t.enable());await Promise.all(e);for(const t of this.#n.values())t.enable()}}#pe(){if(this.unselectAll(),this.#S){this.#S=!1;for(const e of this.#r.values())e.disable();for(const e of this.#n.values())e.disable()}}*getEditors(e){for(const t of this.#n.values())t.pageIndex===e&&(yield t)}getEditor(e){return this.#n.get(e)}addEditor(e){this.#n.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#x&&clearTimeout(this.#x),this.#x=setTimeout(()=>{this.focusMainContainer(),this.#x=null},0)),this.#n.delete(e.id),e.annotationElementId&&this.#k?.delete(e.annotationElementId),this.unselect(e),(!e.annotationElementId||!this.#g.has(e.annotationElementId))&&this.#o?.remove(e.id)}addDeletedAnnotationElement(e){this.#g.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#g.has(e)}removeDeletedAnnotationElement(e){this.#g.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#re(e){const t=this.#r.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#z(e.propertiesToUpdate))}get#me(){let e=null;for(e of this.#T);return e}updateUI(e){this.#me===e&&this.#z(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#z(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#T.has(e)){this.#T.delete(e),e.unselect(),this.#O({hasSelectedEditor:this.hasSelection});return}this.#T.add(e),e.select(),this.#z(e.propertiesToUpdate),this.#O({hasSelectedEditor:!0})}setSelected(e){this.updateToolbar({mode:e.mode,editId:e.id}),this.#d?.commitOrRemove();for(const t of this.#T)t!==e&&t.unselect();this.#T.clear(),this.#T.add(e),e.select(),this.#z(e.propertiesToUpdate),this.#O({hasSelectedEditor:!0})}isSelected(e){return this.#T.has(e)}get firstSelectedEditor(){return this.#T.values().next().value}unselect(e){e.unselect(),this.#T.delete(e),this.#O({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#T.size!==0}get isEnterHandled(){return this.#T.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#l.undo(),this.#O({hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#Y()}),this._editorUndoBar?.hide()}redo(){this.#l.redo(),this.#O({hasSomethingToUndo:!0,hasSomethingToRedo:this.#l.hasSomethingToRedo(),isEmpty:this.#Y()})}addCommands(e){this.#l.add(e),this.#O({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#Y()})}cleanUndoStack(e){this.#l.cleanType(e)}#Y(){if(this.#n.size===0)return!0;if(this.#n.size===1)for(const e of this.#n.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();const e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...this.#T],n=()=>{this._editorUndoBar?.show(r,t.length===1?t[0].editorType:t.length);for(const s of t)s.remove()},r=()=>{for(const s of t)this.#re(s)};this.addCommands({cmd:n,undo:r,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#se(e){for(const t of this.#T)t.unselect();this.#T.clear();for(const t of e)t.isEmpty()||(this.#T.add(t),t.select());this.#O({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#T)e.commit();this.#se(this.#n.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#C!==AnnotationEditorType.NONE))&&!this.#d?.commitOrRemove()&&this.hasSelection){for(const e of this.#T)e.unselect();this.#T.clear(),this.#O({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#q[0]+=e,this.#q[1]+=t;const[r,s]=this.#q,a=[...this.#T],l=1e3;this.#V&&clearTimeout(this.#V),this.#V=setTimeout(()=>{this.#V=null,this.#q[0]=this.#q[1]=0,this.addCommands({cmd:()=>{for(const u of a)this.#n.has(u.id)&&(u.translateInPage(r,s),u.translationDone())},undo:()=>{for(const u of a)this.#n.has(u.id)&&(u.translateInPage(-r,-s),u.translationDone())},mustExec:!1})},l);for(const u of a)u.translateInPage(e,t),u.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#p=new Map;for(const e of this.#T)this.#p.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#p)return!1;this.disableUserSelect(!1);const e=this.#p;this.#p=null;let t=!1;for(const[{x:r,y:s,pageIndex:a},l]of e)l.newX=r,l.newY=s,l.newPageIndex=a,t||=r!==l.savedX||s!==l.savedY||a!==l.savedPageIndex;if(!t)return!1;const n=(r,s,a,l)=>{if(this.#n.has(r.id)){const u=this.#r.get(l);u?r._setParentAndPosition(u,s,a):(r.pageIndex=l,r.x=s,r.y=a)}};return this.addCommands({cmd:()=>{for(const[r,{newX:s,newY:a,newPageIndex:l}]of e)n(r,s,a,l)},undo:()=>{for(const[r,{savedX:s,savedY:a,savedPageIndex:l}]of e)n(r,s,a,l)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#p)for(const n of this.#p.keys())n.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#T.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#C}isEditingMode(){return this.#C!==AnnotationEditorType.NONE}get imageManager(){return shadow(this,"imageManager",new ImageManager)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let d=0,h=t.rangeCount;d<h;d++)if(!e.contains(t.getRangeAt(d).commonAncestorContainer))return null;const{x:n,y:r,width:s,height:a}=e.getBoundingClientRect();let l;switch(e.getAttribute("data-main-rotation")){case"90":l=(d,h,p,m)=>({x:(h-r)/a,y:1-(d+p-n)/s,width:m/a,height:p/s});break;case"180":l=(d,h,p,m)=>({x:1-(d+p-n)/s,y:1-(h+m-r)/a,width:p/s,height:m/a});break;case"270":l=(d,h,p,m)=>({x:1-(h+m-r)/a,y:(d-n)/s,width:m/a,height:p/s});break;default:l=(d,h,p,m)=>({x:(d-n)/s,y:(h-r)/a,width:p/s,height:m/a});break}const u=[];for(let d=0,h=t.rangeCount;d<h;d++){const p=t.getRangeAt(d);if(!p.collapsed)for(const{x:m,y:g,width:v,height:_}of p.getClientRects())v===0||_===0||u.push(l(m,g,v,_))}return u.length===0?null:u}addChangedExistingAnnotation({annotationElementId:e,id:t}){(this.#s||=new Map).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){this.#s?.delete(e)}renderAnnotationElement(e){const t=this.#s?.get(e.data.id);if(!t)return;const n=this.#o.getRawValue(t);n&&(this.#C===AnnotationEditorType.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}setMissingCanvas(e,t,n){const r=this.#k?.get(e);r&&(r.setCanvas(t,n),this.#k.delete(e))}addMissingCanvas(e,t){(this.#k||=new Map).set(e,t)}}class AltText{#e=null;#t=!1;#i=null;#n=null;#r=null;#a=null;#o=!1;#s=null;#l=null;#c=null;#h=null;#d=!1;static#f=null;static _l10n=null;constructor(e){this.#l=e,this.#d=e._uiManager.useNewAltTextFlow,AltText.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){AltText._l10n??=e}async render(){const e=this.#i=document.createElement("button");e.className="altText",e.tabIndex="0";const t=this.#n=document.createElement("span");e.append(t),this.#d?(e.classList.add("new"),e.setAttribute("data-l10n-id",AltText.#f.missing),t.setAttribute("data-l10n-id",AltText.#f["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=this.#l._uiManager._signal;e.addEventListener("contextmenu",noContextMenu,{signal:n}),e.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:n});const r=s=>{s.preventDefault(),this.#l._uiManager.editAltText(this.#l),this.#d&&this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#g}})};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",s=>{s.target===e&&s.key==="Enter"&&(this.#o=!0,r(s))},{signal:n}),await this.#p(),e}get#g(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#o}),this.#o=!1)}isEmpty(){return this.#d?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#d?this.#e!==null||!!this.#c:this.isEmpty()}get guessedText(){return this.#c}async setGuessedText(e){this.#e===null&&(this.#c=e,this.#h=await AltText._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#p())}toggleAltTextBadge(e=!1){if(!this.#d||this.#e){this.#s?.remove(),this.#s=null;return}if(!this.#s){const t=this.#s=document.createElement("div");t.className="noAltTextBadge",this.#l.div.append(t)}this.#s.classList.toggle("hidden",!e)}serialize(e){let t=this.#e;return!e&&this.#c===t&&(t=this.#h),{altText:t,decorative:this.#t,guessedText:this.#c,textWithDisclaimer:this.#h}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:r,cancel:s=!1}){n&&(this.#c=n,this.#h=r),!(this.#e===e&&this.#t===t)&&(s||(this.#e=e,this.#t=t),this.#p())}toggle(e=!1){this.#i&&(!e&&this.#a&&(clearTimeout(this.#a),this.#a=null),this.#i.disabled=!e)}shown(){this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#g}})}destroy(){this.#i?.remove(),this.#i=null,this.#n=null,this.#r=null,this.#s?.remove(),this.#s=null}async#p(){const e=this.#i;if(!e)return;if(this.#d){if(e.classList.toggle("done",!!this.#e),e.setAttribute("data-l10n-id",AltText.#f[this.#g]),this.#n?.setAttribute("data-l10n-id",AltText.#f[`${this.#g}-label`]),!this.#e){this.#r?.remove();return}}else{if(!this.#e&&!this.#t){e.classList.remove("done"),this.#r?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=this.#r;if(!t){this.#r=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${this.#l.id}`;const r=100,s=this.#l._uiManager._signal;s.addEventListener("abort",()=>{clearTimeout(this.#a),this.#a=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#a=setTimeout(()=>{this.#a=null,this.#r.classList.add("show"),this.#l._reportTelemetry({action:"alt_text_tooltip"})},r)},{signal:s}),e.addEventListener("mouseleave",()=>{this.#a&&(clearTimeout(this.#a),this.#a=null),this.#r?.classList.remove("show")},{signal:s})}this.#t?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=this.#e),t.parentNode||e.append(t),this.#l.getElementForAltText()?.setAttribute("aria-describedby",t.id)}}class Comment{#e=null;#t=null;#i=!1;#n=null;#r=null;#a=null;#o=null;#s=null;#l=!1;#c=null;constructor(e){this.#n=e}renderForToolbar(){const e=this.#t=document.createElement("button");return e.className="comment",this.#h(e,!1)}renderForStandalone(){const e=this.#e=document.createElement("button");e.className="annotationCommentButton";const t=this.#n.commentButtonPosition;if(t){const{style:n}=e;n.insetInlineEnd=`calc(${100*(this.#n._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const r=this.#n.commentButtonColor;r&&(n.backgroundColor=r)}return this.#h(e,!0)}focusButton(){setTimeout(()=>{(this.#e??this.#t)?.focus()},0)}onUpdatedColor(){if(!this.#e)return;const e=this.#n.commentButtonColor;e&&(this.#e.style.backgroundColor=e),this.#n._uiManager.updatePopupColor(this.#n)}get commentButtonWidth(){return(this.#e?.getBoundingClientRect().width??0)/this.#n.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#c)return this.#c;if(!this.#e)return null;const{x:e,y:t,height:n}=this.#e.getBoundingClientRect(),{x:r,y:s,width:a,height:l}=this.#n.parent.boundingClientRect;return[(e-r)/a,(t+n-s)/l]}set commentPopupPositionInLayer(e){this.#c=e}hasDefaultPopupPosition(){return this.#c===null}removeStandaloneCommentButton(){this.#e?.remove(),this.#e=null}removeToolbarCommentButton(){this.#t?.remove(),this.#t=null}setCommentButtonStates({selected:e,hasPopup:t}){this.#e&&(this.#e.classList.toggle("selected",e),this.#e.ariaExpanded=t)}#h(e,t){if(!this.#n._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[this.#n._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button"));const n=this.#n._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return e;e.addEventListener("contextmenu",noContextMenu,{signal:n}),t&&(e.addEventListener("focusin",s=>{this.#n._focusEventsAllowed=!1,stopEvent(s)},{capture:!0,signal:n}),e.addEventListener("focusout",s=>{this.#n._focusEventsAllowed=!0,stopEvent(s)},{capture:!0,signal:n})),e.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:n});const r=s=>{s.preventDefault(),e===this.#t?this.edit():this.#n.toggleComment(!0)};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",s=>{s.target===e&&s.key==="Enter"&&(this.#i=!0,r(s))},{signal:n}),e.addEventListener("pointerenter",()=>{this.#n.toggleComment(!1,!0)},{signal:n}),e.addEventListener("pointerleave",()=>{this.#n.toggleComment(!1,!1)},{signal:n}),e}edit(e){const t=this.commentPopupPositionInLayer;let n,r;if(t)[n,r]=t;else{[n,r]=this.#n.commentButtonPosition;const{width:h,height:p,x:m,y:g}=this.#n;n=m+n*h,r=g+r*p}const s=this.#n.parent.boundingClientRect,{x:a,y:l,width:u,height:d}=s;this.#n._uiManager.editComment(this.#n,a+n*u,l+r*d,{...e,parentDimensions:s})}finish(){this.#t&&(this.#t.focus({focusVisible:this.#i}),this.#i=!1)}isDeleted(){return this.#l||this.#o===""}isEmpty(){return this.#o===null}hasBeenEdited(){return this.isDeleted()||this.#o!==this.#r}serialize(){return this.data}get data(){return{text:this.#o,richText:this.#a,date:this.#s,deleted:this.isDeleted()}}set data(e){if(e!==this.#o&&(this.#a=null),e===null){this.#o="",this.#l=!0;return}this.#o=e,this.#s=new Date,this.#l=!1}setInitialText(e,t=null){this.#r=e,this.data=e,this.#s=null,this.#a=t}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#e?.remove(),this.#e=null,this.#o="",this.#a=null,this.#s=null,this.#n=null,this.#i=!1,this.#l=!1}}class TouchManager{#e;#t=!1;#i=null;#n;#r;#a;#o;#s=null;#l;#c=null;#h;#d=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:r=null,onPinching:s=null,onPinchEnd:a=null,signal:l}){this.#e=e,this.#i=n,this.#n=t,this.#r=r,this.#a=s,this.#o=a,this.#h=new AbortController,this.#l=AbortSignal.any([l,this.#h.signal]),e.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#l})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/OutputScale.pixelRatio}#f(e){if(this.#n?.())return;if(e.touches.length===1){if(this.#s)return;const r=this.#s=new AbortController,s=AbortSignal.any([this.#l,r.signal]),a=this.#e,l={capture:!0,signal:s,passive:!1},u=d=>{d.pointerType==="touch"&&(this.#s?.abort(),this.#s=null)};a.addEventListener("pointerdown",d=>{d.pointerType==="touch"&&(stopEvent(d),u(d))},l),a.addEventListener("pointerup",u,l),a.addEventListener("pointercancel",u,l);return}if(!this.#d){this.#d=new AbortController;const r=AbortSignal.any([this.#l,this.#d.signal]),s=this.#e,a={signal:r,capture:!1,passive:!1};s.addEventListener("touchmove",this.#g.bind(this),a);const l=this.#p.bind(this);s.addEventListener("touchend",l,a),s.addEventListener("touchcancel",l,a),a.capture=!0,s.addEventListener("pointerdown",stopEvent,a),s.addEventListener("pointermove",stopEvent,a),s.addEventListener("pointercancel",stopEvent,a),s.addEventListener("pointerup",stopEvent,a),this.#r?.()}if(stopEvent(e),e.touches.length!==2||this.#i?.()){this.#c=null;return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),this.#c={touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#g(e){if(!this.#c||e.touches.length!==2)return;stopEvent(e);let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);const{screenX:r,screenY:s}=t,{screenX:a,screenY:l}=n,u=this.#c,{touch0X:d,touch0Y:h,touch1X:p,touch1Y:m}=u,g=p-d,v=m-h,_=a-r,b=l-s,E=Math.hypot(_,b)||1,A=Math.hypot(g,v)||1;if(!this.#t&&Math.abs(A-E)<=TouchManager.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(u.touch0X=r,u.touch0Y=s,u.touch1X=a,u.touch1Y=l,!this.#t){this.#t=!0;return}const z=[(r+a)/2,(s+l)/2];this.#a?.(z,A,E)}#p(e){e.touches.length>=2||(this.#d&&(this.#d.abort(),this.#d=null,this.#o?.()),this.#c&&(stopEvent(e),this.#c=null,this.#t=!1))}destroy(){this.#h?.abort(),this.#h=null,this.#s?.abort(),this.#s=null}}class AnnotationEditor{#e=null;#t=null;#i=null;#n=null;#r=null;#a=!1;#o=null;#s="";#l=null;#c=null;#h=null;#d=null;#f=null;#g="";#p=!1;#u=null;#m=!1;#y=!1;#b=!1;#v=null;#w=0;#x=0;#_=null;#P=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#E=!1;#A=AnnotationEditor._zIndex++;static _borderLineWidth=-1;static _colorManager=new ColorManager;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=AnnotationEditor.prototype._resizeWithKeyboard,t=AnnotationEditorUIManager.TRANSLATE_SMALL,n=AnnotationEditorUIManager.TRANSLATE_BIG;return shadow(this,"_resizerKeyboardManager",new KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],AnnotationEditor.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null;const{rotation:t,rawDims:{pageWidth:n,pageHeight:r,pageX:s,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,r],this.pageTranslation=[s,a];const[l,u]=this.parentDimensions;this.x=e.x/l,this.y=e.y/u,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return shadow(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new FakeEditor({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(AnnotationEditor._l10n??=e,AnnotationEditor._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),AnnotationEditor._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);AnnotationEditor._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){unreachable("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#E}set _isDraggable(e){this.#E=e,this.div?.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#A}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(this.#V(),this.#d?.remove(),this.#d=null),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#p?this.#p=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,r){const[s,a]=this.parentDimensions;[n,r]=this.screenToPageTranslation(n,r),this.x=(e+n)/s,this.y=(t+r)/a,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[n,r]=this.parentDimensions;this.setAt(e*n,t*r,this.width*n,this.height*r),this._onTranslated()}#I([e,t],n,r){[n,r]=this.screenToPageTranslation(n,r),this.x+=n/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#I(this.parentDimensions,e,t)}translateInPage(e,t){this.#u||=[this.x,this.y,this.width,this.height],this.#I(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){this.#u||=[this.x,this.y,this.width,this.height];const{div:n,parentDimensions:[r,s]}=this;if(this.x+=e/r,this.y+=t/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:p,y:m}=this.div.getBoundingClientRect();this.parent.findNewParent(this,p,m)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:l}=this;const[u,d]=this.getBaseTranslation();a+=u,l+=d;const{style:h}=n;h.left=`${(100*a).toFixed(2)}%`,h.top=`${(100*l).toFixed(2)}%`,this._onTranslating(a,l),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#u&&(this.#u[0]!==this.x||this.#u[1]!==this.y)}get _hasBeenResized(){return!!this.#u&&(this.#u[2]!==this.width||this.#u[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=AnnotationEditor,r=n/e,s=n/t;switch(this.rotation){case 90:return[-r,s];case 180:return[r,s];case 270:return[r,-s];default:return[-r,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[n,r]}=this;let{x:s,y:a,width:l,height:u}=this;if(l*=n,u*=r,s*=n,a*=r,this._mustFixPosition)switch(e){case 0:s=MathClamp(s,0,n-l),a=MathClamp(a,0,r-u);break;case 90:s=MathClamp(s,0,n-u),a=MathClamp(a,l,r);break;case 180:s=MathClamp(s,l,n),a=MathClamp(a,u,r);break;case 270:s=MathClamp(s,u,n),a=MathClamp(a,0,r-l);break}this.x=s/=n,this.y=a/=r;const[d,h]=this.getBaseTranslation();s+=d,a+=h,t.left=`${(100*s).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}static#S(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return AnnotationEditor.#S(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return AnnotationEditor.#S(e,t,360-this.parentRotation)}#R(e){switch(e){case 90:{const[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(){const{div:{style:e},width:t,height:n}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#L(){if(this.#l)return;this.#l=document.createElement("div"),this.#l.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const r=document.createElement("div");this.#l.append(r),r.classList.add("resizer",n),r.setAttribute("data-resizer-name",n),r.addEventListener("pointerdown",this.#M.bind(this,n),{signal:t}),r.addEventListener("contextmenu",noContextMenu,{signal:t}),r.tabIndex=-1}this.div.prepend(this.#l)}#M(e,t){t.preventDefault();const{isMac:n}=util_FeatureTest.platform;if(t.button!==0||t.ctrlKey&&n)return;this.#i?.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,this.#c=[t.screenX,t.screenY];const s=new AbortController,a=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#k.bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",stopEvent,{passive:!1,signal:a}),window.addEventListener("contextmenu",noContextMenu,{signal:a}),this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const l=this.parent.div.style.cursor,u=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const d=()=>{s.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=l,this.div.style.cursor=u,this.#D()};window.addEventListener("pointerup",d,{signal:a}),window.addEventListener("blur",d,{signal:a})}#N(e,t,n,r){this.width=n,this.height=r,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#D(){if(!this.#h)return;const{savedX:e,savedY:t,savedWidth:n,savedHeight:r}=this.#h;this.#h=null;const s=this.x,a=this.y,l=this.width,u=this.height;s===e&&a===t&&l===n&&u===r||this.addCommands({cmd:this.#N.bind(this,s,a,l,u),undo:this.#N.bind(this,e,t,n,r),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#k(e,t){const[n,r]=this.parentDimensions,s=this.x,a=this.y,l=this.width,u=this.height,d=AnnotationEditor.MIN_SIZE/n,h=AnnotationEditor.MIN_SIZE/r,p=this.#R(this.rotation),m=(le,ue)=>[p[0]*le+p[2]*ue,p[1]*le+p[3]*ue],g=this.#R(360-this.rotation),v=(le,ue)=>[g[0]*le+g[2]*ue,g[1]*le+g[3]*ue];let _,b,E=!1,A=!1;switch(e){case"topLeft":E=!0,_=(le,ue)=>[0,0],b=(le,ue)=>[le,ue];break;case"topMiddle":_=(le,ue)=>[le/2,0],b=(le,ue)=>[le/2,ue];break;case"topRight":E=!0,_=(le,ue)=>[le,0],b=(le,ue)=>[0,ue];break;case"middleRight":A=!0,_=(le,ue)=>[le,ue/2],b=(le,ue)=>[0,ue/2];break;case"bottomRight":E=!0,_=(le,ue)=>[le,ue],b=(le,ue)=>[0,0];break;case"bottomMiddle":_=(le,ue)=>[le/2,ue],b=(le,ue)=>[le/2,0];break;case"bottomLeft":E=!0,_=(le,ue)=>[0,ue],b=(le,ue)=>[le,0];break;case"middleLeft":A=!0,_=(le,ue)=>[0,ue/2],b=(le,ue)=>[le,ue/2];break}const z=_(l,u),D=b(l,u);let P=m(...D);const G=AnnotationEditor._round(s+P[0]),R=AnnotationEditor._round(a+P[1]);let I=1,w=1,H,V;if(t.fromKeyboard)({deltaX:H,deltaY:V}=t);else{const{screenX:le,screenY:ue}=t,[oe,ee]=this.#c;[H,V]=this.screenToPageTranslation(le-oe,ue-ee),this.#c[0]=le,this.#c[1]=ue}if([H,V]=v(H/n,V/r),E){const le=Math.hypot(l,u);I=w=Math.max(Math.min(Math.hypot(D[0]-z[0]-H,D[1]-z[1]-V)/le,1/l,1/u),d/l,h/u)}else A?I=MathClamp(Math.abs(D[0]-z[0]-H),d,1)/l:w=MathClamp(Math.abs(D[1]-z[1]-V),h,1)/u;const te=AnnotationEditor._round(l*I),ae=AnnotationEditor._round(u*w);P=m(...b(te,ae));const be=G-P[0],_e=R-P[1];this.#u||=[this.x,this.y,this.width,this.height],this.width=te,this.height=ae,this.x=be,this.y=_e,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#y)return this._editToolbar;this._editToolbar=new EditorToolbar(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,n]of e)await this._editToolbar.addButton(t,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#i?.destroy()}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#i||(AltText.initialize(AnnotationEditor._l10n),this.#i=new AltText(this),this.#e&&(this.#i.data=this.#e,this.#e=null)),this.#i}get altTextData(){return this.#i?.data}set altTextData(e){this.#i&&(this.#i.data=e)}get guessedAltText(){return this.#i?.guessedText}async setGuessedAltText(e){await this.#i?.setGuessedText(e)}serializeAltText(e){return this.#i?.serialize(e)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}focusCommentButton(){this.#n?.focusButton()}addCommentButton(){return this.#n||=new Comment(this)}addStandaloneCommentButton(){if(this.#r){this._uiManager.isEditingMode()&&this.#r.classList.remove("hidden");return}this.hasComment&&(this.#r=this.#n.renderForStandalone(),this.div.append(this.#r))}removeStandaloneCommentButton(){this.#n.removeStandaloneCommentButton(),this.#r=null}hideStandaloneCommentButton(){this.#r?.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:n,deleted:r}}=this.#n;return{text:t,richText:e,date:n,deleted:r,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){this.#n||=new Comment(this),this.#n.data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:n}){if(!t||(this.#n||=new Comment(this),this.#n.setInitialText(e,n),!this.annotationElementId))return;const r=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);r&&this.updateFromAnnotationLayer(r)}get hasEditedComment(){return this.#n?.hasBeenEdited()}get hasDeletedComment(){return this.#n?.isDeleted()}get hasComment(){return!!this.#n&&!this.#n.isEmpty()&&!this.#n.isDeleted()}async editComment(e){this.#n||=new Comment(this),this.#n.edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){this.#n.setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,r]=e.rect,[s]=this.pageDimensions,[a]=this.pageTranslation,l=a+s+1,u=r-100,d=l+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[l,u,d,r]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){this.#n.data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=this.#a?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),this.#H();const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*n/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[r,s]=this.getInitialTranslation();return this.translate(r,s),bindEvents(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#P||=new TouchManager({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#B.bind(this),onPinching:this.#C.bind(this),onPinchEnd:this.#T.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),e}#B(){this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#i?.toggle(!1),this.parent.togglePointerEvents(!1)}#C(e,t,n){let s=.7*(n/t)+1-.7;if(s===1)return;const a=this.#R(this.rotation),l=(G,R)=>[a[0]*G+a[2]*R,a[1]*G+a[3]*R],[u,d]=this.parentDimensions,h=this.x,p=this.y,m=this.width,g=this.height,v=AnnotationEditor.MIN_SIZE/u,_=AnnotationEditor.MIN_SIZE/d;s=Math.max(Math.min(s,1/m,1/g),v/m,_/g);const b=AnnotationEditor._round(m*s),E=AnnotationEditor._round(g*s);if(b===m&&E===g)return;this.#u||=[h,p,m,g];const A=l(m/2,g/2),z=AnnotationEditor._round(h+A[0]),D=AnnotationEditor._round(p+A[1]),P=l(b/2,E/2);this.x=z-P[0],this.y=D-P[1],this.width=b,this.height=E,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#T(){this.#i?.toggle(!0),this.parent.togglePointerEvents(!0),this.#D()}pointerdown(e){const{isMac:t}=util_FeatureTest.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#p=!0,this._isDraggable){this.#j(e);return}this.#F(e)}#F(e){const{isMac:t}=util_FeatureTest.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#j(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1;const r=new AbortController,s=this._uiManager.combinedSignal(r),a={capture:!0,passive:!1,signal:s},l=d=>{r.abort(),this.#o=null,this.#p=!1,this._uiManager.endDragSession()||this.#F(d),n&&this._onStopDragging()};t&&(this.#w=e.clientX,this.#x=e.clientY,this.#o=e.pointerId,this.#s=e.pointerType,window.addEventListener("pointermove",d=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:h,clientY:p,pointerId:m}=d;if(m!==this.#o){stopEvent(d);return}const[g,v]=this.screenToPageTranslation(h-this.#w,p-this.#x);this.#w=h,this.#x=p,this._uiManager.dragSelectedEditors(g,v)},a),window.addEventListener("touchmove",stopEvent,a),window.addEventListener("pointerdown",d=>{d.pointerType===this.#s&&(this.#P||d.isPrimary)&&l(d),stopEvent(d)},a));const u=d=>{if(!this.#o||this.#o===d.pointerId){l(d);return}stopEvent(d)};window.addEventListener("pointerup",u,{signal:s}),window.addEventListener("blur",u,{signal:s})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#v&&clearTimeout(this.#v),this.#v=setTimeout(()=>{this.#v=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){const r=this.parentScale,[s,a]=this.pageDimensions,[l,u]=this.pageTranslation,d=e/r,h=t/r,p=this.x*s,m=this.y*a,g=this.width*s,v=this.height*a;switch(n){case 0:return[p+d+l,a-m-h-v+u,p+d+g+l,a-m-h+u];case 90:return[p+h+l,a-m+d+u,p+h+v+l,a-m+d+g+u];case 180:return[p-d-g+l,a-m+h+u,p-d+l,a-m+h+v+u];case 270:return[p-h-v+l,a-m-d-g+u,p-h+l,a-m-d+u];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,r,s,a]=e,l=s-n,u=a-r;switch(this.rotation){case 0:return[n,t-a,l,u];case 90:return[n,t-r,u,l];case 180:return[s,t-r,l,u];case 270:return[s,t-a,u,l];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&AnnotationEditor._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#n?.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:n,opacity:r,deleted:s,richText:a},uid:l,pageIndex:u,creationDate:d,modificationDate:h}=this;return{id:l,pageIndex:u,rect:this.getPDFRect(),richText:a,contentsObj:{str:e},creationDate:d,modificationDate:n||h,popupRef:!s,color:t,opacity:r}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#y=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#y=!1,!0):!1}isInEditMode(){return this.#y}shouldGetKeyboardEvents(){return this.#b}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:n,right:r}=this.getClientDimensions(),{innerHeight:s,innerWidth:a}=window;return t<a&&r>0&&e<s&&n>0}#H(){if(this.#f||!this.div)return;this.#f=new AbortController;const e=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#H()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(e,t,n){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});r.rotation=e.rotation,r.#e=e.accessibilityData,r._isCopy=e.isCopy||!1;const[s,a]=r.pageDimensions,[l,u,d,h]=r.getRectInCurrentCoords(e.rect,a);return r.x=l/s,r.y=u/a,r.width=d/s,r.height=h/a,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#v&&(clearTimeout(this.#v),this.#v=null),this.#V(),this.removeEditToolbar(),this.#_){for(const e of this.#_.values())clearTimeout(e);this.#_=null}this.parent=null,this.#P?.destroy(),this.#P=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#L(),this.#l.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[n,r,s,a]=this.getPDFRect();return[AnnotationEditor._round(n+(s-n)*e),AnnotationEditor._round(r+(a-r)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#n.commentPopupPositionInLayer}set commentPopupPosition(e){this.#n.commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return this.#n.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#n.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){this.#n.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#h={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#l.children;if(!this.#t){this.#t=Array.from(t);const a=this.#W.bind(this),l=this.#G.bind(this),u=this._uiManager._signal;for(const d of this.#t){const h=d.getAttribute("data-resizer-name");d.setAttribute("role","spinbutton"),d.addEventListener("keydown",a,{signal:u}),d.addEventListener("blur",l,{signal:u}),d.addEventListener("focus",this.#K.bind(this,h),{signal:u}),d.setAttribute("data-l10n-id",AnnotationEditor._l10nResizer[h])}}const n=this.#t[0];let r=0;for(const a of t){if(a===n)break;r++}const s=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(s!==r){if(s<r)for(let l=0;l<r-s;l++)this.#l.append(this.#l.firstChild);else if(s>r)for(let l=0;l<s-r;l++)this.#l.firstChild.before(this.#l.lastChild);let a=0;for(const l of t){const d=this.#t[a++].getAttribute("data-resizer-name");l.setAttribute("data-l10n-id",AnnotationEditor._l10nResizer[d])}}this.#q(0),this.#b=!0,this.#l.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#W(e){AnnotationEditor._resizerKeyboardManager.exec(this,e)}#G(e){this.#b&&e.relatedTarget?.parentNode!==this.#l&&this.#V()}#K(e){this.#g=this.#b?e:""}#q(e){if(this.#t)for(const t of this.#t)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#b&&this.#k(this.#g,{deltaX:e,deltaY:t,fromKeyboard:!0})}#V(){this.#b=!1,this.#q(-1),this.#D()}_stopResizingWithKeyboard(){this.#V(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#l?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0),this.hasComment&&this._uiManager.toggleComment(this,!1,!1))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#m}set isEditing(e){this.#m=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#_||=new Map;const{action:n}=e;let r=this.#_.get(n);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),this.#_.delete(n),this.#_.size===0&&(this.#_=null)},AnnotationEditor._telemetryTimeout),this.#_.set(n,r);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#a=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#a=!0}updateFakeAnnotationElement(e){if(!this.#d&&!this.deleted){this.#d=e.addFakeAnnotation(this);return}if(this.deleted){this.#d.remove(),this.#d=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#d.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}}class FakeEditor extends AnnotationEditor{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const SEED=3285377520,MASK_HIGH=4294901760,MASK_LOW=65535;class MurmurHash3_64{constructor(e){this.h1=e?e&4294967295:SEED,this.h2=e?e&4294967295:SEED}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let _=0,b=e.length;_<b;_++){const E=e.charCodeAt(_);E<=255?t[n++]=E:(t[n++]=E>>>8,t[n++]=E&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=n>>2,s=n-r*4,a=new Uint32Array(t.buffer,0,r);let l=0,u=0,d=this.h1,h=this.h2;const p=3432918353,m=461845907,g=p&MASK_LOW,v=m&MASK_LOW;for(let _=0;_<r;_++)_&1?(l=a[_],l=l*p&MASK_HIGH|l*g&MASK_LOW,l=l<<15|l>>>17,l=l*m&MASK_HIGH|l*v&MASK_LOW,d^=l,d=d<<13|d>>>19,d=d*5+3864292196):(u=a[_],u=u*p&MASK_HIGH|u*g&MASK_LOW,u=u<<15|u>>>17,u=u*m&MASK_HIGH|u*v&MASK_LOW,h^=u,h=h<<13|h>>>19,h=h*5+3864292196);switch(l=0,s){case 3:l^=t[r*4+2]<<16;case 2:l^=t[r*4+1]<<8;case 1:l^=t[r*4],l=l*p&MASK_HIGH|l*g&MASK_LOW,l=l<<15|l>>>17,l=l*m&MASK_HIGH|l*v&MASK_LOW,r&1?d^=l:h^=l}this.h1=d,this.h2=h}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&MASK_HIGH|e*36045&MASK_LOW,t=t*4283543511&MASK_HIGH|((t<<16|e>>>16)*2950163797&MASK_HIGH)>>>16,e^=t>>>1,e=e*444984403&MASK_HIGH|e*60499&MASK_LOW,t=t*3301882366&MASK_HIGH|((t<<16|e>>>16)*3120437893&MASK_HIGH)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const SerializableEmpty=Object.freeze({map:null,hash:"",transfer:void 0});class AnnotationStorage{#e=!1;#t=null;#i=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=this.#n.get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return this.#n.get(e)}remove(e){const t=this.#n.get(e);if(t!==void 0&&(t instanceof AnnotationEditor&&this.#i.delete(t.annotationElementId),this.#n.delete(e),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const n of this.#n.values())if(n instanceof AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=this.#n.get(e);let r=!1;if(n!==void 0)for(const[s,a]of Object.entries(t))n[s]!==a&&(r=!0,n[s]=a);else r=!0,this.#n.set(e,t);r&&this.#r(),t instanceof AnnotationEditor&&((this.#i||=new Map).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return this.#n.has(e)}get size(){return this.#n.size}#r(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new PrintAnnotationStorage(this)}get serializable(){if(this.#n.size===0)return SerializableEmpty;const e=new Map,t=new MurmurHash3_64,n=[],r=Object.create(null);let s=!1;for(const[a,l]of this.#n){const u=l instanceof AnnotationEditor?l.serialize(!1,r):l;u&&(e.set(a,u),t.update(`${a}:${JSON.stringify(u)}`),s||=!!u.bitmap)}if(s)for(const a of e.values())a.bitmap&&n.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:SerializableEmpty}get editorStats(){let e=null;const t=new Map;let n=0,r=0;for(const s of this.#n.values()){if(!(s instanceof AnnotationEditor)){s.popup&&(s.popup.deleted?r+=1:n+=1);continue}s.isCommentDeleted?r+=1:s.hasEditedComment&&(n+=1);const a=s.telemetryFinalData;if(!a)continue;const{type:l}=a;t.has(l)||t.set(l,Object.getPrototypeOf(s).constructor),e||=Object.create(null);const u=e[l]||=new Map;for(const[d,h]of Object.entries(a)){if(d==="type")continue;let p=u.get(d);p||(p=new Map,u.set(d,p));const m=p.get(h)??0;p.set(h,m+1)}}if((r>0||n>0)&&(e||=Object.create(null),e.comments={deleted:r,edited:n}),!e)return null;for(const[s,a]of t)e[s]=a.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){this.#t=null}updateEditor(e,t){const n=this.#i?.get(e);return n?(n.updateFromAnnotationLayer(t),!0):!1}getEditor(e){return this.#i?.get(e)||null}get modifiedIds(){if(this.#t)return this.#t;const e=[];if(this.#i)for(const t of this.#i.values())t.serialize()&&e.push(t.annotationElementId);return this.#t={ids:new Set(e),hash:e.join(",")}}[Symbol.iterator](){return this.#n.entries()}}class PrintAnnotationStorage extends AnnotationStorage{#e;constructor(e){super();const{map:t,hash:n,transfer:r}=e.serializable,s=structuredClone(t,r?{transfer:r}:null);this.#e={map:s,hash:n,transfer:r}}get print(){unreachable("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return shadow(this,"modifiedIds",{ids:new Set,hash:""})}}class FontLoader{#e=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:n}){if(!(!e||this.#e.has(e.loadedName))){if(assert(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:r,src:s,style:a}=e,l=new FontFace(r,s,a);this.addNativeFontFace(l);try{await l.load(),this.#e.add(r),n?.(e)}catch{warn(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(l)}return}unreachable("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(r){throw warn(`Failed to load font '${n.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const r=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return shadow(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return shadow(this,"isSyncFontLoadingSupported",isNodeJS||util_FeatureTest.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(assert(!r.done,"completeRequest() cannot be called twice."),r.done=!0;n.length>0&&n[0].done;){const s=n.shift();setTimeout(s.callback,0)}}const{loadingRequests:n}=this,r={done:!1,complete:t,callback:e};return n.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return shadow(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(D,P){return D.charCodeAt(P)<<24|D.charCodeAt(P+1)<<16|D.charCodeAt(P+2)<<8|D.charCodeAt(P+3)&255}function r(D,P,G,R){const I=D.substring(0,P),w=D.substring(P+G);return I+R+w}let s,a;const l=this._document.createElement("canvas");l.width=1,l.height=1;const u=l.getContext("2d");let d=0;function h(D,P){if(++d>30){warn("Load test font never loaded."),P();return}if(u.font="30px "+D,u.fillText(".",0,20),u.getImageData(0,0,1,1).data[3]>0){P();return}setTimeout(h.bind(null,D,P))}const p=`lt${Date.now()}${this.loadTestFontId++}`;let m=this._loadTestFont;m=r(m,976,p.length,p);const v=16,_=1482184792;let b=n(m,v);for(s=0,a=p.length-3;s<a;s+=4)b=b-_+n(p,s)|0;s<p.length&&(b=b-_+n(p+"XXX",s)|0),m=r(m,v,4,string32(b));const E=`url(data:font/opentype;base64,${btoa(m)});`,A=`@font-face {font-family:"${p}";src:${E}}`;this.insertRule(A);const z=this._document.createElement("div");z.style.visibility="hidden",z.style.width=z.style.height="10px",z.style.position="absolute",z.style.top=z.style.left="0px";for(const D of[e.loadedName,p]){const P=this._document.createElement("span");P.textContent="Hi",P.style.fontFamily=D,z.append(P)}this._document.body.append(z),h(p,()=>{z.remove(),t.complete()})}}class FontFaceObject{#e;constructor(e,t=null,n,r){this.compiledGlyphs=Object.create(null),this.#e=e,this._inspectFont=t,n&&Object.assign(this,n),r&&(this.charProcOperatorList=r)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${toBase64Util(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const n=this.loadedName+"_path_"+t;let r;try{r=e.get(n)}catch(a){warn(`getPathGenerator - ignoring character: "${a}".`)}const s=new Path2D(r||"");return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=s}get black(){return this.#e.black}get bold(){return this.#e.bold}get disableFontFace(){return this.#e.disableFontFace??!1}get fontExtraProperties(){return this.#e.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#e.isInvalidPDFjsFont}get isType3Font(){return this.#e.isType3Font}get italic(){return this.#e.italic}get missingFile(){return this.#e.missingFile}get remeasure(){return this.#e.remeasure}get vertical(){return this.#e.vertical}get ascent(){return this.#e.ascent}get defaultWidth(){return this.#e.defaultWidth}get descent(){return this.#e.descent}get bbox(){return this.#e.bbox}get fontMatrix(){return this.#e.fontMatrix}get fallbackName(){return this.#e.fallbackName}get loadedName(){return this.#e.loadedName}get mimetype(){return this.#e.mimetype}get name(){return this.#e.name}get data(){return this.#e.data}clearData(){this.#e.clearData()}get cssFontInfo(){return this.#e.cssFontInfo}get systemFontInfo(){return this.#e.systemFontInfo}get defaultVMetrics(){return this.#e.defaultVMetrics}}function getUrlProp(i){if(i instanceof URL)return i.href;if(typeof i=="string"){if(isNodeJS)return i;const e=URL.parse(i,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(i){if(isNodeJS&&typeof Buffer<"u"&&i instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength)return i;if(typeof i=="string")return stringToBytes(i);if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)||typeof i=="object"&&!isNaN(i?.length))return new Uint8Array(i);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function getFactoryUrlProp(i){if(typeof i!="string")return null;if(i.endsWith("/"))return i;throw new Error(`Invalid factory url: "${i}" must include trailing slash.`)}const isRefProxy=i=>typeof i=="object"&&Number.isInteger(i?.num)&&i.num>=0&&Number.isInteger(i?.gen)&&i.gen>=0,isNameProxy=i=>typeof i=="object"&&typeof i?.name=="string",isValidExplicitDest=_isValidExplicitDest.bind(null,isRefProxy,isNameProxy);class LoopbackPort{#e=new Map;#t=Promise.resolve();postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};this.#t.then(()=>{for(const[r]of this.#e)r.call(this,n)})}addEventListener(e,t,n=null){let r=null;if(n?.signal instanceof AbortSignal){const{signal:s}=n;if(s.aborted){warn("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);r=()=>s.removeEventListener("abort",a),s.addEventListener("abort",a)}this.#e.set(t,r)}removeEventListener(e,t){this.#e.get(t)?.(),this.#e.delete(t)}terminate(){for(const[,e]of this.#e)e?.();this.#e.clear()}}const CallbackKind={DATA:1,ERROR:2},StreamKind={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function onFn(){}function wrapReason(i){if(i instanceof AbortException||i instanceof InvalidPDFException||i instanceof PasswordException||i instanceof ResponseException||i instanceof UnknownErrorException)return i;switch(i instanceof Error||typeof i=="object"&&i!==null||unreachable('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),i.name){case"AbortException":return new AbortException(i.message);case"InvalidPDFException":return new InvalidPDFException(i.message);case"PasswordException":return new PasswordException(i.message,i.code);case"ResponseException":return new ResponseException(i.message,i.status,i.missing);case"UnknownErrorException":return new UnknownErrorException(i.message,i.details)}return new UnknownErrorException(i.message,i.toString())}class MessageHandler{#e=new AbortController;constructor(e,t,n){this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#n(e);return}if(e.callback){const n=e.callbackId,r=this.callbackCapabilities[n];if(!r)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===CallbackKind.DATA)r.resolve(e.data);else if(e.callback===CallbackKind.ERROR)r.reject(wrapReason(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const n=this.sourceName,r=e.sourceName,s=this.comObj;Promise.try(t,e.data).then(function(a){s.postMessage({sourceName:n,targetName:r,callback:CallbackKind.DATA,callbackId:e.callbackId,data:a})},function(a){s.postMessage({sourceName:n,targetName:r,callback:CallbackKind.ERROR,callbackId:e.callbackId,reason:wrapReason(a)})});return}if(e.streamId){this.#i(e);return}t(e.data)}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const r=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[r]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},n)}catch(a){s.reject(a)}return s.promise}sendWithStream(e,t,n,r){const s=this.streamId++,a=this.sourceName,l=this.targetName,u=this.comObj;return new ReadableStream({start:d=>{const h=Promise.withResolvers();return this.streamControllers[s]={controller:d,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},u.postMessage({sourceName:a,targetName:l,action:e,streamId:s,data:t,desiredSize:d.desiredSize},r),h.promise},pull:d=>{const h=Promise.withResolvers();return this.streamControllers[s].pullCall=h,u.postMessage({sourceName:a,targetName:l,stream:StreamKind.PULL,streamId:s,desiredSize:d.desiredSize}),h.promise},cancel:d=>{assert(d instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[s].cancelCall=h,this.streamControllers[s].isClosed=!0,u.postMessage({sourceName:a,targetName:l,stream:StreamKind.CANCEL,streamId:s,reason:wrapReason(d)}),h.promise}},n)}#i(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,s=this.comObj,a=this,l=this.actionHandler[e.action],u={enqueue(d,h=1,p){if(this.isCancelled)return;const m=this.desiredSize;this.desiredSize-=h,m>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:n,targetName:r,stream:StreamKind.ENQUEUE,streamId:t,chunk:d},p)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:n,targetName:r,stream:StreamKind.CLOSE,streamId:t}),delete a.streamSinks[t])},error(d){assert(d instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,s.postMessage({sourceName:n,targetName:r,stream:StreamKind.ERROR,streamId:t,reason:wrapReason(d)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};u.sinkCapability.resolve(),u.ready=u.sinkCapability.promise,this.streamSinks[t]=u,Promise.try(l,e.data,u).then(function(){s.postMessage({sourceName:n,targetName:r,stream:StreamKind.START_COMPLETE,streamId:t,success:!0})},function(d){s.postMessage({sourceName:n,targetName:r,stream:StreamKind.START_COMPLETE,streamId:t,reason:wrapReason(d)})})}#n(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,s=this.comObj,a=this.streamControllers[t],l=this.streamSinks[t];switch(e.stream){case StreamKind.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(wrapReason(e.reason));break;case StreamKind.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(wrapReason(e.reason));break;case StreamKind.PULL:if(!l){s.postMessage({sourceName:n,targetName:r,stream:StreamKind.PULL_COMPLETE,streamId:t,success:!0});break}l.desiredSize<=0&&e.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=e.desiredSize,Promise.try(l.onPull||onFn).then(function(){s.postMessage({sourceName:n,targetName:r,stream:StreamKind.PULL_COMPLETE,streamId:t,success:!0})},function(d){s.postMessage({sourceName:n,targetName:r,stream:StreamKind.PULL_COMPLETE,streamId:t,reason:wrapReason(d)})});break;case StreamKind.ENQUEUE:if(assert(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case StreamKind.CLOSE:if(assert(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),this.#r(a,t);break;case StreamKind.ERROR:assert(a,"error should have stream controller"),a.controller.error(wrapReason(e.reason)),this.#r(a,t);break;case StreamKind.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(wrapReason(e.reason)),this.#r(a,t);break;case StreamKind.CANCEL:if(!l)break;const u=wrapReason(e.reason);Promise.try(l.onCancel||onFn,u).then(function(){s.postMessage({sourceName:n,targetName:r,stream:StreamKind.CANCEL_COMPLETE,streamId:t,success:!0})},function(d){s.postMessage({sourceName:n,targetName:r,stream:StreamKind.CANCEL_COMPLETE,streamId:t,reason:wrapReason(d)})}),l.sinkCapability.reject(u),l.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#r(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#e?.abort(),this.#e=null}}class BaseCanvasFactory{#e=!1;constructor({enableHWA:e=!1}){this.#e=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!this.#e})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){unreachable("Abstract method `_createCanvas` called.")}}class DOMCanvasFactory extends BaseCanvasFactory{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}class BaseCMapReaderFactory{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){unreachable("Abstract method `_fetch` called.")}}class DOMCMapReaderFactory extends BaseCMapReaderFactory{async _fetch(e){const t=await fetchData(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):stringToBytes(t)}}class BaseFilterFactory{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,r,s){return"none"}destroy(e=!1){}}class DOMFilterFactory extends BaseFilterFactory{#e;#t;#i;#n;#r;#a;#o=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#n=e,this.#r=t}get#s(){return this.#t||=new Map}get#l(){return this.#a||=new Map}get#c(){if(!this.#i){const e=this.#r.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const n=this.#r.createElementNS(SVG_NS,"svg");n.setAttribute("width",0),n.setAttribute("height",0),this.#i=this.#r.createElementNS(SVG_NS,"defs"),e.append(n),n.append(this.#i),this.#r.body.append(e)}return this.#i}#h(e){if(e.length===1){const u=e[0],d=new Array(256);for(let p=0;p<256;p++)d[p]=u[p]/255;const h=d.join(",");return[h,h,h]}const[t,n,r]=e,s=new Array(256),a=new Array(256),l=new Array(256);for(let u=0;u<256;u++)s[u]=t[u]/255,a[u]=n[u]/255,l[u]=r[u]/255;return[s.join(","),a.join(","),l.join(",")]}#d(e){if(this.#e===void 0){this.#e="";const t=this.#r.URL;t!==this.#r.baseURI&&(isDataScheme(t)?warn('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=updateUrlHash(t,""))}return`url(${this.#e}#${e})`}addFilter(e){if(!e)return"none";let t=this.#s.get(e);if(t)return t;const[n,r,s]=this.#h(e),a=e.length===1?n:`${n}${r}${s}`;if(t=this.#s.get(a),t)return this.#s.set(e,t),t;const l=`g_${this.#n}_transfer_map_${this.#o++}`,u=this.#d(l);this.#s.set(e,u),this.#s.set(a,u);const d=this.#p(l);return this.#m(n,r,s,d),u}addHCMFilter(e,t){const n=`${e}-${t}`,r="base";let s=this.#l.get(r);if(s?.key===n||(s?(s.filter?.remove(),s.key=n,s.url="none",s.filter=null):(s={key:n,url:"none",filter:null},this.#l.set(r,s)),!e||!t))return s.url;const a=this.#b(e);e=Util.makeHexColor(...a);const l=this.#b(t);if(t=Util.makeHexColor(...l),this.#c.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return s.url;const u=new Array(256);for(let g=0;g<=255;g++){const v=g/255;u[g]=v<=.03928?v/12.92:((v+.055)/1.055)**2.4}const d=u.join(","),h=`g_${this.#n}_hcm_filter`,p=s.filter=this.#p(h);this.#m(d,d,d,p),this.#g(p);const m=(g,v)=>{const _=a[g]/255,b=l[g]/255,E=new Array(v+1);for(let A=0;A<=v;A++)E[A]=_+A/v*(b-_);return E.join(",")};return this.#m(m(0,5),m(1,5),m(2,5),p),s.url=this.#d(h),s.url}addAlphaFilter(e){let t=this.#s.get(e);if(t)return t;const[n]=this.#h([e]),r=`alpha_${n}`;if(t=this.#s.get(r),t)return this.#s.set(e,t),t;const s=`g_${this.#n}_alpha_map_${this.#o++}`,a=this.#d(s);this.#s.set(e,a),this.#s.set(r,a);const l=this.#p(s);return this.#y(n,l),a}addLuminosityFilter(e){let t=this.#s.get(e||"luminosity");if(t)return t;let n,r;if(e?([n]=this.#h([e]),r=`luminosity_${n}`):r="luminosity",t=this.#s.get(r),t)return this.#s.set(e,t),t;const s=`g_${this.#n}_luminosity_map_${this.#o++}`,a=this.#d(s);this.#s.set(e,a),this.#s.set(r,a);const l=this.#p(s);return this.#f(l),e&&this.#y(n,l),a}addHighlightHCMFilter(e,t,n,r,s){const a=`${t}-${n}-${r}-${s}`;let l=this.#l.get(e);if(l?.key===a||(l?(l.filter?.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},this.#l.set(e,l)),!t||!n))return l.url;const[u,d]=[t,n].map(this.#b.bind(this));let h=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),p=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[m,g]=[r,s].map(this.#b.bind(this));p<h&&([h,p,m,g]=[p,h,g,m]),this.#c.style.color="";const v=(E,A,z)=>{const D=new Array(256),P=(p-h)/z,G=E/255,R=(A-E)/(255*z);let I=0;for(let w=0;w<=z;w++){const H=Math.round(h+w*P),V=G+w*R;for(let te=I;te<=H;te++)D[te]=V;I=H+1}for(let w=I;w<256;w++)D[w]=D[I-1];return D.join(",")},_=`g_${this.#n}_hcm_${e}_filter`,b=l.filter=this.#p(_);return this.#g(b),this.#m(v(m[0],g[0],5),v(m[1],g[1],5),v(m[2],g[2],5),b),l.url=this.#d(_),l.url}destroy(e=!1){e&&this.#a?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#t?.clear(),this.#t=null,this.#a?.clear(),this.#a=null,this.#o=0)}#f(e){const t=this.#r.createElementNS(SVG_NS,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#g(e){const t=this.#r.createElementNS(SVG_NS,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#p(e){const t=this.#r.createElementNS(SVG_NS,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#c.append(t),t}#u(e,t,n){const r=this.#r.createElementNS(SVG_NS,t);r.setAttribute("type","discrete"),r.setAttribute("tableValues",n),e.append(r)}#m(e,t,n,r){const s=this.#r.createElementNS(SVG_NS,"feComponentTransfer");r.append(s),this.#u(s,"feFuncR",e),this.#u(s,"feFuncG",t),this.#u(s,"feFuncB",n)}#y(e,t){const n=this.#r.createElementNS(SVG_NS,"feComponentTransfer");t.append(n),this.#u(n,"feFuncA",e)}#b(e){return this.#c.style.color=e,getRGB(getComputedStyle(this.#c).getPropertyValue("color"))}}class BaseStandardFontDataFactory{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){unreachable("Abstract method `_fetch` called.")}}class DOMStandardFontDataFactory extends BaseStandardFontDataFactory{async _fetch(e){const t=await fetchData(e,"arraybuffer");return new Uint8Array(t)}}class BaseWasmFactory{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){unreachable("Abstract method `_fetch` called.")}}class DOMWasmFactory extends BaseWasmFactory{async _fetch(e){const t=await fetchData(e,"arraybuffer");return new Uint8Array(t)}}isNodeJS&&warn("Please use the `legacy` build in Node.js environments.");async function node_utils_fetchData(i){const t=await process.getBuiltinModule("fs").promises.readFile(i);return new Uint8Array(t)}class NodeFilterFactory extends BaseFilterFactory{}class NodeCanvasFactory extends BaseCanvasFactory{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class NodeCMapReaderFactory extends BaseCMapReaderFactory{async _fetch(e){return node_utils_fetchData(e)}}class NodeStandardFontDataFactory extends BaseStandardFontDataFactory{async _fetch(e){return node_utils_fetchData(e)}}class NodeWasmFactory extends BaseWasmFactory{async _fetch(e){return node_utils_fetchData(e)}}const FORCED_DEPENDENCY_LABEL="__forcedDependency",{floor,ceil}=Math;function expandBBox(i,e,t,n,r,s){i[e*4+0]=Math.min(i[e*4+0],t),i[e*4+1]=Math.min(i[e*4+1],n),i[e*4+2]=Math.max(i[e*4+2],r),i[e*4+3]=Math.max(i[e*4+3],s)}const EMPTY_BBOX=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class BBoxReader{#e;#t;constructor(e,t){this.#e=e,this.#t=t}get length(){return this.#e.length}isEmpty(e){return this.#e[e]===EMPTY_BBOX}minX(e){return this.#t[e*4+0]/256}minY(e){return this.#t[e*4+1]/256}maxX(e){return(this.#t[e*4+2]+1)/256}maxY(e){return(this.#t[e*4+3]+1)/256}}const ensureDebugMetadata=(i,e)=>{if(!i)return;let t=i.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},i.set(e,t)),t};class CanvasDependencyTracker{#e={__proto__:null};#t={__proto__:null,transform:[],moveText:[],sameLineText:[],[FORCED_DEPENDENCY_LABEL]:[]};#i=new Map;#n=[];#r=[];#a=[[1,0,0,1,0,0]];#o=[-1/0,-1/0,1/0,1/0];#s=new Float64Array([1/0,1/0,-1/0,-1/0]);#l=-1;#c=new Set;#h=new Map;#d=new Map;#f;#g;#p;#u;#m;constructor(e,t,n=!1){this.#f=e.width,this.#g=e.height,this.#y(t),n&&(this.#m=new Map)}growOperationsCount(e){e>=this.#u.length&&this.#y(e,this.#u)}#y(e,t){const n=new ArrayBuffer(e*4);this.#p=new Uint8ClampedArray(n),this.#u=new Uint32Array(n),t&&t.length>0?(this.#u.set(t),this.#u.fill(EMPTY_BBOX,t.length)):this.#u.fill(EMPTY_BBOX)}save(e){return this.#e={__proto__:this.#e},this.#t={__proto__:this.#t,transform:{__proto__:this.#t.transform},moveText:{__proto__:this.#t.moveText},sameLineText:{__proto__:this.#t.sameLineText},[FORCED_DEPENDENCY_LABEL]:{__proto__:this.#t[FORCED_DEPENDENCY_LABEL]}},this.#o={__proto__:this.#o},this.#n.push(e),this}restore(e){const t=Object.getPrototypeOf(this.#e);if(t===null)return this;this.#e=t,this.#t=Object.getPrototypeOf(this.#t),this.#o=Object.getPrototypeOf(this.#o);const n=this.#n.pop();return n!==void 0&&(ensureDebugMetadata(this.#m,e)?.dependencies.add(n),this.#u[e]=this.#u[n]),this}recordOpenMarker(e){return this.#n.push(e),this}getOpenMarker(){return this.#n.length===0?null:this.#n.at(-1)}recordCloseMarker(e){const t=this.#n.pop();return t!==void 0&&(ensureDebugMetadata(this.#m,e)?.dependencies.add(t),this.#u[e]=this.#u[t]),this}beginMarkedContent(e){return this.#r.push(e),this}endMarkedContent(e){const t=this.#r.pop();return t!==void 0&&(ensureDebugMetadata(this.#m,e)?.dependencies.add(t),this.#u[e]=this.#u[t]),this}pushBaseTransform(e){return this.#a.push(Util.multiplyByDOMMatrix(this.#a.at(-1),e.getTransform())),this}popBaseTransform(){return this.#a.length>1&&this.#a.pop(),this}recordSimpleData(e,t){return this.#e[e]=t,this}recordIncrementalData(e,t){return this.#t[e].push(t),this}resetIncrementalData(e,t){return this.#t[e].length=0,this}recordNamedData(e,t){return this.#i.set(e,t),this}recordSimpleDataFromNamed(e,t,n){this.#e[e]=this.#i.get(t)??n}recordFutureForcedDependency(e,t){return this.recordIncrementalData(FORCED_DEPENDENCY_LABEL,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in this.#e&&this.recordFutureForcedDependency(t,this.#e[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of this.#c)this.recordFutureForcedDependency(FORCED_DEPENDENCY_LABEL,e);return this}resetBBox(e){return this.#l!==e&&(this.#l=e,this.#s[0]=1/0,this.#s[1]=1/0,this.#s[2]=-1/0,this.#s[3]=-1/0),this}recordClipBox(e,t,n,r,s,a){const l=Util.multiplyByDOMMatrix(this.#a.at(-1),t.getTransform()),u=[1/0,1/0,-1/0,-1/0];Util.axialAlignedBoundingBox([n,s,r,a],l,u);const d=Util.intersect(this.#o,u);return d?(this.#o[0]=d[0],this.#o[1]=d[1],this.#o[2]=d[2],this.#o[3]=d[3]):(this.#o[0]=this.#o[1]=1/0,this.#o[2]=this.#o[3]=-1/0),this}recordBBox(e,t,n,r,s,a){const l=this.#o;if(l[0]===1/0)return this;const u=Util.multiplyByDOMMatrix(this.#a.at(-1),t.getTransform());if(l[0]===-1/0)return Util.axialAlignedBoundingBox([n,s,r,a],u,this.#s),this;const d=[1/0,1/0,-1/0,-1/0];return Util.axialAlignedBoundingBox([n,s,r,a],u,d),this.#s[0]=Math.min(this.#s[0],Math.max(d[0],l[0])),this.#s[1]=Math.min(this.#s[1],Math.max(d[1],l[1])),this.#s[2]=Math.max(this.#s[2],Math.min(d[2],l[2])),this.#s[3]=Math.max(this.#s[3],Math.min(d[3],l[3])),this}recordCharacterBBox(e,t,n,r=1,s=0,a=0,l){const u=n.bbox;let d,h;if(u&&(d=u[2]!==u[0]&&u[3]!==u[1]&&this.#d.get(n),d!==!1&&(h=[0,0,0,0],Util.axialAlignedBoundingBox(u,n.fontMatrix,h),(r!==1||s!==0||a!==0)&&Util.scaleMinMax([r,0,0,-r,s,a],h),d)))return this.recordBBox(e,t,h[0],h[2],h[1],h[3]);if(!l)return this.recordFullPageBBox(e);const p=l();return u&&h&&d===void 0&&(d=h[0]<=s-p.actualBoundingBoxLeft&&h[2]>=s+p.actualBoundingBoxRight&&h[1]<=a-p.actualBoundingBoxAscent&&h[3]>=a+p.actualBoundingBoxDescent,this.#d.set(n,d),d)?this.recordBBox(e,t,h[0],h[2],h[1],h[3]):this.recordBBox(e,t,s-p.actualBoundingBoxLeft,s+p.actualBoundingBoxRight,a-p.actualBoundingBoxAscent,a+p.actualBoundingBoxDescent)}recordFullPageBBox(e){return this.#s[0]=Math.max(0,this.#o[0]),this.#s[1]=Math.max(0,this.#o[1]),this.#s[2]=Math.min(this.#f,this.#o[2]),this.#s[3]=Math.min(this.#g,this.#o[3]),this}getSimpleIndex(e){return this.#e[e]}recordDependencies(e,t){const n=this.#c,r=this.#e,s=this.#t;for(const a of t)a in this.#e?n.add(r[a]):a in s&&s[a].forEach(n.add,n);return this}recordNamedDependency(e,t){return this.#i.has(t)&&this.#c.add(this.#i.get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[FORCED_DEPENDENCY_LABEL]),this.#m){const n=ensureDebugMetadata(this.#m,e),{dependencies:r}=n;this.#c.forEach(r.add,r),this.#n.forEach(r.add,r),this.#r.forEach(r.add,r),r.delete(e),n.isRenderingOperation=!0}if(this.#l===e){const n=floor(this.#s[0]*256/this.#f),r=floor(this.#s[1]*256/this.#g),s=ceil(this.#s[2]*256/this.#f),a=ceil(this.#s[3]*256/this.#g);expandBBox(this.#p,e,n,r,s,a);for(const l of this.#c)l!==e&&expandBBox(this.#p,l,n,r,s,a);for(const l of this.#n)l!==e&&expandBBox(this.#p,l,n,r,s,a);for(const l of this.#r)l!==e&&expandBBox(this.#p,l,n,r,s,a);t||(this.#c.clear(),this.#l=-1)}return this}recordShowTextOperation(e,t=!1){const n=Array.from(this.#c);this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const r of n)this.recordIncrementalData("sameLineText",r);return this}bboxToClipBoxDropOperation(e,t=!1){return this.#l===e&&(this.#l=-1,this.#o[0]=Math.max(this.#o[0],this.#s[0]),this.#o[1]=Math.max(this.#o[1],this.#s[1]),this.#o[2]=Math.min(this.#o[2],this.#s[2]),this.#o[3]=Math.min(this.#o[3],this.#s[3]),t||this.#c.clear()),this}_takePendingDependencies(){const e=this.#c;return this.#c=new Set,e}_extractOperation(e){const t=this.#h.get(e);return this.#h.delete(e),t}_pushPendingDependencies(e){for(const t of e)this.#c.add(t)}take(){return this.#d.clear(),new BBoxReader(this.#u,this.#p)}takeDebugMetadata(){return this.#m}}class CanvasNestedDependencyTracker{#e;#t;#i;#n=0;#r=0;constructor(e,t,n){if(e instanceof CanvasNestedDependencyTracker&&e.#i===!!n)return e;this.#e=e,this.#t=t,this.#i=!!n}growOperationsCount(){throw new Error("Unreachable")}save(e){return this.#r++,this.#e.save(this.#t),this}restore(e){return this.#r>0&&(this.#e.restore(this.#t),this.#r--),this}recordOpenMarker(e){return this.#n++,this}getOpenMarker(){return this.#n>0?this.#t:this.#e.getOpenMarker()}recordCloseMarker(e){return this.#n--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return this.#e.pushBaseTransform(e),this}popBaseTransform(){return this.#e.popBaseTransform(),this}recordSimpleData(e,t){return this.#e.recordSimpleData(e,this.#t),this}recordIncrementalData(e,t){return this.#e.recordIncrementalData(e,this.#t),this}resetIncrementalData(e,t){return this.#e.resetIncrementalData(e,this.#t),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,n){return this.#e.recordSimpleDataFromNamed(e,t,this.#t),this}recordFutureForcedDependency(e,t){return this.#e.recordFutureForcedDependency(e,this.#t),this}inheritSimpleDataAsFutureForcedDependencies(e){return this.#e.inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#e.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return this.#i||this.#e.resetBBox(this.#t),this}recordClipBox(e,t,n,r,s,a){return this.#i||this.#e.recordClipBox(this.#t,t,n,r,s,a),this}recordBBox(e,t,n,r,s,a){return this.#i||this.#e.recordBBox(this.#t,t,n,r,s,a),this}recordCharacterBBox(e,t,n,r,s,a,l){return this.#i||this.#e.recordCharacterBBox(this.#t,t,n,r,s,a,l),this}recordFullPageBBox(e){return this.#i||this.#e.recordFullPageBBox(this.#t),this}getSimpleIndex(e){return this.#e.getSimpleIndex(e)}recordDependencies(e,t){return this.#e.recordDependencies(this.#t,t),this}recordNamedDependency(e,t){return this.#e.recordNamedDependency(this.#t,t),this}recordOperation(e){return this.#e.recordOperation(this.#t,!0),this}recordShowTextOperation(e){return this.#e.recordShowTextOperation(this.#t,!0),this}bboxToClipBoxDropOperation(e){return this.#i||this.#e.bboxToClipBoxDropOperation(this.#t,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Dependencies={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},PathType={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function applyBoundingBox(i,e){if(!e)return;const t=e[2]-e[0],n=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,n),i.clip(r)}class BaseShadingPattern{isModifyingCurrentTransform(){return!1}getPattern(){unreachable("Abstract method `getPattern` called.")}}class RadialAxialShadingPattern extends BaseShadingPattern{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,r){let s;if(r===PathType.STROKE||r===PathType.FILL){const a=t.current.getClippedPathBoundingBox(r,getCurrentTransform(e))||[0,0,0,0],l=Math.ceil(a[2]-a[0])||1,u=Math.ceil(a[3]-a[1])||1,d=t.cachedCanvases.getCanvas("pattern",l,u),h=d.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-a[0],-a[1]),n=Util.transform(n,[1,0,0,1,a[0],a[1]]),h.transform(...t.baseTransform),this.matrix&&h.transform(...this.matrix),applyBoundingBox(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),s=e.createPattern(d.canvas,"no-repeat");const p=new DOMMatrix(n);s.setTransform(p)}else applyBoundingBox(e,this._bbox),s=this._createGradient(e);return s}}function drawTriangle(i,e,t,n,r,s,a,l){const u=e.coords,d=e.colors,h=i.data,p=i.width*4;let m;u[t+1]>u[n+1]&&(m=t,t=n,n=m,m=s,s=a,a=m),u[n+1]>u[r+1]&&(m=n,n=r,r=m,m=a,a=l,l=m),u[t+1]>u[n+1]&&(m=t,t=n,n=m,m=s,s=a,a=m);const g=(u[t]+e.offsetX)*e.scaleX,v=(u[t+1]+e.offsetY)*e.scaleY,_=(u[n]+e.offsetX)*e.scaleX,b=(u[n+1]+e.offsetY)*e.scaleY,E=(u[r]+e.offsetX)*e.scaleX,A=(u[r+1]+e.offsetY)*e.scaleY;if(v>=A)return;const z=d[s],D=d[s+1],P=d[s+2],G=d[a],R=d[a+1],I=d[a+2],w=d[l],H=d[l+1],V=d[l+2],te=Math.round(v),ae=Math.round(A);let be,_e,le,ue,oe,ee,se,re;for(let fe=te;fe<=ae;fe++){if(fe<b){const Te=fe<v?0:(v-fe)/(v-b);be=g-(g-_)*Te,_e=z-(z-G)*Te,le=D-(D-R)*Te,ue=P-(P-I)*Te}else{let Te;fe>A?Te=1:b===A?Te=0:Te=(b-fe)/(b-A),be=_-(_-E)*Te,_e=G-(G-w)*Te,le=R-(R-H)*Te,ue=I-(I-V)*Te}let pe;fe<v?pe=0:fe>A?pe=1:pe=(v-fe)/(v-A),oe=g-(g-E)*pe,ee=z-(z-w)*pe,se=D-(D-H)*pe,re=P-(P-V)*pe;const Z=Math.round(Math.min(be,oe)),ce=Math.round(Math.max(be,oe));let Ee=p*fe+Z*4;for(let Te=Z;Te<=ce;Te++)pe=(be-Te)/(be-oe),pe<0?pe=0:pe>1&&(pe=1),h[Ee++]=_e-(_e-ee)*pe|0,h[Ee++]=le-(le-se)*pe|0,h[Ee++]=ue-(ue-re)*pe|0,h[Ee++]=255}}function drawFigure(i,e,t){const n=e.coords,r=e.colors;let s,a;switch(e.type){case"lattice":const l=e.verticesPerRow,u=Math.floor(n.length/l)-1,d=l-1;for(s=0;s<u;s++){let h=s*l;for(let p=0;p<d;p++,h++)drawTriangle(i,t,n[h],n[h+1],n[h+l],r[h],r[h+1],r[h+l]),drawTriangle(i,t,n[h+l+1],n[h+1],n[h+l],r[h+l+1],r[h+1],r[h+l])}break;case"triangles":for(s=0,a=n.length;s<a;s+=3)drawTriangle(i,t,n[s],n[s+1],n[s+2],r[s],r[s+1],r[s+2]);break;default:throw new Error("illegal figure")}}class MeshShadingPattern extends BaseShadingPattern{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,n){const l=Math.floor(this._bounds[0]),u=Math.floor(this._bounds[1]),d=Math.ceil(this._bounds[2])-l,h=Math.ceil(this._bounds[3])-u,p=Math.min(Math.ceil(Math.abs(d*e[0]*1.1)),3e3),m=Math.min(Math.ceil(Math.abs(h*e[1]*1.1)),3e3),g=d/p,v=h/m,_={coords:this._coords,colors:this._colors,offsetX:-l,offsetY:-u,scaleX:1/g,scaleY:1/v},b=p+4,E=m+4,A=n.getCanvas("mesh",b,E),z=A.context,D=z.createImageData(p,m);if(t){const G=D.data;for(let R=0,I=G.length;R<I;R+=4)G[R]=t[0],G[R+1]=t[1],G[R+2]=t[2],G[R+3]=255}for(const G of this._figures)drawFigure(D,G,_);return z.putImageData(D,2,2),{canvas:A.canvas,offsetX:l-2*g,offsetY:u-2*v,scaleX:g,scaleY:v}}isModifyingCurrentTransform(){return!0}getPattern(e,t,n,r){applyBoundingBox(e,this._bbox);const s=new Float32Array(2);if(r===PathType.SHADING)Util.singularValueDecompose2dScale(getCurrentTransform(e),s);else if(this.matrix){Util.singularValueDecompose2dScale(this.matrix,s);const[l,u]=s;Util.singularValueDecompose2dScale(t.baseTransform,s),s[0]*=l,s[1]*=u}else Util.singularValueDecompose2dScale(t.baseTransform,s);const a=this._createMeshCanvas(s,r===PathType.SHADING?null:this._background,t.cachedCanvases);return r!==PathType.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class DummyShadingPattern extends BaseShadingPattern{getPattern(){return"hotpink"}}function getShadingPattern(i){switch(i[0]){case"RadialAxial":return new RadialAxialShadingPattern(i);case"Mesh":return new MeshShadingPattern(i);case"Dummy":return new DummyShadingPattern}throw new Error(`Unknown IR type: ${i[0]}`)}const PaintType={COLORED:1,UNCOLORED:2};class TilingPattern{static MAX_PATTERN_SIZE=3e3;constructor(e,t,n,r){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=n,this.baseTransform=r}createPatternCanvas(e,t){const{bbox:n,operatorList:r,paintType:s,tilingType:a,color:l,canvasGraphicsFactory:u}=this;let{xstep:d,ystep:h}=this;d=Math.abs(d),h=Math.abs(h),info("TilingType: "+a);const p=n[0],m=n[1],g=n[2],v=n[3],_=g-p,b=v-m,E=new Float32Array(2);Util.singularValueDecompose2dScale(this.matrix,E);const[A,z]=E;Util.singularValueDecompose2dScale(this.baseTransform,E);const D=A*E[0],P=z*E[1];let G=_,R=b,I=!1,w=!1;const H=Math.ceil(d*D),V=Math.ceil(h*P),te=Math.ceil(_*D),ae=Math.ceil(b*P);H>=te?G=d:I=!0,V>=ae?R=h:w=!0;const be=this.getSizeAndScale(G,this.ctx.canvas.width,D),_e=this.getSizeAndScale(R,this.ctx.canvas.height,P),le=e.cachedCanvases.getCanvas("pattern",be.size,_e.size),ue=le.context,oe=u.createCanvasGraphics(ue,t);if(oe.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(oe,s,l),ue.translate(-be.scale*p,-_e.scale*m),oe.transform(0,be.scale,0,0,_e.scale,0,0),ue.save(),oe.dependencyTracker?.save(),this.clipBbox(oe,p,m,g,v),oe.baseTransform=getCurrentTransform(oe.ctx),oe.executeOperatorList(r),oe.endDrawing(),oe.dependencyTracker?.restore(),ue.restore(),I||w){const ee=le.canvas;I&&(G=d),w&&(R=h);const se=this.getSizeAndScale(G,this.ctx.canvas.width,D),re=this.getSizeAndScale(R,this.ctx.canvas.height,P),fe=se.size,pe=re.size,Z=e.cachedCanvases.getCanvas("pattern-workaround",fe,pe),ce=Z.context,Ee=I?Math.floor(_/d):0,Te=w?Math.floor(b/h):0;for(let Ae=0;Ae<=Ee;Ae++)for(let Pe=0;Pe<=Te;Pe++)ce.drawImage(ee,fe*Ae,pe*Pe,fe,pe,0,0,fe,pe);return{canvas:Z.canvas,scaleX:se.scale,scaleY:re.scale,offsetX:p,offsetY:m}}return{canvas:le.canvas,scaleX:be.scale,scaleY:_e.scale,offsetX:p,offsetY:m}}getSizeAndScale(e,t,n){const r=Math.max(TilingPattern.MAX_PATTERN_SIZE,t);let s=Math.ceil(e*n);return s>=r?s=r:n=s/e,{scale:n,size:s}}clipBbox(e,t,n,r,s){const a=r-t,l=s-n;e.ctx.rect(t,n,a,l),Util.axialAlignedBoundingBox([t,n,r,s],getCurrentTransform(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const r=e.ctx,s=e.current;switch(t){case PaintType.COLORED:const{fillStyle:a,strokeStyle:l}=this.ctx;r.fillStyle=s.fillColor=a,r.strokeStyle=s.strokeColor=l;break;case PaintType.UNCOLORED:r.fillStyle=r.strokeStyle=n,s.fillColor=s.strokeColor=n;break;default:throw new FormatError(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,n,r,s){let a=n;r!==PathType.SHADING&&(a=Util.transform(a,t.baseTransform),this.matrix&&(a=Util.transform(a,this.matrix)));const l=this.createPatternCanvas(t,s);let u=new DOMMatrix(a);u=u.translate(l.offsetX,l.offsetY),u=u.scale(1/l.scaleX,1/l.scaleY);const d=e.createPattern(l.canvas,"repeat");return d.setTransform(u),d}}function convertBlackAndWhiteToRGBA({src:i,srcPos:e=0,dest:t,width:n,height:r,nonBlackColor:s=4294967295,inverseDecode:a=!1}){const l=util_FeatureTest.isLittleEndian?4278190080:255,[u,d]=a?[s,l]:[l,s],h=n>>3,p=n&7,m=i.length;t=new Uint32Array(t.buffer);let g=0;for(let v=0;v<r;v++){for(const b=e+h;e<b;e++){const E=e<m?i[e]:255;t[g++]=E&128?d:u,t[g++]=E&64?d:u,t[g++]=E&32?d:u,t[g++]=E&16?d:u,t[g++]=E&8?d:u,t[g++]=E&4?d:u,t[g++]=E&2?d:u,t[g++]=E&1?d:u}if(p===0)continue;const _=e<m?i[e++]:255;for(let b=0;b<p;b++)t[g++]=_&1<<7-b?d:u}return{srcPos:e,destPos:g}}const MIN_FONT_SIZE=16,MAX_FONT_SIZE=100,EXECUTION_TIME=15,EXECUTION_STEPS=10,FULL_CHUNK_HEIGHT=16,SCALE_MATRIX=new DOMMatrix,XY=new Float32Array(2),MIN_MAX_INIT=new Float32Array([1/0,1/0,-1/0,-1/0]);function mirrorContextOperations(i,e){if(i._removeMirroring)throw new Error("Context is already forwarding operations.");i.__originalSave=i.save,i.__originalRestore=i.restore,i.__originalRotate=i.rotate,i.__originalScale=i.scale,i.__originalTranslate=i.translate,i.__originalTransform=i.transform,i.__originalSetTransform=i.setTransform,i.__originalResetTransform=i.resetTransform,i.__originalClip=i.clip,i.__originalMoveTo=i.moveTo,i.__originalLineTo=i.lineTo,i.__originalBezierCurveTo=i.bezierCurveTo,i.__originalRect=i.rect,i.__originalClosePath=i.closePath,i.__originalBeginPath=i.beginPath,i._removeMirroring=()=>{i.save=i.__originalSave,i.restore=i.__originalRestore,i.rotate=i.__originalRotate,i.scale=i.__originalScale,i.translate=i.__originalTranslate,i.transform=i.__originalTransform,i.setTransform=i.__originalSetTransform,i.resetTransform=i.__originalResetTransform,i.clip=i.__originalClip,i.moveTo=i.__originalMoveTo,i.lineTo=i.__originalLineTo,i.bezierCurveTo=i.__originalBezierCurveTo,i.rect=i.__originalRect,i.closePath=i.__originalClosePath,i.beginPath=i.__originalBeginPath,delete i._removeMirroring},i.save=function(){e.save(),this.__originalSave()},i.restore=function(){e.restore(),this.__originalRestore()},i.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},i.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},i.transform=function(t,n,r,s,a,l){e.transform(t,n,r,s,a,l),this.__originalTransform(t,n,r,s,a,l)},i.setTransform=function(t,n,r,s,a,l){e.setTransform(t,n,r,s,a,l),this.__originalSetTransform(t,n,r,s,a,l)},i.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},i.rotate=function(t){e.rotate(t),this.__originalRotate(t)},i.clip=function(t){e.clip(t),this.__originalClip(t)},i.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},i.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},i.bezierCurveTo=function(t,n,r,s,a,l){e.bezierCurveTo(t,n,r,s,a,l),this.__originalBezierCurveTo(t,n,r,s,a,l)},i.rect=function(t,n,r,s){e.rect(t,n,r,s),this.__originalRect(t,n,r,s)},i.closePath=function(){e.closePath(),this.__originalClosePath()},i.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class CachedCanvases{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,n)):(r=this.canvasFactory.create(t,n),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function drawImageAtIntegerCoords(i,e,t,n,r,s,a,l,u,d){const[h,p,m,g,v,_]=getCurrentTransform(i);if(p===0&&m===0){const A=a*h+v,z=Math.round(A),D=l*g+_,P=Math.round(D),G=(a+u)*h+v,R=Math.abs(Math.round(G)-z)||1,I=(l+d)*g+_,w=Math.abs(Math.round(I)-P)||1;return i.setTransform(Math.sign(h),0,0,Math.sign(g),z,P),i.drawImage(e,t,n,r,s,0,0,R,w),i.setTransform(h,p,m,g,v,_),[R,w]}if(h===0&&g===0){const A=l*m+v,z=Math.round(A),D=a*p+_,P=Math.round(D),G=(l+d)*m+v,R=Math.abs(Math.round(G)-z)||1,I=(a+u)*p+_,w=Math.abs(Math.round(I)-P)||1;return i.setTransform(0,Math.sign(p),Math.sign(m),0,z,P),i.drawImage(e,t,n,r,s,0,0,w,R),i.setTransform(h,p,m,g,v,_),[w,R]}i.drawImage(e,t,n,r,s,a,l,u,d);const b=Math.hypot(h,p),E=Math.hypot(m,g);return[b*u,E*d]}class CanvasExtraState{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=FONT_IDENTITY_MATRIX;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=TextRenderingMode.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(e,t,n){n?.(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=MIN_MAX_INIT.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=PathType.FILL,t=null){const n=this.minMax.slice();if(e===PathType.STROKE){t||unreachable("Stroke bounding box must include transform."),Util.singularValueDecompose2dScale(t,XY);const r=XY[0]*this.lineWidth/2,s=XY[1]*this.lineWidth/2;n[0]-=r,n[1]-=s,n[2]+=r,n[3]+=s}return n}updateClipFromPath(){const e=Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(MIN_MAX_INIT,0)}getClippedPathBoundingBox(e=PathType.FILL,t=null){return Util.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function putBinaryImageData(i,e){if(e instanceof ImageData){i.putImageData(e,0,0);return}const t=e.height,n=e.width,r=t%FULL_CHUNK_HEIGHT,s=(t-r)/FULL_CHUNK_HEIGHT,a=r===0?s:s+1,l=i.createImageData(n,FULL_CHUNK_HEIGHT);let u=0,d;const h=e.data,p=l.data;let m,g,v,_;if(e.kind===util_ImageKind.GRAYSCALE_1BPP){const b=h.byteLength,E=new Uint32Array(p.buffer,0,p.byteLength>>2),A=E.length,z=n+7>>3,D=4294967295,P=util_FeatureTest.isLittleEndian?4278190080:255;for(m=0;m<a;m++){for(v=m<s?FULL_CHUNK_HEIGHT:r,d=0,g=0;g<v;g++){const G=b-u;let R=0;const I=G>z?n:G*8-7,w=I&-8;let H=0,V=0;for(;R<w;R+=8)V=h[u++],E[d++]=V&128?D:P,E[d++]=V&64?D:P,E[d++]=V&32?D:P,E[d++]=V&16?D:P,E[d++]=V&8?D:P,E[d++]=V&4?D:P,E[d++]=V&2?D:P,E[d++]=V&1?D:P;for(;R<I;R++)H===0&&(V=h[u++],H=128),E[d++]=V&H?D:P,H>>=1}for(;d<A;)E[d++]=0;i.putImageData(l,0,m*FULL_CHUNK_HEIGHT)}}else if(e.kind===util_ImageKind.RGBA_32BPP){for(g=0,_=n*FULL_CHUNK_HEIGHT*4,m=0;m<s;m++)p.set(h.subarray(u,u+_)),u+=_,i.putImageData(l,0,g),g+=FULL_CHUNK_HEIGHT;m<a&&(_=n*r*4,p.set(h.subarray(u,u+_)),i.putImageData(l,0,g))}else if(e.kind===util_ImageKind.RGB_24BPP)for(v=FULL_CHUNK_HEIGHT,_=n*v,m=0;m<a;m++){for(m>=s&&(v=r,_=n*v),d=0,g=_;g--;)p[d++]=h[u++],p[d++]=h[u++],p[d++]=h[u++],p[d++]=255;i.putImageData(l,0,m*FULL_CHUNK_HEIGHT)}else throw new Error(`bad image kind: ${e.kind}`)}function putBinaryImageMask(i,e){if(e.bitmap){i.drawImage(e.bitmap,0,0);return}const t=e.height,n=e.width,r=t%FULL_CHUNK_HEIGHT,s=(t-r)/FULL_CHUNK_HEIGHT,a=r===0?s:s+1,l=i.createImageData(n,FULL_CHUNK_HEIGHT);let u=0;const d=e.data,h=l.data;for(let p=0;p<a;p++){const m=p<s?FULL_CHUNK_HEIGHT:r;({srcPos:u}=convertBlackAndWhiteToRGBA({src:d,srcPos:u,dest:h,width:n,height:m,nonBlackColor:0})),i.putImageData(l,0,p*FULL_CHUNK_HEIGHT)}}function copyCtxState(i,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of t)i[n]!==void 0&&(e[n]=i[n]);i.setLineDash!==void 0&&(e.setLineDash(i.getLineDash()),e.lineDashOffset=i.lineDashOffset)}function resetCtxToDefault(i){i.strokeStyle=i.fillStyle="#000000",i.fillRule="nonzero",i.globalAlpha=1,i.lineWidth=1,i.lineCap="butt",i.lineJoin="miter",i.miterLimit=10,i.globalCompositeOperation="source-over",i.font="10px sans-serif",i.setLineDash!==void 0&&(i.setLineDash([]),i.lineDashOffset=0);const{filter:e}=i;e!=="none"&&e!==""&&(i.filter="none")}function getImageSmoothingEnabled(i,e){if(e)return!0;Util.singularValueDecompose2dScale(i,XY);const t=Math.fround(OutputScale.pixelRatio*PixelsPerInch.PDF_TO_CSS_UNITS);return XY[0]<=t&&XY[1]<=t}const LINE_CAP_STYLES=["butt","round","square"],LINE_JOIN_STYLES=["miter","round","bevel"],NORMAL_CLIP={},EO_CLIP={};class CanvasGraphics{constructor(e,t,n,r,s,{optionalContentConfig:a,markedContentStack:l=null},u,d,h){this.ctx=e,this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=r,this.filterFactory=s,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=l||[],this.optionalContentConfig=a,this.cachedCanvases=new CachedCanvases(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=u,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=d,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=h??null}getObject(e,t,n=null){return typeof t=="string"?(this.dependencyTracker?.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):n}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:r=null}){const s=this.ctx.canvas.width,a=this.ctx.canvas.height,l=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,s,a),this.ctx.fillStyle=l,n){const u=this.cachedCanvases.getCanvas("transparent",s,a);this.compositeCtx=this.ctx,this.transparentCanvas=u.canvas,this.ctx=u.context,this.ctx.save(),this.ctx.transform(...getCurrentTransform(this.compositeCtx))}this.ctx.save(),resetCtxToDefault(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=getCurrentTransform(this.ctx)}executeOperatorList(e,t,n,r,s){const a=e.argsArray,l=e.fnArray;let u=t||0;const d=a.length;if(d===u)return u;const h=d-u>EXECUTION_STEPS&&typeof n=="function",p=h?Date.now()+EXECUTION_TIME:0;let m=0;const g=this.commonObjs,v=this.objs;let _,b;for(;;){if(r!==void 0&&u===r.nextBreakPoint)return r.breakIt(u,n),u;if(!s||s(u))if(_=l[u],b=a[u]??null,_!==OPS.dependency)b===null?this[_](u):this[_](u,...b);else for(const E of b){this.dependencyTracker?.recordNamedData(E,u);const A=E.startsWith("g_")?g:v;if(!A.has(E))return A.get(E,n),u}if(u++,u===d)return u;if(h&&++m>EXECUTION_STEPS){if(Date.now()>p)return n(),u;m=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const n=e.width??e.displayWidth,r=e.height??e.displayHeight;let s=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),l=n,u=r,d="prescale1",h,p;for(;s>2&&l>1||a>2&&u>1;){let m=l,g=u;s>2&&l>1&&(m=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),s/=l/m),a>2&&u>1&&(g=u>=16384?Math.floor(u/2)-1||1:Math.ceil(u)/2,a/=u/g),h=this.cachedCanvases.getCanvas(d,m,g),p=h.context,p.clearRect(0,0,m,g),p.drawImage(e,0,0,l,u,0,0,m,g),e=h.canvas,l=m,u=g,d=d==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:u}}_createMaskCanvas(e,t){const n=this.ctx,{width:r,height:s}=t,a=this.current.fillColor,l=this.current.patternFill,u=getCurrentTransform(n);let d,h,p,m;if((t.bitmap||t.data)&&t.count>1){const H=t.bitmap||t.data.buffer;h=JSON.stringify(l?u:[u.slice(0,4),a]),d=this._cachedBitmapsMap.get(H),d||(d=new Map,this._cachedBitmapsMap.set(H,d));const V=d.get(h);if(V&&!l){const te=Math.round(Math.min(u[0],u[2])+u[4]),ae=Math.round(Math.min(u[1],u[3])+u[5]);return this.dependencyTracker?.recordDependencies(e,Dependencies.transformAndFill),{canvas:V,offsetX:te,offsetY:ae}}p=V}p||(m=this.cachedCanvases.getCanvas("maskCanvas",r,s),putBinaryImageMask(m.context,t));let g=Util.transform(u,[1/r,0,0,-1/s,0,0]);g=Util.transform(g,[1,0,0,1,0,-s]);const v=MIN_MAX_INIT.slice();Util.axialAlignedBoundingBox([0,0,r,s],g,v);const[_,b,E,A]=v,z=Math.round(E-_)||1,D=Math.round(A-b)||1,P=this.cachedCanvases.getCanvas("fillCanvas",z,D),G=P.context,R=_,I=b;G.translate(-R,-I),G.transform(...g),p||(p=this._scaleImage(m.canvas,getCurrentTransformInverse(G)),p=p.img,d&&l&&d.set(h,p)),G.imageSmoothingEnabled=getImageSmoothingEnabled(getCurrentTransform(G),t.interpolate),drawImageAtIntegerCoords(G,p,0,0,p.width,p.height,0,0,r,s),G.globalCompositeOperation="source-in";const w=Util.transform(getCurrentTransformInverse(G),[1,0,0,1,-R,-I]);return G.fillStyle=l?a.getPattern(n,this,w,PathType.FILL,e):a,G.fillRect(0,0,r,s),d&&!l&&(this.cachedCanvases.delete("fillCanvas"),d.set(h,P.canvas)),this.dependencyTracker?.recordDependencies(e,Dependencies.transformAndFill),{canvas:P.canvas,offsetX:Math.round(R),offsetY:Math.round(I)}}setLineWidth(e,t){this.dependencyTracker?.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){this.dependencyTracker?.recordSimpleData("lineCap",e),this.ctx.lineCap=LINE_CAP_STYLES[t]}setLineJoin(e,t){this.dependencyTracker?.recordSimpleData("lineJoin",e),this.ctx.lineJoin=LINE_JOIN_STYLES[t]}setMiterLimit(e,t){this.dependencyTracker?.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,n){this.dependencyTracker?.recordSimpleData("dash",e);const r=this.ctx;r.setLineDash!==void 0&&(r.setLineDash(t),r.lineDashOffset=n)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){for(const[n,r]of t)switch(n){case"LW":this.setLineWidth(e,r);break;case"LC":this.setLineCap(e,r);break;case"LJ":this.setLineJoin(e,r);break;case"ML":this.setMiterLimit(e,r);break;case"D":this.setDash(e,r[0],r[1]);break;case"RI":this.setRenderingIntent(e,r);break;case"FL":this.setFlatness(e,r);break;case"Font":this.setFont(e,r[0],r[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=r;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=r;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=r;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",e),this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,n=this.ctx.canvas.height,r="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(r,t,n);this.suspendedCtx=this.ctx;const a=this.ctx=s.context;a.setTransform(this.suspendedCtx.getTransform()),copyCtxState(this.suspendedCtx,a),mirrorContextOperations(a,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),copyCtxState(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,r){const s=r[0],a=r[1],l=r[2]-s,u=r[3]-a;l===0||u===0||(this.genericComposeSMask(t.context,n,l,u,t.subtype,t.backdrop,t.transferMap,s,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,r,s,a,l,u,d,h,p){let m=e.canvas,g=u-h,v=d-p;if(a)if(g<0||v<0||g+n>m.width||v+r>m.height){const b=this.cachedCanvases.getCanvas("maskExtension",n,r),E=b.context;E.drawImage(m,-g,-v),E.globalCompositeOperation="destination-atop",E.fillStyle=a,E.fillRect(0,0,n,r),E.globalCompositeOperation="source-over",m=b.canvas,g=v=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(g,v,n,r),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=a,e.fillRect(g,v,n,r),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),s==="Alpha"&&l?t.filter=this.filterFactory.addAlphaFilter(l):s==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(l));const _=new Path2D;_.rect(u,d,n,r),t.clip(_),t.globalCompositeOperation="destination-in",t.drawImage(m,g,v,n,r,u,d,n,r),t.restore()}save(e){this.inSMaskMode&&copyCtxState(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),this.dependencyTracker?.save(e)}restore(e){if(this.dependencyTracker?.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&copyCtxState(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,n,r,s,a,l){this.dependencyTracker?.recordIncrementalData("transform",e),this.ctx.transform(t,n,r,s,a,l),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n,r){let[s]=n;if(!r){s||=n[0]=new Path2D,this[t](e,s);return}if(this.dependencyTracker!==null){const a=t===OPS.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,r[0]-a,r[2]+a,r[1]-a,r[3]+a).recordDependencies(e,["transform"])}if(!(s instanceof Path2D)){const a=n[0]=new Path2D;for(let l=0,u=s.length;l<u;)switch(s[l++]){case DrawOPS.moveTo:a.moveTo(s[l++],s[l++]);break;case DrawOPS.lineTo:a.lineTo(s[l++],s[l++]);break;case DrawOPS.curveTo:a.bezierCurveTo(s[l++],s[l++],s[l++],s[l++],s[l++],s[l++]);break;case DrawOPS.closePath:a.closePath();break;default:warn(`Unrecognized drawing path operator: ${s[l-1]}`);break}s=a}Util.axialAlignedBoundingBox(r,getCurrentTransform(this.ctx),this.current.minMax),this[t](e,s),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,n=!0){const r=this.ctx,s=this.current.strokeColor;if(r.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof s=="object"&&s?.getPattern){const a=s.isModifyingCurrentTransform()?r.getTransform():null;if(r.save(),r.strokeStyle=s.getPattern(r,this,getCurrentTransformInverse(r),PathType.STROKE,e),a){const l=new Path2D;l.addPath(t,r.getTransform().invertSelf().multiplySelf(a)),t=l}this.rescaleAndStroke(t,!1),r.restore()}else this.rescaleAndStroke(t,!0);this.dependencyTracker?.recordDependencies(e,Dependencies.stroke),n&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(PathType.STROKE,getCurrentTransform(this.ctx))),r.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,n=!0){const r=this.ctx,s=this.current.fillColor,a=this.current.patternFill;let l=!1;if(a){const d=s.isModifyingCurrentTransform()?r.getTransform():null;if(this.dependencyTracker?.save(e),r.save(),r.fillStyle=s.getPattern(r,this,getCurrentTransformInverse(r),PathType.FILL,e),d){const h=new Path2D;h.addPath(t,r.getTransform().invertSelf().multiplySelf(d)),t=h}l=!0}const u=this.current.getClippedPathBoundingBox();this.contentVisible&&u!==null&&(this.pendingEOFill?(r.fill(t,"evenodd"),this.pendingEOFill=!1):r.fill(t)),this.dependencyTracker?.recordDependencies(e,Dependencies.fill),l&&(r.restore(),this.dependencyTracker?.restore(e)),n&&this.consumePath(e,t,u)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){this.ctx.fill(t),this.dependencyTracker?.recordDependencies(e,Dependencies.rawFillPath).recordOperation(e)}clip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=NORMAL_CLIP}eoClip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=EO_CLIP}beginText(e){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:r}=this;t!==void 0&&r.recordFutureForcedDependency("textClip",r.getOpenMarker()).recordFutureForcedDependency("textClip",e),r.recordCloseMarker(e)}if(t!==void 0){const r=new Path2D,s=n.getTransform().invertSelf();for(const{transform:a,x:l,y:u,fontSize:d,path:h}of t)h&&r.addPath(h,new DOMMatrix(a).preMultiplySelf(s).translate(l,u).scale(d,-d));n.clip(r)}delete this.pendingTextPaths}setCharSpacing(e,t){this.dependencyTracker?.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){this.dependencyTracker?.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){this.dependencyTracker?.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){this.dependencyTracker?.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,n){this.dependencyTracker?.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const r=this.commonObjs.get(t),s=this.current;if(!r)throw new Error(`Can't find font for ${t}`);if(s.fontMatrix=r.fontMatrix||FONT_IDENTITY_MATRIX,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&warn("Invalid font matrix for font "+t),n<0?(n=-n,s.fontDirection=-1):s.fontDirection=1,this.current.font=r,this.current.fontSize=n,r.isType3Font)return;const a=r.loadedName||"sans-serif",l=r.systemFontInfo?.css||`"${a}", ${r.fallbackName}`;let u="normal";r.black?u="900":r.bold&&(u="bold");const d=r.italic?"italic":"normal";let h=n;n<MIN_FONT_SIZE?h=MIN_FONT_SIZE:n>MAX_FONT_SIZE&&(h=MAX_FONT_SIZE),this.current.fontSizeScale=n/h,this.ctx.font=`${d} ${u} ${h}px ${l}`}setTextRenderingMode(e,t){this.dependencyTracker?.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){this.dependencyTracker?.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,n){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,t,n){this.setLeading(e,-n),this.moveText(e,t,n)}setTextMatrix(e,t){this.dependencyTracker?.recordSimpleData("textMatrix",e);const{current:n}=this;n.textMatrix=t,n.textMatrixScale=Math.hypot(t[0],t[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(e){this.moveText(e,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}#i(e,t,n){const r=new Path2D;return r.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),r}paintChar(e,t,n,r,s,a){const l=this.ctx,u=this.current,d=u.font,h=u.textRenderingMode,p=u.fontSize/u.fontSizeScale,m=h&TextRenderingMode.FILL_STROKE_MASK,g=!!(h&TextRenderingMode.ADD_TO_PATH_FLAG),v=u.patternFill&&!d.missingFile,_=u.patternStroke&&!d.missingFile;let b;if((d.disableFontFace||g||v||_)&&!d.missingFile&&(b=d.getPathGenerator(this.commonObjs,t)),b&&(d.disableFontFace||v||_)){l.save(),l.translate(n,r),l.scale(p,-p),this.dependencyTracker?.recordCharacterBBox(e,l,d);let E;if(m===TextRenderingMode.FILL||m===TextRenderingMode.FILL_STROKE)if(s){E=l.getTransform(),l.setTransform(...s);const A=this.#i(b,E,s);l.fill(A)}else l.fill(b);if(m===TextRenderingMode.STROKE||m===TextRenderingMode.FILL_STROKE)if(a){E||=l.getTransform(),l.setTransform(...a);const{a:A,b:z,c:D,d:P}=E,G=Util.inverseTransform(a),R=Util.transform([A,z,D,P,0,0],G);Util.singularValueDecompose2dScale(R,XY),l.lineWidth*=Math.max(XY[0],XY[1])/p,l.stroke(this.#i(b,E,a))}else l.lineWidth/=p,l.stroke(b);l.restore()}else(m===TextRenderingMode.FILL||m===TextRenderingMode.FILL_STROKE)&&(l.fillText(t,n,r),this.dependencyTracker?.recordCharacterBBox(e,l,d,p,n,r,()=>l.measureText(t))),(m===TextRenderingMode.STROKE||m===TextRenderingMode.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(e,l,d,p,n,r,()=>l.measureText(t)).recordDependencies(e,Dependencies.stroke),l.strokeText(t,n,r));g&&((this.pendingTextPaths||=[]).push({transform:getCurrentTransform(l),x:n,y:r,fontSize:p,path:b}),this.dependencyTracker?.recordCharacterBBox(e,l,d,p,n,r))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){n=!0;break}return shadow(this,"isFontSubpixelAAEnabled",n)}showText(e,t){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,Dependencies.showText).resetBBox(e),this.current.textRenderingMode&TextRenderingMode.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,r=n.font;if(r.isType3Font){this.showType3Text(e,t),this.dependencyTracker?.recordShowTextOperation(e);return}const s=n.fontSize;if(s===0){this.dependencyTracker?.recordOperation(e);return}const a=this.ctx,l=n.fontSizeScale,u=n.charSpacing,d=n.wordSpacing,h=n.fontDirection,p=n.textHScale*h,m=t.length,g=r.vertical,v=g?1:-1,_=r.defaultVMetrics,b=s*n.fontMatrix[0],E=n.textRenderingMode===TextRenderingMode.FILL&&!r.disableFontFace&&!n.patternFill;a.save(),n.textMatrix&&a.transform(...n.textMatrix),a.translate(n.x,n.y+n.textRise),h>0?a.scale(p,-1):a.scale(p,1);let A,z;if(n.patternFill){a.save();const I=n.fillColor.getPattern(a,this,getCurrentTransformInverse(a),PathType.FILL,e);A=getCurrentTransform(a),a.restore(),a.fillStyle=I}if(n.patternStroke){a.save();const I=n.strokeColor.getPattern(a,this,getCurrentTransformInverse(a),PathType.STROKE,e);z=getCurrentTransform(a),a.restore(),a.strokeStyle=I}let D=n.lineWidth;const P=n.textMatrixScale;if(P===0||D===0){const I=n.textRenderingMode&TextRenderingMode.FILL_STROKE_MASK;(I===TextRenderingMode.STROKE||I===TextRenderingMode.FILL_STROKE)&&(D=this.getSinglePixelWidth())}else D/=P;if(l!==1&&(a.scale(l,l),D/=l),a.lineWidth=D,r.isInvalidPDFjsFont){const I=[];let w=0;for(const V of t)I.push(V.unicode),w+=V.width;const H=I.join("");if(a.fillText(H,0,0),this.dependencyTracker!==null){const V=a.measureText(H);this.dependencyTracker.recordBBox(e,this.ctx,-V.actualBoundingBoxLeft,V.actualBoundingBoxRight,-V.actualBoundingBoxAscent,V.actualBoundingBoxDescent).recordShowTextOperation(e)}n.x+=w*b*p,a.restore(),this.compose();return}let G=0,R;for(R=0;R<m;++R){const I=t[R];if(typeof I=="number"){G+=v*I*s/1e3;continue}let w=!1;const H=(I.isSpace?d:0)+u,V=I.fontChar,te=I.accent;let ae,be,_e=I.width;if(g){const oe=I.vmetric||_,ee=-(I.vmetric?oe[1]:_e*.5)*b,se=oe[2]*b;_e=oe?-oe[0]:_e,ae=ee/l,be=(G+se)/l}else ae=G/l,be=0;let le;if(r.remeasure&&_e>0){le=a.measureText(V);const oe=le.width*1e3/s*l;if(_e<oe&&this.isFontSubpixelAAEnabled){const ee=_e/oe;w=!0,a.save(),a.scale(ee,1),ae/=ee}else _e!==oe&&(ae+=(_e-oe)/2e3*s/l)}if(this.contentVisible&&(I.isInFont||r.missingFile)){if(E&&!te)a.fillText(V,ae,be),this.dependencyTracker?.recordCharacterBBox(e,a,le?{bbox:null}:r,s/l,ae,be,()=>le??a.measureText(V));else if(this.paintChar(e,V,ae,be,A,z),te){const oe=ae+s*te.offset.x/l,ee=be-s*te.offset.y/l;this.paintChar(e,te.fontChar,oe,ee,A,z)}}const ue=g?_e*b-H*h:_e*b+H*h;G+=ue,w&&a.restore()}g?n.y-=G:n.x+=G*p,a.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(e)}showType3Text(e,t){const n=this.ctx,r=this.current,s=r.font,a=r.fontSize,l=r.fontDirection,u=s.vertical?1:-1,d=r.charSpacing,h=r.wordSpacing,p=r.textHScale*l,m=r.fontMatrix||FONT_IDENTITY_MATRIX,g=t.length,v=r.textRenderingMode===TextRenderingMode.INVISIBLE;let _,b,E,A;if(v||a===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),r.textMatrix&&n.transform(...r.textMatrix),n.translate(r.x,r.y+r.textRise),n.scale(p,l);const z=this.dependencyTracker;for(this.dependencyTracker=z?new CanvasNestedDependencyTracker(z,e):null,_=0;_<g;++_){if(b=t[_],typeof b=="number"){A=u*b*a/1e3,this.ctx.translate(A,0),r.x+=A*p;continue}const D=(b.isSpace?h:0)+d,P=s.charProcOperatorList[b.operatorListId];P?this.contentVisible&&(this.save(),n.scale(a,a),n.transform(...m),this.executeOperatorList(P),this.restore()):warn(`Type3 character "${b.operatorListId}" is not available.`);const G=[b.width,0];Util.applyTransform(G,m),E=G[0]*a+D,n.translate(E,0),r.x+=E*p}n.restore(),z&&(this.dependencyTracker=z)}setCharWidth(e,t,n){}setCharWidthAndBounds(e,t,n,r,s,a,l){const u=new Path2D;u.rect(r,s,a-r,l-s),this.ctx.clip(u),this.dependencyTracker?.recordBBox(e,this.ctx,r,a,s,l).recordClipBox(e,this.ctx,r,a,s,l),this.endPath(e)}getColorN_Pattern(e,t){let n;if(t[0]==="TilingPattern"){const r=this.baseTransform||getCurrentTransform(this.ctx),s={createCanvasGraphics:(a,l)=>new CanvasGraphics(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new CanvasNestedDependencyTracker(this.dependencyTracker,l,!0):null)};n=new TilingPattern(t,this.ctx,s,r)}else n=this._getPattern(e,t[1],t[2]);return n}setStrokeColorN(e,...t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,n=null){let r;return this.cachedPatterns.has(t)?r=this.cachedPatterns.get(t):(r=getShadingPattern(this.getObject(e,t)),this.cachedPatterns.set(t,r)),n&&(r.matrix=n),r}shadingFill(e,t){if(!this.contentVisible)return;const n=this.ctx;this.save(e);const r=this._getPattern(e,t);n.fillStyle=r.getPattern(n,this,getCurrentTransformInverse(n),PathType.SHADING,e);const s=getCurrentTransformInverse(n);if(s){const{width:a,height:l}=n.canvas,u=MIN_MAX_INIT.slice();Util.axialAlignedBoundingBox([0,0,a,l],s,u);const[d,h,p,m]=u;this.ctx.fillRect(d,h,p-d,m-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,Dependencies.transform).recordDependencies(e,Dependencies.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){unreachable("Should not call beginInlineImage")}beginImageData(){unreachable("Should not call beginImageData")}paintFormXObjectBegin(e,t,n){if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=getCurrentTransform(this.ctx),n)){Util.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[r,s,a,l]=n,u=new Path2D;u.rect(r,s,a-r,l-s),this.ctx.clip(u),this.dependencyTracker?.recordClipBox(e,this.ctx,r,a,s,l),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;t.isolated||info("TODO: Support non-isolated groups."),t.knockout&&warn("Knockout groups not supported.");const r=getCurrentTransform(n);if(t.matrix&&n.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let s=MIN_MAX_INIT.slice();Util.axialAlignedBoundingBox(t.bbox,getCurrentTransform(n),s);const a=[0,0,n.canvas.width,n.canvas.height];s=Util.intersect(s,a)||[0,0,0,0];const l=Math.floor(s[0]),u=Math.floor(s[1]),d=Math.max(Math.ceil(s[2])-l,1),h=Math.max(Math.ceil(s[3])-u,1);this.current.startNewPathAndClipBox([0,0,d,h]);let p="groupAt"+this.groupLevel;t.smask&&(p+="_smask_"+this.smaskCounter++%2);const m=this.cachedCanvases.getCanvas(p,d,h),g=m.context;g.translate(-l,-u),g.transform(...r);let v=new Path2D;const[_,b,E,A]=t.bbox;if(v.rect(_,b,E-_,A-b),t.matrix){const z=new Path2D;z.addPath(v,new DOMMatrix(t.matrix)),v=z}g.clip(v),t.smask&&this.smaskStack.push({canvas:m.canvas,context:g,offsetX:l,offsetY:u,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(l,u),n.save()),copyCtxState(n,g),this.ctx=g,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e,t){if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,r=this.groupStack.pop();if(this.ctx=r,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const s=getCurrentTransform(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...s);const a=MIN_MAX_INIT.slice();Util.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],s,a),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(a)}}beginAnnotation(e,t,n,r,s,a){if(this.#e(),resetCtxToDefault(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const l=n[2]-n[0],u=n[3]-n[1];if(a&&this.annotationCanvasMap){r=r.slice(),r[4]-=n[0],r[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=l,n[3]=u,Util.singularValueDecompose2dScale(getCurrentTransform(this.ctx),XY);const{viewportScale:d}=this,h=Math.ceil(l*this.outputScaleX*d),p=Math.ceil(u*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(h,p);const{canvas:m,context:g}=this.annotationCanvas;this.annotationCanvasMap.set(t,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=g,this.ctx.save(),this.ctx.setTransform(XY[0],0,0,-XY[1],0,u*XY[1]),resetCtxToDefault(this.ctx)}else{resetCtxToDefault(this.ctx),this.endPath(e);const d=new Path2D;d.rect(n[0],n[1],l,u),this.ctx.clip(d)}}this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...r),this.transform(e,...s)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){if(!this.contentVisible)return;const n=t.count;t=this.getObject(e,t.data,t),t.count=n;const r=this.ctx,s=this._createMaskCanvas(e,t),a=s.canvas;r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(a,s.offsetX,s.offsetY),this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,s.offsetX,s.offsetX+a.width,s.offsetY,s.offsetY+a.height).recordOperation(e),r.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n,r=0,s=0,a,l){if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const u=this.ctx;u.save();const d=getCurrentTransform(u);u.transform(n,r,s,a,0,0);const h=this._createMaskCanvas(e,t);u.setTransform(1,0,0,1,h.offsetX-d[4],h.offsetY-d[5]),this.dependencyTracker?.resetBBox(e);for(let p=0,m=l.length;p<m;p+=2){const g=Util.transform(d,[n,r,s,a,l[p],l[p+1]]);u.drawImage(h.canvas,g[4],g[5]),this.dependencyTracker?.recordBBox(e,this.ctx,g[4],g[4]+h.canvas.width,g[5],g[5]+h.canvas.height)}u.restore(),this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageMaskXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx,r=this.current.fillColor,s=this.current.patternFill;this.dependencyTracker?.resetBBox(e).recordDependencies(e,Dependencies.transformAndFill);for(const a of t){const{data:l,width:u,height:d,transform:h}=a,p=this.cachedCanvases.getCanvas("maskCanvas",u,d),m=p.context;m.save();const g=this.getObject(e,l,a);putBinaryImageMask(m,g),m.globalCompositeOperation="source-in",m.fillStyle=s?r.getPattern(m,this,getCurrentTransformInverse(n),PathType.FILL,e):r,m.fillRect(0,0,u,d),m.restore(),n.save(),n.transform(...h),n.scale(1,-1),drawImageAtIntegerCoords(n,p.canvas,0,0,u,d,0,-1,1,1),this.dependencyTracker?.recordBBox(e,n,0,u,0,d),n.restore()}this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const n=this.getObject(e,t);if(!n){warn("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,n)}paintImageXObjectRepeat(e,t,n,r,s){if(!this.contentVisible)return;const a=this.getObject(e,t);if(!a){warn("Dependent image isn't ready yet");return}const l=a.width,u=a.height,d=[];for(let h=0,p=s.length;h<p;h+=2)d.push({transform:[n,0,0,r,s[h],s[h+1]],x:0,y:0,w:l,h:u});this.paintInlineImageXObjectGroup(e,a,d)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:n,height:r}=e,s=this.cachedCanvases.getCanvas("inlineImage",n,r),a=s.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",s.canvas}paintInlineImageXObject(e,t){if(!this.contentVisible)return;const n=t.width,r=t.height,s=this.ctx;this.save(e);const{filter:a}=s;a!=="none"&&a!==""&&(s.filter="none"),s.scale(1/n,-1/r);let l;if(t.bitmap)l=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)l=t;else{const h=this.cachedCanvases.getCanvas("inlineImage",n,r).context;putBinaryImageData(h,t),l=this.applyTransferMapsToCanvas(h)}const u=this._scaleImage(l,getCurrentTransformInverse(s));s.imageSmoothingEnabled=getImageSmoothingEnabled(getCurrentTransform(s),t.interpolate),this.dependencyTracker?.resetBBox(e).recordBBox(e,s,0,n,-r,0).recordDependencies(e,Dependencies.imageXObject).recordOperation(e),drawImageAtIntegerCoords(s,u.img,0,0,u.paintWidth,u.paintHeight,0,-r,n,r),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,n){if(!this.contentVisible)return;const r=this.ctx;let s;if(t.bitmap)s=t.bitmap;else{const a=t.width,l=t.height,d=this.cachedCanvases.getCanvas("inlineImage",a,l).context;putBinaryImageData(d,t),s=this.applyTransferMapsToCanvas(d)}this.dependencyTracker?.resetBBox(e);for(const a of n)r.save(),r.transform(...a.transform),r.scale(1,-1),drawImageAtIntegerCoords(r,s,a.x,a.y,a.w,a.h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,r,0,1,-1,0),r.restore();this.dependencyTracker?.recordOperation(e),this.compose()}paintSolidColorImageMask(e){this.contentVisible&&(this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,Dependencies.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,n){}beginMarkedContent(e,t){this.dependencyTracker?.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,n){this.dependencyTracker?.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){this.dependencyTracker?.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,n){const r=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const s=this.ctx;this.pendingClip?(r||(this.pendingClip===EO_CLIP?s.clip(t,"evenodd"):s.clip(t)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):this.dependencyTracker?.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=getCurrentTransform(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:n,c:r,d:s}=this.ctx.getTransform();let a,l;if(n===0&&r===0){const u=Math.abs(t),d=Math.abs(s);if(u===d)if(e===0)a=l=1/u;else{const h=u*e;a=l=h<1?1/h:1}else if(e===0)a=1/u,l=1/d;else{const h=u*e,p=d*e;a=h<1?1/h:1,l=p<1?1/p:1}}else{const u=Math.abs(t*s-n*r),d=Math.hypot(t,n),h=Math.hypot(r,s);if(e===0)a=h/u,l=d/u;else{const p=e*u;a=h>p?h/p:1,l=d>p?d/p:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=l}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:n,current:{lineWidth:r}}=this,[s,a]=this.getScaleForStroking();if(s===a){n.lineWidth=(r||1)*s,n.stroke(e);return}const l=n.getLineDash();t&&n.save(),n.scale(s,a),SCALE_MATRIX.a=1/s,SCALE_MATRIX.d=1/a;const u=new Path2D;if(u.addPath(e,SCALE_MATRIX),l.length>0){const d=Math.max(s,a);n.setLineDash(l.map(h=>h/d)),n.lineDashOffset/=d}n.lineWidth=r||1,n.stroke(u),t&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const i in OPS)CanvasGraphics.prototype[i]!==void 0&&(CanvasGraphics.prototype[OPS[i]]=CanvasGraphics.prototype[i]);class CssFontInfo{#e;#t;#i;static strings=["fontFamily","fontWeight","italicAngle"];static write(e){const t=new TextEncoder,n={};let r=0;for(const d of CssFontInfo.strings){const h=t.encode(e[d]);n[d]=h,r+=4+h.length}const s=new ArrayBuffer(r),a=new Uint8Array(s),l=new DataView(s);let u=0;for(const d of CssFontInfo.strings){const h=n[d],p=h.length;l.setUint32(u,p),a.set(h,u+4),u+=4+p}return assert(u===s.byteLength,"CssFontInfo.write: Buffer overflow"),s}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#i=new TextDecoder}#n(e){assert(e<CssFontInfo.strings.length,"Invalid string index");let t=0;for(let r=0;r<e;r++)t+=this.#t.getUint32(t)+4;const n=this.#t.getUint32(t);return this.#i.decode(new Uint8Array(this.#e,t+4,n))}get fontFamily(){return this.#n(0)}get fontWeight(){return this.#n(1)}get italicAngle(){return this.#n(2)}}class SystemFontInfo{#e;#t;#i;static strings=["css","loadedName","baseFontName","src"];static write(e){const t=new TextEncoder,n={};let r=0;for(const m of SystemFontInfo.strings){const g=t.encode(e[m]);n[m]=g,r+=4+g.length}r+=4;let s,a,l=1+r;e.style&&(s=t.encode(e.style.style),a=t.encode(e.style.weight),l+=4+s.length+4+a.length);const u=new ArrayBuffer(l),d=new Uint8Array(u),h=new DataView(u);let p=0;h.setUint8(p++,e.guessFallback?1:0),h.setUint32(p,0),p+=4,r=0;for(const m of SystemFontInfo.strings){const g=n[m],v=g.length;r+=4+v,h.setUint32(p,v),d.set(g,p+4),p+=4+v}return h.setUint32(p-r-4,r),e.style&&(h.setUint32(p,s.length),d.set(s,p+4),p+=4+s.length,h.setUint32(p,a.length),d.set(a,p+4),p+=4+a.length),assert(p<=u.byteLength,"SubstitionInfo.write: Buffer overflow"),u.transferToFixedLength(p)}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#i=new TextDecoder}get guessFallback(){return this.#t.getUint8(0)!==0}#n(e){assert(e<SystemFontInfo.strings.length,"Invalid string index");let t=5;for(let r=0;r<e;r++)t+=this.#t.getUint32(t)+4;const n=this.#t.getUint32(t);return this.#i.decode(new Uint8Array(this.#e,t+4,n))}get css(){return this.#n(0)}get loadedName(){return this.#n(1)}get baseFontName(){return this.#n(2)}get src(){return this.#n(3)}get style(){let e=1;e+=4+this.#t.getUint32(e);const t=this.#t.getUint32(e),n=this.#i.decode(new Uint8Array(this.#e,e+4,t));e+=4+t;const r=this.#t.getUint32(e),s=this.#i.decode(new Uint8Array(this.#e,e+4,r));return{style:n,weight:s}}}class FontInfo{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#e=Math.ceil(this.bools.length*2/8);static#t=this.#e+this.numbers.length*8;static#i=this.#t+1+8;static#n=this.#i+1+48;static#r=this.#n+1+6;#a;#o;#s;constructor({data:e,extra:t}){this.#a=e,this.#o=new TextDecoder,this.#s=new DataView(this.#a),t&&Object.assign(this,t)}#l(e){assert(e<FontInfo.bools.length,"Invalid boolean index");const t=Math.floor(e/4),n=e*2%8,r=this.#s.getUint8(t)>>n&3;return r===0?void 0:r===2}get black(){return this.#l(0)}get bold(){return this.#l(1)}get disableFontFace(){return this.#l(2)}get fontExtraProperties(){return this.#l(3)}get isInvalidPDFjsFont(){return this.#l(4)}get isType3Font(){return this.#l(5)}get italic(){return this.#l(6)}get missingFile(){return this.#l(7)}get remeasure(){return this.#l(8)}get vertical(){return this.#l(9)}#c(e){return assert(e<FontInfo.numbers.length,"Invalid number index"),this.#s.getFloat64(FontInfo.#e+e*8)}get ascent(){return this.#c(0)}get defaultWidth(){return this.#c(1)}get descent(){return this.#c(2)}get bbox(){let e=FontInfo.#t;if(this.#s.getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<4;r++)n.push(this.#s.getInt16(e,!0)),e+=2;return n}get fontMatrix(){let e=FontInfo.#i;if(this.#s.getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<6;r++)n.push(this.#s.getFloat64(e,!0)),e+=8;return n}get defaultVMetrics(){let e=FontInfo.#n;if(this.#s.getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<3;r++)n.push(this.#s.getInt16(e,!0)),e+=2;return n}#h(e){assert(e<FontInfo.strings.length,"Invalid string index");let t=FontInfo.#r+4;for(let s=0;s<e;s++)t+=this.#s.getUint32(t)+4;const n=this.#s.getUint32(t),r=new Uint8Array(n);return r.set(new Uint8Array(this.#a,t+4,n)),this.#o.decode(r)}get fallbackName(){return this.#h(0)}get loadedName(){return this.#h(1)}get mimetype(){return this.#h(2)}get name(){return this.#h(3)}get data(){let e=FontInfo.#r;const t=this.#s.getUint32(e);e+=4+t;const n=this.#s.getUint32(e);e+=4+n;const r=this.#s.getUint32(e);e+=4+r;const s=this.#s.getUint32(e);if(s!==0)return new Uint8Array(this.#a,e+4,s)}clearData(){let e=FontInfo.#r;const t=this.#s.getUint32(e);e+=4+t;const n=this.#s.getUint32(e);e+=4+n;const r=this.#s.getUint32(e);e+=4+r;const s=this.#s.getUint32(e);new Uint8Array(this.#a,e+4,s).fill(0),this.#s.setUint32(e,0)}get cssFontInfo(){let e=FontInfo.#r;const t=this.#s.getUint32(e);e+=4+t;const n=this.#s.getUint32(e);e+=4+n;const r=this.#s.getUint32(e);if(r===0)return null;const s=new Uint8Array(r);return s.set(new Uint8Array(this.#a,e+4,r)),new CssFontInfo(s.buffer)}get systemFontInfo(){let e=FontInfo.#r;const t=this.#s.getUint32(e);e+=4+t;const n=this.#s.getUint32(e);if(n===0)return null;const r=new Uint8Array(n);return r.set(new Uint8Array(this.#a,e+4,n)),new SystemFontInfo(r.buffer)}static write(e){const t=e.systemFontInfo?SystemFontInfo.write(e.systemFontInfo):null,n=e.cssFontInfo?CssFontInfo.write(e.cssFontInfo):null,r=new TextEncoder,s={};let a=0;for(const _ of FontInfo.strings)s[_]=r.encode(e[_]),a+=4+s[_].length;const l=FontInfo.#r+4+a+4+(t?t.byteLength:0)+4+(n?n.byteLength:0)+4+(e.data?e.data.length:0),u=new ArrayBuffer(l),d=new Uint8Array(u),h=new DataView(u);let p=0;const m=FontInfo.bools.length;let g=0,v=0;for(let _=0;_<m;_++){const b=e[FontInfo.bools[_]];g|=(b===void 0?0:b?2:1)<<v,v+=2,(v===8||_===m-1)&&(h.setUint8(p++,g),g=0,v=0)}assert(p===FontInfo.#e,"FontInfo.write: Boolean properties offset mismatch");for(const _ of FontInfo.numbers)h.setFloat64(p,e[_]),p+=8;if(assert(p===FontInfo.#t,"FontInfo.write: Number properties offset mismatch"),e.bbox){h.setUint8(p++,4);for(const _ of e.bbox)h.setInt16(p,_,!0),p+=2}else h.setUint8(p++,0),p+=8;if(assert(p===FontInfo.#i,"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){h.setUint8(p++,6);for(const _ of e.fontMatrix)h.setFloat64(p,_,!0),p+=8}else h.setUint8(p++,0),p+=48;if(assert(p===FontInfo.#n,"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){h.setUint8(p++,1);for(const _ of e.defaultVMetrics)h.setInt16(p,_,!0),p+=2}else h.setUint8(p++,0),p+=6;assert(p===FontInfo.#r,"FontInfo.write: DefaultVMetrics properties offset mismatch"),h.setUint32(FontInfo.#r,0),p+=4;for(const _ of FontInfo.strings){const b=s[_],E=b.length;h.setUint32(p,E),d.set(b,p+4),p+=4+E}if(h.setUint32(FontInfo.#r,p-FontInfo.#r-4),!t)h.setUint32(p,0),p+=4;else{const _=t.byteLength;h.setUint32(p,_),assert(p+4+_<=u.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),d.set(new Uint8Array(t),p+4),p+=4+_}if(!n)h.setUint32(p,0),p+=4;else{const _=n.byteLength;h.setUint32(p,_),assert(p+4+_<=u.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),d.set(new Uint8Array(n),p+4),p+=4+_}return e.data===void 0?(h.setUint32(p,0),p+=4):(h.setUint32(p,e.data.length),d.set(e.data,p+4),p+=4+e.data.length),assert(p<=u.byteLength,"FontInfo.write: Buffer overflow"),u.transferToFixedLength(p)}}class GlobalWorkerOptions{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#e=e}static get workerSrc(){return this.#t}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#t=e}}class Metadata{#e;#t;constructor({parsedData:e,rawData:t}){this.#e=e,this.#t=t}getRaw(){return this.#t}get(e){return this.#e.get(e)??null}[Symbol.iterator](){return this.#e.entries()}}const INTERNAL=Symbol("INTERNAL");class OptionalContentGroup{#e=!1;#t=!1;#i=!1;#n=!0;constructor(e,{name:t,intent:n,usage:r,rbGroups:s}){this.#e=!!(e&RenderingIntentFlag.DISPLAY),this.#t=!!(e&RenderingIntentFlag.PRINT),this.name=t,this.intent=n,this.usage=r,this.rbGroups=s}get visible(){if(this.#i)return this.#n;if(!this.#n)return!1;const{print:e,view:t}=this.usage;return this.#e?t?.viewState!=="OFF":this.#t?e?.printState!=="OFF":!0}_setVisible(e,t,n=!1){e!==INTERNAL&&unreachable("Internal method `_setVisible` called."),this.#i=n,this.#n=t}}class OptionalContentConfig{#e=null;#t=new Map;#i=null;#n=null;constructor(e,t=RenderingIntentFlag.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#n=e.order;for(const n of e.groups)this.#t.set(n.id,new OptionalContentGroup(t,n));if(e.baseState==="OFF")for(const n of this.#t.values())n._setVisible(INTERNAL,!1);for(const n of e.on)this.#t.get(n)._setVisible(INTERNAL,!0);for(const n of e.off)this.#t.get(n)._setVisible(INTERNAL,!1);this.#i=this.getHash()}}#r(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let r=1;r<t;r++){const s=e[r];let a;if(Array.isArray(s))a=this.#r(s);else if(this.#t.has(s))a=this.#t.get(s).visible;else return warn(`Optional content group not found: ${s}`),!0;switch(n){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return n==="And"}isVisible(e){if(this.#t.size===0)return!0;if(!e)return info("Optional content group not defined."),!0;if(e.type==="OCG")return this.#t.has(e.id)?this.#t.get(e.id).visible:(warn(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#r(e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!this.#t.has(t))return warn(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!this.#t.has(t))return warn(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!this.#t.has(t))return warn(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!this.#t.has(t))return warn(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!1}return!0}return warn(`Unknown optional content policy ${e.policy}.`),!0}return warn(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){const r=this.#t.get(e);if(!r){warn(`Optional content group not found: ${e}`);return}if(n&&t&&r.rbGroups.length)for(const s of r.rbGroups)for(const a of s)a!==e&&this.#t.get(a)?._setVisible(INTERNAL,!1,!0);r._setVisible(INTERNAL,!!t,!0),this.#e=null}setOCGState({state:e,preserveRB:t}){let n;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":n=r;continue}const s=this.#t.get(r);if(s)switch(n){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!s.visible,t);break}}this.#e=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#t.size?this.#n?this.#n.slice():[...this.#t.keys()]:null}getGroup(e){return this.#t.get(e)||null}getHash(){if(this.#e!==null)return this.#e;const e=new MurmurHash3_64;for(const[t,n]of this.#t)e.update(`${t}:${n.visible}`);return this.#e=e.hexdigest()}[Symbol.iterator](){return this.#t.entries()}}class PDFDataTransportStream{constructor(e,{disableRange:t=!1,disableStream:n=!1}){assert(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:s,progressiveDone:a,contentDispositionFilename:l}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=l,s?.length>0){const u=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;this._queuedChunks.push(u)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((u,d)=>{this._onReceiveData({begin:u,chunk:d})}),e.addProgressListener((u,d)=>{this._onProgress({loaded:u,total:d})}),e.addProgressiveReadListener(u=>{this._onReceiveData({chunk:u})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const r=this._rangeReaders.some(function(s){return s._begin!==e?!1:(s._enqueue(n),!0)});assert(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){assert(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new PDFDataTransportStreamReader(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new PDFDataTransportStreamRangeReader(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class PDFDataTransportStreamReader{constructor(e,t,n=!1,r=null){this._stream=e,this._done=n||!1,this._filename=isPdfFile(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class PDFDataTransportStreamRangeReader{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function getFilenameFromContentDispositionHeader(i){let e=!0,t=n("filename\\*","i").exec(i);if(t){t=t[1];let h=l(t);return h=unescape(h),h=u(h),h=d(h),s(h)}if(t=a(i),t){const h=d(t);return s(h)}if(t=n("filename","i").exec(i),t){t=t[1];let h=l(t);return h=d(h),s(h)}function n(h,p){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',p)}function r(h,p){if(h){if(!/^[\x00-\xFF]+$/.test(p))return p;try{const m=new TextDecoder(h,{fatal:!0}),g=stringToBytes(p);p=m.decode(g),e=!1}catch{}}return p}function s(h){return e&&/[\x80-\xff]/.test(h)&&(h=r("utf-8",h),e&&(h=r("iso-8859-1",h))),h}function a(h){const p=[];let m;const g=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(m=g.exec(h))!==null;){let[,_,b,E]=m;if(_=parseInt(_,10),_ in p){if(_===0)break;continue}p[_]=[b,E]}const v=[];for(let _=0;_<p.length&&_ in p;++_){let[b,E]=p[_];E=l(E),b&&(E=unescape(E),_===0&&(E=u(E))),v.push(E)}return v.join("")}function l(h){if(h.startsWith('"')){const p=h.slice(1).split('\\"');for(let m=0;m<p.length;++m){const g=p[m].indexOf('"');g!==-1&&(p[m]=p[m].slice(0,g),p.length=m+1),p[m]=p[m].replaceAll(/\\(.)/g,"$1")}h=p.join('"')}return h}function u(h){const p=h.indexOf("'");if(p===-1)return h;const m=h.slice(0,p),v=h.slice(p+1).replace(/^[^']*'/,"");return r(m,v)}function d(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(p,m,g,v){if(g==="q"||g==="Q")return v=v.replaceAll("_"," "),v=v.replaceAll(/=([0-9a-fA-F]{2})/g,function(_,b){return String.fromCharCode(parseInt(b,16))}),r(m,v);try{v=atob(v)}catch{}return r(m,v)})}return""}function createHeaders(i,e){const t=new Headers;if(!i||!e||typeof e!="object")return t;for(const n in e){const r=e[n];r!==void 0&&t.append(n,r)}return t}function getResponseOrigin(i){return URL.parse(i)?.origin??null}function validateRangeRequestCapabilities({responseHeaders:i,isHttp:e,rangeChunkSize:t,disableRange:n}){const r={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(i.get("Content-Length"),10);return!Number.isInteger(s)||(r.suggestedLength=s,s<=2*t)||n||!e||i.get("Accept-Ranges")!=="bytes"||(i.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function extractFilenameFromHeader(i){const e=i.get("Content-Disposition");if(e){let t=getFilenameFromContentDispositionHeader(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(isPdfFile(t))return t}return null}function createResponseError(i,e){return new ResponseException(`Unexpected server response (${i}) while retrieving PDF "${e}".`,i,i===404||i===0&&e.startsWith("file:"))}function validateResponseStatus(i){return i===200||i===206}function createFetchOptions(i,e,t){return{method:"GET",headers:i,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function getArrayBuffer(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:(warn(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}class PDFFetchStream{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=createHeaders(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return assert(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new PDFFetchStreamReader(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new PDFFetchStreamRangeReader(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class PDFFetchStreamReader{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const n=new Headers(e.headers),r=t.url;fetch(r,createFetchOptions(n,this._withCredentials,this._abortController)).then(s=>{if(e._responseOrigin=getResponseOrigin(s.url),!validateResponseStatus(s.status))throw createResponseError(s.status,r);this._reader=s.body.getReader(),this._headersCapability.resolve();const a=s.headers,{allowRangeRequests:l,suggestedLength:u}=validateRangeRequestCapabilities({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=l,this._contentLength=u||this._contentLength,this._filename=extractFilenameFromHeader(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:getArrayBuffer(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class PDFFetchStreamRangeReader{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const s=new Headers(e.headers);s.append("Range",`bytes=${t}-${n-1}`);const a=r.url;fetch(a,createFetchOptions(s,this._withCredentials,this._abortController)).then(l=>{const u=getResponseOrigin(l.url);if(u!==e._responseOrigin)throw new Error(`Expected range response-origin "${u}" to match "${e._responseOrigin}".`);if(!validateResponseStatus(l.status))throw createResponseError(l.status,a);this._readCapability.resolve(),this._reader=l.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:getArrayBuffer(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}const OK_RESPONSE=200,PARTIAL_CONTENT_RESPONSE=206;function network_getArrayBuffer(i){const e=i.response;return typeof e!="string"?e:stringToBytes(e).buffer}class NetworkManager{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:n}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=createHeaders(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,r=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[s,a]of this.headers)t.setRequestHeader(s,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=PARTIAL_CONTENT_RESPONSE):r.expectedStatus=OK_RESPONSE,t.responseType="arraybuffer",assert(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){const n=this.pendingRequests[e];n&&n.onProgress?.(t)}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const r=n.xhr;if(r.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){n.onError(r.status);return}const s=r.status||OK_RESPONSE;if(!(s===OK_RESPONSE&&n.expectedStatus===PARTIAL_CONTENT_RESPONSE)&&s!==n.expectedStatus){n.onError(r.status);return}const l=network_getArrayBuffer(r);if(s===PARTIAL_CONTENT_RESPONSE){const u=r.getResponseHeader("Content-Range"),d=/bytes (\d+)-(\d+)\/(\d+)/.exec(u);d?n.onDone({begin:parseInt(d[1],10),chunk:l}):(warn('Missing or invalid "Content-Range" header.'),n.onError(0))}else l?n.onDone({begin:0,chunk:l}):n.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class PDFNetworkStream{constructor(e){this._source=e,this._manager=new NetworkManager(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return assert(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new PDFNetworkStreamFullRequestReader(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new PDFNetworkStreamRangeRequestReader(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class PDFNetworkStreamFullRequestReader{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=getResponseOrigin(t.responseURL);const n=t.getAllResponseHeaders(),r=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(l=>{const[u,...d]=l.split(": ");return[u,d.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:a}=validateRangeRequestCapabilities({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=extractFilenameFromHeader(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=createResponseError(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class PDFNetworkStreamRangeRequestReader{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const e=getResponseOrigin(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=createResponseError(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const urlRegex=/^[a-z][a-z0-9\-+.]+:/i;function parseUrlOrPath(i){if(urlRegex.test(i))return new URL(i);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(i))}class PDFNodeStream{constructor(e){this.source=e,this.url=parseUrlOrPath(e.url),assert(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return assert(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new PDFNodeStreamFsFullReader(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new PDFNodeStreamFsRangeReader(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class PDFNodeStreamFsFullReader{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=createResponseError(0,this._url.href)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class PDFNodeStreamFsRangeReader{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const s=process.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const INITIAL_DATA=Symbol("INITIAL_DATA");class PDFObjects{#e=Object.create(null);#t(e){return this.#e[e]||={...Promise.withResolvers(),data:INITIAL_DATA}}get(e,t=null){if(t){const r=this.#t(e);return r.promise.then(()=>t(r.data)),null}const n=this.#e[e];if(!n||n.data===INITIAL_DATA)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=this.#e[e];return!!t&&t.data!==INITIAL_DATA}delete(e){const t=this.#e[e];return!t||t.data===INITIAL_DATA?!1:(delete this.#e[e],!0)}resolve(e,t=null){const n=this.#t(e);n.data=t,n.resolve()}clear(){for(const e in this.#e){const{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const e in this.#e){const{data:t}=this.#e[e];t!==INITIAL_DATA&&(yield[e,t])}}}const MAX_TEXT_DIVS_TO_RENDER=1e5,DEFAULT_FONT_SIZE=30;class TextLayer{#e=Promise.withResolvers();#t=null;#i=!1;#n=!!globalThis.FontInspector?.enabled;#r=null;#a=null;#o=0;#s=0;#l=null;#c=null;#h=0;#d=0;#f=Object.create(null);#g=[];#p=null;#u=[];#m=new WeakMap;#y=null;static#b=new Map;static#v=new Map;static#w=new WeakMap;static#x=null;static#_=new Set;constructor({textContentSource:e,container:t,viewport:n}){if(e instanceof ReadableStream)this.#p=e;else if(typeof e=="object")this.#p=new ReadableStream({start(u){u.enqueue(e),u.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#c=t,this.#d=n.scale*OutputScale.pixelRatio,this.#h=n.rotation,this.#a={div:null,properties:null,ctx:null};const{pageWidth:r,pageHeight:s,pageX:a,pageY:l}=n.rawDims;this.#y=[1,0,0,-1,-a,l+s],this.#s=r,this.#o=s,TextLayer.#R(),setLayerDimensions(t,n),this.#e.promise.finally(()=>{TextLayer.#_.delete(this),this.#a=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=util_FeatureTest.platform;return shadow(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{this.#l.read().then(({value:t,done:n})=>{if(n){this.#e.resolve();return}this.#r??=t.lang,Object.assign(this.#f,t.styles),this.#P(t.items),e()},this.#e.reject)};return this.#l=this.#p.getReader(),TextLayer.#_.add(this),e(),this.#e.promise}update({viewport:e,onBefore:t=null}){const n=e.scale*OutputScale.pixelRatio,r=e.rotation;if(r!==this.#h&&(t?.(),this.#h=r,setLayerDimensions(this.#c,{rotation:r})),n!==this.#d){t?.(),this.#d=n;const s={div:null,properties:null,ctx:TextLayer.#I(this.#r)};for(const a of this.#u)s.properties=this.#m.get(a),s.div=a,this.#A(s)}}cancel(){const e=new AbortException("TextLayer task cancelled.");this.#l?.cancel(e).catch(()=>{}),this.#l=null,this.#e.reject(e)}get textDivs(){return this.#u}get textContentItemsStr(){return this.#g}#P(e){if(this.#i)return;this.#a.ctx??=TextLayer.#I(this.#r);const t=this.#u,n=this.#g;for(const r of e){if(t.length>MAX_TEXT_DIVS_TO_RENDER){warn("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(r.str===void 0){if(r.type==="beginMarkedContentProps"||r.type==="beginMarkedContent"){const s=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),r.id&&this.#t.setAttribute("id",`${r.id}`),s.append(this.#t)}else r.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}n.push(r.str),this.#E(r)}}#E(e){const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#u.push(t);const r=Util.transform(this.#y,e.transform);let s=Math.atan2(r[1],r[0]);const a=this.#f[e.fontName];a.vertical&&(s+=Math.PI/2);let l=this.#n&&a.fontSubstitution||a.fontFamily;l=TextLayer.fontFamilyMap.get(l)||l;const u=Math.hypot(r[2],r[3]),d=u*TextLayer.#L(l,a,this.#r);let h,p;s===0?(h=r[4],p=r[5]-d):(h=r[4]+d*Math.sin(s),p=r[5]-d*Math.cos(s));const m="calc(var(--total-scale-factor) *",g=t.style;this.#t===this.#c?(g.left=`${(100*h/this.#s).toFixed(2)}%`,g.top=`${(100*p/this.#o).toFixed(2)}%`):(g.left=`${m}${h.toFixed(2)}px)`,g.top=`${m}${p.toFixed(2)}px)`),g.fontSize=`${m}${(TextLayer.#x*u).toFixed(2)}px)`,g.fontFamily=l,n.fontSize=u,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#n&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),s!==0&&(n.angle=s*(180/Math.PI));let v=!1;if(e.str.length>1)v=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const _=Math.abs(e.transform[0]),b=Math.abs(e.transform[3]);_!==b&&Math.max(_,b)/Math.min(_,b)>1.5&&(v=!0)}if(v&&(n.canvasWidth=a.vertical?e.height:e.width),this.#m.set(t,n),this.#a.div=t,this.#a.properties=n,this.#A(this.#a),n.hasText&&this.#t.append(t),n.hasEOL){const _=document.createElement("br");_.setAttribute("role","presentation"),this.#t.append(_)}}#A(e){const{div:t,properties:n,ctx:r}=e,{style:s}=t;let a="";if(TextLayer.#x>1&&(a=`scale(${1/TextLayer.#x})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:l}=s,{canvasWidth:u,fontSize:d}=n;TextLayer.#S(r,d*this.#d,l);const{width:h}=r.measureText(t.textContent);h>0&&(a=`scaleX(${u*this.#d/h}) ${a}`)}n.angle!==0&&(a=`rotate(${n.angle}deg) ${a}`),a.length>0&&(s.transform=a)}static cleanup(){if(!(this.#_.size>0)){this.#b.clear();for(const{canvas:e}of this.#v.values())e.remove();this.#v.clear()}}static#I(e=null){let t=this.#v.get(e||="");if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#v.set(e,t),this.#w.set(t,{size:0,family:""})}return t}static#S(e,t,n){const r=this.#w.get(e);t===r.size&&n===r.family||(e.font=`${t}px ${n}`,r.size=t,r.family=n)}static#R(){if(this.#x!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#x=e.getBoundingClientRect().height,e.remove()}static#L(e,t,n){const r=this.#b.get(e);if(r)return r;const s=this.#I(n);s.canvas.width=s.canvas.height=DEFAULT_FONT_SIZE,this.#S(s,DEFAULT_FONT_SIZE,e);const a=s.measureText(""),l=a.fontBoundingBoxAscent,u=Math.abs(a.fontBoundingBoxDescent);s.canvas.width=s.canvas.height=0;let d=.8;return l?d=l/(l+u):(util_FeatureTest.platform.isFirefox&&warn("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?d=t.ascent:t.descent&&(d=1+t.descent)),this.#b.set(e,d),d}}const RENDERING_CANCELLED_TIMEOUT=100;function getDocument(i={}){typeof i=="string"||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});const e=new PDFDocumentLoadingTask,{docId:t}=e,n=i.url?getUrlProp(i.url):null,r=i.data?getDataProp(i.data):null,s=i.httpHeaders||null,a=i.withCredentials===!0,l=i.password??null,u=i.range instanceof PDFDataRangeTransport?i.range:null,d=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:2**16;let h=i.worker instanceof PDFWorker?i.worker:null;const p=i.verbosity,m=typeof i.docBaseUrl=="string"&&!isDataScheme(i.docBaseUrl)?i.docBaseUrl:null,g=getFactoryUrlProp(i.cMapUrl),v=i.cMapPacked!==!1,_=i.CMapReaderFactory||(isNodeJS?NodeCMapReaderFactory:DOMCMapReaderFactory),b=getFactoryUrlProp(i.iccUrl),E=getFactoryUrlProp(i.standardFontDataUrl),A=i.StandardFontDataFactory||(isNodeJS?NodeStandardFontDataFactory:DOMStandardFontDataFactory),z=getFactoryUrlProp(i.wasmUrl),D=i.WasmFactory||(isNodeJS?NodeWasmFactory:DOMWasmFactory),P=i.stopAtErrors!==!0,G=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,R=i.isEvalSupported!==!1,I=typeof i.isOffscreenCanvasSupported=="boolean"?i.isOffscreenCanvasSupported:!isNodeJS,w=typeof i.isImageDecoderSupported=="boolean"?i.isImageDecoderSupported:!isNodeJS&&(util_FeatureTest.platform.isFirefox||!globalThis.chrome),H=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,V=typeof i.disableFontFace=="boolean"?i.disableFontFace:isNodeJS,te=i.fontExtraProperties===!0,ae=i.enableXfa===!0,be=i.ownerDocument||globalThis.document,_e=i.disableRange===!0,le=i.disableStream===!0,ue=i.disableAutoFetch===!0,oe=i.pdfBug===!0,ee=i.CanvasFactory||(isNodeJS?NodeCanvasFactory:DOMCanvasFactory),se=i.FilterFactory||(isNodeJS?NodeFilterFactory:DOMFilterFactory),re=i.enableHWA===!0,fe=i.useWasm!==!1,pe=u?u.length:i.length??NaN,Z=typeof i.useSystemFonts=="boolean"?i.useSystemFonts:!isNodeJS&&!V,ce=typeof i.useWorkerFetch=="boolean"?i.useWorkerFetch:!!(_===DOMCMapReaderFactory&&A===DOMStandardFontDataFactory&&D===DOMWasmFactory&&g&&E&&z&&isValidFetchUrl(g,document.baseURI)&&isValidFetchUrl(E,document.baseURI)&&isValidFetchUrl(z,document.baseURI)),Ee=null;setVerbosityLevel(p);const Te={canvasFactory:new ee({ownerDocument:be,enableHWA:re}),filterFactory:new se({docId:t,ownerDocument:be}),cMapReaderFactory:ce?null:new _({baseUrl:g,isCompressed:v}),standardFontDataFactory:ce?null:new A({baseUrl:E}),wasmFactory:ce?null:new D({baseUrl:z})};h||(h=PDFWorker.create({verbosity:p,port:GlobalWorkerOptions.workerPort}),e._worker=h);const Ae={docId:t,apiVersion:"5.4.296",data:r,password:l,disableAutoFetch:ue,rangeChunkSize:d,length:pe,docBaseUrl:m,enableXfa:ae,evaluatorOptions:{maxImageSize:G,disableFontFace:V,ignoreErrors:P,isEvalSupported:R,isOffscreenCanvasSupported:I,isImageDecoderSupported:w,canvasMaxAreaInBytes:H,fontExtraProperties:te,useSystemFonts:Z,useWasm:fe,useWorkerFetch:ce,cMapUrl:g,iccUrl:b,standardFontDataUrl:E,wasmUrl:z}},Pe={ownerDocument:be,pdfBug:oe,styleElement:Ee,loadingParams:{disableAutoFetch:ue,enableXfa:ae}};return h.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const Me=h.messageHandler.sendWithPromise("GetDocRequest",Ae,r?[r.buffer]:null);let We;if(u)We=new PDFDataTransportStream(u,{disableRange:_e,disableStream:le});else if(!r){if(!n)throw new Error("getDocument - no `url` parameter provided.");const qe=isValidFetchUrl(n)?PDFFetchStream:isNodeJS?PDFNodeStream:PDFNetworkStream;We=new qe({url:n,length:pe,httpHeaders:s,withCredentials:a,rangeChunkSize:d,disableRange:_e,disableStream:le})}return Me.then(qe=>{if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const Je=new MessageHandler(t,qe,h.port),wt=new WorkerTransport(Je,e,We,Pe,Te,re);e._transport=wt,Je.send("Ready",null)})}).catch(e._capability.reject),e}class PDFDocumentLoadingTask{static#e=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${PDFDocumentLoadingTask.#e++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class PDFDataRangeTransport{#e=Promise.withResolvers();#t=[];#i=[];#n=[];#r=[];constructor(e,t,n=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r}addRangeListener(e){this.#r.push(e)}addProgressListener(e){this.#n.push(e)}addProgressiveReadListener(e){this.#i.push(e)}addProgressiveDoneListener(e){this.#t.push(e)}onDataRange(e,t){for(const n of this.#r)n(e,t)}onDataProgress(e,t){this.#e.promise.then(()=>{for(const n of this.#n)n(e,t)})}onDataProgressiveRead(e){this.#e.promise.then(()=>{for(const t of this.#i)t(e)})}onDataProgressiveDone(){this.#e.promise.then(()=>{for(const e of this.#t)e()})}transportReady(){this.#e.resolve()}requestDataRange(e,t){unreachable("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return shadow(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class PDFPageProxy{#e=!1;constructor(e,t,n,r=!1){this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=r?new StatTimer:null,this._pdfBug=r,this.commonObjs=n.commonObjs,this.objs=new PDFObjects,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:s=!1}={}){return new PageViewport({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:s})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return shadow(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,canvas:t=e.canvas,viewport:n,intent:r="display",annotationMode:s=AnnotationMode.ENABLE,transform:a=null,background:l=null,optionalContentConfigPromise:u=null,annotationCanvasMap:d=null,pageColors:h=null,printAnnotationStorage:p=null,isEditing:m=!1,recordOperations:g=!1,operationsFilter:v=null}){this._stats?.time("Overall");const _=this._transport.getRenderingIntent(r,s,p,m),{renderingIntent:b,cacheKey:E}=_;this.#e=!1,u||=this._transport.getOptionalContentConfig(b);let A=this._intentStates.get(E);A||(A=Object.create(null),this._intentStates.set(E,A)),A.streamReaderCancelTimeout&&(clearTimeout(A.streamReaderCancelTimeout),A.streamReaderCancelTimeout=null);const z=!!(b&RenderingIntentFlag.PRINT);A.displayReadyCapability||(A.displayReadyCapability=Promise.withResolvers(),A.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(_));const D=!!(this._pdfBug&&globalThis.StepperManager?.enabled),P=!this.recordedBBoxes&&(g||D),G=w=>{if(A.renderTasks.delete(R),P){const H=R.gfx?.dependencyTracker.take();H&&(R.stepper&&R.stepper.setOperatorBBoxes(H,R.gfx.dependencyTracker.takeDebugMetadata()),g&&(this.recordedBBoxes=H))}z&&(this.#e=!0),this.#t(),w?(R.capability.reject(w),this._abortOperatorList({intentState:A,reason:w instanceof Error?w:new Error(w)})):R.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},R=new InternalRenderTask({callback:G,params:{canvas:t,canvasContext:e,dependencyTracker:P?new CanvasDependencyTracker(t,A.operatorList.length,D):null,viewport:n,transform:a,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:d,operatorList:A.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!z,pdfBug:this._pdfBug,pageColors:h,enableHWA:this._transport.enableHWA,operationsFilter:v});(A.renderTasks||=new Set).add(R);const I=R.task;return Promise.all([A.displayReadyCapability.promise,u]).then(([w,H])=>{if(this.destroyed){G();return}if(this._stats?.time("Rendering"),!(H.renderingIntent&b))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");R.initializeGraphics({transparency:w,optionalContentConfig:H}),R.operatorListChanged()}).catch(G),I}getOperatorList({intent:e="display",annotationMode:t=AnnotationMode.ENABLE,printAnnotationStorage:n=null,isEditing:r=!1}={}){function s(){l.operatorList.lastChunk&&(l.opListReadCapability.resolve(l.operatorList),l.renderTasks.delete(u))}const a=this._transport.getRenderingIntent(e,t,n,r,!0);let l=this._intentStates.get(a.cacheKey);l||(l=Object.create(null),this._intentStates.set(a.cacheKey,l));let u;return l.opListReadCapability||(u=Object.create(null),u.operatorListChanged=s,l.opListReadCapability=Promise.withResolvers(),(l.renderTasks||=new Set).add(u),l.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(a)),l.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>XfaText.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,r){function s(){a.read().then(function({value:u,done:d}){if(d){n(l);return}l.lang??=u.lang,Object.assign(l.styles,u.styles),l.items.push(...u.items),s()},r)}const a=t.getReader(),l={items:[],styles:Object.create(null),lang:null};s()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),this.#e=!1,Promise.all(e)}cleanup(e=!1){this.#e=!0;const t=this.#t();return e&&t&&(this._stats&&=new StatTimer),t}#t(){if(!this.#e||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}_startRenderPage(e,t){const n=this._intentStates.get(t);n&&(this._stats?.timeEnd("Page Request"),n.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&this.#t()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:r}){const{map:s,transfer:a}=n,u=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:s,modifiedIds:r},a).getReader(),d=this._intentStates.get(t);d.streamReader=u;const h=()=>{u.read().then(({value:p,done:m})=>{if(m){d.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(p,d),h())},p=>{if(d.streamReader=null,!this._transport.destroyed){if(d.operatorList){d.operatorList.lastChunk=!0;for(const m of d.renderTasks)m.operatorListChanged();this.#t()}if(d.displayReadyCapability)d.displayReadyCapability.reject(p);else if(d.opListReadCapability)d.opListReadCapability.reject(p);else throw p}})};h()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof RenderingCancelledException){let r=RENDERING_CANCELLED_TIMEOUT;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new AbortException(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,s]of this._intentStates)if(s===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}var Uo,Ca,_o,rl,pu,sl,al,Es,hu,Bp,jp,pc,kl,fu;const Ar=class Ar{constructor({name:e=null,port:t=null,verbosity:n=getVerbosityLevel()}={}){Ka(this,Es);Ka(this,Uo,Promise.withResolvers());Ka(this,Ca,null);Ka(this,_o,null);Ka(this,rl,null);if(this.name=e,this.destroyed=!1,this.verbosity=n,t){if(Sr(Ar,al).has(t))throw new Error("Cannot use more than one PDFWorker per port.");Sr(Ar,al).set(t,this),Xa(this,Es,Bp).call(this,t)}else Xa(this,Es,jp).call(this)}get promise(){return Sr(this,Uo).promise}get port(){return Sr(this,_o)}get messageHandler(){return Sr(this,Ca)}destroy(){this.destroyed=!0,Sr(this,rl)?.terminate(),Vs(this,rl,null),Sr(Ar,al).delete(Sr(this,_o)),Vs(this,_o,null),Sr(this,Ca)?.destroy(),Vs(this,Ca,null)}static create(e){const t=Sr(this,al).get(e?.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Ar(e)}static get workerSrc(){if(GlobalWorkerOptions.workerSrc)return GlobalWorkerOptions.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return shadow(this,"_setupFakeWorkerGlobal",(async()=>Sr(this,kl,fu)?Sr(this,kl,fu):(await import(this.workerSrc)).WorkerMessageHandler)())}};Uo=new WeakMap,Ca=new WeakMap,_o=new WeakMap,rl=new WeakMap,pu=new WeakMap,sl=new WeakMap,al=new WeakMap,Es=new WeakSet,hu=function(){Sr(this,Uo).resolve(),Sr(this,Ca).send("configure",{verbosity:this.verbosity})},Bp=function(e){Vs(this,_o,e),Vs(this,Ca,new MessageHandler("main","worker",e)),Sr(this,Ca).on("ready",()=>{}),Xa(this,Es,hu).call(this)},jp=function(){if(Sr(Ar,sl)||Sr(Ar,kl,fu)){Xa(this,Es,pc).call(this);return}let{workerSrc:e}=Ar;try{Ar._isSameOrigin(window.location,e)||(e=Ar._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new MessageHandler("main","worker",t),r=()=>{s.abort(),n.destroy(),t.terminate(),this.destroyed?Sr(this,Uo).reject(new Error("Worker was destroyed")):Xa(this,Es,pc).call(this)},s=new AbortController;t.addEventListener("error",()=>{Sr(this,rl)||r()},{signal:s.signal}),n.on("test",l=>{if(s.abort(),this.destroyed||!l){r();return}Vs(this,Ca,n),Vs(this,_o,t),Vs(this,rl,t),Xa(this,Es,hu).call(this)}),n.on("ready",l=>{if(s.abort(),this.destroyed){r();return}try{a()}catch{Xa(this,Es,pc).call(this)}});const a=()=>{const l=new Uint8Array;n.send("test",l,[l.buffer])};a();return}catch{info("The worker has been disabled.")}Xa(this,Es,pc).call(this)},pc=function(){Sr(Ar,sl)||(warn("Setting up fake worker."),Vs(Ar,sl,!0)),Ar._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){Sr(this,Uo).reject(new Error("Worker was destroyed"));return}const t=new LoopbackPort;Vs(this,_o,t);const n=`fake${Vp(Ar,pu)._++}`,r=new MessageHandler(n+"_worker",n,t);e.setup(r,t),Vs(this,Ca,new MessageHandler(n,n+"_worker",t)),Xa(this,Es,hu).call(this)}).catch(e=>{Sr(this,Uo).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},kl=new WeakSet,fu=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},Ka(Ar,kl),Ka(Ar,pu,0),Ka(Ar,sl,!1),Ka(Ar,al,new WeakMap),isNodeJS&&(Vs(Ar,sl,!0),GlobalWorkerOptions.workerSrc||="./pdf.worker.mjs"),Ar._isSameOrigin=(e,t)=>{const n=URL.parse(e);if(!n?.origin||n.origin==="null")return!1;const r=new URL(t,n);return n.origin===r.origin},Ar._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},Ar.fromPort=e=>{if(deprecated("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return Ar.create(e)};let PDFWorker=Ar;class WorkerTransport{#e=new Map;#t=new Map;#i=new Map;#n=new Map;#r=null;constructor(e,t,n,r,s,a){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new FontLoader({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.wasmFactory=s.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=a,this.setupMessageHandler()}#a(e,t=null){const n=this.#e.get(e);if(n)return n;const r=this.messageHandler.sendWithPromise(e,t);return this.#e.set(e,r),r}get annotationStorage(){return shadow(this,"annotationStorage",new AnnotationStorage)}getRenderingIntent(e,t=AnnotationMode.ENABLE,n=null,r=!1,s=!1){let a=RenderingIntentFlag.DISPLAY,l=SerializableEmpty;switch(e){case"any":a=RenderingIntentFlag.ANY;break;case"display":break;case"print":a=RenderingIntentFlag.PRINT;break;default:warn(`getRenderingIntent - invalid intent: ${e}`)}const u=a&RenderingIntentFlag.PRINT&&n instanceof PrintAnnotationStorage?n:this.annotationStorage;switch(t){case AnnotationMode.DISABLE:a+=RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case AnnotationMode.ENABLE:break;case AnnotationMode.ENABLE_FORMS:a+=RenderingIntentFlag.ANNOTATIONS_FORMS;break;case AnnotationMode.ENABLE_STORAGE:a+=RenderingIntentFlag.ANNOTATIONS_STORAGE,l=u.serializable;break;default:warn(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(a+=RenderingIntentFlag.IS_EDITING),s&&(a+=RenderingIntentFlag.OPLIST);const{ids:d,hash:h}=u.modifiedIds,p=[a,l.hash,h];return{renderingIntent:a,cacheKey:p.join("_"),annotationStorageSerializable:l,modifiedIds:d}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const n of this.#t.values())e.push(n._destroy());this.#t.clear(),this.#i.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),TextLayer.cleanup(),this._networkStream?.cancelAllRequests(new AbortException("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,r)=>{assert(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},r.onPull=()=>{this._fullReader.read().then(function({value:s,done:a}){if(a){r.close();return}assert(s instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{r.error(s)})},r.onCancel=s=>{this._fullReader.cancel(s),r.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async n=>{await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:s,contentLength:a}=this._fullReader;return(!r||!s)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=l=>{t.onProgress?.({loaded:l.loaded,total:l.total})}),{isStreamingSupported:r,isRangeSupported:s,contentLength:a}}),e.on("GetRangeReader",(n,r)=>{assert(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(n.begin,n.end);if(!s){r.close();return}r.onPull=()=>{s.read().then(function({value:a,done:l}){if(l){r.close();return}assert(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{r.error(a)})},r.onCancel=a=>{s.cancel(a),r.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new PDFDocumentProxy(n,this))}),e.on("DocException",n=>{t._capability.reject(wrapReason(n))}),e.on("PasswordRequest",n=>{this.#r=Promise.withResolvers();try{if(!t.onPassword)throw wrapReason(n);const r=s=>{s instanceof Error?this.#r.reject(s):this.#r.resolve({password:s})};t.onPassword(r,n.code)}catch(r){this.#r.reject(r)}return this.#r.promise}),e.on("DataLoaded",n=>{t.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;this.#t.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,r,s])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(r){case"Font":if("error"in s){const h=s.error;warn(`Error during font loading: ${h}`),this.commonObjs.resolve(n,h);break}const a=new FontInfo(s),l=this._params.pdfBug&&globalThis.FontInspector?.enabled?(h,p)=>globalThis.FontInspector.fontAdded(h,p):null,u=new FontFaceObject(a,l,s.extra,s.charProcOperatorList);this.fontLoader.bind(u).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!u.fontExtraProperties&&u.data&&u.clearData(),this.commonObjs.resolve(n,u)});break;case"CopyLocalImage":const{imageRef:d}=s;assert(d,"The imageRef must be defined.");for(const h of this.#t.values())for(const[,p]of h.objs)if(p?.ref===d)return p.dataLen?(this.commonObjs.resolve(n,structuredClone(p)),p.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,s);break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([n,r,s,a])=>{if(this.destroyed)return;const l=this.#t.get(r);if(!l.objs.has(n)){if(l._intentStates.size===0){a?.bitmap?.close();return}switch(s){case"Image":case"Pattern":l.objs.resolve(n,a);break;default:throw new Error(`Got unknown object type ${s}`)}}}),e.on("DocProgress",n=>{this.destroyed||t.onProgress?.({loaded:n.loaded,total:n.total})}),e.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const r=this[n.type];if(!r)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return r.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&warn("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=this.#i.get(t);if(n)return n;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");s.refStr&&this.#n.set(s.refStr,e);const a=new PDFPageProxy(t,s,this,this._params.pdfBug);return this.#t.set(t,a),a});return this.#i.set(t,r),r}getPageIndex(e){return isRefProxy(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#a("GetFieldObjects")}hasJSActions(){return this.#a("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return this.#a("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#a("GetOptionalContentConfig").then(t=>new OptionalContentConfig(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#e.get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(r=>({info:r[0],metadata:r[1]?new Metadata(r[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0),TextLayer.cleanup()}}cachedPageNumber(e){if(!isRefProxy(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#n.get(t)??null}}class RenderTask{#e=null;onContinue=null;onError=null;constructor(e){this.#e=e}get promise(){return this.#e.capability.promise}cancel(e=0){this.#e.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}class InternalRenderTask{#e=null;static#t=new WeakSet;constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:s,operatorList:a,pageIndex:l,canvasFactory:u,filterFactory:d,useRequestAnimationFrame:h=!1,pdfBug:p=!1,pageColors:m=null,enableHWA:g=!1,operationsFilter:v=null}){this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=l,this.canvasFactory=u,this.filterFactory=d,this._pdfBug=p,this.pageColors=m,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=g,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=v}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:r,background:s,dependencyTracker:a}=this.params,l=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new CanvasGraphics(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,a),this.gfx.beginDrawing({transform:r,viewport:n,transparency:e,background:s}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),InternalRenderTask.#t.delete(this._canvas),e||=new RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,t),this.callback(e),this.task.onError?.(e)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),InternalRenderTask.#t.delete(this._canvas),this.callback())))}}const version="5.4.296",build="f56dc8601";class ColorPicker{#e=null;#t=null;#i;#n=null;#r=!1;#a=!1;#o=null;#s;#l=null;#c=null;static#h=null;static get _keyboardManager(){return shadow(this,"_keyboardManager",new KeyboardManager([[["Escape","mac+Escape"],ColorPicker.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ColorPicker.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ColorPicker.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ColorPicker.prototype._moveToPrevious],[["Home","mac+Home"],ColorPicker.prototype._moveToBeginning],[["End","mac+End"],ColorPicker.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#a=!1,this.#o=e):this.#a=!0,this.#c=e?._uiManager||t,this.#s=this.#c._eventBus,this.#i=e?.color?.toUpperCase()||this.#c?.highlightColors.values().next().value||"#FFFF98",ColorPicker.#h||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#e=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",this.#o&&(e.ariaControls=`${this.#o.id}_colorpicker_dropdown`);const t=this.#c._signal;e.addEventListener("click",this.#p.bind(this),{signal:t}),e.addEventListener("keydown",this.#g.bind(this),{signal:t});const n=this.#t=document.createElement("span");return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=this.#i,e.append(n),e}renderMainDropdown(){const e=this.#n=this.#d();return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}#d(){const e=document.createElement("div"),t=this.#c._signal;e.addEventListener("contextmenu",noContextMenu,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#o&&(e.id=`${this.#o.id}_colorpicker_dropdown`);for(const[n,r]of this.#c.highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",r),s.title=n,s.setAttribute("data-l10n-id",ColorPicker.#h[n]);const a=document.createElement("span");s.append(a),a.className="swatch",a.style.backgroundColor=r,s.ariaSelected=r===this.#i,s.addEventListener("click",this.#f.bind(this,r),{signal:t}),e.append(s)}return e.addEventListener("keydown",this.#g.bind(this),{signal:t}),e}#f(e,t){t.stopPropagation(),this.#s.dispatch("switchannotationeditorparams",{source:this,type:AnnotationEditorParamsType.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)}_colorSelectFromKeyboard(e){if(e.target===this.#e){this.#p(e);return}const t=e.target.getAttribute("data-color");t&&this.#f(t,e)}_moveToNext(e){if(!this.#m){this.#p(e);return}if(e.target===this.#e){this.#n.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#n?.firstChild||e.target===this.#e){this.#m&&this._hideDropdownFromKeyboard();return}this.#m||this.#p(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#m){this.#p(e);return}this.#n.firstChild?.focus()}_moveToEnd(e){if(!this.#m){this.#p(e);return}this.#n.lastChild?.focus()}#g(e){ColorPicker._keyboardManager.exec(this,e)}#p(e){if(this.#m){this.hideDropdown();return}if(this.#r=e.detail===0,this.#l||(this.#l=new AbortController,window.addEventListener("pointerdown",this.#u.bind(this),{signal:this.#c.combinedSignal(this.#l)})),this.#e.ariaExpanded="true",this.#n){this.#n.classList.remove("hidden");return}const t=this.#n=this.#d();this.#e.append(t)}#u(e){this.#n?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#n?.classList.add("hidden"),this.#e.ariaExpanded="false",this.#l?.abort(),this.#l=null}get#m(){return this.#n&&!this.#n.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#a){if(!this.#m){this.#o?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(e){if(this.#t&&(this.#t.style.backgroundColor=e),!this.#n)return;const t=this.#c.highlightColors.values();for(const n of this.#n.children)n.ariaSelected=t.next().value===e.toUpperCase()}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#n?.remove(),this.#n=null}}class BasicColorPicker{#e=null;#t=null;#i=null;static#n=null;constructor(e){this.#t=e,this.#i=e._uiManager,BasicColorPicker.#n||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#e)return this.#e;const{editorType:e,colorType:t,colorValue:n}=this.#t,r=this.#e=document.createElement("input");return r.type="color",r.value=n||"#000000",r.className="basicColorPicker",r.tabIndex=0,r.setAttribute("data-l10n-id",BasicColorPicker.#n[e]),r.addEventListener("input",()=>{this.#i.updateParams(t,r.value)},{signal:this.#i._signal}),r}update(e){this.#e&&(this.#e.value=e)}destroy(){this.#e?.remove(),this.#e=null}hideDropdown(){}}function makeColorComp(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function scaleAndClamp(i){return Math.max(0,Math.min(255,255*i))}class ColorConverters{static CMYK_G([e,t,n,r]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=scaleAndClamp(e),[e,e,e]}static G_HTML([e]){const t=makeColorComp(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(scaleAndClamp)}static RGB_HTML(e){return`#${e.map(makeColorComp).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,n,r]){return[scaleAndClamp(1-Math.min(1,e+r)),scaleAndClamp(1-Math.min(1,n+r)),scaleAndClamp(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const r=1-e,s=1-t,a=1-n,l=Math.min(r,s,a);return["CMYK",r,s,a,l]}}class BaseSVGFactory{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),n||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){unreachable("Abstract method `_createSVG` called.")}}class DOMSVGFactory extends BaseSVGFactory{_createSVG(e){return document.createElementNS(SVG_NS,e)}}const annotation_layer_DEFAULT_FONT_SIZE=9,GetElementsByNameSet=new WeakSet,TIMEZONE_OFFSET=new Date().getTimezoneOffset()*60*1e3;class AnnotationElementFactory{static create(e){switch(e.data.annotationType){case AnnotationType.LINK:return new LinkAnnotationElement(e);case AnnotationType.TEXT:return new TextAnnotationElement(e);case AnnotationType.WIDGET:switch(e.data.fieldType){case"Tx":return new TextWidgetAnnotationElement(e);case"Btn":return e.data.radioButton?new RadioButtonWidgetAnnotationElement(e):e.data.checkBox?new CheckboxWidgetAnnotationElement(e):new PushButtonWidgetAnnotationElement(e);case"Ch":return new ChoiceWidgetAnnotationElement(e);case"Sig":return new SignatureWidgetAnnotationElement(e)}return new WidgetAnnotationElement(e);case AnnotationType.POPUP:return new PopupAnnotationElement(e);case AnnotationType.FREETEXT:return new FreeTextAnnotationElement(e);case AnnotationType.LINE:return new LineAnnotationElement(e);case AnnotationType.SQUARE:return new SquareAnnotationElement(e);case AnnotationType.CIRCLE:return new CircleAnnotationElement(e);case AnnotationType.POLYLINE:return new PolylineAnnotationElement(e);case AnnotationType.CARET:return new CaretAnnotationElement(e);case AnnotationType.INK:return new InkAnnotationElement(e);case AnnotationType.POLYGON:return new PolygonAnnotationElement(e);case AnnotationType.HIGHLIGHT:return new HighlightAnnotationElement(e);case AnnotationType.UNDERLINE:return new UnderlineAnnotationElement(e);case AnnotationType.SQUIGGLY:return new SquigglyAnnotationElement(e);case AnnotationType.STRIKEOUT:return new StrikeOutAnnotationElement(e);case AnnotationType.STAMP:return new StampAnnotationElement(e);case AnnotationType.FILEATTACHMENT:return new FileAttachmentAnnotationElement(e);default:return new AnnotationElement(e)}}}class AnnotationElement{#e=null;#t=!1;#i=null;constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),r&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e?.str||t?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return AnnotationElement._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:e}=this,t=this.annotationStorage?.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const e=this.annotationStorage?.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:n,rect:r}=this.data;let s=-1/0,a=-1/0;if(t?.length>=8){for(let l=0;l<t.length;l+=8)t[l+1]>a?(a=t[l+1],s=t[l+2]):t[l+1]===a&&(s=Math.max(s,t[l+2]));return[s,a]}if(n?.length>=1){for(const l of n)for(let u=0,d=l.length;u<d;u+=2)l[u+1]>a?(a=l[u+1],s=l[u]):l[u+1]===a&&(s=Math.max(s,l[u]));if(s!==1/0)return[s,a]}return r?[r[2],r[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:s,pageY:a}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-s)/n,e[1]=100*(e[1]-a)/r,e}get commentText(){const{data:e}=this;return this.annotationStorage.getRawValue(`${AnnotationEditorPrefix}${e.id}`)?.popup?.contents||e.contentsObj?.str||""}set commentText(e){const{data:t}=this,n={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:n})||this.annotationStorage.setValue(`${AnnotationEditorPrefix}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:n,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){(this.#i?.popup||this.popup)?.remove(),this.#i=this.popup=null}updateEdited(e){if(!this.container)return;e.rect&&(this.#e||={rect:this.data.rect.slice(0)});const{rect:t,popup:n}=e;t&&this.#n(t);let r=this.#i?.popup||this.popup;!r&&n?.text&&(this._createPopup(n),r=this.#i.popup),r&&(r.updateEdited(e),n?.deleted&&(r.remove(),this.#i=null,this.popup=null))}resetEdited(){this.#e&&(this.#n(this.#e.rect),this.#i?.popup.resetEdited(),this.#e=null)}#n(e){const{container:{style:t},data:{rect:n,rotation:r},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:a,pageX:l,pageY:u}}}}=this;n?.splice(0,4,...e),t.left=`${100*(e[0]-l)/s}%`,t.top=`${100*(a-e[3]+u)/a}%`,r===0?(t.width=`${100*(e[2]-e[0])/s}%`,t.height=`${100*(e[3]-e[1])/a}%`):this.setRotation(r)}_createContainer(e){const{data:t,parent:{page:n,viewport:r}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",t.id),!(this instanceof WidgetAnnotationElement)&&!(this instanceof LinkAnnotationElement)&&(s.tabIndex=0);const{style:a}=s;if(a.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(s.title=t.alternativeText),t.noRotate&&s.classList.add("norotate"),!t.rect||this instanceof PopupAnnotationElement){const{rotation:_}=t;return!t.hasOwnCanvas&&_!==0&&this.setRotation(_,s),s}const{width:l,height:u}=this;if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const _=t.borderStyle.horizontalCornerRadius,b=t.borderStyle.verticalCornerRadius;if(_>0||b>0){const A=`calc(${_}px * var(--total-scale-factor)) / calc(${b}px * var(--total-scale-factor))`;a.borderRadius=A}else if(this instanceof RadioButtonWidgetAnnotationElement){const A=`calc(${l}px * var(--total-scale-factor)) / calc(${u}px * var(--total-scale-factor))`;a.borderRadius=A}switch(t.borderStyle.style){case AnnotationBorderStyleType.SOLID:a.borderStyle="solid";break;case AnnotationBorderStyleType.DASHED:a.borderStyle="dashed";break;case AnnotationBorderStyleType.BEVELED:warn("Unimplemented border style: beveled");break;case AnnotationBorderStyleType.INSET:warn("Unimplemented border style: inset");break;case AnnotationBorderStyleType.UNDERLINE:a.borderBottomStyle="solid";break}const E=t.borderColor||null;E?(this.#t=!0,a.borderColor=Util.makeHexColor(E[0]|0,E[1]|0,E[2]|0)):a.borderWidth=0}const d=Util.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:h,pageHeight:p,pageX:m,pageY:g}=r.rawDims;a.left=`${100*(d[0]-m)/h}%`,a.top=`${100*(d[1]-g)/p}%`;const{rotation:v}=t;return t.hasOwnCanvas||v===0?(a.width=`${100*l/h}%`,a.height=`${100*u/p}%`):this.setRotation(v,s),s}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:r}=this.parent.viewport.rawDims;let{width:s,height:a}=this;e%180!==0&&([s,a]=[a,s]),t.style.width=`${100*s/n}%`,t.style.height=`${100*a/r}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,n,r)=>{const s=r.detail[t],a=s[0],l=s.slice(1);r.target.style[n]=ColorConverters[`${a}_HTML`](l),this.annotationStorage.setValue(this.data.id,{[n]:ColorConverters[`${a}_rgb`](l)})};return shadow(this,"_commonActions",{display:t=>{const{display:n}=t.detail,r=n%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const r of Object.keys(t.detail))(e[r]||n[r])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[r,s]of Object.entries(t)){const a=n[r];if(a){const l={detail:{[r]:s},target:e};a(l),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,r,s]=this.data.rect.map(_=>Math.fround(_));if(e.length===8){const[_,b,E,A]=e.subarray(2,6);if(r===_&&s===b&&t===E&&n===A)return}const{style:a}=this.container;let l;if(this.#t){const{borderColor:_,borderWidth:b}=a;a.borderWidth=0,l=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${_}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}const u=r-t,d=s-n,{svgFactory:h}=this,p=h.createElement("svg");p.classList.add("quadrilateralsContainer"),p.setAttribute("width",0),p.setAttribute("height",0),p.role="none";const m=h.createElement("defs");p.append(m);const g=h.createElement("clipPath"),v=`clippath_${this.data.id}`;g.setAttribute("id",v),g.setAttribute("clipPathUnits","objectBoundingBox"),m.append(g);for(let _=2,b=e.length;_<b;_+=8){const E=e[_],A=e[_+1],z=e[_+2],D=e[_+3],P=h.createElement("rect"),G=(z-t)/u,R=(s-A)/d,I=(E-z)/u,w=(A-D)/d;P.setAttribute("x",G),P.setAttribute("y",R),P.setAttribute("width",I),P.setAttribute("height",w),g.append(P),l?.push(`<rect vector-effect="non-scaling-stroke" x="${G}" y="${R}" width="${I}" height="${w}"/>`)}this.#t&&(l.push("</g></svg>')"),a.backgroundImage=l.join("")),this.container.append(p),this.container.style.clipPath=`url(#${v})`}_createPopup(e=null){const{data:t}=this;let n,r;e?(n={str:e.text},r=e.date):(n=t.contentsObj,r=t.modificationDate);const s=this.#i=new PopupAnnotationElement({data:{color:t.color,titleObj:t.titleObj,modificationDate:r,contentsObj:n,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent._commentManager||this.parent.div.append(s.render())}get hasPopupElement(){return!!(this.#i||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#i}render(){unreachable("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:s,id:a,exportValues:l}of r){if(s===-1||a===t)continue;const u=typeof l=="string"?l:null,d=document.querySelector(`[data-element-id="${a}"]`);if(d&&!GetElementsByNameSet.has(d)){warn(`_getElementsByName - element not allowed: ${a}`);continue}n.push({id:a,exportValue:u,domElement:d})}return n}for(const r of document.getElementsByName(e)){const{exportValue:s}=r,a=r.getAttribute("data-element-id");a!==t&&GetElementsByNameSet.has(r)&&n.push({id:a,exportValue:s,domElement:r})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class EditorAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&(this._createPopup(e.comment),this.extraPopupElement.popup.renderCommentButton())}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.container.remove(),this.container=null,this.removePopup()}}class LinkAnnotationElement extends AnnotationElement{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,n=document.createElement("a");n.setAttribute("data-element-id",e.id);let r=!1;return e.url?(t.addLinkAttributes(n,e.url,e.newWindow),r=!0):e.action?(this._bindNamedAction(n,e.action,e.overlaidText),r=!0):e.attachment?(this.#t(n,e.attachment,e.overlaidText,e.attachmentDest),r=!0):e.setOCGState?(this.#i(n,e.setOCGState,e.overlaidText),r=!0):e.dest?(this._bindLink(n,e.dest,e.overlaidText),r=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),r=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(n,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(n),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t,n=""){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#e(),n&&(e.title=n)}_bindNamedAction(e,t,n=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),n&&(e.title=n),this.#e()}#t(e,t,n="",r=null){e.href=this.linkService.getAnchorUrl(""),t.description?e.title=t.description:n&&(e.title=n),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,r),!1),this.#e()}#i(e,t,n=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),n&&(e.title=n),this.#e()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(t.actions)){const s=n.get(r);s&&(e[s]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:r}}),!1))}t.overlaidText&&(e.title=t.overlaidText),e.onclick||(e.onclick=()=>!1),this.#e()}_bindResetFormAction(e,t){const n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){warn('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(e.onclick=()=>!1);return}e.onclick=()=>{n?.();const{fields:r,refs:s,include:a}=t,l=[];if(r.length!==0||s.length!==0){const h=new Set(s);for(const p of r){const m=this._fieldObjects[p]||[];for(const{id:g}of m)h.add(g)}for(const p of Object.values(this._fieldObjects))for(const m of p)h.has(m.id)===a&&l.push(m)}else for(const h of Object.values(this._fieldObjects))l.push(...h);const u=this.annotationStorage,d=[];for(const h of l){const{id:p}=h;switch(d.push(p),h.type){case"text":{const g=h.defaultValue||"";u.setValue(p,{value:g});break}case"checkbox":case"radiobutton":{const g=h.defaultValue===h.exportValues;u.setValue(p,{value:g});break}case"combobox":case"listbox":{const g=h.defaultValue||"";u.setValue(p,{value:g});break}default:continue}const m=document.querySelector(`[data-element-id="${p}"]`);if(m){if(!GetElementsByNameSet.has(m)){warn(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;m.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}}),!1}}}class TextAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class WidgetAnnotationElement extends AnnotationElement{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return util_FeatureTest.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,r,s){n.includes("mouse")?e.addEventListener(n,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:s(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(n,a=>{if(n==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:s(a)}})})}_setEventListeners(e,t,n,r){for(const[s,a]of n)(a==="Action"||this.data.actions?.[a])&&((a==="Focus"||a==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,s,a,r),a==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):a==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Util.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||annotation_layer_DEFAULT_FONT_SIZE,s=e.style;let a;const l=2,u=d=>Math.round(10*d)/10;if(this.data.multiLine){const d=Math.abs(this.data.rect[3]-this.data.rect[1]-l),h=Math.round(d/(LINE_FACTOR*r))||1,p=d/h;a=Math.min(r,u(p/LINE_FACTOR))}else{const d=Math.abs(this.data.rect[3]-this.data.rect[1]-l);a=Math.min(r,u(d/LINE_FACTOR))}s.fontSize=`calc(${a}px * var(--total-scale-factor))`,s.color=Util.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(s.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class TextWidgetAnnotationElement extends WidgetAnnotationElement{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,r){const s=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=n),s.setValue(a.id,{[r]:n})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const r=e.getValue(t,{value:this.data.fieldValue});let s=r.value||"";const a=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;a&&s.length>a&&(s=s.slice(0,a));let l=r.formattedValue||this.data.textContent?.join(`
`)||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));const u={userValue:s,formattedValue:l,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=l??s,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",l??s),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),GetElementsByNameSet.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:d,datetimeType:h,timeStep:p}=this.data,m=!!h&&this.enableScripting;d&&(n.title=d),this._setRequired(n,this.data.required),a&&(n.maxLength=a),n.addEventListener("input",v=>{e.setValue(t,{value:v.target.value}),this.setPropertyOnSiblings(n,"value",v.target.value,"value"),u.formattedValue=null}),n.addEventListener("resetform",v=>{const _=this.data.defaultFieldValue??"";n.value=u.userValue=_,u.formattedValue=null});let g=v=>{const{formattedValue:_}=u;_!=null&&(v.target.value=_),v.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",_=>{if(u.focused)return;const{target:b}=_;if(m&&(b.type=h,p&&(b.step=p)),u.userValue){const E=u.userValue;if(m)if(h==="time"){const A=new Date(E),z=[A.getHours(),A.getMinutes(),A.getSeconds()];b.value=z.map(D=>D.toString().padStart(2,"0")).join(":")}else b.value=new Date(E-TIMEZONE_OFFSET).toISOString().split(h==="date"?"T":".",1)[0];else b.value=E}u.lastCommittedValue=b.value,u.commitKey=1,this.data.actions?.Focus||(u.focused=!0)}),n.addEventListener("updatefromsandbox",_=>{this.showElementAndHideCanvas(_.target);const b={value(E){u.userValue=E.detail.value??"",m||e.setValue(t,{value:u.userValue.toString()}),E.target.value=u.userValue},formattedValue(E){const{formattedValue:A}=E.detail;u.formattedValue=A,A!=null&&E.target!==document.activeElement&&(E.target.value=A);const z={formattedValue:A};m&&(z.value=A),e.setValue(t,z)},selRange(E){E.target.setSelectionRange(...E.detail.selRange)},charLimit:E=>{const{charLimit:A}=E.detail,{target:z}=E;if(A===0){z.removeAttribute("maxLength");return}z.setAttribute("maxLength",A);let D=u.userValue;!D||D.length<=A||(D=D.slice(0,A),z.value=u.userValue=D,e.setValue(t,{value:D}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:D,willCommit:!0,commitKey:1,selStart:z.selectionStart,selEnd:z.selectionEnd}}))}};this._dispatchEventFromSandbox(b,_)}),n.addEventListener("keydown",_=>{u.commitKey=1;let b=-1;if(_.key==="Escape"?b=0:_.key==="Enter"&&!this.data.multiLine?b=2:_.key==="Tab"&&(u.commitKey=3),b===-1)return;const{value:E}=_.target;u.lastCommittedValue!==E&&(u.lastCommittedValue=E,u.userValue=E,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,willCommit:!0,commitKey:b,selStart:_.target.selectionStart,selEnd:_.target.selectionEnd}}))});const v=g;g=null,n.addEventListener("blur",_=>{if(!u.focused||!_.relatedTarget)return;this.data.actions?.Blur||(u.focused=!1);const{target:b}=_;let{value:E}=b;if(m){if(E&&h==="time"){const A=E.split(":").map(z=>parseInt(z,10));E=new Date(2e3,0,1,A[0],A[1],A[2]||0).valueOf(),b.step=""}else E.includes("T")||(E=`${E}T00:00`),E=new Date(E).valueOf();b.type="text"}u.userValue=E,u.lastCommittedValue!==E&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,willCommit:!0,commitKey:u.commitKey,selStart:_.target.selectionStart,selEnd:_.target.selectionEnd}}),v(_)}),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",_=>{u.lastCommittedValue=null;const{data:b,target:E}=_,{value:A,selectionStart:z,selectionEnd:D}=E;let P=z,G=D;switch(_.inputType){case"deleteWordBackward":{const R=A.substring(0,z).match(/\w*[^\w]*$/);R&&(P-=R[0].length);break}case"deleteWordForward":{const R=A.substring(z).match(/^[^\w]*\w*/);R&&(G+=R[0].length);break}case"deleteContentBackward":z===D&&(P-=1);break;case"deleteContentForward":z===D&&(G+=1);break}_.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:A,change:b||"",willCommit:!1,selStart:P,selEnd:G}})}),this._setEventListeners(n,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],_=>_.target.value)}if(g&&n.addEventListener("blur",g),this.data.comb){const _=(this.data.rect[2]-this.data.rect[0])/a;n.classList.add("comb"),n.style.letterSpacing=`calc(${_}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class SignatureWidgetAnnotationElement extends WidgetAnnotationElement{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class CheckboxWidgetAnnotationElement extends WidgetAnnotationElement{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(n,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return GetElementsByNameSet.add(s),s.setAttribute("data-element-id",n),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=t.fieldName,r&&s.setAttribute("checked",!0),s.setAttribute("exportValue",t.exportValue),s.tabIndex=0,s.addEventListener("change",a=>{const{name:l,checked:u}=a.target;for(const d of this._getElementsByName(l,n)){const h=u&&d.exportValue===t.exportValue;d.domElement&&(d.domElement.checked=h),e.setValue(d.id,{value:h})}e.setValue(n,{value:u})}),s.addEventListener("resetform",a=>{const l=t.defaultFieldValue||"Off";a.target.checked=l===t.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",a=>{const l={value(u){u.target.checked=u.detail.value!=="Off",e.setValue(n,{value:u.target.checked})}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class RadioButtonWidgetAnnotationElement extends WidgetAnnotationElement{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(n,{value:r})),r)for(const a of this._getElementsByName(t.fieldName,n))e.setValue(a.id,{value:!1});const s=document.createElement("input");if(GetElementsByNameSet.add(s),s.setAttribute("data-element-id",n),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=t.fieldName,r&&s.setAttribute("checked",!0),s.tabIndex=0,s.addEventListener("change",a=>{const{name:l,checked:u}=a.target;for(const d of this._getElementsByName(l,n))e.setValue(d.id,{value:!1});e.setValue(n,{value:u})}),s.addEventListener("resetform",a=>{const l=t.defaultFieldValue;a.target.checked=l!=null&&l===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;s.addEventListener("updatefromsandbox",l=>{const u={value:d=>{const h=a===d.detail.value;for(const p of this._getElementsByName(d.target.name)){const m=h&&p.id===n;p.domElement&&(p.domElement.checked=m),e.setValue(p.id,{value:m})}}};this._dispatchEventFromSandbox(u,l)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class PushButtonWidgetAnnotationElement extends LinkAnnotationElement{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}}class ChoiceWidgetAnnotationElement extends WidgetAnnotationElement{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");GetElementsByNameSet.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=0;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",h=>{const p=this.data.defaultFieldValue;for(const m of r.options)m.selected=m.value===p});for(const h of this.data.options){const p=document.createElement("option");p.textContent=h.displayValue,p.value=h.exportValue,n.value.includes(h.exportValue)&&(p.setAttribute("selected",!0),s=!1),r.append(p)}let a=null;if(s){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),r.prepend(h),a=()=>{h.remove(),r.removeEventListener("input",a),a=null},r.addEventListener("input",a)}const l=h=>{const p=h?"value":"textContent",{options:m,multiple:g}=r;return g?Array.prototype.filter.call(m,v=>v.selected).map(v=>v[p]):m.selectedIndex===-1?null:m[m.selectedIndex][p]};let u=l(!1);const d=h=>{const p=h.target.options;return Array.prototype.map.call(p,m=>({displayValue:m.textContent,exportValue:m.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",h=>{const p={value(m){a?.();const g=m.detail.value,v=new Set(Array.isArray(g)?g:[g]);for(const _ of r.options)_.selected=v.has(_.value);e.setValue(t,{value:l(!0)}),u=l(!1)},multipleSelection(m){r.multiple=!0},remove(m){const g=r.options,v=m.detail.remove;g[v].selected=!1,r.remove(v),g.length>0&&Array.prototype.findIndex.call(g,b=>b.selected)===-1&&(g[0].selected=!0),e.setValue(t,{value:l(!0),items:d(m)}),u=l(!1)},clear(m){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),u=l(!1)},insert(m){const{index:g,displayValue:v,exportValue:_}=m.detail.insert,b=r.children[g],E=document.createElement("option");E.textContent=v,E.value=_,b?b.before(E):r.append(E),e.setValue(t,{value:l(!0),items:d(m)}),u=l(!1)},items(m){const{items:g}=m.detail;for(;r.length!==0;)r.remove(0);for(const v of g){const{displayValue:_,exportValue:b}=v,E=document.createElement("option");E.textContent=_,E.value=b,r.append(E)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:l(!0),items:d(m)}),u=l(!1)},indices(m){const g=new Set(m.detail.indices);for(const v of m.target.options)v.selected=g.has(v.index);e.setValue(t,{value:l(!0)}),u=l(!1)},editable(m){m.target.disabled=!m.detail.editable}};this._dispatchEventFromSandbox(p,h)}),r.addEventListener("input",h=>{const p=l(!0),m=l(!1);e.setValue(t,{value:p}),h.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:u,change:m,changeEx:p,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):r.addEventListener("input",function(h){e.setValue(t,{value:l(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class PopupAnnotationElement extends AnnotationElement{constructor(e){const{data:t,elements:n,parent:r}=e,s=!!r._commentManager;if(super(e,{isRenderable:!s&&AnnotationElement._hasPopupData(t)}),this.elements=n,s&&AnnotationElement._hasPopupData(t)){const a=this.popup=this.#e();for(const l of n)l.popup=a}else this.popup=null}#e(){return new PopupElement({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=this.#e(),n=[];for(const r of this.elements)r.popup=t,r.container.ariaHasPopup="dialog",n.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",n.map(r=>`${AnnotationPrefix}${r}`).join(",")),this.container}}class PopupElement{#e=null;#t=this.#B.bind(this);#i=this.#j.bind(this);#n=this.#F.bind(this);#r=this.#T.bind(this);#a=null;#o=null;#s=null;#l=null;#c=null;#h=null;#d=null;#f=!1;#g=null;#p=null;#u=null;#m=null;#y=null;#b=null;#v=null;#w=null;#x=null;#_=null;#P=!1;#E=null;#A=null;constructor({container:e,color:t,elements:n,titleObj:r,modificationDate:s,contentsObj:a,richText:l,parent:u,rect:d,parentRect:h,open:p,commentManager:m=null}){this.#o=e,this.#x=r,this.#s=a,this.#w=l,this.#h=u,this.#a=t,this.#v=d,this.#d=h,this.#c=n,this.#e=m,this.#E=n[0],this.#l=PDFDateString.toDateObject(s),this.trigger=n.flatMap(g=>g.getElementsToTriggerPopup()),m?this.renderCommentButton():(this.#I(),this.#o.hidden=!0,p&&this.#T())}#I(){if(this.#p)return;this.#p=new AbortController;const{signal:e}=this.#p;for(const t of this.trigger)t.addEventListener("click",this.#r,{signal:e}),t.addEventListener("pointerenter",this.#n,{signal:e}),t.addEventListener("pointerleave",this.#i,{signal:e}),t.classList.add("popupTriggerArea");for(const t of this.#c)t.container?.addEventListener("keydown",this.#t,{signal:e})}#S(){const e=this.#c.find(t=>t.hasCommentButton);e&&(this.#y=e._normalizePoint(e.commentButtonPosition))}renderCommentButton(){if(this.#m||(this.#y||this.#S(),!this.#y))return;const{signal:e}=this.#p=new AbortController,t=!!this.#E.extraPopupElement,n=()=>{this.#e.toggleCommentPopup(this,!0,void 0,!t)},r=()=>{this.#e.toggleCommentPopup(this,!1,!0,!t)},s=()=>{this.#e.toggleCommentPopup(this,!1,!1)};if(t){this.#m=this.#E.container;for(const a of this.trigger)a.ariaHasPopup="dialog",a.ariaControls="commentPopup",a.addEventListener("keydown",this.#t,{signal:e}),a.addEventListener("click",n,{signal:e}),a.addEventListener("pointerenter",r,{signal:e}),a.addEventListener("pointerleave",s,{signal:e}),a.classList.add("popupTriggerArea")}else{const a=this.#m=document.createElement("button");a.className="annotationCommentButton";const l=this.#E.container;a.style.zIndex=l.style.zIndex+1,a.tabIndex=0,a.ariaHasPopup="dialog",a.ariaControls="commentPopup",a.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#L(),this.#R(),a.addEventListener("keydown",this.#t,{signal:e}),a.addEventListener("click",n,{signal:e}),a.addEventListener("pointerenter",r,{signal:e}),a.addEventListener("pointerleave",s,{signal:e}),l.after(a)}}#R(){if(this.#E.extraPopupElement&&!this.#E.editor)return;this.renderCommentButton();const[e,t]=this.#y,{style:n}=this.#m;n.left=`calc(${e}%)`,n.top=`calc(${t}% - var(--comment-button-dim))`}#L(){this.#E.extraPopupElement||(this.renderCommentButton(),this.#m.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:e,opacity:t}=this.#E.commentData;return e?this.#h._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{this.#m?.focus()},0)}getData(){const{richText:e,color:t,opacity:n,creationDate:r,modificationDate:s}=this.#E.commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:n,creationDate:r,modificationDate:s}}get elementBeforePopup(){return this.#m}get comment(){return this.#A||=this.#E.commentText,this.#A}set comment(e){e!==this.comment&&(this.#E.commentText=this.#A=e)}get parentBoundingClientRect(){return this.#E.layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){this.#m&&(this.#m.classList.toggle("selected",e),this.#m.ariaExpanded=t)}setSelectedCommentButton(e){this.#m.classList.toggle("selected",e)}get commentPopupPosition(){if(this.#b)return this.#b;const{x:e,y:t,height:n}=this.#m.getBoundingClientRect(),{x:r,y:s,width:a,height:l}=this.#E.layer.getBoundingClientRect();return[(e-r)/a,(t+n-s)/l]}set commentPopupPosition(e){this.#b=e}hasDefaultPopupPosition(){return this.#b===null}get commentButtonPosition(){return this.#y}get commentButtonWidth(){return this.#m.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,n]=this.#b||this.commentButtonPosition.map(d=>d/100),r=this.parentBoundingClientRect,{x:s,y:a,width:l,height:u}=r;this.#e.showDialog(null,this,s+t*l,a+n*u,{...e,parentDimensions:r})}render(){if(this.#g)return;const e=this.#g=document.createElement("div");if(e.className="popup",this.#a){const n=e.style.outlineColor=Util.makeHexColor(...this.#a);e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const t=document.createElement("span");if(t.className="header",this.#x?.str){const n=document.createElement("span");n.className="title",t.append(n),{dir:n.dir,str:n.textContent}=this.#x}if(e.append(t),this.#l){const n=document.createElement("time");n.className="popupDate",n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#l.valueOf()})),n.dateTime=this.#l.toISOString(),t.append(n)}renderRichText({html:this.#M||this.#s.str,dir:this.#s?.dir,className:"popupContent"},e),this.#o.append(e)}get#M(){const e=this.#w,t=this.#s;return e?.str&&(!t?.str||t.str===e.str)&&this.#w.html||null}get#N(){return this.#M?.attributes?.style?.fontSize||0}get#D(){return this.#M?.attributes?.style?.color||null}#k(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:this.#D,fontSize:this.#N?`calc(${this.#N}px * var(--total-scale-factor))`:""}};for(const s of e.split(`
`))t.push({name:"span",value:s,attributes:r});return n}#B(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#f)&&this.#T()}updateEdited({rect:e,popup:t,deleted:n}){if(this.#e){n?(this.remove(),this.#A=null):t&&(t.deleted?this.remove():(this.#L(),this.#A=t.text)),e&&(this.#y=null,this.#S(),this.#R());return}if(n||t?.deleted){this.remove();return}this.#I(),this.#_||={contentsObj:this.#s,richText:this.#w},e&&(this.#u=null),t&&t.text&&(this.#w=this.#k(t.text),this.#l=PDFDateString.toDateObject(t.date),this.#s=null),this.#g?.remove(),this.#g=null}resetEdited(){this.#_&&({contentsObj:this.#s,richText:this.#w}=this.#_,this.#_=null,this.#g?.remove(),this.#g=null,this.#u=null)}remove(){if(this.#p?.abort(),this.#p=null,this.#g?.remove(),this.#g=null,this.#P=!1,this.#f=!1,this.#m?.remove(),this.#m=null,this.trigger)for(const e of this.trigger)e.classList.remove("popupTriggerArea")}#C(){if(this.#u!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:r,pageY:s}}}=this.#h;let a=!!this.#d,l=a?this.#d:this.#v;for(const v of this.#c)if(!l||Util.intersect(v.data.rect,l)!==null){l=v.data.rect,a=!0;break}const u=Util.normalizeRect([l[0],e[3]-l[1]+e[1],l[2],e[3]-l[3]+e[1]]),h=a?l[2]-l[0]+5:0,p=u[0]+h,m=u[1];this.#u=[100*(p-r)/t,100*(m-s)/n];const{style:g}=this.#o;g.left=`${this.#u[0]}%`,g.top=`${this.#u[1]}%`}#T(){if(this.#e){this.#e.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#F(),this.#o.addEventListener("click",this.#r),this.#o.addEventListener("keydown",this.#t)):(this.#j(),this.#o.removeEventListener("click",this.#r),this.#o.removeEventListener("keydown",this.#t))}#F(){this.#g||this.render(),this.isVisible?this.#f&&this.#o.classList.add("focused"):(this.#C(),this.#o.hidden=!1,this.#o.style.zIndex=parseInt(this.#o.style.zIndex)+1e3)}#j(){this.#o.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#o.hidden=!0,this.#o.style.zIndex=parseInt(this.#o.style.zIndex)-1e3)}forceHide(){this.#P=this.isVisible,this.#P&&(this.#o.hidden=!0)}maybeShow(){this.#e||(this.#I(),this.#P&&(this.#g||this.#F(),this.#P=!1,this.#o.hidden=!1))}get isVisible(){return this.#e?!1:this.#o.hidden===!1}}class FreeTextAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class LineAnnotationElement extends AnnotationElement{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:e,width:t,height:n}=this,r=this.svgFactory.create(t,n,!0),s=this.#e=this.svgFactory.createElement("svg:line");return s.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),s.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),s.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),s.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),s.setAttribute("stroke-width",e.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),r.append(s),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class SquareAnnotationElement extends AnnotationElement{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:e,width:t,height:n}=this,r=this.svgFactory.create(t,n,!0),s=e.borderStyle.width,a=this.#e=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",s/2),a.setAttribute("y",s/2),a.setAttribute("width",t-s),a.setAttribute("height",n-s),a.setAttribute("stroke-width",s||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class CircleAnnotationElement extends AnnotationElement{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:e,width:t,height:n}=this,r=this.svgFactory.create(t,n,!0),s=e.borderStyle.width,a=this.#e=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",t/2),a.setAttribute("cy",n/2),a.setAttribute("rx",t/2-s/2),a.setAttribute("ry",n/2-s/2),a.setAttribute("stroke-width",s||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class PolylineAnnotationElement extends AnnotationElement{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:n,popupRef:r},width:s,height:a}=this;if(!t)return this.container;const l=this.svgFactory.create(s,a,!0);let u=[];for(let h=0,p=t.length;h<p;h+=2){const m=t[h]-e[0],g=e[3]-t[h+1];u.push(`${m},${g}`)}u=u.join(" ");const d=this.#e=this.svgFactory.createElement(this.svgElementName);return d.setAttribute("points",u),d.setAttribute("stroke-width",n.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),l.append(d),this.container.append(l),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class PolygonAnnotationElement extends PolylineAnnotationElement{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class CaretAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class InkAnnotationElement extends AnnotationElement{#e=null;#t=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?AnnotationEditorType.HIGHLIGHT:AnnotationEditorType.INK}#i(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:n,borderStyle:r,popupRef:s}}=this,{transform:a,width:l,height:u}=this.#i(t,e),d=this.svgFactory.create(l,u,!0),h=this.#e=this.svgFactory.createElement("svg:g");d.append(h),h.setAttribute("stroke-width",r.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",a);for(let p=0,m=n.length;p<m;p++){const g=this.svgFactory.createElement(this.svgElementName);this.#t.push(g),g.setAttribute("points",n[p].join(",")),h.append(g)}return!s&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:n,rect:r}=e,s=this.#e;if(t>=0&&s.setAttribute("stroke-width",t||1),n)for(let a=0,l=this.#t.length;a<l;a++)this.#t[a].setAttribute("points",n[a].join(","));if(r){const{transform:a,width:l,height:u}=this.#i(this.data.rotation,r);s.parentElement.setAttribute("viewBox",`0 0 ${l} ${u}`),s.setAttribute("transform",a)}}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class HighlightAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=AnnotationEditorType.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class UnderlineAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class SquigglyAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class StrikeOutAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),e){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class StampAnnotationElement extends AnnotationElement{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=AnnotationEditorType.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class FileAttachmentAnnotationElement extends AnnotationElement{#e=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let n;t.hasAppearance||t.fillAlpha===0?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),n.addEventListener("dblclick",this.#t.bind(this)),this.#e=n;const{isMac:r}=util_FeatureTest.platform;return e.addEventListener("keydown",s=>{s.key==="Enter"&&(r?s.metaKey:s.ctrlKey)&&this.#t()}),!t.popupRef&&this.hasPopupData?this._createPopup():n.classList.add("popupTriggerArea"),e.append(n),e}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class AnnotationLayer{#e=null;#t=null;#i=null;#n=new Map;#r=null;#a=null;constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:r,page:s,viewport:a,structTreeLayer:l,commentManager:u,linkService:d,annotationStorage:h}){this.div=e,this.#e=t,this.#t=n,this.#r=l||null,this.#a=d||null,this.#i=h||new AnnotationStorage,this.page=s,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=r,this._commentManager=u||null}hasEditableAnnotations(){return this.#n.size>0}async#o(e,t,n){const r=e.firstChild||e,s=r.id=`${AnnotationPrefix}${t}`,a=await this.#r?.getAriaAttributes(s);if(a)for(const[l,u]of a)r.setAttribute(l,u);n?n.at(-1).container.after(e):(this.div.append(e),this.#e?.moveElementInDOM(this.div,e,r,!1))}async render(e){const{annotations:t}=e,n=this.div;setLayerDimensions(n,this.viewport);const r=new Map,s={data:null,layer:n,linkService:this.#a,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new DOMSVGFactory,annotationStorage:this.#i,enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const a of t){if(a.noHTML)continue;const l=a.annotationType===AnnotationType.POPUP;if(l){const h=r.get(a.id);if(!h)continue;s.elements=h}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;s.data=a;const u=AnnotationElementFactory.create(s);if(!u.isRenderable)continue;if(!l&&a.popupRef){const h=r.get(a.popupRef);h?h.push(u):r.set(a.popupRef,[u])}const d=u.render();a.hidden&&(d.style.visibility="hidden"),await this.#o(d,a.id,s.elements),u.extraPopupElement?.popup?.renderCommentButton(),u._isEditable&&(this.#n.set(u.data.id,u),this._annotationEditorUIManager?.renderAnnotationElement(u))}this.#s()}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:this.#a,svgFactory:new DOMSVGFactory,parent:this};for(const n of e){n.borderStyle||=AnnotationLayer._defaultBorderStyle,t.data=n;const r=AnnotationElementFactory.create(t);if(!r.isRenderable)continue;const s=r.render();await this.#o(s,n.id,null)}}update({viewport:e}){const t=this.div;this.viewport=e,setLayerDimensions(t,{rotation:e.rotation}),this.#s(),t.hidden=!1}#s(){if(!this.#t)return;const e=this.div;for(const[t,n]of this.#t){const r=e.querySelector(`[data-annotation-id="${t}"]`);if(!r)continue;n.className="annotationContent";const{firstChild:s}=r;s?s.nodeName==="CANVAS"?s.replaceWith(n):s.classList.contains("annotationContent")?s.after(n):s.before(n):r.append(n);const a=this.#n.get(t);a&&(a._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(t,r.id,n),a._hasNoCanvas=!1):a.canvas=n)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(e){return this.#n.get(e)}addFakeAnnotation(e){const{div:t}=this,{id:n,rotation:r}=e,s=new EditorAnnotationElement({data:{id:n,rect:e.getPDFRect(),rotation:r},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:this.#a,annotationStorage:this.#i}),a=s.render();return t.append(a),this.#e?.moveElementInDOM(t,a,a,!1),s.createOrUpdatePopup(),s}static get _defaultBorderStyle(){return shadow(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:AnnotationBorderStyleType.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const EOL_PATTERN=/\r\n?|\n/g;class FreeTextEditor extends AnnotationEditor{#e="";#t=`${this.id}-editor`;#i=null;#n;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=FreeTextEditor.prototype,t=s=>s.isEmpty(),n=AnnotationEditorUIManager.TRANSLATE_SMALL,r=AnnotationEditorUIManager.TRANSLATE_BIG;return shadow(this,"_keyboardManager",new KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[n,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,n],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,r],checker:t}]]))}static _type="freetext";static _editorType=AnnotationEditorType.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.color=e.color||FreeTextEditor._defaultColor||AnnotationEditor._defaultLineColor,this.#n=e.fontSize||FreeTextEditor._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(e,t){AnnotationEditor.initialize(e,t);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case AnnotationEditorParamsType.FREETEXT_SIZE:FreeTextEditor._defaultFontSize=t;break;case AnnotationEditorParamsType.FREETEXT_COLOR:FreeTextEditor._defaultColor=t;break}}updateParams(e,t){switch(e){case AnnotationEditorParamsType.FREETEXT_SIZE:this.#r(t);break;case AnnotationEditorParamsType.FREETEXT_COLOR:this.#a(t);break}}static get defaultPropertiesToUpdate(){return[[AnnotationEditorParamsType.FREETEXT_SIZE,FreeTextEditor._defaultFontSize],[AnnotationEditorParamsType.FREETEXT_COLOR,FreeTextEditor._defaultColor||AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[AnnotationEditorParamsType.FREETEXT_SIZE,this.#n],[AnnotationEditorParamsType.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new BasicColorPicker(this),[["colorPicker",this._colorPicker]]}get colorType(){return AnnotationEditorParamsType.FREETEXT_COLOR}#r(e){const t=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-this.#n)*this.parentScale),this.#n=r,this.#s()},n=this.#n;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#a(e){const t=r=>{this.color=r,this.onUpdatedColor()},n=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-FreeTextEditor._internalPadding*e,-(FreeTextEditor._internalPadding+this.#n)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const e=this._uiManager.combinedSignal(this.#i);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#t),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){const e=[];this.editorDiv.normalize();let t=null;for(const n of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&n.nodeName==="BR"||(e.push(FreeTextEditor.#l(n)),t=n);return e.join(`
`)}#s(){const[e,t]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:r,div:s}=this,a=s.style.display,l=s.classList.contains("hidden");s.classList.remove("hidden"),s.style.display="hidden",r.div.append(this.div),n=s.getBoundingClientRect(),s.remove(),s.style.display=a,s.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=n.width/e,this.height=n.height/t):(this.width=n.height/e,this.height=n.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#e,t=this.#e=this.#o().trimEnd();if(e===t)return;const n=r=>{if(this.#e=r,!r){this.remove();return}this.#c(),this._uiManager.rebuild(this),this.#s()};this.addCommands({cmd:()=>{n(t)},undo:()=>{n(e)},mustExec:!1}),this.#s()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){FreeTextEditor._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#t),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,n.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,s]=this.parentDimensions;if(this.annotationElementId){const{position:a}=this._initialData;let[l,u]=this.getInitialTranslation();[l,u]=this.pageTranslationToScreen(l,u);const[d,h]=this.pageDimensions,[p,m]=this.pageTranslation;let g,v;switch(this.rotation){case 0:g=e+(a[0]-p)/d,v=t+this.height-(a[1]-m)/h;break;case 90:g=e+(a[0]-p)/d,v=t-(a[1]-m)/h,[l,u]=[u,-l];break;case 180:g=e-this.width+(a[0]-p)/d,v=t-(a[1]-m)/h,[l,u]=[-l,-u];break;case 270:g=e+(a[0]-p-this.height*h)/d,v=t+(a[1]-m-this.width*d)/h,[l,u]=[-u,l];break}this.setAt(g*r,v*s,l,u)}else this._moveAfterPaste(e,t);this.#c(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#l(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(EOL_PATTERN,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:n}=t;if(n.length===1&&n[0]==="text/plain")return;e.preventDefault();const r=FreeTextEditor.#d(t.getData("text")||"").replaceAll(EOL_PATTERN,`
`);if(!r)return;const s=window.getSelection();if(!s.rangeCount)return;this.editorDiv.normalize(),s.deleteFromDocument();const a=s.getRangeAt(0);if(!r.includes(`
`)){a.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),s.collapseToStart();return}const{startContainer:l,startOffset:u}=a,d=[],h=[];if(l.nodeType===Node.TEXT_NODE){const g=l.parentElement;if(h.push(l.nodeValue.slice(u).replaceAll(EOL_PATTERN,"")),g!==this.editorDiv){let v=d;for(const _ of this.editorDiv.childNodes){if(_===g){v=h;continue}v.push(FreeTextEditor.#l(_))}}d.push(l.nodeValue.slice(0,u).replaceAll(EOL_PATTERN,""))}else if(l===this.editorDiv){let g=d,v=0;for(const _ of this.editorDiv.childNodes)v++===u&&(g=h),g.push(FreeTextEditor.#l(_))}this.#e=`${d.join(`
`)}${r}${h.join(`
`)}`,this.#c();const p=new Range;let m=Math.sumPrecise(d.map(g=>g.length));for(const{firstChild:g}of this.editorDiv.childNodes)if(g.nodeType===Node.TEXT_NODE){const v=g.nodeValue.length;if(m<=v){p.setStart(g,m),p.setEnd(g,m);break}m-=v}s.removeAllRanges(),s.addRange(p)}#c(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const e of this.#e.split(`
`)){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#h(){return this.#e.replaceAll(""," ")}static#d(e){return e.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const e=FreeTextEditor._internalPadding*this.parentScale;return this.getRect(e,e)}static async deserialize(e,t,n){let r=null;if(e instanceof FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:a,fontColor:l},rect:u,rotation:d,id:h,popupRef:p,richText:m,contentsObj:g,creationDate:v,modificationDate:_},textContent:b,textPosition:E,parent:{page:{pageNumber:A}}}=e;if(!b||b.length===0)return null;r=e={annotationType:AnnotationEditorType.FREETEXT,color:Array.from(l),fontSize:a,value:b.join(`
`),position:E,pageIndex:A-1,rect:u.slice(0),rotation:d,annotationElementId:h,id:h,deleted:!1,popupRef:p,comment:g?.str||null,richText:m,creationDate:v,modificationDate:_}}const s=await super.deserialize(e,t,n);return s.#n=e.fontSize,s.color=Util.makeHexColor(...e.color),s.#e=FreeTextEditor.#d(e.value),s._initialData=r,e.comment&&s.setCommentData(e),s}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),n=Object.assign(super.serialize(e),{color:t,fontSize:this.#n,value:this.#h()});return this.addComment(n),e?(n.isCopy=!0,n):this.annotationElementId&&!this.#f(n)?null:(n.id=this.annotationElementId,n)}#f(e){const{value:t,fontSize:n,color:r,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==t||e.fontSize!==n||e.color.some((a,l)=>a!==r[l])||e.pageIndex!==s}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(!t)return null;const{style:n}=t;n.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,n.color=this.color,t.replaceChildren();for(const r of this.#e.split(`
`)){const s=document.createElement("div");s.append(r?document.createTextNode(r):document.createElement("br")),t.append(s)}return e.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#e}}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class Outline{static PRECISION=1e-4;toSVGPath(){unreachable("Abstract method `toSVGPath` must be implemented.")}get box(){unreachable("Abstract getter `box` must be implemented.")}serialize(e,t){unreachable("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,r,s,a){a||=new Float32Array(e.length);for(let l=0,u=e.length;l<u;l+=2)a[l]=t+e[l]*r,a[l+1]=n+e[l+1]*s;return a}static _rescaleAndSwap(e,t,n,r,s,a){a||=new Float32Array(e.length);for(let l=0,u=e.length;l<u;l+=2)a[l]=t+e[l+1]*r,a[l+1]=n+e[l]*s;return a}static _translate(e,t,n,r){r||=new Float32Array(e.length);for(let s=0,a=e.length;s<a;s+=2)r[s]=t+e[s],r[s+1]=n+e[s+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,r,s){switch(s){case 90:return[1-t/n,e/r];case 180:return[1-e/n,1-t/r];case 270:return[t/n,1-e/r];default:return[e/n,t/r]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,r,s,a){return[(e+5*n)/6,(t+5*r)/6,(5*n+s)/6,(5*r+a)/6,(n+s)/2,(r+a)/2]}}class FreeDrawOutliner{#e;#t=[];#i;#n;#r=[];#a=new Float32Array(18);#o;#s;#l;#c;#h;#d;#f=[];static#g=8;static#p=2;static#u=FreeDrawOutliner.#g+FreeDrawOutliner.#p;constructor({x:e,y:t},n,r,s,a,l=0){this.#e=n,this.#d=s*r,this.#n=a,this.#a.set([NaN,NaN,NaN,NaN,e,t],6),this.#i=l,this.#c=FreeDrawOutliner.#g*r,this.#l=FreeDrawOutliner.#u*r,this.#h=r,this.#f.push(e,t)}isEmpty(){return isNaN(this.#a[8])}#m(){const e=this.#a.subarray(4,6),t=this.#a.subarray(16,18),[n,r,s,a]=this.#e;return[(this.#o+(e[0]-t[0])/2-n)/s,(this.#s+(e[1]-t[1])/2-r)/a,(this.#o+(t[0]-e[0])/2-n)/s,(this.#s+(t[1]-e[1])/2-r)/a]}add({x:e,y:t}){this.#o=e,this.#s=t;const[n,r,s,a]=this.#e;let[l,u,d,h]=this.#a.subarray(8,12);const p=e-d,m=t-h,g=Math.hypot(p,m);if(g<this.#l)return!1;const v=g-this.#c,_=v/g,b=_*p,E=_*m;let A=l,z=u;l=d,u=h,d+=b,h+=E,this.#f?.push(e,t);const D=-E/v,P=b/v,G=D*this.#d,R=P*this.#d;return this.#a.set(this.#a.subarray(2,8),0),this.#a.set([d+G,h+R],4),this.#a.set(this.#a.subarray(14,18),12),this.#a.set([d-G,h-R],16),isNaN(this.#a[6])?(this.#r.length===0&&(this.#a.set([l+G,u+R],2),this.#r.push(NaN,NaN,NaN,NaN,(l+G-n)/s,(u+R-r)/a),this.#a.set([l-G,u-R],14),this.#t.push(NaN,NaN,NaN,NaN,(l-G-n)/s,(u-R-r)/a)),this.#a.set([A,z,l,u,d,h],6),!this.isEmpty()):(this.#a.set([A,z,l,u,d,h],6),Math.abs(Math.atan2(z-u,A-l)-Math.atan2(E,b))<Math.PI/2?([l,u,d,h]=this.#a.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((l+d)/2-n)/s,((u+h)/2-r)/a),[l,u,A,z]=this.#a.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((A+l)/2-n)/s,((z+u)/2-r)/a),!0):([A,z,l,u,d,h]=this.#a.subarray(0,6),this.#r.push(((A+5*l)/6-n)/s,((z+5*u)/6-r)/a,((5*l+d)/6-n)/s,((5*u+h)/6-r)/a,((l+d)/2-n)/s,((u+h)/2-r)/a),[d,h,l,u,A,z]=this.#a.subarray(12,18),this.#t.push(((A+5*l)/6-n)/s,((z+5*u)/6-r)/a,((5*l+d)/6-n)/s,((5*u+h)/6-r)/a,((l+d)/2-n)/s,((u+h)/2-r)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=this.#r,t=this.#t;if(isNaN(this.#a[6])&&!this.isEmpty())return this.#y();const n=[];n.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?n.push(`L${e[r+4]} ${e[r+5]}`):n.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);this.#v(n);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?n.push(`L${t[r+4]} ${t[r+5]}`):n.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return this.#b(n),n.join(" ")}#y(){const[e,t,n,r]=this.#e,[s,a,l,u]=this.#m();return`M${(this.#a[2]-e)/n} ${(this.#a[3]-t)/r} L${(this.#a[4]-e)/n} ${(this.#a[5]-t)/r} L${s} ${a} L${l} ${u} L${(this.#a[16]-e)/n} ${(this.#a[17]-t)/r} L${(this.#a[14]-e)/n} ${(this.#a[15]-t)/r} Z`}#b(e){const t=this.#t;e.push(`L${t[4]} ${t[5]} Z`)}#v(e){const[t,n,r,s]=this.#e,a=this.#a.subarray(4,6),l=this.#a.subarray(16,18),[u,d,h,p]=this.#m();e.push(`L${(a[0]-t)/r} ${(a[1]-n)/s} L${u} ${d} L${h} ${p} L${(l[0]-t)/r} ${(l[1]-n)/s}`)}newFreeDrawOutline(e,t,n,r,s,a){return new FreeDrawOutline(e,t,n,r,s,a)}getOutlines(){const e=this.#r,t=this.#t,n=this.#a,[r,s,a,l]=this.#e,u=new Float32Array((this.#f?.length??0)+2);for(let p=0,m=u.length-2;p<m;p+=2)u[p]=(this.#f[p]-r)/a,u[p+1]=(this.#f[p+1]-s)/l;if(u[u.length-2]=(this.#o-r)/a,u[u.length-1]=(this.#s-s)/l,isNaN(n[6])&&!this.isEmpty())return this.#w(u);const d=new Float32Array(this.#r.length+24+this.#t.length);let h=e.length;for(let p=0;p<h;p+=2){if(isNaN(e[p])){d[p]=d[p+1]=NaN;continue}d[p]=e[p],d[p+1]=e[p+1]}h=this.#_(d,h);for(let p=t.length-6;p>=6;p-=6)for(let m=0;m<6;m+=2){if(isNaN(t[p+m])){d[h]=d[h+1]=NaN,h+=2;continue}d[h]=t[p+m],d[h+1]=t[p+m+1],h+=2}return this.#x(d,h),this.newFreeDrawOutline(d,u,this.#e,this.#h,this.#i,this.#n)}#w(e){const t=this.#a,[n,r,s,a]=this.#e,[l,u,d,h]=this.#m(),p=new Float32Array(36);return p.set([NaN,NaN,NaN,NaN,(t[2]-n)/s,(t[3]-r)/a,NaN,NaN,NaN,NaN,(t[4]-n)/s,(t[5]-r)/a,NaN,NaN,NaN,NaN,l,u,NaN,NaN,NaN,NaN,d,h,NaN,NaN,NaN,NaN,(t[16]-n)/s,(t[17]-r)/a,NaN,NaN,NaN,NaN,(t[14]-n)/s,(t[15]-r)/a],0),this.newFreeDrawOutline(p,e,this.#e,this.#h,this.#i,this.#n)}#x(e,t){const n=this.#t;return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6}#_(e,t){const n=this.#a.subarray(4,6),r=this.#a.subarray(16,18),[s,a,l,u]=this.#e,[d,h,p,m]=this.#m();return e.set([NaN,NaN,NaN,NaN,(n[0]-s)/l,(n[1]-a)/u,NaN,NaN,NaN,NaN,d,h,NaN,NaN,NaN,NaN,p,m,NaN,NaN,NaN,NaN,(r[0]-s)/l,(r[1]-a)/u],t),t+=24}}class FreeDrawOutline extends Outline{#e;#t=new Float32Array(4);#i;#n;#r;#a;#o;constructor(e,t,n,r,s,a){super(),this.#o=e,this.#r=t,this.#e=n,this.#a=r,this.#i=s,this.#n=a,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#s(a);const[l,u,d,h]=this.#t;for(let p=0,m=e.length;p<m;p+=2)e[p]=(e[p]-l)/d,e[p+1]=(e[p+1]-u)/h;for(let p=0,m=t.length;p<m;p+=2)t[p]=(t[p]-l)/d,t[p+1]=(t[p+1]-u)/h}toSVGPath(){const e=[`M${this.#o[4]} ${this.#o[5]}`];for(let t=6,n=this.#o.length;t<n;t+=6){if(isNaN(this.#o[t])){e.push(`L${this.#o[t+4]} ${this.#o[t+5]}`);continue}e.push(`C${this.#o[t]} ${this.#o[t+1]} ${this.#o[t+2]} ${this.#o[t+3]} ${this.#o[t+4]} ${this.#o[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,n,r],s){const a=n-e,l=r-t;let u,d;switch(s){case 0:u=Outline._rescale(this.#o,e,r,a,-l),d=Outline._rescale(this.#r,e,r,a,-l);break;case 90:u=Outline._rescaleAndSwap(this.#o,e,t,a,l),d=Outline._rescaleAndSwap(this.#r,e,t,a,l);break;case 180:u=Outline._rescale(this.#o,n,t,-a,l),d=Outline._rescale(this.#r,n,t,-a,l);break;case 270:u=Outline._rescaleAndSwap(this.#o,n,r,-a,-l),d=Outline._rescaleAndSwap(this.#r,n,r,-a,-l);break}return{outline:Array.from(u),points:[Array.from(d)]}}#s(e){const t=this.#o;let n=t[4],r=t[5];const s=[n,r,n,r];let a=n,l=r,u=n,d=r;const h=e?Math.max:Math.min,p=new Float32Array(4);for(let g=6,v=t.length;g<v;g+=6){const _=t[g+4],b=t[g+5];isNaN(t[g])?(Util.pointBoundingBox(_,b,s),l>b?(a=_,l=b):l===b&&(a=h(a,_)),d<b?(u=_,d=b):d===b&&(u=h(u,_))):(p[0]=p[1]=1/0,p[2]=p[3]=-1/0,Util.bezierBoundingBox(n,r,...t.slice(g,g+6),p),Util.rectBoundingBox(p[0],p[1],p[2],p[3],s),l>p[1]?(a=p[0],l=p[1]):l===p[1]&&(a=h(a,p[0])),d<p[3]?(u=p[2],d=p[3]):d===p[3]&&(u=h(u,p[2]))),n=_,r=b}const m=this.#t;m[0]=s[0]-this.#i,m[1]=s[1]-this.#i,m[2]=s[2]-s[0]+2*this.#i,m[3]=s[3]-s[1]+2*this.#i,this.firstPoint=[a,l],this.lastPoint=[u,d]}get box(){return this.#t}newOutliner(e,t,n,r,s,a=0){return new FreeDrawOutliner(e,t,n,r,s,a)}getNewOutline(e,t){const[n,r,s,a]=this.#t,[l,u,d,h]=this.#e,p=s*d,m=a*h,g=n*d+l,v=r*h+u,_=this.newOutliner({x:this.#r[0]*p+g,y:this.#r[1]*m+v},this.#e,this.#a,e,this.#n,t??this.#i);for(let b=2;b<this.#r.length;b+=2)_.add({x:this.#r[b]*p+g,y:this.#r[b+1]*m+v});return _.getOutlines()}}class HighlightOutliner{#e;#t;#i;#n=[];#r=[];constructor(e,t=0,n=0,r=!0){const s=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:_,y:b,width:E,height:A}of e){const z=Math.floor((_-t)/a)*a,D=Math.ceil((_+E+t)/a)*a,P=Math.floor((b-t)/a)*a,G=Math.ceil((b+A+t)/a)*a,R=[z,P,G,!0],I=[D,P,G,!1];this.#n.push(R,I),Util.rectBoundingBox(z,P,D,G,s)}const l=s[2]-s[0]+2*n,u=s[3]-s[1]+2*n,d=s[0]-n,h=s[1]-n;let p=r?-1/0:1/0,m=1/0;const g=this.#n.at(r?-1:-2),v=[g[0],g[2]];for(const _ of this.#n){const[b,E,A,z]=_;!z&&r?E<m?(m=E,p=b):E===m&&(p=Math.max(p,b)):z&&!r&&(E<m?(m=E,p=b):E===m&&(p=Math.min(p,b))),_[0]=(b-d)/l,_[1]=(E-h)/u,_[2]=(A-h)/u}this.#e=new Float32Array([d,h,l,u]),this.#t=[p,m],this.#i=v}getOutlines(){this.#n.sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);const e=[];for(const t of this.#n)t[3]?(e.push(...this.#c(t)),this.#s(t)):(this.#l(t),e.push(...this.#c(t)));return this.#a(e)}#a(e){const t=[],n=new Set;for(const a of e){const[l,u,d]=a;t.push([l,u,a],[l,d,a])}t.sort((a,l)=>a[1]-l[1]||a[0]-l[0]);for(let a=0,l=t.length;a<l;a+=2){const u=t[a][2],d=t[a+1][2];u.push(d),d.push(u),n.add(u),n.add(d)}const r=[];let s;for(;n.size>0;){const a=n.values().next().value;let[l,u,d,h,p]=a;n.delete(a);let m=l,g=u;for(s=[l,d],r.push(s);;){let v;if(n.has(h))v=h;else if(n.has(p))v=p;else break;n.delete(v),[l,u,d,h,p]=v,m!==l&&(s.push(m,g,l,g===u?u:d),m=l),g=g===u?d:u}s.push(m,g)}return new HighlightOutline(r,this.#e,this.#t,this.#i)}#o(e){const t=this.#r;let n=0,r=t.length-1;for(;n<=r;){const s=n+r>>1,a=t[s][0];if(a===e)return s;a<e?n=s+1:r=s-1}return r+1}#s([,e,t]){const n=this.#o(e);this.#r.splice(n,0,[e,t])}#l([,e,t]){const n=this.#o(e);for(let r=n;r<this.#r.length;r++){const[s,a]=this.#r[r];if(s!==e)break;if(s===e&&a===t){this.#r.splice(r,1);return}}for(let r=n-1;r>=0;r--){const[s,a]=this.#r[r];if(s!==e)break;if(s===e&&a===t){this.#r.splice(r,1);return}}}#c(e){const[t,n,r]=e,s=[[t,n,r]],a=this.#o(r);for(let l=0;l<a;l++){const[u,d]=this.#r[l];for(let h=0,p=s.length;h<p;h++){const[,m,g]=s[h];if(!(d<=m||g<=u)){if(m>=u){if(g>d)s[h][1]=d;else{if(p===1)return[];s.splice(h,1),h--,p--}continue}s[h][2]=u,g>d&&s.push([t,d,g])}}}return s}}class HighlightOutline extends Outline{#e;#t;constructor(e,t,n,r){super(),this.#t=e,this.#e=t,this.firstPoint=n,this.lastPoint=r}toSVGPath(){const e=[];for(const t of this.#t){let[n,r]=t;e.push(`M${n} ${r}`);for(let s=2;s<t.length;s+=2){const a=t[s],l=t[s+1];a===n?(e.push(`V${l}`),r=l):l===r&&(e.push(`H${a}`),n=a)}e.push("Z")}return e.join(" ")}serialize([e,t,n,r],s){const a=[],l=n-e,u=r-t;for(const d of this.#t){const h=new Array(d.length);for(let p=0;p<d.length;p+=2)h[p]=e+d[p]*l,h[p+1]=r-d[p+1]*u;a.push(h)}return a}get box(){return this.#e}get classNamesForOutlining(){return["highlightOutline"]}}class FreeHighlightOutliner extends FreeDrawOutliner{newFreeDrawOutline(e,t,n,r,s,a){return new FreeHighlightOutline(e,t,n,r,s,a)}}class FreeHighlightOutline extends FreeDrawOutline{newOutliner(e,t,n,r,s,a=0){return new FreeHighlightOutliner(e,t,n,r,s,a)}}class HighlightEditor extends AnnotationEditor{#e=null;#t=0;#i;#n=null;#r=null;#a=null;#o=null;#s=0;#l=null;#c=null;#h=null;#d=!1;#f=null;#g=null;#p=null;#u="";#m;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=AnnotationEditorType.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=HighlightEditor.prototype;return shadow(this,"_keyboardManager",new KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||HighlightEditor._defaultColor,this.#m=e.thickness||HighlightEditor._defaultThickness,this.opacity=e.opacity||HighlightEditor._defaultOpacity,this.#i=e.boxes||null,this.#y=e.methodOfCreation||"",this.#u=e.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(this.#d=!0,this.#v(e),this.#E()):this.#i&&(this.#e=e.anchorNode,this.#t=e.anchorOffset,this.#o=e.focusNode,this.#s=e.focusOffset,this.#b(),this.#E(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#d?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#m,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#b(){const e=new HighlightOutliner(this.#i,.001);this.#c=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#c.box;const t=new HighlightOutliner(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#a=t.getOutlines();const{firstPoint:n}=this.#c;this.#f=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height];const{lastPoint:r}=this.#a;this.#g=[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height]}#v({highlightOutlines:e,highlightId:t,clipPathId:n}){this.#c=e;const r=1.5;if(this.#a=e.getNewOutline(this.#m/2+r,.0025),t>=0)this.#h=t,this.#n=n,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#a.box,path:{d:this.#a.toSVGPath()}},!0);else if(this.parent){const p=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#h,{bbox:HighlightEditor.#A(this.#c.box,(p-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:HighlightEditor.#A(this.#a.box,p),path:{d:this.#a.toSVGPath()}})}const[s,a,l,u]=e.box;switch(this.rotation){case 0:this.x=s,this.y=a,this.width=l,this.height=u;break;case 90:{const[p,m]=this.parentDimensions;this.x=a,this.y=1-s,this.width=l*m/p,this.height=u*p/m;break}case 180:this.x=1-s,this.y=1-a,this.width=l,this.height=u;break;case 270:{const[p,m]=this.parentDimensions;this.x=1-a,this.y=s,this.width=l*m/p,this.height=u*p/m;break}}const{firstPoint:d}=e;this.#f=[(d[0]-s)/l,(d[1]-a)/u];const{lastPoint:h}=this.#a;this.#g=[(h[0]-s)/l,(h[1]-a)/u]}static initialize(e,t){AnnotationEditor.initialize(e,t),HighlightEditor._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case AnnotationEditorParamsType.HIGHLIGHT_COLOR:HighlightEditor._defaultColor=t;break;case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:HighlightEditor._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#g}get commentButtonPosition(){return this.#f}updateParams(e,t){switch(e){case AnnotationEditorParamsType.HIGHLIGHT_COLOR:this.#w(t);break;case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:this.#x(t);break}}static get defaultPropertiesToUpdate(){return[[AnnotationEditorParamsType.HIGHLIGHT_COLOR,HighlightEditor._defaultColor],[AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,HighlightEditor._defaultThickness]]}get propertiesToUpdate(){return[[AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.color||HighlightEditor._defaultColor],[AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,this.#m||HighlightEditor._defaultThickness],[AnnotationEditorParamsType.HIGHLIGHT_FREE,this.#d]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#h,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#r?.updateColor(this.color),super.onUpdatedColor()}#w(e){const t=(s,a)=>{this.color=s,this.opacity=a,this.onUpdatedColor()},n=this.color,r=this.opacity;this.addCommands({cmd:t.bind(this,e,HighlightEditor._defaultOpacity),undo:t.bind(this,n,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)}#x(e){const t=this.#m,n=r=>{this.#m=r,this.#_(r)};this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#r=new ColorPicker({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#R())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#R())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#P(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#E(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#P():e&&(this.#E(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#_(e){this.#d&&(this.#v({highlightOutlines:this.#c.getNewOutline(e/2)}),this.fixAndSetPosition(),this.setDims(this.width,this.height))}#P(){this.#h===null||!this.parent||(this.parent.drawLayer.remove(this.#h),this.#h=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#E(e=this.parent){this.#h===null&&({id:this.#h,clipPathId:this.#n}=e.drawLayer.draw({bbox:this.#c.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#d},path:{d:this.#c.toSVGPath()}},!1,!0),this.#p=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#d},bbox:this.#a.box,path:{d:this.#a.toSVGPath()}},this.#d),this.#l&&(this.#l.style.clipPath=this.#n))}static#A([e,t,n,r],s){switch(s){case 90:return[1-t-r,e,r,n];case 180:return[1-e-n,1-t-r,n,r];case 270:return[t,1-e-n,r,n]}return[e,t,n,r]}rotate(e){const{drawLayer:t}=this.parent;let n;this.#d?(e=(e-this.rotation+360)%360,n=HighlightEditor.#A(this.#c.box,e)):n=HighlightEditor.#A([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#h,{bbox:n,root:{"data-main-rotation":e}}),t.updateProperties(this.#p,{bbox:HighlightEditor.#A(this.#a.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#u&&(e.setAttribute("aria-label",this.#u),e.setAttribute("role","mark")),this.#d?e.classList.add("free"):this.div.addEventListener("keydown",this.#I.bind(this),{signal:this._uiManager._signal});const t=this.#l=document.createElement("div");return e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#n,this.setDims(this.width,this.height),bindEvents(this,this.#l,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#I(e){HighlightEditor._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#S(!0);break;case 1:case 3:this.#S(!1);break}}#S(e){if(!this.#e)return;const t=window.getSelection();e?t.setPosition(this.#e,this.#t):t.setPosition(this.#o,this.#s)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#d||this.#S(!1))}get _mustFixPosition(){return!this.#d}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#h,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!e}}))}#R(){return this.#d?this.rotation:0}#L(){if(this.#d)return null;const[e,t]=this.pageDimensions,[n,r]=this.pageTranslation,s=this.#i,a=new Float32Array(s.length*8);let l=0;for(const{x:u,y:d,width:h,height:p}of s){const m=u*e+n,g=(1-d)*t+r;a[l]=a[l+4]=m,a[l+1]=a[l+3]=g,a[l+2]=a[l+6]=m+h*e,a[l+5]=a[l+7]=g-p*t,l+=8}return a}#M(e){return this.#c.serialize(e,this.#R())}static startHighlighting(e,t,{target:n,x:r,y:s}){const{x:a,y:l,width:u,height:d}=n.getBoundingClientRect(),h=new AbortController,p=e.combinedSignal(h),m=g=>{h.abort(),this.#D(e,g)};window.addEventListener("blur",m,{signal:p}),window.addEventListener("pointerup",m,{signal:p}),window.addEventListener("pointerdown",stopEvent,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",noContextMenu,{signal:p}),n.addEventListener("pointermove",this.#N.bind(this,e),{signal:p}),this._freeHighlight=new FreeHighlightOutliner({x:r,y:s},[a,l,u,d],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#N(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#D(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,t,n){let r=null;if(e instanceof HighlightAnnotationElement){const{data:{quadPoints:v,rect:_,rotation:b,id:E,color:A,opacity:z,popupRef:D,richText:P,contentsObj:G,creationDate:R,modificationDate:I},parent:{page:{pageNumber:w}}}=e;r=e={annotationType:AnnotationEditorType.HIGHLIGHT,color:Array.from(A),opacity:z,quadPoints:v,boxes:null,pageIndex:w-1,rect:_.slice(0),rotation:b,annotationElementId:E,id:E,deleted:!1,popupRef:D,richText:P,comment:G?.str||null,creationDate:R,modificationDate:I}}else if(e instanceof InkAnnotationElement){const{data:{inkLists:v,rect:_,rotation:b,id:E,color:A,borderStyle:{rawWidth:z},popupRef:D,richText:P,contentsObj:G,creationDate:R,modificationDate:I},parent:{page:{pageNumber:w}}}=e;r=e={annotationType:AnnotationEditorType.HIGHLIGHT,color:Array.from(A),thickness:z,inkLists:v,boxes:null,pageIndex:w-1,rect:_.slice(0),rotation:b,annotationElementId:E,id:E,deleted:!1,popupRef:D,richText:P,comment:G?.str||null,creationDate:R,modificationDate:I}}const{color:s,quadPoints:a,inkLists:l,opacity:u}=e,d=await super.deserialize(e,t,n);d.color=Util.makeHexColor(...s),d.opacity=u||1,l&&(d.#m=e.thickness),d._initialData=r,e.comment&&d.setCommentData(e);const[h,p]=d.pageDimensions,[m,g]=d.pageTranslation;if(a){const v=d.#i=[];for(let _=0;_<a.length;_+=8)v.push({x:(a[_]-m)/h,y:1-(a[_+1]-g)/p,width:(a[_+2]-a[_])/h,height:(a[_+1]-a[_+5])/p});d.#b(),d.#E(),d.rotate(d.rotation)}else if(l){d.#d=!0;const v=l[0],_={x:v[0]-m,y:p-(v[1]-g)},b=new FreeHighlightOutliner(_,[0,0,h,p],1,d.#m/2,!0,.001);for(let z=0,D=v.length;z<D;z+=2)_.x=v[z]-m,_.y=p-(v[z+1]-g),b.add(_);const{id:E,clipPathId:A}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:b.toSVGPath()}},!0,!0);d.#v({highlightOutlines:b.getOutlines(),highlightId:E,clipPathId:A}),d.#E(),d.rotate(d.parentRotation)}return d}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=AnnotationEditor._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),n=super.serialize(e);return Object.assign(n,{color:t,opacity:this.opacity,thickness:this.#m,quadPoints:this.#L(),outlines:this.#M(n.rect)}),this.addComment(n),this.annotationElementId&&!this.#k(n)?null:(n.id=this.annotationElementId,n)}#k(e){const{color:t}=this._initialData;return this.hasEditedComment||e.color.some((n,r)=>n!==t[r])}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class DrawingOptions{#e=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,n]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,n)}updateSVGProperty(e,t){this.#e[e]=t}toSVGProperties(){const e=this.#e;return this.#e=Object.create(null),{root:e}}reset(){this.#e=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){unreachable("Not implemented")}}class DrawingEditor extends AnnotationEditor{#e=null;#t;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#i=null;static#n=null;static#r=null;static#a=NaN;static#o=null;static#s=null;static#l=NaN;static _INNER_MARGIN=3;constructor(e){super(e),this.#t=e.mustBeCommitted||!1,this._addOutlines(e)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(e){e.drawOutlines&&(this.#c(e),this.#f())}#c({drawOutlines:e,drawId:t,drawingOptions:n}){this.#e=e,this._drawingOptions||=n,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,e.defaultProperties)):this._drawId=this.#h(e,this.parent),this.#u(e.box)}#h(e,t){const{id:n}=t.drawLayer.draw(DrawingEditor._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(e,t){const n=new Set(Object.keys(e));for(const[r,s]of Object.entries(t))n.has(r)?Object.assign(e[r],s):e[r]=s;return e}static getDefaultDrawingOptions(e){unreachable("Not implemented")}static get typesMap(){unreachable("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,t){const n=this.typesMap.get(e);n&&this._defaultDrawingOptions.updateProperty(n,t),this._currentParent&&(DrawingEditor.#i.updateProperty(n,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){const n=this.constructor.typesMap.get(e);n&&this._updateProperty(e,n,t)}static get defaultPropertiesToUpdate(){const e=[],t=this._defaultDrawingOptions;for(const[n,r]of this.typesMap)e.push([n,t[r]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:t}=this;for(const[n,r]of this.constructor.typesMap)e.push([n,t[r]]);return e}_updateProperty(e,t,n){const r=this._drawingOptions,s=r[t],a=l=>{r.updateProperty(t,l);const u=this.#e.updateProperty(t,l);u&&this.#u(u),this.parent?.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),e===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:a.bind(this,n),undo:a.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,DrawingEditor._mergeSVGProperties(this.#e.getPathResizingSVGProperties(this.#p()),{bbox:this.#m()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,DrawingEditor._mergeSVGProperties(this.#e.getPathResizedSVGProperties(this.#p()),{bbox:this.#m()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#m()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,DrawingEditor._mergeSVGProperties(this.#e.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#m()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#t&&(this.#t=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#d(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#u(this.#e.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#d()):e&&(this._uiManager.addShouldRescale(this),this.#f(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),t&&this.select()}#d(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#h(this.#e,e)}}#g([e,t,n,r]){const{parentDimensions:[s,a],rotation:l}=this;switch(l){case 90:return[t,1-e,n*(a/s),r*(s/a)];case 180:return[1-e,1-t,n,r];case 270:return[1-t,e,n*(a/s),r*(s/a)];default:return[e,t,n,r]}}#p(){const{x:e,y:t,width:n,height:r,parentDimensions:[s,a],rotation:l}=this;switch(l){case 90:return[1-t,e,n*(s/a),r*(a/s)];case 180:return[1-e,1-t,n,r];case 270:return[t,1-e,n*(s/a),r*(a/s)];default:return[e,t,n,r]}}#u(e){[this.x,this.y,this.width,this.height]=this.#g(e),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#m(){const{x:e,y:t,width:n,height:r,rotation:s,parentRotation:a,parentDimensions:[l,u]}=this;switch((s*4+a)/90){case 1:return[1-t-r,e,r,n];case 2:return[1-e-n,1-t-r,n,r];case 3:return[t,1-e-n,r,n];case 4:return[e,t-n*(l/u),r*(u/l),n*(l/u)];case 5:return[1-t,e,n*(l/u),r*(u/l)];case 6:return[1-e-r*(u/l),1-t,r*(u/l),n*(l/u)];case 7:return[t-n*(l/u),1-e-r*(u/l),n*(l/u),r*(u/l)];case 8:return[e-n,t-r,n,r];case 9:return[1-t,e-n,r,n];case 10:return[1-e,1-t,n,r];case 11:return[t-r,1-e,r,n];case 12:return[e-r*(u/l),t,r*(u/l),n*(l/u)];case 13:return[1-t-n*(l/u),e-r*(u/l),n*(l/u),r*(u/l)];case 14:return[1-e,1-t-n*(l/u),r*(u/l),n*(l/u)];case 15:return[t,1-e,n*(l/u),r*(u/l)];default:return[e,t,n,r]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,DrawingEditor._mergeSVGProperties({bbox:this.#m()},this.#e.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#u(this.#e.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,t;this._isCopy&&(e=this.x,t=this.y);const n=super.render();n.classList.add("draw");const r=document.createElement("div");return n.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,t),n}static createDrawerInstance(e,t,n,r,s){unreachable("Not implemented")}static startDrawing(e,t,n,r){const{target:s,offsetX:a,offsetY:l,pointerId:u,pointerType:d}=r;if(DrawingEditor.#o&&DrawingEditor.#o!==d)return;const{viewport:{rotation:h}}=e,{width:p,height:m}=s.getBoundingClientRect(),g=DrawingEditor.#n=new AbortController,v=e.combinedSignal(g);if(DrawingEditor.#a||=u,DrawingEditor.#o??=d,window.addEventListener("pointerup",_=>{DrawingEditor.#a===_.pointerId?this._endDraw(_):DrawingEditor.#s?.delete(_.pointerId)},{signal:v}),window.addEventListener("pointercancel",_=>{DrawingEditor.#a===_.pointerId?this._currentParent.endDrawingSession():DrawingEditor.#s?.delete(_.pointerId)},{signal:v}),window.addEventListener("pointerdown",_=>{DrawingEditor.#o===_.pointerType&&((DrawingEditor.#s||=new Set).add(_.pointerId),DrawingEditor.#i.isCancellable()&&(DrawingEditor.#i.removeLastElement(),DrawingEditor.#i.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:v}),window.addEventListener("contextmenu",noContextMenu,{signal:v}),s.addEventListener("pointermove",this._drawMove.bind(this),{signal:v}),s.addEventListener("touchmove",_=>{_.timeStamp===DrawingEditor.#l&&stopEvent(_)},{signal:v}),e.toggleDrawing(),t._editorUndoBar?.hide(),DrawingEditor.#i){e.drawLayer.updateProperties(this._currentDrawId,DrawingEditor.#i.startNew(a,l,p,m,h));return}t.updateUIForDefaultProperties(this),DrawingEditor.#i=this.createDrawerInstance(a,l,p,m,h),DrawingEditor.#r=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(DrawingEditor.#r.toSVGProperties(),DrawingEditor.#i.defaultSVGProperties),!0,!1)}static _drawMove(e){if(DrawingEditor.#l=-1,!DrawingEditor.#i)return;const{offsetX:t,offsetY:n,pointerId:r}=e;if(DrawingEditor.#a===r){if(DrawingEditor.#s?.size>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,DrawingEditor.#i.add(t,n)),DrawingEditor.#l=e.timeStamp,stopEvent(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,DrawingEditor.#i=null,DrawingEditor.#r=null,DrawingEditor.#o=null,DrawingEditor.#l=NaN),DrawingEditor.#n&&(DrawingEditor.#n.abort(),DrawingEditor.#n=null,DrawingEditor.#a=NaN,DrawingEditor.#s=null)}static _endDraw(e){const t=this._currentParent;if(t){if(t.toggleDrawing(!0),this._cleanup(!1),e?.target===t.div&&t.drawLayer.updateProperties(this._currentDrawId,DrawingEditor.#i.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const n=DrawingEditor.#i,r=this._currentDrawId,s=n.getLastElement();t.addCommands({cmd:()=>{t.drawLayer.updateProperties(r,n.setLastElement(s))},undo:()=>{t.drawLayer.updateProperties(r,n.removeLastElement())},mustExec:!1,type:AnnotationEditorParamsType.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack(AnnotationEditorParamsType.DRAW_STEP),!DrawingEditor.#i.isEmpty()){const{pageDimensions:[n,r],scale:s}=t,a=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:DrawingEditor.#i.getOutlines(n*s,r*s,s,this._INNER_MARGIN),drawingOptions:DrawingEditor.#r,mustBeCommitted:!e});return this._cleanup(!0),a}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,n,r,s,a){unreachable("Not implemented")}static async deserialize(e,t,n){const{rawDims:{pageWidth:r,pageHeight:s,pageX:a,pageY:l}}=t.viewport,u=this.deserializeDraw(a,l,r,s,this._INNER_MARGIN,e),d=await super.deserialize(e,t,n);return d.createDrawingOptions(e),d.#c({drawOutlines:u}),d.#f(),d.onScaleChanging(),d.rotate(),d}serializeDraw(e){const[t,n]=this.pageTranslation,[r,s]=this.pageDimensions;return this.#e.serialize([t,n,r,s],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class InkDrawOutliner{#e=new Float64Array(6);#t;#i;#n;#r;#a;#o="";#s=0;#l=new InkDrawOutline;#c;#h;constructor(e,t,n,r,s,a){this.#c=n,this.#h=r,this.#n=s,this.#r=a,[e,t]=this.#d(e,t);const l=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#a=[e,t],this.#i=[{line:l,points:this.#a}],this.#e.set(l,0)}updateProperty(e,t){e==="stroke-width"&&(this.#r=t)}#d(e,t){return Outline._normalizePoint(e,t,this.#c,this.#h,this.#n)}isEmpty(){return!this.#i||this.#i.length===0}isCancellable(){return this.#a.length<=10}add(e,t){[e,t]=this.#d(e,t);const[n,r,s,a]=this.#e.subarray(2,6),l=e-s,u=t-a;return Math.hypot(this.#c*l,this.#h*u)<=2?null:(this.#a.push(e,t),isNaN(n)?(this.#e.set([s,a,e,t],2),this.#t.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#e[0])&&this.#t.splice(6,6),this.#e.set([n,r,s,a,e,t],0),this.#t.push(...Outline.createBezierPoints(n,r,s,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const n=this.add(e,t);return n||(this.#a.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,r,s){this.#c=n,this.#h=r,this.#n=s,[e,t]=this.#d(e,t);const a=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#a=[e,t];const l=this.#i.at(-1);return l&&(l.line=new Float32Array(l.line),l.points=new Float32Array(l.points)),this.#i.push({line:a,points:this.#a}),this.#e.set(a,0),this.#s=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(e){return this.#i?(this.#i.push(e),this.#t=e.line,this.#a=e.points,this.#s=0,{path:{d:this.toSVGPath()}}):this.#l.setLastElement(e)}removeLastElement(){if(!this.#i)return this.#l.removeLastElement();this.#i.pop(),this.#o="";for(let e=0,t=this.#i.length;e<t;e++){const{line:n,points:r}=this.#i[e];this.#t=n,this.#a=r,this.#s=0,this.toSVGPath()}return{path:{d:this.#o}}}toSVGPath(){const e=Outline.svgRound(this.#t[4]),t=Outline.svgRound(this.#t[5]);if(this.#a.length===2)return this.#o=`${this.#o} M ${e} ${t} Z`,this.#o;if(this.#a.length<=6){const r=this.#o.lastIndexOf("M");this.#o=`${this.#o.slice(0,r)} M ${e} ${t}`,this.#s=6}if(this.#a.length===4){const r=Outline.svgRound(this.#t[10]),s=Outline.svgRound(this.#t[11]);return this.#o=`${this.#o} L ${r} ${s}`,this.#s=12,this.#o}const n=[];this.#s===0&&(n.push(`M ${e} ${t}`),this.#s=6);for(let r=this.#s,s=this.#t.length;r<s;r+=6){const[a,l,u,d,h,p]=this.#t.slice(r,r+6).map(Outline.svgRound);n.push(`C${a} ${l} ${u} ${d} ${h} ${p}`)}return this.#o+=n.join(" "),this.#s=this.#t.length,this.#o}getOutlines(e,t,n,r){const s=this.#i.at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),this.#l.build(this.#i,e,t,n,this.#n,this.#r,r),this.#e=null,this.#t=null,this.#i=null,this.#o=null,this.#l}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class InkDrawOutline extends Outline{#e;#t=0;#i;#n;#r;#a;#o;#s;#l;build(e,t,n,r,s,a,l){this.#r=t,this.#a=n,this.#o=r,this.#s=s,this.#l=a,this.#i=l??0,this.#n=e,this.#d()}get thickness(){return this.#l}setLastElement(e){return this.#n.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#n.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#n){if(e.push(`M${Outline.svgRound(t[4])} ${Outline.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12&&isNaN(t[6])){e.push(`L${Outline.svgRound(t[10])} ${Outline.svgRound(t[11])}`);continue}for(let n=6,r=t.length;n<r;n+=6){const[s,a,l,u,d,h]=t.subarray(n,n+6).map(Outline.svgRound);e.push(`C${s} ${a} ${l} ${u} ${d} ${h}`)}}return e.join("")}serialize([e,t,n,r],s){const a=[],l=[],[u,d,h,p]=this.#h();let m,g,v,_,b,E,A,z,D;switch(this.#s){case 0:D=Outline._rescale,m=e,g=t+r,v=n,_=-r,b=e+u*n,E=t+(1-d-p)*r,A=e+(u+h)*n,z=t+(1-d)*r;break;case 90:D=Outline._rescaleAndSwap,m=e,g=t,v=n,_=r,b=e+d*n,E=t+u*r,A=e+(d+p)*n,z=t+(u+h)*r;break;case 180:D=Outline._rescale,m=e+n,g=t,v=-n,_=r,b=e+(1-u-h)*n,E=t+d*r,A=e+(1-u)*n,z=t+(d+p)*r;break;case 270:D=Outline._rescaleAndSwap,m=e+n,g=t+r,v=-n,_=-r,b=e+(1-d-p)*n,E=t+(1-u-h)*r,A=e+(1-d)*n,z=t+(1-u)*r;break}for(const{line:P,points:G}of this.#n)a.push(D(P,m,g,v,_,s?new Array(P.length):null)),l.push(D(G,m,g,v,_,s?new Array(G.length):null));return{lines:a,points:l,rect:[b,E,A,z]}}static deserialize(e,t,n,r,s,{paths:{lines:a,points:l},rotation:u,thickness:d}){const h=[];let p,m,g,v,_;switch(u){case 0:_=Outline._rescale,p=-e/n,m=t/r+1,g=1/n,v=-1/r;break;case 90:_=Outline._rescaleAndSwap,p=-t/r,m=-e/n,g=1/r,v=1/n;break;case 180:_=Outline._rescale,p=e/n+1,m=-t/r,g=-1/n,v=1/r;break;case 270:_=Outline._rescaleAndSwap,p=t/r+1,m=e/n+1,g=-1/r,v=-1/n;break}if(!a){a=[];for(const E of l){const A=E.length;if(A===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,E[0],E[1]]));continue}if(A===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,E[0],E[1],NaN,NaN,NaN,NaN,E[2],E[3]]));continue}const z=new Float32Array(3*(A-2));a.push(z);let[D,P,G,R]=E.subarray(0,4);z.set([NaN,NaN,NaN,NaN,D,P],0);for(let I=4;I<A;I+=2){const w=E[I],H=E[I+1];z.set(Outline.createBezierPoints(D,P,G,R,w,H),(I-2)*3),[D,P,G,R]=[G,R,w,H]}}}for(let E=0,A=a.length;E<A;E++)h.push({line:_(a[E].map(z=>z??NaN),p,m,g,v),points:_(l[E].map(z=>z??NaN),p,m,g,v)});const b=new this.prototype.constructor;return b.build(h,n,r,1,u,d,s),b}#c(e=this.#l){const t=this.#i+e/2*this.#o;return this.#s%180===0?[t/this.#r,t/this.#a]:[t/this.#a,t/this.#r]}#h(){const[e,t,n,r]=this.#e,[s,a]=this.#c(0);return[e+s,t+a,n-2*s,r-2*a]}#d(){const e=this.#e=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:r}of this.#n){if(r.length<=12){for(let l=4,u=r.length;l<u;l+=6)Util.pointBoundingBox(r[l],r[l+1],e);continue}let s=r[4],a=r[5];for(let l=6,u=r.length;l<u;l+=6){const[d,h,p,m,g,v]=r.subarray(l,l+6);Util.bezierBoundingBox(s,a,d,h,p,m,g,v,e),s=g,a=v}}const[t,n]=this.#c();e[0]=MathClamp(e[0]-t,0,1),e[1]=MathClamp(e[1]-n,0,1),e[2]=MathClamp(e[2]+t,0,1),e[3]=MathClamp(e[3]+n,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#e}updateProperty(e,t){return e==="stroke-width"?this.#f(t):null}#f(e){const[t,n]=this.#c();this.#l=e;const[r,s]=this.#c(),[a,l]=[r-t,s-n],u=this.#e;return u[0]-=a,u[1]-=l,u[2]+=2*a,u[3]+=2*l,u}updateParentDimensions([e,t],n){const[r,s]=this.#c();this.#r=e,this.#a=t,this.#o=n;const[a,l]=this.#c(),u=a-r,d=l-s,h=this.#e;return h[0]-=u,h[1]-=d,h[2]+=2*u,h[3]+=2*d,h}updateRotation(e){return this.#t=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#e.map(Outline.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#e;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Outline.svgRound(e)} ${Outline.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#e;let n=0,r=0,s=0,a=0,l=0,u=0;switch(this.#t){case 90:r=t/e,s=-e/t,l=e;break;case 180:n=-1,a=-1,l=e,u=t;break;case 270:r=-t/e,s=e/t,u=t;break;default:return""}return`matrix(${n} ${r} ${s} ${a} ${Outline.svgRound(l)} ${Outline.svgRound(u)})`}getPathResizingSVGProperties([e,t,n,r]){const[s,a]=this.#c(),[l,u,d,h]=this.#e;if(Math.abs(d-s)<=Outline.PRECISION||Math.abs(h-a)<=Outline.PRECISION){const _=e+n/2-(l+d/2),b=t+r/2-(u+h/2);return{path:{"transform-origin":`${Outline.svgRound(e)} ${Outline.svgRound(t)}`,transform:`${this.rotationTransform} translate(${_} ${b})`}}}const p=(n-2*s)/(d-2*s),m=(r-2*a)/(h-2*a),g=d/n,v=h/r;return{path:{"transform-origin":`${Outline.svgRound(l)} ${Outline.svgRound(u)}`,transform:`${this.rotationTransform} scale(${g} ${v}) translate(${Outline.svgRound(s)} ${Outline.svgRound(a)}) scale(${p} ${m}) translate(${Outline.svgRound(-s)} ${Outline.svgRound(-a)})`}}}getPathResizedSVGProperties([e,t,n,r]){const[s,a]=this.#c(),l=this.#e,[u,d,h,p]=l;if(l[0]=e,l[1]=t,l[2]=n,l[3]=r,Math.abs(h-s)<=Outline.PRECISION||Math.abs(p-a)<=Outline.PRECISION){const b=e+n/2-(u+h/2),E=t+r/2-(d+p/2);for(const{line:A,points:z}of this.#n)Outline._translate(A,b,E,A),Outline._translate(z,b,E,z);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Outline.svgRound(e)} ${Outline.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const m=(n-2*s)/(h-2*s),g=(r-2*a)/(p-2*a),v=-m*(u+s)+e+s,_=-g*(d+a)+t+a;if(m!==1||g!==1||v!==0||_!==0)for(const{line:b,points:E}of this.#n)Outline._rescale(b,v,_,m,g,b),Outline._rescale(E,v,_,m,g,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Outline.svgRound(e)} ${Outline.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],n){const[r,s]=n,a=this.#e,l=e-a[0],u=t-a[1];if(this.#r===r&&this.#a===s)for(const{line:d,points:h}of this.#n)Outline._translate(d,l,u,d),Outline._translate(h,l,u,h);else{const d=this.#r/r,h=this.#a/s;this.#r=r,this.#a=s;for(const{line:p,points:m}of this.#n)Outline._rescale(p,l,u,d,h,p),Outline._rescale(m,l,u,d,h,m);a[2]*=d,a[3]*=h}return a[0]=e,a[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Outline.svgRound(e)} ${Outline.svgRound(t)}`}}}get defaultSVGProperties(){const e=this.#e;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Outline.svgRound(e[0])} ${Outline.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class InkDrawingOptions extends DrawingOptions{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:AnnotationEditor._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new InkDrawingOptions(this._viewParameters);return e.updateAll(this),e}}class InkEditor extends DrawingEditor{static _type="ink";static _editorType=AnnotationEditorType.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,t){AnnotationEditor.initialize(e,t),this._defaultDrawingOptions=new InkDrawingOptions(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return shadow(this,"typesMap",new Map([[AnnotationEditorParamsType.INK_THICKNESS,"stroke-width"],[AnnotationEditorParamsType.INK_COLOR,"stroke"],[AnnotationEditorParamsType.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,n,r,s){return new InkDrawOutliner(e,t,n,r,s,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,n,r,s,a){return InkDrawOutline.deserialize(e,t,n,r,s,a)}static async deserialize(e,t,n){let r=null;if(e instanceof InkAnnotationElement){const{data:{inkLists:a,rect:l,rotation:u,id:d,color:h,opacity:p,borderStyle:{rawWidth:m},popupRef:g,richText:v,contentsObj:_,creationDate:b,modificationDate:E},parent:{page:{pageNumber:A}}}=e;r=e={annotationType:AnnotationEditorType.INK,color:Array.from(h),thickness:m,opacity:p,paths:{points:a},boxes:null,pageIndex:A-1,rect:l.slice(0),rotation:u,annotationElementId:d,id:d,deleted:!1,popupRef:g,richText:v,comment:_?.str||null,creationDate:b,modificationDate:E}}const s=await super.deserialize(e,t,n);return s._initialData=r,e.comment&&s.setCommentData(e),s}get toolbarButtons(){return this._colorPicker||=new BasicColorPicker(this),[["colorPicker",this._colorPicker]]}get colorType(){return AnnotationEditorParamsType.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:n}=this;t.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:n}){this._drawingOptions=InkEditor.getDefaultDrawingOptions({stroke:Util.makeHexColor(...e),"stroke-width":t,"stroke-opacity":n})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:n}=this.serializeDraw(e),{_drawingOptions:{stroke:r,"stroke-opacity":s,"stroke-width":a}}=this,l=Object.assign(super.serialize(e),{color:AnnotationEditor._colorManager.convert(r),opacity:s,thickness:a,paths:{lines:t,points:n}});return this.addComment(l),e?(l.isCopy=!0,l):this.annotationElementId&&!this.#e(l)?null:(l.id=this.annotationElementId,l)}#e(e){const{color:t,thickness:n,opacity:r,pageIndex:s}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((a,l)=>a!==t[l])||e.thickness!==n||e.opacity!==r||e.pageIndex!==s}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;const{points:t,rect:n}=this.serializeDraw(!1);return e.updateEdited({rect:n,thickness:this._drawingOptions["stroke-width"],points:t,popup:this.comment}),null}}class ContourDrawOutline extends InkDrawOutline{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const BASE_HEADER_LENGTH=8,POINTS_PROPERTIES_NUMBER=3;class SignatureExtractor{static#e={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#t(e,t,n,r){return n-=e,r-=t,n===0?r>0?0:4:n===1?r+6:2-r}static#i=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#n(e,t,n,r,s,a,l){const u=this.#t(n,r,s,a);for(let d=0;d<8;d++){const h=(-d+u-l+16)%8,p=this.#i[2*h],m=this.#i[2*h+1];if(e[(n+p)*t+(r+m)]!==0)return h}return-1}static#r(e,t,n,r,s,a,l){const u=this.#t(n,r,s,a);for(let d=0;d<8;d++){const h=(d+u+l+16)%8,p=this.#i[2*h],m=this.#i[2*h+1];if(e[(n+p)*t+(r+m)]!==0)return h}return-1}static#a(e,t,n,r){const s=e.length,a=new Int32Array(s);for(let h=0;h<s;h++)a[h]=e[h]<=r?1:0;for(let h=1;h<n-1;h++)a[h*t]=a[h*t+t-1]=0;for(let h=0;h<t;h++)a[h]=a[t*n-1-h]=0;let l=1,u;const d=[];for(let h=1;h<n-1;h++){u=1;for(let p=1;p<t-1;p++){const m=h*t+p,g=a[m];if(g===0)continue;let v=h,_=p;if(g===1&&a[m-1]===0)l+=1,_-=1;else if(g>=1&&a[m+1]===0)l+=1,_+=1,g>1&&(u=g);else{g!==1&&(u=Math.abs(g));continue}const b=[p,h],E=_===p+1,A={isHole:E,points:b,id:l,parent:0};d.push(A);let z;for(const V of d)if(V.id===u){z=V;break}z?z.isHole?A.parent=E?z.parent:u:A.parent=E?u:z.parent:A.parent=E?u:0;const D=this.#n(a,t,h,p,v,_,0);if(D===-1){a[m]=-l,a[m]!==1&&(u=Math.abs(a[m]));continue}let P=this.#i[2*D],G=this.#i[2*D+1];const R=h+P,I=p+G;v=R,_=I;let w=h,H=p;for(;;){const V=this.#r(a,t,w,H,v,_,1);P=this.#i[2*V],G=this.#i[2*V+1];const te=w+P,ae=H+G;b.push(ae,te);const be=w*t+H;if(a[be+1]===0?a[be]=-l:a[be]===1&&(a[be]=l),te===h&&ae===p&&w===R&&H===I){a[m]!==1&&(u=Math.abs(a[m]));break}else v=w,_=H,w=te,H=ae}}}return d}static#o(e,t,n,r){if(n-t<=4){for(let R=t;R<n-2;R+=2)r.push(e[R],e[R+1]);return}const s=e[t],a=e[t+1],l=e[n-4]-s,u=e[n-3]-a,d=Math.hypot(l,u),h=l/d,p=u/d,m=h*a-p*s,g=u/l,v=1/d,_=Math.atan(g),b=Math.cos(_),E=Math.sin(_),A=v*(Math.abs(b)+Math.abs(E)),z=v*(1-A+A**2),D=Math.max(Math.atan(Math.abs(E+b)*z),Math.atan(Math.abs(E-b)*z));let P=0,G=t;for(let R=t+2;R<n-2;R+=2){const I=Math.abs(m-h*e[R+1]+p*e[R]);I>P&&(G=R,P=I)}P>(d*D)**2?(this.#o(e,t,G+2,r),this.#o(e,G,n,r)):r.push(s,a)}static#s(e){const t=[],n=e.length;return this.#o(e,0,n,t),t.push(e[n-2],e[n-1]),t.length<=4?null:t}static#l(e,t,n,r,s,a){const l=new Float32Array(a**2),u=-2*r**2,d=a>>1;for(let _=0;_<a;_++){const b=(_-d)**2;for(let E=0;E<a;E++)l[_*a+E]=Math.exp((b+(E-d)**2)/u)}const h=new Float32Array(256),p=-2*s**2;for(let _=0;_<256;_++)h[_]=Math.exp(_**2/p);const m=e.length,g=new Uint8Array(m),v=new Uint32Array(256);for(let _=0;_<n;_++)for(let b=0;b<t;b++){const E=_*t+b,A=e[E];let z=0,D=0;for(let G=0;G<a;G++){const R=_+G-d;if(!(R<0||R>=n))for(let I=0;I<a;I++){const w=b+I-d;if(w<0||w>=t)continue;const H=e[R*t+w],V=l[G*a+I]*h[Math.abs(H-A)];z+=H*V,D+=V}}const P=g[E]=Math.round(z/D);v[P]++}return[g,v]}static#c(e){const t=new Uint32Array(256);for(const n of e)t[n]++;return t}static#h(e){const t=e.length,n=new Uint8ClampedArray(t>>2);let r=-1/0,s=1/0;for(let l=0,u=n.length;l<u;l++){const d=n[l]=e[l<<2];r=Math.max(r,d),s=Math.min(s,d)}const a=255/(r-s);for(let l=0,u=n.length;l<u;l++)n[l]=(n[l]-s)*a;return n}static#d(e){let t,n=-1/0,r=-1/0;const s=e.findIndex(u=>u!==0);let a=s,l=s;for(t=s;t<256;t++){const u=e[t];u>n&&(t-a>r&&(r=t-a,l=t-1),n=u,a=t)}for(t=l-1;t>=0&&!(e[t]>e[t+1]);t--);return t}static#f(e){const t=e,{width:n,height:r}=e,{maxDim:s}=this.#e;let a=n,l=r;if(n>s||r>s){let m=n,g=r,v=Math.log2(Math.max(n,r)/s);const _=Math.floor(v);v=v===_?_-1:_;for(let E=0;E<v;E++){a=Math.ceil(m/2),l=Math.ceil(g/2);const A=new OffscreenCanvas(a,l);A.getContext("2d").drawImage(e,0,0,m,g,0,0,a,l),m=a,g=l,e!==t&&e.close(),e=A.transferToImageBitmap()}const b=Math.min(s/a,s/l);a=Math.round(a*b),l=Math.round(l*b)}const d=new OffscreenCanvas(a,l).getContext("2d",{willReadFrequently:!0});d.fillStyle="white",d.fillRect(0,0,a,l),d.filter="grayscale(1)",d.drawImage(e,0,0,e.width,e.height,0,0,a,l);const h=d.getImageData(0,0,a,l).data;return[this.#h(h),a,l]}static extractContoursFromText(e,{fontFamily:t,fontStyle:n,fontWeight:r},s,a,l,u){let d=new OffscreenCanvas(1,1),h=d.getContext("2d",{alpha:!1});const p=200,m=h.font=`${n} ${r} ${p}px ${t}`,{actualBoundingBoxLeft:g,actualBoundingBoxRight:v,actualBoundingBoxAscent:_,actualBoundingBoxDescent:b,fontBoundingBoxAscent:E,fontBoundingBoxDescent:A,width:z}=h.measureText(e),D=1.5,P=Math.ceil(Math.max(Math.abs(g)+Math.abs(v)||0,z)*D),G=Math.ceil(Math.max(Math.abs(_)+Math.abs(b)||p,Math.abs(E)+Math.abs(A)||p)*D);d=new OffscreenCanvas(P,G),h=d.getContext("2d",{alpha:!0,willReadFrequently:!0}),h.font=m,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,P,G),h.fillStyle="black",h.fillText(e,P*(D-1)/2,G*(3-D)/2);const R=this.#h(h.getImageData(0,0,P,G).data),I=this.#c(R),w=this.#d(I),H=this.#a(R,P,G,w);return this.processDrawnLines({lines:{curves:H,width:P,height:G},pageWidth:s,pageHeight:a,rotation:l,innerMargin:u,mustSmooth:!0,areContours:!0})}static process(e,t,n,r,s){const[a,l,u]=this.#f(e),[d,h]=this.#l(a,l,u,Math.hypot(l,u)*this.#e.sigmaSFactor,this.#e.sigmaR,this.#e.kernelSize),p=this.#d(h),m=this.#a(d,l,u,p);return this.processDrawnLines({lines:{curves:m,width:l,height:u},pageWidth:t,pageHeight:n,rotation:r,innerMargin:s,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:r,innerMargin:s,mustSmooth:a,areContours:l}){r%180!==0&&([t,n]=[n,t]);const{curves:u,width:d,height:h}=e,p=e.thickness??0,m=[],g=Math.min(t/d,n/h),v=g/t,_=g/n,b=[];for(const{points:A}of u){const z=a?this.#s(A):A;if(!z)continue;b.push(z);const D=z.length,P=new Float32Array(D),G=new Float32Array(3*(D===2?2:D-2));if(m.push({line:G,points:P}),D===2){P[0]=z[0]*v,P[1]=z[1]*_,G.set([NaN,NaN,NaN,NaN,P[0],P[1]],0);continue}let[R,I,w,H]=z;R*=v,I*=_,w*=v,H*=_,P.set([R,I,w,H],0),G.set([NaN,NaN,NaN,NaN,R,I],0);for(let V=4;V<D;V+=2){const te=P[V]=z[V]*v,ae=P[V+1]=z[V+1]*_;G.set(Outline.createBezierPoints(R,I,w,H,te,ae),(V-2)*3),[R,I,w,H]=[w,H,te,ae]}}if(m.length===0)return null;const E=l?new ContourDrawOutline:new InkDrawOutline;return E.build(m,t,n,1,r,l?0:p,s),{outline:E,newCurves:b,areContours:l,thickness:p,width:d,height:h}}static async compressSignature({outlines:e,areContours:t,thickness:n,width:r,height:s}){let a=1/0,l=-1/0,u=0;for(const z of e){u+=z.length;for(let D=2,P=z.length;D<P;D++){const G=z[D]-z[D-2];a=Math.min(a,G),l=Math.max(l,G)}}let d;a>=-128&&l<=127?d=Int8Array:a>=-32768&&l<=32767?d=Int16Array:d=Int32Array;const h=e.length,p=BASE_HEADER_LENGTH+POINTS_PROPERTIES_NUMBER*h,m=new Uint32Array(p);let g=0;m[g++]=p*Uint32Array.BYTES_PER_ELEMENT+(u-2*h)*d.BYTES_PER_ELEMENT,m[g++]=0,m[g++]=r,m[g++]=s,m[g++]=t?0:1,m[g++]=Math.max(0,Math.floor(n??0)),m[g++]=h,m[g++]=d.BYTES_PER_ELEMENT;for(const z of e)m[g++]=z.length-2,m[g++]=z[0],m[g++]=z[1];const v=new CompressionStream("deflate-raw"),_=v.writable.getWriter();await _.ready,_.write(m);const b=d.prototype.constructor;for(const z of e){const D=new b(z.length-2);for(let P=2,G=z.length;P<G;P++)D[P-2]=z[P]-z[P-2];_.write(D)}_.close();const E=await new Response(v.readable).arrayBuffer(),A=new Uint8Array(E);return toBase64Util(A)}static async decompressSignature(e){try{const t=fromBase64Util(e),{readable:n,writable:r}=new DecompressionStream("deflate-raw"),s=r.getWriter();await s.ready,s.write(t).then(async()=>{await s.ready,await s.close()}).catch(()=>{});let a=null,l=0;for await(const z of n)a||=new Uint8Array(new Uint32Array(z.buffer,0,4)[0]),a.set(z,l),l+=z.length;const u=new Uint32Array(a.buffer,0,a.length>>2),d=u[1];if(d!==0)throw new Error(`Invalid version: ${d}`);const h=u[2],p=u[3],m=u[4]===0,g=u[5],v=u[6],_=u[7],b=[],E=(BASE_HEADER_LENGTH+POINTS_PROPERTIES_NUMBER*v)*Uint32Array.BYTES_PER_ELEMENT;let A;switch(_){case Int8Array.BYTES_PER_ELEMENT:A=new Int8Array(a.buffer,E);break;case Int16Array.BYTES_PER_ELEMENT:A=new Int16Array(a.buffer,E);break;case Int32Array.BYTES_PER_ELEMENT:A=new Int32Array(a.buffer,E);break}l=0;for(let z=0;z<v;z++){const D=u[POINTS_PROPERTIES_NUMBER*z+BASE_HEADER_LENGTH],P=new Float32Array(D+2);b.push(P);for(let G=0;G<POINTS_PROPERTIES_NUMBER-1;G++)P[G]=u[POINTS_PROPERTIES_NUMBER*z+BASE_HEADER_LENGTH+G+1];for(let G=0;G<D;G++)P[G+2]=P[G]+A[l++]}return{areContours:m,thickness:g,outlines:b,width:h,height:p}}catch(t){return warn(`decompressSignature: ${t}`),null}}}class SignatureOptions extends DrawingOptions{constructor(){super(),super.updateProperties({fill:AnnotationEditor._defaultLineColor,"stroke-width":0})}clone(){const e=new SignatureOptions;return e.updateAll(this),e}}class DrawnSignatureOptions extends InkDrawingOptions{constructor(e){super(e),super.updateProperties({stroke:AnnotationEditor._defaultLineColor,"stroke-width":1})}clone(){const e=new DrawnSignatureOptions(this._viewParameters);return e.updateAll(this),e}}class SignatureEditor extends DrawingEditor{#e=!1;#t=null;#i=null;#n=null;static _type="signature";static _editorType=AnnotationEditorType.SIGNATURE;static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#i=e.signatureData||null,this.#t=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,t){AnnotationEditor.initialize(e,t),this._defaultDrawingOptions=new SignatureOptions,this._defaultDrawnSignatureOptions=new DrawnSignatureOptions(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!1}static get typesMap(){return shadow(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#t}}static computeTelemetryFinalData(e){const t=e.get("hasDescription");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,t;const{_isCopy:n}=this;if(n&&(this._isCopy=!1,e=this.x,t=this.y),super.render(),this._drawId===null)if(this.#i){const{lines:r,mustSmooth:s,areContours:a,description:l,uuid:u,heightInPage:d}=this.#i,{rawDims:{pageWidth:h,pageHeight:p},rotation:m}=this.parent.viewport,g=SignatureExtractor.processDrawnLines({lines:r,pageWidth:h,pageHeight:p,rotation:m,innerMargin:SignatureEditor._INNER_MARGIN,mustSmooth:s,areContours:a});this.addSignature(g,d,l,u)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#t||""}));return n&&(this._isCopy=!0,this._moveAfterPaste(e,t)),this.div}setUuid(e){this.#n=e,this.addEditToolbar()}getUuid(){return this.#n}get description(){return this.#t}set description(e){this.#t=e,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(t=>{t?.updateEditSignatureButton(e)}))}getSignaturePreview(){const{newCurves:e,areContours:t,thickness:n,width:r,height:s}=this.#i,a=Math.max(r,s),l=SignatureExtractor.processDrawnLines({lines:{curves:e.map(u=>({points:u})),thickness:n,width:r,height:s},pageWidth:a,pageHeight:a,rotation:0,innerMargin:0,mustSmooth:!1,areContours:t});return{areContours:t,outline:l.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,t,n,r){const{x:s,y:a}=this,{outline:l}=this.#i=e;this.#e=l instanceof ContourDrawOutline,this.description=n;let u;this.#e?u=SignatureEditor.getDefaultDrawingOptions():(u=SignatureEditor._defaultDrawnSignatureOptions.clone(),u.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:u});const[,d]=this.pageDimensions;let h=t/d;h=h>=1?.5:h,this.width*=h/this.height,this.width>=1&&(h*=.9/this.width,this.width=.9),this.height=h,this.setDims(),this.x=s,this.y=a,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!n}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:t,pageHeight:n},rotation:r}=this.parent.viewport;return SignatureExtractor.process(e,t,n,r,SignatureEditor._INNER_MARGIN)}getFromText(e,t){const{rawDims:{pageWidth:n,pageHeight:r},rotation:s}=this.parent.viewport;return SignatureExtractor.extractContoursFromText(e,t,n,r,s,SignatureEditor._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:t,pageHeight:n},rotation:r}=this.parent.viewport;return SignatureExtractor.processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:r,innerMargin:SignatureEditor._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:t}){e?this._drawingOptions=SignatureEditor.getDefaultDrawingOptions():(this._drawingOptions=SignatureEditor._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":t}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:t,points:n}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":r}}=this,s=Object.assign(super.serialize(e),{isSignature:!0,areContours:this.#e,color:[0,0,0],thickness:this.#e?0:r});return this.addComment(s),e?(s.paths={lines:t,points:n},s.uuid=this.#n,s.isCopy=!0):s.lines=t,this.#t&&(s.accessibilityData={type:"Figure",alt:this.#t}),s}static deserializeDraw(e,t,n,r,s,a){return a.areContours?ContourDrawOutline.deserialize(e,t,n,r,s,a):InkDrawOutline.deserialize(e,t,n,r,s,a)}static async deserialize(e,t,n){const r=await super.deserialize(e,t,n);return r.#e=e.areContours,r.description=e.accessibilityData?.alt||"",r.#n=e.uuid,r}}class StampEditor extends AnnotationEditor{#e=null;#t=null;#i=null;#n=null;#r=null;#a="";#o=null;#s=!1;#l=null;#c=!1;#h=!1;static _type="stamp";static _editorType=AnnotationEditorType.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#n=e.bitmapUrl,this.#r=e.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,t){AnnotationEditor.initialize(e,t)}static isHandlingMimeForPasting(e){return SupportedImageMimeTypes.includes(e)}static paste(e,t){t.pasteEditor({mode:AnnotationEditorType.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#d(e,t=!1){if(!e){this.remove();return}this.#e=e.bitmap,t||(this.#t=e.id,this.#c=e.isSvg),e.file&&(this.#a=e.file.name),this.#p()}#f(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#o){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(e=null,t=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:s,height:a}=e||this.copyCanvas(null,null,!0).imageData,l=await n.guess({name:"altText",request:{data:r,width:s,height:a,channels:r.length/(s*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const u=l.output;return await this.setGuessedAltText(u),t&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),u}#g(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(n=>this.#d(n,!0)).finally(()=>this.#f());return}if(this.#n){const n=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(n).then(r=>this.#d(r)).finally(()=>this.#f());return}if(this.#r){const n=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(n).then(r=>this.#d(r)).finally(()=>this.#f());return}const e=document.createElement("input");e.type="file",e.accept=SupportedImageMimeTypes.join(",");const t=this._uiManager._signal;this.#i=new Promise(n=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#d(r)}n()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),n()},{signal:t})}).finally(()=>this.#f()),e.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#o?.remove(),this.#o=null,this.#l&&(clearTimeout(this.#l),this.#l=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#g();return}super.rebuild(),this.div!==null&&(this.#t&&this.#o===null&&this.#g(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#i||this.#e||this.#n||this.#r||this.#t||this.#s)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;return this._isCopy&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#s||(this.#e?this.#p():this.#g()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,t){const{id:n,bitmap:r}=this._uiManager.imageManager.getFromCanvas(e,t);t.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#t=n,r&&(this.#e=r),this.#s=!1,this.#p())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#l!==null&&clearTimeout(this.#l);const e=200;this.#l=setTimeout(()=>{this.#l=null,this.#m()},e)}#p(){const{div:e}=this;let{width:t,height:n}=this.#e;const[r,s]=this.pageDimensions,a=.75;if(this.width)t=this.width*r,n=this.height*s;else if(t>a*r||n>a*s){const u=Math.min(a*r/t,a*s/n);t*=u,n*=u}this._uiManager.enableWaiting(!1);const l=this.#o=document.createElement("canvas");l.setAttribute("role","img"),this.addContainer(l),this.width=t/r,this.height=n/s,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#m(),this.#h||(this.parent.addUndoableEditor(this),this.#h=!0),this._reportTelemetry({action:"inserted_image"}),this.#a&&this.div.setAttribute("aria-description",this.#a),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(e,t,n=!1){e||(e=224);const{width:r,height:s}=this.#e,a=new OutputScale;let l=this.#e,u=r,d=s,h=null;if(t){if(r>t||s>t){const G=Math.min(t/r,t/s);u=Math.floor(r*G),d=Math.floor(s*G)}h=document.createElement("canvas");const m=h.width=Math.ceil(u*a.sx),g=h.height=Math.ceil(d*a.sy);this.#c||(l=this.#u(m,g));const v=h.getContext("2d");v.filter=this._uiManager.hcmFilter;let _="white",b="#cfcfd8";this._uiManager.hcmFilter!=="none"?b="black":ColorScheme.isDarkMode&&(_="#8f8f9d",b="#42414d");const E=15,A=E*a.sx,z=E*a.sy,D=new OffscreenCanvas(A*2,z*2),P=D.getContext("2d");P.fillStyle=_,P.fillRect(0,0,A*2,z*2),P.fillStyle=b,P.fillRect(0,0,A,z),P.fillRect(A,z,A,z),v.fillStyle=v.createPattern(D,"repeat"),v.fillRect(0,0,m,g),v.drawImage(l,0,0,l.width,l.height,0,0,m,g)}let p=null;if(n){let m,g;if(a.symmetric&&l.width<e&&l.height<e)m=l.width,g=l.height;else if(l=this.#e,r>e||s>e){const b=Math.min(e/r,e/s);m=Math.floor(r*b),g=Math.floor(s*b),this.#c||(l=this.#u(m,g))}const _=new OffscreenCanvas(m,g).getContext("2d",{willReadFrequently:!0});_.drawImage(l,0,0,l.width,l.height,0,0,m,g),p={width:m,height:g,data:_.getImageData(0,0,m,g).data}}return{canvas:h,width:u,height:d,imageData:p}}#u(e,t){const{width:n,height:r}=this.#e;let s=n,a=r,l=this.#e;for(;s>2*e||a>2*t;){const u=s,d=a;s>2*e&&(s=s>=16384?Math.floor(s/2)-1:Math.ceil(s/2)),a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const h=new OffscreenCanvas(s,a);h.getContext("2d").drawImage(l,0,0,u,d,0,0,s,a),l=h.transferToImageBitmap()}return l}#m(){const[e,t]=this.parentDimensions,{width:n,height:r}=this,s=new OutputScale,a=Math.ceil(n*e*s.sx),l=Math.ceil(r*t*s.sy),u=this.#o;if(!u||u.width===a&&u.height===l)return;u.width=a,u.height=l;const d=this.#c?this.#e:this.#u(a,l),h=u.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(d,0,0,d.width,d.height,0,0,a,l)}#y(e){if(e){if(this.#c){const r=this._uiManager.imageManager.getSvgUrl(this.#t);if(r)return r}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#e,t.getContext("2d").drawImage(this.#e,0,0),t.toDataURL()}if(this.#c){const[t,n]=this.pageDimensions,r=Math.round(this.width*t*PixelsPerInch.PDF_TO_CSS_UNITS),s=Math.round(this.height*n*PixelsPerInch.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(r,s);return a.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,r,s),a.transferToImageBitmap()}return structuredClone(this.#e)}static async deserialize(e,t,n){let r=null,s=!1;if(e instanceof StampAnnotationElement){const{data:{rect:_,rotation:b,id:E,structParent:A,popupRef:z,richText:D,contentsObj:P,creationDate:G,modificationDate:R},container:I,parent:{page:{pageNumber:w}},canvas:H}=e;let V,te;H?(delete e.canvas,{id:V,bitmap:te}=n.imageManager.getFromCanvas(I.id,H),H.remove()):(s=!0,e._hasNoCanvas=!0);const ae=(await t._structTree.getAriaAttributes(`${AnnotationPrefix}${E}`))?.get("aria-label")||"";r=e={annotationType:AnnotationEditorType.STAMP,bitmapId:V,bitmap:te,pageIndex:w-1,rect:_.slice(0),rotation:b,annotationElementId:E,id:E,deleted:!1,accessibilityData:{decorative:!1,altText:ae},isSvg:!1,structParent:A,popupRef:z,richText:D,comment:P?.str||null,creationDate:G,modificationDate:R}}const a=await super.deserialize(e,t,n),{rect:l,bitmap:u,bitmapUrl:d,bitmapId:h,isSvg:p,accessibilityData:m}=e;s?(n.addMissingCanvas(e.id,a),a.#s=!0):h&&n.imageManager.isValidId(h)?(a.#t=h,u&&(a.#e=u)):a.#n=d,a.#c=p;const[g,v]=a.pageDimensions;return a.width=(l[2]-l[0])/g,a.height=(l[3]-l[1])/v,m&&(a.altTextData=m),a._initialData=r,e.comment&&a.setCommentData(e),a.#h=!!r,a}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=Object.assign(super.serialize(e),{bitmapId:this.#t,isSvg:this.#c});if(this.addComment(n),e)return n.bitmapUrl=this.#y(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;const{decorative:r,altText:s}=this.serializeAltText(!1);if(!r&&s&&(n.accessibilityData={type:"Figure",alt:s}),this.annotationElementId){const l=this.#b(n);return l.isSame?null:(l.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1,n.id=this.annotationElementId,delete n.bitmapId,n)}if(t===null)return n;t.stamps||=new Map;const a=this.#c?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!t.stamps.has(this.#t))t.stamps.set(this.#t,{area:a,serialized:n}),n.bitmap=this.#y(!1);else if(this.#c){const l=t.stamps.get(this.#t);a>l.area&&(l.area=a,l.serialized.bitmap.close(),l.serialized.bitmap=this.#y(!1))}return n}#b(e){const{pageIndex:t,accessibilityData:{altText:n}}=this._initialData,r=e.pageIndex===t,s=(e.accessibilityData?.alt||"")===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&s,isSameAltText:s}}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class AnnotationEditorLayer{#e;#t=!1;#i=null;#n=null;#r=null;#a=new Map;#o=!1;#s=!1;#l=!1;#c=null;#h=null;#d=null;#f=null;#g=null;#p=-1;#u;static _initialized=!1;static#m=new Map([FreeTextEditor,InkEditor,StampEditor,HighlightEditor,SignatureEditor].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:r,accessibilityManager:s,annotationLayer:a,drawLayer:l,textLayer:u,viewport:d,l10n:h}){const p=[...AnnotationEditorLayer.#m.values()];if(!AnnotationEditorLayer._initialized){AnnotationEditorLayer._initialized=!0;for(const m of p)m.initialize(h,e)}e.registerEditorTypes(p),this.#u=e,this.pageIndex=t,this.div=n,this.#e=s,this.#i=a,this.viewport=d,this.#d=u,this.drawLayer=l,this._structTree=r,this.#u.addLayer(this)}get isEmpty(){return this.#a.size===0}get isInvisible(){return this.isEmpty&&this.#u.getMode()===AnnotationEditorType.NONE}updateToolbar(e){this.#u.updateToolbar(e)}updateMode(e=this.#u.getMode()){switch(this.#_(),e){case AnnotationEditorType.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case AnnotationEditorType.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case AnnotationEditorType.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===AnnotationEditorType.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const n of AnnotationEditorLayer.#m.values())t.toggle(`${n._type}Editing`,e===n._editorType)}this.div.hidden=!1}hasTextLayer(e){return e===this.#d?.div}setEditingState(e){this.#u.setEditingState(e)}addCommands(e){this.#u.addCommands(e)}cleanUndoStack(e){this.#u.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#i?.div.classList.toggle("disabled",!e)}get#y(){return this.#a.size!==0?this.#a.values():this.#u.getEditors(this.pageIndex)}async enable(){this.#l=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#g?.abort(),this.#g=null;const e=new Set;for(const n of this.#y)n.enableEditing(),n.show(!0),n.annotationElementId&&(this.#u.removeChangedExistingAnnotation(n),e.add(n.annotationElementId));const t=this.#i;if(t)for(const n of t.getEditableAnnotations()){if(n.hide(),this.#u.isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;const r=await this.deserialize(n);r&&(this.addOrRebuild(r),r.enableEditing())}this.#l=!1,this.#u._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#s=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#d&&!this.#g){this.#g=new AbortController;const n=this.#u.combinedSignal(this.#g);this.#d.div.addEventListener("pointerdown",r=>{const{clientX:a,clientY:l,timeStamp:u}=r,d=this.#p;if(u-d>500){this.#p=u;return}this.#p=-1;const{classList:h}=this.div;h.toggle("getElements",!0);const p=document.elementsFromPoint(a,l);if(h.toggle("getElements",!1),!this.div.contains(p[0]))return;let m;const g=new RegExp(`^${AnnotationEditorPrefix}[0-9]+$`);for(const _ of p)if(g.test(_.id)){m=_.id;break}if(!m)return;const v=this.#a.get(m);v?.annotationElementId===null&&(r.stopPropagation(),r.preventDefault(),v.dblclick(r))},{signal:n,capture:!0})}const e=this.#i;if(e){const n=new Map,r=new Map;for(const a of this.#y){if(a.disableEditing(),!a.annotationElementId){a.updateFakeAnnotationElement(e);continue}if(a.serialize()!==null){n.set(a.annotationElementId,a);continue}else r.set(a.annotationElementId,a);this.getEditableAnnotation(a.annotationElementId)?.show(),a.remove()}const s=e.getEditableAnnotations();for(const a of s){const{id:l}=a.data;if(this.#u.isDeletedAnnotationElement(l)){a.updateEdited({deleted:!0});continue}let u=r.get(l);if(u){u.resetAnnotationElement(a),u.show(!1),a.show();continue}u=n.get(l),u&&(this.#u.addChangedExistingAnnotation(u),u.renderAnnotationElement(a)&&u.show(!1)),a.show()}}this.#_(),this.isEmpty&&(this.div.hidden=!0);const{classList:t}=this.div;for(const n of AnnotationEditorLayer.#m.values())t.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#s=!1}getEditableAnnotation(e){return this.#i?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#u.getActive()!==e&&this.#u.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#d?.div&&!this.#f){this.#f=new AbortController;const e=this.#u.combinedSignal(this.#f);this.#d.div.addEventListener("pointerdown",this.#b.bind(this),{signal:e}),this.#d.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#d?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#d.div.classList.remove("highlighting"))}#b(e){this.#u.unselectAll();const{target:t}=e;if(t===this.#d.div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&this.#d.div.contains(t)){const{isMac:n}=util_FeatureTest.platform;if(e.button!==0||e.ctrlKey&&n)return;this.#u.showAllEditors("highlight",!0,!0),this.#d.div.classList.add("free"),this.toggleDrawing(),HighlightEditor.startHighlighting(this,this.#u.direction==="ltr",{target:this.#d.div,x:e.x,y:e.y}),this.#d.div.addEventListener("pointerup",()=>{this.#d.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#u._signal}),e.preventDefault()}}enableClick(){if(this.#n)return;this.#n=new AbortController;const e=this.#u.combinedSignal(this.#n);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){this.#n?.abort(),this.#n=null}attach(e){this.#a.set(e.id,e);const{annotationElementId:t}=e;t&&this.#u.isDeletedAnnotationElement(t)&&this.#u.removeDeletedAnnotationElement(e)}detach(e){this.#a.delete(e.id),this.#e?.removePointerInTextLayer(e.contentDiv),!this.#s&&e.annotationElementId&&this.#u.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#u.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#u.addDeletedAnnotationElement(e.annotationElementId),AnnotationEditor.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#u.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#l),this.#u.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#r&&(e._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#u._signal}),t.focus())},0)),e._structTreeParentId=this.#e?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getEditorByUID(e){for(const t of this.#a.values())if(t.uid===e)return t;return null}getNextId(){return this.#u.getId()}get#v(){return AnnotationEditorLayer.#m.get(this.#u.getMode())}combinedSignal(e){return this.#u.combinedSignal(e)}#w(e){const t=this.#v;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#v?.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await this.#u.updateMode(e.mode);const{offsetX:n,offsetY:r}=this.#x(),s=this.getNextId(),a=this.#w({parent:this,id:s,x:n,y:r,uiManager:this.#u,isCentered:!0,...t});a&&this.add(a)}async deserialize(e){return await AnnotationEditorLayer.#m.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#u)||null}createAndAddNewEditor(e,t,n={}){const r=this.getNextId(),s=this.#w({parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:this.#u,isCentered:t,...n});return s&&this.add(s),s}get boundingClientRect(){return this.div.getBoundingClientRect()}#x(){const{x:e,y:t,width:n,height:r}=this.boundingClientRect,s=Math.max(0,e),a=Math.max(0,t),l=Math.min(window.innerWidth,e+n),u=Math.min(window.innerHeight,t+r),d=(s+l)/2-e,h=(a+u)/2-t,[p,m]=this.viewport.rotation%180===0?[d,h]:[h,d];return{offsetX:p,offsetY:m}}addNewEditor(e={}){this.createAndAddNewEditor(this.#x(),!0,e)}setSelected(e){this.#u.setSelected(e)}toggleSelected(e){this.#u.toggleSelected(e)}unselect(e){this.#u.unselect(e)}pointerup(e){const{isMac:t}=util_FeatureTest.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!this.#o||(this.#o=!1,this.#v?.isDrawer&&this.#v.supportMultipleDrawings))return;if(!this.#t){this.#t=!0;return}const n=this.#u.getMode();if(n===AnnotationEditorType.STAMP||n===AnnotationEditorType.SIGNATURE){this.#u.unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){if(this.#u.getMode()===AnnotationEditorType.HIGHLIGHT&&this.enableTextSelection(),this.#o){this.#o=!1;return}const{isMac:t}=util_FeatureTest.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(this.#o=!0,this.#v?.isDrawer){this.startDrawingSession(e);return}const n=this.#u.getActive();this.#t=!n||n.isEmpty()}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),this.#c){this.#v.startDrawing(this,this.#u,!1,e);return}this.#u.setCurrentDrawingSession(this),this.#c=new AbortController;const t=this.#u.combinedSignal(this.#c);this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(this.#h=null,this.commitOrRemove())},{signal:t}),this.#v.startDrawing(this,this.#u,!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&(this.#h=t);return}this.#h&&setTimeout(()=>{this.#h?.focus(),this.#h=null},0)}endDrawingSession(e=!1){return this.#c?(this.#u.setCurrentDrawingSession(null),this.#c.abort(),this.#c=null,this.#h=null,this.#v.endDrawing(e)):null}findNewParent(e,t,n){const r=this.#u.findParent(t,n);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return this.#c?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#c&&this.#v.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#u.getActive()?.parent===this&&(this.#u.commitOrRemove(),this.#u.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(const e of this.#a.values())this.#e?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#a.clear(),this.#u.removeLayer(this)}#_(){for(const e of this.#a.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,setLayerDimensions(this.div,e);for(const t of this.#u.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){this.#u.commitOrRemove(),this.#_();const t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,setLayerDimensions(this.div,{rotation:n}),t!==n)for(const r of this.#a.values())r.rotate(n)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#u.viewParameters.realScale}}class DrawLayer{#e=null;#t=new Map;#i=new Map;static#n=0;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#e){this.#e=e;return}if(this.#e!==e){if(this.#t.size>0)for(const t of this.#t.values())t.remove(),e.append(t);this.#e=e}}static get _svgFactory(){return shadow(this,"_svgFactory",new DOMSVGFactory)}static#r(e,[t,n,r,s]){const{style:a}=e;a.top=`${100*n}%`,a.left=`${100*t}%`,a.width=`${100*r}%`,a.height=`${100*s}%`}#a(){const e=DrawLayer._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),e}#o(e,t){const n=DrawLayer._svgFactory.createElement("clipPath");e.append(n);const r=`clip_${t}`;n.setAttribute("id",r),n.setAttribute("clipPathUnits","objectBoundingBox");const s=DrawLayer._svgFactory.createElement("use");return n.append(s),s.setAttribute("href",`#${t}`),s.classList.add("clip"),r}#s(e,t){for(const[n,r]of Object.entries(t))r===null?e.removeAttribute(n):e.setAttribute(n,r)}draw(e,t=!1,n=!1){const r=DrawLayer.#n++,s=this.#a(),a=DrawLayer._svgFactory.createElement("defs");s.append(a);const l=DrawLayer._svgFactory.createElement("path");a.append(l);const u=`path_p${this.pageIndex}_${r}`;l.setAttribute("id",u),l.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#i.set(r,l);const d=n?this.#o(a,u):null,h=DrawLayer._svgFactory.createElement("use");return s.append(h),h.setAttribute("href",`#${u}`),this.updateProperties(s,e),this.#t.set(r,s),{id:r,clipPathId:`url(#${d})`}}drawOutline(e,t){const n=DrawLayer.#n++,r=this.#a(),s=DrawLayer._svgFactory.createElement("defs");r.append(s);const a=DrawLayer._svgFactory.createElement("path");s.append(a);const l=`path_p${this.pageIndex}_${n}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke");let u;if(t){const p=DrawLayer._svgFactory.createElement("mask");s.append(p),u=`mask_p${this.pageIndex}_${n}`,p.setAttribute("id",u),p.setAttribute("maskUnits","objectBoundingBox");const m=DrawLayer._svgFactory.createElement("rect");p.append(m),m.setAttribute("width","1"),m.setAttribute("height","1"),m.setAttribute("fill","white");const g=DrawLayer._svgFactory.createElement("use");p.append(g),g.setAttribute("href",`#${l}`),g.setAttribute("stroke","none"),g.setAttribute("fill","black"),g.setAttribute("fill-rule","nonzero"),g.classList.add("mask")}const d=DrawLayer._svgFactory.createElement("use");r.append(d),d.setAttribute("href",`#${l}`),u&&d.setAttribute("mask",`url(#${u})`);const h=d.cloneNode();return r.append(h),d.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(r,e),this.#t.set(n,r),n}finalizeDraw(e,t){this.#i.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:n,bbox:r,rootClass:s,path:a}=t,l=typeof e=="number"?this.#t.get(e):e;if(l){if(n&&this.#s(l,n),r&&DrawLayer.#r(l,r),s){const{classList:u}=l;for(const[d,h]of Object.entries(s))u.toggle(d,h)}if(a){const d=l.firstChild.firstChild;this.#s(d,a)}}}updateParent(e,t){if(t===this)return;const n=this.#t.get(e);n&&(t.#e.append(n),this.#t.delete(e),t.#t.set(e,n))}remove(e){this.#i.delete(e),this.#e!==null&&(this.#t.get(e).remove(),this.#t.delete(e))}destroy(){this.#e=null;for(const e of this.#t.values())e.remove();this.#t.clear(),this.#i.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner};globalThis.pdfjsLib={AbortException,AnnotationEditorLayer,AnnotationEditorParamsType,AnnotationEditorType,AnnotationEditorUIManager,AnnotationLayer,AnnotationMode,AnnotationType,applyOpacity,build,ColorPicker,createValidAbsoluteUrl,CSSConstants,DOMSVGFactory,DrawLayer,FeatureTest:util_FeatureTest,fetchData,findContrastColor,getDocument,getFilenameFromUrl,getPdfFilenameFromUrl,getRGB,getUuid,getXfaPageViewport,GlobalWorkerOptions,ImageKind:util_ImageKind,InvalidPDFException,isDataScheme,isPdfFile,isValidExplicitDest,MathClamp,noContextMenu,normalizeUnicode,OPS,OutputScale,PasswordResponses,PDFDataRangeTransport,PDFDateString,PDFWorker,PermissionFlag,PixelsPerInch,RenderingCancelledException,renderRichText,ResponseException,setLayerDimensions,shadow,SignatureExtractor,stopEvent,SupportedImageMimeTypes,TextLayer,TouchManager,updateUrlHash,Util,VerbosityLevel,version,XfaLayer};GlobalWorkerOptions.workerSrc=`//unpkg.com/pdfjs-dist@${version}/build/pdf.worker.min.mjs`;const SubjectChapters=()=>{const{batchId:i,subjectName:e}=useParams(),t=useNavigate(),[n,r]=reactExports.useState([]);return reactExports.useEffect(()=>{(async()=>{const a=query(collection(db,"contents"),where("batchId","==",i),where("subject","==",e)),u=(await getDocs(a)).docs.map(h=>h.data()),d=[...new Set(u.map(h=>h.chapter||"Unit 1"))];r(d)})()},[i,e]),jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-slate-50 pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 border-b flex items-center gap-3 sticky top-0 z-10",children:[jsxRuntimeExports.jsx("button",{onClick:()=>t(-1),className:"p-2 hover:bg-gray-100 rounded-full",children:jsxRuntimeExports.jsx(ArrowLeft,{size:20})}),jsxRuntimeExports.jsx("h1",{className:"font-bold text-lg",children:e})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-3",children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-2",children:"Chapters"}),n.map((s,a)=>jsxRuntimeExports.jsxs("div",{onClick:()=>t(`/student/course/${i}/subject/${e}/chapter/${s}`),className:"bg-white p-4 rounded-xl border flex justify-between items-center cursor-pointer hover:shadow-md transition active:scale-95",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-purple-100 p-2 rounded-lg text-purple-600",children:jsxRuntimeExports.jsx(Book,{size:20})}),jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-800",children:s})]}),jsxRuntimeExports.jsx(ChevronRight,{size:18,className:"text-gray-400"})]},a)),n.length===0&&jsxRuntimeExports.jsx("div",{className:"text-center py-10 text-gray-500",children:"No chapters found."})]})]})},ChapterContent=()=>{const{batchId:i,subjectName:e,chapterName:t}=useParams(),n=useNavigate(),r=auth.currentUser,[s,a]=reactExports.useState([]),[l,u]=reactExports.useState("video"),[d,h]=reactExports.useState(!1),[p,m]=reactExports.useState(!0);reactExports.useEffect(()=>{(async()=>{try{if(r){const z=await getDoc(doc(db,"users",r.uid));z.exists()&&z.data().enrolledBatches?.includes(i)&&h(!0)}const E=query(collection(db,"contents"),where("batchId","==",i),where("subject","==",e),where("chapter","==",t)),A=await getDocs(E);a(A.docs.map(z=>({id:z.id,...z.data()})))}catch(E){console.error("Error fetching content:",E)}m(!1)})()},[i,e,t,r]);const g=s.filter(b=>b.type==="video"),v=s.filter(b=>b.type==="note"),_=b=>{if(!d){alert(" This content is locked! Please buy the course to access.");return}b.type==="video"?n(`/student/watch/${b.id}`,{state:{video:b}}):b.type==="note"&&(b.notesUrl?n(`/student/notes/${b.id}`,{state:{note:b}}):alert("PDF file link is missing in database."))};return p?jsxRuntimeExports.jsx("div",{className:"p-10 text-center text-gray-400",children:"Loading chapter content..."}):jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-slate-50 pb-20",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 border-b sticky top-0 z-10 shadow-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[jsxRuntimeExports.jsx("button",{onClick:()=>n(-1),className:"p-2 hover:bg-gray-100 rounded-full transition",children:jsxRuntimeExports.jsx(ArrowLeft,{size:20})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"font-bold text-lg text-gray-800 line-clamp-1",children:t}),jsxRuntimeExports.jsx("p",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-widest",children:e})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-xl",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>u("video"),className:`flex-1 py-2 text-xs font-bold rounded-lg flex items-center justify-center gap-2 transition ${l==="video"?"bg-white shadow text-blue-600":"text-gray-500"}`,children:[jsxRuntimeExports.jsx(CirclePlay,{size:16})," Lectures"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>u("notes"),className:`flex-1 py-2 text-xs font-bold rounded-lg flex items-center justify-center gap-2 transition ${l==="notes"?"bg-white shadow text-blue-600":"text-gray-500"}`,children:[jsxRuntimeExports.jsx(FileText,{size:16})," PDF Notes"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-3",children:[!d&&jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 border border-blue-100 p-3 rounded-xl flex items-center gap-3 mb-4",children:[jsxRuntimeExports.jsx(Lock,{className:"text-blue-500",size:18}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-blue-700 font-medium",children:"Enroll now to unlock all lectures and premium PDF notes."})]}),l==="video"&&(g.length>0?g.map(b=>jsxRuntimeExports.jsxs("div",{onClick:()=>_(b),className:`bg-white p-4 rounded-xl border flex items-center gap-4 cursor-pointer transition ${d?"hover:border-blue-400 hover:shadow-md active:scale-95":"opacity-70"}`,children:[jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center shrink-0 ${d?"bg-red-50 text-red-500":"bg-gray-100 text-gray-400"}`,children:d?jsxRuntimeExports.jsx(CirclePlay,{size:24}):jsxRuntimeExports.jsx(Lock,{size:20})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-sm text-gray-800 line-clamp-2",children:b.title}),jsxRuntimeExports.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:"Video Lecture"})]})]},b.id)):jsxRuntimeExports.jsx("div",{className:"text-center py-20 text-gray-300",children:"No videos uploaded yet."})),l==="notes"&&(v.length>0?v.map(b=>jsxRuntimeExports.jsxs("div",{onClick:()=>_(b),className:`bg-white p-4 rounded-xl border flex items-center gap-4 cursor-pointer transition ${d?"hover:border-blue-400 hover:shadow-md active:scale-95":"opacity-70"}`,children:[jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center shrink-0 ${d?"bg-blue-50 text-blue-500":"bg-gray-100 text-gray-400"}`,children:d?jsxRuntimeExports.jsx(FileText,{size:24}):jsxRuntimeExports.jsx(Lock,{size:20})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-sm text-gray-800 line-clamp-2",children:b.title}),jsxRuntimeExports.jsx("span",{className:"text-[10px] text-gray-400 font-medium",children:"Class Notes"})]})]},b.id)):jsxRuntimeExports.jsx("div",{className:"text-center py-20 text-gray-300",children:"No notes found."}))]})]})},MyCourses=()=>{const i=useNavigate(),[e,t]=reactExports.useState([]),[n,r]=reactExports.useState(!0),s=auth.currentUser;return reactExports.useEffect(()=>{(async()=>{if(s){try{const l=await getDoc(doc(db,"users",s.uid));if(l.exists()){const d=l.data().enrolledBatches||[];if(d.length>0){const h=d.map(g=>getDoc(doc(db,"batches",g))),m=(await Promise.all(h)).filter(g=>g.exists()).map(g=>({id:g.id,...g.data()}));t(m)}}}catch(l){console.error("Error fetching courses:",l)}r(!1)}})()},[s]),n?jsxRuntimeExports.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading your courses..."}):jsxRuntimeExports.jsxs("div",{className:"space-y-6 min-h-screen pb-20",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"My Learning"}),e.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-16 bg-white rounded-2xl border border-dashed text-center px-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-blue-50 p-6 rounded-full mb-4",children:jsxRuntimeExports.jsx(BookOpen,{size:40,className:"text-blue-500"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"No Courses Yet"}),jsxRuntimeExports.jsx("p",{className:"text-gray-500 mb-6 max-w-xs",children:"You haven't enrolled in any courses yet. Start your journey today!"}),jsxRuntimeExports.jsxs("button",{onClick:()=>i("/student/home"),className:"bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2",children:[jsxRuntimeExports.jsx(Search,{size:18})," Explore Courses"]})]}):jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:e.map(a=>jsxRuntimeExports.jsxs("div",{onClick:()=>i(`/student/course/${a.id}`),className:"bg-white rounded-xl border hover:shadow-lg transition cursor-pointer overflow-hidden group flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"h-40 bg-gray-200 relative",children:[jsxRuntimeExports.jsx("img",{src:a.thumbnail||`https://ui-avatars.com/api/?name=${a.name}`,className:"w-full h-full object-cover",alt:a.name}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-black/20 group-hover:bg-black/10 transition flex items-center justify-center",children:jsxRuntimeExports.jsx(CirclePlay,{className:"text-white opacity-80 group-hover:scale-110 transition",size:48})}),jsxRuntimeExports.jsxs("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-gray-300",children:[jsxRuntimeExports.jsx("div",{className:"h-full bg-green-500",style:{width:"0%"}})," "]})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded w-fit mb-2",children:a.subject||"Enrolled"}),jsxRuntimeExports.jsx("h3",{className:"font-bold text-lg text-gray-800 line-clamp-1 mb-1",children:a.name}),jsxRuntimeExports.jsx("button",{className:"mt-auto w-full bg-blue-600 text-white py-2 rounded-lg font-bold text-sm hover:bg-blue-700",children:"Continue Learning"})]})]},a.id))})]})},Profile=()=>{const{currentUser:i,logout:e}=useAuth(),t=useNavigate(),n=async()=>{try{await e(),t("/login")}catch(r){console.error("Logout Error:",r)}};return jsxRuntimeExports.jsxs("div",{className:"max-w-md mx-auto min-h-screen pb-20",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"My Profile"}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border text-center mb-6",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 bg-blue-100 rounded-full mx-auto mb-4 flex items-center justify-center text-blue-600 text-3xl font-bold border-4 border-white shadow",children:i?.displayName?.charAt(0)||"U"}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-gray-900",children:i?.displayName||"Student"}),jsxRuntimeExports.jsx("p",{className:"text-gray-500 text-sm",children:i?.email}),jsxRuntimeExports.jsx("span",{className:"inline-block mt-2 bg-green-100 text-green-700 text-xs px-3 py-1 rounded-full font-bold",children:"Student Account"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 border-b flex items-center gap-3",children:[jsxRuntimeExports.jsx(Mail,{size:20,className:"text-gray-400"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Email Address"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-medium",children:i?.email})]})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx(Phone,{size:20,className:"text-gray-400"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Phone"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-400",children:"Not Added"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{className:"w-full bg-white p-4 rounded-xl border shadow-sm flex items-center gap-3 hover:bg-gray-50",children:[jsxRuntimeExports.jsx(Shield,{size:20,className:"text-blue-600"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-700",children:"Privacy & Security"})]}),jsxRuntimeExports.jsxs("button",{className:"w-full bg-white p-4 rounded-xl border shadow-sm flex items-center gap-3 hover:bg-gray-50",children:[jsxRuntimeExports.jsx(CircleQuestionMark,{size:20,className:"text-purple-600"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-700",children:"Help & Support"})]}),jsxRuntimeExports.jsxs("button",{onClick:n,className:"w-full bg-red-50 p-4 rounded-xl border border-red-100 flex items-center gap-3 text-red-600 hover:bg-red-100",children:[jsxRuntimeExports.jsx(LogOut,{size:20}),jsxRuntimeExports.jsx("span",{className:"font-bold",children:"Log Out"})]})]}),jsxRuntimeExports.jsx("p",{className:"text-center text-xs text-gray-400 mt-8",children:"App Version 1.0.0"})]})},AdminNotices=()=>{const{batchId:i}=useParams(),e=useNavigate(),[t,n]=reactExports.useState([]),[r,s]=reactExports.useState({title:"",message:""}),[a,l]=reactExports.useState(!0),u=async()=>{try{const p=query(collection(db,"notices"),where("batchId","==",i),orderBy("createdAt","desc")),m=await getDocs(p);n(m.docs.map(g=>({id:g.id,...g.data()})))}catch(p){console.error("Error fetching notices:",p)}l(!1)};reactExports.useEffect(()=>{u()},[i]);const d=async p=>{if(p.preventDefault(),!(!r.title||!r.message))try{await addDoc(collection(db,"notices"),{...r,batchId:i,createdAt:new Date}),s({title:"",message:""}),u(),alert("Notice Posted Successfully! ")}catch(m){console.error(m),alert("Error posting notice")}},h=async p=>{confirm("Delete this notice?")&&(await deleteDoc(doc(db,"notices",p)),u())};return jsxRuntimeExports.jsxs("div",{className:"p-6 bg-slate-50 min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[jsxRuntimeExports.jsx("button",{onClick:()=>e(-1),className:"p-2 hover:bg-white rounded-full",children:jsxRuntimeExports.jsx(ArrowLeft,{size:20})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Batch Announcements"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border h-fit sticky top-6",children:[jsxRuntimeExports.jsxs("h2",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Bell,{className:"text-blue-600",size:20})," Post New Notice"]}),jsxRuntimeExports.jsxs("form",{onSubmit:d,className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Title"}),jsxRuntimeExports.jsx("input",{className:"w-full border p-2 rounded mt-1 focus:ring-2 ring-blue-500 outline-none",placeholder:"e.g. Class Rescheduled",value:r.title,onChange:p=>s({...r,title:p.target.value}),required:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase",children:"Message"}),jsxRuntimeExports.jsx("textarea",{className:"w-full border p-2 rounded mt-1 h-32 focus:ring-2 ring-blue-500 outline-none",placeholder:"Type your message here...",value:r.message,onChange:p=>s({...r,message:p.target.value}),required:!0})]}),jsxRuntimeExports.jsxs("button",{className:"w-full bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-700 flex justify-center items-center gap-2",children:[jsxRuntimeExports.jsx(Send,{size:18})," Post Notice"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h2",{className:"font-bold text-lg text-gray-700",children:"History"}),a?jsxRuntimeExports.jsx("p",{children:"Loading..."}):t.length===0?jsxRuntimeExports.jsx("div",{className:"text-center py-10 text-gray-400 bg-white rounded-xl border border-dashed",children:"No notices posted yet."}):t.map(p=>jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm relative group hover:shadow-md transition",children:[jsxRuntimeExports.jsx("button",{onClick:()=>h(p.id),className:"absolute top-3 right-3 text-gray-300 hover:text-red-500 p-1 opacity-0 group-hover:opacity-100 transition",title:"Delete Notice",children:jsxRuntimeExports.jsx(Trash2,{size:18})}),jsxRuntimeExports.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:p.title}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm mt-2 whitespace-pre-wrap leading-relaxed",children:p.message}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-400 mt-3 border-t pt-2 flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{children:"Posted:"}),jsxRuntimeExports.jsx("span",{children:p.createdAt?.seconds?new Date(p.createdAt.seconds*1e3).toLocaleString():"Just now"})]})]},p.id))]})]})]})},RequireAuth=({children:i})=>{const{currentUser:e}=useAuth();return e?i:jsxRuntimeExports.jsx(Navigate,{to:"/login"})},RequireAdmin=({children:i})=>{const{currentUser:e,userRole:t,loading:n}=useAuth();return n?jsxRuntimeExports.jsx("div",{children:"Checking Permissions..."}):!e||t!=="admin"?jsxRuntimeExports.jsx(Navigate,{to:"/student/home"}):i},RedirectUser=({children:i})=>{const{currentUser:e}=useAuth();return e?jsxRuntimeExports.jsx(Navigate,{to:"/student/home"}):i},Layout=({children:i})=>{const e=useLocation(),[t,n]=reactExports.useState(!1),r=e.pathname.startsWith("/admin"),s=e.pathname.startsWith("/student"),a=["/","/login","/signup"].includes(e.pathname);return jsxRuntimeExports.jsxs("div",{className:`flex flex-col md:flex-row min-h-screen ${a?"bg-white":"bg-slate-50"}`,children:[r&&jsxRuntimeExports.jsx(AdminSidebar,{isOpen:t,onClose:()=>n(!1)}),s&&jsxRuntimeExports.jsx(Sidebar,{isOpen:t,onClose:()=>n(!1)}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col min-h-screen",children:[!a&&jsxRuntimeExports.jsxs("header",{className:"bg-white border-b p-4 flex justify-between items-center md:hidden sticky top-0 z-30",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>n(!0),className:"text-gray-700 hover:text-blue-600",children:jsxRuntimeExports.jsx(Menu$1,{size:28})}),jsxRuntimeExports.jsx("span",{className:"font-bold text-lg text-blue-600",children:"ABP Classes"})]}),r?jsxRuntimeExports.jsx("div",{className:"bg-slate-900 text-white text-xs px-2 py-1 rounded",children:"ADMIN"}):jsxRuntimeExports.jsx(CircleUser,{size:28,className:"text-gray-400"})]}),jsxRuntimeExports.jsx("main",{className:"flex-1 p-4 md:p-6 overflow-y-auto pb-24 md:pb-6",children:i}),!a&&!r&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"hidden md:block",children:jsxRuntimeExports.jsx(Footer,{})}),jsxRuntimeExports.jsx(BottomNav,{})]})]})]})};function App(){return jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(RedirectUser,{children:jsxRuntimeExports.jsx(Login,{})})}),jsxRuntimeExports.jsx(Route,{path:"/login",element:jsxRuntimeExports.jsx(RedirectUser,{children:jsxRuntimeExports.jsx(Login,{})})}),jsxRuntimeExports.jsx(Route,{path:"/signup",element:jsxRuntimeExports.jsx(RedirectUser,{children:jsxRuntimeExports.jsx(Signup,{})})}),jsxRuntimeExports.jsx(Route,{path:"/student/home",element:jsxRuntimeExports.jsx(RequireAuth,{children:jsxRuntimeExports.jsx(StudentHome,{})})}),jsxRuntimeExports.jsx(Route,{path:"/student/notes/:noteId",element:jsxRuntimeExports.jsx(RequireAuth,{children:jsxRuntimeExports.jsx(ViewNotes,{})})}),jsxRuntimeExports.jsx(Route,{path:"/student",element:jsxRuntimeExports.jsx(RequireAuth,{children:jsxRuntimeExports.jsx(StudentHome,{})})}),jsxRuntimeExports.jsx(Route,{path:"/student/my-courses",element:jsxRuntimeExports.jsx(RequireAuth,{children:jsxRuntimeExports.jsx(MyCourses,{})})}),jsxRuntimeExports.jsx(Route,{path:"/student/profile",element:jsxRuntimeExports.jsx(RequireAuth,{children:jsxRuntimeExports.jsx(Profile,{})})}),jsxRuntimeExports.jsx(Route,{path:"/student/course/:id",element:jsxRuntimeExports.jsx(RequireAuth,{children:jsxRuntimeExports.jsx(CourseDetail,{})})}),jsxRuntimeExports.jsx(Route,{path:"/student/course/:batchId/subject/:subjectName",element:jsxRuntimeExports.jsx(RequireAuth,{children:jsxRuntimeExports.jsx(SubjectChapters,{})})}),jsxRuntimeExports.jsx(Route,{path:"/student/course/:batchId/subject/:subjectName/chapter/:chapterName",element:jsxRuntimeExports.jsx(RequireAuth,{children:jsxRuntimeExports.jsx(ChapterContent,{})})}),jsxRuntimeExports.jsx(Route,{path:"/student/test/:testId",element:jsxRuntimeExports.jsx(RequireAuth,{children:jsxRuntimeExports.jsx(TestPlayer,{})})}),jsxRuntimeExports.jsx(Route,{path:"/student/watch/:videoId",element:jsxRuntimeExports.jsx(RequireAuth,{children:jsxRuntimeExports.jsx(WatchVideo,{})})}),jsxRuntimeExports.jsx(Route,{path:"/admin/dashboard",element:jsxRuntimeExports.jsx(RequireAdmin,{children:jsxRuntimeExports.jsx(Dashboard,{})})}),jsxRuntimeExports.jsx(Route,{path:"/admin/batches",element:jsxRuntimeExports.jsx(RequireAdmin,{children:jsxRuntimeExports.jsx(Batches,{})})}),jsxRuntimeExports.jsx(Route,{path:"/admin/students",element:jsxRuntimeExports.jsx(RequireAdmin,{children:jsxRuntimeExports.jsx(StudentAnalytics,{})})}),jsxRuntimeExports.jsx(Route,{path:"/admin/students/doubts",element:jsxRuntimeExports.jsx(RequireAdmin,{children:jsxRuntimeExports.jsx(AdminDoubts,{})})}),jsxRuntimeExports.jsx(Route,{path:"/admin/batch/:batchId/content",element:jsxRuntimeExports.jsx(RequireAdmin,{children:jsxRuntimeExports.jsx(BatchContent,{})})}),jsxRuntimeExports.jsx(Route,{path:"/admin/batch/:batchId/notices",element:jsxRuntimeExports.jsx(RequireAdmin,{children:jsxRuntimeExports.jsx(AdminNotices,{})})}),jsxRuntimeExports.jsx(Route,{path:"/admin/batch/:batchId/tests",element:jsxRuntimeExports.jsx(RequireAdmin,{children:jsxRuntimeExports.jsx(AdminTests,{})})}),jsxRuntimeExports.jsx(Route,{path:"/admin/test/:testId/questions",element:jsxRuntimeExports.jsx(RequireAdmin,{children:jsxRuntimeExports.jsx(TestQuestions,{})})})]})})}ReactDOM.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsxs(BrowserRouter,{children:["      ",jsxRuntimeExports.jsx(AuthProvider,{children:jsxRuntimeExports.jsx(App,{})})]})}));
